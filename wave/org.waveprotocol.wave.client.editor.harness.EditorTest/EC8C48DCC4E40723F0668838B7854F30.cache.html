<html>
<head><meta charset="UTF-8" /><script>
var $gwt_version = "2.1.1";
var $wnd = parent;
var $doc = $wnd.document;
var $moduleName, $moduleBase;
var $strongName = 'EC8C48DCC4E40723F0668838B7854F30';
var $stats = $wnd.__gwtStatsEvent ? function(a) {return $wnd.__gwtStatsEvent(a);} : null,
$sessionId = $wnd.__gwtStatsSessionId ? $wnd.__gwtStatsSessionId : null;
$stats && $stats({moduleName:'org.waveprotocol.wave.client.editor.harness.EditorTest',sessionId:$sessionId,subSystem:'startup',evtGroup:'moduleStartup',millis:(new Date()).getTime(),type:'moduleEvalStart'});
</script></head>
<body>
<script><!--
var _, P0_longLit = {l:0, m:0, h:0};
function nullMethod(){
}

function Object_1(){
}

function Object_0(){
}

_ = Object_1.prototype = Object_0.prototype = {};
_.equals$ = function equals(other){
  return this === other;
}
;
_.getClass$ = function getClass_0(){
  return Ljava_lang_Object_2_classLit;
}
;
_.hashCode$ = function hashCode_0(){
  return this.$H || (this.$H = ++sNextHashId);
}
;
_.toString$ = function toString_0(){
  return (this.typeMarker$ == nullMethod || this.castableTypeMap$ && !!this.castableTypeMap$[1]?this.getClass$():Lcom_google_gwt_core_client_JavaScriptObject_2_classLit).typeName + '@' + toPowerOfTwoString(this.typeMarker$ == nullMethod || this.castableTypeMap$ && !!this.castableTypeMap$[1]?this.hashCode$():this.$H || (this.$H = ++sNextHashId));
}
;
_.toString = function(){
  return this.toString$();
}
;
_.typeMarker$ = nullMethod;
_.castableTypeMap$ = {};
function checkArgument(expression){
  if (!expression) {
    throw new IllegalArgumentException_1('Argument is not a checkbox');
  }
}

function checkNotNull(reference){
  if (reference == null) {
    throw new NullPointerException_0;
  }
  return reference;
}

function checkNotNull_0(reference, errorMessage){
  if (reference == null) {
    throw new NullPointerException_1('' + errorMessage);
  }
  return reference;
}

function $cancel(this$static){
  if (!this$static.running) {
    return;
  }
  $remove_11(animations, this$static);
  this$static.started && $onComplete(this$static);
  this$static.started = false;
  this$static.running = false;
}

function $run(this$static, startTime){
  $cancel(this$static);
  this$static.running = true;
  this$static.duration = 200;
  this$static.startTime = startTime;
  if ($update(this$static, (new Date).getTime())) {
    return;
  }
  if (!animations) {
    animations = new ArrayList_0;
    animationTimer = new Animation$1_0;
  }
  $add_9(animations, this$static);
  animations.size == 1 && $schedule(animationTimer, 25);
}

function $update(this$static, curTime){
  var finished, progress;
  finished = curTime >= this$static.startTime + this$static.duration;
  if (this$static.started && !finished) {
    progress = (curTime - this$static.startTime) / this$static.duration;
    $onUpdate(this$static, (1 + Math.cos(3.141592653589793 + progress * 3.141592653589793)) / 2);
    return false;
  }
  if (!this$static.started && curTime >= this$static.startTime) {
    this$static.started = true;
    this$static.offsetHeight_0 = parseInt(this$static.curPanel.element_0['offsetHeight']) || 0;
    this$static.offsetWidth_0 = parseInt(this$static.curPanel.element_0['offsetWidth']) || 0;
    this$static.curPanel.element_0.style['overflow'] = 'hidden';
    $onUpdate(this$static, (1 + Math.cos(3.141592653589793)) / 2);
  }
  if (finished) {
    $onComplete(this$static);
    this$static.started = false;
    this$static.running = false;
    return true;
  }
  return false;
}

function updateAnimations(){
  var animation, animation$index, animation$max, curAnimations, curTime;
  curAnimations = initDim(_3Lcom_google_gwt_animation_client_Animation_2_classLit, {2:1, 58:1, 138:1}, 41, animations.size, 0);
  curAnimations = dynamicCast($toArray_1(animations, curAnimations), 2);
  curTime = (new Date).getTime();
  for (animation$index = 0 , animation$max = curAnimations.length; animation$index < animation$max; ++animation$index) {
    animation = curAnimations[animation$index];
    animation.running && $update(animation, curTime) && $remove_11(animations, animation);
  }
  animations.size > 0 && $schedule(animationTimer, 25);
}

function Animation(){
}

_ = Animation.prototype = new Object_0;
_.getClass$ = function getClass_1(){
  return Lcom_google_gwt_animation_client_Animation_2_classLit;
}
;
_.castableTypeMap$ = {41:1};
_.duration = -1;
_.running = false;
_.startTime = -1;
_.started = false;
var animationTimer = null, animations = null;
function $clinit_2(){
  $clinit_2 = nullMethod;
  timers = new ArrayList_0;
  addCloseHandler(new Timer$1_0);
}

function $cancel_0(this$static){
  this$static.isRepeating?($wnd.clearInterval(this$static.timerId) , undefined):($wnd.clearTimeout(this$static.timerId) , undefined);
  $remove_11(timers, this$static);
}

function $schedule(this$static, delayMillis){
  if (delayMillis <= 0) {
    throw new IllegalArgumentException_1('must be positive');
  }
  this$static.isRepeating?($wnd.clearInterval(this$static.timerId) , undefined):($wnd.clearTimeout(this$static.timerId) , undefined);
  $remove_11(timers, this$static);
  this$static.isRepeating = false;
  this$static.timerId = createTimeout(this$static, delayMillis);
  $add_9(timers, this$static);
}

function createTimeout(timer, delay){
  return $wnd.setTimeout($entry(function(){
    timer.fire();
  }
  ), delay);
}

function Timer(){
}

_ = Timer.prototype = new Object_0;
_.fire = function fire(){
  this.isRepeating || $remove_11(timers, this);
  this.run();
}
;
_.getClass$ = function getClass_2(){
  return Lcom_google_gwt_user_client_Timer_2_classLit;
}
;
_.castableTypeMap$ = {34:1};
_.isRepeating = false;
_.timerId = 0;
var timers;
function Animation$1_0(){
  $clinit_2();
}

function Animation$1(){
}

_ = Animation$1_0.prototype = Animation$1.prototype = new Timer;
_.getClass$ = function getClass_3(){
  return Lcom_google_gwt_animation_client_Animation$1_2_classLit;
}
;
_.run = function run(){
  updateAnimations();
}
;
_.castableTypeMap$ = {34:1};
var sUncaughtExceptionHandler = null;
function $getStackTrace(this$static){
  if (this$static.stackTrace == null) {
    return initDim(_3Ljava_lang_StackTraceElement_2_classLit, {58:1, 138:1}, 65, 0, 0);
  }
  return this$static.stackTrace;
}

function $printStackTrace(this$static){
  var causeMessage, currentCause, msg;
  msg = new StringBuffer_0;
  currentCause = this$static;
  while (currentCause) {
    causeMessage = currentCause.getMessage();
    currentCause != this$static && (msg.impl.string += 'Caused by: ' , msg);
    $append_2(msg, currentCause.getClass$().typeName);
    msg.impl.string += ': ';
    msg.impl.string += causeMessage == null?'(No exception detail)':causeMessage;
    msg.impl.string += '\n';
    currentCause = currentCause.cause;
  }
}

function $setStackTrace(this$static, stackTrace){
  var c, copy, i;
  copy = initDim(_3Ljava_lang_StackTraceElement_2_classLit, {58:1, 138:1}, 65, stackTrace.length, 0);
  for (i = 0 , c = stackTrace.length; i < c; ++i) {
    if (!stackTrace[i]) {
      throw new NullPointerException_0;
    }
    copy[i] = stackTrace[i];
  }
  this$static.stackTrace = copy;
}

function Throwable(){
}

_ = Throwable.prototype = new Object_0;
_.fillInStackTrace = function fillInStackTrace(){
  $fillInStackTrace(this);
  return this;
}
;
_.getClass$ = function getClass_4(){
  return Ljava_lang_Throwable_2_classLit;
}
;
_.getMessage = function getMessage(){
  return this.detailMessage;
}
;
_.toString$ = function toString_1(){
  var className, msg;
  className = this.getClass$().typeName;
  msg = this.getMessage();
  return msg != null?className + ': ' + msg:className;
}
;
_.castableTypeMap$ = {3:1, 58:1};
_.cause = null;
_.detailMessage = null;
_.stackTrace = null;
function Exception_3(cause){
  this.fillInStackTrace();
  this.detailMessage = !cause?null:cause.toString$();
  this.cause = cause;
}

function Exception(){
}

_ = Exception.prototype = new Throwable;
_.getClass$ = function getClass_5(){
  return Ljava_lang_Exception_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 58:1, 143:1};
function RuntimeException_1(message){
  this.fillInStackTrace();
  this.detailMessage = message;
}

function RuntimeException_2(message, cause){
  this.fillInStackTrace();
  this.cause = cause;
  this.detailMessage = message;
}

function RuntimeException_3(cause){
  Exception_3.call(this, cause);
}

function RuntimeException(){
}

_ = RuntimeException_3.prototype = RuntimeException_2.prototype = RuntimeException_1.prototype = RuntimeException.prototype = new Exception;
_.getClass$ = function getClass_6(){
  return Ljava_lang_RuntimeException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1};
function JavaScriptException_0(e){
  this.fillInStackTrace();
  this.e = e;
  $createStackTrace(new StackTraceCreator$CollectorChrome_0, this);
}

function getDescription(e){
  return instanceOfJso(e)?getDescription0(dynamicCastJso(e)):e + '';
}

function getDescription0(e){
  return e == null?null:e.message;
}

function getName(e){
  return e == null?'null':instanceOfJso(e)?getName0(dynamicCastJso(e)):e != null && e.castableTypeMap$ && !!e.castableTypeMap$[1]?'String':(e.typeMarker$ == nullMethod || e.castableTypeMap$ && !!e.castableTypeMap$[1]?e.getClass$():Lcom_google_gwt_core_client_JavaScriptObject_2_classLit).typeName;
}

function getName0(e){
  return e == null?null:e.name;
}

function getProperties(e){
  return instanceOfJso(e)?getProperties0(dynamicCastJso(e)):'';
}

function getProperties0(e){
  var result = '';
  try {
    for (var prop in e) {
      if (prop != 'name' && prop != 'message' && prop != 'toString') {
        try {
          result += '\n ' + prop + ': ' + e[prop];
        }
         catch (ignored) {
        }
      }
    }
  }
   catch (ignored) {
  }
  return result;
}

function JavaScriptException(){
}

_ = JavaScriptException_0.prototype = JavaScriptException.prototype = new RuntimeException;
_.getClass$ = function getClass_7(){
  return Lcom_google_gwt_core_client_JavaScriptException_2_classLit;
}
;
_.getMessage = function getMessage_0(){
  this.message_0 == null && (this.name_0 = getName(this.e) , this.description = getDescription(this.e) , this.message_0 = '(' + this.name_0 + '): ' + this.description + getProperties(this.e) , undefined);
  return this.message_0;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1, 144:1};
_.description = null;
_.e = null;
_.message_0 = null;
_.name_0 = null;
function equals__devirtual$(this$static, other){
  return this$static.typeMarker$ == nullMethod || this$static.castableTypeMap$ && !!this$static.castableTypeMap$[1]?this$static.equals$(other):this$static === other;
}

function getClass__devirtual$(this$static){
  return this$static.typeMarker$ == nullMethod || this$static.castableTypeMap$ && !!this$static.castableTypeMap$[1]?this$static.getClass$():Lcom_google_gwt_core_client_JavaScriptObject_2_classLit;
}

function hashCode__devirtual$(this$static){
  return this$static.typeMarker$ == nullMethod || this$static.castableTypeMap$ && !!this$static.castableTypeMap$[1]?this$static.hashCode$():this$static.$H || (this$static.$H = ++sNextHashId);
}

function toString__devirtual$(this$static){
  return this$static.typeMarker$ == nullMethod || this$static.castableTypeMap$ && !!this$static.castableTypeMap$[1]?this$static.toString$():this$static.toString?this$static.toString():'[JavaScriptObject]';
}

function $push_0(this$static, value){
  this$static[this$static.length] = value;
}

function Scheduler(){
}

_ = Scheduler.prototype = new Object_0;
_.getClass$ = function getClass_9(){
  return Lcom_google_gwt_core_client_Scheduler_2_classLit;
}
;
_.castableTypeMap$ = {};
function enter_0(){
  if (entryDepth++ == 0) {
    $flushEntryCommands(($clinit_18() , INSTANCE));
    return true;
  }
  return false;
}

function entry_0(jsFunction){
  return function(){
    try {
      return entry0(jsFunction, this, arguments);
    }
     catch (e) {
      throw e;
    }
  }
  ;
}

function entry0(jsFunction, thisObj, arguments_0){
  var $e0, initialEntry, t;
  initialEntry = enter_0();
  try {
    if (sUncaughtExceptionHandler) {
      try {
        return jsFunction.apply(thisObj, arguments_0);
      }
       catch ($e0) {
        $e0 = caught_0($e0);
        if (instanceOf($e0, 3)) {
          t = $e0;
          $logUncaughtExceptions(sUncaughtExceptionHandler.this$0, t);
          return undefined;
        }
         else 
          throw $e0;
      }
    }
     else {
      return jsFunction.apply(thisObj, arguments_0);
    }
  }
   finally {
    initialEntry && $flushFinallyCommands(($clinit_18() , INSTANCE));
    --entryDepth;
  }
}

function getHashCode(o){
  return o.$H || (o.$H = ++sNextHashId);
}

var entryDepth = 0, sNextHashId = 0;
function $clinit_18(){
  $clinit_18 = nullMethod;
  INSTANCE = new SchedulerImpl_0;
}

function $flushEntryCommands(this$static){
  var oldQueue, rescheduled;
  if (this$static.entryCommands) {
    rescheduled = null;
    do {
      oldQueue = this$static.entryCommands;
      this$static.entryCommands = null;
      rescheduled = runScheduledTasks(oldQueue, rescheduled);
    }
     while (this$static.entryCommands);
    this$static.entryCommands = rescheduled;
  }
}

function $flushFinallyCommands(this$static){
  var oldQueue, rescheduled;
  if (this$static.finallyCommands) {
    rescheduled = null;
    do {
      oldQueue = this$static.finallyCommands;
      this$static.finallyCommands = null;
      rescheduled = runScheduledTasks(oldQueue, rescheduled);
    }
     while (this$static.finallyCommands);
    this$static.finallyCommands = rescheduled;
  }
}

function $scheduleFinally(this$static, cmd){
  this$static.finallyCommands = push(this$static.finallyCommands, [cmd, false]);
}

function SchedulerImpl_0(){
}

function push(queue, task){
  !queue && (queue = []);
  queue[queue.length] = task;
  return queue;
}

function runScheduledTasks(tasks, rescheduled){
  var $e0, e, i, j, t;
  for (i = 0 , j = tasks.length; i < j; ++i) {
    t = tasks[i];
    try {
      t[1]?t[0].nullMethod() && (rescheduled = push(rescheduled, t)):t[0].execute();
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 4)) {
        e = $e0;
        !!sUncaughtExceptionHandler && ($logUncaughtExceptions(sUncaughtExceptionHandler.this$0, e) , undefined);
      }
       else 
        throw $e0;
    }
  }
  return rescheduled;
}

function SchedulerImpl(){
}

_ = SchedulerImpl_0.prototype = SchedulerImpl.prototype = new Scheduler;
_.getClass$ = function getClass_10(){
  return Lcom_google_gwt_core_client_impl_SchedulerImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.entryCommands = null;
_.finallyCommands = null;
var INSTANCE;
function extractNameFromToString(fnToString){
  var index, start, toReturn;
  toReturn = '';
  fnToString = $trim(fnToString);
  index = fnToString.indexOf('(');
  if (index != -1) {
    start = fnToString.indexOf('function') == 0?8:0;
    toReturn = $trim(fnToString.substr(start, index - start));
  }
  return toReturn.length > 0?toReturn:'anonymous';
}

function splice(arr, length_0){
  arr.length >= length_0 && arr.splice(0, length_0);
  return arr;
}

function $createStackTrace(this$static, e){
  var i, j, stack, stackTrace;
  stack = $inferFrom_0(this$static, instanceOfJso(e.e)?dynamicCastJso(e.e):null);
  stackTrace = initDim(_3Ljava_lang_StackTraceElement_2_classLit, {58:1, 138:1}, 65, stack.length, 0);
  for (i = 0 , j = stackTrace.length; i < j; ++i) {
    stackTrace[i] = new StackTraceElement_0(stack[i]);
  }
  $setStackTrace(e, stackTrace);
}

function $fillInStackTrace(t){
  var i, j, stack, stackTrace;
  stack = $collect_0(new StackTraceCreator$CollectorChrome_0);
  stackTrace = initDim(_3Ljava_lang_StackTraceElement_2_classLit, {58:1, 138:1}, 65, stack.length, 0);
  for (i = 0 , j = stackTrace.length; i < j; ++i) {
    stackTrace[i] = new StackTraceElement_0(stack[i]);
  }
  $setStackTrace(t, stackTrace);
}

function $makeException(){
  try {
    null.a();
  }
   catch (e) {
    return e;
  }
}

function StackTraceCreator$Collector_0(){
}

function StackTraceCreator$Collector(){
}

_ = StackTraceCreator$Collector_0.prototype = StackTraceCreator$Collector.prototype = new Object_0;
_.collect = function collect(){
  var seen = {};
  var toReturn = [];
  var callee = arguments.callee.caller.caller;
  while (callee) {
    var name_0 = this.extractName(callee.toString());
    toReturn.push(name_0);
    var keyName = ':' + name_0;
    var withThisName = seen[keyName];
    if (withThisName) {
      var i, j;
      for (i = 0 , j = withThisName.length; i < j; i++) {
        if (withThisName[i] === callee) {
          return toReturn;
        }
      }
    }
    (withThisName || (seen[keyName] = [])).push(callee);
    callee = callee.caller;
  }
  return toReturn;
}
;
_.extractName = function extractName(fnToString){
  return extractNameFromToString(fnToString);
}
;
_.getClass$ = function getClass_11(){
  return Lcom_google_gwt_core_client_impl_StackTraceCreator$Collector_2_classLit;
}
;
_.inferFrom = function inferFrom(e){
  return [];
}
;
_.castableTypeMap$ = {};
function $inferFrom(this$static, e){
  var i, j, stack;
  stack = e && e.stack?e.stack.split('\n'):[];
  for (i = 0 , j = stack.length; i < j; ++i) {
    stack[i] = this$static.extractName(stack[i]);
  }
  return stack;
}

function StackTraceCreator$CollectorMoz(){
}

_ = StackTraceCreator$CollectorMoz.prototype = new StackTraceCreator$Collector;
_.collect = function collect_0(){
  return splice(this.inferFrom($makeException()), this.toSplice());
}
;
_.getClass$ = function getClass_12(){
  return Lcom_google_gwt_core_client_impl_StackTraceCreator$CollectorMoz_2_classLit;
}
;
_.inferFrom = function inferFrom_0(e){
  return $inferFrom(this, e);
}
;
_.toSplice = function toSplice(){
  return 2;
}
;
_.castableTypeMap$ = {};
function $collect_0(this$static){
  var res;
  res = splice($inferFrom_0(this$static, $makeException()), 3);
  res.length == 0 && (res = splice((new StackTraceCreator$Collector_0).collect(), 1));
  return res;
}

function $inferFrom_0(this$static, e){
  var stack;
  stack = $inferFrom(this$static, e);
  return stack.length == 0?(new StackTraceCreator$Collector_0).inferFrom(e):(stack.length >= 1 && stack.splice(0, 1) , stack);
}

function StackTraceCreator$CollectorChrome_0(){
}

function StackTraceCreator$CollectorChrome(){
}

_ = StackTraceCreator$CollectorChrome_0.prototype = StackTraceCreator$CollectorChrome.prototype = new StackTraceCreator$CollectorMoz;
_.collect = function collect_1(){
  return $collect_0(this);
}
;
_.extractName = function extractName_0(fnToString){
  var index, toReturn;
  if (fnToString.length == 0) {
    return 'anonymous';
  }
  toReturn = $trim(fnToString);
  toReturn.indexOf('at ') == 0 && (toReturn = toReturn.substr(3, toReturn.length - 3));
  index = toReturn.indexOf('[');
  index == -1 && (index = toReturn.indexOf('('));
  if (index == -1) {
    return 'anonymous';
  }
   else {
    toReturn = $trim(toReturn.substr(0, index - 0));
  }
  index = toReturn.indexOf(fromCodePoint(46));
  index != -1 && (toReturn = toReturn.substr(index + 1, toReturn.length - (index + 1)));
  return toReturn.length > 0?toReturn:'anonymous';
}
;
_.getClass$ = function getClass_13(){
  return Lcom_google_gwt_core_client_impl_StackTraceCreator$CollectorChrome_2_classLit;
}
;
_.inferFrom = function inferFrom_1(e){
  return $inferFrom_0(this, e);
}
;
_.toSplice = function toSplice_0(){
  return 3;
}
;
_.castableTypeMap$ = {};
function StringBufferImpl(){
}

_ = StringBufferImpl.prototype = new Object_0;
_.getClass$ = function getClass_14(){
  return Lcom_google_gwt_core_client_impl_StringBufferImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
function $replace(this$static, start, end, toInsert){
  this$static.string = this$static.string.substr(0, start - 0) + toInsert + $substring(this$static.string, end);
}

function StringBufferImplAppend_0(){
}

function StringBufferImplAppend(){
}

_ = StringBufferImplAppend_0.prototype = StringBufferImplAppend.prototype = new StringBufferImpl;
_.getClass$ = function getClass_15(){
  return Lcom_google_gwt_core_client_impl_StringBufferImplAppend_2_classLit;
}
;
_.castableTypeMap$ = {};
_.string = '';
function $getFirstChildElement(elem){
  var child = elem.firstChild;
  while (child && child.nodeType != 1)
    child = child.nextSibling;
  return child;
}

function $getNextSiblingElement(elem){
  var sib = elem.nextSibling;
  while (sib && sib.nodeType != 1)
    sib = sib.nextSibling;
  return sib;
}

function $getParentElement(node){
  var parent_0 = node.parentNode;
  (!parent_0 || parent_0.nodeType != 1) && (parent_0 = null);
  return parent_0;
}

function $scrollIntoView(elem){
  var left = elem.offsetLeft, top_0 = elem.offsetTop;
  var width = elem.offsetWidth, height = elem.offsetHeight;
  if (elem.parentNode != elem.offsetParent) {
    left -= elem.parentNode.offsetLeft;
    top_0 -= elem.parentNode.offsetTop;
  }
  var cur = elem.parentNode;
  while (cur && cur.nodeType == 1) {
    left < cur.scrollLeft && (cur.scrollLeft = left);
    left + width > cur.scrollLeft + cur.clientWidth && (cur.scrollLeft = left + width - cur.clientWidth);
    top_0 < cur.scrollTop && (cur.scrollTop = top_0);
    top_0 + height > cur.scrollTop + cur.clientHeight && (cur.scrollTop = top_0 + height - cur.clientHeight);
    var offsetLeft = cur.offsetLeft, offsetTop = cur.offsetTop;
    if (cur.parentNode != cur.offsetParent) {
      offsetLeft -= cur.parentNode.offsetLeft;
      offsetTop -= cur.parentNode.offsetTop;
    }
    left += offsetLeft - cur.scrollLeft;
    top_0 += offsetTop - cur.scrollTop;
    cur = cur.parentNode;
  }
}

function $createInputRadioElement(doc, name_0){
  var elem = doc.createElement('INPUT');
  elem.type = 'radio';
  elem.name = name_0;
  return elem;
}

function $eventGetButton(evt){
  var button = evt.button;
  if (button == 1) {
    return 4;
  }
   else if (button == 2) {
    return 2;
  }
  return 1;
}

function $getAbsoluteLeft(elem){
  var rect;
  rect = elem.getBoundingClientRect && elem.getBoundingClientRect();
  return rect?rect.left + $getScrollLeft_0(elem.ownerDocument.body):getAbsoluteLeftUsingOffsets(elem);
}

function $getAbsoluteTop(elem){
  var rect;
  rect = elem.getBoundingClientRect && elem.getBoundingClientRect();
  return rect?rect.top + (elem.ownerDocument.body.scrollTop || 0):getAbsoluteTopUsingOffsets(elem);
}

function $getScrollLeft_0(elem){
  if (elem.ownerDocument.defaultView.getComputedStyle(elem, '').direction == 'rtl') {
    return (elem.scrollLeft || 0) - ((elem.scrollWidth || 0) - elem.clientWidth);
  }
  return elem.scrollLeft || 0;
}

function $getTabIndex(elem){
  return typeof elem.tabIndex != 'undefined'?elem.tabIndex:-1;
}

function $isOrHasChild(parent_0, child){
  while (child) {
    if (parent_0 == child) {
      return true;
    }
    child = child.parentNode;
    child && child.nodeType != 1 && (child = null);
  }
  return false;
}

function getAbsoluteLeftUsingOffsets(elem){
  if (elem.offsetLeft == null) {
    return 0;
  }
  var left = 0;
  var doc = elem.ownerDocument;
  var curr = elem.parentNode;
  if (curr) {
    while (curr.offsetParent) {
      left -= curr.scrollLeft;
      doc.defaultView.getComputedStyle(curr, '').getPropertyValue('direction') == 'rtl' && (left += curr.scrollWidth - curr.clientWidth);
      curr = curr.parentNode;
    }
  }
  while (elem) {
    left += elem.offsetLeft;
    if (doc.defaultView.getComputedStyle(elem, '')['position'] == 'fixed') {
      left += doc.body.scrollLeft;
      return left;
    }
    var parent_0 = elem.offsetParent;
    parent_0 && $wnd.devicePixelRatio && (left += parseInt(doc.defaultView.getComputedStyle(parent_0, '').getPropertyValue('border-left-width')));
    if (parent_0 && parent_0.tagName == 'BODY' && elem.style.position == 'absolute') {
      break;
    }
    elem = parent_0;
  }
  return left;
}

function getAbsoluteTopUsingOffsets(elem){
  if (elem.offsetTop == null) {
    return 0;
  }
  var top_0 = 0;
  var doc = elem.ownerDocument;
  var curr = elem.parentNode;
  if (curr) {
    while (curr.offsetParent) {
      top_0 -= curr.scrollTop;
      curr = curr.parentNode;
    }
  }
  while (elem) {
    top_0 += elem.offsetTop;
    if (doc.defaultView.getComputedStyle(elem, '')['position'] == 'fixed') {
      top_0 += doc.body.scrollTop;
      return top_0;
    }
    var parent_0 = elem.offsetParent;
    parent_0 && $wnd.devicePixelRatio && (top_0 += parseInt(doc.defaultView.getComputedStyle(parent_0, '').getPropertyValue('border-top-width')));
    if (parent_0 && parent_0.tagName == 'BODY' && elem.style.position == 'absolute') {
      break;
    }
    elem = parent_0;
  }
  return top_0;
}

function $insertAfter(this$static, newChild, refChild){
  var next;
  next = !refChild?null:refChild.nextSibling;
  return !next?this$static.appendChild(newChild):this$static.insertBefore(newChild, next);
}

function $removeFromParent(this$static){
  var parent_0;
  parent_0 = $getParentElement(this$static);
  !!parent_0 && parent_0.removeChild(this$static);
}

function $createUniqueId(this$static){
  !this$static.gwt_uid && (this$static.gwt_uid = 1);
  return 'gwt-uid-' + this$static.gwt_uid++;
}

function $getBodyOffsetLeft_0(){
  return 0;
}

function $getBodyOffsetTop_0(){
  return 0;
}

function $getClientHeight(this$static){
  return ($equals_3(this$static.compatMode, 'CSS1Compat')?this$static.documentElement:this$static.body).clientHeight;
}

function $getClientWidth(this$static){
  return ($equals_3(this$static.compatMode, 'CSS1Compat')?this$static.documentElement:this$static.body).clientWidth;
}

function $getScrollHeight(this$static){
  return ($equals_3(this$static.compatMode, 'CSS1Compat')?this$static.documentElement:this$static.body).scrollHeight || 0;
}

function $getScrollWidth(this$static){
  return ($equals_3(this$static.compatMode, 'CSS1Compat')?this$static.documentElement:this$static.body).scrollWidth || 0;
}

function $addClassName(this$static, className){
  var idx, last, lastPos, oldClassName;
  className = $trim(className);
  oldClassName = this$static.className;
  idx = oldClassName.indexOf(className);
  while (idx != -1) {
    if (idx == 0 || oldClassName.charCodeAt(idx - 1) == 32) {
      last = idx + className.length;
      lastPos = oldClassName.length;
      if (last == lastPos || last < lastPos && oldClassName.charCodeAt(last) == 32) {
        break;
      }
    }
    idx = oldClassName.indexOf(className, idx + 1);
  }
  if (idx == -1) {
    oldClassName.length > 0 && (oldClassName += ' ');
    this$static.className = oldClassName + className;
  }
}

function $getAbsoluteBottom(this$static){
  return $getAbsoluteTop(this$static) + (this$static.offsetHeight || 0);
}

function $getPropertyString(this$static, name_0){
  return this$static[name_0] == null?null:String(this$static[name_0]);
}

function $removeClassName(this$static, className){
  var begin, end, idx, last, lastPos, newClassName, oldStyle;
  className = $trim(className);
  oldStyle = this$static.className;
  idx = oldStyle.indexOf(className);
  while (idx != -1) {
    if (idx == 0 || oldStyle.charCodeAt(idx - 1) == 32) {
      last = idx + className.length;
      lastPos = oldStyle.length;
      if (last == lastPos || last < lastPos && oldStyle.charCodeAt(last) == 32) {
        break;
      }
    }
    idx = oldStyle.indexOf(className, idx + 1);
  }
  if (idx != -1) {
    begin = $trim(oldStyle.substr(0, idx - 0));
    end = $trim($substring(oldStyle, idx + className.length));
    begin.length == 0?(newClassName = end):end.length == 0?(newClassName = begin):(newClassName = begin + ' ' + end);
    this$static.className = newClassName;
  }
}

function is_0(o){
  if (!!o && !!o.nodeType) {
    return !!o && o.nodeType == 1;
  }
  return false;
}

function Enum(){
}

_ = Enum.prototype = new Object_0;
_.compareTo$ = function compareTo(other){
  return this.ordinal - dynamicCast(other, 62).ordinal;
}
;
_.equals$ = function equals_1(other){
  return this === other;
}
;
_.getClass$ = function getClass_16(){
  return Ljava_lang_Enum_2_classLit;
}
;
_.hashCode$ = function hashCode_2(){
  return this.$H || (this.$H = ++sNextHashId);
}
;
_.toString$ = function toString_3(){
  return this.name_0;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1};
_.name_0 = null;
_.ordinal = 0;
function $clinit_41(){
  $clinit_41 = nullMethod;
  NONE = new Style$BorderStyle$1_0;
  DOTTED = new Style$BorderStyle$2_0;
  DASHED = new Style$BorderStyle$3_0;
  HIDDEN = new Style$BorderStyle$4_0;
  SOLID = new Style$BorderStyle$5_0;
  $VALUES = initValues(_3Lcom_google_gwt_dom_client_Style$BorderStyle_2_classLit, {58:1, 138:1}, 42, [NONE, DOTTED, DASHED, HIDDEN, SOLID]);
}

function values_0(){
  $clinit_41();
  return $VALUES;
}

function Style$BorderStyle(){
}

_ = Style$BorderStyle.prototype = new Enum;
_.getClass$ = function getClass_17(){
  return Lcom_google_gwt_dom_client_Style$BorderStyle_2_classLit;
}
;
_.castableTypeMap$ = {42:1, 45:1, 58:1, 61:1, 62:1};
var $VALUES, DASHED, DOTTED, HIDDEN, NONE, SOLID;
function Style$BorderStyle$1_0(){
  this.name_0 = 'NONE';
  this.ordinal = 0;
}

function Style$BorderStyle$1(){
}

_ = Style$BorderStyle$1_0.prototype = Style$BorderStyle$1.prototype = new Style$BorderStyle;
_.getClass$ = function getClass_18(){
  return Lcom_google_gwt_dom_client_Style$BorderStyle$1_2_classLit;
}
;
_.castableTypeMap$ = {42:1, 45:1, 58:1, 61:1, 62:1};
function Style$BorderStyle$2_0(){
  this.name_0 = 'DOTTED';
  this.ordinal = 1;
}

function Style$BorderStyle$2(){
}

_ = Style$BorderStyle$2_0.prototype = Style$BorderStyle$2.prototype = new Style$BorderStyle;
_.getClass$ = function getClass_19(){
  return Lcom_google_gwt_dom_client_Style$BorderStyle$2_2_classLit;
}
;
_.castableTypeMap$ = {42:1, 45:1, 58:1, 61:1, 62:1};
function Style$BorderStyle$3_0(){
  this.name_0 = 'DASHED';
  this.ordinal = 2;
}

function Style$BorderStyle$3(){
}

_ = Style$BorderStyle$3_0.prototype = Style$BorderStyle$3.prototype = new Style$BorderStyle;
_.getClass$ = function getClass_20(){
  return Lcom_google_gwt_dom_client_Style$BorderStyle$3_2_classLit;
}
;
_.castableTypeMap$ = {42:1, 45:1, 58:1, 61:1, 62:1};
function Style$BorderStyle$4_0(){
  this.name_0 = 'HIDDEN';
  this.ordinal = 3;
}

function Style$BorderStyle$4(){
}

_ = Style$BorderStyle$4_0.prototype = Style$BorderStyle$4.prototype = new Style$BorderStyle;
_.getClass$ = function getClass_21(){
  return Lcom_google_gwt_dom_client_Style$BorderStyle$4_2_classLit;
}
;
_.castableTypeMap$ = {42:1, 45:1, 58:1, 61:1, 62:1};
--></script>
<script><!--
function Style$BorderStyle$5_0(){
  this.name_0 = 'SOLID';
  this.ordinal = 4;
}

function Style$BorderStyle$5(){
}

_ = Style$BorderStyle$5_0.prototype = Style$BorderStyle$5.prototype = new Style$BorderStyle;
_.getClass$ = function getClass_22(){
  return Lcom_google_gwt_dom_client_Style$BorderStyle$5_2_classLit;
}
;
_.castableTypeMap$ = {42:1, 45:1, 58:1, 61:1, 62:1};
function $clinit_47(){
  $clinit_47 = nullMethod;
  NONE_0 = new Style$Display$1_0;
  BLOCK = new Style$Display$2_0;
  INLINE = new Style$Display$3_0;
  INLINE_BLOCK = new Style$Display$4_0;
  $VALUES_0 = initValues(_3Lcom_google_gwt_dom_client_Style$Display_2_classLit, {58:1, 138:1}, 43, [NONE_0, BLOCK, INLINE, INLINE_BLOCK]);
}

function values_1(){
  $clinit_47();
  return $VALUES_0;
}

function Style$Display(){
}

_ = Style$Display.prototype = new Enum;
_.getClass$ = function getClass_23(){
  return Lcom_google_gwt_dom_client_Style$Display_2_classLit;
}
;
_.castableTypeMap$ = {43:1, 45:1, 58:1, 61:1, 62:1};
var $VALUES_0, BLOCK, INLINE, INLINE_BLOCK, NONE_0;
function Style$Display$1_0(){
  this.name_0 = 'NONE';
  this.ordinal = 0;
}

function Style$Display$1(){
}

_ = Style$Display$1_0.prototype = Style$Display$1.prototype = new Style$Display;
_.getClass$ = function getClass_24(){
  return Lcom_google_gwt_dom_client_Style$Display$1_2_classLit;
}
;
_.castableTypeMap$ = {43:1, 45:1, 58:1, 61:1, 62:1};
function Style$Display$2_0(){
  this.name_0 = 'BLOCK';
  this.ordinal = 1;
}

function Style$Display$2(){
}

_ = Style$Display$2_0.prototype = Style$Display$2.prototype = new Style$Display;
_.getClass$ = function getClass_25(){
  return Lcom_google_gwt_dom_client_Style$Display$2_2_classLit;
}
;
_.castableTypeMap$ = {43:1, 45:1, 58:1, 61:1, 62:1};
function Style$Display$3_0(){
  this.name_0 = 'INLINE';
  this.ordinal = 2;
}

function Style$Display$3(){
}

_ = Style$Display$3_0.prototype = Style$Display$3.prototype = new Style$Display;
_.getClass$ = function getClass_26(){
  return Lcom_google_gwt_dom_client_Style$Display$3_2_classLit;
}
;
_.castableTypeMap$ = {43:1, 45:1, 58:1, 61:1, 62:1};
function Style$Display$4_0(){
  this.name_0 = 'INLINE_BLOCK';
  this.ordinal = 3;
}

function Style$Display$4(){
}

_ = Style$Display$4_0.prototype = Style$Display$4.prototype = new Style$Display;
_.getClass$ = function getClass_27(){
  return Lcom_google_gwt_dom_client_Style$Display$4_2_classLit;
}
;
_.castableTypeMap$ = {43:1, 45:1, 58:1, 61:1, 62:1};
function $clinit_52(){
  $clinit_52 = nullMethod;
  NORMAL = new Style$FontWeight$1_0;
  BOLD = new Style$FontWeight$2_0;
  BOLDER = new Style$FontWeight$3_0;
  LIGHTER = new Style$FontWeight$4_0;
  $VALUES_1 = initValues(_3Lcom_google_gwt_dom_client_Style$FontWeight_2_classLit, {58:1, 138:1}, 44, [NORMAL, BOLD, BOLDER, LIGHTER]);
}

function values_2(){
  $clinit_52();
  return $VALUES_1;
}

function Style$FontWeight(){
}

_ = Style$FontWeight.prototype = new Enum;
_.getClass$ = function getClass_28(){
  return Lcom_google_gwt_dom_client_Style$FontWeight_2_classLit;
}
;
_.castableTypeMap$ = {44:1, 45:1, 58:1, 61:1, 62:1};
var $VALUES_1, BOLD, BOLDER, LIGHTER, NORMAL;
function Style$FontWeight$1_0(){
  this.name_0 = 'NORMAL';
  this.ordinal = 0;
}

function Style$FontWeight$1(){
}

_ = Style$FontWeight$1_0.prototype = Style$FontWeight$1.prototype = new Style$FontWeight;
_.getClass$ = function getClass_29(){
  return Lcom_google_gwt_dom_client_Style$FontWeight$1_2_classLit;
}
;
_.castableTypeMap$ = {44:1, 45:1, 58:1, 61:1, 62:1};
function Style$FontWeight$2_0(){
  this.name_0 = 'BOLD';
  this.ordinal = 1;
}

function Style$FontWeight$2(){
}

_ = Style$FontWeight$2_0.prototype = Style$FontWeight$2.prototype = new Style$FontWeight;
_.getClass$ = function getClass_30(){
  return Lcom_google_gwt_dom_client_Style$FontWeight$2_2_classLit;
}
;
_.castableTypeMap$ = {44:1, 45:1, 58:1, 61:1, 62:1};
function Style$FontWeight$3_0(){
  this.name_0 = 'BOLDER';
  this.ordinal = 2;
}

function Style$FontWeight$3(){
}

_ = Style$FontWeight$3_0.prototype = Style$FontWeight$3.prototype = new Style$FontWeight;
_.getClass$ = function getClass_31(){
  return Lcom_google_gwt_dom_client_Style$FontWeight$3_2_classLit;
}
;
_.castableTypeMap$ = {44:1, 45:1, 58:1, 61:1, 62:1};
function Style$FontWeight$4_0(){
  this.name_0 = 'LIGHTER';
  this.ordinal = 3;
}

function Style$FontWeight$4(){
}

_ = Style$FontWeight$4_0.prototype = Style$FontWeight$4.prototype = new Style$FontWeight;
_.getClass$ = function getClass_32(){
  return Lcom_google_gwt_dom_client_Style$FontWeight$4_2_classLit;
}
;
_.castableTypeMap$ = {44:1, 45:1, 58:1, 61:1, 62:1};
function $clinit_58(){
  $clinit_58 = nullMethod;
  VISIBLE = new Style$Overflow$1_0;
  HIDDEN_0 = new Style$Overflow$2_0;
  SCROLL = new Style$Overflow$3_0;
  AUTO = new Style$Overflow$4_0;
  $VALUES_2 = initValues(_3Lcom_google_gwt_dom_client_Style$Overflow_2_classLit, {58:1, 138:1}, 46, [VISIBLE, HIDDEN_0, SCROLL, AUTO]);
}

function values_3(){
  $clinit_58();
  return $VALUES_2;
}

function Style$Overflow(){
}

_ = Style$Overflow.prototype = new Enum;
_.getClass$ = function getClass_33(){
  return Lcom_google_gwt_dom_client_Style$Overflow_2_classLit;
}
;
_.castableTypeMap$ = {45:1, 46:1, 58:1, 61:1, 62:1};
var $VALUES_2, AUTO, HIDDEN_0, SCROLL, VISIBLE;
function Style$Overflow$1_0(){
  this.name_0 = 'VISIBLE';
  this.ordinal = 0;
}

function Style$Overflow$1(){
}

_ = Style$Overflow$1_0.prototype = Style$Overflow$1.prototype = new Style$Overflow;
_.getClass$ = function getClass_34(){
  return Lcom_google_gwt_dom_client_Style$Overflow$1_2_classLit;
}
;
_.castableTypeMap$ = {45:1, 46:1, 58:1, 61:1, 62:1};
function Style$Overflow$2_0(){
  this.name_0 = 'HIDDEN';
  this.ordinal = 1;
}

function Style$Overflow$2(){
}

_ = Style$Overflow$2_0.prototype = Style$Overflow$2.prototype = new Style$Overflow;
_.getClass$ = function getClass_35(){
  return Lcom_google_gwt_dom_client_Style$Overflow$2_2_classLit;
}
;
_.castableTypeMap$ = {45:1, 46:1, 58:1, 61:1, 62:1};
function Style$Overflow$3_0(){
  this.name_0 = 'SCROLL';
  this.ordinal = 2;
}

function Style$Overflow$3(){
}

_ = Style$Overflow$3_0.prototype = Style$Overflow$3.prototype = new Style$Overflow;
_.getClass$ = function getClass_36(){
  return Lcom_google_gwt_dom_client_Style$Overflow$3_2_classLit;
}
;
_.castableTypeMap$ = {45:1, 46:1, 58:1, 61:1, 62:1};
function Style$Overflow$4_0(){
  this.name_0 = 'AUTO';
  this.ordinal = 3;
}

function Style$Overflow$4(){
}

_ = Style$Overflow$4_0.prototype = Style$Overflow$4.prototype = new Style$Overflow;
_.getClass$ = function getClass_37(){
  return Lcom_google_gwt_dom_client_Style$Overflow$4_2_classLit;
}
;
_.castableTypeMap$ = {45:1, 46:1, 58:1, 61:1, 62:1};
function $clinit_63(){
  $clinit_63 = nullMethod;
  STATIC = new Style$Position$1_0;
  RELATIVE = new Style$Position$2_0;
  ABSOLUTE = new Style$Position$3_0;
  FIXED = new Style$Position$4_0;
  $VALUES_3 = initValues(_3Lcom_google_gwt_dom_client_Style$Position_2_classLit, {58:1, 138:1}, 47, [STATIC, RELATIVE, ABSOLUTE, FIXED]);
}

function values_4(){
  $clinit_63();
  return $VALUES_3;
}

function Style$Position(){
}

_ = Style$Position.prototype = new Enum;
_.getClass$ = function getClass_38(){
  return Lcom_google_gwt_dom_client_Style$Position_2_classLit;
}
;
_.castableTypeMap$ = {45:1, 47:1, 58:1, 61:1, 62:1};
var $VALUES_3, ABSOLUTE, FIXED, RELATIVE, STATIC;
function Style$Position$1_0(){
  this.name_0 = 'STATIC';
  this.ordinal = 0;
}

function Style$Position$1(){
}

_ = Style$Position$1_0.prototype = Style$Position$1.prototype = new Style$Position;
_.getClass$ = function getClass_39(){
  return Lcom_google_gwt_dom_client_Style$Position$1_2_classLit;
}
;
_.castableTypeMap$ = {45:1, 47:1, 58:1, 61:1, 62:1};
function Style$Position$2_0(){
  this.name_0 = 'RELATIVE';
  this.ordinal = 1;
}

function Style$Position$2(){
}

_ = Style$Position$2_0.prototype = Style$Position$2.prototype = new Style$Position;
_.getClass$ = function getClass_40(){
  return Lcom_google_gwt_dom_client_Style$Position$2_2_classLit;
}
;
_.castableTypeMap$ = {45:1, 47:1, 58:1, 61:1, 62:1};
function Style$Position$3_0(){
  this.name_0 = 'ABSOLUTE';
  this.ordinal = 2;
}

function Style$Position$3(){
}

_ = Style$Position$3_0.prototype = Style$Position$3.prototype = new Style$Position;
_.getClass$ = function getClass_41(){
  return Lcom_google_gwt_dom_client_Style$Position$3_2_classLit;
}
;
_.castableTypeMap$ = {45:1, 47:1, 58:1, 61:1, 62:1};
function Style$Position$4_0(){
  this.name_0 = 'FIXED';
  this.ordinal = 3;
}

function Style$Position$4(){
}

_ = Style$Position$4_0.prototype = Style$Position$4.prototype = new Style$Position;
_.getClass$ = function getClass_42(){
  return Lcom_google_gwt_dom_client_Style$Position$4_2_classLit;
}
;
_.castableTypeMap$ = {45:1, 47:1, 58:1, 61:1, 62:1};
function $clinit_68(){
  $clinit_68 = nullMethod;
  PX = new Style$Unit$1_0;
  PCT = new Style$Unit$2_0;
  EM = new Style$Unit$3_0;
  EX = new Style$Unit$4_0;
  PT = new Style$Unit$5_0;
  PC = new Style$Unit$6_0;
  IN = new Style$Unit$7_0;
  CM = new Style$Unit$8_0;
  MM = new Style$Unit$9_0;
  $VALUES_4 = initValues(_3Lcom_google_gwt_dom_client_Style$Unit_2_classLit, {58:1, 138:1}, 48, [PX, PCT, EM, EX, PT, PC, IN, CM, MM]);
}

function values_5(){
  $clinit_68();
  return $VALUES_4;
}

function Style$Unit(){
}

_ = Style$Unit.prototype = new Enum;
_.getClass$ = function getClass_43(){
  return Lcom_google_gwt_dom_client_Style$Unit_2_classLit;
}
;
_.castableTypeMap$ = {48:1, 58:1, 61:1, 62:1};
var $VALUES_4, CM, EM, EX, IN, MM, PC, PCT, PT, PX;
function Style$Unit$1_0(){
  this.name_0 = 'PX';
  this.ordinal = 0;
}

function Style$Unit$1(){
}

_ = Style$Unit$1_0.prototype = Style$Unit$1.prototype = new Style$Unit;
_.getClass$ = function getClass_44(){
  return Lcom_google_gwt_dom_client_Style$Unit$1_2_classLit;
}
;
_.castableTypeMap$ = {48:1, 58:1, 61:1, 62:1};
function Style$Unit$2_0(){
  this.name_0 = 'PCT';
  this.ordinal = 1;
}

function Style$Unit$2(){
}

_ = Style$Unit$2_0.prototype = Style$Unit$2.prototype = new Style$Unit;
_.getClass$ = function getClass_45(){
  return Lcom_google_gwt_dom_client_Style$Unit$2_2_classLit;
}
;
_.castableTypeMap$ = {48:1, 58:1, 61:1, 62:1};
function Style$Unit$3_0(){
  this.name_0 = 'EM';
  this.ordinal = 2;
}

function Style$Unit$3(){
}

_ = Style$Unit$3_0.prototype = Style$Unit$3.prototype = new Style$Unit;
_.getClass$ = function getClass_46(){
  return Lcom_google_gwt_dom_client_Style$Unit$3_2_classLit;
}
;
_.castableTypeMap$ = {48:1, 58:1, 61:1, 62:1};
function Style$Unit$4_0(){
  this.name_0 = 'EX';
  this.ordinal = 3;
}

function Style$Unit$4(){
}

_ = Style$Unit$4_0.prototype = Style$Unit$4.prototype = new Style$Unit;
_.getClass$ = function getClass_47(){
  return Lcom_google_gwt_dom_client_Style$Unit$4_2_classLit;
}
;
_.castableTypeMap$ = {48:1, 58:1, 61:1, 62:1};
function Style$Unit$5_0(){
  this.name_0 = 'PT';
  this.ordinal = 4;
}

function Style$Unit$5(){
}

_ = Style$Unit$5_0.prototype = Style$Unit$5.prototype = new Style$Unit;
_.getClass$ = function getClass_48(){
  return Lcom_google_gwt_dom_client_Style$Unit$5_2_classLit;
}
;
_.castableTypeMap$ = {48:1, 58:1, 61:1, 62:1};
function Style$Unit$6_0(){
  this.name_0 = 'PC';
  this.ordinal = 5;
}

function Style$Unit$6(){
}

_ = Style$Unit$6_0.prototype = Style$Unit$6.prototype = new Style$Unit;
_.getClass$ = function getClass_49(){
  return Lcom_google_gwt_dom_client_Style$Unit$6_2_classLit;
}
;
_.castableTypeMap$ = {48:1, 58:1, 61:1, 62:1};
function Style$Unit$7_0(){
  this.name_0 = 'IN';
  this.ordinal = 6;
}

function Style$Unit$7(){
}

_ = Style$Unit$7_0.prototype = Style$Unit$7.prototype = new Style$Unit;
_.getClass$ = function getClass_50(){
  return Lcom_google_gwt_dom_client_Style$Unit$7_2_classLit;
}
;
_.castableTypeMap$ = {48:1, 58:1, 61:1, 62:1};
function Style$Unit$8_0(){
  this.name_0 = 'CM';
  this.ordinal = 7;
}

function Style$Unit$8(){
}

_ = Style$Unit$8_0.prototype = Style$Unit$8.prototype = new Style$Unit;
_.getClass$ = function getClass_51(){
  return Lcom_google_gwt_dom_client_Style$Unit$8_2_classLit;
}
;
_.castableTypeMap$ = {48:1, 58:1, 61:1, 62:1};
function Style$Unit$9_0(){
  this.name_0 = 'MM';
  this.ordinal = 8;
}

function Style$Unit$9(){
}

_ = Style$Unit$9_0.prototype = Style$Unit$9.prototype = new Style$Unit;
_.getClass$ = function getClass_52(){
  return Lcom_google_gwt_dom_client_Style$Unit$9_2_classLit;
}
;
_.castableTypeMap$ = {48:1, 58:1, 61:1, 62:1};
function $clinit_78(){
  $clinit_78 = nullMethod;
  VISIBLE_0 = new Style$Visibility$1_0;
  HIDDEN_1 = new Style$Visibility$2_0;
  $VALUES_5 = initValues(_3Lcom_google_gwt_dom_client_Style$Visibility_2_classLit, {58:1, 138:1}, 49, [VISIBLE_0, HIDDEN_1]);
}

function values_6(){
  $clinit_78();
  return $VALUES_5;
}

function Style$Visibility(){
}

_ = Style$Visibility.prototype = new Enum;
_.getClass$ = function getClass_53(){
  return Lcom_google_gwt_dom_client_Style$Visibility_2_classLit;
}
;
_.castableTypeMap$ = {45:1, 49:1, 58:1, 61:1, 62:1};
var $VALUES_5, HIDDEN_1, VISIBLE_0;
function Style$Visibility$1_0(){
  this.name_0 = 'VISIBLE';
  this.ordinal = 0;
}

function Style$Visibility$1(){
}

_ = Style$Visibility$1_0.prototype = Style$Visibility$1.prototype = new Style$Visibility;
_.getClass$ = function getClass_54(){
  return Lcom_google_gwt_dom_client_Style$Visibility$1_2_classLit;
}
;
_.castableTypeMap$ = {45:1, 49:1, 58:1, 61:1, 62:1};
function Style$Visibility$2_0(){
  this.name_0 = 'HIDDEN';
  this.ordinal = 1;
}

function Style$Visibility$2(){
}

_ = Style$Visibility$2_0.prototype = Style$Visibility$2.prototype = new Style$Visibility;
_.getClass$ = function getClass_55(){
  return Lcom_google_gwt_dom_client_Style$Visibility$2_2_classLit;
}
;
_.castableTypeMap$ = {45:1, 49:1, 58:1, 61:1, 62:1};
function $clinit_81(){
  $clinit_81 = nullMethod;
  toInject = [];
  toInjectAtEnd = [];
  toInjectAtStart = [];
  flusher = new StyleInjector$1_0;
}

function flush(){
  $clinit_81();
  var css, maybeReturn, toReturn;
  toReturn = null;
  if (toInjectAtStart.length != 0) {
    css = toInjectAtStart.join('');
    maybeReturn = $injectStyleSheetAtStart(($clinit_83() , IMPL), css);
    !toInjectAtStart && (toReturn = maybeReturn);
    toInjectAtStart.length = 0;
  }
  if (toInject.length != 0) {
    css = toInject.join('');
    maybeReturn = $injectStyleSheet(($clinit_83() , IMPL), css);
    !toInject && (toReturn = maybeReturn);
    toInject.length = 0;
  }
  if (toInjectAtEnd.length != 0) {
    css = toInjectAtEnd.join('');
    maybeReturn = $injectStyleSheet(($clinit_83() , IMPL), css);
    !toInjectAtEnd && (toReturn = maybeReturn);
    toInjectAtEnd.length = 0;
  }
  needsInjection = false;
  return toReturn;
}

function schedule(){
  if (!needsInjection) {
    needsInjection = true;
    $scheduleFinally(($clinit_18() , INSTANCE), flusher);
  }
}

var flusher, needsInjection = false, toInject, toInjectAtEnd, toInjectAtStart;
function StyleInjector$1_0(){
}

function StyleInjector$1(){
}

_ = StyleInjector$1_0.prototype = StyleInjector$1.prototype = new Object_0;
_.execute = function execute(){
  ($clinit_81() , needsInjection) && flush();
}
;
_.getClass$ = function getClass_56(){
  return Lcom_google_gwt_dom_client_StyleInjector$1_2_classLit;
}
;
_.castableTypeMap$ = {28:1};
function $clinit_83(){
  $clinit_83 = nullMethod;
  IMPL = new StyleInjector$StyleInjectorImpl_0;
}

function $createElement_0(contents){
  var style;
  style = $doc.createElement('style');
  style['language'] = 'text/css';
  style.textContent = contents || '';
  return style;
}

function $getHead(this$static){
  var elt;
  if (!this$static.head) {
    elt = $doc.getElementsByTagName('head')[0];
    this$static.head = elt;
  }
  return this$static.head;
}

function $injectStyleSheet(this$static, contents){
  var style;
  style = $createElement_0(contents);
  $getHead(this$static).appendChild(style);
  return style;
}

function $injectStyleSheetAtStart(this$static, contents){
  var style;
  style = $createElement_0(contents);
  $getHead(this$static).insertBefore(style, this$static.head.firstChild);
  return style;
}

function StyleInjector$StyleInjectorImpl_0(){
}

function StyleInjector$StyleInjectorImpl(){
}

_ = StyleInjector$StyleInjectorImpl_0.prototype = StyleInjector$StyleInjectorImpl.prototype = new Object_0;
_.getClass$ = function getClass_57(){
  return Lcom_google_gwt_dom_client_StyleInjector$StyleInjectorImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.head = null;
var IMPL;
function $setData(this$static, data){
  this$static.data = data;
}

function GwtEvent(){
}

_ = GwtEvent.prototype = new Object_0;
_.getClass$ = function getClass_58(){
  return Lcom_google_gwt_event_shared_GwtEvent_2_classLit;
}
;
_.revive = function revive(){
  this.dead = false;
  this.source = null;
}
;
_.toString$ = function toString_4(){
  return 'An event type';
}
;
_.castableTypeMap$ = {};
_.dead = false;
_.source = null;
function fireNativeEvent(nativeEvent, handlerSource, relativeElem){
  var currentNative, currentRelativeElem, typeKey;
  if (registered) {
    typeKey = dynamicCast(registered.map[nativeEvent.type], 9);
    if (typeKey) {
      currentNative = typeKey.flyweight.nativeEvent;
      currentRelativeElem = typeKey.flyweight.relativeElem;
      typeKey.flyweight.nativeEvent = nativeEvent;
      typeKey.flyweight.relativeElem = relativeElem;
      $fireEvent_1(handlerSource, typeKey.flyweight);
      typeKey.flyweight.nativeEvent = currentNative;
      typeKey.flyweight.relativeElem = currentRelativeElem;
    }
  }
}

function DomEvent(){
}

_ = DomEvent.prototype = new GwtEvent;
_.getAssociatedType = function getAssociatedType(){
  return this.getAssociatedType_0();
}
;
_.getClass$ = function getClass_59(){
  return Lcom_google_gwt_event_dom_client_DomEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
_.nativeEvent = null;
_.relativeElem = null;
var registered = null;
function $clinit_89(){
  $clinit_89 = nullMethod;
  TYPE = new DomEvent$Type_0('blur', new BlurEvent_0);
}

function BlurEvent_0(){
}

function BlurEvent(){
}

_ = BlurEvent_0.prototype = BlurEvent.prototype = new DomEvent;
_.dispatch = function dispatch(handler){
  $selectItem(dynamicCast(dynamicCast(handler, 5), 6).this$0, null);
}
;
_.getAssociatedType_0 = function getAssociatedType_0(){
  return TYPE;
}
;
_.getClass$ = function getClass_60(){
  return Lcom_google_gwt_event_dom_client_BlurEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
var TYPE;
function $clinit_91(){
  $clinit_91 = nullMethod;
  TYPE_0 = new DomEvent$Type_0('change', new ChangeEvent_0);
}

function ChangeEvent_0(){
}

function ChangeEvent(){
}

_ = ChangeEvent_0.prototype = ChangeEvent.prototype = new DomEvent;
_.dispatch = function dispatch_0(handler){
  dynamicCast(handler, 7).onChange(this);
}
;
_.getAssociatedType_0 = function getAssociatedType_1(){
  return TYPE_0;
}
;
_.getClass$ = function getClass_61(){
  return Lcom_google_gwt_event_dom_client_ChangeEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
var TYPE_0;
function MouseEvent_0(){
}

_ = MouseEvent_0.prototype = new DomEvent;
_.getClass$ = function getClass_62(){
  return Lcom_google_gwt_event_dom_client_MouseEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_94(){
  $clinit_94 = nullMethod;
  TYPE_1 = new DomEvent$Type_0('click', new ClickEvent_0);
}

function ClickEvent_0(){
}

function ClickEvent(){
}

_ = ClickEvent_0.prototype = ClickEvent.prototype = new MouseEvent_0;
_.dispatch = function dispatch_1(handler){
  dynamicCast(handler, 8).onClick(this);
}
;
_.getAssociatedType_0 = function getAssociatedType_2(){
  return TYPE_1;
}
;
_.getClass$ = function getClass_63(){
  return Lcom_google_gwt_event_dom_client_ClickEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
var TYPE_1;
function GwtEvent$Type_0(){
  this.index_0 = ++nextHashCode;
}

function GwtEvent$Type(){
}

_ = GwtEvent$Type_0.prototype = GwtEvent$Type.prototype = new Object_0;
_.getClass$ = function getClass_64(){
  return Lcom_google_gwt_event_shared_GwtEvent$Type_2_classLit;
}
;
_.hashCode$ = function hashCode_3(){
  return this.index_0;
}
;
_.toString$ = function toString_5(){
  return 'Event type';
}
;
_.castableTypeMap$ = {};
_.index_0 = 0;
var nextHashCode = 0;
function DomEvent$Type_0(eventName, flyweight){
  this.index_0 = ++nextHashCode;
  this.flyweight = flyweight;
  !registered && (registered = new PrivateMap_0);
  registered.map[eventName] = this;
  this.name_0 = eventName;
}

function DomEvent$Type(){
}

_ = DomEvent$Type_0.prototype = DomEvent$Type.prototype = new GwtEvent$Type;
_.getClass$ = function getClass_65(){
  return Lcom_google_gwt_event_dom_client_DomEvent$Type_2_classLit;
}
;
_.castableTypeMap$ = {9:1};
_.flyweight = null;
_.name_0 = null;
function $clinit_98(){
  $clinit_98 = nullMethod;
  TYPE_2 = new DomEvent$Type_0('error', new ErrorEvent_0);
}

function ErrorEvent_0(){
}

function ErrorEvent(){
}

_ = ErrorEvent_0.prototype = ErrorEvent.prototype = new DomEvent;
_.dispatch = function dispatch_2(handler){
  $onError(dynamicCast(handler, 10));
}
;
_.getAssociatedType_0 = function getAssociatedType_3(){
  return TYPE_2;
}
;
_.getClass$ = function getClass_66(){
  return Lcom_google_gwt_event_dom_client_ErrorEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
var TYPE_2;
function $addKeyHandlersTo(this$static, source){
  $addDomHandler(source, this$static, ($clinit_123() , $clinit_123() , TYPE_3));
  $addDomHandler(source, this$static, ($clinit_125() , $clinit_125() , TYPE_4));
  $addDomHandler(source, this$static, ($clinit_127() , $clinit_127() , TYPE_5));
}

function HandlesAllKeyEvents(){
}

_ = HandlesAllKeyEvents.prototype = new Object_0;
_.getClass$ = function getClass_67(){
  return Lcom_google_gwt_event_dom_client_HandlesAllKeyEvents_2_classLit;
}
;
_.castableTypeMap$ = {11:1, 12:1, 13:1, 25:1};
function KeyEvent_0(){
}

_ = KeyEvent_0.prototype = new DomEvent;
_.getClass$ = function getClass_68(){
  return Lcom_google_gwt_event_dom_client_KeyEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
function KeyCodeEvent(){
}

_ = KeyCodeEvent.prototype = new KeyEvent_0;
_.getClass$ = function getClass_69(){
  return Lcom_google_gwt_event_dom_client_KeyCodeEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_123(){
  $clinit_123 = nullMethod;
  TYPE_3 = new DomEvent$Type_0('keydown', new KeyDownEvent_0);
}

function KeyDownEvent_0(){
}

function KeyDownEvent(){
}

_ = KeyDownEvent_0.prototype = KeyDownEvent.prototype = new KeyCodeEvent;
_.dispatch = function dispatch_3(handler){
  $onKeyDown(dynamicCast(handler, 11), this);
}
;
_.getAssociatedType_0 = function getAssociatedType_4(){
  return TYPE_3;
}
;
_.getClass$ = function getClass_70(){
  return Lcom_google_gwt_event_dom_client_KeyDownEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
var TYPE_3;
function $clinit_125(){
  $clinit_125 = nullMethod;
  TYPE_4 = new DomEvent$Type_0('keypress', new KeyPressEvent_0);
}

function KeyPressEvent_0(){
}

function KeyPressEvent(){
}

_ = KeyPressEvent_0.prototype = KeyPressEvent.prototype = new KeyEvent_0;
_.dispatch = function dispatch_4(handler){
  $delegateEvent(dynamicCast(handler, 12).this$0, this);
}
;
_.getAssociatedType_0 = function getAssociatedType_5(){
  return TYPE_4;
}
;
_.getClass$ = function getClass_71(){
  return Lcom_google_gwt_event_dom_client_KeyPressEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
var TYPE_4;
function $clinit_127(){
  $clinit_127 = nullMethod;
  TYPE_5 = new DomEvent$Type_0('keyup', new KeyUpEvent_0);
}

function KeyUpEvent_0(){
}

function KeyUpEvent(){
}

_ = KeyUpEvent_0.prototype = KeyUpEvent.prototype = new KeyCodeEvent;
_.dispatch = function dispatch_5(handler){
  dynamicCast(handler, 13).onKeyUp(this);
}
;
_.getAssociatedType_0 = function getAssociatedType_6(){
  return TYPE_5;
}
;
_.getClass$ = function getClass_72(){
  return Lcom_google_gwt_event_dom_client_KeyUpEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
var TYPE_5;
function $clinit_129(){
  $clinit_129 = nullMethod;
  TYPE_6 = new DomEvent$Type_0('load', new LoadEvent_0);
}

function LoadEvent_0(){
}

function LoadEvent(){
}

_ = LoadEvent_0.prototype = LoadEvent.prototype = new DomEvent;
_.dispatch = function dispatch_6(handler){
  $onLoad_1(dynamicCast(handler, 14));
}
;
_.getAssociatedType_0 = function getAssociatedType_7(){
  return TYPE_6;
}
;
_.getClass$ = function getClass_73(){
  return Lcom_google_gwt_event_dom_client_LoadEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
var TYPE_6;
function $clinit_131(){
  $clinit_131 = nullMethod;
  TYPE_7 = new DomEvent$Type_0('mousedown', new MouseDownEvent_0);
}

function MouseDownEvent_0(){
}

function MouseDownEvent(){
}

_ = MouseDownEvent_0.prototype = MouseDownEvent.prototype = new MouseEvent_0;
_.dispatch = function dispatch_7(handler){
  dynamicCast(dynamicCast(handler, 15), 16).mouseListener.onMouseDown();
}
;
_.getAssociatedType_0 = function getAssociatedType_8(){
  return TYPE_7;
}
;
_.getClass$ = function getClass_74(){
  return Lcom_google_gwt_event_dom_client_MouseDownEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
var TYPE_7;
function $clinit_133(){
  $clinit_133 = nullMethod;
  TYPE_8 = new DomEvent$Type_0('mouseout', new MouseOutEvent_0);
}

function MouseOutEvent_0(){
}

function MouseOutEvent(){
}

_ = MouseOutEvent_0.prototype = MouseOutEvent.prototype = new MouseEvent_0;
_.dispatch = function dispatch_8(handler){
  dynamicCast(handler, 17).onMouseOut(this);
}
;
_.getAssociatedType_0 = function getAssociatedType_9(){
  return TYPE_8;
}
;
_.getClass$ = function getClass_75(){
  return Lcom_google_gwt_event_dom_client_MouseOutEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
var TYPE_8;
function $clinit_135(){
  $clinit_135 = nullMethod;
  TYPE_9 = new DomEvent$Type_0('mouseover', new MouseOverEvent_0);
}

function MouseOverEvent_0(){
}

function MouseOverEvent(){
}

_ = MouseOverEvent_0.prototype = MouseOverEvent.prototype = new MouseEvent_0;
_.dispatch = function dispatch_9(handler){
  dynamicCast(handler, 18).onMouseOver(this);
}
;
_.getAssociatedType_0 = function getAssociatedType_10(){
  return TYPE_9;
}
;
_.getClass$ = function getClass_76(){
  return Lcom_google_gwt_event_dom_client_MouseOverEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
var TYPE_9;
function $clinit_137(){
  $clinit_137 = nullMethod;
  TYPE_10 = new DomEvent$Type_0('mouseup', new MouseUpEvent_0);
}

function MouseUpEvent_0(){
}

function MouseUpEvent(){
}

_ = MouseUpEvent_0.prototype = MouseUpEvent.prototype = new MouseEvent_0;
_.dispatch = function dispatch_10(handler){
  dynamicCast(dynamicCast(handler, 19), 16).mouseListener.onMouseUp();
}
;
_.getAssociatedType_0 = function getAssociatedType_11(){
  return TYPE_10;
}
;
_.getClass$ = function getClass_77(){
  return Lcom_google_gwt_event_dom_client_MouseUpEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
var TYPE_10;
function PrivateMap_0(){
  this.map = {};
}

function PrivateMap(){
}

_ = PrivateMap_0.prototype = PrivateMap.prototype = new Object_0;
_.getClass$ = function getClass_78(){
  return Lcom_google_gwt_event_dom_client_PrivateMap_2_classLit;
}
;
_.castableTypeMap$ = {};
_.map = null;
function CloseEvent_0(autoClosed){
  this.autoClosed = autoClosed;
}

function fire_0(source, autoClosed){
  var event_0;
  if (TYPE_11) {
    event_0 = new CloseEvent_0(autoClosed);
    source.fireEvent(event_0);
  }
}

function CloseEvent(){
}

_ = CloseEvent_0.prototype = CloseEvent.prototype = new GwtEvent;
_.dispatch = function dispatch_11(handler){
  dynamicCast(handler, 20).onClose(this);
}
;
_.getAssociatedType = function getAssociatedType_12(){
  return TYPE_11;
}
;
_.getClass$ = function getClass_79(){
  return Lcom_google_gwt_event_logical_shared_CloseEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
_.autoClosed = false;
var TYPE_11 = null;
function $dispatch_7(){
  $onResize();
}

function ResizeEvent_0(){
}

function fire_1(source){
  var event_0;
  if (TYPE_12) {
    event_0 = new ResizeEvent_0;
    $fireEvent(source, event_0);
  }
}

function ResizeEvent(){
}

_ = ResizeEvent_0.prototype = ResizeEvent.prototype = new GwtEvent;
_.dispatch = function dispatch_12(handler){
  $dispatch_7(dynamicCast(handler, 21));
}
;
_.getAssociatedType = function getAssociatedType_13(){
  return TYPE_12;
}
;
_.getClass$ = function getClass_80(){
  return Lcom_google_gwt_event_logical_shared_ResizeEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
var TYPE_12 = null;
function SelectionEvent_0(){
}

function fire_2(source){
  var event_0;
  if (TYPE_13) {
    event_0 = new SelectionEvent_0;
    !!source.handlerManager && $fireEvent(source.handlerManager, event_0);
  }
}

function SelectionEvent(){
}

_ = SelectionEvent_0.prototype = SelectionEvent.prototype = new GwtEvent;
_.dispatch = function dispatch_13(handler){
  $setFromContentBox(dynamicCast(dynamicCast(handler, 22), 23).this$0);
}
;
_.getAssociatedType = function getAssociatedType_14(){
  return TYPE_13;
}
;
_.getClass$ = function getClass_81(){
  return Lcom_google_gwt_event_logical_shared_SelectionEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
var TYPE_13 = null;
function ValueChangeEvent_0(value){
  this.value_0 = value;
}

function fire_3(source, value){
  var event_0;
  if (TYPE_14) {
    event_0 = new ValueChangeEvent_0(value);
    source.fireEvent(event_0);
  }
}

function fireIfNotEqual(source, oldValue, newValue){
  var event_0;
  if (!!TYPE_14 && oldValue != newValue && (!oldValue || !(!!newValue && newValue.value_0 == oldValue.value_0))) {
    event_0 = new ValueChangeEvent_0(newValue);
    !!source.handlerManager && $fireEvent(source.handlerManager, event_0);
  }
}

function ValueChangeEvent(){
}

_ = ValueChangeEvent_0.prototype = ValueChangeEvent.prototype = new GwtEvent;
_.dispatch = function dispatch_14(handler){
  dynamicCast(handler, 24).onValueChange(this);
}
;
_.getAssociatedType = function getAssociatedType_15(){
  return TYPE_14;
}
;
_.getClass$ = function getClass_82(){
  return Lcom_google_gwt_event_logical_shared_ValueChangeEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
_.value_0 = null;
var TYPE_14 = null;
--></script>
<script><!--
function EventBus(){
}

_ = EventBus.prototype = new Object_0;
_.getClass$ = function getClass_83(){
  return Lcom_google_gwt_event_shared_EventBus_2_classLit;
}
;
_.castableTypeMap$ = {51:1};
function $fireEvent(this$static, event_0){
  var oldSource;
  !event_0.dead || event_0.revive();
  oldSource = event_0.source;
  event_0.source = this$static.source;
  try {
    $fireEvent_0(this$static.eventBus, event_0);
  }
   finally {
    oldSource == null?(event_0.dead = true , event_0.source = null):(event_0.source = oldSource);
  }
}

function HandlerManager_0(source){
  this.eventBus = new SimpleEventBus_0(false);
  this.source = source;
}

function HandlerManager_1(source, fireInReverseOrder){
  this.eventBus = new SimpleEventBus_0(fireInReverseOrder);
  this.source = source;
}

function HandlerManager(){
}

_ = HandlerManager_1.prototype = HandlerManager_0.prototype = HandlerManager.prototype = new Object_0;
_.fireEvent = function fireEvent(event_0){
  $fireEvent(this, event_0);
}
;
_.getClass$ = function getClass_84(){
  return Lcom_google_gwt_event_shared_HandlerManager_2_classLit;
}
;
_.castableTypeMap$ = {51:1};
_.eventBus = null;
_.source = null;
function $addHandler_0(this$static, type, handler){
  var l_0;
  if (!type) {
    throw new NullPointerException_1('Cannot add a handler with a null type');
  }
  if (!handler) {
    throw new NullPointerException_1('Cannot add a null handler');
  }
  return this$static.firingDepth > 0?$defer(this$static, new SimpleEventBus$2_0(this$static, type, handler)):(l_0 = $ensureHandlerList(this$static, type, null) , l_0.add_0(handler) , undefined) , new SimpleEventBus$1_0(this$static, type, handler);
}

function $defer(this$static, command){
  !this$static.deferredDeltas && (this$static.deferredDeltas = new ArrayList_0);
  $add_9(this$static.deferredDeltas, command);
}

function $doAddNow(this$static, type, source, handler){
  var l_0;
  l_0 = $ensureHandlerList(this$static, type, source);
  l_0.add_0(handler);
}

function $doFire(this$static, event_0){
  var $e0, causes, e, handler, handlers, it, old;
  try {
    ++this$static.firingDepth;
    handlers = $getHandlerList(this$static, event_0.getAssociatedType(), null);
    causes = null;
    it = this$static.isReverseOrder?handlers.listIterator_0(handlers.size_0()):handlers.listIterator();
    while (this$static.isReverseOrder?it.hasPrevious():it.hasNext()) {
      handler = this$static.isReverseOrder?dynamicCast(it.previous_0(), 25):dynamicCast(it.next_0(), 25);
      try {
        event_0.dispatch(handler);
      }
       catch ($e0) {
        $e0 = caught_0($e0);
        if (instanceOf($e0, 3)) {
          e = $e0;
          !causes && (causes = new HashSet_0);
          old = causes.map.put(e, causes);
        }
         else 
          throw $e0;
      }
    }
    if (causes) {
      throw new UmbrellaException_0(causes);
    }
  }
   finally {
    --this$static.firingDepth;
    this$static.firingDepth == 0 && $handleQueuedAddsAndRemoves(this$static);
  }
}

function $doRemove(this$static, type, source, handler){
  var l_0, removed;
  this$static.firingDepth > 0?$defer(this$static, new SimpleEventBus$3_0(this$static, type, source, handler)):(l_0 = $getHandlerList(this$static, type, source) , removed = l_0.remove_1(handler) , removed && l_0.isEmpty() && $prune(this$static, type, source) , undefined);
}

function $doRemoveNow(this$static, type, source, handler){
  var l_0, removed;
  l_0 = $getHandlerList(this$static, type, source);
  removed = l_0.remove_1(handler);
  removed && l_0.isEmpty() && $prune(this$static, type, source);
}

function $ensureHandlerList(this$static, type, source){
  var handlers, sourceMap;
  sourceMap = dynamicCast(this$static.map.get(type), 26);
  if (!sourceMap) {
    sourceMap = new HashMap_0;
    this$static.map.put(type, sourceMap);
  }
  handlers = dynamicCast(sourceMap.get(source), 27);
  if (!handlers) {
    handlers = new ArrayList_0;
    sourceMap.put(source, handlers);
  }
  return handlers;
}

function $fireEvent_0(this$static, event_0){
  if (!event_0) {
    throw new NullPointerException_1('Cannot fire null event');
  }
  $doFire(this$static, event_0);
}

function $getHandlerList(this$static, type, source){
  var handlers, sourceMap;
  sourceMap = dynamicCast(this$static.map.get(type), 26);
  if (!sourceMap) {
    return $clinit_430() , $clinit_430() , EMPTY_LIST;
  }
  handlers = dynamicCast(sourceMap.get(source), 27);
  if (!handlers) {
    return $clinit_430() , $clinit_430() , EMPTY_LIST;
  }
  return handlers;
}

function $handleQueuedAddsAndRemoves(this$static){
  var c, c$iterator;
  if (this$static.deferredDeltas) {
    try {
      for (c$iterator = new AbstractList$IteratorImpl_0(this$static.deferredDeltas); c$iterator.i < c$iterator.this$0_0.size_0();) {
        c = dynamicCast($next_6(c$iterator), 28);
        c.execute();
      }
    }
     finally {
      this$static.deferredDeltas = null;
    }
  }
}

function $prune(this$static, type, source){
  var sourceMap;
  sourceMap = dynamicCast(this$static.map.get(type), 26);
  dynamicCast(sourceMap.remove_2(source), 27);
  sourceMap.isEmpty() && this$static.map.remove_2(type);
}

function SimpleEventBus_0(fireInReverseOrder){
  this.map = new HashMap_0;
  this.isReverseOrder = fireInReverseOrder;
}

function SimpleEventBus(){
}

_ = SimpleEventBus_0.prototype = SimpleEventBus.prototype = new EventBus;
_.fireEvent = function fireEvent_0(event_0){
  $fireEvent_0(this, event_0);
}
;
_.getClass$ = function getClass_85(){
  return Lcom_google_gwt_event_shared_SimpleEventBus_2_classLit;
}
;
_.castableTypeMap$ = {51:1};
_.deferredDeltas = null;
_.firingDepth = 0;
_.isReverseOrder = false;
function $removeHandler(this$static){
  $doRemove(this$static.this$0, this$static.val$type, this$static.val$source, this$static.val$handler);
}

function SimpleEventBus$1_0(this$0, val$type, val$handler){
  this.this$0 = this$0;
  this.val$type = val$type;
  this.val$source = null;
  this.val$handler = val$handler;
}

function SimpleEventBus$1(){
}

_ = SimpleEventBus$1_0.prototype = SimpleEventBus$1.prototype = new Object_0;
_.getClass$ = function getClass_86(){
  return Lcom_google_gwt_event_shared_SimpleEventBus$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$handler = null;
_.val$source = null;
_.val$type = null;
function SimpleEventBus$2_0(this$0, val$type, val$handler){
  this.this$0 = this$0;
  this.val$type = val$type;
  this.val$source = null;
  this.val$handler = val$handler;
}

function SimpleEventBus$2(){
}

_ = SimpleEventBus$2_0.prototype = SimpleEventBus$2.prototype = new Object_0;
_.execute = function execute_0(){
  $doAddNow(this.this$0, this.val$type, this.val$source, this.val$handler);
}
;
_.getClass$ = function getClass_87(){
  return Lcom_google_gwt_event_shared_SimpleEventBus$2_2_classLit;
}
;
_.castableTypeMap$ = {28:1};
_.this$0 = null;
_.val$handler = null;
_.val$source = null;
_.val$type = null;
function SimpleEventBus$3_0(this$0, val$type, val$source, val$handler){
  this.this$0 = this$0;
  this.val$type = val$type;
  this.val$source = val$source;
  this.val$handler = val$handler;
}

function SimpleEventBus$3(){
}

_ = SimpleEventBus$3_0.prototype = SimpleEventBus$3.prototype = new Object_0;
_.execute = function execute_1(){
  $doRemoveNow(this.this$0, this.val$type, this.val$source, this.val$handler);
}
;
_.getClass$ = function getClass_88(){
  return Lcom_google_gwt_event_shared_SimpleEventBus$3_2_classLit;
}
;
_.castableTypeMap$ = {28:1};
_.this$0 = null;
_.val$handler = null;
_.val$source = null;
_.val$type = null;
function UmbrellaException_0(causes){
  RuntimeException_2.call(this, 'One or more exceptions caught, see full set in UmbrellaException#getCauses', causes.map.size_0() == 0?null:dynamicCast($toArray(causes, initDim(_3Ljava_lang_Throwable_2_classLit, {29:1, 58:1, 138:1}, 3, 0, 0)), 29)[0]);
}

function UmbrellaException(){
}

_ = UmbrellaException_0.prototype = UmbrellaException.prototype = new RuntimeException;
_.getClass$ = function getClass_89(){
  return Lcom_google_gwt_event_shared_UmbrellaException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1};
function throwIfNull(name_0, value){
  if (null == value) {
    throw new NullPointerException_1(name_0 + ' cannot be null');
  }
}

function AutoDirectionHandler_0(){
}

function addTo(){
  var autoDirHandler;
  autoDirHandler = new AutoDirectionHandler_0;
  return autoDirHandler;
}

function AutoDirectionHandler(){
}

_ = AutoDirectionHandler_0.prototype = AutoDirectionHandler.prototype = new Object_0;
_.getClass$ = function getClass_90(){
  return Lcom_google_gwt_i18n_client_AutoDirectionHandler_2_classLit;
}
;
_.onKeyUp = function onKeyUp(event_0){
}
;
_.castableTypeMap$ = {13:1, 25:1};
function getDirectionOnElement(elem){
  var dirPropertyValue;
  dirPropertyValue = elem['dir'] == null?null:String(elem['dir']);
  if ($equalsIgnoreCase('rtl', dirPropertyValue)) {
    return $clinit_175() , RTL;
  }
   else if ($equalsIgnoreCase('ltr', dirPropertyValue)) {
    return $clinit_175() , LTR;
  }
  return $clinit_175() , DEFAULT;
}

function setDirectionOnElement(elem, direction){
  switch (direction.ordinal) {
    case 0:
      {
        elem['dir'] = 'rtl';
        break;
      }

    case 1:
      {
        elem['dir'] = 'ltr';
        break;
      }

    case 2:
      {
        getDirectionOnElement(elem) != ($clinit_175() , DEFAULT) && (elem['dir'] = '' , undefined);
        break;
      }

  }
}

function $clinit_175(){
  $clinit_175 = nullMethod;
  RTL = new HasDirection$Direction_0('RTL', 0);
  LTR = new HasDirection$Direction_0('LTR', 1);
  DEFAULT = new HasDirection$Direction_0('DEFAULT', 2);
  $VALUES_6 = initValues(_3Lcom_google_gwt_i18n_client_HasDirection$Direction_2_classLit, {58:1, 138:1}, 53, [RTL, LTR, DEFAULT]);
}

function HasDirection$Direction_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_7(){
  $clinit_175();
  return $VALUES_6;
}

function HasDirection$Direction(){
}

_ = HasDirection$Direction_0.prototype = HasDirection$Direction.prototype = new Enum;
_.getClass$ = function getClass_91(){
  return Lcom_google_gwt_i18n_client_HasDirection$Direction_2_classLit;
}
;
_.castableTypeMap$ = {53:1, 58:1, 61:1, 62:1};
var $VALUES_6, DEFAULT, LTR, RTL;
function $clinit_176(){
  $clinit_176 = nullMethod;
  instance_0 = new LocaleInfo_0;
}

function $getNumberConstants(this$static){
  !this$static.numberConstants && (this$static.numberConstants = new NumberConstantsImpl_en_0);
  return this$static.numberConstants;
}

function LocaleInfo_0(){
}

function LocaleInfo(){
}

_ = LocaleInfo_0.prototype = LocaleInfo.prototype = new Object_0;
_.getClass$ = function getClass_92(){
  return Lcom_google_gwt_i18n_client_LocaleInfo_2_classLit;
}
;
_.castableTypeMap$ = {};
_.numberConstants = null;
var instance_0;
function $clinit_179(){
  $clinit_179 = nullMethod;
  $getNumberConstants(($clinit_176() , $clinit_176() , instance_0));
}

function $addExponent(this$static, digits){
  var exponentDigits, i;
  digits.impl.string += 'E';
  if (this$static.exponent < 0) {
    this$static.exponent = -this$static.exponent;
    digits.impl.string += '-';
  }
  exponentDigits = '' + this$static.exponent;
  for (i = exponentDigits.length; i < this$static.minExponentDigits; ++i) {
    digits.impl.string += '0';
  }
  digits.impl.string += exponentDigits;
}

function $addZeroAndDecimal(this$static, digits){
  if (this$static.digitsLength == 0) {
    $replace(digits.impl, 0, 0, '0');
    ++this$static.decimalPosition;
    ++this$static.digitsLength;
  }
  if (this$static.decimalPosition < this$static.digitsLength || this$static.decimalSeparatorAlwaysShown) {
    $insert_0(digits, this$static.decimalPosition, '.');
    ++this$static.digitsLength;
  }
}

function $adjustFractionDigits(this$static, digits){
  var requiredDigits, toRemove;
  requiredDigits = this$static.decimalPosition + this$static.minimumFractionDigits;
  if (this$static.digitsLength < requiredDigits) {
    while (this$static.digitsLength < requiredDigits) {
      digits.impl.string += '0';
      ++this$static.digitsLength;
    }
  }
   else {
    toRemove = this$static.decimalPosition + this$static.maximumFractionDigits;
    toRemove > this$static.digitsLength && (toRemove = this$static.digitsLength);
    while (toRemove > requiredDigits && digits.impl.string.charCodeAt(toRemove - 1) == 48) {
      --toRemove;
    }
    if (toRemove < this$static.digitsLength) {
      $replace_4(digits, toRemove, this$static.digitsLength, '');
      this$static.digitsLength = toRemove;
    }
  }
}

function $computeExponent(this$static, digits){
  var remainder, strip;
  strip = 0;
  while (strip < this$static.digitsLength - 1 && digits.impl.string.charCodeAt(strip) == 48) {
    ++strip;
  }
  if (strip > 0) {
    $replace(digits.impl, 0, strip, '');
    this$static.digitsLength -= strip;
    this$static.exponent -= strip;
  }
  if (this$static.maximumIntegerDigits > this$static.minimumIntegerDigits && this$static.maximumIntegerDigits > 0) {
    this$static.exponent += this$static.decimalPosition - 1;
    remainder = this$static.exponent % this$static.maximumIntegerDigits;
    remainder < 0 && (remainder += this$static.maximumIntegerDigits);
    this$static.decimalPosition = remainder + 1;
    this$static.exponent -= remainder;
  }
   else {
    this$static.exponent += this$static.decimalPosition - this$static.minimumIntegerDigits;
    this$static.decimalPosition = this$static.minimumIntegerDigits;
  }
  if (this$static.digitsLength == 1 && digits.impl.string.charCodeAt(0) == 48) {
    this$static.exponent = 0;
    this$static.decimalPosition = this$static.minimumIntegerDigits;
  }
}

function $format(this$static, number){
  var buf, isNegative, preRound, scale, currentGroupingSize, useExponent;
  if (isNaN(number)) {
    return 'NaN';
  }
  isNegative = number < 0 || number == 0 && 1 / number < 0;
  isNegative && (number = -number);
  buf = new StringBuilder_0;
  if (!isFinite(number)) {
    $append_8(buf, isNegative?this$static.negativePrefix:this$static.positivePrefix);
    buf.impl.string += '\u221E';
    $append_8(buf, isNegative?this$static.negativeSuffix:this$static.positiveSuffix);
    return buf.impl.string;
  }
  number *= this$static.multiplier;
  scale = toScaledString(buf, number);
  preRound = buf.impl.string.length + scale + this$static.maximumFractionDigits + 3;
  if (preRound > 0 && preRound < buf.impl.string.length && buf.impl.string.charCodeAt(preRound) == 57) {
    $propagateCarry(this$static, buf, preRound - 1);
    scale += buf.impl.string.length - preRound;
    $replace_4(buf, preRound, buf.impl.string.length, '');
  }
  this$static.exponent = 0;
  this$static.digitsLength = buf.impl.string.length;
  this$static.decimalPosition = this$static.digitsLength + scale;
  useExponent = this$static.useExponentialNotation;
  currentGroupingSize = this$static.groupingSize;
  this$static.decimalPosition > 1024 && (useExponent = true);
  useExponent && $computeExponent(this$static, buf);
  $processLeadingZeros(this$static, buf);
  $roundValue(this$static, buf);
  $insertGroupingSeparators(this$static, buf, currentGroupingSize);
  $adjustFractionDigits(this$static, buf);
  $addZeroAndDecimal(this$static, buf);
  useExponent && $addExponent(this$static, buf);
  $insert_0(buf, 0, isNegative?this$static.negativePrefix:this$static.positivePrefix);
  $append_8(buf, isNegative?this$static.negativeSuffix:this$static.positiveSuffix);
  return buf.impl.string;
}

function $insertGroupingSeparators(this$static, digits, g){
  var i;
  if (g > 0) {
    for (i = g; i < this$static.decimalPosition; i += g + 1) {
      $insert_0(digits, this$static.decimalPosition - i, ',');
      ++this$static.decimalPosition;
      ++this$static.digitsLength;
    }
  }
}

function $parseAffix(this$static, pattern, start, affix, inNegativePattern){
  var ch, inQuote, len, pos;
  $replace_3(affix, affix.impl.string.length);
  inQuote = false;
  len = pattern.length;
  for (pos = start; pos < len; ++pos) {
    ch = pattern.charCodeAt(pos);
    if (ch == 39) {
      if (pos + 1 < len && pattern.charCodeAt(pos + 1) == 39) {
        ++pos;
        affix.impl.string += "'";
      }
       else {
        inQuote = !inQuote;
      }
      continue;
    }
    if (inQuote) {
      affix.impl.string += String.fromCharCode(ch);
    }
     else {
      switch (ch) {
        case 35:
        case 48:
        case 44:
        case 46:
        case 59:
          return pos - start;
        case 164:
          this$static.isCurrencyFormat = true;
          if (pos + 1 < len && pattern.charCodeAt(pos + 1) == 164) {
            ++pos;
            $append_2(affix, this$static.currencyCode);
          }
           else {
            $append_2(affix, this$static.currencySymbol);
          }

          break;
        case 37:
          if (!inNegativePattern) {
            if (this$static.multiplier != 1) {
              throw new IllegalArgumentException_1('Too many percent/per mille characters in pattern "' + pattern + '"');
            }
            this$static.multiplier = 100;
          }

          affix.impl.string += '%';
          break;
        case 8240:
          if (!inNegativePattern) {
            if (this$static.multiplier != 1) {
              throw new IllegalArgumentException_1('Too many percent/per mille characters in pattern "' + pattern + '"');
            }
            this$static.multiplier = 1000;
          }

          affix.impl.string += '\u2030';
          break;
        case 45:
          affix.impl.string += '-';
          break;
        default:affix.impl.string += String.fromCharCode(ch);
      }
    }
  }
  return len - start;
}

function $parsePattern(this$static, pattern){
  var affix, pos;
  pos = 0;
  affix = new StringBuffer_0;
  pos += $parseAffix(this$static, pattern, 0, affix, false);
  this$static.positivePrefix = affix.impl.string;
  pos += $parseTrunk(this$static, pattern, pos, false);
  pos += $parseAffix(this$static, pattern, pos, affix, false);
  this$static.positiveSuffix = affix.impl.string;
  if (pos < pattern.length && pattern.charCodeAt(pos) == 59) {
    ++pos;
    pos += $parseAffix(this$static, pattern, pos, affix, true);
    this$static.negativePrefix = affix.impl.string;
    pos += $parseTrunk(this$static, pattern, pos, true);
    pos += $parseAffix(this$static, pattern, pos, affix, true);
    this$static.negativeSuffix = affix.impl.string;
  }
   else {
    this$static.negativePrefix = '-' + this$static.positivePrefix;
    this$static.negativeSuffix = this$static.positiveSuffix;
  }
}

function $parseTrunk(this$static, pattern, start, ignorePattern){
  var ch, decimalPos, digitLeftCount, digitRightCount, effectiveDecimalPos, groupingCount, len, loop, n, pos, totalDigits, zeroDigitCount;
  decimalPos = -1;
  digitLeftCount = 0;
  zeroDigitCount = 0;
  digitRightCount = 0;
  groupingCount = -1;
  len = pattern.length;
  pos = start;
  loop = true;
  for (; pos < len && loop; ++pos) {
    ch = pattern.charCodeAt(pos);
    switch (ch) {
      case 35:
        zeroDigitCount > 0?++digitRightCount:++digitLeftCount;
        groupingCount >= 0 && decimalPos < 0 && ++groupingCount;
        break;
      case 48:
        if (digitRightCount > 0) {
          throw new IllegalArgumentException_1("Unexpected '0' in pattern \"" + pattern + '"');
        }

        ++zeroDigitCount;
        groupingCount >= 0 && decimalPos < 0 && ++groupingCount;
        break;
      case 44:
        groupingCount = 0;
        break;
      case 46:
        if (decimalPos >= 0) {
          throw new IllegalArgumentException_1('Multiple decimal separators in pattern "' + pattern + '"');
        }

        decimalPos = digitLeftCount + zeroDigitCount + digitRightCount;
        break;
      case 69:
        if (!ignorePattern) {
          if (this$static.useExponentialNotation) {
            throw new IllegalArgumentException_1('Multiple exponential symbols in pattern "' + pattern + '"');
          }
          this$static.useExponentialNotation = true;
          this$static.minExponentDigits = 0;
        }

        while (pos + 1 < len && pattern.charCodeAt(pos + 1) == 48) {
          ++pos;
          ignorePattern || ++this$static.minExponentDigits;
        }

        if (!ignorePattern && digitLeftCount + zeroDigitCount < 1 || this$static.minExponentDigits < 1) {
          throw new IllegalArgumentException_1('Malformed exponential pattern "' + pattern + '"');
        }

        loop = false;
        break;
      default:--pos;
        loop = false;
    }
  }
  if (zeroDigitCount == 0 && digitLeftCount > 0 && decimalPos >= 0) {
    n = decimalPos;
    decimalPos == 0 && ++n;
    digitRightCount = digitLeftCount - n;
    digitLeftCount = n - 1;
    zeroDigitCount = 1;
  }
  if (decimalPos < 0 && digitRightCount > 0 || decimalPos >= 0 && (decimalPos < digitLeftCount || decimalPos > digitLeftCount + zeroDigitCount) || groupingCount == 0) {
    throw new IllegalArgumentException_1('Malformed pattern "' + pattern + '"');
  }
  if (ignorePattern) {
    return pos - start;
  }
  totalDigits = digitLeftCount + zeroDigitCount + digitRightCount;
  this$static.maximumFractionDigits = decimalPos >= 0?totalDigits - decimalPos:0;
  if (decimalPos >= 0) {
    this$static.minimumFractionDigits = digitLeftCount + zeroDigitCount - decimalPos;
    this$static.minimumFractionDigits < 0 && (this$static.minimumFractionDigits = 0);
  }
  effectiveDecimalPos = decimalPos >= 0?decimalPos:totalDigits;
  this$static.minimumIntegerDigits = effectiveDecimalPos - digitLeftCount;
  if (this$static.useExponentialNotation) {
    this$static.maximumIntegerDigits = digitLeftCount + this$static.minimumIntegerDigits;
    this$static.maximumFractionDigits == 0 && this$static.minimumIntegerDigits == 0 && (this$static.minimumIntegerDigits = 1);
  }
  this$static.groupingSize = groupingCount > 0?groupingCount:0;
  this$static.decimalSeparatorAlwaysShown = decimalPos == 0 || decimalPos == totalDigits;
  return pos - start;
}

function $processLeadingZeros(this$static, digits){
  var i, prefix, strip;
  if (this$static.decimalPosition > this$static.digitsLength) {
    while (this$static.digitsLength < this$static.decimalPosition) {
      digits.impl.string += '0';
      ++this$static.digitsLength;
    }
  }
  if (!this$static.useExponentialNotation) {
    if (this$static.decimalPosition < this$static.minimumIntegerDigits) {
      prefix = new StringBuilder_0;
      while (this$static.decimalPosition < this$static.minimumIntegerDigits) {
        prefix.impl.string += '0';
        ++this$static.decimalPosition;
        ++this$static.digitsLength;
      }
      $insert_0(digits, 0, prefix.impl.string);
    }
     else if (this$static.decimalPosition > this$static.minimumIntegerDigits) {
      strip = this$static.decimalPosition - this$static.minimumIntegerDigits;
      for (i = 0; i < strip; ++i) {
        if (digits.impl.string.charCodeAt(i) != 48) {
          strip = i;
          break;
        }
      }
      if (strip > 0) {
        $replace(digits.impl, 0, strip, '');
        this$static.digitsLength -= strip;
        this$static.decimalPosition -= strip;
      }
    }
  }
}

function $propagateCarry(this$static, digits, i){
  var carry, digit;
  carry = true;
  while (carry && i >= 0) {
    digit = digits.impl.string.charCodeAt(i);
    if (digit == 57) {
      $setCharAt(digits, i--, 48);
    }
     else {
      $replace_4(digits, i, i + 1, String.fromCharCode(digit + 1 & 65535));
      carry = false;
    }
  }
  if (carry) {
    $replace(digits.impl, 0, 0, '1');
    ++this$static.decimalPosition;
    ++this$static.digitsLength;
  }
}

function $roundValue(this$static, digits){
  var i;
  if (this$static.digitsLength > this$static.decimalPosition + this$static.maximumFractionDigits && digits.impl.string.charCodeAt(this$static.decimalPosition + this$static.maximumFractionDigits) >= 53) {
    i = this$static.decimalPosition + this$static.maximumFractionDigits - 1;
    $propagateCarry(this$static, digits, i);
  }
}

function NumberFormat_0(cdata, userSuppliedPattern){
  if (!cdata) {
    throw new IllegalArgumentException_1('Unknown currency code');
  }
  this.pattern = '0000000000.000';
  this.currencyCode = cdata.typeMarker$ == nullMethod?cdata.getCurrencyCode():cdata[0];
  this.currencySymbol = cdata.typeMarker$ == nullMethod?cdata.getCurrencySymbol():cdata[1];
  $parsePattern(this, this.pattern);
  if (!userSuppliedPattern && this.isCurrencyFormat) {
    this.minimumFractionDigits = cdata.typeMarker$ == nullMethod?cdata.getDefaultFractionDigits():dynamicCastJso(cdata)[2] & 7;
    this.maximumFractionDigits = this.minimumFractionDigits;
  }
}

function NumberFormat_1(cdata){
  $clinit_179();
  NumberFormat_0.call(this, cdata, true);
}

function toScaledString(buf, val){
  var dot, expDigits, expIdx, scale, startLen;
  startLen = buf.impl.string.length;
  $append_8(buf, val.toPrecision(20));
  scale = 0;
  expIdx = buf.impl.string.indexOf('e', startLen);
  expIdx < 0 && (expIdx = buf.impl.string.indexOf('E', startLen));
  if (expIdx >= 0) {
    expDigits = expIdx + 1;
    expDigits < buf.impl.string.length && buf.impl.string.charCodeAt(expDigits) == 43 && ++expDigits;
    expDigits < buf.impl.string.length && (scale = __parseAndValidateInt($substring(buf.impl.string, expDigits), 10));
    $replace_4(buf, expIdx, buf.impl.string.length, '');
  }
  dot = buf.impl.string.indexOf('.', startLen);
  if (dot >= 0) {
    $replace(buf.impl, dot, dot + 1, '');
    scale -= buf.impl.string.length - dot;
  }
  return scale;
}

function NumberFormat(){
}

_ = NumberFormat_1.prototype = NumberFormat.prototype = new Object_0;
_.getClass$ = function getClass_93(){
  return Lcom_google_gwt_i18n_client_NumberFormat_2_classLit;
}
;
_.castableTypeMap$ = {};
_.currencyCode = null;
_.currencySymbol = null;
_.decimalPosition = 0;
_.decimalSeparatorAlwaysShown = false;
_.digitsLength = 0;
_.exponent = 0;
_.groupingSize = 3;
_.isCurrencyFormat = false;
_.maximumFractionDigits = 3;
_.maximumIntegerDigits = 40;
_.minExponentDigits = 0;
_.minimumFractionDigits = 0;
_.minimumIntegerDigits = 1;
_.multiplier = 1;
_.negativePrefix = '-';
_.negativeSuffix = '';
_.pattern = null;
_.positivePrefix = '';
_.positiveSuffix = '';
_.useExponentialNotation = false;
function NumberConstantsImpl_en_0(){
}

function NumberConstantsImpl_en(){
}

_ = NumberConstantsImpl_en_0.prototype = NumberConstantsImpl_en.prototype = new Object_0;
_.getClass$ = function getClass_94(){
  return Lcom_google_gwt_i18n_client_constants_NumberConstantsImpl_1en_2_classLit;
}
;
_.castableTypeMap$ = {};
function Array_1(){
}

function clone_0(array){
  var a_0, result;
  return a_0 = array , result = a_0.slice(0, array.length) , initValues(a_0.arrayClass$, a_0.castableTypeMap$, a_0.queryId$, result) , result;
}

function createFrom(array, length_0){
  var a_0, result;
  a_0 = array;
  result = createFromSeed(0, length_0);
  initValues(a_0.arrayClass$, a_0.castableTypeMap$, a_0.queryId$, result);
  return result;
}

function createFromSeed(seedType, length_0){
  var array = new Array(length_0);
  if (seedType == 3) {
    for (var i = 0; i < length_0; ++i) {
      var value = new Object;
      value.l = value.m = value.h = 0;
      array[i] = value;
    }
  }
   else if (seedType > 0) {
    var value = [null, 0, false][seedType];
    for (var i = 0; i < length_0; ++i) {
      array[i] = value;
    }
  }
  return array;
}

function initDim(arrayClass, castableTypeMap, queryId, length_0, seedType){
  var result;
  result = createFromSeed(seedType, length_0);
  $clinit_186();
  wrapArray(result, expandoNames_0, expandoValues_0);
  result.arrayClass$ = arrayClass;
  result.castableTypeMap$ = castableTypeMap;
  result.queryId$ = queryId;
  return result;
}

function initValues(arrayClass, castableTypeMap, queryId, array){
  $clinit_186();
  wrapArray(array, expandoNames_0, expandoValues_0);
  array.arrayClass$ = arrayClass;
  array.castableTypeMap$ = castableTypeMap;
  array.queryId$ = queryId;
  return array;
}

function setCheck(array, index, value){
  if (value != null) {
    if (array.queryId$ > 0 && !canCastUnsafe(value, array.queryId$)) {
      throw new ArrayStoreException_0;
    }
    if (array.queryId$ < 0 && (value.typeMarker$ == nullMethod || value.castableTypeMap$ && !!value.castableTypeMap$[1])) {
      throw new ArrayStoreException_0;
    }
  }
  return array[index] = value;
}

function Array_0(){
}

_ = Array_1.prototype = Array_0.prototype = new Object_0;
_.getClass$ = function getClass_95(){
  return this.arrayClass$;
}
;
_.castableTypeMap$ = {};
_.arrayClass$ = null;
_.queryId$ = 0;
function $clinit_186(){
  $clinit_186 = nullMethod;
  expandoNames_0 = [];
  expandoValues_0 = [];
  initExpandos(new Array_1, expandoNames_0, expandoValues_0);
}

function initExpandos(protoType, expandoNames, expandoValues){
  var i = 0, value;
  for (var name_0 in protoType) {
    if (value = protoType[name_0]) {
      expandoNames[i] = name_0;
      expandoValues[i] = value;
      ++i;
    }
  }
}

function wrapArray(array, expandoNames, expandoValues){
  $clinit_186();
  for (var i = 0, c = expandoNames.length; i < c; ++i) {
    array[expandoNames[i]] = expandoValues[i];
  }
}

var expandoNames_0, expandoValues_0;
function canCastUnsafe(src, dstId){
  return src.castableTypeMap$ && src.castableTypeMap$[dstId];
}

function dynamicCast(src, dstId){
  if (src != null && !(src.castableTypeMap$ && src.castableTypeMap$[dstId])) {
    throw new ClassCastException_0;
  }
  return src;
}

function dynamicCastJso(src){
  if (src != null && (src.typeMarker$ == nullMethod || src.castableTypeMap$ && !!src.castableTypeMap$[1])) {
    throw new ClassCastException_0;
  }
  return src;
}

function instanceOf(src, dstId){
  return src != null && src.castableTypeMap$ && !!src.castableTypeMap$[dstId];
}

--></script>
<script><!--
function instanceOfJso(src){
  return src != null && src.typeMarker$ != nullMethod && !(src.castableTypeMap$ && !!src.castableTypeMap$[1]);
}

function maskUndefined(src){
  return src == null?null:src;
}

function throwClassCastExceptionUnlessNull(o){
  if (o != null) {
    throw new ClassCastException_0;
  }
  return null;
}

function init(){
  !!$stats && $stats({moduleName:$moduleName, sessionId:$sessionId, subSystem:'startup', evtGroup:'moduleStartup', millis:(new Date).getTime(), type:'onModuleLoadStart', className:'org.waveprotocol.wave.client.editor.harness.EditorTestHarness'});
  $onModuleLoad_0();
}

function caught_0(e){
  if (e != null && e.castableTypeMap$ && !!e.castableTypeMap$[3]) {
    return e;
  }
  return new JavaScriptException_0(e);
}

function create_3(value){
  var a0, a1, a2;
  a0 = value & 4194303;
  a1 = ~~value >> 22 & 4194303;
  a2 = value < 0?1048575:0;
  return a = new LongLibBase$LongEmul_0 , a.l = a0 , a.m = a1 , a.h = a2 , a;
}

function create0(l_0, m_0, h_0){
  return a = new LongLibBase$LongEmul_0 , a.l = l_0 , a.m = m_0 , a.h = h_0 , a;
}

function toDoubleHelper(a_0){
  return a_0.l + a_0.m * 4194304 + a_0.h * 17592186044416;
}

function eq(a_0, b){
  return a_0.l == b.l && a_0.m == b.m && a_0.h == b.h;
}

function fromDouble(value){
  var a0, a1, a2, negative, result, neg0, neg1, neg2;
  if (isNaN(value)) {
    return $clinit_193() , ZERO;
  }
  if (value < -9223372036854775808) {
    return $clinit_193() , MIN_VALUE;
  }
  if (value >= 9223372036854775807) {
    return $clinit_193() , MAX_VALUE;
  }
  negative = false;
  if (value < 0) {
    negative = true;
    value = -value;
  }
  a2 = 0;
  if (value >= 17592186044416) {
    a2 = ~~Math.max(Math.min(value / 17592186044416, 2147483647), -2147483648);
    value -= a2 * 17592186044416;
  }
  a1 = 0;
  if (value >= 4194304) {
    a1 = ~~Math.max(Math.min(value / 4194304, 2147483647), -2147483648);
    value -= a1 * 4194304;
  }
  a0 = ~~Math.max(Math.min(value, 2147483647), -2147483648);
  result = (a = new LongLibBase$LongEmul_0 , a.l = a0 , a.m = a1 , a.h = a2 , a);
  negative && (neg0 = ~result.l + 1 & 4194303 , neg1 = ~result.m + (neg0 == 0?1:0) & 4194303 , neg2 = ~result.h + (neg0 == 0 && neg1 == 0?1:0) & 1048575 , result.l = neg0 , result.m = neg1 , result.h = neg2 , undefined);
  return result;
}

function fromInt(value){
  var rebase, result;
  if (value > -129 && value < 128) {
    rebase = value + 128;
    boxedValues == null && (boxedValues = initDim(_3Lcom_google_gwt_lang_LongLibBase$LongEmul_2_classLit, {58:1, 138:1}, 54, 256, 0));
    result = boxedValues[rebase];
    !result && (result = boxedValues[rebase] = create_3(value));
    return result;
  }
  return create_3(value);
}

function gte(a_0, b){
  var signa, signb;
  signa = ~~a_0.h >> 19;
  signb = ~~b.h >> 19;
  return signa == 0?signb != 0 || a_0.h > b.h || a_0.h == b.h && a_0.m > b.m || a_0.h == b.h && a_0.m == b.m && a_0.l >= b.l:!(signb == 0 || a_0.h < b.h || a_0.h == b.h && a_0.m < b.m || a_0.h == b.h && a_0.m == b.m && a_0.l < b.l);
}

function shru(a_0, n){
  var a2, res0, res1, res2;
  n &= 63;
  a2 = a_0.h & 1048575;
  if (n < 22) {
    res2 = ~~a2 >>> n;
    res1 = ~~a_0.m >> n | a2 << 22 - n;
    res0 = ~~a_0.l >> n | a_0.m << 22 - n;
  }
   else if (n < 44) {
    res2 = 0;
    res1 = ~~a2 >>> n - 22;
    res0 = ~~a_0.m >> n - 22 | a_0.h << 44 - n;
  }
   else {
    res2 = 0;
    res1 = 0;
    res0 = ~~a2 >>> n - 44;
  }
  return create0(res0 & 4194303, res1 & 4194303, res2 & 1048575);
}

function toDouble(a_0){
  var neg0, neg1, neg2;
  if (eq(a_0, ($clinit_193() , MIN_VALUE))) {
    return -9223372036854775808;
  }
  if (!gte(a_0, ZERO)) {
    return -toDoubleHelper((neg0 = ~a_0.l + 1 & 4194303 , neg1 = ~a_0.m + (neg0 == 0?1:0) & 4194303 , neg2 = ~a_0.h + (neg0 == 0 && neg1 == 0?1:0) & 1048575 , create0(neg0, neg1, neg2)));
  }
  return a_0.l + a_0.m * 4194304 + a_0.h * 17592186044416;
}

function toInt(a_0){
  return a_0.l | a_0.m << 22;
}

function xor(a_0, b){
  return create0(a_0.l ^ b.l, a_0.m ^ b.m, a_0.h ^ b.h);
}

var boxedValues = null;
function $clinit_193(){
  $clinit_193 = nullMethod;
  MAX_VALUE = (a = new LongLibBase$LongEmul_0 , a.l = 4194303 , a.m = 4194303 , a.h = 524287 , a);
  MIN_VALUE = (a = new LongLibBase$LongEmul_0 , a.l = 0 , a.m = 0 , a.h = 524288 , a);
  fromInt(1);
  fromInt(2);
  ZERO = fromInt(0);
}

var MAX_VALUE, MIN_VALUE, ZERO;
function LongLibBase$LongEmul_0(){
}

function LongLibBase$LongEmul(){
}

_ = LongLibBase$LongEmul_0.prototype = LongLibBase$LongEmul.prototype = new Object_0;
_.getClass$ = function getClass_96(){
  return Lcom_google_gwt_lang_LongLibBase$LongEmul_2_classLit;
}
;
_.castableTypeMap$ = {54:1};
function $replace_0(this$static, input, replacement){
  return input.replace(this$static, replacement);
}

function ImageResourcePrototype_0(url, width, height){
  this.left_0 = 0;
  this.top_0 = 0;
  this.height_0 = height;
  this.width_0 = width;
  this.url = url;
}

function ImageResourcePrototype(){
}

_ = ImageResourcePrototype_0.prototype = ImageResourcePrototype.prototype = new Object_0;
_.getClass$ = function getClass_97(){
  return Lcom_google_gwt_resources_client_impl_ImageResourcePrototype_2_classLit;
}
;
_.castableTypeMap$ = {};
_.height_0 = 0;
_.left_0 = 0;
_.top_0 = 0;
_.url = null;
_.width_0 = 0;
function $appendEscaped(this$static, text){
  $append_8(this$static.sb, htmlEscape(text));
  return this$static;
}

function SafeHtmlBuilder_0(){
  this.sb = new StringBuilder_0;
}

function SafeHtmlBuilder(){
}

_ = SafeHtmlBuilder_0.prototype = SafeHtmlBuilder.prototype = new Object_0;
_.getClass$ = function getClass_98(){
  return Lcom_google_gwt_safehtml_shared_SafeHtmlBuilder_2_classLit;
}
;
_.castableTypeMap$ = {};
function SafeHtmlString_0(html){
  if (html == null) {
    throw new NullPointerException_1('html is null');
  }
  this.html = html;
}

function SafeHtmlString(){
}

_ = SafeHtmlString_0.prototype = SafeHtmlString.prototype = new Object_0;
_.equals$ = function equals_2(obj){
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[30])) {
    return false;
  }
  return $equals_3(this.html, dynamicCast(dynamicCast(obj, 30), 31).html);
}
;
_.getClass$ = function getClass_99(){
  return Lcom_google_gwt_safehtml_shared_SafeHtmlString_2_classLit;
}
;
_.hashCode$ = function hashCode_4(){
  return getHashCode_0(this.html);
}
;
_.castableTypeMap$ = {30:1, 31:1, 58:1};
_.html = null;
function $clinit_207(){
  $clinit_207 = nullMethod;
  new SafeHtmlString_0('');
  AMP_RE = new RegExp('&', 'g');
  GT_RE = new RegExp('>', 'g');
  LT_RE = new RegExp('<', 'g');
  SQUOT_RE = new RegExp("'", 'g');
  QUOT_RE = new RegExp('"', 'g');
}

function htmlEscape(s){
  $clinit_207();
  s.indexOf('&') != -1 && (s = $replace_0(AMP_RE, s, '&amp;'));
  s.indexOf('<') != -1 && (s = $replace_0(LT_RE, s, '&lt;'));
  s.indexOf('>') != -1 && (s = $replace_0(GT_RE, s, '&gt;'));
  s.indexOf('"') != -1 && (s = $replace_0(QUOT_RE, s, '&quot;'));
  s.indexOf("'") != -1 && (s = $replace_0(SQUOT_RE, s, '&#39;'));
  return s;
}

var AMP_RE, GT_RE, LT_RE, QUOT_RE, SQUOT_RE;
function AbstractRenderer(){
}

_ = AbstractRenderer.prototype = new Object_0;
_.getClass$ = function getClass_100(){
  return Lcom_google_gwt_text_shared_AbstractRenderer_2_classLit;
}
;
_.castableTypeMap$ = {};
function PassthroughParser_0(){
}

function PassthroughParser(){
}

_ = PassthroughParser_0.prototype = PassthroughParser.prototype = new Object_0;
_.getClass$ = function getClass_101(){
  return Lcom_google_gwt_text_shared_testing_PassthroughParser_2_classLit;
}
;
_.castableTypeMap$ = {};
var INSTANCE_0 = null;
function PassthroughRenderer_0(){
}

function PassthroughRenderer(){
}

_ = PassthroughRenderer_0.prototype = PassthroughRenderer.prototype = new AbstractRenderer;
_.getClass$ = function getClass_102(){
  return Lcom_google_gwt_text_shared_testing_PassthroughRenderer_2_classLit;
}
;
_.castableTypeMap$ = {};
var INSTANCE_1 = null;
function attachToDom(element){
  var origParent, origSibling;
  ensureHiddenDiv();
  origParent = $getParentElement(element);
  origSibling = $getNextSiblingElement(element);
  hiddenDiv.appendChild(element);
  return new UiBinderUtil$TempAttachment_0(origParent, origSibling, element);
}

function ensureHiddenDiv(){
  if (!hiddenDiv) {
    hiddenDiv = $doc.createElement('div');
    hiddenDiv.style.display = 'none';
    ($clinit_333() , $doc.body).appendChild(hiddenDiv);
  }
}

function orphan(node){
  node.parentNode.removeChild(node);
}

var hiddenDiv = null;
function UiBinderUtil$TempAttachment_0(origParent, origSibling, element){
  this.origParent = origParent;
  this.origSibling = origSibling;
  this.element = element;
}

function UiBinderUtil$TempAttachment(){
}

_ = UiBinderUtil$TempAttachment_0.prototype = UiBinderUtil$TempAttachment.prototype = new Object_0;
_.getClass$ = function getClass_103(){
  return Lcom_google_gwt_uibinder_client_UiBinderUtil$TempAttachment_2_classLit;
}
;
_.castableTypeMap$ = {};
_.element = null;
_.origParent = null;
_.origSibling = null;
function BaseListenerWrapper(){
}

_ = BaseListenerWrapper.prototype = new Object_0;
_.getClass$ = function getClass_104(){
  return Lcom_google_gwt_user_client_BaseListenerWrapper_2_classLit;
}
;
_.castableTypeMap$ = {25:1};
_.listener = null;
function CommandCanceledException_0(){
  this.fillInStackTrace();
}

function CommandCanceledException(){
}

_ = CommandCanceledException_0.prototype = CommandCanceledException.prototype = new RuntimeException;
_.getClass$ = function getClass_105(){
  return Lcom_google_gwt_user_client_CommandCanceledException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1};
function $doCommandCanceled(this$static){
  var cmd, ex, ueh;
  cmd = $getLast(this$static.iterator);
  $remove(this$static.iterator);
  ex = null;
  cmd != null && cmd.castableTypeMap$ && !!cmd.castableTypeMap$[32] && (ex = new CommandCanceledException_0(dynamicCast(cmd, 32)));
  if (ex) {
    ueh = sUncaughtExceptionHandler;
    !!ueh && $logUncaughtExceptions(ueh.this$0, ex);
  }
  this$static.executing = false;
  $maybeStartExecutionTimer(this$static);
}

function $doExecuteCommands(this$static, startTimeMillis){
  var command, element, wasCanceled;
  wasCanceled = false;
  try {
    this$static.executing = true;
    this$static.iterator.end = this$static.commands.size;
    $schedule(this$static.cancellationTimer, 10000);
    while ($hasNext(this$static.iterator)) {
      element = $next(this$static.iterator);
      try {
        if (element == null) {
          return;
        }
        if (element != null && element.castableTypeMap$ && !!element.castableTypeMap$[32]) {
          command = dynamicCast(element, 32);
          command.execute();
        }
      }
       finally {
        wasCanceled = this$static.iterator.last == -1;
        wasCanceled || $remove(this$static.iterator);
      }
      if ((new Date).getTime() - startTimeMillis >= 100) {
        return;
      }
    }
  }
   finally {
    if (!wasCanceled) {
      $cancel_0(this$static.cancellationTimer);
      this$static.executing = false;
      $maybeStartExecutionTimer(this$static);
    }
  }
}

function $maybeStartExecutionTimer(this$static){
  if (this$static.commands.size != 0 && !this$static.executionTimerPending && !this$static.executing) {
    this$static.executionTimerPending = true;
    $schedule(this$static.executionTimer, 1);
  }
}

function $submit(this$static, command){
  $add_9(this$static.commands, command);
  $maybeStartExecutionTimer(this$static);
}

function CommandExecutor_0(){
  this.cancellationTimer = new CommandExecutor$1_0(this);
  this.commands = new ArrayList_0;
  this.executionTimer = new CommandExecutor$2_0(this);
  this.iterator = new CommandExecutor$CircularIterator_0(this);
}

function CommandExecutor(){
}

_ = CommandExecutor_0.prototype = CommandExecutor.prototype = new Object_0;
_.getClass$ = function getClass_106(){
  return Lcom_google_gwt_user_client_CommandExecutor_2_classLit;
}
;
_.castableTypeMap$ = {};
_.executing = false;
_.executionTimerPending = false;
function CommandExecutor$1_0(this$0){
  $clinit_2();
  this.this$0 = this$0;
}

function CommandExecutor$1(){
}

_ = CommandExecutor$1_0.prototype = CommandExecutor$1.prototype = new Timer;
_.getClass$ = function getClass_107(){
  return Lcom_google_gwt_user_client_CommandExecutor$1_2_classLit;
}
;
_.run = function run_0(){
  if (!this.this$0.executing) {
    return;
  }
  $doCommandCanceled(this.this$0);
}
;
_.castableTypeMap$ = {34:1};
_.this$0 = null;
function CommandExecutor$2_0(this$0){
  $clinit_2();
  this.this$0 = this$0;
}

function CommandExecutor$2(){
}

_ = CommandExecutor$2_0.prototype = CommandExecutor$2.prototype = new Timer;
_.getClass$ = function getClass_108(){
  return Lcom_google_gwt_user_client_CommandExecutor$2_2_classLit;
}
;
_.run = function run_1(){
  this.this$0.executionTimerPending = false;
  $doExecuteCommands(this.this$0, (new Date).getTime());
}
;
_.castableTypeMap$ = {34:1};
_.this$0 = null;
function $getLast(this$static){
  return $get_3(this$static.this$0.commands, this$static.last);
}

function $hasNext(this$static){
  return this$static.next < this$static.end;
}

function $next(this$static){
  var command;
  this$static.last = this$static.next;
  command = $get_3(this$static.this$0.commands, this$static.next++);
  this$static.next >= this$static.end && (this$static.next = 0);
  return command;
}

function $remove(this$static){
  $remove_10(this$static.this$0.commands, this$static.last);
  --this$static.end;
  this$static.last <= this$static.next && --this$static.next < 0 && (this$static.next = 0);
  this$static.last = -1;
}

function CommandExecutor$CircularIterator_0(this$0){
  this.this$0 = this$0;
}

function CommandExecutor$CircularIterator(){
}

_ = CommandExecutor$CircularIterator_0.prototype = CommandExecutor$CircularIterator.prototype = new Object_0;
_.getClass$ = function getClass_109(){
  return Lcom_google_gwt_user_client_CommandExecutor$CircularIterator_2_classLit;
}
;
_.hasNext = function hasNext(){
  return this.next < this.end;
}
;
_.next_0 = function next_3(){
  return $next(this);
}
;
_.remove = function remove_0(){
  $remove(this);
}
;
_.castableTypeMap$ = {};
_.end = 0;
_.last = -1;
_.next = 0;
_.this$0 = null;
function ensureCookies(){
  var newCachedCookies;
  if (!cachedCookies || needsRefresh()) {
    newCachedCookies = new HashMap_0;
    loadCookies(newCachedCookies);
    cachedCookies = newCachedCookies;
  }
  return cachedCookies;
}

function getCookie(){
  var cookiesMap;
  cookiesMap = ensureCookies();
  return dynamicCast(cookiesMap.get('wdm'), 1);
}

function loadCookies(m_0){
  var docCookie = $doc.cookie;
  if (docCookie && docCookie != '') {
    var crumbs = docCookie.split('; ');
    for (var i = 0; i < crumbs.length; ++i) {
      var name_0, value;
      var eqIdx = crumbs[i].indexOf('=');
      if (eqIdx == -1) {
        name_0 = crumbs[i];
        value = '';
      }
       else {
        name_0 = crumbs[i].substring(0, eqIdx);
        value = crumbs[i].substring(eqIdx + 1);
      }
      if (uriEncoding) {
        try {
          name_0 = decodeURIComponent(name_0);
        }
         catch (e) {
        }
        try {
          value = decodeURIComponent(value);
        }
         catch (e) {
        }
      }
      m_0.put(name_0, value);
    }
  }
}

function needsRefresh(){
  var docCookie = $doc.cookie;
  if (docCookie != rawCookies) {
    rawCookies = docCookie;
    return true;
  }
   else {
    return false;
  }
}

function setCookie(name_0, value, expires){
  name_0 = encodeURIComponent(name_0);
  value = encodeURIComponent(value);
  setCookieImpl(name_0, value, toDouble(!expires?P0_longLit:fromDouble(expires.jsdate.getTime())), null, null, false);
}

function setCookieImpl(name_0, value, expires, domain, path, secure){
  var c = name_0 + '=' + value;
  expires && (c += ';expires=' + (new Date(expires)).toGMTString());
  domain && (c += ';domain=' + domain);
  path && (c += ';path=' + path);
  secure && (c += ';secure');
  $doc.cookie = c;
}

var cachedCookies = null, rawCookies = null, uriEncoding = true;
function dispatchEvent_0(evt, elem, listener){
  var prevCurrentEvent;
  prevCurrentEvent = currentEvent;
  currentEvent = evt;
  elem == sCaptureElem && $eventGetTypeInt(evt.type) == 8192 && (sCaptureElem = null);
  listener.onBrowserEvent(evt);
  currentEvent = prevCurrentEvent;
}

function previewEvent(evt){
  var ret;
  ret = fire_4(handlers_0, evt);
  if (!ret && !!evt) {
    evt.cancelBubble = true;
    evt.preventDefault();
  }
  return ret;
}

function sinkEvents(elem, eventBits){
  $maybeInitializeEventSystem();
  $sinkEventsImpl(elem, eventBits);
}

var currentEvent = null, sCaptureElem = null;
function $clinit_224(){
  $clinit_224 = nullMethod;
  commandExecutor = new CommandExecutor_0;
}

function addCommand(cmd){
  $clinit_224();
  if (!cmd) {
    throw new NullPointerException_1('cmd cannot be null');
  }
  $submit(commandExecutor, cmd);
}

var commandExecutor;
function addNativePreviewHandler(handler){
  $maybeInitializeEventSystem();
  !TYPE_15 && (TYPE_15 = new GwtEvent$Type_0);
  if (!handlers_0) {
    handlers_0 = new HandlerManager_1(null, true);
    singleton = new Event$NativePreviewEvent_0;
  }
  return $addHandler_0(handlers_0.eventBus, TYPE_15, handler);
}

function sinkEvents_0(elem, eventBits){
  $maybeInitializeEventSystem();
  $sinkEventsImpl(elem, eventBits);
}

var handlers_0 = null;
function $revive_0(this$static){
  this$static.dead = false;
  this$static.source = null;
  this$static.isCanceled = false;
  this$static.isConsumed = false;
  this$static.isFirstHandler = true;
  this$static.nativeEvent = null;
}

function Event$NativePreviewEvent_0(){
}

function fire_4(handlers, nativeEvent){
  var lastIsCanceled, lastIsConsumed, lastIsFirstHandler, lastNativeEvent, ret;
  if (!!TYPE_15 && !!handlers && handlers.eventBus.map.containsKey(TYPE_15)) {
    lastIsCanceled = singleton.isCanceled;
    lastIsConsumed = singleton.isConsumed;
    lastIsFirstHandler = singleton.isFirstHandler;
    lastNativeEvent = singleton.nativeEvent;
    $revive_0(singleton);
    singleton.nativeEvent = nativeEvent;
    $fireEvent(handlers, singleton);
    ret = !(singleton.isCanceled && !singleton.isConsumed);
    singleton.isCanceled = lastIsCanceled;
    singleton.isConsumed = lastIsConsumed;
    singleton.isFirstHandler = lastIsFirstHandler;
    singleton.nativeEvent = lastNativeEvent;
    return ret;
  }
  return true;
}

function Event$NativePreviewEvent(){
}

_ = Event$NativePreviewEvent_0.prototype = Event$NativePreviewEvent.prototype = new GwtEvent;
_.dispatch = function dispatch_15(handler){
  $previewNativeEvent(dynamicCast(handler, 33).this$0, this);
  singleton.isFirstHandler = false;
}
;
_.getAssociatedType = function getAssociatedType_16(){
  return TYPE_15;
}
;
_.getClass$ = function getClass_110(){
  return Lcom_google_gwt_user_client_Event$NativePreviewEvent_2_classLit;
}
;
_.revive = function revive_0(){
  $revive_0(this);
}
;
_.castableTypeMap$ = {};
_.isCanceled = false;
_.isConsumed = false;
_.isFirstHandler = false;
_.nativeEvent = null;
var TYPE_15 = null, singleton = null;
function $clinit_230(){
  $clinit_230 = nullMethod;
  impl = new HistoryImplSafari_0;
  $init_0(impl) || (impl = null);
}

function addValueChangeHandler(handler){
  $clinit_230();
  return impl?$addValueChangeHandler(impl, handler):null;
}

var impl = null;
function Timer$1_0(){
}

function Timer$1(){
}

_ = Timer$1_0.prototype = Timer$1.prototype = new Object_0;
_.getClass$ = function getClass_111(){
  return Lcom_google_gwt_user_client_Timer$1_2_classLit;
}
;
_.onClose = function onClose(event_0){
  while (($clinit_2() , timers).size > 0) {
    $cancel_0(dynamicCast($get_3(timers, 0), 34));
  }
}
;
_.castableTypeMap$ = {20:1, 25:1};
function addCloseHandler(handler){
  maybeInitializeCloseHandlers();
  return addHandler(TYPE_11?TYPE_11:(TYPE_11 = new GwtEvent$Type_0), handler);
}

function addHandler(type, handler){
  return $addHandler_0((!handlers_1 && (handlers_1 = new Window$WindowHandlers_0) , handlers_1).eventBus, type, handler);
}

function addResizeHandler(handler){
  maybeInitializeCloseHandlers();
  maybeInitializeResizeHandlers();
  return addHandler((!TYPE_12 && (TYPE_12 = new GwtEvent$Type_0) , TYPE_12), handler);
}

function maybeInitializeCloseHandlers(){
  if (!closeHandlersInitialized) {
    $initWindowCloseHandler();
    closeHandlersInitialized = true;
  }
}

function maybeInitializeResizeHandlers(){
  if (!resizeHandlersInitialized) {
    $initWindowResizeHandler();
    resizeHandlersInitialized = true;
  }
}

function onClosing(){
  var event_0;
  if (closeHandlersInitialized) {
    event_0 = new Window$ClosingEvent_0;
    !!handlers_1 && $fireEvent(handlers_1, event_0);
    return null;
  }
  return null;
}

function onResize(){
  var height, width;
  if (resizeHandlersInitialized) {
    width = $getClientWidth($doc);
    height = $getClientHeight($doc);
    if (lastResizeWidth != width || lastResizeHeight != height) {
      lastResizeWidth = width;
      lastResizeHeight = height;
      fire_1((!handlers_1 && (handlers_1 = new Window$WindowHandlers_0) , handlers_1));
    }
  }
}

var closeHandlersInitialized = false, handlers_1 = null, lastResizeHeight = 0, lastResizeWidth = 0, resizeHandlersInitialized = false;
function $clinit_234(){
  $clinit_234 = nullMethod;
  TYPE_16 = new GwtEvent$Type_0;
}

function Window$ClosingEvent_0(){
  $clinit_234();
}

function Window$ClosingEvent(){
}

_ = Window$ClosingEvent_0.prototype = Window$ClosingEvent.prototype = new GwtEvent;
_.dispatch = function dispatch_16(handler){
  throwClassCastExceptionUnlessNull(handler);
  null.nullMethod();
}
;
_.getAssociatedType = function getAssociatedType_17(){
  return TYPE_16;
}
;
_.getClass$ = function getClass_112(){
  return Lcom_google_gwt_user_client_Window$ClosingEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
var TYPE_16;
function Window$WindowHandlers_0(){
  this.eventBus = new SimpleEventBus_0(false);
  this.source = null;
}

function Window$WindowHandlers(){
}

_ = Window$WindowHandlers_0.prototype = Window$WindowHandlers.prototype = new HandlerManager;
_.getClass$ = function getClass_113(){
  return Lcom_google_gwt_user_client_Window$WindowHandlers_2_classLit;
}
;
_.castableTypeMap$ = {51:1};
function $eventGetTypeInt(eventType){
  switch (eventType) {
    case 'blur':
      return 4096;
    case 'change':
      return 1024;
    case 'click':
      return 1;
    case 'dblclick':
      return 2;
    case 'focus':
      return 2048;
    case 'keydown':
      return 128;
    case 'keypress':
      return 256;
    case 'keyup':
      return 512;
    case 'load':
      return 32768;
    case 'losecapture':
      return 8192;
    case 'mousedown':
      return 4;
    case 'mousemove':
      return 64;
    case 'mouseout':
      return 32;
    case 'mouseover':
      return 16;
    case 'mouseup':
      return 8;
    case 'scroll':
      return 16384;
    case 'error':
      return 65536;
    case 'mousewheel':
      return 131072;
    case 'DOMMouseScroll':
      return 131072;
    case 'contextmenu':
      return 262144;
    case 'paste':
      return 524288;
    default:return -1;
  }
}

function $maybeInitializeEventSystem(){
  if (!eventSystemIsInitialized) {
    $initEventSystem();
    eventSystemIsInitialized = true;
  }
}

function isMyListener(object){
  return !instanceOfJso(object) && object != null && object.castableTypeMap$ && !!object.castableTypeMap$[35];
}

var eventSystemIsInitialized = false;
function $eventGetFromElement(evt){
  if ($equals_3(evt.type, 'mouseover')) {
    return evt.relatedTarget;
  }
  if ($equals_3(evt.type, 'mouseout')) {
    return evt.target;
  }
  return null;
}

function $eventGetToElement(evt){
  if ($equals_3(evt.type, 'mouseover')) {
    return evt.target;
  }
  if ($equals_3(evt.type, 'mouseout')) {
    return evt.relatedTarget;
  }
  return null;
}

function $getChild(elem, index){
  var count = 0, child = elem.firstChild;
  while (child) {
    if (child.nodeType == 1) {
      if (index == count)
        return child;
      ++count;
    }
    child = child.nextSibling;
  }
  return null;
}

function $getChildCount(elem){
  var count = 0, child = elem.firstChild;
  while (child) {
    child.nodeType == 1 && ++count;
    child = child.nextSibling;
  }
  return count;
}

function $initEventSystem(){
  dispatchCapturedMouseEvent = $entry(function(evt){
    if (dispatchCapturedEvent(evt)) {
      var cap = captureElem;
      if (cap && cap.__listener) {
        if (isMyListener(cap.__listener)) {
          dispatchEvent_0(evt, cap, cap.__listener);
          evt.stopPropagation();
        }
      }
    }
  }
  );
  dispatchCapturedEvent = $entry(function(evt){
    if (!previewEvent(evt)) {
      evt.stopPropagation();
      evt.preventDefault();
      return false;
    }
    return true;
  }
  );
  dispatchUnhandledEvent = $entry(function(evt){
    this.__gwtLastUnhandledEvent = evt.type;
    dispatchEvent_1.call(this, evt);
  }
  );
  dispatchEvent_1 = $entry(function(evt){
    var listener, curElem = this;
    while (curElem && !(listener = curElem.__listener)) {
      curElem = curElem.parentNode;
    }
    curElem && curElem.nodeType != 1 && (curElem = null);
    listener && isMyListener(listener) && dispatchEvent_0(evt, curElem, listener);
  }
  );
  $wnd.addEventListener('click', dispatchCapturedMouseEvent, true);
  $wnd.addEventListener('dblclick', dispatchCapturedMouseEvent, true);
  $wnd.addEventListener('mousedown', dispatchCapturedMouseEvent, true);
  $wnd.addEventListener('mouseup', dispatchCapturedMouseEvent, true);
  $wnd.addEventListener('mousemove', dispatchCapturedMouseEvent, true);
  $wnd.addEventListener('mouseover', dispatchCapturedMouseEvent, true);
  $wnd.addEventListener('mouseout', dispatchCapturedMouseEvent, true);
  $wnd.addEventListener('mousewheel', dispatchCapturedMouseEvent, true);
  $wnd.addEventListener('keydown', dispatchCapturedEvent, true);
  $wnd.addEventListener('keyup', dispatchCapturedEvent, true);
  $wnd.addEventListener('keypress', dispatchCapturedEvent, true);
}

function $insertChild(parent_0, toAdd, index){
  var count = 0, child = parent_0.firstChild, before = null;
  while (child) {
    if (child.nodeType == 1) {
      if (count == index) {
        before = child;
        break;
      }
      ++count;
    }
    child = child.nextSibling;
  }
  parent_0.insertBefore(toAdd, before);
}

function $sinkEventsImpl(elem, bits){
  var chMask = (elem.__eventBits || 0) ^ bits;
  elem.__eventBits = bits;
  if (!chMask)
    return;
  chMask & 1 && (elem.onclick = bits & 1?dispatchEvent_1:null);
  chMask & 2 && (elem.ondblclick = bits & 2?dispatchEvent_1:null);
  chMask & 4 && (elem.onmousedown = bits & 4?dispatchEvent_1:null);
  chMask & 8 && (elem.onmouseup = bits & 8?dispatchEvent_1:null);
  chMask & 16 && (elem.onmouseover = bits & 16?dispatchEvent_1:null);
  chMask & 32 && (elem.onmouseout = bits & 32?dispatchEvent_1:null);
  chMask & 64 && (elem.onmousemove = bits & 64?dispatchEvent_1:null);
  chMask & 128 && (elem.onkeydown = bits & 128?dispatchEvent_1:null);
  chMask & 256 && (elem.onkeypress = bits & 256?dispatchEvent_1:null);
  chMask & 512 && (elem.onkeyup = bits & 512?dispatchEvent_1:null);
  chMask & 1024 && (elem.onchange = bits & 1024?dispatchEvent_1:null);
  chMask & 2048 && (elem.onfocus = bits & 2048?dispatchEvent_1:null);
  chMask & 4096 && (elem.onblur = bits & 4096?dispatchEvent_1:null);
  chMask & 8192 && (elem.onlosecapture = bits & 8192?dispatchEvent_1:null);
  chMask & 16384 && (elem.onscroll = bits & 16384?dispatchEvent_1:null);
  chMask & 32768 && (elem.onload = bits & 32768?dispatchUnhandledEvent:null);
  chMask & 65536 && (elem.onerror = bits & 65536?dispatchEvent_1:null);
  chMask & 131072 && (elem.onmousewheel = bits & 131072?dispatchEvent_1:null);
  chMask & 262144 && (elem.oncontextmenu = bits & 262144?dispatchEvent_1:null);
  chMask & 524288 && (elem.onpaste = bits & 524288?dispatchEvent_1:null);
}

var captureElem = null, dispatchCapturedEvent = null, dispatchCapturedMouseEvent = null, dispatchEvent_1 = null, dispatchUnhandledEvent = null;
function $addValueChangeHandler(this$static, handler){
  return $addHandler_0(this$static.handlers.eventBus, (!TYPE_14 && (TYPE_14 = new GwtEvent$Type_0) , TYPE_14), handler);
}

function HistoryImpl(){
}

_ = HistoryImpl.prototype = new Object_0;
_.decodeFragment = function decodeFragment(encodedFragment){
  return decodeURI(encodedFragment.replace('%23', '#'));
}
;
_.fireEvent = function fireEvent_1(event_0){
  $fireEvent(this.handlers, event_0);
}
;
_.getClass$ = function getClass_114(){
  return Lcom_google_gwt_user_client_impl_HistoryImpl_2_classLit;
}
;
_.newItemOnEvent = function newItemOnEvent(historyToken){
  historyToken = historyToken == null?'':historyToken;
  if (!$equals_3(historyToken, $wnd.__gwt_historyToken || '')) {
    $wnd.__gwt_historyToken = historyToken;
    fire_3(this, historyToken);
  }
}
;
_.castableTypeMap$ = {51:1};
function $init_0(this$static){
  var token_0 = '';
  var hash_0 = $wnd.location.hash;
  hash_0.length > 0 && (token_0 = this$static.decodeFragment(hash_0.substring(1)));
  $wnd.__gwt_historyToken = token_0;
  var historyImpl = this$static;
  $wnd.__checkHistory = $entry(function(){
    $wnd.setTimeout($wnd.__checkHistory, 250);
    var token = '', hash = $wnd.location.hash;
    hash.length > 0 && (token = historyImpl.decodeFragment(hash.substring(1)));
    historyImpl.newItemOnEvent(token);
  }
  );
  $wnd.__checkHistory();
  return true;
}

function HistoryImplTimer(){
}

_ = HistoryImplTimer.prototype = new HistoryImpl;
_.getClass$ = function getClass_115(){
  return Lcom_google_gwt_user_client_impl_HistoryImplTimer_2_classLit;
}
;
_.castableTypeMap$ = {51:1};
function HistoryImplSafari_0(){
  this.handlers = new HandlerManager_0(null);
}

function HistoryImplSafari(){
}

--></script>
<script><!--
_ = HistoryImplSafari_0.prototype = HistoryImplSafari.prototype = new HistoryImplTimer;
_.getClass$ = function getClass_116(){
  return Lcom_google_gwt_user_client_impl_HistoryImplSafari_2_classLit;
}
;
_.castableTypeMap$ = {51:1};
function $initWindowCloseHandler(){
  var oldOnBeforeUnload = $wnd.onbeforeunload;
  var oldOnUnload = $wnd.onunload;
  $wnd.onbeforeunload = function(evt){
    var ret, oldRet;
    try {
      ret = $entry(onClosing)();
    }
     finally {
      oldRet = oldOnBeforeUnload && oldOnBeforeUnload(evt);
    }
    if (ret != null) {
      return ret;
    }
    if (oldRet != null) {
      return oldRet;
    }
  }
  ;
  $wnd.onunload = $entry(function(evt){
    try {
      closeHandlersInitialized && fire_0((!handlers_1 && (handlers_1 = new Window$WindowHandlers_0) , handlers_1), false);
    }
     finally {
      oldOnUnload && oldOnUnload(evt);
      $wnd.onresize = null;
      $wnd.onscroll = null;
      $wnd.onbeforeunload = null;
      $wnd.onunload = null;
    }
  }
  );
}

function $initWindowResizeHandler(){
  var oldOnResize = $wnd.onresize;
  $wnd.onresize = $entry(function(evt){
    try {
      onResize();
    }
     finally {
      oldOnResize && oldOnResize(evt);
    }
  }
  );
}

function $addStyleName(this$static, style){
  setStyleName_0(this$static.getStyleElement(), style, true);
}

function $replaceNode(node, newNode){
  var p = node.parentNode;
  if (!p) {
    return;
  }
  p.insertBefore(newNode, node);
  p.removeChild(node);
}

function $setElement_0(this$static, elem){
  this$static.element_0 = elem;
}

function $setPixelSize(this$static, width, height){
  width >= 0 && (this$static.element_0.style['width'] = width + 'px' , undefined);
  height >= 0 && (this$static.element_0.style['height'] = height + 'px' , undefined);
}

function $setStyleName(this$static, style, add){
  setStyleName_0(this$static.getStyleElement(), style, add);
}

function getStylePrimaryName(elem){
  var fullClassName, spaceIdx;
  fullClassName = elem['className'] == null?null:String(elem['className']);
  spaceIdx = fullClassName.indexOf(fromCodePoint(32));
  if (spaceIdx >= 0) {
    return fullClassName.substr(0, spaceIdx - 0);
  }
  return fullClassName;
}

function setStyleName_0(elem, style, add){
  if (!elem) {
    throw new RuntimeException_1('Null widget handle. If you are creating a composite, ensure that initWidget() has been called.');
  }
  style = $trim(style);
  if (style.length == 0) {
    throw new IllegalArgumentException_1('Style names cannot be empty');
  }
  add?$addClassName(elem, style):$removeClassName(elem, style);
}

function setStylePrimaryName(elem, style){
  if (!elem) {
    throw new RuntimeException_1('Null widget handle. If you are creating a composite, ensure that initWidget() has been called.');
  }
  style = $trim(style);
  if (style.length == 0) {
    throw new IllegalArgumentException_1('Style names cannot be empty');
  }
  updatePrimaryAndDependentStyleNames(elem, style);
}

function updatePrimaryAndDependentStyleNames(elem, newPrimaryStyle){
  var classes = elem.className.split(/\s+/);
  if (!classes) {
    return;
  }
  var oldPrimaryStyle = classes[0];
  var oldPrimaryStyleLen = oldPrimaryStyle.length;
  classes[0] = newPrimaryStyle;
  for (var i = 1, n = classes.length; i < n; i++) {
    var name_0 = classes[i];
    name_0.length > oldPrimaryStyleLen && name_0.charAt(oldPrimaryStyleLen) == '-' && name_0.indexOf(oldPrimaryStyle) == 0 && (classes[i] = newPrimaryStyle + name_0.substring(oldPrimaryStyleLen));
  }
  elem.className = classes.join(' ');
}

function UIObject(){
}

_ = UIObject.prototype = new Object_0;
_.getClass$ = function getClass_117(){
  return Lcom_google_gwt_user_client_ui_UIObject_2_classLit;
}
;
_.getStyleElement = function getStyleElement(){
  return this.element_0;
}
;
_.setHeight = function setHeight(height){
  this.element_0.style['height'] = height;
}
;
_.setWidth = function setWidth(width){
  this.element_0.style['width'] = width;
}
;
_.toString$ = function toString_6(){
  if (!this.element_0) {
    return '(null handle)';
  }
  return this.element_0.outerHTML;
}
;
_.castableTypeMap$ = {38:1};
_.element_0 = null;
function $addDomHandler(this$static, handler, type){
  this$static.sinkEvents($eventGetTypeInt(type.name_0));
  return $addHandler_0((!this$static.handlerManager?(this$static.handlerManager = new HandlerManager_0(this$static)):this$static.handlerManager).eventBus, type, handler);
}

function $addHandler_1(this$static, handler, type){
  return $addHandler_0((!this$static.handlerManager?(this$static.handlerManager = new HandlerManager_0(this$static)):this$static.handlerManager).eventBus, type, handler);
}

function $delegateEvent(target, event_0){
  !!target.handlerManager && $fireEvent(target.handlerManager, event_0);
}

function $fireEvent_1(this$static, event_0){
  !!this$static.handlerManager && $fireEvent(this$static.handlerManager, event_0);
}

function $onAttach(this$static){
  var bitsToAdd;
  if (this$static.isAttached()) {
    throw new IllegalStateException_1("Should only call onAttach when the widget is detached from the browser's document");
  }
  this$static.attached = true;
  this$static.element_0.__listener = this$static;
  bitsToAdd = this$static.eventsToSink;
  this$static.eventsToSink = -1;
  bitsToAdd > 0 && this$static.sinkEvents(bitsToAdd);
  this$static.doAttachChildren();
  this$static.onLoad();
}

function $onBrowserEvent(this$static, event_0){
  var related;
  switch ($eventGetTypeInt(event_0.type)) {
    case 16:
    case 32:
      related = event_0.relatedTarget;
      if (!!related && $isOrHasChild(this$static.element_0, related)) {
        return;
      }

  }
  fireNativeEvent(event_0, this$static, this$static.element_0);
}

function $onDetach(this$static){
  if (!this$static.isAttached()) {
    throw new IllegalStateException_1("Should only call onDetach when the widget is attached to the browser's document");
  }
  try {
    this$static.onUnload();
  }
   finally {
    try {
      this$static.doDetachChildren();
    }
     finally {
      this$static.element_0.__listener = null;
      this$static.attached = false;
    }
  }
}

function $removeFromParent_0(this$static){
  if (!this$static.parent_0) {
    ($clinit_333() , widgetsToDetach.map.containsKey(this$static)) && detachNow(this$static);
  }
   else if (instanceOf(this$static.parent_0, 135)) {
    dynamicCast(this$static.parent_0, 135).remove_0(this$static);
  }
   else if (this$static.parent_0) {
    throw new IllegalStateException_1("This widget's parent does not implement HasWidgets");
  }
}

function $replaceElement(this$static, elem){
  this$static.attached && (this$static.element_0.__listener = null , undefined);
  !!this$static.element_0 && $replaceNode(this$static.element_0, elem);
  this$static.element_0 = elem;
  this$static.attached && (this$static.element_0.__listener = this$static , undefined);
}

function $setParent(this$static, parent_0){
  var oldParent;
  oldParent = this$static.parent_0;
  if (!parent_0) {
    try {
      !!oldParent && oldParent.isAttached() && this$static.onDetach();
    }
     finally {
      this$static.parent_0 = null;
    }
  }
   else {
    if (oldParent) {
      throw new IllegalStateException_1('Cannot set a new parent without first clearing the old parent');
    }
    this$static.parent_0 = parent_0;
    parent_0.isAttached() && this$static.onAttach();
  }
}

function Widget(){
}

_ = Widget.prototype = new UIObject;
_.doAttachChildren = function doAttachChildren(){
}
;
_.doDetachChildren = function doDetachChildren(){
}
;
_.fireEvent = function fireEvent_2(event_0){
  !!this.handlerManager && $fireEvent(this.handlerManager, event_0);
}
;
_.getClass$ = function getClass_118(){
  return Lcom_google_gwt_user_client_ui_Widget_2_classLit;
}
;
_.isAttached = function isAttached(){
  return this.attached;
}
;
_.onAttach = function onAttach(){
  $onAttach(this);
}
;
_.onBrowserEvent = function onBrowserEvent(event_0){
  $onBrowserEvent(this, event_0);
}
;
_.onDetach = function onDetach(){
  $onDetach(this);
}
;
_.onLoad = function onLoad(){
}
;
_.onUnload = function onUnload(){
}
;
_.sinkEvents = function sinkEvents_1(eventBitsToAdd){
  this.eventsToSink == -1?sinkEvents(this.element_0, eventBitsToAdd | (this.element_0.__eventBits || 0)):(this.eventsToSink |= eventBitsToAdd);
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
_.attached = false;
_.eventsToSink = 0;
_.handlerManager = null;
_.parent_0 = null;
function $clear(this$static){
  var it;
  it = new WidgetCollection$WidgetIterator_0(this$static.children_0);
  while (it.index_0 < it.this$0.size - 1) {
    $next_3(it);
    $remove_5(it);
  }
}

function Panel(){
}

_ = Panel.prototype = new Widget;
_.doAttachChildren = function doAttachChildren_0(){
  tryCommand(this, ($clinit_250() , attachCommand));
}
;
_.doDetachChildren = function doDetachChildren_0(){
  tryCommand(this, ($clinit_250() , detachCommand));
}
;
_.getClass$ = function getClass_119(){
  return Lcom_google_gwt_user_client_ui_Panel_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1, 135:1};
function $add(this$static, child, container){
  $removeFromParent_0(child);
  $add_7(this$static.children_0, child);
  container.appendChild(child.element_0);
  $setParent(child, this$static);
}

function $remove_0(this$static, w){
  var elem;
  if (w.parent_0 != this$static) {
    return false;
  }
  try {
    $setParent(w, null);
  }
   finally {
    elem = w.element_0;
    $getParentElement(elem).removeChild(elem);
    $remove_4(this$static.children_0, w);
  }
  return true;
}

function ComplexPanel(){
}

_ = ComplexPanel.prototype = new Panel;
_.getClass$ = function getClass_120(){
  return Lcom_google_gwt_user_client_ui_ComplexPanel_2_classLit;
}
;
_.iterator_0 = function iterator_0(){
  return new WidgetCollection$WidgetIterator_0(this.children_0);
}
;
_.remove_0 = function remove_1(w){
  return $remove_0(this, w);
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1, 135:1};
function $add_0(this$static, w){
  $add(this$static, w, this$static.element_0);
}

function $remove_1(this$static, w){
  var removed;
  removed = $remove_0(this$static, w);
  removed && changeToStaticPositioning(w.element_0);
  return removed;
}

function changeToStaticPositioning(elem){
  elem.style['left'] = '';
  elem.style['top'] = '';
  elem.style['position'] = '';
}

function AbsolutePanel(){
}

_ = AbsolutePanel.prototype = new ComplexPanel;
_.getClass$ = function getClass_121(){
  return Lcom_google_gwt_user_client_ui_AbsolutePanel_2_classLit;
}
;
_.remove_0 = function remove_2(w){
  var removed;
  return removed = $remove_0(this, w) , removed && changeToStaticPositioning(w.element_0) , removed;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1, 135:1};
function AbstractImagePrototype(){
}

_ = AbstractImagePrototype.prototype = new Object_0;
_.getClass$ = function getClass_122(){
  return Lcom_google_gwt_user_client_ui_AbstractImagePrototype_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_250(){
  $clinit_250 = nullMethod;
  attachCommand = new AttachDetachException$1_0;
  detachCommand = new AttachDetachException$2_0;
}

function AttachDetachException_0(causes){
  UmbrellaException_0.call(this, causes);
}

function tryCommand(hasWidgets, c){
  var old;
  $clinit_250();
  var $e0, caught, e, w, w$iterator;
  caught = null;
  for (w$iterator = hasWidgets.iterator_0(); w$iterator.hasNext();) {
    w = dynamicCast(w$iterator.next_0(), 36);
    try {
      c.execute_0(w);
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 3)) {
        e = $e0;
        !caught && (caught = new HashSet_0);
        old = caught.map.put(e, caught);
      }
       else 
        throw $e0;
    }
  }
  if (caught) {
    throw new AttachDetachException_0(caught);
  }
}

function AttachDetachException(){
}

_ = AttachDetachException_0.prototype = AttachDetachException.prototype = new UmbrellaException;
_.getClass$ = function getClass_123(){
  return Lcom_google_gwt_user_client_ui_AttachDetachException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1};
var attachCommand, detachCommand;
function AttachDetachException$1_0(){
}

function AttachDetachException$1(){
}

_ = AttachDetachException$1_0.prototype = AttachDetachException$1.prototype = new Object_0;
_.execute_0 = function execute_2(w){
  w.onAttach();
}
;
_.getClass$ = function getClass_124(){
  return Lcom_google_gwt_user_client_ui_AttachDetachException$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function AttachDetachException$2_0(){
}

function AttachDetachException$2(){
}

_ = AttachDetachException$2_0.prototype = AttachDetachException$2.prototype = new Object_0;
_.execute_0 = function execute_3(w){
  w.onDetach();
}
;
_.getClass$ = function getClass_125(){
  return Lcom_google_gwt_user_client_ui_AttachDetachException$2_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_254(){
  $clinit_254 = nullMethod;
  $clinit_373();
}

function FocusWidget(){
}

_ = FocusWidget.prototype = new Widget;
_.getClass$ = function getClass_126(){
  return Lcom_google_gwt_user_client_ui_FocusWidget_2_classLit;
}
;
_.getTabIndex = function getTabIndex(){
  return $getTabIndex(this.element_0);
}
;
_.onAttach = function onAttach_0(){
  var tabIndex;
  $onAttach(this);
  tabIndex = this.getTabIndex();
  -1 == tabIndex && this.setTabIndex(0);
}
;
_.setTabIndex = function setTabIndex(index){
  this.element_0.tabIndex = index;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
function ButtonBase(){
}

_ = ButtonBase.prototype = new FocusWidget;
_.getClass$ = function getClass_127(){
  return Lcom_google_gwt_user_client_ui_ButtonBase_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
function Button_1(html){
  var e;
  $clinit_254();
  this.element_0 = (e = $doc.createElement('BUTTON') , e.setAttribute('type', 'button') , e);
  this.element_0['className'] = 'gwt-Button';
  this.element_0.innerHTML = html || '';
}

function Button_2(html, handler){
  $clinit_254();
  Button_1.call(this, html);
  $addDomHandler(this, handler, ($clinit_94() , $clinit_94() , TYPE_1));
}

function Button(){
}

_ = Button_2.prototype = Button_1.prototype = Button.prototype = new ButtonBase;
_.getClass$ = function getClass_128(){
  return Lcom_google_gwt_user_client_ui_Button_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
function CellPanel_0(){
  this.children_0 = new WidgetCollection_0(this);
  this.table = $doc.createElement('table');
  this.body_0 = $doc.createElement('tbody');
  this.table.appendChild(this.body_0);
  this.element_0 = this.table;
}

function CellPanel(){
}

_ = CellPanel.prototype = new ComplexPanel;
_.getClass$ = function getClass_129(){
  return Lcom_google_gwt_user_client_ui_CellPanel_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1, 135:1};
_.body_0 = null;
_.table = null;
function $addValueChangeHandler_0(this$static, handler){
  if (!this$static.valueChangeHandlerInitialized) {
    this$static.ensureDomEventHandlers();
    this$static.valueChangeHandlerInitialized = true;
  }
  return $addHandler_1(this$static, handler, (!TYPE_14 && (TYPE_14 = new GwtEvent$Type_0) , TYPE_14));
}

function $getValue_0(this$static){
  return this$static.attached?($clinit_382() , this$static.inputElem.checked?TRUE:FALSE):($clinit_382() , this$static.inputElem.defaultChecked?TRUE:FALSE);
}

function $setValue_1(this$static, value){
  var oldValue;
  !value && (value = ($clinit_382() , FALSE));
  oldValue = this$static.attached?($clinit_382() , this$static.inputElem.checked?TRUE:FALSE):($clinit_382() , this$static.inputElem.defaultChecked?TRUE:FALSE);
  this$static.inputElem.checked = value.value_0;
  this$static.inputElem.defaultChecked = value.value_0;
  if (!!oldValue && oldValue.value_0 == value.value_0) {
    return;
  }
}

function CheckBox_1(label){
  var e;
  $clinit_254();
  CheckBox_2.call(this, (e = $doc.createElement('INPUT') , e.type = 'checkbox' , e));
  this.element_0['className'] = 'gwt-CheckBox';
  this.labelElem.textContent = label || '';
}

function CheckBox_2(elem){
  var uid;
  this.element_0 = $doc.createElement('span');
  this.inputElem = elem;
  this.labelElem = $doc.createElement('label');
  this.element_0.appendChild(this.inputElem);
  this.element_0.appendChild(this.labelElem);
  uid = $createUniqueId($doc);
  this.inputElem['id'] = uid;
  this.labelElem.htmlFor = uid;
  !!this.inputElem && (this.inputElem.tabIndex = 0 , undefined);
}

function CheckBox(){
}

_ = CheckBox_1.prototype = CheckBox.prototype = new ButtonBase;
_.ensureDomEventHandlers = function ensureDomEventHandlers(){
  $addDomHandler(this, new CheckBox$1_0(this), ($clinit_94() , $clinit_94() , TYPE_1));
}
;
_.getClass$ = function getClass_130(){
  return Lcom_google_gwt_user_client_ui_CheckBox_2_classLit;
}
;
_.getTabIndex = function getTabIndex_0(){
  return $getTabIndex(this.inputElem);
}
;
_.onLoad = function onLoad_0(){
  this.inputElem.__listener = this;
}
;
_.onUnload = function onUnload_0(){
  this.inputElem.__listener = null;
  $setValue_1(this, this.attached?($clinit_382() , this.inputElem.checked?TRUE:FALSE):($clinit_382() , this.inputElem.defaultChecked?TRUE:FALSE));
}
;
_.setTabIndex = function setTabIndex_0(index){
  !!this.inputElem && (this.inputElem.tabIndex = index , undefined);
}
;
_.sinkEvents = function sinkEvents_2(eventBitsToAdd){
  this.eventsToSink == -1?sinkEvents_0(this.inputElem, eventBitsToAdd | (this.inputElem.__eventBits || 0)):this.eventsToSink == -1?sinkEvents(this.element_0, eventBitsToAdd | (this.element_0.__eventBits || 0)):(this.eventsToSink |= eventBitsToAdd);
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
_.inputElem = null;
_.labelElem = null;
_.valueChangeHandlerInitialized = false;
function CheckBox$1_0(this$0){
  this.this$0 = this$0;
}

function CheckBox$1(){
}

_ = CheckBox$1_0.prototype = CheckBox$1.prototype = new Object_0;
_.getClass$ = function getClass_131(){
  return Lcom_google_gwt_user_client_ui_CheckBox$1_2_classLit;
}
;
_.onClick = function onClick(event_0){
  fire_3(this.this$0, $getValue_0(this.this$0));
}
;
_.castableTypeMap$ = {8:1, 25:1};
_.this$0 = null;
function $initWidget(this$static, widget){
  if (this$static.widget) {
    throw new IllegalStateException_1('Composite.initWidget() may only be called once.');
  }
  $removeFromParent_0(widget);
  $setElement_0(this$static, widget.element_0);
  this$static.widget = widget;
  $setParent(widget, this$static);
}

function Composite(){
}

_ = Composite.prototype = new Widget;
_.getClass$ = function getClass_132(){
  return Lcom_google_gwt_user_client_ui_Composite_2_classLit;
}
;
_.isAttached = function isAttached_0(){
  if (this.widget) {
    return this.widget.isAttached();
  }
  return false;
}
;
_.onAttach = function onAttach_1(){
  if (this.eventsToSink != -1) {
    this.widget.sinkEvents(this.eventsToSink);
    this.eventsToSink = -1;
  }
  this.widget.onAttach();
  this.element_0.__listener = this;
}
;
_.onBrowserEvent = function onBrowserEvent_0(event_0){
  $onBrowserEvent(this, event_0);
  this.widget.onBrowserEvent(event_0);
}
;
_.onDetach = function onDetach_0(){
  this.widget.onDetach();
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
_.widget = null;
function $add_1(this$static, w){
  if (this$static.getWidget()) {
    throw new IllegalStateException_1('SimplePanel can only contain one child widget');
  }
  this$static.setWidget(w);
}

function $remove_2(this$static, w){
  if (this$static.widget != w) {
    return false;
  }
  try {
    $setParent(w, null);
  }
   finally {
    this$static.getContainerElement().removeChild(w.element_0);
    this$static.widget = null;
  }
  return true;
}

function $setWidget(this$static, w){
  if (w == this$static.widget) {
    return;
  }
  !!w && $removeFromParent_0(w);
  !!this$static.widget && this$static.remove_0(this$static.widget);
  this$static.widget = w;
  if (w) {
    this$static.getContainerElement().appendChild(this$static.widget.element_0);
    $setParent(w, this$static);
  }
}

function SimplePanel_0(){
  this.element_0 = $doc.createElement('div');
}

function SimplePanel(){
}

_ = SimplePanel_0.prototype = SimplePanel.prototype = new Panel;
_.getClass$ = function getClass_133(){
  return Lcom_google_gwt_user_client_ui_SimplePanel_2_classLit;
}
;
_.getContainerElement = function getContainerElement(){
  return this.element_0;
}
;
_.getWidget = function getWidget(){
  return this.widget;
}
;
_.iterator_0 = function iterator_1(){
  return new SimplePanel$1_0(this);
}
;
_.remove_0 = function remove_3(w){
  return $remove_2(this, w);
}
;
_.setWidget = function setWidget(w){
  $setWidget(this, w);
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1, 135:1};
_.widget = null;
function $addAutoHidePartner(this$static, partner){
  !this$static.autoHidePartners && (this$static.autoHidePartners = new ArrayList_0);
  $add_9(this$static.autoHidePartners, partner);
}

function $eventTargetsPartner(this$static, event_0){
  var elem, elem$iterator, target;
  if (!this$static.autoHidePartners) {
    return false;
  }
  target = event_0.target;
  if (is_0(target)) {
    for (elem$iterator = new AbstractList$IteratorImpl_0(this$static.autoHidePartners); elem$iterator.i < elem$iterator.this$0_0.size_0();) {
      elem = dynamicCastJso($next_6(elem$iterator));
      if ($isOrHasChild(elem, target)) {
        return true;
      }
    }
  }
  return false;
}

function $eventTargetsPopup(this$static, event_0){
  var target;
  target = event_0.target;
  if (is_0(target)) {
    return $isOrHasChild(this$static.element_0, target);
  }
  return false;
}

function $hide(this$static, autoClosed){
  if (!this$static.showing) {
    return;
  }
  $setState(this$static.resizeAnimation, false, false);
  fire_0(this$static, autoClosed);
}

function $maybeUpdateSize(this$static){
  var w;
  w = this$static.widget;
  if (w) {
    this$static.desiredHeight != null && w.setHeight(this$static.desiredHeight);
    this$static.desiredWidth != null && w.setWidth(this$static.desiredWidth);
  }
}

function $position(this$static, relativeObject, offsetWidth, offsetHeight){
  var distanceFromWindowLeft, distanceFromWindowTop, distanceToWindowBottom, distanceToWindowRight, left, offsetWidthDiff, textBoxOffsetWidth, top_0, windowBottom, windowLeft, windowRight, windowTop;
  textBoxOffsetWidth = parseInt(relativeObject.element_0['offsetWidth']) || 0;
  offsetWidthDiff = offsetWidth - textBoxOffsetWidth;
  $clinit_176();
  left = $getAbsoluteLeft(relativeObject.element_0);
  if (offsetWidthDiff > 0) {
    windowRight = $getClientWidth($doc) + $getScrollLeft_0($doc.body);
    windowLeft = $getScrollLeft_0($doc.body);
    distanceToWindowRight = windowRight - left;
    distanceFromWindowLeft = left - windowLeft;
    distanceToWindowRight < offsetWidth && distanceFromWindowLeft >= offsetWidthDiff && (left -= offsetWidthDiff);
  }
  top_0 = $getAbsoluteTop(relativeObject.element_0);
  windowTop = $doc.body.scrollTop || 0;
  windowBottom = ($doc.body.scrollTop || 0) + $getClientHeight($doc);
  distanceFromWindowTop = top_0 - windowTop;
  distanceToWindowBottom = windowBottom - (top_0 + (parseInt(relativeObject.element_0['offsetHeight']) || 0));
  distanceToWindowBottom < offsetHeight && distanceFromWindowTop >= offsetHeight?(top_0 -= offsetHeight):(top_0 += parseInt(relativeObject.element_0['offsetHeight']) || 0);
  $setPopupPosition(this$static, left, top_0);
}

function $previewNativeEvent(this$static, event_0){
  var eventTargetsPopupOrPartner, nativeEvent, target, type;
  if (event_0.isCanceled || !this$static.previewAllNativeEvents && event_0.isConsumed) {
    this$static.modal && (event_0.isCanceled = true);
    return;
  }
  this$static.onPreviewNativeEvent(event_0);
  if (event_0.isCanceled) {
    return;
  }
  nativeEvent = event_0.nativeEvent;
  eventTargetsPopupOrPartner = $eventTargetsPopup(this$static, nativeEvent) || $eventTargetsPartner(this$static, nativeEvent);
  eventTargetsPopupOrPartner && (event_0.isConsumed = true);
  this$static.modal && (event_0.isCanceled = true);
  type = $eventGetTypeInt(nativeEvent.type);
  switch (type) {
    case 128:
      {
        return;
      }

    case 512:
      {
        return;
      }

    case 256:
      {
        return;
      }

    case 4:
      if (!eventTargetsPopupOrPartner && this$static.autoHide) {
        $hide(this$static, true);
        return;
      }

      break;
    case 2048:
      {
        target = nativeEvent.target;
        if (this$static.modal && !eventTargetsPopupOrPartner && !!target) {
          target.blur && target != $doc.body && target.blur();
          event_0.isCanceled = true;
          return;
        }
        break;
      }

  }
}

function $removeAutoHidePartner(this$static, partner){
  !!this$static.autoHidePartners && $remove_11(this$static.autoHidePartners, partner);
}

function $setPopupPosition(this$static, left, top_0){
  var elem;
  this$static.leftPosition = left;
  this$static.topPosition = top_0;
  left -= $getBodyOffsetLeft_0($doc);
  top_0 -= $getBodyOffsetTop_0($doc);
  elem = this$static.element_0;
  elem.style['left'] = left + ($clinit_68() , 'px');
  elem.style['top'] = top_0 + 'px';
}

function $setPopupPositionAndShow(this$static, callback){
  this$static.element_0.style['visibility'] = 'hidden';
  $show(this$static);
  callback.setPosition(parseInt(this$static.element_0['offsetWidth']) || 0, parseInt(this$static.element_0['offsetHeight']) || 0);
  this$static.element_0.style['visibility'] = 'visible';
}

function $show(this$static){
  if (this$static.showing) {
    return;
  }
   else 
    this$static.attached && $removeFromParent_0(this$static);
  $setState(this$static.resizeAnimation, true, false);
}

function $showRelativeTo(this$static, target){
  $setPopupPositionAndShow(this$static, new PopupPanel$2_0(this$static, target));
}

function $updateHandlers(this$static){
  if (this$static.nativePreviewHandlerRegistration) {
    $removeHandler(this$static.nativePreviewHandlerRegistration);
    this$static.nativePreviewHandlerRegistration = null;
  }
  if (this$static.historyHandlerRegistration) {
    $removeHandler(this$static.historyHandlerRegistration);
    this$static.historyHandlerRegistration = null;
  }
  if (this$static.showing) {
    this$static.nativePreviewHandlerRegistration = addNativePreviewHandler(new PopupPanel$3_0(this$static));
    this$static.historyHandlerRegistration = addValueChangeHandler(new PopupPanel$4_0(this$static));
  }
}

function PopupPanel_1(){
  var parent_0;
  this.element_0 = $doc.createElement('div');
  this.glassResizer = new PopupPanel$1_0;
  this.animType = ($clinit_325() , CENTER);
  this.resizeAnimation = new PopupPanel$ResizeAnimation_0(this);
  this.element_0.appendChild($doc.createElement('div'));
  $setPopupPosition(this, 0, 0);
  (parent_0 = $getFirstChildElement(this.element_0).parentNode , (!parent_0 || parent_0.nodeType != 1) && (parent_0 = null) , parent_0)['className'] = 'gwt-PopupPanel';
  $getFirstChildElement(this.element_0)['className'] = 'popupContent';
  this.autoHide = true;
  this.autoHideOnHistoryEvents = true;
}

function PopupPanel(){
}

_ = PopupPanel_1.prototype = PopupPanel.prototype = new SimplePanel;
_.getClass$ = function getClass_134(){
  return Lcom_google_gwt_user_client_ui_PopupPanel_2_classLit;
}
;
_.getContainerElement = function getContainerElement_0(){
  return $getFirstChildElement(this.element_0);
}
;
_.getStyleElement = function getStyleElement_0(){
  var parent_0;
  return parent_0 = $getFirstChildElement(this.element_0).parentNode , (!parent_0 || parent_0.nodeType != 1) && (parent_0 = null) , parent_0;
}
;
_.onPreviewNativeEvent = function onPreviewNativeEvent(event_0){
}
;
_.onUnload = function onUnload_1(){
  this.showing && $setState(this.resizeAnimation, false, true);
}
;
_.setHeight = function setHeight_0(height){
  this.desiredHeight = height;
  $maybeUpdateSize(this);
  height.length == 0 && (this.desiredHeight = null);
}
;
_.setWidget = function setWidget_0(w){
  $setWidget(this, w);
  $maybeUpdateSize(this);
}
;
_.setWidth = function setWidth_0(width){
  this.desiredWidth = width;
  $maybeUpdateSize(this);
  width.length == 0 && (this.desiredWidth = null);
}
;
_.castableTypeMap$ = {35:1, 36:1, 37:1, 38:1, 50:1, 51:1, 55:1, 135:1};
_.autoHide = false;
_.autoHideOnHistoryEvents = false;
_.autoHidePartners = null;
_.desiredHeight = null;
_.desiredWidth = null;
_.glass = null;
_.historyHandlerRegistration = null;
_.isAnimationEnabled = false;
_.isGlassEnabled = false;
_.leftPosition = -1;
_.modal = false;
_.nativePreviewHandlerRegistration = null;
_.previewAllNativeEvents = false;
_.showing = false;
_.topPosition = -1;
function $setWidget_1(this$static, w){
  $setWidget(this$static.decPanel, w);
  $maybeUpdateSize(this$static);
}

function DecoratedPopupPanel_0(prefix){
  var rowStyles, parent_1;
  PopupPanel_1.call(this);
  this.modal = false;
  rowStyles = initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, [prefix + 'Top', prefix + 'Middle', prefix + 'Bottom']);
  this.decPanel = new DecoratorPanel_0(rowStyles);
  this.decPanel.getStyleElement()['className'] = '';
  setStylePrimaryName((parent_1 = $getFirstChildElement(this.element_0).parentNode , (!parent_1 || parent_1.nodeType != 1) && (parent_1 = null) , parent_1), 'gwt-DecoratedPopupPanel');
  $setWidget(this, this.decPanel);
  $maybeUpdateSize(this);
  setStyleName_0($getFirstChildElement(this.element_0), 'popupContent', false);
  setStyleName_0(this.decPanel.containerElem, prefix + 'Content', true);
}

function DecoratedPopupPanel(){
}

_ = DecoratedPopupPanel_0.prototype = DecoratedPopupPanel.prototype = new PopupPanel;
_.doAttachChildren = function doAttachChildren_1(){
  $onAttach(this.decPanel);
}
;
_.doDetachChildren = function doDetachChildren_1(){
  $onDetach(this.decPanel);
}
;
--></script>
<script><!--
_.getClass$ = function getClass_135(){
  return Lcom_google_gwt_user_client_ui_DecoratedPopupPanel_2_classLit;
}
;
_.getWidget = function getWidget_0(){
  return this.decPanel.widget;
}
;
_.iterator_0 = function iterator_2(){
  return new SimplePanel$1_0(this.decPanel);
}
;
_.remove_0 = function remove_4(w){
  return $remove_2(this.decPanel, w);
}
;
_.setWidget = function setWidget_1(w){
  $setWidget(this.decPanel, w);
  $maybeUpdateSize(this);
}
;
_.castableTypeMap$ = {35:1, 36:1, 37:1, 38:1, 50:1, 51:1, 55:1, 135:1};
_.decPanel = null;
function DecoratorPanel_0(rowStyles){
  var i, row, table, trElem;
  this.element_0 = $doc.createElement('table');
  table = this.element_0;
  this.tbody = $doc.createElement('tbody');
  table.appendChild(this.tbody);
  table['cellSpacing'] = 0;
  table['cellPadding'] = 0;
  for (i = 0; i < rowStyles.length; ++i) {
    row = (trElem = $doc.createElement('tr') , trElem['className'] = rowStyles[i] , $clinit_176() , trElem.appendChild(createTD(rowStyles[i] + 'Left')) , trElem.appendChild(createTD(rowStyles[i] + 'Center')) , trElem.appendChild(createTD(rowStyles[i] + 'Right')) , trElem);
    this.tbody.appendChild(row);
    i == 1 && (this.containerElem = $getFirstChildElement($getChild(row, 1)));
  }
  this.element_0['className'] = 'gwt-DecoratorPanel';
}

function createTD(styleName){
  var inner, tdElem;
  tdElem = $doc.createElement('td');
  inner = $doc.createElement('div');
  tdElem.appendChild(inner);
  tdElem['className'] = styleName;
  inner['className'] = styleName + 'Inner';
  return tdElem;
}

function DecoratorPanel(){
}

_ = DecoratorPanel_0.prototype = DecoratorPanel.prototype = new SimplePanel;
_.getClass$ = function getClass_136(){
  return Lcom_google_gwt_user_client_ui_DecoratorPanel_2_classLit;
}
;
_.getContainerElement = function getContainerElement_1(){
  return this.containerElem;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1, 135:1};
_.containerElem = null;
_.tbody = null;
function $setTextOrHtml(this$static, content_0, isHtml){
  isHtml?(this$static.element.innerHTML = content_0 || '' , undefined):(this$static.element.textContent = content_0 || '' , undefined);
  if (this$static.textDir != this$static.initialElementDir) {
    this$static.textDir = this$static.initialElementDir;
    setDirectionOnElement(this$static.element, this$static.initialElementDir);
  }
}

function DirectionalTextHelper_0(element){
  this.element = element;
  this.initialElementDir = getDirectionOnElement(element);
  this.textDir = this.initialElementDir;
}

function DirectionalTextHelper(){
}

_ = DirectionalTextHelper_0.prototype = DirectionalTextHelper.prototype = new Object_0;
_.getClass$ = function getClass_137(){
  return Lcom_google_gwt_user_client_ui_DirectionalTextHelper_2_classLit;
}
;
_.castableTypeMap$ = {};
_.element = null;
_.initialElementDir = null;
_.textDir = null;
function $add_2(this$static, w){
  $add(this$static, w, this$static.element_0);
}

function FlowPanel_0(){
  this.children_0 = new WidgetCollection_0(this);
  this.element_0 = $doc.createElement('div');
}

function FlowPanel(){
}

_ = FlowPanel_0.prototype = FlowPanel.prototype = new ComplexPanel;
_.getClass$ = function getClass_138(){
  return Lcom_google_gwt_user_client_ui_FlowPanel_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1, 135:1};
function $clinit_268(){
  $clinit_268 = nullMethod;
  impl_0 = ($clinit_373() , $clinit_373() , implPanel);
}

var impl_0;
function LabelBase_2(element){
  this.element_0 = element;
  this.directionalTextHelper = new DirectionalTextHelper_0(this.element_0);
}

function LabelBase(){
}

_ = LabelBase.prototype = new Widget;
_.getClass$ = function getClass_139(){
  return Lcom_google_gwt_user_client_ui_LabelBase_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
_.directionalTextHelper = null;
function Label_0(){
  this.element_0 = $doc.createElement('div');
  this.directionalTextHelper = new DirectionalTextHelper_0(this.element_0);
  this.element_0['className'] = 'gwt-Label';
}

function Label_1(text){
  Label_0.call(this);
  $setTextOrHtml(this.directionalTextHelper, text, false);
}

function Label_2(element){
  LabelBase_2.call(this, element, $equalsIgnoreCase('span', element.tagName));
}

function Label(){
}

_ = Label_1.prototype = Label_0.prototype = Label.prototype = new LabelBase;
_.getClass$ = function getClass_140(){
  return Lcom_google_gwt_user_client_ui_Label_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
function HTML_0(){
  Label_2.call(this, $doc.createElement('div'));
  this.element_0['className'] = 'gwt-HTML';
}

function HTML_1(html){
  HTML_0.call(this);
  $setTextOrHtml(this.directionalTextHelper, html, true);
}

function HTML(){
}

_ = HTML_1.prototype = HTML_0.prototype = HTML.prototype = new Label;
_.getClass$ = function getClass_141(){
  return Lcom_google_gwt_user_client_ui_HTML_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
function HTMLPanel_0(html){
  this.children_0 = new WidgetCollection_0(this);
  this.element_0 = $doc.createElement('div');
  this.element_0.innerHTML = html || '';
}

function HTMLPanel(){
}

_ = HTMLPanel_0.prototype = HTMLPanel.prototype = new ComplexPanel;
_.getClass$ = function getClass_142(){
  return Lcom_google_gwt_user_client_ui_HTMLPanel_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1, 135:1};
function $clinit_283(){
  $clinit_283 = nullMethod;
  new HasHorizontalAlignment$HorizontalAlignmentConstant_0('center');
  new HasHorizontalAlignment$HorizontalAlignmentConstant_0('justify');
  ALIGN_LEFT = new HasHorizontalAlignment$HorizontalAlignmentConstant_0('left');
  new HasHorizontalAlignment$HorizontalAlignmentConstant_0('right');
  ALIGN_LOCALE_START = ($clinit_176() , ALIGN_LEFT);
  ALIGN_DEFAULT = ALIGN_LOCALE_START;
}

var ALIGN_DEFAULT, ALIGN_LEFT, ALIGN_LOCALE_START;
function HasHorizontalAlignment$AutoHorizontalAlignmentConstant(){
}

_ = HasHorizontalAlignment$AutoHorizontalAlignmentConstant.prototype = new Object_0;
_.getClass$ = function getClass_143(){
  return Lcom_google_gwt_user_client_ui_HasHorizontalAlignment$AutoHorizontalAlignmentConstant_2_classLit;
}
;
_.castableTypeMap$ = {};
function HasHorizontalAlignment$HorizontalAlignmentConstant_0(textAlignString){
  this.textAlignString = textAlignString;
}

function HasHorizontalAlignment$HorizontalAlignmentConstant(){
}

_ = HasHorizontalAlignment$HorizontalAlignmentConstant_0.prototype = HasHorizontalAlignment$HorizontalAlignmentConstant.prototype = new HasHorizontalAlignment$AutoHorizontalAlignmentConstant;
_.getClass$ = function getClass_144(){
  return Lcom_google_gwt_user_client_ui_HasHorizontalAlignment$HorizontalAlignmentConstant_2_classLit;
}
;
_.castableTypeMap$ = {};
_.textAlignString = null;
function $clinit_290(){
  $clinit_290 = nullMethod;
  new HasVerticalAlignment$VerticalAlignmentConstant_0('bottom');
  ALIGN_MIDDLE = new HasVerticalAlignment$VerticalAlignmentConstant_0('middle');
  ALIGN_TOP = new HasVerticalAlignment$VerticalAlignmentConstant_0('top');
}

var ALIGN_MIDDLE, ALIGN_TOP;
function HasVerticalAlignment$VerticalAlignmentConstant_0(verticalAlignString){
  this.verticalAlignString = verticalAlignString;
}

function HasVerticalAlignment$VerticalAlignmentConstant(){
}

_ = HasVerticalAlignment$VerticalAlignmentConstant_0.prototype = HasVerticalAlignment$VerticalAlignmentConstant.prototype = new Object_0;
_.getClass$ = function getClass_145(){
  return Lcom_google_gwt_user_client_ui_HasVerticalAlignment$VerticalAlignmentConstant_2_classLit;
}
;
_.castableTypeMap$ = {};
_.verticalAlignString = null;
function $add_3(this$static, w){
  var td, td_0;
  td = (td_0 = $doc.createElement('td') , td_0['align'] = this$static.horzAlign.textAlignString , td_0.style['verticalAlign'] = this$static.vertAlign.verticalAlignString , td_0);
  this$static.tableRow.appendChild(td);
  $removeFromParent_0(w);
  $add_7(this$static.children_0, w);
  td.appendChild(w.element_0);
  $setParent(w, this$static);
}

function HorizontalPanel_0(){
  CellPanel_0.call(this);
  this.horzAlign = ($clinit_283() , ALIGN_DEFAULT);
  this.vertAlign = ($clinit_290() , ALIGN_TOP);
  this.tableRow = $doc.createElement('tr');
  this.body_0.appendChild(this.tableRow);
  this.table['cellSpacing'] = '0';
  this.table['cellPadding'] = '0';
}

function HorizontalPanel(){
}

_ = HorizontalPanel_0.prototype = HorizontalPanel.prototype = new CellPanel;
_.getClass$ = function getClass_146(){
  return Lcom_google_gwt_user_client_ui_HorizontalPanel_2_classLit;
}
;
_.remove_0 = function remove_5(w){
  var removed, td, parent_0;
  td = (parent_0 = w.element_0.parentNode , (!parent_0 || parent_0.nodeType != 1) && (parent_0 = null) , parent_0);
  removed = $remove_0(this, w);
  removed && this.tableRow.removeChild(td);
  return removed;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1, 135:1};
_.tableRow = null;
function $clinit_296(){
  $clinit_296 = nullMethod;
  prefetchImages = new HashMap_0;
}

function $setUrl(this$static, url){
  !!this$static.state && (this$static.element_0['__gwtLastUnhandledEvent'] = '' , undefined);
  this$static.element_0.src = url;
}

function Image_1(){
  $clinit_296();
  this.state = new Image$UnclippedState_0(this);
  this.element_0['className'] = 'gwt-Image';
}

function Image_0(){
}

_ = Image_1.prototype = Image_0.prototype = new Widget;
_.getClass$ = function getClass_147(){
  return Lcom_google_gwt_user_client_ui_Image_2_classLit;
}
;
_.onBrowserEvent = function onBrowserEvent_1(event_0){
  $eventGetTypeInt(event_0.type) == 32768 && !!this.state && (this.element_0['__gwtLastUnhandledEvent'] = '' , undefined);
  $onBrowserEvent(this, event_0);
}
;
_.onLoad = function onLoad_1(){
  var unhandledEvent;
  unhandledEvent = $getPropertyString(this.element_0, '__gwtLastUnhandledEvent');
  $equals_3('load', unhandledEvent) && addCommand(new Image$State$1_0(this));
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
_.state = null;
var prefetchImages;
function Image$State(){
}

_ = Image$State.prototype = new Object_0;
_.getClass$ = function getClass_148(){
  return Lcom_google_gwt_user_client_ui_Image$State_2_classLit;
}
;
_.castableTypeMap$ = {};
function Image$State$1_0(val$image){
  this.val$image = val$image;
}

function Image$State$1(){
}

_ = Image$State$1_0.prototype = Image$State$1.prototype = new Object_0;
_.execute = function execute_4(){
  var evt, evt_0;
  evt = (evt_0 = $doc.createEvent('HTMLEvents') , evt_0.initEvent('load', false, false) , evt_0);
  this.val$image.element_0.dispatchEvent(evt);
}
;
_.getClass$ = function getClass_149(){
  return Lcom_google_gwt_user_client_ui_Image$State$1_2_classLit;
}
;
_.castableTypeMap$ = {28:1, 32:1};
_.val$image = null;
function Image$UnclippedState_0(image){
  $replaceElement(image, $doc.createElement('img'));
  sinkEvents_0(image.element_0, 32768);
  image.eventsToSink == -1?sinkEvents(image.element_0, 229503 | (image.element_0.__eventBits || 0)):(image.eventsToSink |= 229503);
}

function Image$UnclippedState(){
}

_ = Image$UnclippedState_0.prototype = Image$UnclippedState.prototype = new Image$State;
_.getClass$ = function getClass_150(){
  return Lcom_google_gwt_user_client_ui_Image$UnclippedState_2_classLit;
}
;
_.castableTypeMap$ = {};
function InlineLabel_1(text){
  Label_2.call(this, $doc.createElement('span'));
  this.element_0['className'] = 'gwt-InlineLabel';
  $setTextOrHtml(this.directionalTextHelper, text, false);
}

function InlineLabel(){
}

_ = InlineLabel_1.prototype = InlineLabel.prototype = new Label;
_.getClass$ = function getClass_151(){
  return Lcom_google_gwt_user_client_ui_InlineLabel_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
function $addItem(this$static, item){
  $insertItem(this$static, item, item);
}

function $checkIndex(this$static){
  if (0 >= this$static.element_0.children.length) {
    throw new IndexOutOfBoundsException_0;
  }
}

function $insertItem(this$static, item, value){
  var option, select;
  select = this$static.element_0;
  option = $doc.createElement('option');
  option.text = item;
  option.value = value;
  select.add(option, null);
}

function $isItemSelected(this$static){
  $checkIndex(this$static);
  return !!this$static.element_0.children[0].selected;
}

function ListBox_0(){
  $clinit_254();
  this.element_0 = $doc.createElement('select');
  this.element_0['className'] = 'gwt-ListBox';
}

function ListBox(){
}

_ = ListBox_0.prototype = ListBox.prototype = new FocusWidget;
_.getClass$ = function getClass_152(){
  return Lcom_google_gwt_user_client_ui_ListBox_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
function ListenerWrapper(){
}

_ = ListenerWrapper.prototype = new BaseListenerWrapper;
_.getClass$ = function getClass_153(){
  return Lcom_google_gwt_user_client_ui_ListenerWrapper_2_classLit;
}
;
_.castableTypeMap$ = {25:1};
function ListenerWrapper$WrappedPopupListener_0(listener){
  this.listener = listener;
}

function ListenerWrapper$WrappedPopupListener(){
}

_ = ListenerWrapper$WrappedPopupListener_0.prototype = ListenerWrapper$WrappedPopupListener.prototype = new ListenerWrapper;
_.getClass$ = function getClass_154(){
  return Lcom_google_gwt_user_client_ui_ListenerWrapper$WrappedPopupListener_2_classLit;
}
;
_.onClose = function onClose_0(event_0){
  $onPopupClosed(this.listener, (dynamicCast(event_0.source, 37) , event_0.autoClosed));
}
;
_.castableTypeMap$ = {20:1, 25:1};
function $addItem_0(this$static, item){
  return $insertItem_0(this$static, item, this$static.allItems.size);
}

function $addItemElement(this$static, beforeIndex, tdElem){
  var tr;
  if (this$static.vertical) {
    tr = $doc.createElement('tr');
    $insertChild(this$static.body_0, tr, beforeIndex);
    tr.appendChild(tdElem);
  }
   else {
    tr = $getChild(this$static.body_0, 0);
    $insertChild(tr, tdElem, beforeIndex);
  }
}

function $clearItems(this$static){
  var container, item, item$iterator;
  $selectItem(this$static, null);
  container = this$static.vertical?this$static.body_0:$getChild(this$static.body_0, 0);
  while ($getChildCount(container) > 0) {
    container.removeChild($getChild(container, 0));
  }
  for (item$iterator = new AbstractList$IteratorImpl_0(this$static.allItems); item$iterator.i < item$iterator.this$0_0.size_0();) {
    item = dynamicCast($next_6(item$iterator), 38);
    item.element_0['colSpan'] = 1;
    dynamicCast(item, 39).parentMenu = null;
  }
  $clear_2(this$static.items);
  $clear_2(this$static.allItems);
}

function $doItemAction(this$static, item, fireCommand){
  var cmd, primaryStyleName;
  $selectItem(this$static, item);
  if (item) {
    if (fireCommand && !!item.command) {
      $selectItem(this$static, null);
      cmd = item.command;
      $scheduleFinally(($clinit_18() , INSTANCE), new MenuBar$1_0(cmd));
    }
     else 
      item.subMenu != null && (this$static.popup = new MenuBar$3_0(this$static, item) , this$static.popup.animType = ($clinit_325() , ONE_WAY_CORNER) , this$static.popup.isAnimationEnabled = false , this$static.popup.getStyleElement()['className'] = 'gwt-MenuBarPopup' , primaryStyleName = getStylePrimaryName(this$static.element_0) , $equals_3('gwt-MenuBar', primaryStyleName) || $setStyleName(this$static.popup, primaryStyleName + 'Popup', true) , $addHandler_1(this$static.popup, new ListenerWrapper$WrappedPopupListener_0(this$static), TYPE_11?TYPE_11:(TYPE_11 = new GwtEvent$Type_0)) , this$static.shownChildMenu = item.subMenu , item.subMenu.nullField = this$static , $setPopupPositionAndShow(this$static.popup, new MenuBar$4_0(this$static, item)) , undefined);
  }
}

function $findItem(this$static, hItem){
  var item, item$iterator;
  for (item$iterator = new AbstractList$IteratorImpl_0(this$static.items); item$iterator.i < item$iterator.this$0_0.size_0();) {
    item = dynamicCast($next_6(item$iterator), 39);
    if ($isOrHasChild(item.element_0, hItem)) {
      return item;
    }
  }
  return null;
}

function $init_1(this$static, vertical){
  var outer, table, tr;
  table = $doc.createElement('table');
  this$static.body_0 = $doc.createElement('tbody');
  table.appendChild(this$static.body_0);
  if (!vertical) {
    tr = $doc.createElement('tr');
    this$static.body_0.appendChild(tr);
  }
  this$static.vertical = vertical;
  outer = ($clinit_268() , createFocusable0(($clinit_373() , focusHandler_0)?focusHandler_0:(focusHandler_0 = $createFocusHandler())));
  outer.appendChild(table);
  this$static.element_0 = outer;
  this$static.element_0.setAttribute('role', 'menubar');
  this$static.eventsToSink == -1?sinkEvents(this$static.element_0, 2225 | (this$static.element_0.__eventBits || 0)):(this$static.eventsToSink |= 2225);
  this$static.element_0['className'] = 'gwt-MenuBar';
  vertical?$setStyleName(this$static, getStylePrimaryName(this$static.element_0) + '-vertical', true):$setStyleName(this$static, getStylePrimaryName(this$static.element_0) + '-horizontal', true);
  this$static.element_0.style['outline'] = '0px';
  this$static.element_0.setAttribute('hideFocus', 'true');
  $addDomHandler(this$static, new MenuBar$2_0(this$static), ($clinit_89() , $clinit_89() , TYPE));
}

function $insertItem_0(this$static, item, beforeIndex){
  var i, itemsIndex;
  if (beforeIndex < 0 || beforeIndex > this$static.allItems.size) {
    throw new IndexOutOfBoundsException_0;
  }
  $add_10(this$static.allItems, beforeIndex, item);
  itemsIndex = 0;
  for (i = 0; i < beforeIndex; ++i) {
    instanceOf($get_3(this$static.allItems, i), 39) && ++itemsIndex;
  }
  $add_10(this$static.items, itemsIndex, item);
  $addItemElement(this$static, beforeIndex, item.element_0);
  item.parentMenu = this$static;
  $setStyleName(item, getStylePrimaryName(item.element_0) + '-selected', false);
  $updateSubmenuIcon(this$static, item);
  return item;
}

function $itemOver(this$static, item, focus_0){
  if (!item) {
    if (!!this$static.selectedItem && this$static.shownChildMenu == this$static.selectedItem.subMenu) {
      return;
    }
  }
  $selectItem(this$static, item);
  focus_0 && this$static.focusOnHover && $focus_0(($clinit_268() , this$static.element_0));
  !!item && this$static.autoOpen && $doItemAction(this$static, item, false);
}

function $moveSelectionDown(this$static){
  if ($selectFirstItemIfNoneSelected(this$static)) {
    return;
  }
  if (this$static.vertical) {
    $selectNextItem(this$static);
  }
   else {
    if (this$static.selectedItem.subMenu != null && !null.nullMethod().nullMethod()) {
      $doItemAction(this$static, this$static.selectedItem, false);
      null.nullMethod();
    }
  }
}

function $moveSelectionUp(this$static){
  if ($selectFirstItemIfNoneSelected(this$static)) {
    return;
  }
  this$static.vertical?$selectPrevItem(this$static):undefined;
}

function $moveToNextItem(this$static){
  if ($selectFirstItemIfNoneSelected(this$static)) {
    return;
  }
  if (this$static.vertical) {
    if (this$static.selectedItem.subMenu != null && !null.nullMethod().nullMethod()) {
      $doItemAction(this$static, this$static.selectedItem, false);
      null.nullMethod();
    }
  }
   else {
    $selectNextItem(this$static);
  }
}

function $moveToPrevItem(this$static){
  if ($selectFirstItemIfNoneSelected(this$static)) {
    return;
  }
  this$static.vertical?undefined:$selectPrevItem(this$static);
}

function $onBrowserEvent_1(this$static, event_0){
  var item, keyCode;
  item = $findItem(this$static, event_0.target);
  switch ($eventGetTypeInt(event_0.type)) {
    case 1:
      {
        $focus_0(($clinit_268() , this$static.element_0));
        !!item && $doItemAction(this$static, item, true);
        break;
      }

    case 16:
      {
        !!item && $itemOver(this$static, item, true);
        break;
      }

    case 32:
      {
        !!item && $itemOver(this$static, null, true);
        break;
      }

    case 2048:
      {
        $selectFirstItemIfNoneSelected(this$static);
        break;
      }

    case 128:
      {
        keyCode = event_0.keyCode || 0;
        switch (keyCode) {
          case 37:
            $clinit_176();
            $moveToPrevItem(this$static);
            event_0.cancelBubble = true;
            event_0.preventDefault();
            break;
          case 39:
            $clinit_176();
            $moveToNextItem(this$static);
            event_0.cancelBubble = true;
            event_0.preventDefault();
            break;
          case 38:
            $moveSelectionUp(this$static);
            event_0.cancelBubble = true;
            event_0.preventDefault();
            break;
          case 40:
            $moveSelectionDown(this$static);
            event_0.cancelBubble = true;
            event_0.preventDefault();
            break;
          case 27:
            $selectItem(this$static, null);
            !!this$static.popup && $hide(this$static.popup, false);
            event_0.cancelBubble = true;
            event_0.preventDefault();
            break;
          case 9:
            $selectItem(this$static, null);
            !!this$static.popup && $hide(this$static.popup, false);
            break;
          case 13:
            if (!$selectFirstItemIfNoneSelected(this$static)) {
              $doItemAction(this$static, this$static.selectedItem, true);
              event_0.cancelBubble = true;
              event_0.preventDefault();
            }

        }
        break;
      }

  }
  $onBrowserEvent(this$static, event_0);
}

function $onPopupClosed(this$static, autoClosed){
  autoClosed && $selectItem(this$static, null);
  fire_0(this$static, false);
  this$static.shownChildMenu = null;
  this$static.popup = null;
}

function $selectFirstItemIfNoneSelected(this$static){
  var nextItem, nextItem$iterator;
  if (!this$static.selectedItem) {
    for (nextItem$iterator = new AbstractList$IteratorImpl_0(this$static.items); nextItem$iterator.i < nextItem$iterator.this$0_0.size_0();) {
      nextItem = dynamicCast($next_6(nextItem$iterator), 39);
      $selectItem(this$static, nextItem);
      break;
    }
    return true;
  }
  return false;
}

function $selectItem(this$static, item){
  var td, tr, parent_0, parent_1;
  if (item == this$static.selectedItem) {
    return;
  }
  if (this$static.selectedItem) {
    $setSelectionStyle(this$static.selectedItem);
    if (this$static.vertical) {
      tr = (parent_0 = this$static.selectedItem.element_0.parentNode , (!parent_0 || parent_0.nodeType != 1) && (parent_0 = null) , parent_0);
      if ($getChildCount(tr) == 2) {
        td = $getChild(tr, 1);
        setStyleName_0(td, 'subMenuIcon-selected', false);
      }
    }
  }
  if (item) {
    $setStyleName(item, getStylePrimaryName(item.element_0) + '-selected', true);
    if (this$static.vertical) {
      tr = (parent_1 = item.element_0.parentNode , (!parent_1 || parent_1.nodeType != 1) && (parent_1 = null) , parent_1);
      if ($getChildCount(tr) == 2) {
        td = $getChild(tr, 1);
        setStyleName_0(td, 'subMenuIcon-selected', true);
      }
    }
    this$static.element_0.setAttribute('aria-activedescendant', item.element_0.getAttribute('id') || '');
  }
  this$static.selectedItem = item;
}

function $selectNextItem(this$static){
  var firstIndex, index, itemToBeSelected;
  if (!this$static.selectedItem) {
    return;
  }
  index = $indexOf_4(this$static.items, this$static.selectedItem, 0);
  firstIndex = index;
  while (true) {
    index = index + 1;
    index == this$static.items.size && (index = 0);
    if (index == firstIndex) {
      itemToBeSelected = dynamicCast($get_3(this$static.items, firstIndex), 39);
      break;
    }
     else {
      itemToBeSelected = dynamicCast($get_3(this$static.items, index), 39);
      break;
    }
  }
  $selectItem(this$static, itemToBeSelected);
}

function $selectPrevItem(this$static){
  var firstIndex, index, itemToBeSelected;
  if (!this$static.selectedItem) {
    return;
  }
  index = $indexOf_4(this$static.items, this$static.selectedItem, 0);
  firstIndex = index;
  while (true) {
    index = index - 1;
    index < 0 && (index = this$static.items.size - 1);
    if (index == firstIndex) {
      itemToBeSelected = dynamicCast($get_3(this$static.items, firstIndex), 39);
      break;
    }
     else {
      itemToBeSelected = dynamicCast($get_3(this$static.items, index), 39);
      break;
    }
  }
  $selectItem(this$static, itemToBeSelected);
}

function $updateSubmenuIcon(this$static, item){
  var container, idx, tdCount, tr;
  if (!this$static.vertical) {
    return;
  }
  idx = $indexOf_4(this$static.allItems, item, 0);
  if (idx == -1) {
    return;
  }
  container = this$static.vertical?this$static.body_0:$getChild(this$static.body_0, 0);
  tr = $getChild(container, idx);
  tdCount = $getChildCount(tr);
  tdCount == 2 && tr.removeChild($getChild(tr, 1));
  item.element_0['colSpan'] = 2;
}

function MenuBar_1(){
  this.allItems = new ArrayList_0;
  this.items = new ArrayList_0;
  $init_1(this, true, new ClippedImagePrototype_0(($clinit_314() , menuBarSubMenuIcon).height_0));
}

function MenuBar(){
}

_ = MenuBar.prototype = new Widget;
_.getClass$ = function getClass_155(){
  return Lcom_google_gwt_user_client_ui_MenuBar_2_classLit;
}
;
_.onBrowserEvent = function onBrowserEvent_2(event_0){
  $onBrowserEvent_1(this, event_0);
}
;
_.onDetach = function onDetach_1(){
  !!this.popup && $hide(this.popup, false);
  $onDetach(this);
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
_.autoOpen = false;
_.body_0 = null;
_.focusOnHover = true;
_.popup = null;
_.selectedItem = null;
_.shownChildMenu = null;
_.vertical = false;
function MenuBar$1_0(val$cmd){
  this.val$cmd = val$cmd;
}

function MenuBar$1(){
}

_ = MenuBar$1_0.prototype = MenuBar$1.prototype = new Object_0;
_.execute = function execute_5(){
  $execute(this.val$cmd);
}
;
_.getClass$ = function getClass_156(){
  return Lcom_google_gwt_user_client_ui_MenuBar$1_2_classLit;
}
;
_.castableTypeMap$ = {28:1};
_.val$cmd = null;
function MenuBar$2_0(this$0){
  this.this$0 = this$0;
}

function MenuBar$2(){
}

_ = MenuBar$2_0.prototype = MenuBar$2.prototype = new Object_0;
_.getClass$ = function getClass_157(){
  return Lcom_google_gwt_user_client_ui_MenuBar$2_2_classLit;
}
;
_.castableTypeMap$ = {5:1, 6:1, 25:1};
_.this$0 = null;
function MenuBar$3_0(this$0, val$item){
  this.this$0 = this$0;
  this.val$item = val$item;
  DecoratedPopupPanel_0.call(this, 'menuPopup');
  $setWidget(this.decPanel, this.val$item.subMenu);
  $maybeUpdateSize(this);
  this.previewAllNativeEvents = true;
  null.nullMethod();
}

function MenuBar$3(){
}

_ = MenuBar$3_0.prototype = MenuBar$3.prototype = new DecoratedPopupPanel;
_.getClass$ = function getClass_158(){
  return Lcom_google_gwt_user_client_ui_MenuBar$3_2_classLit;
}
;
_.onPreviewNativeEvent = function onPreviewNativeEvent_0(event_0){
  var parentMenuElement, target;
  if (!event_0.isCanceled) {
    switch ($eventGetTypeInt(event_0.nativeEvent.type)) {
      case 4:
        target = event_0.nativeEvent.target;
        parentMenuElement = this.val$item.parentMenu.element_0;
        if ($isOrHasChild(parentMenuElement, target)) {
          event_0.isCanceled = true;
          return;
        }

        event_0.isCanceled && $selectItem(this.this$0, null);
        return;
    }
  }
}
;
_.castableTypeMap$ = {35:1, 36:1, 37:1, 38:1, 50:1, 51:1, 55:1, 135:1};
_.this$0 = null;
_.val$item = null;
function MenuBar$4_0(this$0, val$item){
  this.this$0 = this$0;
  this.val$item = val$item;
}

function MenuBar$4(){
}

_ = MenuBar$4_0.prototype = MenuBar$4.prototype = new Object_0;
_.getClass$ = function getClass_159(){
  return Lcom_google_gwt_user_client_ui_MenuBar$4_2_classLit;
}
;
_.setPosition = function setPosition(offsetWidth, offsetHeight){
  $clinit_176();
  this.this$0.vertical?$setPopupPosition(this.this$0.popup, $getAbsoluteLeft(this.this$0.element_0) + (parseInt(this.this$0.element_0['offsetWidth']) || 0) - 1, $getAbsoluteTop(this.val$item.element_0)):$setPopupPosition(this.this$0.popup, $getAbsoluteLeft(this.val$item.element_0), $getAbsoluteTop(this.this$0.element_0) + (parseInt(this.this$0.element_0['offsetHeight']) || 0) - 1);
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$item = null;
function $clinit_314(){
  $clinit_314 = nullMethod;
  menuBarSubMenuIcon = new ImageResourcePrototype_0(($clinit_176() , 'data:image/gif;base64,R0lGODlhBQAJAIAAAAAAAAAAACH5BAEAAAEALAAAAAAFAAkAAAIMRB5gp9v2YlJsJRQKADs='), 5, 9);
}

var menuBarSubMenuIcon = null;
function $setSelectionStyle(this$static){
  $setStyleName(this$static, getStylePrimaryName(this$static.element_0) + '-selected', false);
}

function MenuItem_0(text){
  this.element_0 = $doc.createElement('td');
  $setStyleName(this, getStylePrimaryName(this.element_0) + '-selected', false);
  this.element_0.innerHTML = text || '';
  this.element_0['className'] = 'gwt-MenuItem';
  this.element_0.setAttribute('id', $createUniqueId($doc));
  this.element_0.setAttribute('role', 'menuitem');
}

function MenuItem(){
}

_ = MenuItem.prototype = new UIObject;
_.getClass$ = function getClass_160(){
  return Lcom_google_gwt_user_client_ui_MenuItem_2_classLit;
}
;
_.castableTypeMap$ = {38:1, 39:1};
_.command = null;
_.parentMenu = null;
_.subMenu = null;
function SuggestOracle(){
}

_ = SuggestOracle.prototype = new Object_0;
_.getClass$ = function getClass_161(){
  return Lcom_google_gwt_user_client_ui_SuggestOracle_2_classLit;
}
;
_.castableTypeMap$ = {};
--></script>
<script><!--
function $add_4(this$static, suggestion){
  var candidate, i, l_0, word, words;
  candidate = $normalizeSuggestion(this$static, suggestion);
  this$static.toRealSuggestions.put(candidate, suggestion);
  words = $split(candidate, ' ', 0);
  for (i = 0; i < words.length; ++i) {
    word = words[i];
    $add_5(this$static.tree, word);
    l_0 = dynamicCast(this$static.toCandidates.get(word), 40);
    if (!l_0) {
      l_0 = new HashSet_0;
      this$static.toCandidates.put(word, l_0);
    }
    l_0.add_0(candidate);
  }
}

function $convertToFormattedSuggestions(this$static, query, candidates){
  var accum, candidate, cursor, formattedSuggestion, i, index, part1, part2, searchWords, suggestion, suggestions, wordBounds;
  suggestions = new ArrayList_0;
  for (i = 0; i < candidates.size; ++i) {
    candidate = dynamicCast((checkIndex(i, candidates.size) , candidates.array[i]), 1);
    cursor = 0;
    index = 0;
    formattedSuggestion = dynamicCast(this$static.toRealSuggestions.get(candidate), 1);
    accum = new SafeHtmlBuilder_0;
    searchWords = $split(query, ' ', 0);
    while (true) {
      wordBounds = $findNextWord(candidate, searchWords, index);
      if (!wordBounds) {
        break;
      }
      if (wordBounds.startIndex == 0 || 32 == candidate.charCodeAt(wordBounds.startIndex - 1)) {
        part1 = $substring_0(formattedSuggestion, cursor, wordBounds.startIndex);
        part2 = $substring_0(formattedSuggestion, wordBounds.startIndex, wordBounds.endIndex);
        cursor = wordBounds.endIndex;
        $append_8(accum.sb, htmlEscape(part1));
        $append_8(accum.sb, '<strong>');
        $append_8(accum.sb, htmlEscape(part2));
        $append_8(accum.sb, '<\/strong>');
      }
      index = wordBounds.endIndex;
    }
    if (cursor == 0) {
      continue;
    }
    $appendEscaped(accum, formattedSuggestion.substr(cursor, formattedSuggestion.length - cursor));
    suggestion = new MultiWordSuggestOracle$MultiWordSuggestion_0(formattedSuggestion, (new SafeHtmlString_0(accum.sb.impl.string)).html);
    setCheck(suggestions.array, suggestions.size++, suggestion);
  }
  return suggestions;
}

function $createCandidatesFromSearch(this$static, query){
  var candidateSet, candidates, i, searchWords, thisWordChoices, word, matchObj;
  candidates = new ArrayList_0;
  if (query.length == 0) {
    return candidates;
  }
  searchWords = $split(query, ' ', 0);
  candidateSet = null;
  for (i = 0; i < searchWords.length; ++i) {
    word = searchWords[i];
    if (word.length == 0 || (matchObj = (new RegExp(' ')).exec(word) , matchObj == null?false:word == matchObj[0])) {
      continue;
    }
    thisWordChoices = $createCandidatesFromWord(this$static, word);
    if (!candidateSet) {
      candidateSet = thisWordChoices;
    }
     else {
      $retainAll(candidateSet, thisWordChoices);
      if (candidateSet.map.size_0() < 2) {
        break;
      }
    }
  }
  if (candidateSet) {
    $addAll_0(candidates, candidateSet);
    sort_1(candidates);
  }
  return candidates;
}

function $createCandidatesFromWord(this$static, query){
  var belongsTo, candidateSet, i, words;
  candidateSet = new HashSet_0;
  words = $getSuggestions(this$static.tree, query, 2147483647);
  if (words) {
    for (i = 0; i < words.size; ++i) {
      belongsTo = dynamicCast(this$static.toCandidates.get((checkIndex(i, words.size) , words.array[i])), 130);
      !!belongsTo && $addAll(candidateSet, belongsTo);
    }
  }
  return candidateSet;
}

function $findNextWord(candidate, searchWords, indexToStartAt){
  var firstWord, index, newWord, word, word$index, word$max;
  firstWord = null;
  for (word$index = 0 , word$max = searchWords.length; word$index < word$max; ++word$index) {
    word = searchWords[word$index];
    index = candidate.indexOf(word, indexToStartAt);
    if (index != -1) {
      newWord = new MultiWordSuggestOracle$WordBounds_0(index, word.length);
      (!firstWord || $compareTo_0(newWord, firstWord) < 0) && (firstWord = newWord);
    }
  }
  return firstWord;
}

function $normalizeSearch(this$static, search){
  search = $normalizeSuggestion(this$static, search);
  search = $replaceAll(search, '\\s+', ' ');
  return $trim(search);
}

function $normalizeSuggestion(this$static, formattedSuggestion){
  var i, ignore;
  formattedSuggestion = formattedSuggestion.toLowerCase();
  if (this$static.whitespaceChars != null) {
    for (i = 0; i < this$static.whitespaceChars.length; ++i) {
      ignore = this$static.whitespaceChars[i];
      formattedSuggestion = $replace_1(formattedSuggestion, ignore, 32);
    }
  }
  return formattedSuggestion;
}

function $requestDefaultSuggestions(this$static, callback){
  $onSuggestionsReady(callback, this$static.emptyResponse);
}

function $requestSuggestions(this$static, request, callback){
  var candidates, i, limit, query, response, suggestions;
  query = $normalizeSearch(this$static, request.query);
  limit = request.limit;
  candidates = $createCandidatesFromSearch(this$static, query);
  for (i = candidates.size - 1; i > limit; --i) {
    $remove_10(candidates, i);
  }
  suggestions = $convertToFormattedSuggestions(this$static, query, candidates);
  response = new SuggestOracle$Response_0(suggestions);
  $showSuggestions(callback.this$0.display_0, callback.this$0, response.suggestions, callback.this$0.suggestionCallback);
}

function MultiWordSuggestOracle_0(){
  MultiWordSuggestOracle_1.call(this);
}

function MultiWordSuggestOracle_1(){
  var i;
  this.emptyResponse = new SuggestOracle$Response_0(new ArrayList_0);
  this.tree = new PrefixTree_0;
  this.toCandidates = new HashMap_0;
  this.toRealSuggestions = new HashMap_0;
  this.whitespaceChars = initDim(_3C_classLit, {58:1}, -1, 1, 1);
  for (i = 0; i < 1; ++i) {
    this.whitespaceChars[i] = ' '.charCodeAt(i);
  }
}

function MultiWordSuggestOracle(){
}

_ = MultiWordSuggestOracle_0.prototype = MultiWordSuggestOracle.prototype = new SuggestOracle;
_.getClass$ = function getClass_162(){
  return Lcom_google_gwt_user_client_ui_MultiWordSuggestOracle_2_classLit;
}
;
_.castableTypeMap$ = {};
_.whitespaceChars = null;
function MultiWordSuggestOracle$MultiWordSuggestion_0(replacementString, displayString){
  this.replacementString = replacementString;
  this.displayString = displayString;
}

function MultiWordSuggestOracle$MultiWordSuggestion(){
}

_ = MultiWordSuggestOracle$MultiWordSuggestion_0.prototype = MultiWordSuggestOracle$MultiWordSuggestion.prototype = new Object_0;
_.getClass$ = function getClass_163(){
  return Lcom_google_gwt_user_client_ui_MultiWordSuggestOracle$MultiWordSuggestion_2_classLit;
}
;
_.castableTypeMap$ = {134:1};
_.displayString = null;
_.replacementString = null;
function $compareTo_0(this$static, that){
  var comparison;
  comparison = this$static.startIndex - that.startIndex;
  comparison == 0 && (comparison = that.endIndex - this$static.endIndex);
  return comparison;
}

function MultiWordSuggestOracle$WordBounds_0(startIndex, length_0){
  this.startIndex = startIndex;
  this.endIndex = startIndex + length_0;
}

function MultiWordSuggestOracle$WordBounds(){
}

_ = MultiWordSuggestOracle$WordBounds_0.prototype = MultiWordSuggestOracle$WordBounds.prototype = new Object_0;
_.compareTo$ = function compareTo_0(that){
  return $compareTo_0(this, dynamicCast(that, 131));
}
;
_.getClass$ = function getClass_164(){
  return Lcom_google_gwt_user_client_ui_MultiWordSuggestOracle$WordBounds_2_classLit;
}
;
_.castableTypeMap$ = {61:1, 131:1};
_.endIndex = 0;
_.startIndex = 0;
function $onResize(){
  var style;
  style = null.nullMethod();
  $getClientWidth($doc);
  $getClientHeight($doc);
  style['display'] = ($clinit_47() , 'none');
  null.nullMethod($clinit_68());
  null.nullMethod($clinit_68());
  $getScrollWidth($doc);
  $getScrollHeight($doc);
  null.nullMethod($clinit_68());
  null.nullMethod($clinit_68());
  style['display'] = 'block';
}

function PopupPanel$1_0(){
}

function PopupPanel$1(){
}

_ = PopupPanel$1_0.prototype = PopupPanel$1.prototype = new Object_0;
_.getClass$ = function getClass_165(){
  return Lcom_google_gwt_user_client_ui_PopupPanel$1_2_classLit;
}
;
_.castableTypeMap$ = {21:1, 25:1};
function PopupPanel$2_0(this$0, val$target){
  this.this$0 = this$0;
  this.val$target = val$target;
}

function PopupPanel$2(){
}

_ = PopupPanel$2_0.prototype = PopupPanel$2.prototype = new Object_0;
_.getClass$ = function getClass_166(){
  return Lcom_google_gwt_user_client_ui_PopupPanel$2_2_classLit;
}
;
_.setPosition = function setPosition_0(offsetWidth, offsetHeight){
  $position(this.this$0, this.val$target, offsetWidth, offsetHeight);
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$target = null;
function PopupPanel$3_0(this$0){
  this.this$0 = this$0;
}

function PopupPanel$3(){
}

_ = PopupPanel$3_0.prototype = PopupPanel$3.prototype = new Object_0;
_.getClass$ = function getClass_167(){
  return Lcom_google_gwt_user_client_ui_PopupPanel$3_2_classLit;
}
;
_.castableTypeMap$ = {25:1, 33:1};
_.this$0 = null;
function PopupPanel$4_0(this$0){
  this.this$0 = this$0;
}

function PopupPanel$4(){
}

_ = PopupPanel$4_0.prototype = PopupPanel$4.prototype = new Object_0;
_.getClass$ = function getClass_168(){
  return Lcom_google_gwt_user_client_ui_PopupPanel$4_2_classLit;
}
;
_.onValueChange = function onValueChange(event_0){
  this.this$0.autoHideOnHistoryEvents && $hide(this.this$0, false);
}
;
_.castableTypeMap$ = {24:1, 25:1};
_.this$0 = null;
function $clinit_325(){
  $clinit_325 = nullMethod;
  CENTER = new PopupPanel$AnimationType_0('CENTER', 0);
  ONE_WAY_CORNER = new PopupPanel$AnimationType_0('ONE_WAY_CORNER', 1);
  ROLL_DOWN = new PopupPanel$AnimationType_0('ROLL_DOWN', 2);
  $VALUES_7 = initValues(_3Lcom_google_gwt_user_client_ui_PopupPanel$AnimationType_2_classLit, {58:1, 138:1}, 56, [CENTER, ONE_WAY_CORNER, ROLL_DOWN]);
}

function PopupPanel$AnimationType_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_8(){
  $clinit_325();
  return $VALUES_7;
}

function PopupPanel$AnimationType(){
}

_ = PopupPanel$AnimationType_0.prototype = PopupPanel$AnimationType.prototype = new Enum;
_.getClass$ = function getClass_169(){
  return Lcom_google_gwt_user_client_ui_PopupPanel$AnimationType_2_classLit;
}
;
_.castableTypeMap$ = {56:1, 58:1, 61:1, 62:1};
var $VALUES_7, CENTER, ONE_WAY_CORNER, ROLL_DOWN;
function $maybeShowGlass(this$static){
  if (this$static.showing) {
    if (this$static.curPanel.isGlassEnabled) {
      $doc.body.appendChild(this$static.curPanel.glass);
      this$static.resizeRegistration = addResizeHandler(this$static.curPanel.glassResizer);
      $onResize();
      this$static.glassShowing = true;
    }
  }
   else if (this$static.glassShowing) {
    $doc.body.removeChild(this$static.curPanel.glass);
    $removeHandler(this$static.resizeRegistration);
    this$static.resizeRegistration = null;
    this$static.glassShowing = false;
  }
}

function $onComplete(this$static){
  if (!this$static.showing) {
    $maybeShowGlass(this$static);
    this$static.isUnloading || $remove_1(($clinit_333() , get_0()), this$static.curPanel);
  }
  this$static.curPanel.element_0.style['clip'] = 'rect(auto, auto, auto, auto)';
  this$static.curPanel.element_0.style['overflow'] = 'visible';
}

function $onInstantaneousRun(this$static){
  $maybeShowGlass(this$static);
  if (this$static.showing) {
    this$static.curPanel.element_0.style['position'] = 'absolute';
    this$static.curPanel.topPosition != -1 && $setPopupPosition(this$static.curPanel, this$static.curPanel.leftPosition, this$static.curPanel.topPosition);
    $add_0(($clinit_333() , get_0()), this$static.curPanel);
  }
   else {
    this$static.isUnloading || $remove_1(($clinit_333() , get_0()), this$static.curPanel);
  }
  this$static.curPanel.element_0.style['overflow'] = 'visible';
}

function $onUpdate(this$static, progress){
  var bottom, height, left, right, top_0, width;
  this$static.showing || (progress = 1 - progress);
  top_0 = 0;
  left = 0;
  right = 0;
  bottom = 0;
  height = ~~Math.max(Math.min(progress * this$static.offsetHeight_0, 2147483647), -2147483648);
  width = ~~Math.max(Math.min(progress * this$static.offsetWidth_0, 2147483647), -2147483648);
  switch (this$static.curPanel.animType.ordinal) {
    case 2:
      right = this$static.offsetWidth_0;
      bottom = height;
      break;
    case 0:
      top_0 = ~~(this$static.offsetHeight_0 - height) >> 1;
      left = ~~(this$static.offsetWidth_0 - width) >> 1;
      right = left + width;
      bottom = top_0 + height;
      break;
    case 1:
      right = width;
      bottom = height;
  }
  this$static.curPanel.element_0.style['clip'] = 'rect(' + top_0 + 'px, ' + right + 'px, ' + bottom + 'px, ' + left + 'px)';
}

function $setState(this$static, showing, isUnloading){
  var animate;
  this$static.isUnloading = isUnloading;
  $cancel(this$static);
  if (this$static.showTimer) {
    $cancel_0(this$static.showTimer);
    this$static.showTimer = null;
    $onComplete(this$static);
  }
  this$static.curPanel.showing = showing;
  $updateHandlers(this$static.curPanel);
  animate = !isUnloading && this$static.curPanel.isAnimationEnabled;
  this$static.curPanel.animType != ($clinit_325() , CENTER) && !showing && (animate = false);
  this$static.showing = showing;
  if (animate) {
    if (showing) {
      $maybeShowGlass(this$static);
      this$static.curPanel.element_0.style['position'] = 'absolute';
      this$static.curPanel.topPosition != -1 && $setPopupPosition(this$static.curPanel, this$static.curPanel.leftPosition, this$static.curPanel.topPosition);
      this$static.curPanel.element_0.style['clip'] = 'rect(0px, 0px, 0px, 0px)';
      $add_0(($clinit_333() , get_0()), this$static.curPanel);
      this$static.showTimer = new PopupPanel$ResizeAnimation$1_0(this$static);
      $schedule(this$static.showTimer, 1);
    }
     else {
      $run(this$static, (new Date).getTime());
    }
  }
   else {
    $onInstantaneousRun(this$static);
  }
}

function PopupPanel$ResizeAnimation_0(panel){
  this.curPanel = panel;
}

function PopupPanel$ResizeAnimation(){
}

_ = PopupPanel$ResizeAnimation_0.prototype = PopupPanel$ResizeAnimation.prototype = new Animation;
_.getClass$ = function getClass_170(){
  return Lcom_google_gwt_user_client_ui_PopupPanel$ResizeAnimation_2_classLit;
}
;
_.castableTypeMap$ = {41:1};
_.curPanel = null;
_.glassShowing = false;
_.isUnloading = false;
_.offsetHeight_0 = 0;
_.offsetWidth_0 = -1;
_.resizeRegistration = null;
_.showTimer = null;
_.showing = false;
function PopupPanel$ResizeAnimation$1_0(this$1){
  $clinit_2();
  this.this$1 = this$1;
}

function PopupPanel$ResizeAnimation$1(){
}

_ = PopupPanel$ResizeAnimation$1_0.prototype = PopupPanel$ResizeAnimation$1.prototype = new Timer;
_.getClass$ = function getClass_171(){
  return Lcom_google_gwt_user_client_ui_PopupPanel$ResizeAnimation$1_2_classLit;
}
;
_.run = function run_2(){
  this.this$1.showTimer = null;
  $run(this.this$1, (new Date).getTime());
}
;
_.castableTypeMap$ = {34:1};
_.this$1 = null;
function $addAll(this$static, c){
  var changed, iter;
  iter = c.iterator_0();
  changed = false;
  while (iter.hasNext()) {
    this$static.add_0(iter.next_0()) && (changed = true);
  }
  return changed;
}

function $advanceToFind(iter, o){
  var t;
  while (iter.hasNext()) {
    t = iter.next_0();
    if (o == null?t == null:equals__devirtual$(o, t)) {
      return iter;
    }
  }
  return null;
}

function $retainAll(this$static, c){
  var changed, iter, outerIter, entry;
  iter = (outerIter = $keySet(this$static.map).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter));
  changed = false;
  while (iter.val$outerIter.hasNext()) {
    if (!c.map.containsKey((entry = dynamicCast(iter.val$outerIter.next_0(), 66) , entry.getKey()))) {
      iter.val$outerIter.remove();
      changed = true;
    }
  }
  return changed;
}

function $toArray(this$static, a_0){
  var i, it, size;
  size = this$static.size_0();
  a_0.length < size && (a_0 = createFrom(a_0, size));
  it = this$static.iterator_0();
  for (i = 0; i < size; ++i) {
    setCheck(a_0, i, it.next_0());
  }
  a_0.length > size && setCheck(a_0, size, null);
  return a_0;
}

function $toString_2(this$static){
  var comma, iter, sb;
  sb = new StringBuffer_0;
  comma = null;
  sb.impl.string += '[';
  iter = this$static.iterator_0();
  while (iter.hasNext()) {
    comma != null?(sb.impl.string += comma , sb):(comma = ', ');
    $append_2(sb, '' + iter.next_0());
  }
  sb.impl.string += ']';
  return sb.impl.string;
}

function AbstractCollection(){
}

_ = AbstractCollection.prototype = new Object_0;
_.add_0 = function add_0(o){
  throw new UnsupportedOperationException_1('Add not supported on this collection');
}
;
_.addAll = function addAll(c){
  return $addAll(this, c);
}
;
_.clear = function clear(){
  var iter;
  iter = this.iterator_0();
  while (iter.hasNext()) {
    iter.next_0();
    iter.remove();
  }
}
;
_.contains = function contains(o){
  var iter;
  iter = $advanceToFind(this.iterator_0(), o);
  return !!iter;
}
;
_.getClass$ = function getClass_172(){
  return Ljava_util_AbstractCollection_2_classLit;
}
;
_.isEmpty = function isEmpty(){
  return this.size_0() == 0;
}
;
_.remove_1 = function remove_6(o){
  var iter;
  iter = $advanceToFind(this.iterator_0(), o);
  if (iter) {
    iter.remove();
    return true;
  }
   else {
    return false;
  }
}
;
_.toArray = function toArray(){
  return this.toArray_0(initDim(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, this.size_0(), 0));
}
;
_.toArray_0 = function toArray_0(a_0){
  return $toArray(this, a_0);
}
;
_.toString$ = function toString_7(){
  return $toString_2(this);
}
;
_.castableTypeMap$ = {130:1};
function $add_5(this$static, s){
  var suffixes = this$static.suffixes;
  var subtrees = this$static.subtrees_0;
  var prefixLength = this$static.prefixLength;
  if (s == null || s.length == 0) {
    return false;
  }
  if (s.length <= prefixLength) {
    var safeKey = ':' + s;
    if (suffixes.hasOwnProperty(safeKey)) {
      return false;
    }
     else {
      this$static.size++;
      suffixes[safeKey] = true;
      return true;
    }
  }
   else {
    var prefix = ':' + s.slice(0, prefixLength);
    var theTree;
    if (subtrees.hasOwnProperty(prefix)) {
      theTree = subtrees[prefix];
    }
     else {
      theTree = new PrefixTree_1(prefixLength << 1);
      subtrees[prefix] = theTree;
    }
    var slice = s.slice(prefixLength);
    if (theTree.add_1(slice)) {
      this$static.size++;
      return true;
    }
     else {
      return false;
    }
  }
}

function $clear_0(this$static){
  this$static.size = 0;
  this$static.subtrees_0 = {};
  this$static.suffixes = {};
}

function $contains(this$static, s){
  var toReturn;
  return $indexOf_4((toReturn = new ArrayList_0 , s != null && 1 > 0 && $suggestImpl(this$static, s, '', toReturn, 1) , toReturn), s, 0) != -1;
}

function $getSuggestions(this$static, search, limit){
  var toReturn;
  toReturn = new ArrayList_0;
  search != null && limit > 0 && $suggestImpl(this$static, search, '', toReturn, limit);
  return toReturn;
}

function $suggestImpl(this$static, search, prefix, output, limit){
  var suffixes = this$static.suffixes;
  var subtrees = this$static.subtrees_0;
  var prefixLength = this$static.prefixLength;
  if (search.length > prefix.length + prefixLength) {
    var key = ':' + search.slice(prefix.length, prefix.length + prefixLength);
    if (subtrees.hasOwnProperty(key)) {
      var subtree = subtrees[key];
      var target = prefix + key.substr(1, key.length - 1);
      subtree.suggestImpl(search, target, output, limit);
    }
  }
   else {
    for (var suffix in suffixes) {
      if (suffix.indexOf(':') != 0) {
        continue;
      }
      var target = prefix + suffix.substr(1, suffix.length - 1);
      target.indexOf(search) == 0 && output.add_0(target);
      if (output.size_0() >= limit) {
        return;
      }
    }
    for (var key in subtrees) {
      if (key.indexOf(':') != 0) {
        continue;
      }
      var target = prefix + key.substr(1, key.length - 1);
      var subtree = subtrees[key];
      if (target.indexOf(search) == 0) {
        if (subtree.size <= limit - output.size_0() || subtree.size == 1) {
          subtree.dump_0(output, target);
        }
         else {
          for (var suffix in subtree.suffixes) {
            suffix.indexOf(':') == 0 && output.add_0(target + suffix.substr(1, suffix.length - 1));
          }
          for (var subkey in subtree.subtrees_0) {
            subkey.indexOf(':') == 0 && output.add_0(target + subkey.substr(1, subkey.length - 1) + '...');
          }
        }
      }
    }
  }
}

function PrefixTree_0(){
  this.prefixLength = 2;
  $clear_0(this);
}

function PrefixTree_1(prefixLength){
  this.prefixLength = prefixLength;
  $clear_0(this);
}

function safe_0(s){
  return ':' + s;
}

function unsafe_0(s){
  return s.substr(1, s.length - 1);
}

function PrefixTree(){
}

_ = PrefixTree_1.prototype = PrefixTree_0.prototype = PrefixTree.prototype = new AbstractCollection;
_.add_1 = function add_1(s){
  return $add_5(this, s);
}
;
_.add_0 = function add_2(s){
  return $add_5(this, dynamicCast(s, 1));
}
;
_.clear = function clear_0(){
  $clear_0(this);
}
;
_.contains = function contains_0(o){
  return o != null && o.castableTypeMap$ && !!o.castableTypeMap$[1] && $contains(this, dynamicCast(o, 1));
}
;
_.dump_0 = function dump_0(output, prefix){
  var s, s$iterator;
  for (s$iterator = new PrefixTree$PrefixTreeIterator_0(this); $nextImpl(s$iterator, true) != null;) {
    s = $next_0(s$iterator);
    output.add_0(prefix + s);
  }
}
;
_.getClass$ = function getClass_173(){
  return Lcom_google_gwt_user_client_ui_PrefixTree_2_classLit;
}
;
_.iterator_0 = function iterator_3(){
  return new PrefixTree$PrefixTreeIterator_0(this);
}
;
_.size_0 = function size_4(){
  return this.size;
}
;
_.suggestImpl = function suggestImpl(search, prefix, output, limit){
  $suggestImpl(this, search, prefix, output, limit);
}
;
_.castableTypeMap$ = {130:1};
_.prefixLength = 0;
_.size = 0;
_.subtrees_0 = null;
_.suffixes = null;
function $addTree(this$static, tree, prefix){
  var suffixes = [];
  for (var suffix in tree.suffixes) {
    suffix.indexOf(':') == 0 && suffixes.push(suffix);
  }
  var frame = {suffixNames:suffixes, subtrees:tree.subtrees_0, prefix:prefix, index:0};
  var stack = this$static.stack_0;
  stack.push(frame);
}

function $next_0(this$static){
  var toReturn;
  toReturn = $nextImpl(this$static, false);
  if (toReturn == null) {
    if ($nextImpl(this$static, true) != null) {
      throw new RuntimeException_1('nextImpl() returned null, but hasNext says otherwise');
    }
     else {
      throw new NoSuchElementException_1('No more elements in the iterator');
    }
  }
  return toReturn;
}

function $nextImpl(this$static, peek){
  var stack = this$static.stack_0;
  var safe = safe_0;
  var unsafe = unsafe_0;
  while (stack.length > 0) {
    var frame = stack.pop();
    if (frame.index < frame.suffixNames.length) {
      var toReturn = frame.prefix + unsafe(frame.suffixNames[frame.index]);
      !peek && frame.index++;
      if (frame.index < frame.suffixNames.length) {
        stack.push(frame);
      }
       else {
        for (key in frame.subtrees) {
          if (key.indexOf(':') != 0) {
            continue;
          }
          var target = frame.prefix + unsafe(key);
          var subtree = frame.subtrees[key];
          this$static.addTree(subtree, target);
        }
      }
      return toReturn;
    }
     else {
      for (var key in frame.subtrees) {
        if (key.indexOf(':') != 0) {
          continue;
        }
        var target = frame.prefix + unsafe(key);
        var subtree = frame.subtrees[key];
        this$static.addTree(subtree, target);
      }
    }
  }
  return null;
}

function PrefixTree$PrefixTreeIterator_0(tree){
  this.stack_0 = [];
  $addTree(this, tree, '');
}

function PrefixTree$PrefixTreeIterator(){
}

_ = PrefixTree$PrefixTreeIterator_0.prototype = PrefixTree$PrefixTreeIterator.prototype = new Object_0;
_.addTree = function addTree(tree, prefix){
  $addTree(this, tree, prefix);
}
;
_.getClass$ = function getClass_174(){
  return Lcom_google_gwt_user_client_ui_PrefixTree$PrefixTreeIterator_2_classLit;
}
;
_.hasNext = function hasNext_0(){
  return $nextImpl(this, true) != null;
}
;
_.next_0 = function next_4(){
  return $next_0(this);
}
;
_.remove = function remove_7(){
  throw new UnsupportedOperationException_1('PrefixTree does not support removal.  Use clear()');
}
;
_.castableTypeMap$ = {};
_.stack_0 = null;
function $sinkEvents_1(this$static, eventBitsToAdd){
  if (this$static.eventsToSink == -1) {
    sinkEvents_0(this$static.inputElem, eventBitsToAdd | (this$static.inputElem.__eventBits || 0));
    sinkEvents_0(this$static.labelElem, eventBitsToAdd | (this$static.labelElem.__eventBits || 0));
  }
   else {
    this$static.eventsToSink == -1?sinkEvents_0(this$static.inputElem, eventBitsToAdd | (this$static.inputElem.__eventBits || 0)):this$static.eventsToSink == -1?sinkEvents(this$static.element_0, eventBitsToAdd | (this$static.element_0.__eventBits || 0)):(this$static.eventsToSink |= eventBitsToAdd);
  }
}

function RadioButton_1(name_0, label){
  $clinit_254();
  CheckBox_2.call(this, $createInputRadioElement($doc, name_0));
  this.element_0['className'] = 'gwt-RadioButton';
  $sinkEvents_1(this, 1);
  $sinkEvents_1(this, 8);
  $sinkEvents_1(this, 4096);
  $sinkEvents_1(this, 128);
  this.labelElem.textContent = label || '';
}

function RadioButton(){
}

_ = RadioButton_1.prototype = RadioButton.prototype = new CheckBox;
_.ensureDomEventHandlers = function ensureDomEventHandlers_0(){
}
;
_.getClass$ = function getClass_175(){
  return Lcom_google_gwt_user_client_ui_RadioButton_2_classLit;
}
;
_.onBrowserEvent = function onBrowserEvent_3(event_0){
  var target;
  switch ($eventGetTypeInt(event_0.type)) {
    case 8:
    case 4096:
    case 128:
      this.oldValue = this.attached?($clinit_382() , this.inputElem.checked?TRUE:FALSE):($clinit_382() , this.inputElem.defaultChecked?TRUE:FALSE);
      break;
    case 1:
      target = event_0.target;
      if (is_0(target) && $isOrHasChild(this.labelElem, target)) {
        this.oldValue = this.attached?($clinit_382() , this.inputElem.checked?TRUE:FALSE):($clinit_382() , this.inputElem.defaultChecked?TRUE:FALSE);
        return;
      }

      $onBrowserEvent(this, event_0);
      fireIfNotEqual(this, this.oldValue, this.attached?($clinit_382() , this.inputElem.checked?TRUE:FALSE):($clinit_382() , this.inputElem.defaultChecked?TRUE:FALSE));
      return;
  }
  $onBrowserEvent(this, event_0);
}
;
_.sinkEvents = function sinkEvents_3(eventBitsToAdd){
  $sinkEvents_1(this, eventBitsToAdd);
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1, 197:1};
_.oldValue = null;
function $clinit_333(){
  $clinit_333 = nullMethod;
  maybeDetachCommand = new RootPanel$1_0;
  rootPanels = new HashMap_0;
  widgetsToDetach = new HashSet_0;
}

function RootPanel_0(elem){
  this.children_0 = new WidgetCollection_0(this);
  this.element_0 = elem;
  $onAttach(this);
}

function detachNow(widget){
  $clinit_333();
  try {
    widget.onDetach();
  }
   finally {
    widgetsToDetach.map.remove_2(widget) != null;
  }
}

function detachWidgets(){
  $clinit_333();
  try {
    tryCommand(widgetsToDetach, maybeDetachCommand);
  }
   finally {
    widgetsToDetach.map.clear();
    rootPanels.clear();
  }
}

function get_0(){
  $clinit_333();
  var rp;
  rp = dynamicCast(rootPanels.get(null), 132);
  if (rp) {
    return rp;
  }
  rootPanels.size_0() == 0 && addCloseHandler(new RootPanel$2_0);
  rp = new RootPanel$DefaultRootPanel_0;
  rootPanels.put(null, rp);
  $add_11(widgetsToDetach, rp);
  return rp;
}

function RootPanel(){
}

_ = RootPanel.prototype = new AbsolutePanel;
_.getClass$ = function getClass_176(){
  return Lcom_google_gwt_user_client_ui_RootPanel_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1, 132:1, 135:1};
var maybeDetachCommand, rootPanels, widgetsToDetach;
function RootPanel$1_0(){
}

function RootPanel$1(){
}

_ = RootPanel$1_0.prototype = RootPanel$1.prototype = new Object_0;
_.execute_0 = function execute_6(w){
  w.isAttached() && w.onDetach();
}
;
_.getClass$ = function getClass_177(){
  return Lcom_google_gwt_user_client_ui_RootPanel$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function RootPanel$2_0(){
}

function RootPanel$2(){
}

_ = RootPanel$2_0.prototype = RootPanel$2.prototype = new Object_0;
_.getClass$ = function getClass_178(){
  return Lcom_google_gwt_user_client_ui_RootPanel$2_2_classLit;
}
;
_.onClose = function onClose_1(closeEvent){
  detachWidgets();
}
;
_.castableTypeMap$ = {20:1, 25:1};
function RootPanel$DefaultRootPanel_0(){
  RootPanel_0.call(this, ($clinit_333() , $doc.body));
}

function RootPanel$DefaultRootPanel(){
}

_ = RootPanel$DefaultRootPanel_0.prototype = RootPanel$DefaultRootPanel.prototype = new RootPanel;
_.getClass$ = function getClass_179(){
  return Lcom_google_gwt_user_client_ui_RootPanel$DefaultRootPanel_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1, 132:1, 135:1};
function $next_2(this$static){
  if (!this$static.hasElement || !this$static.this$0.widget) {
    throw new NoSuchElementException_0;
  }
  this$static.hasElement = false;
  return this$static.returned = this$static.this$0.widget;
}

function SimplePanel$1_0(this$0){
  this.this$0 = this$0;
  this.hasElement = !!this.this$0.widget;
}

function SimplePanel$1(){
}

_ = SimplePanel$1_0.prototype = SimplePanel$1.prototype = new Object_0;
_.getClass$ = function getClass_180(){
  return Lcom_google_gwt_user_client_ui_SimplePanel$1_2_classLit;
}
;
_.hasNext = function hasNext_1(){
  return this.hasElement;
}
;
_.next_0 = function next_5(){
  return $next_2(this);
}
;
_.remove = function remove_8(){
  !!this.returned && this.this$0.remove_0(this.returned);
}
;
_.castableTypeMap$ = {};
--></script>
<script><!--
_.returned = null;
_.this$0 = null;
function $refreshSuggestions(this$static){
  var text;
  text = $getPropertyString(this$static.box.element_0, 'value');
  if ($equals_3(text, this$static.currentText)) {
    return;
  }
   else {
    this$static.currentText = text;
  }
  text.length == 0?$requestDefaultSuggestions(this$static.oracle, (new SuggestOracle$Request_0(null) , this$static.callback)):$requestSuggestions(this$static.oracle, new SuggestOracle$Request_0(text), this$static.callback);
}

function $setNewSelection(this$static, curSuggestion){
  this$static.currentText = curSuggestion.replacementString;
  $setText_2(this$static.box, this$static.currentText);
  $hide(this$static.display_0.suggestionPopup, false);
  fire_2(this$static);
}

function SuggestBox_0(oracle){
  SuggestBox_2.call(this, oracle, new TextBox_0, new SuggestBox$DefaultSuggestionDisplay_0);
}

function SuggestBox_2(oracle, box, suggestDisplay){
  var events;
  this.callback = new SuggestBox$1_0(this);
  this.suggestionCallback = new SuggestBox$2_0(this);
  this.box = box;
  this.display_0 = suggestDisplay;
  $initWidget(this, box);
  events = new SuggestBox$1TextBoxEvents_0(this);
  $addKeyHandlersTo(events, this.box);
  $addValueChangeHandler_1(this.box, events);
  this.oracle = oracle;
  this.element_0['className'] = 'gwt-SuggestBox';
}

function SuggestBox(){
}

_ = SuggestBox_0.prototype = SuggestBox.prototype = new Composite;
_.getClass$ = function getClass_181(){
  return Lcom_google_gwt_user_client_ui_SuggestBox_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
_.box = null;
_.currentText = null;
_.display_0 = null;
_.oracle = null;
function $onSuggestionsReady(this$static, response){
  $showSuggestions(this$static.this$0.display_0, this$static.this$0, response.suggestions, this$static.this$0.suggestionCallback);
}

function SuggestBox$1_0(this$0){
  this.this$0 = this$0;
}

function SuggestBox$1(){
}

_ = SuggestBox$1_0.prototype = SuggestBox$1.prototype = new Object_0;
_.getClass$ = function getClass_182(){
  return Lcom_google_gwt_user_client_ui_SuggestBox$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $onKeyDown(this$static, event_0){
  var suggestion;
  switch (event_0.nativeEvent.keyCode || 0) {
    case 40:
      $moveSelectionDown_0(this$static.this$0.display_0);
      break;
    case 38:
      $moveSelectionUp_0(this$static.this$0.display_0);
      break;
    case 13:
    case 9:
      suggestion = $getCurrentSelection(this$static.this$0.display_0);
      !suggestion?$hide(this$static.this$0.display_0.suggestionPopup, false):$setNewSelection(this$static.this$0, suggestion);
  }
  $delegateEvent(this$static.this$0, event_0);
}

function SuggestBox$1TextBoxEvents_0(this$0){
  this.this$0 = this$0;
}

function SuggestBox$1TextBoxEvents(){
}

_ = SuggestBox$1TextBoxEvents_0.prototype = SuggestBox$1TextBoxEvents.prototype = new HandlesAllKeyEvents;
_.getClass$ = function getClass_183(){
  return Lcom_google_gwt_user_client_ui_SuggestBox$1TextBoxEvents_2_classLit;
}
;
_.onKeyUp = function onKeyUp_0(event_0){
  $refreshSuggestions(this.this$0);
  $delegateEvent(this.this$0, event_0);
}
;
_.onValueChange = function onValueChange_0(event_0){
  $delegateEvent(this.this$0, event_0);
}
;
_.castableTypeMap$ = {11:1, 12:1, 13:1, 24:1, 25:1};
_.this$0 = null;
function SuggestBox$2_0(this$0){
  this.this$0 = this$0;
}

function SuggestBox$2(){
}

_ = SuggestBox$2_0.prototype = SuggestBox$2.prototype = new Object_0;
_.getClass$ = function getClass_184(){
  return Lcom_google_gwt_user_client_ui_SuggestBox$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function SuggestBox$SuggestionDisplay(){
}

_ = SuggestBox$SuggestionDisplay.prototype = new Object_0;
_.getClass$ = function getClass_185(){
  return Lcom_google_gwt_user_client_ui_SuggestBox$SuggestionDisplay_2_classLit;
}
;
_.castableTypeMap$ = {};
function $getCurrentSelection(this$static){
  var item;
  if (!this$static.suggestionPopup.showing) {
    return null;
  }
  item = this$static.suggestionMenu.selectedItem;
  return !item?null:dynamicCast(item, 133).suggestion;
}

function $moveSelectionDown_0(this$static){
  this$static.suggestionPopup.showing && $selectItem_0(this$static.suggestionMenu, $getSelectedItemIndex(this$static.suggestionMenu) + 1);
}

function $moveSelectionUp_0(this$static){
  this$static.suggestionPopup.showing && ($getSelectedItemIndex(this$static.suggestionMenu) == -1?$selectItem_0(this$static.suggestionMenu, this$static.suggestionMenu.items.size - 1):$selectItem_0(this$static.suggestionMenu, $getSelectedItemIndex(this$static.suggestionMenu) - 1));
}

function $showSuggestions(this$static, suggestBox, suggestions, callback){
  var anySuggestions, curSuggestion, curSuggestion$iterator, menuItem;
  anySuggestions = !!suggestions && suggestions.size > 0;
  if (!anySuggestions) {
    $hide(this$static.suggestionPopup, false);
    return;
  }
  this$static.suggestionPopup.attached && $hide(this$static.suggestionPopup, false);
  $clearItems(this$static.suggestionMenu);
  for (curSuggestion$iterator = new AbstractList$IteratorImpl_0(suggestions); curSuggestion$iterator.i < curSuggestion$iterator.this$0_0.size_0();) {
    curSuggestion = dynamicCast($next_6(curSuggestion$iterator), 134);
    menuItem = new SuggestBox$SuggestionMenuItem_0(curSuggestion);
    menuItem.command = new SuggestBox$DefaultSuggestionDisplay$1_0(callback, curSuggestion);
    $addItem_0(this$static.suggestionMenu, menuItem);
  }
  anySuggestions && $selectItem_0(this$static.suggestionMenu, 0);
  if (this$static.lastSuggestBox != suggestBox) {
    !!this$static.lastSuggestBox && $removeAutoHidePartner(this$static.suggestionPopup, this$static.lastSuggestBox.element_0);
    this$static.lastSuggestBox = suggestBox;
    $addAutoHidePartner(this$static.suggestionPopup, suggestBox.element_0);
  }
  $showRelativeTo(this$static.suggestionPopup, suggestBox);
}

function SuggestBox$DefaultSuggestionDisplay_0(){
  var p, parent_0;
  this.suggestionMenu = new SuggestBox$SuggestionMenu_0;
  this.suggestionPopup = (p = new DecoratedPopupPanel_0('suggestPopup') , (parent_0 = $getFirstChildElement(p.element_0).parentNode , (!parent_0 || parent_0.nodeType != 1) && (parent_0 = null) , parent_0)['className'] = 'gwt-SuggestBoxPopup' , p.previewAllNativeEvents = true , p.animType = ($clinit_325() , ROLL_DOWN) , p);
  $setWidget_1(this.suggestionPopup, this.suggestionMenu);
}

function SuggestBox$DefaultSuggestionDisplay(){
}

_ = SuggestBox$DefaultSuggestionDisplay_0.prototype = SuggestBox$DefaultSuggestionDisplay.prototype = new SuggestBox$SuggestionDisplay;
_.getClass$ = function getClass_186(){
  return Lcom_google_gwt_user_client_ui_SuggestBox$DefaultSuggestionDisplay_2_classLit;
}
;
_.castableTypeMap$ = {};
_.lastSuggestBox = null;
_.suggestionMenu = null;
_.suggestionPopup = null;
function $execute(this$static){
  $setNewSelection(this$static.val$callback.this$0, this$static.val$curSuggestion);
}

function SuggestBox$DefaultSuggestionDisplay$1_0(val$callback, val$curSuggestion){
  this.val$callback = val$callback;
  this.val$curSuggestion = val$curSuggestion;
}

function SuggestBox$DefaultSuggestionDisplay$1(){
}

_ = SuggestBox$DefaultSuggestionDisplay$1_0.prototype = SuggestBox$DefaultSuggestionDisplay$1.prototype = new Object_0;
_.execute = function execute_7(){
  $setNewSelection(this.val$callback.this$0, this.val$curSuggestion);
}
;
_.getClass$ = function getClass_187(){
  return Lcom_google_gwt_user_client_ui_SuggestBox$DefaultSuggestionDisplay$1_2_classLit;
}
;
_.castableTypeMap$ = {28:1, 32:1};
_.val$callback = null;
_.val$curSuggestion = null;
function $getSelectedItemIndex(this$static){
  var selectedItem;
  selectedItem = this$static.selectedItem;
  if (selectedItem) {
    return $indexOf_4(this$static.items, selectedItem, 0);
  }
  return -1;
}

function $selectItem_0(this$static, index){
  var items;
  items = this$static.items;
  index > -1 && index < items.size && $itemOver(this$static, dynamicCast((checkIndex(index, items.size) , items.array[index]), 39), false);
}

function SuggestBox$SuggestionMenu_0(){
  MenuBar_1.call(this, $clinit_314());
  this.element_0['className'] = '';
  this.focusOnHover = false;
}

function SuggestBox$SuggestionMenu(){
}

_ = SuggestBox$SuggestionMenu_0.prototype = SuggestBox$SuggestionMenu.prototype = new MenuBar;
_.getClass$ = function getClass_188(){
  return Lcom_google_gwt_user_client_ui_SuggestBox$SuggestionMenu_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
function SuggestBox$SuggestionMenuItem_0(suggestion){
  MenuItem_0.call(this, suggestion.displayString);
  this.element_0.style['whiteSpace'] = 'nowrap';
  this.element_0['className'] = 'item';
  this.suggestion = suggestion;
}

function SuggestBox$SuggestionMenuItem(){
}

_ = SuggestBox$SuggestionMenuItem_0.prototype = SuggestBox$SuggestionMenuItem.prototype = new MenuItem;
_.getClass$ = function getClass_189(){
  return Lcom_google_gwt_user_client_ui_SuggestBox$SuggestionMenuItem_2_classLit;
}
;
_.castableTypeMap$ = {38:1, 39:1, 133:1};
_.suggestion = null;
function SuggestOracle$Request_0(query){
  this.query = query;
  this.limit = 20;
}

function SuggestOracle$Request(){
}

_ = SuggestOracle$Request_0.prototype = SuggestOracle$Request.prototype = new Object_0;
_.getClass$ = function getClass_190(){
  return Lcom_google_gwt_user_client_ui_SuggestOracle$Request_2_classLit;
}
;
_.castableTypeMap$ = {};
_.limit = 20;
_.query = null;
function SuggestOracle$Response_0(suggestions){
  this.suggestions = suggestions;
}

function SuggestOracle$Response(){
}

_ = SuggestOracle$Response_0.prototype = SuggestOracle$Response.prototype = new Object_0;
_.getClass$ = function getClass_191(){
  return Lcom_google_gwt_user_client_ui_SuggestOracle$Response_2_classLit;
}
;
_.castableTypeMap$ = {};
_.suggestions = null;
function $addValueChangeHandler_1(this$static, handler){
  if (!this$static.valueChangeHandlerInitialized) {
    this$static.valueChangeHandlerInitialized = true;
    $addDomHandler(this$static, new ValueBoxBase$1_0(this$static), ($clinit_91() , $clinit_91() , TYPE_0));
  }
  return $addHandler_1(this$static, handler, (!TYPE_14 && (TYPE_14 = new GwtEvent$Type_0) , TYPE_14));
}

function $getValueOrThrow(this$static){
  var parseResult, text;
  text = $getPropertyString(this$static.element_0, 'value');
  parseResult = text;
  if ($equals_3('', text)) {
    return null;
  }
  return parseResult;
}

function $setText_2(this$static, text){
  this$static.element_0['value'] = text != null?text:'';
}

function $setValue_2(this$static){
  this$static.getValue();
  this$static.element_0['value'] = '';
}

function ValueBoxBase_0(elem){
  $clinit_254();
  this.element_0 = elem;
  addTo($clinit_176());
}

function ValueBoxBase(){
}

_ = ValueBoxBase.prototype = new FocusWidget;
_.getClass$ = function getClass_192(){
  return Lcom_google_gwt_user_client_ui_ValueBoxBase_2_classLit;
}
;
_.getValue = function getValue(){
  return $getValueOrThrow(this);
}
;
_.onBrowserEvent = function onBrowserEvent_4(event_0){
  var type;
  type = $eventGetTypeInt(event_0.type);
  (type & 896) != 0?$onBrowserEvent(this, event_0):$onBrowserEvent(this, event_0);
}
;
_.onLoad = function onLoad_2(){
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
_.valueChangeHandlerInitialized = false;
function $clinit_360(){
  $clinit_360 = nullMethod;
  $clinit_254();
  $clinit_364();
}

function TextBoxBase(){
}

_ = TextBoxBase.prototype = new ValueBoxBase;
_.getClass$ = function getClass_193(){
  return Lcom_google_gwt_user_client_ui_TextBoxBase_2_classLit;
}
;
_.getValue = function getValue_0(){
  var raw;
  return raw = $getValueOrThrow(this) , raw == null?'':raw;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
function TextArea_1(){
  $clinit_360();
  ValueBoxBase_0.call(this, $doc.createElement('textarea'), (!INSTANCE_1 && (INSTANCE_1 = new PassthroughRenderer_0) , !INSTANCE_0 && (INSTANCE_0 = new PassthroughParser_0)));
  this.element_0['className'] = 'gwt-TextArea';
}

function TextArea_0(){
}

_ = TextArea_1.prototype = TextArea_0.prototype = new TextBoxBase;
_.getClass$ = function getClass_194(){
  return Lcom_google_gwt_user_client_ui_TextArea_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
function TextBox_0(){
  var e;
  $clinit_360();
  ValueBoxBase_0.call(this, (e = $doc.createElement('INPUT') , e.type = 'text' , e), (!INSTANCE_1 && (INSTANCE_1 = new PassthroughRenderer_0) , !INSTANCE_0 && (INSTANCE_0 = new PassthroughParser_0)));
  this.element_0['className'] = 'gwt-TextBox';
}

function TextBox(){
}

_ = TextBox_0.prototype = TextBox.prototype = new TextBoxBase;
_.getClass$ = function getClass_195(){
  return Lcom_google_gwt_user_client_ui_TextBox_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
function ValueBoxBase$1_0(this$0){
  this.this$0 = this$0;
}

function ValueBoxBase$1(){
}

_ = ValueBoxBase$1_0.prototype = ValueBoxBase$1.prototype = new Object_0;
_.getClass$ = function getClass_196(){
  return Lcom_google_gwt_user_client_ui_ValueBoxBase$1_2_classLit;
}
;
_.onChange = function onChange(event_0){
  var raw;
  fire_3(this.this$0, (raw = $getValueOrThrow(this.this$0) , raw == null?'':raw));
}
;
_.castableTypeMap$ = {7:1, 25:1};
_.this$0 = null;
function $clinit_364(){
  $clinit_364 = nullMethod;
  CENTER_0 = new ValueBoxBase$TextAlignment$1_0;
  JUSTIFY = new ValueBoxBase$TextAlignment$2_0;
  LEFT = new ValueBoxBase$TextAlignment$3_0;
  RIGHT = new ValueBoxBase$TextAlignment$4_0;
  $VALUES_8 = initValues(_3Lcom_google_gwt_user_client_ui_ValueBoxBase$TextAlignment_2_classLit, {58:1, 138:1}, 57, [CENTER_0, JUSTIFY, LEFT, RIGHT]);
}

function values_9(){
  $clinit_364();
  return $VALUES_8;
}

function ValueBoxBase$TextAlignment(){
}

_ = ValueBoxBase$TextAlignment.prototype = new Enum;
_.getClass$ = function getClass_197(){
  return Lcom_google_gwt_user_client_ui_ValueBoxBase$TextAlignment_2_classLit;
}
;
_.castableTypeMap$ = {57:1, 58:1, 61:1, 62:1};
var $VALUES_8, CENTER_0, JUSTIFY, LEFT, RIGHT;
function ValueBoxBase$TextAlignment$1_0(){
  this.name_0 = 'CENTER';
  this.ordinal = 0;
}

function ValueBoxBase$TextAlignment$1(){
}

_ = ValueBoxBase$TextAlignment$1_0.prototype = ValueBoxBase$TextAlignment$1.prototype = new ValueBoxBase$TextAlignment;
_.getClass$ = function getClass_198(){
  return Lcom_google_gwt_user_client_ui_ValueBoxBase$TextAlignment$1_2_classLit;
}
;
_.castableTypeMap$ = {57:1, 58:1, 61:1, 62:1};
function ValueBoxBase$TextAlignment$2_0(){
  this.name_0 = 'JUSTIFY';
  this.ordinal = 1;
}

function ValueBoxBase$TextAlignment$2(){
}

_ = ValueBoxBase$TextAlignment$2_0.prototype = ValueBoxBase$TextAlignment$2.prototype = new ValueBoxBase$TextAlignment;
_.getClass$ = function getClass_199(){
  return Lcom_google_gwt_user_client_ui_ValueBoxBase$TextAlignment$2_2_classLit;
}
;
_.castableTypeMap$ = {57:1, 58:1, 61:1, 62:1};
function ValueBoxBase$TextAlignment$3_0(){
  this.name_0 = 'LEFT';
  this.ordinal = 2;
}

function ValueBoxBase$TextAlignment$3(){
}

_ = ValueBoxBase$TextAlignment$3_0.prototype = ValueBoxBase$TextAlignment$3.prototype = new ValueBoxBase$TextAlignment;
_.getClass$ = function getClass_200(){
  return Lcom_google_gwt_user_client_ui_ValueBoxBase$TextAlignment$3_2_classLit;
}
;
_.castableTypeMap$ = {57:1, 58:1, 61:1, 62:1};
function ValueBoxBase$TextAlignment$4_0(){
  this.name_0 = 'RIGHT';
  this.ordinal = 3;
}

function ValueBoxBase$TextAlignment$4(){
}

_ = ValueBoxBase$TextAlignment$4_0.prototype = ValueBoxBase$TextAlignment$4.prototype = new ValueBoxBase$TextAlignment;
_.getClass$ = function getClass_201(){
  return Lcom_google_gwt_user_client_ui_ValueBoxBase$TextAlignment$4_2_classLit;
}
;
_.castableTypeMap$ = {57:1, 58:1, 61:1, 62:1};
function $add_6(this$static, w){
  var td, tr, td_0;
  tr = $doc.createElement('tr');
  td = (td_0 = $doc.createElement('td') , td_0['align'] = this$static.horzAlign.textAlignString , td_0.style['verticalAlign'] = this$static.vertAlign.verticalAlignString , td_0);
  tr.appendChild(td);
  this$static.body_0.appendChild(tr);
  $removeFromParent_0(w);
  $add_7(this$static.children_0, w);
  td.appendChild(w.element_0);
  $setParent(w, this$static);
}

function VerticalPanel_0(){
  CellPanel_0.call(this);
  this.horzAlign = ($clinit_283() , ALIGN_DEFAULT);
  this.vertAlign = ($clinit_290() , ALIGN_TOP);
  this.table['cellSpacing'] = '0';
  this.table['cellPadding'] = '0';
}

function VerticalPanel(){
}

_ = VerticalPanel_0.prototype = VerticalPanel.prototype = new CellPanel;
_.getClass$ = function getClass_202(){
  return Lcom_google_gwt_user_client_ui_VerticalPanel_2_classLit;
}
;
_.remove_0 = function remove_9(w){
  var removed, td, parent_0;
  td = (parent_0 = w.element_0.parentNode , (!parent_0 || parent_0.nodeType != 1) && (parent_0 = null) , parent_0);
  removed = $remove_0(this, w);
  removed && this.body_0.removeChild($getParentElement(td));
  return removed;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1, 135:1};
function $add_7(this$static, w){
  $insert(this$static, w, this$static.size);
}

function $indexOf(this$static, w){
  var i;
  for (i = 0; i < this$static.size; ++i) {
    if (this$static.array[i] == w) {
      return i;
    }
  }
  return -1;
}

function $insert(this$static, w, beforeIndex){
  var i, newArray;
  if (beforeIndex < 0 || beforeIndex > this$static.size) {
    throw new IndexOutOfBoundsException_0;
  }
  if (this$static.size == this$static.array.length) {
    newArray = initDim(_3Lcom_google_gwt_user_client_ui_Widget_2_classLit, {58:1, 138:1}, 36, this$static.array.length * 2, 0);
    for (i = 0; i < this$static.array.length; ++i) {
      setCheck(newArray, i, this$static.array[i]);
    }
    this$static.array = newArray;
  }
  ++this$static.size;
  for (i = this$static.size - 1; i > beforeIndex; --i) {
    setCheck(this$static.array, i, this$static.array[i - 1]);
  }
  setCheck(this$static.array, beforeIndex, w);
}

function $remove_3(this$static, index){
  var i;
  if (index < 0 || index >= this$static.size) {
    throw new IndexOutOfBoundsException_0;
  }
  --this$static.size;
  for (i = index; i < this$static.size; ++i) {
    setCheck(this$static.array, i, this$static.array[i + 1]);
  }
  setCheck(this$static.array, this$static.size, null);
}

function $remove_4(this$static, w){
  var index;
  index = $indexOf(this$static, w);
  if (index == -1) {
    throw new NoSuchElementException_0;
  }
  $remove_3(this$static, index);
}

function WidgetCollection_0(parent_0){
  this.parent_0 = parent_0;
  this.array = initDim(_3Lcom_google_gwt_user_client_ui_Widget_2_classLit, {58:1, 138:1}, 36, 4, 0);
}

function WidgetCollection(){
}

_ = WidgetCollection_0.prototype = WidgetCollection.prototype = new Object_0;
_.getClass$ = function getClass_203(){
  return Lcom_google_gwt_user_client_ui_WidgetCollection_2_classLit;
}
;
_.iterator_0 = function iterator_4(){
  return new WidgetCollection$WidgetIterator_0(this);
}
;
_.castableTypeMap$ = {};
_.array = null;
_.parent_0 = null;
_.size = 0;
function $next_3(this$static){
  if (this$static.index_0 >= this$static.this$0.size) {
    throw new NoSuchElementException_0;
  }
  return this$static.this$0.array[++this$static.index_0];
}

function $remove_5(this$static){
  if (this$static.index_0 < 0 || this$static.index_0 >= this$static.this$0.size) {
    throw new IllegalStateException_0;
  }
  this$static.this$0.parent_0.remove_0(this$static.this$0.array[this$static.index_0--]);
}

function WidgetCollection$WidgetIterator_0(this$0){
  this.this$0 = this$0;
}

function WidgetCollection$WidgetIterator(){
}

_ = WidgetCollection$WidgetIterator_0.prototype = WidgetCollection$WidgetIterator.prototype = new Object_0;
_.getClass$ = function getClass_204(){
  return Lcom_google_gwt_user_client_ui_WidgetCollection$WidgetIterator_2_classLit;
}
;
_.hasNext = function hasNext_2(){
  return this.index_0 < this.this$0.size - 1;
}
;
_.next_0 = function next_6(){
  return $next_3(this);
}
;
_.remove = function remove_10(){
  $remove_5(this);
}
;
_.castableTypeMap$ = {};
_.index_0 = -1;
_.this$0 = null;
function ClippedImagePrototype_0(){
}

function ClippedImagePrototype(){
}

_ = ClippedImagePrototype_0.prototype = ClippedImagePrototype.prototype = new AbstractImagePrototype;
_.getClass$ = function getClass_205(){
  return Lcom_google_gwt_user_client_ui_impl_ClippedImagePrototype_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_373(){
  $clinit_373 = nullMethod;
  implPanel = new FocusImplSafari_0;
  implWidget = implPanel?new FocusImpl_0:implPanel;
}

function FocusImpl_0(){
}

function FocusImpl(){
}

_ = FocusImpl_0.prototype = FocusImpl.prototype = new Object_0;
_.focus_1 = function focus_1(elem){
  elem.focus();
}
;
_.getClass$ = function getClass_206(){
  return Lcom_google_gwt_user_client_ui_impl_FocusImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
var implPanel, implWidget;
function $createFocusHandler(){
  return function(evt){
    var div = this.parentNode;
    div.onfocus && $wnd.setTimeout(function(){
      div.focus();
    }
    , 0);
  }
  ;
}

function createFocusable0(focusHandler){
  $clinit_373();
  var div = $doc.createElement('div');
  div.tabIndex = 0;
  var input = $doc.createElement('input');
  input.type = 'text';
  input.tabIndex = -1;
  var style = input.style;
  style.opacity = 0;
  style.height = '1px';
  style.width = '1px';
  style.zIndex = -1;
  style.overflow = 'hidden';
  style.position = 'absolute';
  input.addEventListener('focus', focusHandler, false);
  div.appendChild(input);
  return div;
}

function FocusImplStandard(){
}

_ = FocusImplStandard.prototype = new FocusImpl;
_.getClass$ = function getClass_207(){
  return Lcom_google_gwt_user_client_ui_impl_FocusImplStandard_2_classLit;
}
;
_.castableTypeMap$ = {};
var focusHandler_0 = null;
function $focus_0(elem){
  $wnd.setTimeout(function(){
    elem.focus();
  }
  , 0);
}

function FocusImplSafari_0(){
}

function FocusImplSafari(){
}

_ = FocusImplSafari_0.prototype = FocusImplSafari.prototype = new FocusImplStandard;
_.focus_1 = function focus_2(elem){
  $focus_0(elem);
}
;
_.getClass$ = function getClass_208(){
  return Lcom_google_gwt_user_client_ui_impl_FocusImplSafari_2_classLit;
}
;
_.castableTypeMap$ = {};
function ArrayStoreException_0(){
  this.fillInStackTrace();
}

function ArrayStoreException_1(message){
  this.fillInStackTrace();
  this.detailMessage = message;
}

function ArrayStoreException(){
}

_ = ArrayStoreException_1.prototype = ArrayStoreException_0.prototype = ArrayStoreException.prototype = new RuntimeException;
_.getClass$ = function getClass_209(){
  return Ljava_lang_ArrayStoreException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1};
function Error_1(message, cause){
  this.fillInStackTrace();
  this.cause = cause;
  this.detailMessage = message;
}

function Error_0(){
}

_ = Error_0.prototype = new Throwable;
_.getClass$ = function getClass_210(){
  return Ljava_lang_Error_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 58:1, 150:1};
function AssertionError_0(message){
  Error_1.call(this, '' + message, message != null && message.castableTypeMap$ && !!message.castableTypeMap$[3]?dynamicCast(message, 3):null);
}

function AssertionError(){
}

_ = AssertionError_0.prototype = AssertionError.prototype = new Error_0;
_.getClass$ = function getClass_211(){
  return Ljava_lang_AssertionError_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 58:1, 150:1, 169:1};
function $clinit_382(){
  $clinit_382 = nullMethod;
  FALSE = new Boolean_1(false);
  TRUE = new Boolean_1(true);
}

function $equals_2(this$static, o){
  return o != null && o.castableTypeMap$ && !!o.castableTypeMap$[136] && dynamicCast(o, 136).value_0 == this$static.value_0;
}

function Boolean_1(value){
  this.value_0 = value;
}

function Boolean_0(){
}

_ = Boolean_1.prototype = Boolean_0.prototype = new Object_0;
_.compareTo$ = function compareTo_1(other){
  return this.value_0 == dynamicCast(other, 136).value_0?0:this.value_0?1:-1;
}
;
_.equals$ = function equals_3(o){
  return o != null && o.castableTypeMap$ && !!o.castableTypeMap$[136] && dynamicCast(o, 136).value_0 == this.value_0;
}
;
_.getClass$ = function getClass_212(){
  return Ljava_lang_Boolean_2_classLit;
}
;
_.hashCode$ = function hashCode_5(){
  return this.value_0?1231:1237;
}
;
_.toString$ = function toString_8(){
  return this.value_0?'true':'false';
}
;
_.castableTypeMap$ = {58:1, 61:1, 136:1};
_.value_0 = false;
var FALSE, TRUE;
function Character_0(value){
  this.value_0 = value;
}

function codePointAt(cs, index, limit){
  var hiSurrogate, loSurrogate;
  hiSurrogate = cs.charCodeAt(index++);
  if (hiSurrogate >= 55296 && hiSurrogate <= 56319 && index < limit && isLowSurrogate(loSurrogate = cs.charCodeAt(index))) {
    return 65536 + ((hiSurrogate & 1023) << 10) + (loSurrogate & 1023);
  }
  return hiSurrogate;
}

function digit_0(c, radix){
  if (radix < 2 || radix > 36) {
    return -1;
  }
  if (c >= 48 && c < 48 + (radix < 10?radix:10)) {
    return c - 48;
  }
  if (c >= 97 && c < radix + 97 - 10) {
    return c - 97 + 10;
  }
  if (c >= 65 && c < radix + 65 - 10) {
    return c - 65 + 10;
  }
  return -1;
}

function isLowSurrogate(ch){
  return ch >= 56320 && ch <= 57343;
}

function toChars(codePoint){
  if (codePoint < 0 || codePoint > 1114111) {
    throw new IllegalArgumentException_0;
  }
  return codePoint >= 65536?initValues(_3C_classLit, {58:1}, -1, [55296 + (~~(codePoint - 65536) >> 10 & 1023) & 65535, 56320 + (codePoint - 65536 & 1023) & 65535]):initValues(_3C_classLit, {58:1}, -1, [codePoint & 65535]);
}

function valueOf(c){
  var result;
  if (c < 128) {
    result = ($clinit_385() , boxedValues_0)[c];
    !result && (result = boxedValues_0[c] = new Character_0(c));
    return result;
  }
  return new Character_0(c);
}

function Character(){
}

_ = Character_0.prototype = Character.prototype = new Object_0;
_.compareTo$ = function compareTo_2(c){
  return this.value_0 - dynamicCast(c, 60).value_0;
}
;
_.equals$ = function equals_4(o){
  return o != null && o.castableTypeMap$ && !!o.castableTypeMap$[60] && dynamicCast(o, 60).value_0 == this.value_0;
}
;
_.getClass$ = function getClass_213(){
  return Ljava_lang_Character_2_classLit;
}
;
_.hashCode$ = function hashCode_6(){
  return this.value_0;
}
;
_.toString$ = function toString_9(){
  return String.fromCharCode(this.value_0);
}
;
_.castableTypeMap$ = {58:1, 60:1, 61:1};
_.value_0 = 0;
function $clinit_385(){
  $clinit_385 = nullMethod;
  boxedValues_0 = initDim(_3Ljava_lang_Character_2_classLit, {58:1, 138:1}, 60, 128, 0);
}

var boxedValues_0;
function Class_0(){
}

function createForArray(packageName, className, componentType){
  var clazz;
  clazz = new Class_0;
  clazz.typeName = packageName + className;
  clazz.modifiers = 4;
  clazz.componentType = componentType;
  return clazz;
}

function createForClass(packageName, className){
  var clazz;
  clazz = new Class_0;
  clazz.typeName = packageName + className;
  return clazz;
}

function createForEnum(packageName, className, enumConstantsFunc){
  var clazz;
  clazz = new Class_0;
  clazz.typeName = packageName + className;
  clazz.modifiers = enumConstantsFunc?8:0;
  return clazz;
}

function createForPrimitive(className){
  var clazz;
  clazz = new Class_0;
  clazz.typeName = '' + className;
  clazz.modifiers = 1;
  return clazz;
}

function Class(){
}

_ = Class_0.prototype = Class.prototype = new Object_0;
_.getClass$ = function getClass_214(){
  return Ljava_lang_Class_2_classLit;
}
;
_.toString$ = function toString_10(){
  return ((this.modifiers & 2) != 0?'interface ':(this.modifiers & 1) != 0?'':'class ') + this.typeName;
}
;
_.castableTypeMap$ = {};
_.componentType = null;
_.modifiers = 0;
_.typeName = null;
function ClassCastException_0(){
  this.fillInStackTrace();
}

function ClassCastException(){
}

_ = ClassCastException_0.prototype = ClassCastException.prototype = new RuntimeException;
_.getClass$ = function getClass_215(){
  return Ljava_lang_ClassCastException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1, 204:1};
function __parseAndValidateInt(s, radix){
  var i, length_0, startIndex, toReturn;
  if (s == null) {
    throw new NumberFormatException_0('null');
  }
  if (radix < 2 || radix > 36) {
    throw new NumberFormatException_0('radix ' + radix + ' out of range');
  }
  length_0 = s.length;
  startIndex = length_0 > 0 && s.charCodeAt(0) == 45?1:0;
  for (i = startIndex; i < length_0; ++i) {
    if (digit_0(s.charCodeAt(i), radix) == -1) {
      throw new NumberFormatException_0('For input string: "' + s + '"');
    }
  }
  toReturn = parseInt(s, radix);
  if (isNaN(toReturn)) {
    throw new NumberFormatException_0('For input string: "' + s + '"');
  }
   else if (toReturn < -2147483648 || toReturn > 2147483647) {
    throw new NumberFormatException_0('For input string: "' + s + '"');
  }
  return toReturn;
}

function Number_0(){
}

_ = Number_0.prototype = new Object_0;
_.getClass$ = function getClass_216(){
  return Ljava_lang_Number_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 64:1};
function Double_0(value){
  this.value_0 = value;
}

function compare_0(x, y){
  if (isNaN(x)) {
    return isNaN(y)?0:1;
  }
   else if (isNaN(y)) {
    return -1;
  }
  return x < y?-1:x > y?1:0;
}

function Double(){
}

_ = Double_0.prototype = Double.prototype = new Number_0;
_.compareTo$ = function compareTo_3(b){
  return compare_0(this.value_0, dynamicCast(b, 137).value_0);
}
;
_.equals$ = function equals_5(o){
  return o != null && o.castableTypeMap$ && !!o.castableTypeMap$[137] && dynamicCast(o, 137).value_0 == this.value_0;
}
;
_.getClass$ = function getClass_217(){
  return Ljava_lang_Double_2_classLit;
}
;
_.hashCode$ = function hashCode_7(){
  return ~~Math.max(Math.min(this.value_0, 2147483647), -2147483648);
}
;
_.toString$ = function toString_11(){
  return '' + this.value_0;
}
;
_.castableTypeMap$ = {58:1, 61:1, 64:1, 137:1};
--></script>
<script><!--
_.value_0 = 0;
function IllegalArgumentException_0(){
  this.fillInStackTrace();
}

function IllegalArgumentException_1(message){
  this.fillInStackTrace();
  this.detailMessage = message;
}

function IllegalArgumentException_2(message, cause){
  this.fillInStackTrace();
  this.cause = cause;
  this.detailMessage = message;
}

function IllegalArgumentException_3(cause){
  Exception_3.call(this, cause);
}

function IllegalArgumentException(){
}

_ = IllegalArgumentException_3.prototype = IllegalArgumentException_2.prototype = IllegalArgumentException_1.prototype = IllegalArgumentException_0.prototype = IllegalArgumentException.prototype = new RuntimeException;
_.getClass$ = function getClass_218(){
  return Ljava_lang_IllegalArgumentException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1, 202:1};
function IllegalStateException_0(){
  this.fillInStackTrace();
}

function IllegalStateException_1(s){
  this.fillInStackTrace();
  this.detailMessage = s;
}

function IllegalStateException_2(cause){
  this.fillInStackTrace();
  this.cause = cause;
  this.detailMessage = 'invalid operation transformation encountered';
}

function IllegalStateException(){
}

_ = IllegalStateException_2.prototype = IllegalStateException_1.prototype = IllegalStateException_0.prototype = IllegalStateException.prototype = new RuntimeException;
_.getClass$ = function getClass_219(){
  return Ljava_lang_IllegalStateException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1};
function IndexOutOfBoundsException_0(){
  this.fillInStackTrace();
}

function IndexOutOfBoundsException_1(message){
  this.fillInStackTrace();
  this.detailMessage = message;
}

function IndexOutOfBoundsException(){
}

_ = IndexOutOfBoundsException_1.prototype = IndexOutOfBoundsException_0.prototype = IndexOutOfBoundsException.prototype = new RuntimeException;
_.getClass$ = function getClass_220(){
  return Ljava_lang_IndexOutOfBoundsException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1};
function $compareTo_4(this$static, b){
  return this$static.value_0 < b.value_0?-1:this$static.value_0 > b.value_0?1:0;
}

function Integer_0(value){
  this.value_0 = value;
}

function toPowerOfTwoString(value){
  var buf, digits, pos;
  buf = initDim(_3C_classLit, {58:1}, -1, 8, 1);
  digits = ($clinit_400() , digits_0);
  pos = 7;
  if (value >= 0) {
    while (value > 15) {
      buf[pos--] = digits[value & 15];
      value >>= 4;
    }
  }
   else {
    while (pos > 0) {
      buf[pos--] = digits[value & 15];
      value >>= 4;
    }
  }
  buf[pos] = digits[value & 15];
  return __valueOf(buf, pos, 8);
}

function valueOf_0(i){
  var rebase, result;
  if (i > -129 && i < 128) {
    rebase = i + 128;
    result = ($clinit_396() , boxedValues_1)[rebase];
    !result && (result = boxedValues_1[rebase] = new Integer_0(i));
    return result;
  }
  return new Integer_0(i);
}

function Integer(){
}

_ = Integer_0.prototype = Integer.prototype = new Number_0;
_.compareTo$ = function compareTo_4(b){
  return $compareTo_4(this, dynamicCast(b, 63));
}
;
_.equals$ = function equals_6(o){
  return o != null && o.castableTypeMap$ && !!o.castableTypeMap$[63] && dynamicCast(o, 63).value_0 == this.value_0;
}
;
_.getClass$ = function getClass_221(){
  return Ljava_lang_Integer_2_classLit;
}
;
_.hashCode$ = function hashCode_8(){
  return this.value_0;
}
;
_.toString$ = function toString_12(){
  return '' + this.value_0;
}
;
_.castableTypeMap$ = {58:1, 61:1, 63:1, 64:1};
_.value_0 = 0;
function $clinit_396(){
  $clinit_396 = nullMethod;
  boxedValues_1 = initDim(_3Ljava_lang_Integer_2_classLit, {58:1, 138:1}, 63, 256, 0);
}

var boxedValues_1;
function max(x, y){
  return x > y?x:y;
}

function min_0(x, y){
  return x < y?x:y;
}

function NullPointerException_0(){
  this.fillInStackTrace();
}

function NullPointerException_1(message){
  this.fillInStackTrace();
  this.detailMessage = message;
}

function NullPointerException(){
}

_ = NullPointerException_1.prototype = NullPointerException_0.prototype = NullPointerException.prototype = new RuntimeException;
_.getClass$ = function getClass_222(){
  return Ljava_lang_NullPointerException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1};
function $clinit_400(){
  $clinit_400 = nullMethod;
  digits_0 = initValues(_3C_classLit, {58:1}, -1, [48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122]);
}

var digits_0;
function NumberFormatException_0(message){
  this.fillInStackTrace();
  this.detailMessage = message;
}

function NumberFormatException(){
}

_ = NumberFormatException_0.prototype = NumberFormatException.prototype = new IllegalArgumentException;
_.getClass$ = function getClass_223(){
  return Ljava_lang_NumberFormatException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1, 147:1, 202:1};
function StackTraceElement_0(methodName){
  this.className_0 = 'Unknown';
  this.methodName = methodName;
  this.fileName = 'Unknown source';
  this.lineNumber = 0;
}

function StackTraceElement(){
}

_ = StackTraceElement_0.prototype = StackTraceElement.prototype = new Object_0;
_.getClass$ = function getClass_224(){
  return Ljava_lang_StackTraceElement_2_classLit;
}
;
_.toString$ = function toString_13(){
  return this.className_0 + '.' + this.methodName + '(' + this.fileName + ':' + this.lineNumber + ')';
}
;
_.castableTypeMap$ = {58:1, 65:1};
_.className_0 = null;
_.fileName = null;
_.lineNumber = 0;
_.methodName = null;
function $codePointAt(this$static, index){
  return codePointAt(this$static, index, this$static.length);
}

function $equals_3(this$static, other){
  if (!(other != null && other.castableTypeMap$ && !!other.castableTypeMap$[1])) {
    return false;
  }
  return String(this$static) == other;
}

function $equalsIgnoreCase(this$static, other){
  if (other == null)
    return false;
  return this$static == other || this$static.toLowerCase() == other.toLowerCase();
}

function $getChars(this$static, srcBegin, srcEnd, dst, dstBegin){
  var srcIdx;
  for (srcIdx = srcBegin; srcIdx < srcEnd; ++srcIdx) {
    dst[dstBegin++] = this$static.charCodeAt(srcIdx);
  }
}

function $indexOf_0(this$static, codePoint, startIndex){
  return this$static.indexOf(fromCodePoint(codePoint), startIndex);
}

function $isEmpty_0(this$static){
  return !this$static.length;
}

function $replace_1(this$static, from, to){
  var regex;
  if (from < 256) {
    regex = toPowerOfTwoString(from);
    regex = '\\x' + '00'.substring(regex.length) + regex;
  }
   else {
    regex = String.fromCharCode(from);
  }
  return this$static.replace(RegExp(regex, 'g'), String.fromCharCode(to));
}

function $replace_2(this$static, from, to){
  var regex, replacement;
  regex = $replaceAll(from, '([/\\\\\\.\\*\\+\\?\\|\\(\\)\\[\\]\\{\\}$^])', '\\\\$1');
  replacement = $replaceAll($replaceAll(to, '\\\\', '\\\\\\\\'), '\\$', '\\\\$');
  return $replaceAll(this$static, regex, replacement);
}

function $replaceAll(this$static, regex, replace){
  replace = __translateReplaceString(replace);
  return this$static.replace(RegExp(regex, 'g'), replace);
}

function $split(this$static, regex, maxMatch){
  var compiled = new RegExp(regex, 'g');
  var out = [];
  var count = 0;
  var trail = this$static;
  var lastTrail = null;
  while (true) {
    var matchObj = compiled.exec(trail);
    if (matchObj == null || trail == '' || count == maxMatch - 1 && maxMatch > 0) {
      out[count] = trail;
      break;
    }
     else {
      out[count] = trail.substring(0, matchObj.index);
      trail = trail.substring(matchObj.index + matchObj[0].length, trail.length);
      compiled.lastIndex = 0;
      if (lastTrail == trail) {
        out[count] = trail.substring(0, 1);
        trail = trail.substring(1);
      }
      lastTrail = trail;
      count++;
    }
  }
  if (maxMatch == 0 && this$static.length > 0) {
    var lastNonEmpty = out.length;
    while (lastNonEmpty > 0 && out[lastNonEmpty - 1] == '') {
      --lastNonEmpty;
    }
    lastNonEmpty < out.length && out.splice(lastNonEmpty, out.length - lastNonEmpty);
  }
  var jr = initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, out.length, 0);
  for (var i = 0; i < out.length; ++i) {
    jr[i] = out[i];
  }
  return jr;
}

function $substring(this$static, beginIndex){
  return this$static.substr(beginIndex, this$static.length - beginIndex);
}

function $substring_0(this$static, beginIndex, endIndex){
  return this$static.substr(beginIndex, endIndex - beginIndex);
}

function $toCharArray(this$static){
  var charArr, n;
  n = this$static.length;
  charArr = initDim(_3C_classLit, {58:1}, -1, n, 1);
  $getChars(this$static, 0, n, charArr, 0);
  return charArr;
}

function $trim(this$static){
  if (this$static.length == 0 || this$static[0] > ' ' && this$static[this$static.length - 1] > ' ') {
    return this$static;
  }
  var r1 = this$static.replace(/^(\s*)/, '');
  var r2 = r1.replace(/\s*$/, '');
  return r2;
}

function __checkBounds(legalCount, end){
  if (end < 0) {
    throw new StringIndexOutOfBoundsException_0(end);
  }
  if (end > legalCount) {
    throw new StringIndexOutOfBoundsException_0(end);
  }
}

function __translateReplaceString(replaceStr){
  var pos;
  pos = 0;
  while (0 <= (pos = replaceStr.indexOf('\\', pos))) {
    replaceStr.charCodeAt(pos + 1) == 36?(replaceStr = replaceStr.substr(0, pos - 0) + '$' + $substring(replaceStr, ++pos)):(replaceStr = replaceStr.substr(0, pos - 0) + $substring(replaceStr, ++pos));
  }
  return replaceStr;
}

function __valueOf(x, start, end){
  x = x.slice(start, end);
  return String.fromCharCode.apply(null, x);
}

function compareTo_5(thisStr, otherStr){
  thisStr = String(thisStr);
  if (thisStr == otherStr) {
    return 0;
  }
  return thisStr < otherStr?-1:1;
}

function fromCodePoint(codePoint){
  var hiSurrogate, loSurrogate;
  if (codePoint >= 65536) {
    hiSurrogate = 55296 + (~~(codePoint - 65536) >> 10 & 1023) & 65535;
    loSurrogate = 56320 + (codePoint - 65536 & 1023) & 65535;
    return String.fromCharCode(hiSurrogate) + String.fromCharCode(loSurrogate);
  }
   else {
    return String.fromCharCode(codePoint & 65535);
  }
}

_ = String.prototype;
_.compareTo$ = function compareTo_6(other){
  return compareTo_5(this, dynamicCast(other, 1));
}
;
_.equals$ = function equals_7(other){
  return $equals_3(this, other);
}
;
_.getClass$ = function getClass_225(){
  return Ljava_lang_String_2_classLit;
}
;
_.hashCode$ = function hashCode_9(){
  return getHashCode_0(this);
}
;
_.toString$ = function toString_14(){
  return this;
}
;
_.castableTypeMap$ = {1:1, 58:1, 59:1, 61:1};
function $clinit_405(){
  $clinit_405 = nullMethod;
  back_0 = {};
  front = {};
}

function compute(str){
  var hashCode, i, n, nBatch;
  hashCode = 0;
  n = str.length;
  nBatch = n - 4;
  i = 0;
  while (i < nBatch) {
    hashCode = str.charCodeAt(i + 3) + 31 * (str.charCodeAt(i + 2) + 31 * (str.charCodeAt(i + 1) + 31 * (str.charCodeAt(i) + 31 * hashCode))) | 0;
    i += 4;
  }
  while (i < n) {
    hashCode = hashCode * 31 + str.charCodeAt(i++);
  }
  return hashCode | 0;
}

function getHashCode_0(str){
  $clinit_405();
  var key = ':' + str;
  var result = front[key];
  if (result != null) {
    return result;
  }
  result = back_0[key];
  result == null && (result = compute(str));
  increment();
  return front[key] = result;
}

function increment(){
  if (count_3 == 256) {
    back_0 = front;
    front = {};
    count_3 = 0;
  }
  ++count_3;
}

var back_0, count_3 = 0, front;
function $append_2(this$static, x){
  this$static.impl.string += x;
  return this$static;
}

function $replace_3(this$static, end){
  $replace(this$static.impl, 0, end, '');
  return this$static;
}

function StringBuffer_0(){
  this.impl = new StringBufferImplAppend_0;
}

function StringBuffer(){
}

_ = StringBuffer_0.prototype = StringBuffer.prototype = new Object_0;
_.getClass$ = function getClass_226(){
  return Ljava_lang_StringBuffer_2_classLit;
}
;
_.toString$ = function toString_15(){
  return this.impl.string;
}
;
_.castableTypeMap$ = {59:1};
function $append_3(this$static, x){
  this$static.impl.string += String.fromCharCode(x);
  return this$static;
}

function $append_4(this$static, x){
  this$static.impl.string += String.fromCharCode.apply(null, x);
  return this$static;
}

function $append_5(this$static, x){
  this$static.impl.string += x;
  return this$static;
}

function $append_6(this$static, x){
  this$static.impl.string += x;
  return this$static;
}

function $append_7(this$static, x){
  this$static.impl.string += x;
  return this$static;
}

function $append_8(this$static, x){
  this$static.impl.string += x;
  return this$static;
}

function $charAt_0(this$static, index){
  return this$static.impl.string.charCodeAt(index);
}

function $insert_0(this$static, index, x){
  return $replace(this$static.impl, index, index, x) , this$static;
}

function $replace_4(this$static, start, end, toInsert){
  $replace(this$static.impl, start, end, toInsert);
  return this$static;
}

function $setCharAt(this$static, index, x){
  $replace_4(this$static, index, index + 1, String.fromCharCode(x));
}

function $setLength_0(this$static, newLength){
  var oldLength;
  oldLength = this$static.impl.string.length;
  newLength < oldLength?($replace(this$static.impl, newLength, oldLength, '') , this$static):newLength > oldLength && $append_4(this$static, initDim(_3C_classLit, {58:1}, -1, newLength - oldLength, 1));
}

function StringBuilder_0(){
  this.impl = new StringBufferImplAppend_0;
}

function StringBuilder_1(){
  this.impl = new StringBufferImplAppend_0;
}

function StringBuilder_2(s){
  this.impl = new StringBufferImplAppend_0;
  this.impl.string += s;
}

function StringBuilder(){
}

_ = StringBuilder_2.prototype = StringBuilder_1.prototype = StringBuilder_0.prototype = StringBuilder.prototype = new Object_0;
_.getClass$ = function getClass_227(){
  return Ljava_lang_StringBuilder_2_classLit;
}
;
_.toString$ = function toString_16(){
  return this.impl.string;
}
;
_.castableTypeMap$ = {59:1};
function StringIndexOutOfBoundsException_0(index){
  this.fillInStackTrace();
  this.detailMessage = 'String index out of range: ' + index;
}

function StringIndexOutOfBoundsException(){
}

_ = StringIndexOutOfBoundsException_0.prototype = StringIndexOutOfBoundsException.prototype = new IndexOutOfBoundsException;
_.getClass$ = function getClass_228(){
  return Ljava_lang_StringIndexOutOfBoundsException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1};
function arraycopy(src, srcOfs, dest, destOfs, len){
  var destArray, destComp, destEnd, destType, destlen, srcArray, srcComp, srcType, srclen;
  if (src == null || dest == null) {
    throw new NullPointerException_0;
  }
  srcType = getClass__devirtual$(src);
  destType = getClass__devirtual$(dest);
  if ((srcType.modifiers & 4) == 0 || (destType.modifiers & 4) == 0) {
    throw new ArrayStoreException_1('Must be array types');
  }
  srcComp = srcType.componentType;
  destComp = destType.componentType;
  if (!((srcComp.modifiers & 1) != 0?srcComp == destComp:(destComp.modifiers & 1) == 0)) {
    throw new ArrayStoreException_1('Array types must match');
  }
  srclen = src.length;
  destlen = dest.length;
  if (srcOfs < 0 || destOfs < 0 || len < 0 || srcOfs + len > srclen || destOfs + len > destlen) {
    throw new IndexOutOfBoundsException_0;
  }
  if (((srcComp.modifiers & 1) == 0 || (srcComp.modifiers & 4) != 0) && srcType != destType) {
    srcArray = dynamicCast(src, 138);
    destArray = dynamicCast(dest, 138);
    if (src === dest && srcOfs < destOfs) {
      srcOfs += len;
      for (destEnd = destOfs + len; destEnd-- > destOfs;) {
        setCheck(destArray, destEnd, srcArray[--srcOfs]);
      }
    }
     else {
      for (destEnd = destOfs + len; destOfs < destEnd;) {
        setCheck(destArray, destOfs++, srcArray[srcOfs++]);
      }
    }
  }
   else {
    Array.prototype.splice.apply(dest, [destOfs, len].concat(src.slice(srcOfs, srcOfs + len)));
  }
}

function identityHashCode(o){
  return o == null?0:o != null && o.castableTypeMap$ && !!o.castableTypeMap$[1]?getHashCode_0(dynamicCast(o, 1)):o.$H || (o.$H = ++sNextHashId);
}

function UnsupportedOperationException_0(){
  this.fillInStackTrace();
}

function UnsupportedOperationException_1(message){
  this.fillInStackTrace();
  this.detailMessage = message;
}

function UnsupportedOperationException(){
}

_ = UnsupportedOperationException_1.prototype = UnsupportedOperationException_0.prototype = UnsupportedOperationException.prototype = new RuntimeException;
_.getClass$ = function getClass_229(){
  return Ljava_lang_UnsupportedOperationException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1};
function $equals_4(this$static, obj){
  var entry, entry$iterator, otherKey, otherMap, otherValue;
  if (obj === this$static) {
    return true;
  }
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[26])) {
    return false;
  }
  otherMap = dynamicCast(obj, 26);
  if (this$static.size_0() != otherMap.size_0()) {
    return false;
  }
  for (entry$iterator = otherMap.entrySet_0().iterator_0(); entry$iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.next_0(), 66);
    otherKey = entry.getKey();
    otherValue = entry.getValue();
    if (!this$static.containsKey(otherKey)) {
      return false;
    }
    if (!equalsWithNullCheck(otherValue, this$static.get(otherKey))) {
      return false;
    }
  }
  return true;
}

function $implFindEntry(this$static, key, remove){
  var entry, iter, k;
  for (iter = this$static.entrySet_0().iterator_0(); iter.hasNext();) {
    entry = dynamicCast(iter.next_0(), 66);
    k = entry.getKey();
    if (key == null?k == null:equals__devirtual$(key, k)) {
      remove && iter.remove();
      return entry;
    }
  }
  return null;
}

function $keySet(this$static){
  var entrySet;
  entrySet = this$static.entrySet_0();
  return new AbstractMap$1_0(this$static, entrySet);
}

function $putAll(this$static, t){
  var e, iter;
  for (iter = t.entrySet_0().iterator_0(); iter.hasNext();) {
    e = dynamicCast(iter.next_0(), 66);
    this$static.put(e.getKey(), e.getValue());
  }
}

function $toString_6(this$static){
  var comma, entry, iter, s;
  s = '{';
  comma = false;
  for (iter = this$static.entrySet_0().iterator_0(); iter.hasNext();) {
    entry = dynamicCast(iter.next_0(), 66);
    comma?(s += ', '):(comma = true);
    s += '' + entry.getKey();
    s += '=';
    s += '' + entry.getValue();
  }
  return s + '}';
}

function AbstractMap(){
}

_ = AbstractMap.prototype = new Object_0;
_.clear = function clear_1(){
  this.entrySet_0().clear();
}
;
_.containsKey = function containsKey(key){
  return !!$implFindEntry(this, key, false);
}
;
_.equals$ = function equals_8(obj){
  return $equals_4(this, obj);
}
;
_.get = function get_1(key){
  var entry;
  return entry = $implFindEntry(this, key, false) , !entry?null:entry.getValue();
}
;
_.getClass$ = function getClass_230(){
  return Ljava_util_AbstractMap_2_classLit;
}
;
_.hashCode$ = function hashCode_10(){
  var entry, entry$iterator, hashCode;
  hashCode = 0;
  for (entry$iterator = this.entrySet_0().iterator_0(); entry$iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.next_0(), 66);
    hashCode += entry.hashCode$();
    hashCode = ~~hashCode;
  }
  return hashCode;
}
;
_.isEmpty = function isEmpty_0(){
  return this.size_0() == 0;
}
;
_.keySet_0 = function keySet_0(){
  var entrySet;
  return entrySet = this.entrySet_0() , new AbstractMap$1_0(this, entrySet);
}
;
_.put = function put(key, value){
  throw new UnsupportedOperationException_1('Put not supported on this map');
}
;
_.putAll = function putAll(t){
  $putAll(this, t);
}
;
_.remove_2 = function remove_11(key){
  var entry;
  entry = $implFindEntry(this, key, true);
  return !entry?null:entry.getValue();
}
;
_.size_0 = function size_5(){
  return this.entrySet_0().size_0();
}
;
_.toString$ = function toString_17(){
  return $toString_6(this);
}
;
_.castableTypeMap$ = {26:1};
function $addAllHashEntries(this$static, dest){
  var hashCodeMap = this$static.hashCodeMap;
  for (var hashCode in hashCodeMap) {
    var hashCodeInt = parseInt(hashCode, 10);
    if (hashCode == hashCodeInt) {
      var array = hashCodeMap[hashCodeInt];
      for (var i = 0, c = array.length; i < c; ++i) {
        dest.add_0(array[i]);
      }
    }
  }
}

function $addAllStringEntries(this$static, dest){
  var stringMap = this$static.stringMap;
  for (var key in stringMap) {
    if (key.charCodeAt(0) == 58) {
      var entry = new AbstractHashMap$MapEntryString_0(this$static, key.substring(1));
      dest.add_0(entry);
    }
  }
}

function $clearImpl(this$static){
  this$static.hashCodeMap = [];
  this$static.stringMap = {};
  this$static.nullSlotLive = false;
  this$static.nullSlot = null;
  this$static.size = 0;
}

function $containsKey_0(this$static, key){
  return key == null?this$static.nullSlotLive:key != null && key.castableTypeMap$ && !!key.castableTypeMap$[1]?$hasStringValue(this$static, dynamicCast(key, 1)):$hasHashValue(this$static, key, this$static.getHashCode(key));
}

function $get_2(this$static, key){
  return key == null?this$static.nullSlot:key != null && key.castableTypeMap$ && !!key.castableTypeMap$[1]?this$static.stringMap[':' + dynamicCast(key, 1)]:$getHashValue(this$static, key, this$static.getHashCode(key));
}

function $getHashValue(this$static, key, hashCode){
  var array = this$static.hashCodeMap[hashCode];
  if (array) {
    for (var i = 0, c = array.length; i < c; ++i) {
      var entry = array[i];
      var entryKey = entry.getKey();
      if (this$static.equalsBridge(key, entryKey)) {
        return entry.getValue();
      }
    }
  }
  return null;
}

function $hasHashValue(this$static, key, hashCode){
  var array = this$static.hashCodeMap[hashCode];
  if (array) {
    for (var i = 0, c = array.length; i < c; ++i) {
      var entry = array[i];
      var entryKey = entry.getKey();
      if (this$static.equalsBridge(key, entryKey)) {
        return true;
      }
    }
  }
  return false;
}

function $hasStringValue(this$static, key){
  return ':' + key in this$static.stringMap;
}

function $put(this$static, key, value){
  return key == null?$putNullSlot(this$static, value):key != null && key.castableTypeMap$ && !!key.castableTypeMap$[1]?$putStringValue(this$static, dynamicCast(key, 1), value):$putHashValue(this$static, key, value, this$static.getHashCode(key));
}

function $putHashValue(this$static, key, value, hashCode){
  var array = this$static.hashCodeMap[hashCode];
  if (array) {
    for (var i = 0, c = array.length; i < c; ++i) {
      var entry = array[i];
      var entryKey = entry.getKey();
      if (this$static.equalsBridge(key, entryKey)) {
        var previous = entry.getValue();
        entry.setValue(value);
        return previous;
      }
    }
  }
   else {
    array = this$static.hashCodeMap[hashCode] = [];
  }
  var entry = new MapEntryImpl_0(key, value);
  array.push(entry);
  ++this$static.size;
  return null;
}

function $putNullSlot(this$static, value){
  var result;
  result = this$static.nullSlot;
  this$static.nullSlot = value;
  if (!this$static.nullSlotLive) {
    this$static.nullSlotLive = true;
    ++this$static.size;
  }
  return result;
}

function $putStringValue(this$static, key, value){
  var result, stringMap = this$static.stringMap;
  key = ':' + key;
  key in stringMap?(result = stringMap[key]):++this$static.size;
  stringMap[key] = value;
  return result;
}

function $remove_6(this$static, key){
  return key == null?$removeNullSlot(this$static):key != null && key.castableTypeMap$ && !!key.castableTypeMap$[1]?$removeStringValue(this$static, dynamicCast(key, 1)):$removeHashValue(this$static, key, this$static.getHashCode(key));
}

function $removeHashValue(this$static, key, hashCode){
  var array = this$static.hashCodeMap[hashCode];
  if (array) {
    for (var i = 0, c = array.length; i < c; ++i) {
      var entry = array[i];
      var entryKey = entry.getKey();
      if (this$static.equalsBridge(key, entryKey)) {
        array.length == 1?delete this$static.hashCodeMap[hashCode]:array.splice(i, 1);
        --this$static.size;
        return entry.getValue();
      }
    }
  }
  return null;
}

function $removeNullSlot(this$static){
  var result;
  result = this$static.nullSlot;
  this$static.nullSlot = null;
  if (this$static.nullSlotLive) {
    this$static.nullSlotLive = false;
    --this$static.size;
  }
  return result;
}

function $removeStringValue(this$static, key){
  var result, stringMap = this$static.stringMap;
  key = ':' + key;
  if (key in stringMap) {
    result = stringMap[key];
    --this$static.size;
    delete stringMap[key];
  }
  return result;
}

function AbstractHashMap_2(ignored, alsoIgnored){
  $clearImpl(this);
  if (ignored < 0 || alsoIgnored < 0) {
    throw new IllegalArgumentException_1('initial capacity was negative or load factor was non-positive');
  }
}

function AbstractHashMap(){
}

_ = AbstractHashMap.prototype = new AbstractMap;
_.clear = function clear_2(){
  $clearImpl(this);
}
;
_.containsKey = function containsKey_0(key){
  return key == null?this.nullSlotLive:key != null && key.castableTypeMap$ && !!key.castableTypeMap$[1]?':' + dynamicCast(key, 1) in this.stringMap:$hasHashValue(this, key, this.getHashCode(key));
}
;
_.entrySet_0 = function entrySet_0(){
  return new AbstractHashMap$EntrySet_0(this);
}
;
_.equalsBridge = function equalsBridge(value1, value2){
  return this.equals(value1, value2);
}
;
_.get = function get_2(key){
  return key == null?this.nullSlot:key != null && key.castableTypeMap$ && !!key.castableTypeMap$[1]?this.stringMap[':' + dynamicCast(key, 1)]:$getHashValue(this, key, this.getHashCode(key));
}
;
_.getClass$ = function getClass_231(){
  return Ljava_util_AbstractHashMap_2_classLit;
}
;
_.put = function put_0(key, value){
  return key == null?$putNullSlot(this, value):key != null && key.castableTypeMap$ && !!key.castableTypeMap$[1]?$putStringValue(this, dynamicCast(key, 1), value):$putHashValue(this, key, value, this.getHashCode(key));
}
;
_.remove_2 = function remove_12(key){
  return key == null?$removeNullSlot(this):key != null && key.castableTypeMap$ && !!key.castableTypeMap$[1]?$removeStringValue(this, dynamicCast(key, 1)):$removeHashValue(this, key, this.getHashCode(key));
}
;
_.size_0 = function size_6(){
  return this.size;
}
;
_.castableTypeMap$ = {26:1};
_.hashCodeMap = null;
_.nullSlot = null;
_.nullSlotLive = false;
_.size = 0;
_.stringMap = null;
function AbstractSet(){
}

_ = AbstractSet.prototype = new AbstractCollection;
_.equals$ = function equals_9(o){
  var iter, other, otherItem;
  if (o === this) {
    return true;
  }
  if (!(o != null && o.castableTypeMap$ && !!o.castableTypeMap$[40])) {
    return false;
  }
  other = dynamicCast(o, 40);
  if (other.size_0() != this.size_0()) {
    return false;
  }
  for (iter = other.iterator_0(); iter.hasNext();) {
    otherItem = iter.next_0();
    if (!this.contains(otherItem)) {
      return false;
    }
  }
  return true;
}
;
_.getClass$ = function getClass_232(){
  return Ljava_util_AbstractSet_2_classLit;
}
;
_.hashCode$ = function hashCode_11(){
  var hashCode, iter, next;
  hashCode = 0;
  for (iter = this.iterator_0(); iter.hasNext();) {
    next = iter.next_0();
    if (next != null) {
      hashCode += hashCode__devirtual$(next);
      hashCode = ~~hashCode;
    }
  }
  return hashCode;
}
;
_.castableTypeMap$ = {40:1, 130:1};
function $contains_0(this$static, o){
  var entry, key, value;
  if (o != null && o.castableTypeMap$ && !!o.castableTypeMap$[66]) {
    entry = dynamicCast(o, 66);
    key = entry.getKey();
    if (this$static.this$0.containsKey(key)) {
      value = this$static.this$0.get(key);
      return this$static.this$0.equals(entry.getValue(), value);
    }
  }
  return false;
}

function AbstractHashMap$EntrySet_0(this$0){
  this.this$0 = this$0;
}

function AbstractHashMap$EntrySet(){
}

_ = AbstractHashMap$EntrySet_0.prototype = AbstractHashMap$EntrySet.prototype = new AbstractSet;
_.clear = function clear_3(){
  this.this$0.clear();
}
;
_.contains = function contains_1(o){
  return $contains_0(this, o);
}
;
_.getClass$ = function getClass_233(){
  return Ljava_util_AbstractHashMap$EntrySet_2_classLit;
}
;
_.iterator_0 = function iterator_5(){
  return new AbstractHashMap$EntrySetIterator_0(this.this$0);
}
;
_.remove_1 = function remove_13(entry){
  var key;
  if ($contains_0(this, entry)) {
    key = dynamicCast(entry, 66).getKey();
    this.this$0.remove_2(key);
    return true;
  }
  return false;
}
;
_.size_0 = function size_7(){
  return this.this$0.size_0();
}
;
_.castableTypeMap$ = {40:1, 130:1};
_.this$0 = null;
function AbstractHashMap$EntrySetIterator_0(this$0){
  var list;
  this.this$0 = this$0;
  list = new ArrayList_0;
  this$0.nullSlotLive && $add_9(list, new AbstractHashMap$MapEntryNull_0(this$0));
  $addAllStringEntries(this$0, list);
  $addAllHashEntries(this$0, list);
  this.iter = new AbstractList$IteratorImpl_0(list);
}

function AbstractHashMap$EntrySetIterator(){
}

_ = AbstractHashMap$EntrySetIterator_0.prototype = AbstractHashMap$EntrySetIterator.prototype = new Object_0;
_.getClass$ = function getClass_234(){
  return Ljava_util_AbstractHashMap$EntrySetIterator_2_classLit;
}
;
_.hasNext = function hasNext_3(){
  return $hasNext_3(this.iter);
}
;
_.next_0 = function next_7(){
  return this.last = dynamicCast($next_6(this.iter), 66);
}
;
_.remove = function remove_14(){
  if (!this.last) {
    throw new IllegalStateException_1('Must call next() before remove().');
  }
   else {
    $remove_7(this.iter);
    this.this$0.remove_2(this.last.getKey());
    this.last = null;
  }
}
;
_.castableTypeMap$ = {};
_.iter = null;
_.last = null;
_.this$0 = null;
function AbstractMapEntry(){
}

_ = AbstractMapEntry.prototype = new Object_0;
--></script>
<script><!--
_.equals$ = function equals_10(other){
  var entry;
  if (other != null && other.castableTypeMap$ && !!other.castableTypeMap$[66]) {
    entry = dynamicCast(other, 66);
    if (equalsWithNullCheck(this.getKey(), entry.getKey()) && equalsWithNullCheck(this.getValue(), entry.getValue())) {
      return true;
    }
  }
  return false;
}
;
_.getClass$ = function getClass_235(){
  return Ljava_util_AbstractMapEntry_2_classLit;
}
;
_.hashCode$ = function hashCode_12(){
  var keyHash, valueHash;
  keyHash = 0;
  valueHash = 0;
  this.getKey() != null && (keyHash = hashCode__devirtual$(this.getKey()));
  this.getValue() != null && (valueHash = hashCode__devirtual$(this.getValue()));
  return keyHash ^ valueHash;
}
;
_.toString$ = function toString_18(){
  return this.getKey() + '=' + this.getValue();
}
;
_.castableTypeMap$ = {66:1};
function AbstractHashMap$MapEntryNull_0(this$0){
  this.this$0 = this$0;
}

function AbstractHashMap$MapEntryNull(){
}

_ = AbstractHashMap$MapEntryNull_0.prototype = AbstractHashMap$MapEntryNull.prototype = new AbstractMapEntry;
_.getClass$ = function getClass_236(){
  return Ljava_util_AbstractHashMap$MapEntryNull_2_classLit;
}
;
_.getKey = function getKey(){
  return null;
}
;
_.getValue = function getValue_1(){
  return this.this$0.nullSlot;
}
;
_.setValue = function setValue(object){
  return $putNullSlot(this.this$0, object);
}
;
_.castableTypeMap$ = {66:1};
_.this$0 = null;
function AbstractHashMap$MapEntryString_0(this$0, key){
  this.this$0 = this$0;
  this.key = key;
}

function AbstractHashMap$MapEntryString(){
}

_ = AbstractHashMap$MapEntryString_0.prototype = AbstractHashMap$MapEntryString.prototype = new AbstractMapEntry;
_.getClass$ = function getClass_237(){
  return Ljava_util_AbstractHashMap$MapEntryString_2_classLit;
}
;
_.getKey = function getKey_0(){
  return this.key;
}
;
_.getValue = function getValue_2(){
  return this.this$0.stringMap[':' + this.key];
}
;
_.setValue = function setValue_0(object){
  return $putStringValue(this.this$0, this.key, object);
}
;
_.castableTypeMap$ = {66:1};
_.key = null;
_.this$0 = null;
function $equals_5(this$static, o){
  var elem, elemOther, iter, iterOther, other;
  if (o === this$static) {
    return true;
  }
  if (!(o != null && o.castableTypeMap$ && !!o.castableTypeMap$[27])) {
    return false;
  }
  other = dynamicCast(o, 27);
  if (this$static.size_0() != other.size_0()) {
    return false;
  }
  iter = this$static.iterator_0();
  iterOther = other.iterator_0();
  while (iter.hasNext()) {
    elem = iter.next_0();
    elemOther = iterOther.next_0();
    if (!(elem == null?elemOther == null:equals__devirtual$(elem, elemOther))) {
      return false;
    }
  }
  return true;
}

function $hashCode_2(this$static){
  var iter, k, obj;
  k = 1;
  iter = this$static.iterator_0();
  while (iter.hasNext()) {
    obj = iter.next_0();
    k = 31 * k + (obj == null?0:hashCode__devirtual$(obj));
    k = ~~k;
  }
  return k;
}

function $indexOf_3(this$static, toFind){
  var i, n;
  for (i = 0 , n = this$static.array.length; i < n; ++i) {
    if (toFind == null?(checkIndex(i, this$static.array.length) , this$static.array[i]) == null:equals__devirtual$(toFind, (checkIndex(i, this$static.array.length) , this$static.array[i]))) {
      return i;
    }
  }
  return -1;
}

function checkIndex(index, size){
  (index < 0 || index >= size) && indexOutOfBounds(index, size);
}

function indexOutOfBounds(index, size){
  throw new IndexOutOfBoundsException_1('Index: ' + index + ', Size: ' + size);
}

function AbstractList(){
}

_ = AbstractList.prototype = new AbstractCollection;
_.add_0 = function add_3(obj){
  this.add_2(this.size_0(), obj);
  return true;
}
;
_.add_2 = function add_4(index, element){
  throw new UnsupportedOperationException_1('Add not supported on this list');
}
;
_.clear = function clear_4(){
  this.removeRange(0, this.size_0());
}
;
_.equals$ = function equals_11(o){
  return $equals_5(this, o);
}
;
_.getClass$ = function getClass_238(){
  return Ljava_util_AbstractList_2_classLit;
}
;
_.hashCode$ = function hashCode_13(){
  return $hashCode_2(this);
}
;
_.iterator_0 = function iterator_6(){
  return new AbstractList$IteratorImpl_0(this);
}
;
_.listIterator = function listIterator(){
  return this.listIterator_0(0);
}
;
_.listIterator_0 = function listIterator_0(from){
  return new AbstractList$ListIteratorImpl_0(this, from);
}
;
_.remove_3 = function remove_15(index){
  throw new UnsupportedOperationException_1('Remove not supported on this list');
}
;
_.removeRange = function removeRange(fromIndex, endIndex){
  var i, iter;
  iter = this.listIterator_0(fromIndex);
  for (i = fromIndex; i < endIndex; ++i) {
    iter.next_0();
    iter.remove();
  }
}
;
_.set_0 = function set_1(index, o){
  throw new UnsupportedOperationException_1('Set not supported on this list');
}
;
_.castableTypeMap$ = {27:1, 130:1};
function $hasNext_3(this$static){
  return this$static.i < this$static.this$0_0.size_0();
}

function $next_6(this$static){
  if (this$static.i >= this$static.this$0_0.size_0()) {
    throw new NoSuchElementException_0;
  }
  return this$static.this$0_0.get_0(this$static.last = this$static.i++);
}

function $remove_7(this$static){
  if (this$static.last < 0) {
    throw new IllegalStateException_0;
  }
  this$static.this$0_0.remove_3(this$static.last);
  this$static.i = this$static.last;
  this$static.last = -1;
}

function AbstractList$IteratorImpl_0(this$0){
  this.this$0_0 = this$0;
}

function AbstractList$IteratorImpl(){
}

_ = AbstractList$IteratorImpl_0.prototype = AbstractList$IteratorImpl.prototype = new Object_0;
_.getClass$ = function getClass_239(){
  return Ljava_util_AbstractList$IteratorImpl_2_classLit;
}
;
_.hasNext = function hasNext_4(){
  return this.i < this.this$0_0.size_0();
}
;
_.next_0 = function next_8(){
  return $next_6(this);
}
;
_.remove = function remove_16(){
  $remove_7(this);
}
;
_.castableTypeMap$ = {};
_.i = 0;
_.last = -1;
_.this$0_0 = null;
function $previous(this$static){
  if (this$static.i <= 0) {
    throw new NoSuchElementException_0;
  }
  return this$static.this$0.get_0(this$static.last = --this$static.i);
}

function $set_0(this$static, o){
  if (this$static.last == -1) {
    throw new IllegalStateException_0;
  }
  this$static.this$0.set_0(this$static.last, o);
}

function AbstractList$ListIteratorImpl_0(this$0, start){
  var size;
  this.this$0 = this$0;
  this.this$0_0 = this$0;
  size = this$0.size_0();
  (start < 0 || start > size) && indexOutOfBounds(start, size);
  this.i = start;
}

function AbstractList$ListIteratorImpl(){
}

_ = AbstractList$ListIteratorImpl_0.prototype = AbstractList$ListIteratorImpl.prototype = new AbstractList$IteratorImpl;
_.getClass$ = function getClass_240(){
  return Ljava_util_AbstractList$ListIteratorImpl_2_classLit;
}
;
_.hasPrevious = function hasPrevious(){
  return this.i > 0;
}
;
_.previous_0 = function previous_3(){
  return $previous(this);
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function AbstractMap$1_0(this$0, val$entrySet){
  this.this$0 = this$0;
  this.val$entrySet = val$entrySet;
}

function AbstractMap$1(){
}

_ = AbstractMap$1_0.prototype = AbstractMap$1.prototype = new AbstractSet;
_.contains = function contains_2(key){
  return this.this$0.containsKey(key);
}
;
_.getClass$ = function getClass_241(){
  return Ljava_util_AbstractMap$1_2_classLit;
}
;
_.iterator_0 = function iterator_7(){
  var outerIter;
  return outerIter = this.val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter);
}
;
_.size_0 = function size_8(){
  return this.val$entrySet.size_0();
}
;
_.castableTypeMap$ = {40:1, 130:1};
_.this$0 = null;
_.val$entrySet = null;
function AbstractMap$1$1_0(val$outerIter){
  this.val$outerIter = val$outerIter;
}

function AbstractMap$1$1(){
}

_ = AbstractMap$1$1_0.prototype = AbstractMap$1$1.prototype = new Object_0;
_.getClass$ = function getClass_242(){
  return Ljava_util_AbstractMap$1$1_2_classLit;
}
;
_.hasNext = function hasNext_5(){
  return this.val$outerIter.hasNext();
}
;
_.next_0 = function next_9(){
  var entry;
  return entry = dynamicCast(this.val$outerIter.next_0(), 66) , entry.getKey();
}
;
_.remove = function remove_17(){
  this.val$outerIter.remove();
}
;
_.castableTypeMap$ = {};
_.val$outerIter = null;
function $add_8(this$static, o){
  if ($offer(this$static, o)) {
    return true;
  }
  throw new IllegalStateException_1('Unable to add element to queue');
}

function $remove_9(this$static){
  var e;
  e = $poll(this$static);
  if (e == null) {
    throw new NoSuchElementException_1('Queue is empty');
  }
  return e;
}

function AbstractQueue(){
}

_ = AbstractQueue.prototype = new AbstractCollection;
_.add_0 = function add_5(o){
  return $add_8(this, o);
}
;
_.addAll = function addAll_0(c){
  var modified, val, val$iterator;
  if (c == this) {
    throw new IllegalArgumentException_1("Can't add a queue to itself");
  }
  modified = false;
  for (val$iterator = c.iterator_0(); val$iterator.hasNext();) {
    val = val$iterator.next_0();
    modified |= $add_8(this, val);
  }
  return modified;
}
;
_.clear = function clear_5(){
  while ($poll(this) != null) {
  }
}
;
_.getClass$ = function getClass_243(){
  return Ljava_util_AbstractQueue_2_classLit;
}
;
_.castableTypeMap$ = {130:1, 211:1};
function AbstractSequentialList(){
}

_ = AbstractSequentialList.prototype = new AbstractList;
_.add_2 = function add_6(index, element){
  var iter;
  iter = $listIterator_2(this, index);
  $addBefore(iter.this$0, element, iter.currentNode);
  ++iter.currentIndex;
  iter.lastNode = null;
}
;
_.get_0 = function get_3(index){
  var $e0, iter;
  iter = $listIterator_2(this, index);
  try {
    return $next_9(iter);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 139)) {
      throw new IndexOutOfBoundsException_1("Can't get element " + index);
    }
     else 
      throw $e0;
  }
}
;
_.getClass$ = function getClass_244(){
  return Ljava_util_AbstractSequentialList_2_classLit;
}
;
_.iterator_0 = function iterator_8(){
  return $listIterator_2(this, 0);
}
;
_.remove_3 = function remove_18(index){
  var $e0, iter, old;
  iter = $listIterator_2(this, index);
  try {
    old = $next_9(iter);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 139)) {
      throw new IndexOutOfBoundsException_1("Can't remove element " + index);
    }
     else 
      throw $e0;
  }
  $remove_14(iter);
  return old;
}
;
_.set_0 = function set_2(index, element){
  var $e0, iter, old;
  iter = $listIterator_2(this, index);
  try {
    old = $next_9(iter);
    $verifyCurrentElement(iter);
    iter.lastNode.value_0 = element;
    return old;
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 139)) {
      throw new IndexOutOfBoundsException_1("Can't set element " + index);
    }
     else 
      throw $e0;
  }
}
;
_.castableTypeMap$ = {27:1, 130:1};
function $$init_28(this$static){
  this$static.array = initDim(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, 0, 0);
}

function $add_9(this$static, o){
  setCheck(this$static.array, this$static.size++, o);
  return true;
}

function $add_10(this$static, index, o){
  (index < 0 || index > this$static.size) && indexOutOfBounds(index, this$static.size);
  this$static.array.splice(index, 0, o);
  ++this$static.size;
}

function $addAll_0(this$static, c){
  var cArray, len;
  cArray = c.toArray();
  len = cArray.length;
  if (len == 0) {
    return false;
  }
  Array.prototype.splice.apply(this$static.array, [this$static.size, 0].concat(cArray));
  this$static.size += len;
  return true;
}

function $clear_2(this$static){
  this$static.array = initDim(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, 0, 0);
  this$static.size = 0;
}

function $get_3(this$static, index){
  checkIndex(index, this$static.size);
  return this$static.array[index];
}

function $indexOf_4(this$static, o, index){
  for (; index < this$static.size; ++index) {
    if (equalsWithNullCheck(o, this$static.array[index])) {
      return index;
    }
  }
  return -1;
}

function $remove_10(this$static, index){
  var previous;
  previous = (checkIndex(index, this$static.size) , this$static.array[index]);
  this$static.array.splice(index, 1);
  --this$static.size;
  return previous;
}

function $remove_11(this$static, o){
  var i;
  i = $indexOf_4(this$static, o, 0);
  if (i == -1) {
    return false;
  }
  $remove_10(this$static, i);
  return true;
}

function $removeRange(this$static, fromIndex, endIndex){
  var count;
  checkIndex(fromIndex, this$static.size);
  (endIndex < fromIndex || endIndex > this$static.size) && indexOutOfBounds(endIndex, this$static.size);
  count = endIndex - fromIndex;
  this$static.array.splice(fromIndex, count);
  this$static.size -= count;
}

function $set_1(this$static, index, o){
  var previous;
  previous = (checkIndex(index, this$static.size) , this$static.array[index]);
  setCheck(this$static.array, index, o);
  return previous;
}

function $toArray_0(this$static){
  var a_0, result;
  return a_0 = this$static.array , result = a_0.slice(0, this$static.size) , initValues(a_0.arrayClass$, a_0.castableTypeMap$, a_0.queryId$, result) , result;
}

function $toArray_1(this$static, out){
  var i, a_0, result;
  out.length < this$static.size && (out = (a_0 = out , result = createFromSeed(0, this$static.size) , initValues(a_0.arrayClass$, a_0.castableTypeMap$, a_0.queryId$, result) , result));
  for (i = 0; i < this$static.size; ++i) {
    setCheck(out, i, this$static.array[i]);
  }
  out.length > this$static.size && setCheck(out, this$static.size, null);
  return out;
}

function ArrayList_0(){
  $$init_28(this);
}

function ArrayList_1(c){
  var a_0, result;
  $$init_28(this);
  Array.prototype.splice.apply(this.array, [0, 0].concat((a_0 = c.array , result = a_0.slice(0, c.size) , initValues(a_0.arrayClass$, a_0.castableTypeMap$, a_0.queryId$, result) , result)));
  this.size = this.array.length;
}

function ArrayList_2(initialCapacity){
  $$init_28(this);
  this.array.length = initialCapacity;
}

function ArrayList(){
}

_ = ArrayList_2.prototype = ArrayList_1.prototype = ArrayList_0.prototype = ArrayList.prototype = new AbstractList;
_.add_0 = function add_7(o){
  return setCheck(this.array, this.size++, o) , true;
}
;
_.add_2 = function add_8(index, o){
  $add_10(this, index, o);
}
;
_.addAll = function addAll_1(c){
  return $addAll_0(this, c);
}
;
_.clear = function clear_6(){
  this.array = initDim(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, 0, 0);
  this.size = 0;
}
;
_.contains = function contains_3(o){
  return $indexOf_4(this, o, 0) != -1;
}
;
_.get_0 = function get_4(index){
  return checkIndex(index, this.size) , this.array[index];
}
;
_.getClass$ = function getClass_245(){
  return Ljava_util_ArrayList_2_classLit;
}
;
_.isEmpty = function isEmpty_1(){
  return this.size == 0;
}
;
_.remove_3 = function remove_19(index){
  return $remove_10(this, index);
}
;
_.remove_1 = function remove_20(o){
  return $remove_11(this, o);
}
;
_.removeRange = function removeRange_0(fromIndex, endIndex){
  $removeRange(this, fromIndex, endIndex);
}
;
_.set_0 = function set_3(index, o){
  var previous;
  return previous = (checkIndex(index, this.size) , this.array[index]) , setCheck(this.array, index, o) , previous;
}
;
_.size_0 = function size_9(){
  return this.size;
}
;
_.toArray = function toArray_1(){
  var a_0, result;
  return a_0 = this.array , result = a_0.slice(0, this.size) , initValues(a_0.arrayClass$, a_0.castableTypeMap$, a_0.queryId$, result) , result;
}
;
_.toArray_0 = function toArray_2(out){
  return $toArray_1(this, out);
}
;
_.castableTypeMap$ = {27:1, 58:1, 130:1};
_.size = 0;
function insertionSort(array, low, high, comp){
  var i, j, t;
  for (i = low + 1; i < high; ++i) {
    for (j = i; j > low && comp.compare(array[j - 1], array[j]) > 0; --j) {
      t = array[j];
      setCheck(array, j, array[j - 1]);
      setCheck(array, j - 1, t);
    }
  }
}

function merge(src, srcLow, srcMid, srcHigh, dest, destLow, destHigh, comp){
  var topIdx;
  topIdx = srcMid;
  while (destLow < destHigh) {
    topIdx >= srcHigh || srcLow < srcMid && comp.compare(src[srcLow], src[topIdx]) <= 0?setCheck(dest, destLow++, src[srcLow++]):setCheck(dest, destLow++, src[topIdx++]);
  }
}

function mergeSort(x, fromIndex, toIndex, comp){
  var temp, a_0, result;
  temp = (a_0 = x , result = a_0.slice(fromIndex, toIndex) , initValues(a_0.arrayClass$, a_0.castableTypeMap$, a_0.queryId$, result) , result);
  mergeSort_0(temp, x, fromIndex, toIndex, -fromIndex, comp);
}

function mergeSort_0(temp, array, low, high, ofs, comp){
  var length_0, tempHigh, tempLow, tempMid;
  length_0 = high - low;
  if (length_0 < 7) {
    insertionSort(array, low, high, comp);
    return;
  }
  tempLow = low + ofs;
  tempHigh = high + ofs;
  tempMid = tempLow + (~~(tempHigh - tempLow) >> 1);
  mergeSort_0(array, temp, tempLow, tempMid, -ofs, comp);
  mergeSort_0(array, temp, tempMid, tempHigh, -ofs, comp);
  if (comp.compare(temp[tempMid - 1], temp[tempMid]) <= 0) {
    while (low < high) {
      setCheck(array, low++, temp[tempLow++]);
    }
    return;
  }
  merge(temp, tempLow, tempMid, tempHigh, array, low, high, comp);
}

function sort(array){
  mergeSort(array, 0, array.length, ($clinit_447() , $clinit_447() , NATURAL));
}

function sort_0(x, c){
  mergeSort(x, 0, x.length, c?c:($clinit_447() , $clinit_447() , NATURAL));
}

function Arrays$ArrayList_0(array){
  this.array = array;
}

function Arrays$ArrayList(){
}

_ = Arrays$ArrayList_0.prototype = Arrays$ArrayList.prototype = new AbstractList;
_.contains = function contains_4(o){
  return $indexOf_3(this, o) != -1;
}
;
_.get_0 = function get_5(index){
  return checkIndex(index, this.array.length) , this.array[index];
}
;
_.getClass$ = function getClass_246(){
  return Ljava_util_Arrays$ArrayList_2_classLit;
}
;
_.set_0 = function set_4(index, value){
  var was;
  checkIndex(index, this.array.length);
  was = this.array[index];
  setCheck(this.array, index, value);
  return was;
}
;
_.size_0 = function size_10(){
  return this.array.length;
}
;
_.toArray = function toArray_3(){
  return clone_0(this.array);
}
;
_.toArray_0 = function toArray_4(out){
  var i, size;
  size = this.array.length;
  out.length < size && (out = createFrom(out, size));
  for (i = 0; i < size; ++i) {
    setCheck(out, i, this.array[i]);
  }
  out.length > size && setCheck(out, size, null);
  return out;
}
;
_.castableTypeMap$ = {27:1, 58:1, 130:1};
_.array = null;
function $clinit_430(){
  $clinit_430 = nullMethod;
  EMPTY_LIST = new Collections$EmptyList_0;
  EMPTY_MAP = new Collections$EmptyMap_0;
  EMPTY_SET = new Collections$EmptySet_0;
}

function replaceContents(target, x){
  var i, size, previous;
  size = target.size;
  for (i = 0; i < size; ++i) {
    previous = (checkIndex(i, target.size) , target.array[i]);
    setCheck(target.array, i, x[i]);
  }
}

function sort_1(target){
  var a_0, result;
  $clinit_430();
  var x;
  x = (a_0 = target.array , result = a_0.slice(0, target.size) , initValues(a_0.arrayClass$, a_0.castableTypeMap$, a_0.queryId$, result) , result);
  mergeSort(x, 0, x.length, ($clinit_447() , $clinit_447() , NATURAL));
  replaceContents(target, x);
}

function sort_2(target, c){
  var a_0, result;
  $clinit_430();
  var x;
  x = (a_0 = target.array , result = a_0.slice(0, target.size) , initValues(a_0.arrayClass$, a_0.castableTypeMap$, a_0.queryId$, result) , result);
  mergeSort(x, 0, x.length, c?c:($clinit_447() , $clinit_447() , NATURAL));
  replaceContents(target, x);
}

function unmodifiableList(list){
  $clinit_430();
  return list?new Collections$UnmodifiableRandomAccessList_0(list):new Collections$UnmodifiableList_0(null);
}

var EMPTY_LIST, EMPTY_MAP, EMPTY_SET;
function Collections$EmptyList_0(){
}

function Collections$EmptyList(){
}

_ = Collections$EmptyList_0.prototype = Collections$EmptyList.prototype = new AbstractList;
_.contains = function contains_5(object){
  return false;
}
;
_.get_0 = function get_6(location_0){
  throw new IndexOutOfBoundsException_0;
}
;
_.getClass$ = function getClass_247(){
  return Ljava_util_Collections$EmptyList_2_classLit;
}
;
_.size_0 = function size_11(){
  return 0;
}
;
_.castableTypeMap$ = {27:1, 58:1, 130:1};
function Collections$EmptyMap_0(){
}

function Collections$EmptyMap(){
}

_ = Collections$EmptyMap_0.prototype = Collections$EmptyMap.prototype = new AbstractMap;
_.containsKey = function containsKey_1(key){
  return false;
}
;
_.entrySet_0 = function entrySet_1(){
  return $clinit_430() , EMPTY_SET;
}
;
_.get = function get_7(key){
  return null;
}
;
_.getClass$ = function getClass_248(){
  return Ljava_util_Collections$EmptyMap_2_classLit;
}
;
_.keySet_0 = function keySet_1(){
  return $clinit_430() , EMPTY_SET;
}
;
_.size_0 = function size_12(){
  return 0;
}
;
_.castableTypeMap$ = {26:1, 58:1};
function Collections$EmptySet_0(){
}

function Collections$EmptySet(){
}

_ = Collections$EmptySet_0.prototype = Collections$EmptySet.prototype = new AbstractSet;
_.contains = function contains_6(object){
  return false;
}
;
_.getClass$ = function getClass_249(){
  return Ljava_util_Collections$EmptySet_2_classLit;
}
;
_.iterator_0 = function iterator_9(){
  return new Collections$EmptySet$1_0;
}
;
_.size_0 = function size_13(){
  return 0;
}
;
_.castableTypeMap$ = {40:1, 58:1, 130:1};
function Collections$EmptySet$1_0(){
}

function Collections$EmptySet$1(){
}

_ = Collections$EmptySet$1_0.prototype = Collections$EmptySet$1.prototype = new Object_0;
_.getClass$ = function getClass_250(){
  return Ljava_util_Collections$EmptySet$1_2_classLit;
}
;
_.hasNext = function hasNext_6(){
  return false;
}
;
_.next_0 = function next_10(){
  throw new NoSuchElementException_0;
}
;
_.remove = function remove_21(){
  throw new UnsupportedOperationException_0;
}
;
_.castableTypeMap$ = {};
function Collections$SingletonList_0(){
  this.element = 'line';
}

function Collections$SingletonList(){
}

_ = Collections$SingletonList_0.prototype = Collections$SingletonList.prototype = new AbstractList;
_.contains = function contains_7(item){
  return equalsWithNullCheck(this.element, item);
}
;
_.get_0 = function get_8(index){
  if (index == 0) {
    return this.element;
  }
   else {
    throw new IndexOutOfBoundsException_0;
  }
}
;
_.getClass$ = function getClass_251(){
  return Ljava_util_Collections$SingletonList_2_classLit;
}
;
_.size_0 = function size_14(){
  return 1;
}
;
_.castableTypeMap$ = {27:1, 58:1, 130:1};
_.element = null;
function Collections$UnmodifiableCollection(){
}

_ = Collections$UnmodifiableCollection.prototype = new Object_0;
_.add_0 = function add_9(o){
  throw new UnsupportedOperationException_0;
}
;
_.addAll = function addAll_2(c){
  throw new UnsupportedOperationException_0;
}
;
_.clear = function clear_7(){
  throw new UnsupportedOperationException_0;
}
;
_.contains = function contains_8(o){
  return this.coll.contains(o);
}
;
_.getClass$ = function getClass_252(){
  return Ljava_util_Collections$UnmodifiableCollection_2_classLit;
}
;
_.isEmpty = function isEmpty_2(){
  return this.coll.isEmpty();
}
;
_.iterator_0 = function iterator_10(){
  return new Collections$UnmodifiableCollectionIterator_0(this.coll.iterator_0());
}
;
_.remove_1 = function remove_22(o){
  throw new UnsupportedOperationException_0;
}
;
_.size_0 = function size_15(){
  return this.coll.size_0();
}
;
_.toArray = function toArray_5(){
  return this.coll.toArray();
}
;
_.toString$ = function toString_19(){
  return this.coll.toString$();
}
;
_.castableTypeMap$ = {130:1};
_.coll = null;
function Collections$UnmodifiableCollectionIterator_0(it){
  this.it = it;
}

function Collections$UnmodifiableCollectionIterator(){
}

_ = Collections$UnmodifiableCollectionIterator_0.prototype = Collections$UnmodifiableCollectionIterator.prototype = new Object_0;
_.getClass$ = function getClass_253(){
  return Ljava_util_Collections$UnmodifiableCollectionIterator_2_classLit;
}
;
_.hasNext = function hasNext_7(){
  return this.it.hasNext();
}
;
_.next_0 = function next_11(){
  return this.it.next_0();
}
;
_.remove = function remove_23(){
  throw new UnsupportedOperationException_0;
}
;
_.castableTypeMap$ = {};
_.it = null;
function Collections$UnmodifiableList_0(list){
  this.coll = list;
  this.list = list;
}

function Collections$UnmodifiableList(){
}

_ = Collections$UnmodifiableList_0.prototype = Collections$UnmodifiableList.prototype = new Collections$UnmodifiableCollection;
_.equals$ = function equals_12(o){
  return $equals_5(this.list, o);
}
;
_.get_0 = function get_9(index){
  return $get_3(this.list, index);
}
;
_.getClass$ = function getClass_254(){
  return Ljava_util_Collections$UnmodifiableList_2_classLit;
}
;
_.hashCode$ = function hashCode_14(){
  return $hashCode_2(this.list);
}
;
_.isEmpty = function isEmpty_3(){
  return this.list.size == 0;
}
;
_.listIterator = function listIterator_1(){
  return new Collections$UnmodifiableListIterator_0(new AbstractList$ListIteratorImpl_0(this.list, 0));
}
;
_.listIterator_0 = function listIterator_2(from){
  return new Collections$UnmodifiableListIterator_0(new AbstractList$ListIteratorImpl_0(this.list, from));
}
;
_.castableTypeMap$ = {27:1, 130:1};
_.list = null;
function Collections$UnmodifiableListIterator_0(lit){
  this.it = lit;
  this.lit = lit;
}

function Collections$UnmodifiableListIterator(){
}

_ = Collections$UnmodifiableListIterator_0.prototype = Collections$UnmodifiableListIterator.prototype = new Collections$UnmodifiableCollectionIterator;
_.getClass$ = function getClass_255(){
  return Ljava_util_Collections$UnmodifiableListIterator_2_classLit;
}
;
_.hasPrevious = function hasPrevious_0(){
  return this.lit.i > 0;
}
;
_.previous_0 = function previous_4(){
  return $previous(this.lit);
}
;
_.castableTypeMap$ = {};
_.lit = null;
function Collections$UnmodifiableMap_0(map){
  this.map = map;
}

function Collections$UnmodifiableMap(){
}

_ = Collections$UnmodifiableMap_0.prototype = Collections$UnmodifiableMap.prototype = new Object_0;
_.clear = function clear_8(){
  throw new UnsupportedOperationException_0;
}
;
_.containsKey = function containsKey_2(key){
  return this.map.containsKey(key);
}
;
_.entrySet_0 = function entrySet_2(){
  !this.entrySet && (this.entrySet = new Collections$UnmodifiableMap$UnmodifiableEntrySet_0(this.map.entrySet_0()));
  return this.entrySet;
}
;
_.equals$ = function equals_13(o){
  return this.map.equals$(o);
}
;
_.get = function get_10(key){
  return this.map.get(key);
}
;
_.getClass$ = function getClass_256(){
  return Ljava_util_Collections$UnmodifiableMap_2_classLit;
}
;
_.hashCode$ = function hashCode_15(){
  return this.map.hashCode$();
}
;
_.isEmpty = function isEmpty_4(){
  return this.map.size_0() == 0;
}
;
_.keySet_0 = function keySet_2(){
  !this.keySet && (this.keySet = new Collections$UnmodifiableSet_0(this.map.keySet_0()));
  return this.keySet;
}
;
_.put = function put_1(key, value){
  throw new UnsupportedOperationException_0;
}
;
_.putAll = function putAll_0(t){
  throw new UnsupportedOperationException_0;
}
;
_.remove_2 = function remove_24(key){
  throw new UnsupportedOperationException_0;
}
;
_.size_0 = function size_16(){
  return this.map.size_0();
}
;
_.toString$ = function toString_20(){
  return $toString_6(this.map);
}
;
_.castableTypeMap$ = {26:1};
_.entrySet = null;
_.keySet = null;
_.map = null;
function Collections$UnmodifiableSet_0(set){
  this.coll = set;
}

function Collections$UnmodifiableSet(){
}

_ = Collections$UnmodifiableSet_0.prototype = Collections$UnmodifiableSet.prototype = new Collections$UnmodifiableCollection;
_.equals$ = function equals_14(o){
  return this.coll.equals$(o);
}
;
_.getClass$ = function getClass_257(){
  return Ljava_util_Collections$UnmodifiableSet_2_classLit;
}
;
_.hashCode$ = function hashCode_16(){
  return this.coll.hashCode$();
}
;
_.castableTypeMap$ = {40:1, 130:1};
function $wrap(array, size){
  var i;
  for (i = 0; i < size; ++i) {
    setCheck(array, i, new Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry_0(dynamicCast(array[i], 66)));
  }
}

function Collections$UnmodifiableMap$UnmodifiableEntrySet_0(s){
  this.coll = s;
}

function Collections$UnmodifiableMap$UnmodifiableEntrySet(){
}

_ = Collections$UnmodifiableMap$UnmodifiableEntrySet_0.prototype = Collections$UnmodifiableMap$UnmodifiableEntrySet.prototype = new Collections$UnmodifiableSet;
_.contains = function contains_9(o){
  return this.coll.contains(o);
}
;
_.getClass$ = function getClass_258(){
  return Ljava_util_Collections$UnmodifiableMap$UnmodifiableEntrySet_2_classLit;
}
;
_.iterator_0 = function iterator_11(){
  var it;
  it = this.coll.iterator_0();
  return new Collections$UnmodifiableMap$UnmodifiableEntrySet$1_0(it);
}
;
_.toArray = function toArray_6(){
  var array;
  array = this.coll.toArray();
  $wrap(array, array.length);
  return array;
}
;
_.castableTypeMap$ = {40:1, 130:1};
function Collections$UnmodifiableMap$UnmodifiableEntrySet$1_0(val$it){
  this.val$it = val$it;
}

function Collections$UnmodifiableMap$UnmodifiableEntrySet$1(){
}

_ = Collections$UnmodifiableMap$UnmodifiableEntrySet$1_0.prototype = Collections$UnmodifiableMap$UnmodifiableEntrySet$1.prototype = new Object_0;
_.getClass$ = function getClass_259(){
  return Ljava_util_Collections$UnmodifiableMap$UnmodifiableEntrySet$1_2_classLit;
}
;
_.hasNext = function hasNext_8(){
  return this.val$it.hasNext();
}
;
_.next_0 = function next_12(){
  return new Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry_0(dynamicCast(this.val$it.next_0(), 66));
}
;
_.remove = function remove_25(){
  throw new UnsupportedOperationException_0;
}
;
_.castableTypeMap$ = {};
_.val$it = null;
function Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry_0(entry){
  this.entry = entry;
}

function Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry(){
}

--></script>
<script><!--
_ = Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry_0.prototype = Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry.prototype = new Object_0;
_.equals$ = function equals_15(o){
  return this.entry.equals$(o);
}
;
_.getClass$ = function getClass_260(){
  return Ljava_util_Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry_2_classLit;
}
;
_.getKey = function getKey_1(){
  return this.entry.getKey();
}
;
_.getValue = function getValue_3(){
  return this.entry.getValue();
}
;
_.hashCode$ = function hashCode_17(){
  return this.entry.hashCode$();
}
;
_.setValue = function setValue_1(value){
  throw new UnsupportedOperationException_0;
}
;
_.toString$ = function toString_21(){
  return toString__devirtual$(this.entry);
}
;
_.castableTypeMap$ = {66:1};
_.entry = null;
function Collections$UnmodifiableRandomAccessList_0(list){
  this.coll = list;
  this.list = list;
}

function Collections$UnmodifiableRandomAccessList(){
}

_ = Collections$UnmodifiableRandomAccessList_0.prototype = Collections$UnmodifiableRandomAccessList.prototype = new Collections$UnmodifiableList;
_.getClass$ = function getClass_261(){
  return Ljava_util_Collections$UnmodifiableRandomAccessList_2_classLit;
}
;
_.castableTypeMap$ = {27:1, 130:1};
function $clinit_447(){
  $clinit_447 = nullMethod;
  NATURAL = new Comparators$1_0;
}

var NATURAL;
function $compare(o1, o2){
  return dynamicCast(o1, 61).compareTo$(o2);
}

function Comparators$1_0(){
}

function Comparators$1(){
}

_ = Comparators$1_0.prototype = Comparators$1.prototype = new Object_0;
_.compare = function compare_1(o1, o2){
  return dynamicCast(o1, 61).compareTo$(o2);
}
;
_.getClass$ = function getClass_262(){
  return Ljava_util_Comparators$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function $compareTo_5(this$static, other){
  var otherTime, thisTime, signa_0, signb_0;
  thisTime = fromDouble(this$static.jsdate.getTime());
  otherTime = fromDouble(other.jsdate.getTime());
  return !gte(thisTime, otherTime)?-1:(signa_0 = ~~thisTime.h >> 19 , signb_0 = ~~otherTime.h >> 19 , signa_0 == 0?signb_0 != 0 || thisTime.h > otherTime.h || thisTime.h == otherTime.h && thisTime.m > otherTime.m || thisTime.h == otherTime.h && thisTime.m == otherTime.m && thisTime.l > otherTime.l:!(signb_0 == 0 || thisTime.h < otherTime.h || thisTime.h == otherTime.h && thisTime.m < otherTime.m || thisTime.h == otherTime.h && thisTime.m == otherTime.m && thisTime.l <= otherTime.l))?1:0;
}

function $fixDaylightSavings(this$static, hours){
  var badHours, copy, day, newTime, timeDiff, timeDiffHours, timeDiffMinutes;
  if (this$static.jsdate.getHours() % 24 != hours % 24) {
    copy = new Date(this$static.jsdate.getTime());
    copy.setDate(copy.getDate() + 1);
    timeDiff = this$static.jsdate.getTimezoneOffset() - copy.getTimezoneOffset();
    if (timeDiff > 0) {
      timeDiffHours = ~~(timeDiff / 60);
      timeDiffMinutes = timeDiff % 60;
      day = this$static.jsdate.getDate();
      badHours = this$static.jsdate.getHours();
      badHours + timeDiffHours >= 24 && ++day;
      newTime = new Date(this$static.jsdate.getFullYear(), this$static.jsdate.getMonth(), day, hours + timeDiffHours, this$static.jsdate.getMinutes() + timeDiffMinutes, this$static.jsdate.getSeconds(), this$static.jsdate.getMilliseconds());
      this$static.jsdate.setTime(newTime.getTime());
    }
  }
}

function $setYear(this$static, year){
  var hours;
  hours = this$static.jsdate.getHours();
  this$static.jsdate.setFullYear(year + 1900);
  $fixDaylightSavings(this$static, hours);
}

function Date_1(){
  this.jsdate = new Date;
}

function padTwo(number){
  return number < 10?'0' + number:'' + number;
}

function Date_0(){
}

_ = Date_1.prototype = Date_0.prototype = new Object_0;
_.compareTo$ = function compareTo_7(other){
  return $compareTo_5(this, dynamicCast(other, 140));
}
;
_.equals$ = function equals_16(obj){
  return obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[140] && eq(fromDouble(this.jsdate.getTime()), fromDouble(dynamicCast(obj, 140).jsdate.getTime()));
}
;
_.getClass$ = function getClass_263(){
  return Ljava_util_Date_2_classLit;
}
;
_.hashCode$ = function hashCode_18(){
  var time;
  time = fromDouble(this.jsdate.getTime());
  return toInt(xor(time, shru(time, 32)));
}
;
_.toString$ = function toString_22(){
  var hourOffset, minuteOffset, offset;
  offset = -this.jsdate.getTimezoneOffset();
  hourOffset = (offset >= 0?'+':'') + ~~(offset / 60);
  minuteOffset = (offset < 0?-offset:offset) % 60 < 10?'0' + (offset < 0?-offset:offset) % 60:'' + (offset < 0?-offset:offset) % 60;
  return ($clinit_450() , DAYS)[this.jsdate.getDay()] + ' ' + MONTHS[this.jsdate.getMonth()] + ' ' + padTwo(this.jsdate.getDate()) + ' ' + padTwo(this.jsdate.getHours()) + ':' + padTwo(this.jsdate.getMinutes()) + ':' + padTwo(this.jsdate.getSeconds()) + ' GMT' + hourOffset + minuteOffset + ' ' + this.jsdate.getFullYear();
}
;
_.castableTypeMap$ = {58:1, 61:1, 140:1};
_.jsdate = null;
function $clinit_450(){
  $clinit_450 = nullMethod;
  DAYS = initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']);
  MONTHS = initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']);
}

var DAYS, MONTHS;
function EmptyStackException_0(){
  this.fillInStackTrace();
}

function EmptyStackException(){
}

_ = EmptyStackException_0.prototype = EmptyStackException.prototype = new RuntimeException;
_.getClass$ = function getClass_264(){
  return Ljava_util_EmptyStackException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1};
function HashMap_0(){
  $clearImpl(this);
}

function HashMap_1(ignored){
  AbstractHashMap_2.call(this, ignored, 0);
}

function HashMap(){
}

_ = HashMap_1.prototype = HashMap_0.prototype = HashMap.prototype = new AbstractHashMap;
_.equals = function equals_17(value1, value2){
  return (value1 == null?null:value1) === (value2 == null?null:value2) || value1 != null && equals__devirtual$(value1, value2);
}
;
_.getClass$ = function getClass_265(){
  return Ljava_util_HashMap_2_classLit;
}
;
_.getHashCode = function getHashCode_1(key){
  return ~~hashCode__devirtual$(key);
}
;
_.castableTypeMap$ = {26:1, 58:1};
function $add_11(this$static, o){
  var old;
  old = this$static.map.put(o, this$static);
  return old == null;
}

function HashSet_0(){
  this.map = new HashMap_0;
}

function HashSet_1(c){
  this.map = new HashMap_1(c.array.length);
  $addAll(this, c);
}

function HashSet(){
}

_ = HashSet_1.prototype = HashSet_0.prototype = HashSet.prototype = new AbstractSet;
_.add_0 = function add_10(o){
  var old;
  return old = this.map.put(o, this) , old == null;
}
;
_.clear = function clear_9(){
  this.map.clear();
}
;
_.contains = function contains_10(o){
  return this.map.containsKey(o);
}
;
_.getClass$ = function getClass_266(){
  return Ljava_util_HashSet_2_classLit;
}
;
_.isEmpty = function isEmpty_5(){
  return this.map.size_0() == 0;
}
;
_.iterator_0 = function iterator_12(){
  var outerIter;
  return outerIter = $keySet(this.map).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter);
}
;
_.remove_1 = function remove_26(o){
  return this.map.remove_2(o) != null;
}
;
_.size_0 = function size_17(){
  return this.map.size_0();
}
;
_.toString$ = function toString_23(){
  return $toString_2($keySet(this.map));
}
;
_.castableTypeMap$ = {40:1, 58:1, 130:1};
_.map = null;
function IdentityHashMap_0(){
  $clearImpl(this);
}

function IdentityHashMap(){
}

_ = IdentityHashMap_0.prototype = IdentityHashMap.prototype = new AbstractHashMap;
_.equals$ = function equals_18(obj){
  var entry, entry$iterator, otherKey, otherMap, otherValue;
  if (obj === this) {
    return true;
  }
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[26])) {
    return false;
  }
  otherMap = dynamicCast(obj, 26);
  if (this.size != otherMap.size_0()) {
    return false;
  }
  for (entry$iterator = otherMap.entrySet_0().iterator_0(); entry$iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.next_0(), 66);
    otherKey = entry.getKey();
    otherValue = entry.getValue();
    if (!(otherKey == null?this.nullSlotLive:otherKey != null && otherKey.castableTypeMap$ && !!otherKey.castableTypeMap$[1]?':' + dynamicCast(otherKey, 1) in this.stringMap:$hasHashValue(this, otherKey, otherKey.$H || (otherKey.$H = ++sNextHashId)))) {
      return false;
    }
    if ((otherValue == null?null:otherValue) !== maskUndefined(otherKey == null?this.nullSlot:otherKey != null && otherKey.castableTypeMap$ && !!otherKey.castableTypeMap$[1]?this.stringMap[':' + dynamicCast(otherKey, 1)]:$getHashValue(this, otherKey, otherKey.$H || (otherKey.$H = ++sNextHashId)))) {
      return false;
    }
  }
  return true;
}
;
_.equals = function equals_19(value1, value2){
  return (value1 == null?null:value1) === (value2 == null?null:value2);
}
;
_.getClass$ = function getClass_267(){
  return Ljava_util_IdentityHashMap_2_classLit;
}
;
_.getHashCode = function getHashCode_2(key){
  return key.$H || (key.$H = ++sNextHashId);
}
;
_.hashCode$ = function hashCode_19(){
  var entry, entry$iterator, hashCode;
  hashCode = 0;
  for (entry$iterator = new AbstractHashMap$EntrySetIterator_0((new AbstractHashMap$EntrySet_0(this)).this$0); $hasNext_3(entry$iterator.iter);) {
    entry = entry$iterator.last = dynamicCast($next_6(entry$iterator.iter), 66);
    hashCode += identityHashCode(entry.getKey());
    hashCode += identityHashCode(entry.getValue());
  }
  return hashCode;
}
;
_.castableTypeMap$ = {26:1, 58:1};
function $clear_4(this$static){
  this$static.map.clear();
  this$static.head.prev = this$static.head;
  this$static.head.next = this$static.head;
}

function $get_5(this$static, key){
  var entry;
  entry = dynamicCast(this$static.map.get(key), 141);
  if (entry) {
    $recordAccess(this$static, entry);
    return entry.value_0;
  }
  return null;
}

function $recordAccess(this$static, entry){
  if (this$static.accessOrder) {
    $remove_13(entry);
    $addToEnd(entry);
  }
}

function LinkedHashMap_0(){
  AbstractHashMap_2.call(this, 16, 0.75);
  this.head = new LinkedHashMap$ChainEntry_0(this);
  this.map = new HashMap_0;
  this.head.prev = this.head;
  this.head.next = this.head;
}

function LinkedHashMap(){
}

_ = LinkedHashMap_0.prototype = LinkedHashMap.prototype = new HashMap;
_.clear = function clear_10(){
  $clear_4(this);
}
;
_.containsKey = function containsKey_3(key){
  return this.map.containsKey(key);
}
;
_.entrySet_0 = function entrySet_3(){
  return new LinkedHashMap$EntrySet_0(this);
}
;
_.get = function get_11(key){
  return $get_5(this, key);
}
;
_.getClass$ = function getClass_268(){
  return Ljava_util_LinkedHashMap_2_classLit;
}
;
_.put = function put_2(key, value){
  var newEntry, old, oldValue;
  old = dynamicCast(this.map.get(key), 141);
  if (!old) {
    newEntry = new LinkedHashMap$ChainEntry_1(this, key, value);
    this.map.put(key, newEntry);
    $addToEnd(newEntry);
    return null;
  }
   else {
    oldValue = old.value_0;
    $setValue_3(old, value);
    $recordAccess(this, old);
    return oldValue;
  }
}
;
_.remove_2 = function remove_27(key){
  var entry;
  entry = dynamicCast(this.map.remove_2(key), 141);
  if (entry) {
    $remove_13(entry);
    return entry.value_0;
  }
  return null;
}
;
_.size_0 = function size_18(){
  return this.map.size_0();
}
;
_.castableTypeMap$ = {26:1, 58:1};
_.accessOrder = false;
function $setValue_3(this$static, value){
  var old;
  old = this$static.value_0;
  this$static.value_0 = value;
  return old;
}

function MapEntryImpl_0(key, value){
  this.key = key;
  this.value_0 = value;
}

function MapEntryImpl(){
}

_ = MapEntryImpl_0.prototype = MapEntryImpl.prototype = new AbstractMapEntry;
_.getClass$ = function getClass_269(){
  return Ljava_util_MapEntryImpl_2_classLit;
}
;
_.getKey = function getKey_2(){
  return this.key;
}
;
_.getValue = function getValue_4(){
  return this.value_0;
}
;
_.setValue = function setValue_2(value){
  var old;
  return old = this.value_0 , this.value_0 = value , old;
}
;
_.castableTypeMap$ = {66:1};
_.key = null;
_.value_0 = null;
function $addToEnd(this$static){
  var tail;
  tail = this$static.this$0.head.prev;
  this$static.prev = tail;
  this$static.next = this$static.this$0.head;
  tail.next = this$static.this$0.head.prev = this$static;
}

function $remove_13(this$static){
  this$static.next.prev = this$static.prev;
  this$static.prev.next = this$static.next;
  this$static.next = this$static.prev = null;
}

function LinkedHashMap$ChainEntry_0(this$0){
  this.this$0 = this$0;
  this.key = null;
  this.value_0 = null;
  this.next = this.prev = null;
}

function LinkedHashMap$ChainEntry_1(this$0, key, value){
  this.this$0 = this$0;
  this.key = key;
  this.value_0 = value;
  this.next = this.prev = null;
}

function LinkedHashMap$ChainEntry(){
}

_ = LinkedHashMap$ChainEntry_1.prototype = LinkedHashMap$ChainEntry_0.prototype = LinkedHashMap$ChainEntry.prototype = new MapEntryImpl;
_.getClass$ = function getClass_270(){
  return Ljava_util_LinkedHashMap$ChainEntry_2_classLit;
}
;
_.castableTypeMap$ = {66:1, 141:1};
_.next = null;
_.prev = null;
_.this$0 = null;
function LinkedHashMap$EntrySet_0(this$0){
  this.this$0 = this$0;
}

function LinkedHashMap$EntrySet(){
}

_ = LinkedHashMap$EntrySet_0.prototype = LinkedHashMap$EntrySet.prototype = new AbstractSet;
_.clear = function clear_11(){
  $clear_4(this.this$0);
}
;
_.contains = function contains_11(o){
  var entry, key, value;
  if (!(o != null && o.castableTypeMap$ && !!o.castableTypeMap$[66])) {
    return false;
  }
  entry = dynamicCast(o, 66);
  key = entry.getKey();
  if (this.this$0.map.containsKey(key)) {
    value = $get_5(this.this$0, key);
    return equalsWithNullCheck(entry.getValue(), value);
  }
  return false;
}
;
_.getClass$ = function getClass_271(){
  return Ljava_util_LinkedHashMap$EntrySet_2_classLit;
}
;
_.iterator_0 = function iterator_13(){
  return new LinkedHashMap$EntrySet$EntryIterator_0(this);
}
;
_.size_0 = function size_19(){
  return this.this$0.map.size_0();
}
;
_.castableTypeMap$ = {40:1, 130:1};
_.this$0 = null;
function $next_8(this$static){
  if (this$static.next == this$static.this$1.this$0.head) {
    throw new NoSuchElementException_0;
  }
  this$static.last = this$static.next;
  this$static.next = this$static.next.next;
  return this$static.last;
}

function LinkedHashMap$EntrySet$EntryIterator_0(this$1){
  this.this$1 = this$1;
  this.next = this$1.this$0.head.next;
}

function LinkedHashMap$EntrySet$EntryIterator(){
}

_ = LinkedHashMap$EntrySet$EntryIterator_0.prototype = LinkedHashMap$EntrySet$EntryIterator.prototype = new Object_0;
_.getClass$ = function getClass_272(){
  return Ljava_util_LinkedHashMap$EntrySet$EntryIterator_2_classLit;
}
;
_.hasNext = function hasNext_9(){
  return this.next != this.this$1.this$0.head;
}
;
_.next_0 = function next_13(){
  return $next_8(this);
}
;
_.remove = function remove_28(){
  if (!this.last) {
    throw new IllegalStateException_1('No current entry');
  }
  $remove_13(this.last);
  this.this$1.this$0.map.remove_2(this.last.key);
  this.last = null;
}
;
_.castableTypeMap$ = {};
_.last = null;
_.next = null;
_.this$1 = null;
function LinkedHashSet_0(c){
  this.map = new LinkedHashMap_0;
  $addAll(this, c);
}

function LinkedHashSet(){
}

_ = LinkedHashSet_0.prototype = LinkedHashSet.prototype = new HashSet;
_.getClass$ = function getClass_273(){
  return Ljava_util_LinkedHashSet_2_classLit;
}
;
_.castableTypeMap$ = {40:1, 58:1, 130:1};
function $add_12(this$static, o){
  new LinkedList$Node_2(o, this$static.header);
  ++this$static.size;
  return true;
}

function $addBefore(this$static, o, target){
  new LinkedList$Node_2(o, target);
  ++this$static.size;
}

function $addLast(this$static, o){
  new LinkedList$Node_2(o, this$static.header);
  ++this$static.size;
}

function $clear_5(this$static){
  this$static.header = new LinkedList$Node_0;
  this$static.size = 0;
}

function $getLast_0(this$static){
  $throwEmptyException(this$static);
  return this$static.header.prev.value_0;
}

function $listIterator_2(this$static, index){
  var i, node;
  (index < 0 || index > this$static.size) && indexOutOfBounds(index, this$static.size);
  if (index >= ~~this$static.size >> 1) {
    node = this$static.header;
    for (i = this$static.size; i > index; --i) {
      node = node.prev;
    }
  }
   else {
    node = this$static.header.next;
    for (i = 0; i < index; ++i) {
      node = node.next;
    }
  }
  return new LinkedList$ListIteratorImpl_0(this$static, index, node);
}

function $removeFirst(this$static){
  var node;
  $throwEmptyException(this$static);
  --this$static.size;
  node = this$static.header.next;
  $remove_15(node);
  return node.value_0;
}

function $throwEmptyException(this$static){
  if (this$static.size == 0) {
    throw new NoSuchElementException_0;
  }
}

function LinkedList_0(){
  this.header = new LinkedList$Node_0;
  this.size = 0;
}

function LinkedList(){
}

_ = LinkedList_0.prototype = LinkedList.prototype = new AbstractSequentialList;
_.add_0 = function add_11(o){
  return new LinkedList$Node_2(o, this.header) , ++this.size , true;
}
;
_.clear = function clear_12(){
  this.header = new LinkedList$Node_0;
  this.size = 0;
}
;
_.getClass$ = function getClass_274(){
  return Ljava_util_LinkedList_2_classLit;
}
;
_.listIterator_0 = function listIterator_3(index){
  return $listIterator_2(this, index);
}
;
_.poll = function poll(){
  return this.size == 0?null:$removeFirst(this);
}
;
_.size_0 = function size_20(){
  return this.size;
}
;
_.castableTypeMap$ = {27:1, 58:1, 130:1, 211:1};
_.header = null;
_.size = 0;
function $next_9(this$static){
  if (this$static.currentNode == this$static.this$0.header) {
    throw new NoSuchElementException_0;
  }
  this$static.lastNode = this$static.currentNode;
  this$static.currentNode = this$static.currentNode.next;
  ++this$static.currentIndex;
  return this$static.lastNode.value_0;
}

function $remove_14(this$static){
  $verifyCurrentElement(this$static);
  this$static.currentNode == this$static.lastNode?(this$static.currentNode = this$static.lastNode.next):--this$static.currentIndex;
  $remove_15(this$static.lastNode);
  this$static.lastNode = null;
  --this$static.this$0.size;
}

function $verifyCurrentElement(this$static){
  if (!this$static.lastNode) {
    throw new IllegalStateException_0;
  }
}

function LinkedList$ListIteratorImpl_0(this$0, index, startNode){
  this.this$0 = this$0;
  this.currentNode = startNode;
  this.currentIndex = index;
}

function LinkedList$ListIteratorImpl(){
}

_ = LinkedList$ListIteratorImpl_0.prototype = LinkedList$ListIteratorImpl.prototype = new Object_0;
_.getClass$ = function getClass_275(){
  return Ljava_util_LinkedList$ListIteratorImpl_2_classLit;
}
;
_.hasNext = function hasNext_10(){
  return this.currentNode != this.this$0.header;
}
;
_.hasPrevious = function hasPrevious_1(){
  return this.currentNode.prev != this.this$0.header;
}
;
_.next_0 = function next_14(){
  return $next_9(this);
}
;
_.previous_0 = function previous_5(){
  if (this.currentNode.prev == this.this$0.header) {
    throw new NoSuchElementException_0;
  }
  this.lastNode = this.currentNode = this.currentNode.prev;
  --this.currentIndex;
  return this.lastNode.value_0;
}
;
_.remove = function remove_29(){
  $remove_14(this);
}
;
_.castableTypeMap$ = {};
_.currentIndex = 0;
_.currentNode = null;
_.lastNode = null;
_.this$0 = null;
function $remove_15(this$static){
  this$static.next.prev = this$static.prev;
  this$static.prev.next = this$static.next;
  this$static.next = this$static.prev = this$static;
}

function LinkedList$Node_0(){
  this.next = this.prev = this;
}

function LinkedList$Node_2(value, nextNode){
  this.value_0 = value;
  this.next = nextNode;
  this.prev = nextNode.prev;
  nextNode.prev.next = this;
  nextNode.prev = this;
}

function LinkedList$Node(){
}

_ = LinkedList$Node_2.prototype = LinkedList$Node_0.prototype = LinkedList$Node.prototype = new Object_0;
_.getClass$ = function getClass_276(){
  return Ljava_util_LinkedList$Node_2_classLit;
}
;
_.castableTypeMap$ = {};
_.next = null;
_.prev = null;
_.value_0 = null;
function NoSuchElementException_0(){
  this.fillInStackTrace();
}

function NoSuchElementException_1(s){
  this.fillInStackTrace();
  this.detailMessage = s;
}

function NoSuchElementException(){
}

_ = NoSuchElementException_1.prototype = NoSuchElementException_0.prototype = NoSuchElementException.prototype = new RuntimeException;
_.getClass$ = function getClass_277(){
  return Ljava_util_NoSuchElementException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 139:1, 143:1};
function $makeHeap(this$static, node){
  var rightChild;
  if (node * 2 + 1 >= this$static.heap.size) {
    return;
  }
  $makeHeap(this$static, 2 * node + 1);
  rightChild = 2 * node + 2;
  rightChild < this$static.heap.size && $makeHeap(this$static, rightChild);
  $mergeHeaps(this$static, node);
}

function $mergeHeaps(this$static, node){
  var heapSize, smallestChild, value, leftChild, rightChild, smallestChild_0;
  heapSize = this$static.heap.size;
  value = $get_3(this$static.heap, node);
  while (node * 2 + 1 < heapSize) {
    smallestChild = (leftChild = 2 * node + 1 , rightChild = leftChild + 1 , smallestChild_0 = leftChild , rightChild < heapSize && $compare($get_3(this$static.heap, rightChild), $get_3(this$static.heap, leftChild)) < 0 && (smallestChild_0 = rightChild) , smallestChild_0);
    if ($compare(value, $get_3(this$static.heap, smallestChild)) < 0) {
      break;
    }
    $set_1(this$static.heap, node, $get_3(this$static.heap, smallestChild));
    node = smallestChild;
  }
  $set_1(this$static.heap, node, value);
}

function $offer(this$static, e){
  var childNode, node;
  node = this$static.heap.size;
  $add_9(this$static.heap, e);
  while (node > 0) {
    childNode = node;
    node = ~~((node - 1) / 2);
    if ($compare($get_3(this$static.heap, node), e) <= 0) {
      $set_1(this$static.heap, childNode, e);
      return true;
    }
    $set_1(this$static.heap, childNode, $get_3(this$static.heap, node));
  }
  $set_1(this$static.heap, node, e);
  return true;
}

function $peek(this$static){
  if (this$static.heap.size == 0) {
    return null;
  }
  return $get_3(this$static.heap, 0);
}

function $poll(this$static){
  var value;
  if (this$static.heap.size == 0) {
    return null;
  }
  value = $get_3(this$static.heap, 0);
  $removeAtIndex(this$static, 0);
  return value;
}

function $removeAtIndex(this$static, index){
  var lastValue;
  lastValue = $remove_10(this$static.heap, this$static.heap.size - 1);
  if (index < this$static.heap.size) {
    $set_1(this$static.heap, index, lastValue);
    $mergeHeaps(this$static, index);
  }
}

function PriorityQueue_0(){
  PriorityQueue_2.call(this, ($clinit_447() , $clinit_447() , NATURAL));
}

function PriorityQueue_2(cmp){
  this.heap = new ArrayList_2(11);
}

function PriorityQueue(){
}

_ = PriorityQueue_0.prototype = PriorityQueue.prototype = new AbstractQueue;
_.addAll = function addAll_3(c){
  var iter;
  if (c.isEmpty()) {
    return false;
  }
  iter = c.iterator_0();
  while (iter.hasNext()) {
    $add_9(this.heap, iter.next_0());
  }
  $makeHeap(this, 0);
  return true;
}
;
_.clear = function clear_13(){
  $clear_2(this.heap);
}
;
_.contains = function contains_12(o){
  return $indexOf_4(this.heap, o, 0) != -1;
}
;
_.getClass$ = function getClass_278(){
  return Ljava_util_PriorityQueue_2_classLit;
}
;
_.isEmpty = function isEmpty_6(){
  return this.heap.size == 0;
}
;
_.iterator_0 = function iterator_14(){
  return new Collections$UnmodifiableCollectionIterator_0(unmodifiableList(this.heap).coll.iterator_0());
}
;
_.poll = function poll_0(){
  return $poll(this);
}
;
_.remove_1 = function remove_30(o){
  var index;
  index = $indexOf_4(this.heap, o, 0);
  if (index < 0) {
    return false;
  }
  $removeAtIndex(this, index);
  return true;
}
;
_.size_0 = function size_21(){
  return this.heap.size;
}
;
_.toArray = function toArray_7(){
  return $toArray_0(this.heap);
}
;
_.toArray_0 = function toArray_8(a_0){
  return $toArray_1(this.heap, a_0);
}
;
_.toString$ = function toString_24(){
  return $toString_2(this.heap);
}
;
_.castableTypeMap$ = {130:1, 211:1};
_.heap = null;
function Vector(){
}

_ = Vector.prototype = new AbstractList;
_.add_0 = function add_12(o){
  return $add_9(this.arrayList, o);
}
;
_.add_2 = function add_13(index, o){
  $add_10(this.arrayList, index, o);
}
;
_.addAll = function addAll_4(c){
  return $addAll_0(this.arrayList, c);
}
;
_.clear = function clear_14(){
  $clear_2(this.arrayList);
}
;
_.contains = function contains_13(elem){
  return $indexOf_4(this.arrayList, elem, 0) != -1;
}
;
_.get_0 = function get_12(index){
  return $get_3(this.arrayList, index);
}
;
_.getClass$ = function getClass_279(){
  return Ljava_util_Vector_2_classLit;
}
;
_.isEmpty = function isEmpty_7(){
  return this.arrayList.size == 0;
}
;
_.iterator_0 = function iterator_15(){
  return new AbstractList$IteratorImpl_0(this.arrayList);
}
;
_.remove_3 = function remove_31(index){
  return $remove_10(this.arrayList, index);
}
;
_.removeRange = function removeRange_1(fromIndex, endIndex){
  $removeRange(this.arrayList, fromIndex, endIndex);
}
;
_.set_0 = function set_5(index, elem){
  return $set_1(this.arrayList, index, elem);
}
;
_.size_0 = function size_22(){
  return this.arrayList.size;
}
;
_.toArray = function toArray_9(){
  return $toArray_0(this.arrayList);
}
;
_.toArray_0 = function toArray_10(a_0){
  return $toArray_1(this.arrayList, a_0);
}
;
_.toString$ = function toString_25(){
  return $toString_2(this.arrayList);
}
;
_.castableTypeMap$ = {27:1, 58:1, 130:1};
_.arrayList = null;
function $peek_0(this$static){
  var sz;
  sz = this$static.arrayList.size;
  if (sz > 0) {
    return $get_3(this$static.arrayList, sz - 1);
  }
   else {
    throw new EmptyStackException_0;
  }
}

function $pop(this$static){
  var sz;
  sz = this$static.arrayList.size;
  if (sz > 0) {
    return $remove_10(this$static.arrayList, sz - 1);
  }
   else {
    throw new EmptyStackException_0;
  }
}

function $push_1(this$static, o){
  $add_9(this$static.arrayList, o);
  return o;
}

function Stack_0(){
  this.arrayList = new ArrayList_0;
}

function Stack(){
}

_ = Stack_0.prototype = Stack.prototype = new Vector;
_.getClass$ = function getClass_280(){
  return Ljava_util_Stack_2_classLit;
}
;
_.castableTypeMap$ = {27:1, 58:1, 130:1, 258:1};
function $clinit_479(){
  $clinit_479 = nullMethod;
  DEFAULT_COMPARATOR = new TreeMap$1_0;
}

function $clear_7(this$static){
  this$static.root = null;
  this$static.size = 0;
}

function $getEntry(this$static, key){
  var c, tree;
  tree = this$static.root;
  while (tree) {
    c = $compare_1(key, tree.key);
    if (c == 0) {
      return tree;
    }
    c < 0?(tree = tree.child[0]):(tree = tree.child[1]);
  }
  return null;
}

function $insert_1(this$static, tree, newNode, state){
  var c, childNum;
  if (!tree) {
    return newNode;
  }
   else {
    c = $compare_1(tree.key, newNode.key);
    if (c == 0) {
      state.value_0 = tree.value_0;
      state.found = true;
      tree.value_0 = newNode.value_0;
      return tree;
    }
    childNum = c > 0?0:1;
    tree.child[childNum] = $insert_1(this$static, tree.child[childNum], newNode, state);
    if ($isRed(tree.child[childNum])) {
      if ($isRed(tree.child[1 - childNum])) {
        tree.isRed = true;
        tree.child[0].isRed = false;
        tree.child[1].isRed = false;
      }
       else {
        $isRed(tree.child[childNum].child[childNum])?(tree = $rotateSingle(tree, 1 - childNum)):$isRed(tree.child[childNum].child[1 - childNum]) && (tree = (tree.child[1 - (1 - childNum)] = $rotateSingle(tree.child[1 - (1 - childNum)], 1 - (1 - childNum)) , $rotateSingle(tree, 1 - childNum)));
      }
    }
  }
  return tree;
}

function $isRed(node){
  return !!node && node.isRed;
}

function $put_0(this$static, key, value){
  var node, state;
  node = new TreeMap$Node_0(key, value);
  state = new TreeMap$State_0;
  this$static.root = $insert_1(this$static, this$static.root, node, state);
  state.found || ++this$static.size;
  this$static.root.isRed = false;
  return state.value_0;
}

function $remove_17(this$static, keyObj){
  var state;
  state = new TreeMap$State_0;
  $removeWithState(this$static, keyObj, state);
  return state.value_0;
}

--></script>
<script><!--
function $removeWithState(this$static, key, state){
  var c, dir, dir2, found, grandparent, head, last, newNode, node, parent_0, sibling;
  if (!this$static.root) {
    return false;
  }
  found = null;
  parent_0 = null;
  head = new TreeMap$Node_0(null, null);
  dir = 1;
  head.child[1] = this$static.root;
  node = head;
  while (node.child[dir]) {
    last = dir;
    grandparent = parent_0;
    parent_0 = node;
    node = node.child[dir];
    c = $compare_1(node.key, key);
    dir = c < 0?1:0;
    c == 0 && (!state.matchValue || equals__devirtual$(node.value_0, state.value_0)) && (found = node);
    if (!(!!node && node.isRed) && !$isRed(node.child[dir])) {
      if ($isRed(node.child[1 - dir])) {
        parent_0 = parent_0.child[last] = $rotateSingle(node, dir);
      }
       else if (!$isRed(node.child[1 - dir])) {
        sibling = parent_0.child[1 - last];
        if (sibling) {
          if (!$isRed(sibling.child[1 - last]) && !$isRed(sibling.child[last])) {
            parent_0.isRed = false;
            sibling.isRed = true;
            node.isRed = true;
          }
           else {
            dir2 = grandparent.child[1] == parent_0?1:0;
            $isRed(sibling.child[last])?(grandparent.child[dir2] = (parent_0.child[1 - last] = $rotateSingle(parent_0.child[1 - last], 1 - last) , $rotateSingle(parent_0, last))):$isRed(sibling.child[1 - last]) && (grandparent.child[dir2] = $rotateSingle(parent_0, last));
            node.isRed = grandparent.child[dir2].isRed = true;
            grandparent.child[dir2].child[0].isRed = false;
            grandparent.child[dir2].child[1].isRed = false;
          }
        }
      }
    }
  }
  if (found) {
    state.found = true;
    state.value_0 = found.value_0;
    if (node != found) {
      newNode = new TreeMap$Node_0(node.key, node.value_0);
      $replaceNode_0(head, found, newNode);
      parent_0 == found && (parent_0 = newNode);
    }
    parent_0.child[parent_0.child[1] == node?1:0] = node.child[!node.child[0]?1:0];
    --this$static.size;
  }
  this$static.root = head.child[1];
  !!this$static.root && (this$static.root.isRed = false);
  return state.found;
}

function $replaceNode_0(head, node, newNode){
  var direction, parent_0;
  parent_0 = head;
  direction = head.key == null || $compare_1(node.key, head.key) > 0?1:0;
  while (parent_0.child[direction] != node) {
    parent_0 = parent_0.child[direction];
    direction = $compare_1(node.key, parent_0.key) > 0?1:0;
  }
  parent_0.child[direction] = newNode;
  newNode.isRed = node.isRed;
  newNode.child[0] = node.child[0];
  newNode.child[1] = node.child[1];
  node.child[0] = null;
  node.child[1] = null;
}

function $rotateSingle(tree, rotateDirection){
  var save;
  save = tree.child[1 - rotateDirection];
  tree.child[1 - rotateDirection] = save.child[rotateDirection];
  save.child[rotateDirection] = tree;
  tree.isRed = true;
  save.isRed = false;
  return save;
}

function TreeMap_0(){
  $clinit_479();
  TreeMap_1.call(this, null);
}

function TreeMap_1(c){
  this.root = null;
  !c && (c = DEFAULT_COMPARATOR);
}

function TreeMap(){
}

_ = TreeMap_0.prototype = TreeMap.prototype = new AbstractMap;
_.clear = function clear_15(){
  this.root = null;
  this.size = 0;
}
;
_.containsKey = function containsKey_4(key){
  return !!$getEntry(this, key);
}
;
_.entrySet_0 = function entrySet_4(){
  return new TreeMap$EntrySet_0(this);
}
;
_.get = function get_13(k){
  var entry;
  return entry = $getEntry(this, k) , entry?entry.value_0:null;
}
;
_.getClass$ = function getClass_281(){
  return Ljava_util_TreeMap_2_classLit;
}
;
_.put = function put_3(key, value){
  return $put_0(this, key, value);
}
;
_.remove_2 = function remove_32(keyObj){
  var state;
  return state = new TreeMap$State_0 , $removeWithState(this, keyObj, state) , state.value_0;
}
;
_.size_0 = function size_23(){
  return this.size;
}
;
_.castableTypeMap$ = {26:1, 58:1};
_.root = null;
_.size = 0;
var DEFAULT_COMPARATOR;
function $compare_0(a_0, b){
  if (a_0 == null || b == null) {
    throw new NullPointerException_0;
  }
  return a_0.compareTo$(b);
}

function $compare_1(a_0, b){
  return $compare_0(dynamicCast(a_0, 61), dynamicCast(b, 61));
}

function TreeMap$1_0(){
}

function TreeMap$1(){
}

_ = TreeMap$1_0.prototype = TreeMap$1.prototype = new Object_0;
_.compare = function compare_2(a_0, b){
  return $compare_0(dynamicCast(a_0, 61), dynamicCast(b, 61));
}
;
_.getClass$ = function getClass_282(){
  return Ljava_util_TreeMap$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function $inOrderAdd(this$static, list, type, current, fromKey, toKey){
  if (!current) {
    return;
  }
  !!current.child[0] && $inOrderAdd(this$static, list, type, current.child[0], fromKey, toKey);
  $inRange(type, current.key, fromKey, toKey) && list.add_0(current);
  !!current.child[1] && $inOrderAdd(this$static, list, type, current.child[1], fromKey, toKey);
}

function $inRange(type, key, fromKey, toKey){
  if (type.toKeyValid()) {
    if ($compare_0(dynamicCast(key, 61), dynamicCast(toKey, 61)) >= 0) {
      return false;
    }
  }
  if (type.fromKeyValid()) {
    if ($compare_0(dynamicCast(key, 61), dynamicCast(fromKey, 61)) < 0) {
      return false;
    }
  }
  return true;
}

function TreeMap$EntryIterator_0(this$0){
  TreeMap$EntryIterator_1.call(this, this$0, ($clinit_485() , All));
}

function TreeMap$EntryIterator_1(this$0, type){
  var list;
  this.this$0 = this$0;
  list = new ArrayList_0;
  $inOrderAdd(this, list, type, this$0.root, null, null);
  this.iter = new AbstractList$IteratorImpl_0(list);
}

function TreeMap$EntryIterator(){
}

_ = TreeMap$EntryIterator_0.prototype = TreeMap$EntryIterator.prototype = new Object_0;
_.getClass$ = function getClass_283(){
  return Ljava_util_TreeMap$EntryIterator_2_classLit;
}
;
_.hasNext = function hasNext_11(){
  return $hasNext_3(this.iter);
}
;
_.next_0 = function next_15(){
  return this.last = dynamicCast($next_6(this.iter), 66);
}
;
_.remove = function remove_33(){
  $remove_7(this.iter);
  $remove_17(this.this$0, this.last.getKey());
}
;
_.castableTypeMap$ = {};
_.iter = null;
_.last = null;
_.this$0 = null;
function TreeMap$EntrySet_0(this$0){
  this.this$0 = this$0;
}

function TreeMap$EntrySet(){
}

_ = TreeMap$EntrySet_0.prototype = TreeMap$EntrySet.prototype = new AbstractSet;
_.clear = function clear_16(){
  $clear_7(this.this$0);
}
;
_.contains = function contains_14(o){
  var entry, lookupEntry;
  if (!(o != null && o.castableTypeMap$ && !!o.castableTypeMap$[66])) {
    return false;
  }
  entry = dynamicCast(o, 66);
  lookupEntry = $getEntry(this.this$0, entry.getKey());
  return !!lookupEntry && equalsWithNullCheck(lookupEntry.value_0, entry.getValue());
}
;
_.getClass$ = function getClass_284(){
  return Ljava_util_TreeMap$EntrySet_2_classLit;
}
;
_.iterator_0 = function iterator_16(){
  return new TreeMap$EntryIterator_0(this.this$0);
}
;
_.remove_1 = function remove_34(o){
  var entry, state;
  if (!(o != null && o.castableTypeMap$ && !!o.castableTypeMap$[66])) {
    return false;
  }
  entry = dynamicCast(o, 66);
  state = new TreeMap$State_0;
  state.matchValue = true;
  state.value_0 = entry.getValue();
  return $removeWithState(this.this$0, entry.getKey(), state);
}
;
_.size_0 = function size_24(){
  return this.this$0.size;
}
;
_.castableTypeMap$ = {40:1, 130:1};
_.this$0 = null;
function TreeMap$Node_0(key, value){
  this.key = key;
  this.value_0 = value;
  this.child = initDim(_3Ljava_util_TreeMap$Node_2_classLit, {58:1, 138:1}, 67, 2, 0);
  this.isRed = true;
}

function TreeMap$Node(){
}

_ = TreeMap$Node_0.prototype = TreeMap$Node.prototype = new Object_0;
_.equals$ = function equals_20(o){
  var other;
  if (!(o != null && o.castableTypeMap$ && !!o.castableTypeMap$[67])) {
    return false;
  }
  other = dynamicCast(o, 67);
  return equalsWithNullCheck(this.key, other.key) && equalsWithNullCheck(this.value_0, other.value_0);
}
;
_.getClass$ = function getClass_285(){
  return Ljava_util_TreeMap$Node_2_classLit;
}
;
_.getKey = function getKey_3(){
  return this.key;
}
;
_.getValue = function getValue_5(){
  return this.value_0;
}
;
_.hashCode$ = function hashCode_20(){
  var keyHash, valueHash;
  keyHash = this.key != null?hashCode__devirtual$(this.key):0;
  valueHash = this.value_0 != null?hashCode__devirtual$(this.value_0):0;
  return keyHash ^ valueHash;
}
;
_.setValue = function setValue_3(value){
  var old;
  old = this.value_0;
  this.value_0 = value;
  return old;
}
;
_.toString$ = function toString_26(){
  return this.key + '=' + this.value_0;
}
;
_.castableTypeMap$ = {66:1, 67:1};
_.child = null;
_.isRed = false;
_.key = null;
_.value_0 = null;
function TreeMap$State_0(){
}

function TreeMap$State(){
}

_ = TreeMap$State_0.prototype = TreeMap$State.prototype = new Object_0;
_.getClass$ = function getClass_286(){
  return Ljava_util_TreeMap$State_2_classLit;
}
;
_.toString$ = function toString_27(){
  return 'State: mv=' + this.matchValue + ' value=' + this.value_0 + ' done=' + this.done + ' found=' + this.found;
}
;
_.castableTypeMap$ = {};
_.done = false;
_.found = false;
_.matchValue = false;
_.value_0 = null;
function $clinit_485(){
  $clinit_485 = nullMethod;
  All = new TreeMap$SubMapType_0('All', 0);
  Head = new TreeMap$SubMapType$1_0;
  Range_0 = new TreeMap$SubMapType$2_0;
  Tail = new TreeMap$SubMapType$3_0;
  $VALUES_9 = initValues(_3Ljava_util_TreeMap$SubMapType_2_classLit, {58:1, 138:1}, 68, [All, Head, Range_0, Tail]);
}

function TreeMap$SubMapType_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_10(){
  $clinit_485();
  return $VALUES_9;
}

function TreeMap$SubMapType(){
}

_ = TreeMap$SubMapType_0.prototype = TreeMap$SubMapType.prototype = new Enum;
_.fromKeyValid = function fromKeyValid(){
  return false;
}
;
_.getClass$ = function getClass_287(){
  return Ljava_util_TreeMap$SubMapType_2_classLit;
}
;
_.toKeyValid = function toKeyValid(){
  return false;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 68:1};
var $VALUES_9, All, Head, Range_0, Tail;
function TreeMap$SubMapType$1_0(){
  this.name_0 = 'Head';
  this.ordinal = 1;
}

function TreeMap$SubMapType$1(){
}

_ = TreeMap$SubMapType$1_0.prototype = TreeMap$SubMapType$1.prototype = new TreeMap$SubMapType;
_.getClass$ = function getClass_288(){
  return Ljava_util_TreeMap$SubMapType$1_2_classLit;
}
;
_.toKeyValid = function toKeyValid_0(){
  return true;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 68:1};
function TreeMap$SubMapType$2_0(){
  this.name_0 = 'Range';
  this.ordinal = 2;
}

function TreeMap$SubMapType$2(){
}

_ = TreeMap$SubMapType$2_0.prototype = TreeMap$SubMapType$2.prototype = new TreeMap$SubMapType;
_.fromKeyValid = function fromKeyValid_0(){
  return true;
}
;
_.getClass$ = function getClass_289(){
  return Ljava_util_TreeMap$SubMapType$2_2_classLit;
}
;
_.toKeyValid = function toKeyValid_1(){
  return true;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 68:1};
function TreeMap$SubMapType$3_0(){
  this.name_0 = 'Tail';
  this.ordinal = 3;
}

function TreeMap$SubMapType$3(){
}

_ = TreeMap$SubMapType$3_0.prototype = TreeMap$SubMapType$3.prototype = new TreeMap$SubMapType;
_.fromKeyValid = function fromKeyValid_1(){
  return true;
}
;
_.getClass$ = function getClass_290(){
  return Ljava_util_TreeMap$SubMapType$3_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 68:1};
function TreeSet_0(){
  this.map = new TreeMap_0;
}

function TreeSet(){
}

_ = TreeSet_0.prototype = TreeSet.prototype = new AbstractSet;
_.add_0 = function add_14(o){
  return $put_0(this.map, o, ($clinit_382() , FALSE)) == null;
}
;
_.clear = function clear_17(){
  $clear_7(this.map);
}
;
_.contains = function contains_15(o){
  return !!$getEntry(this.map, o);
}
;
_.getClass$ = function getClass_291(){
  return Ljava_util_TreeSet_2_classLit;
}
;
_.iterator_0 = function iterator_17(){
  var outerIter;
  return outerIter = $keySet(this.map).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter);
}
;
_.remove_1 = function remove_35(o){
  return $remove_17(this.map, o) != null;
}
;
_.size_0 = function size_25(){
  return this.map.size;
}
;
_.castableTypeMap$ = {40:1, 58:1, 130:1};
_.map = null;
function equalsWithNullCheck(a_0, b){
  return (a_0 == null?null:a_0) === (b == null?null:b) || a_0 != null && equals__devirtual$(a_0, b);
}

function deserialize_0(serialized){
  var annotations, innerSplit, s, s$index, s$max, split, regexp, regexp_0;
  split = $split(serialized, ':', 0);
  annotations = new ArrayList_0;
  for (s$index = 0 , s$max = split.length; s$index < s$max; ++s$index) {
    s = split[s$index];
    if (s.length) {
      innerSplit = $split(s, ',', 0);
      innerSplit.length == 4 && $add_9(annotations, new RangedAnnotationImpl_0((throwIfNull('encodedURLComponent', innerSplit[2]) , regexp = /\+/g , decodeURIComponent(innerSplit[2].replace(regexp, '%20'))), (throwIfNull('encodedURLComponent', innerSplit[3]) , regexp_0 = /\+/g , decodeURIComponent(innerSplit[3].replace(regexp_0, '%20'))), __parseAndValidateInt(innerSplit[0], 10), __parseAndValidateInt(innerSplit[1], 10)));
    }
  }
  return annotations;
}

function serializeAnnotation(rangedAnnotations){
  var ann, ann$iterator, entries;
  entries = new AnnotationSerializer$Builder_0;
  for (ann$iterator = new AbstractList$IteratorImpl_0(rangedAnnotations); ann$iterator.i < ann$iterator.this$0_0.size_0();) {
    ann = dynamicCast($next_6(ann$iterator), 142);
    ann.value_0 != null && $pushEntry(entries, ann.start, ann.end, ann.key, dynamicCast(ann.value_0, 1));
  }
  return entries.builder.impl.string;
}

function $pushEntry(this$static, start, end, key, value){
  var regexp, regexp_0;
  $append_8($append_8($append_8($append_8($append_8($append_6($append_8($append_6(this$static.builder, start), ','), end), ','), (throwIfNull('decodedURLComponent', key) , regexp = /%20/g , encodeURIComponent(key).replace(regexp, '+'))), ','), (throwIfNull('decodedURLComponent', value) , regexp_0 = /%20/g , encodeURIComponent(value).replace(regexp_0, '+'))), ':');
}

function AnnotationSerializer$Builder_0(){
  this.builder = new StringBuilder_0;
}

function AnnotationSerializer$Builder(){
}

_ = AnnotationSerializer$Builder_0.prototype = AnnotationSerializer$Builder.prototype = new Object_0;
_.getClass$ = function getClass_292(){
  return Lorg_waveprotocol_wave_client_clipboard_AnnotationSerializer$Builder_2_classLit;
}
;
_.toString$ = function toString_28(){
  return this.builder.impl.string;
}
;
_.castableTypeMap$ = {};
function $clinit_494(){
  var pasteBuffer;
  $clinit_494 = nullMethod;
  LOG = new DomLogger_0('clipboard');
  INSTANCE_2 = new Clipboard_0((pasteBuffer = new PasteBufferImpl_0 , pasteBuffer.element = $doc.createElement('div') , pasteBuffer.element.setAttribute('contentEditable', 'true') , pasteBuffer.element.style['white-space'] = 'pre-wrap' , pasteBuffer.element.style['overflow'] = ($clinit_58() , 'hidden') , $positionPasteBuffer(pasteBuffer.element) , $doc.body.appendChild(pasteBuffer.element) , pasteBuffer));
}

function $fillBufferAndSetSelection(this$static, htmlFragment, selection, waveXml, normalizedAnnotation){
  $setContent(this$static.pasteBuffer, htmlFragment);
  !!waveXml && !!normalizedAnnotation && $hijackFragment(waveXml.builder.impl.string, serializeAnnotation(normalizedAnnotation), selection);
  $clinit_973();
  cache_0 = null;
}

function $hijackFragment(xmlInRange, annotations, origRange){
  var newEnd, origEnd, origStart, spanForXml, t, trailingSpan, parent_0, parent_1;
  origStart = origRange.first;
  origEnd = origRange.second;
  spanForXml = $doc.createElement('span');
  spanForXml.setAttribute('data-wave-xml', xmlInRange);
  spanForXml.setAttribute('data-wave-annotations', annotations);
  spanForXml.className = '__wave_paste';
  $log_0(LOG.traceLogger, 'original point: ' + origStart);
  trailingSpan = $doc.createElement('span');
  trailingSpan.innerHTML = '&nbsp;';
  if (origEnd.offset >= 0) {
    t = dynamicCastJso(origEnd.container);
    $setData(t, t.data.substr(0, $getTextOffset(origEnd) - 0));
    $insertAfter((parent_0 = dynamicCastJso(origEnd.container).parentNode , (!parent_0 || parent_0.nodeType != 1) && (parent_0 = null) , parent_0), spanForXml, t);
    $insertAfter((parent_1 = dynamicCastJso(origEnd.container).parentNode , (!parent_1 || parent_1.nodeType != 1) && (parent_1 = null) , parent_1), trailingSpan, spanForXml);
  }
   else {
    $insertAfter(dynamicCastJso(origEnd.container), spanForXml, dynamicCastJso($getNodeAfter(origEnd)));
    $insertAfter(dynamicCastJso(origEnd.container), trailingSpan, spanForXml);
  }
  newEnd = new Point$El_0($getParentElement(spanForXml), trailingSpan.nextSibling);
  $log_0(LOG.traceLogger, 'new point: ' + newEnd);
  $logPlainText(LOG.traceLogger, 'parent: ' + $getParentElement(spanForXml).innerHTML);
  return new PointRange_1(origStart, newEnd);
}

function $maybeGetAttributeFromContainer(srcContainer, attribName){
  var elementsByClassName;
  elementsByClassName = getElementsByClassName(srcContainer);
  if (!!elementsByClassName && elementsByClassName.length > 0) {
    return elementsByClassName[0].getAttribute(attribName) || '';
  }
  return null;
}

function $maybeGetWaveXml(srcContainer){
  var waveXml, regex, replacement;
  waveXml = $maybeGetAttributeFromContainer(srcContainer, 'data-wave-xml');
  srcContainer.innerHTML;
  if (waveXml != null) {
    $logPlainText(LOG.traceLogger, 'found serialized waveXml: ' + waveXml);
    waveXml = (regex = $replaceAll('\n', '([/\\\\\\.\\*\\+\\?\\|\\(\\)\\[\\]\\{\\}$^])', '\\\\$1') , replacement = $replaceAll($replaceAll('', '\\\\', '\\\\\\\\'), '\\$', '\\\\$') , $replaceAll(waveXml, regex, replacement));
  }
  return waveXml;
}

function Clipboard_0(pasteBuffer){
  this.pasteBuffer = pasteBuffer;
}

function Clipboard(){
}

_ = Clipboard_0.prototype = Clipboard.prototype = new Object_0;
_.getClass$ = function getClass_293(){
  return Lorg_waveprotocol_wave_client_clipboard_Clipboard_2_classLit;
}
;
_.castableTypeMap$ = {};
_.pasteBuffer = null;
var INSTANCE_2, LOG;
function $positionPasteBuffer(element){
  element.style['position'] = ($clinit_63() , 'absolute');
  element.style['top'] = -100 + ($clinit_68() , 'px');
  element.style['height'] = '50px';
}

function $prepareForPaste(this$static){
  this$static.element.innerHTML = '';
  this$static.element.appendChild($doc.createTextNode(''));
  $clinit_973();
  new Point$Tx_0(this$static.element.firstChild, 0);
  cache_0 = null;
  cache_0 = null;
}

function $setContent(this$static, node){
  this$static.element.innerHTML = '';
  this$static.element.appendChild(node);
}

function PasteBufferImpl_0(){
}

function PasteBufferImpl(){
}

_ = PasteBufferImpl_0.prototype = PasteBufferImpl.prototype = new Object_0;
_.getClass$ = function getClass_294(){
  return Lorg_waveprotocol_wave_client_clipboard_PasteBufferImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.element = null;
function extractScheme(uri){
  var colonPos, scheme;
  colonPos = uri.indexOf(fromCodePoint(58));
  if (colonPos < 0) {
    return null;
  }
  scheme = uri.substr(0, colonPos - 0);
  if (scheme.indexOf(fromCodePoint(47)) >= 0 || scheme.indexOf(fromCodePoint(35)) >= 0) {
    return null;
  }
  return scheme;
}

function ClientDebugException_0(cause){
  this.fillInStackTrace();
  this.cause = cause;
  this.detailMessage = '';
}

function ClientDebugException(){
}

_ = ClientDebugException_0.prototype = ClientDebugException.prototype = new RuntimeException;
_.getClass$ = function getClass_295(){
  return Lorg_waveprotocol_wave_client_common_util_ClientDebugException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1};
function emptyElement(element){
  while (element.firstChild) {
    element.removeChild(element.firstChild);
  }
}

function focus_3(element){
  var $e0;
  try {
    ($clinit_373() , $clinit_373() , implWidget).focus_1(element);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (!instanceOf($e0, 143))
      throw $e0;
  }
}

function getContentEditability(element){
  var $e0, $e1, e, editability, elementString, elementTag, sb;
  try {
    editability = element.getAttribute('contentEditable') || '';
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 144)) {
      e = $e0;
      elementString = "<couldn't get element string>";
      elementTag = "<couldn't get element tag>";
      try {
        elementString = element.toString?element.toString():'[JavaScriptObject]';
      }
       catch ($e1) {
        $e1 = caught_0($e1);
        if (!instanceOf($e1, 143))
          throw $e1;
      }
      try {
        elementTag = element.tagName;
      }
       catch ($e1) {
        $e1 = caught_0($e1);
        if (!instanceOf($e1, 143))
          throw $e1;
      }
      sb = new StringBuilder_0;
      sb.impl.string += "Couldn't get the 'contentEditable' attribute for element '";
      $append_8($append_8((sb.impl.string += elementString , sb), "' tag name = "), elementTag);
      throw new RuntimeException_2(sb.impl.string, e);
    }
     else 
      throw $e0;
  }
  return editability == null || !editability.length?($clinit_500() , NEUTRAL):$equalsIgnoreCase('true', editability)?($clinit_500() , EDITABLE):($clinit_500() , NOT_EDITABLE);
}

function getElementEditability(elem){
  var $e0, tagName;
  tagName = null;
  try {
    tagName = elem.tagName;
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (!instanceOf($e0, 143))
      throw $e0;
  }
  if (tagName != null) {
    tagName = tagName.toLowerCase();
    if ($equals_3(tagName, 'input') || $equals_3(tagName, 'textarea')) {
      return $clinit_500() , EDITABLE;
    }
  }
  return getContentEditability(elem);
}

function getElementsByClassName(e){
  var all, i, item, ret;
  if ($clinit_515() , SUPPORTS_GET_ELEMENTS_BY_CLASSNAME) {
    return e.getElementsByClassName('__wave_paste');
  }
   else {
    all = e.getElementsByTagName('*');
    if (!all) {
      return null;
    }
    ret = [];
    for (i = 0; i < all.length; ++i) {
      item = all[i];
      $equals_3('__wave_paste', item.className) && (ret[ret.length] = item , undefined);
    }
    return ret;
  }
}

function isEditable_0(e){
  var docElement, editability;
  if (isUnreadable(e)) {
    return true;
  }
  docElement = $doc.documentElement;
  do {
    editability = getElementEditability(e);
    if (editability == ($clinit_500() , NEUTRAL)) {
      if (e == docElement) {
        return false;
      }
      e = $getParentElement(e);
    }
     else {
      return editability == EDITABLE;
    }
  }
   while (e);
  return true;
}

function isUnreadable(n){
  var $e0;
  try {
    n.nodeType;
    return false;
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 4)) {
      return true;
    }
     else 
      throw $e0;
  }
}

function moveNodes(parent_0, from, toExcl){
  var m_0, n;
  for (n = from; n != toExcl;) {
    m_0 = n;
    n = n.nextSibling;
    parent_0.insertBefore(m_0, null);
  }
}

function nodeOffsetToNodeletPoint(node, offset){
  var container;
  if (node.nodeType == 3) {
    return new Point$Tx_0(node, offset);
  }
   else {
    container = node;
    return new Point$El_0(container, offset >= container.childNodes.length?null:container.childNodes[offset]);
  }
}

function registerEventHandler(el, eventName, capture, listener){
  var func = $entry(function(e){
    var evt = e || $wnd.event;
    listener.onJavaScriptEvent(eventName, evt);
  }
  );
  el.addEventListener?el.addEventListener(eventName, func, capture):el.attachEvent?el.attachEvent('on' + eventName, func):(el['on' + eventName.toLowerCase()] = func);
  func.$ev = eventName;
  func.$cp = capture;
  func.$el = el;
  return func;
}

function replaceElement(oldElement, newElement){
  if ($getParentElement(oldElement)) {
    $getParentElement(oldElement).insertBefore(newElement, oldElement);
    $removeFromParent(oldElement);
  }
  moveNodes(newElement, oldElement.firstChild, null);
}

function setContentEditable(element, isEditable, whiteSpacePreWrap){
  element.setAttribute('contentEditable', isEditable?'true':'false');
  whiteSpacePreWrap && (element.style['white-space'] = 'pre-wrap' , undefined);
  return element;
}

function $clinit_500(){
  $clinit_500 = nullMethod;
  EDITABLE = new DomHelper$ElementEditability_0('EDITABLE', 0);
  NOT_EDITABLE = new DomHelper$ElementEditability_0('NOT_EDITABLE', 1);
  NEUTRAL = new DomHelper$ElementEditability_0('NEUTRAL', 2);
  $VALUES_10 = initValues(_3Lorg_waveprotocol_wave_client_common_util_DomHelper$ElementEditability_2_classLit, {58:1, 138:1}, 69, [EDITABLE, NOT_EDITABLE, NEUTRAL]);
}

function DomHelper$ElementEditability_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_11(){
  $clinit_500();
  return $VALUES_10;
}

function DomHelper$ElementEditability(){
}

_ = DomHelper$ElementEditability_0.prototype = DomHelper$ElementEditability.prototype = new Enum;
_.getClass$ = function getClass_296(){
  return Lorg_waveprotocol_wave_client_common_util_DomHelper$ElementEditability_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 69:1};
var $VALUES_10, EDITABLE, NEUTRAL, NOT_EDITABLE;
function $unregister(this$static){
  var el = this$static.$el;
  if (el == null) {
    return false;
  }
  el.removeEventListener?el.removeEventListener(this$static.$ev, this$static, this$static.$cp):el.detachEvent?el.detachEvent('on' + this$static.$ev, this$static):(el['on' + this$static.$ev] = null);
  this$static.$ev = null;
  return true;
}

function $clinit_503(){
  $clinit_503 = nullMethod;
  keyMap = new EventWrapper$1_0;
}

function $getKeyCombo(this$static){
  return getKeyCombo_0(getKeyCode(this$static.event_0), !!this$static.event_0.ctrlKey, !!this$static.event_0.shiftKey, !!this$static.event_0.altKey, !!this$static.event_0.metaKey);
}

function EventWrapper_0(event_0){
  $clinit_503();
  this.event_0 = event_0;
}

function asString(event_0){
  var string;
  string = event_0.type;
  switch ($eventGetTypeInt(event_0.type)) {
    case 256:
    case 512:
    case 128:
      string += ' ' + (event_0.keyCode || 0) + " '" + String.fromCharCode((event_0.keyCode || 0) & 65535) + "'" + ((event_0.altKey?' alt':'') + (event_0.shiftKey?' shift':'') + (event_0.ctrlKey?' ctrl':'') + (event_0.metaKey?' meta':'') + ($eventGetTypeInt(event_0.type) == 128 && !!event_0.repeat?' repeat':''));
      break;
    case 1:
    case 2:
    case 64:
      string += ' (' + (event_0.clientX || 0) + ', ' + (event_0.clientY || 0) + ')' + ((event_0.altKey?' alt':'') + (event_0.shiftKey?' shift':'') + (event_0.ctrlKey?' ctrl':'') + (event_0.metaKey?' meta':'') + ($eventGetTypeInt(event_0.type) == 128 && !!event_0.repeat?' repeat':''));
      break;
    case 4:
    case 8:
      string += ' (' + (event_0.clientX || 0) + ', ' + (event_0.clientY || 0) + ')' + ($eventGetButton(event_0) == -1?'':(($eventGetButton(event_0) & 1) != 0?' left':'') + (($eventGetButton(event_0) & 4) != 0?' middle':'') + (($eventGetButton(event_0) & 2) != 0?' right':'')) + ((event_0.altKey?' alt':'') + (event_0.shiftKey?' shift':'') + (event_0.ctrlKey?' ctrl':'') + (event_0.metaKey?' meta':'') + ($eventGetTypeInt(event_0.type) == 128 && !!event_0.repeat?' repeat':''));
      break;
    case 32:
      string += ' (' + (event_0.clientX || 0) + ', ' + (event_0.clientY || 0) + ')' + ((event_0.altKey?' alt':'') + (event_0.shiftKey?' shift':'') + (event_0.ctrlKey?' ctrl':'') + (event_0.metaKey?' meta':'') + ($eventGetTypeInt(event_0.type) == 128 && !!event_0.repeat?' repeat':'')) + ' to: ' + $eventGetToElement(event_0);
      break;
    case 16:
      string += ' (' + (event_0.clientX || 0) + ', ' + (event_0.clientY || 0) + ')' + ((event_0.altKey?' alt':'') + (event_0.shiftKey?' shift':'') + (event_0.ctrlKey?' ctrl':'') + (event_0.metaKey?' meta':'') + ($eventGetTypeInt(event_0.type) == 128 && !!event_0.repeat?' repeat':'')) + ' from: ' + $eventGetFromElement(event_0);
      break;
    case 131072:
      string += ' ' + (Math.round(-event_0.wheelDelta / 40) || 0) + ' (' + (event_0.clientX || 0) + ', ' + (event_0.clientY || 0) + ')' + ((event_0.altKey?' alt':'') + (event_0.shiftKey?' shift':'') + (event_0.ctrlKey?' ctrl':'') + (event_0.metaKey?' meta':'') + ($eventGetTypeInt(event_0.type) == 128 && !!event_0.repeat?' repeat':''));
  }
  return string;
}

function getKeyCode(evt){
  var keyCode;
  keyCode = evt.keyCode || 0;
  keyCode == 0 && (keyCode = evt.charCode || 0);
  return keyCode;
}

function getKeyCombo(evt){
  $clinit_503();
  return getKeyCombo_0(getKeyCode(evt), !!evt.ctrlKey, !!evt.shiftKey, !!evt.altKey, !!evt.metaKey);
}

function getKeyCombo_0(keyCode, ctrl, shift, alt, meta){
  $clinit_503();
  var gwtCode;
  gwtCode = keyCode;
  gwtCode += (ctrl?524288:0) + (shift?131072:0) + (alt?262144:0) + (meta?1048576:0);
  !$containsKey_0(keyMap, valueOf_0(gwtCode)) && keyCode >= 97 && keyCode <= 122 && (gwtCode += -32);
  return $containsKey_0(keyMap, valueOf_0(gwtCode))?dynamicCast($get_2(keyMap, valueOf_0(gwtCode)), 70):($clinit_506() , OTHER);
}

function EventWrapper(){
}

_ = EventWrapper_0.prototype = EventWrapper.prototype = new Object_0;
_.getClass$ = function getClass_297(){
  return Lorg_waveprotocol_wave_client_common_util_EventWrapper_2_classLit;
}
;
_.toString$ = function toString_29(){
  return asString(this.event_0);
}
;
_.castableTypeMap$ = {};
_.event_0 = null;
var keyMap;
--></script>
<script><!--
function $$init_35(this$static){
  var orderKey;
  $put(this$static, valueOf_0(9), ($clinit_506() , TAB));
  $put(this$static, valueOf_0(131081), SHIFT_TAB);
  $put(this$static, valueOf_0(32), SPACE);
  $put(this$static, valueOf_0(131104), SHIFT_SPACE);
  $put(this$static, valueOf_0(524320), CTRL_SPACE);
  $put(this$static, valueOf_0(655392), CTRL_SHIFT_SPACE);
  $put(this$static, valueOf_0(27), ESC);
  $put(this$static, valueOf_0(13), ENTER);
  $put(this$static, valueOf_0(131085), SHIFT_ENTER);
  $put(this$static, valueOf_0(524301), CTRL_ENTER);
  $put(this$static, valueOf_0(8), BACKSPACE);
  $put(this$static, valueOf_0(131080), SHIFT_BACKSPACE);
  $put(this$static, valueOf_0(46), DELETE);
  $put(this$static, valueOf_0(131118), SHIFT_DELETE);
  $put(this$static, valueOf_0(45), INSERT);
  $put(this$static, valueOf_0(131117), SHIFT_INSERT);
  $put(this$static, valueOf_0(524333), CTRL_INSERT);
  $put(this$static, valueOf_0(524349), CTRL_EQUALS);
  $put(this$static, valueOf_0(524354), CTRL_B);
  $put(this$static, valueOf_0(524356), CTRL_D);
  $put(this$static, valueOf_0(524358), CTRL_F);
  $put(this$static, valueOf_0(524361), CTRL_I);
  $put(this$static, valueOf_0(524359), CTRL_G);
  $put(this$static, valueOf_0(524360), CTRL_H);
  $put(this$static, valueOf_0(524363), CTRL_K);
  $put(this$static, valueOf_0(524367), CTRL_O);
  $put(this$static, valueOf_0(524373), CTRL_U);
  $put(this$static, valueOf_0(524375), CTRL_W);
  $put(this$static, valueOf_0(524353), CTRL_A);
  $put(this$static, valueOf_0(524370), CTRL_R);
  $put(this$static, valueOf_0(524357), CTRL_E);
  $put(this$static, valueOf_0(524364), CTRL_L);
  $put(this$static, valueOf_0(655436), CTRL_SHIFT_L);
  $put(this$static, valueOf_0(786502), CTRL_ALT_F);
  $put(this$static, valueOf_0(786500), CTRL_ALT_D);
  $put(this$static, valueOf_0(786503), CTRL_ALT_G);
  $put(this$static, valueOf_0(786515), CTRL_ALT_S);
  $put(this$static, valueOf_0(655393), CTRL_SHIFT_1);
  $put(this$static, valueOf_0(655409), CTRL_SHIFT_1);
  $put(this$static, valueOf_0(655424), CTRL_SHIFT_2);
  $put(this$static, valueOf_0(655410), CTRL_SHIFT_2);
  $put(this$static, valueOf_0(655395), CTRL_SHIFT_3);
  $put(this$static, valueOf_0(655411), CTRL_SHIFT_3);
  orderKey = ($clinit_539() , $clinit_539() , INSTANCE_3).isMac?1048576:524288;
  $put(this$static, valueOf_0(65 + orderKey), ORDER_A);
  $put(this$static, valueOf_0(66 + orderKey), ORDER_B);
  $put(this$static, valueOf_0(67 + orderKey), ORDER_C);
  $put(this$static, valueOf_0(68 + orderKey), ORDER_D);
  $put(this$static, valueOf_0(70 + orderKey), ORDER_F);
  $put(this$static, valueOf_0(71 + orderKey), ORDER_G);
  $put(this$static, valueOf_0(73 + orderKey), ORDER_I);
  $put(this$static, valueOf_0(75 + orderKey), ORDER_K);
  $put(this$static, valueOf_0(76 + orderKey), ORDER_L);
  $put(this$static, valueOf_0(78 + orderKey), ORDER_N);
  $put(this$static, valueOf_0(79 + orderKey), ORDER_O);
  $put(this$static, valueOf_0(80 + orderKey), ORDER_P);
  $put(this$static, valueOf_0(82 + orderKey), ORDER_R);
  $put(this$static, valueOf_0(84 + orderKey), ORDER_T);
  $put(this$static, valueOf_0(85 + orderKey), ORDER_U);
  $put(this$static, valueOf_0(86 + orderKey), ORDER_V);
  $put(this$static, valueOf_0(87 + orderKey), ORDER_W);
  $put(this$static, valueOf_0(88 + orderKey), ORDER_X);
  $put(this$static, valueOf_0(90 + orderKey), ORDER_Z);
  $put(this$static, valueOf_0(81 + orderKey), ORDER_Q);
  $put(this$static, valueOf_0(82 + orderKey + 131072), ORDER_SHIFT_R);
  $put(this$static, valueOf_0(86 + orderKey + 131072), ORDER_SHIFT_V);
  $put(this$static, valueOf_0(75 + orderKey + 131072), ORDER_SHIFT_K);
  $put(this$static, valueOf_0(86 | orderKey | 262144 | 131072), ORDER_ALT_SHIFT_V);
  $put(this$static, valueOf_0(40), DOWN);
  $put(this$static, valueOf_0(38), UP);
  $put(this$static, valueOf_0(37), LEFT_0);
  $put(this$static, valueOf_0(39), RIGHT_0);
  $put(this$static, valueOf_0(33), PAGE_UP);
  $put(this$static, valueOf_0(34), PAGE_DOWN);
  $put(this$static, valueOf_0(36), HOME);
  $put(this$static, valueOf_0(35), END);
  $put(this$static, valueOf_0(63233), DOWN);
  $put(this$static, valueOf_0(63232), UP);
  $put(this$static, valueOf_0(63234), LEFT_0);
  $put(this$static, valueOf_0(63235), RIGHT_0);
  $put(this$static, valueOf_0(63276), PAGE_UP);
  $put(this$static, valueOf_0(63277), PAGE_DOWN);
  $put(this$static, valueOf_0(63273), HOME);
  $put(this$static, valueOf_0(63275), END);
  $put(this$static, valueOf_0(1048613), META_LEFT);
  $put(this$static, valueOf_0(1048615), META_RIGHT);
  $put(this$static, valueOf_0(1048612), META_HOME);
}

function EventWrapper$1_0(){
  $clearImpl(this);
  $$init_35(this);
}

function EventWrapper$1(){
}

_ = EventWrapper$1_0.prototype = EventWrapper$1.prototype = new HashMap;
_.getClass$ = function getClass_298(){
  return Lorg_waveprotocol_wave_client_common_util_EventWrapper$1_2_classLit;
}
;
_.castableTypeMap$ = {26:1, 58:1};
function $clinit_506(){
  $clinit_506 = nullMethod;
  SPACE = new KeyCombo_0('SPACE', 0);
  SHIFT_SPACE = new KeyCombo_0('SHIFT_SPACE', 1);
  CTRL_SPACE = new KeyCombo_0('CTRL_SPACE', 2);
  CTRL_SHIFT_SPACE = new KeyCombo_0('CTRL_SHIFT_SPACE', 3);
  TAB = new KeyCombo_0('TAB', 4);
  SHIFT_TAB = new KeyCombo_0('SHIFT_TAB', 5);
  UP = new KeyCombo_0('UP', 6);
  DOWN = new KeyCombo_0('DOWN', 7);
  LEFT_0 = new KeyCombo_0('LEFT', 8);
  RIGHT_0 = new KeyCombo_0('RIGHT', 9);
  HOME = new KeyCombo_0('HOME', 10);
  END = new KeyCombo_0('END', 11);
  PAGE_UP = new KeyCombo_0('PAGE_UP', 12);
  PAGE_DOWN = new KeyCombo_0('PAGE_DOWN', 13);
  ESC = new KeyCombo_0('ESC', 14);
  ENTER = new KeyCombo_0('ENTER', 15);
  SHIFT_ENTER = new KeyCombo_0('SHIFT_ENTER', 16);
  CTRL_ENTER = new KeyCombo_0('CTRL_ENTER', 17);
  CTRL_EQUALS = new KeyCombo_0('CTRL_EQUALS', 18);
  CTRL_R = new KeyCombo_0('CTRL_R', 19);
  CTRL_E = new KeyCombo_0('CTRL_E', 20);
  BACKSPACE = new KeyCombo_0('BACKSPACE', 21);
  SHIFT_BACKSPACE = new KeyCombo_0('SHIFT_BACKSPACE', 22);
  DELETE = new KeyCombo_0('DELETE', 23);
  SHIFT_DELETE = new KeyCombo_0('SHIFT_DELETE', 24);
  INSERT = new KeyCombo_0('INSERT', 25);
  SHIFT_INSERT = new KeyCombo_0('SHIFT_INSERT', 26);
  CTRL_INSERT = new KeyCombo_0('CTRL_INSERT', 27);
  CTRL_B = new KeyCombo_0('CTRL_B', 28);
  CTRL_D = new KeyCombo_0('CTRL_D', 29);
  CTRL_H = new KeyCombo_0('CTRL_H', 30);
  CTRL_I = new KeyCombo_0('CTRL_I', 31);
  CTRL_G = new KeyCombo_0('CTRL_G', 32);
  CTRL_K = new KeyCombo_0('CTRL_K', 33);
  CTRL_U = new KeyCombo_0('CTRL_U', 34);
  CTRL_A = new KeyCombo_0('CTRL_A', 35);
  CTRL_L = new KeyCombo_0('CTRL_L', 36);
  CTRL_W = new KeyCombo_0('CTRL_W', 37);
  CTRL_SHIFT_L = new KeyCombo_0('CTRL_SHIFT_L', 38);
  CTRL_ALT_F = new KeyCombo_0('CTRL_ALT_F', 39);
  CTRL_ALT_D = new KeyCombo_0('CTRL_ALT_D', 40);
  ORDER_C = new KeyCombo_0('ORDER_C', 41);
  ORDER_X = new KeyCombo_0('ORDER_X', 42);
  ORDER_V = new KeyCombo_0('ORDER_V', 43);
  ORDER_Z = new KeyCombo_0('ORDER_Z', 44);
  CTRL_F = new KeyCombo_0('CTRL_F', 45);
  META_LEFT = new KeyCombo_0('META_LEFT', 46);
  META_RIGHT = new KeyCombo_0('META_RIGHT', 47);
  META_HOME = new KeyCombo_0('META_HOME', 48);
  ORDER_O = new KeyCombo_0('ORDER_O', 49);
  ORDER_R = new KeyCombo_0('ORDER_R', 50);
  ORDER_SHIFT_R = new KeyCombo_0('ORDER_SHIFT_R', 51);
  ORDER_SHIFT_V = new KeyCombo_0('ORDER_SHIFT_V', 52);
  ORDER_ALT_SHIFT_V = new KeyCombo_0('ORDER_ALT_SHIFT_V', 53);
  ORDER_FULLSTOP = new KeyCombo_0('ORDER_FULLSTOP', 54);
  ORDER_F = new KeyCombo_0('ORDER_F', 55);
  ORDER_G = new KeyCombo_0('ORDER_G', 56);
  ORDER_D = new KeyCombo_0('ORDER_D', 57);
  ORDER_N = new KeyCombo_0('ORDER_N', 58);
  CTRL_O = new KeyCombo_0('CTRL_O', 59);
  ORDER_T = new KeyCombo_0('ORDER_T', 60);
  ORDER_A = new KeyCombo_0('ORDER_A', 61);
  ORDER_P = new KeyCombo_0('ORDER_P', 62);
  CTRL_ALT_G = new KeyCombo_0('CTRL_ALT_G', 63);
  CTRL_ALT_S = new KeyCombo_0('CTRL_ALT_S', 64);
  ORDER_W = new KeyCombo_0('ORDER_W', 65);
  ORDER_Q = new KeyCombo_0('ORDER_Q', 66);
  ORDER_L = new KeyCombo_0('ORDER_L', 67);
  ORDER_K = new KeyCombo_0('ORDER_K', 68);
  ORDER_SHIFT_K = new KeyCombo_0('ORDER_SHIFT_K', 69);
  ORDER_B = new KeyCombo_0('ORDER_B', 70);
  ORDER_U = new KeyCombo_0('ORDER_U', 71);
  ORDER_I = new KeyCombo_0('ORDER_I', 72);
  CTRL_SHIFT_1 = new KeyCombo_0('CTRL_SHIFT_1', 73);
  CTRL_SHIFT_2 = new KeyCombo_0('CTRL_SHIFT_2', 74);
  CTRL_SHIFT_3 = new KeyCombo_0('CTRL_SHIFT_3', 75);
  OTHER = new KeyCombo_0('OTHER', 76);
  $VALUES_11 = initValues(_3Lorg_waveprotocol_wave_client_common_util_KeyCombo_2_classLit, {58:1, 138:1}, 70, [SPACE, SHIFT_SPACE, CTRL_SPACE, CTRL_SHIFT_SPACE, TAB, SHIFT_TAB, UP, DOWN, LEFT_0, RIGHT_0, HOME, END, PAGE_UP, PAGE_DOWN, ESC, ENTER, SHIFT_ENTER, CTRL_ENTER, CTRL_EQUALS, CTRL_R, CTRL_E, BACKSPACE, SHIFT_BACKSPACE, DELETE, SHIFT_DELETE, INSERT, SHIFT_INSERT, CTRL_INSERT, CTRL_B, CTRL_D, CTRL_H, CTRL_I, CTRL_G, CTRL_K, CTRL_U, CTRL_A, CTRL_L, CTRL_W, CTRL_SHIFT_L, CTRL_ALT_F, CTRL_ALT_D, ORDER_C, ORDER_X, ORDER_V, ORDER_Z, CTRL_F, META_LEFT, META_RIGHT, META_HOME, ORDER_O, ORDER_R, ORDER_SHIFT_R, ORDER_SHIFT_V, ORDER_ALT_SHIFT_V, ORDER_FULLSTOP, ORDER_F, ORDER_G, ORDER_D, ORDER_N, CTRL_O, ORDER_T, ORDER_A, ORDER_P, CTRL_ALT_G, CTRL_ALT_S, ORDER_W, ORDER_Q, ORDER_L, ORDER_K, ORDER_SHIFT_K, ORDER_B, ORDER_U, ORDER_I, CTRL_SHIFT_1, CTRL_SHIFT_2, CTRL_SHIFT_3, OTHER]);
}

function KeyCombo_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_12(){
  $clinit_506();
  return $VALUES_11;
}

function KeyCombo(){
}

_ = KeyCombo_0.prototype = KeyCombo.prototype = new Enum;
_.getClass$ = function getClass_299(){
  return Lorg_waveprotocol_wave_client_common_util_KeyCombo_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 70:1};
var $VALUES_11, BACKSPACE, CTRL_A, CTRL_ALT_D, CTRL_ALT_F, CTRL_ALT_G, CTRL_ALT_S, CTRL_B, CTRL_D, CTRL_E, CTRL_ENTER, CTRL_EQUALS, CTRL_F, CTRL_G, CTRL_H, CTRL_I, CTRL_INSERT, CTRL_K, CTRL_L, CTRL_O, CTRL_R, CTRL_SHIFT_1, CTRL_SHIFT_2, CTRL_SHIFT_3, CTRL_SHIFT_L, CTRL_SHIFT_SPACE, CTRL_SPACE, CTRL_U, CTRL_W, DELETE, DOWN, END, ENTER, ESC, HOME, INSERT, LEFT_0, META_HOME, META_LEFT, META_RIGHT, ORDER_A, ORDER_ALT_SHIFT_V, ORDER_B, ORDER_C, ORDER_D, ORDER_F, ORDER_FULLSTOP, ORDER_G, ORDER_I, ORDER_K, ORDER_L, ORDER_N, ORDER_O, ORDER_P, ORDER_Q, ORDER_R, ORDER_SHIFT_K, ORDER_SHIFT_R, ORDER_SHIFT_V, ORDER_T, ORDER_U, ORDER_V, ORDER_W, ORDER_X, ORDER_Z, OTHER, PAGE_DOWN, PAGE_UP, RIGHT_0, SHIFT_BACKSPACE, SHIFT_DELETE, SHIFT_ENTER, SHIFT_INSERT, SHIFT_SPACE, SHIFT_TAB, SPACE, TAB, UP;
function $clear_8(this$static){
  while ($getUsable(this$static, this$static.first)) {
    $remove_18(this$static, this$static.first.key);
  }
}

function $emptyPut(this$static, key, value){
  var node;
  node = new LinkedPruningSequenceMap$Node_0(this$static, key, value);
  this$static.first = this$static.last = this$static.recent = node;
  this$static.recent.next = this$static.recent;
  this$static.recent.prev = this$static.recent;
  ++this$static.size;
}

function $findBefore(this$static, key){
  var cmpNext, cmpPrev, next, search;
  if (!key) {
    throw new IllegalArgumentException_1('key is null');
  }
  search = $getUsable(this$static, this$static.recent);
  if (!search) {
    return null;
  }
  while (true) {
    cmpPrev = $compare_2(search.key, key);
    if (cmpPrev <= 0) {
      if (this$static.last == search || cmpPrev == 0) {
        return search;
      }
      next = $getNext(search);
      cmpNext = $compare_2(next.key, key);
      if (cmpNext > 0) {
        return search;
      }
      search = $getNext(search);
    }
     else {
      if (this$static.first == search) {
        return null;
      }
      search = $getPrev(search);
    }
  }
}

function $getElement(this$static, key){
  var prev;
  prev = $findBefore(this$static, key);
  if (!prev) {
    return this$static.first;
  }
  return $compare_2(prev.key, key) == 0?prev:null;
}

function $getFirst(this$static){
  return $getUsable(this$static, this$static.first);
}

function $getUsable(this$static, node){
  if (!!node && !$isContentAttached(node.key)) {
    if (node == this$static.last) {
      node = $getNext(node);
      !!node && (node = $getPrev(node));
    }
     else {
      node = $getPrev(node);
      !!node && (node = $getNext(node));
    }
  }
  return node;
}

function $isLast(this$static, elt){
  return elt == this$static.last;
}

function $put_1(this$static, key, value){
  var node, old, prev, next;
  old = null;
  if (this$static.size == 0) {
    $emptyPut(this$static, key, value);
  }
   else {
    prev = $findBefore(this$static, key);
    if (this$static.size == 0) {
      $emptyPut(this$static, key, value);
    }
     else {
      if (!prev || $compare_2(key, prev.key) != 0) {
        node = new LinkedPruningSequenceMap$Node_0(this$static, key, value);
        prev == this$static.last && (this$static.last = node);
        if (!prev) {
          prev = this$static.last;
          this$static.first = node;
        }
        next = $getNext(prev);
        node.prev = prev;
        node.next = next;
        prev.next = node;
        next.prev = node;
        ++this$static.size;
      }
       else {
        old = prev.value_0;
        prev.value_0 = value;
      }
    }
  }
  return old;
}

function $remove_18(this$static, key){
  var node, val;
  val = null;
  if (!$isContentAttached(key)) {
    return null;
  }
  node = $findBefore(this$static, key);
  if (!!node && $compare_2(key, node.key) == 0) {
    val = node.value_0;
    $remove_19(this$static, node);
  }
  return val;
}

function $remove_19(this$static, node){
  var next, prev;
  prev = node.prev;
  next = node.next;
  prev.next = next;
  next.prev = prev;
  node.next = node.prev = null;
  this$static.recent == node && (this$static.recent = prev);
  if (this$static.first == node && this$static.last == node) {
    this$static.first = null;
    this$static.last = null;
    this$static.recent = null;
  }
   else {
    this$static.first == node && (this$static.first = next);
    this$static.last == node && (this$static.last = prev);
  }
  --this$static.size;
}

function LinkedPruningSequenceMap_0(cmp){
}

function LinkedPruningSequenceMap(){
}

_ = LinkedPruningSequenceMap_0.prototype = LinkedPruningSequenceMap.prototype = new Object_0;
_.getClass$ = function getClass_300(){
  return Lorg_waveprotocol_wave_client_common_util_LinkedPruningSequenceMap_2_classLit;
}
;
_.castableTypeMap$ = {};
_.first = null;
_.last = null;
_.recent = null;
_.size = 0;
function $compare_2(o1, o2){
  return dynamicCast(o1, 145).compareTo$(dynamicCast(o2, 145));
}

function LinkedPruningSequenceMap$1_0(){
}

function LinkedPruningSequenceMap$1(){
}

_ = LinkedPruningSequenceMap$1_0.prototype = LinkedPruningSequenceMap$1.prototype = new Object_0;
_.compare = function compare_3(o1, o2){
  return dynamicCast(o1, 145).compareTo$(dynamicCast(o2, 145));
}
;
_.getClass$ = function getClass_301(){
  return Lorg_waveprotocol_wave_client_common_util_LinkedPruningSequenceMap$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function $getNext(this$static){
  while (!!this$static.next && !$isContentAttached(this$static.next.key)) {
    $remove_19(this$static.this$0, this$static.next);
  }
  return this$static.next;
}

function $getPrev(this$static){
  while (!!this$static.prev && !$isContentAttached(this$static.prev.key)) {
    $remove_19(this$static.this$0, this$static.prev);
  }
  return this$static.prev;
}

function LinkedPruningSequenceMap$Node_0(this$0, key, value){
  this.this$0 = this$0;
  this.key = key;
  this.value_0 = value;
}

function LinkedPruningSequenceMap$Node(){
}

_ = LinkedPruningSequenceMap$Node_0.prototype = LinkedPruningSequenceMap$Node.prototype = new Object_0;
_.getClass$ = function getClass_302(){
  return Lorg_waveprotocol_wave_client_common_util_LinkedPruningSequenceMap$Node_2_classLit;
}
;
_.castableTypeMap$ = {};
_.key = null;
_.next = null;
_.prev = null;
_.this$0 = null;
_.value_0 = null;
function LogicalPanel$Impl(){
}

_ = LogicalPanel$Impl.prototype = new ComplexPanel;
_.doAdopt = function doAdopt(child){
  checkArgument_0(!!child && !child.parent_0, 'Not an orphan');
  $add_7(this.children_0, child);
  $setParent(child, this);
}
;
_.doOrphan = function doOrphan(child){
  checkArgument_0(!!child && child.parent_0 == this, 'Not a child');
  $setParent(child, null);
  $remove_4(this.children_0, child);
}
;
_.getClass$ = function getClass_303(){
  return Lorg_waveprotocol_wave_client_common_util_LogicalPanel$Impl_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1, 135:1, 201:1};
function $clinit_515(){
  $clinit_515 = nullMethod;
  LIES_ABOUT_CARET_AT_LINK_END_BOUNDARY = ($clinit_539() , $clinit_539() , INSTANCE_3).version >= 528 * 1000 + 0;
  HAS_OLD_SCHOOL_CLIPBOARD_SHORTCUTS = INSTANCE_3.isWin || INSTANCE_3.isLinux;
  COMMAND_COMBO_DOESNT_GIVE_KEYPRESS = INSTANCE_3.isMac && INSTANCE_3.isChrome;
  SUPPORTS_GET_ELEMENTS_BY_CLASSNAME = !!document.body.getElementsByClassName;
  SUPPORTS_COMPOSITION_EVENTS = INSTANCE_3.version >= 532 * 1000 + 5;
}

var COMMAND_COMBO_DOESNT_GIVE_KEYPRESS, HAS_OLD_SCHOOL_CLIPBOARD_SHORTCUTS, LIES_ABOUT_CARET_AT_LINK_END_BOUNDARY, SUPPORTS_COMPOSITION_EVENTS, SUPPORTS_GET_ELEMENTS_BY_CLASSNAME;
function $clinit_519(){
  $clinit_519 = nullMethod;
  NONE_1 = new SignalEvent$KeyModifier$1_0;
  SHIFT = new SignalEvent$KeyModifier$2_0;
  CTRL = new SignalEvent$KeyModifier$3_0;
  ALT = new SignalEvent$KeyModifier$4_0;
  META = new SignalEvent$KeyModifier$5_0;
  COMMAND = new SignalEvent$KeyModifier$6_0;
  CTRL_ALT = new SignalEvent$KeyModifier$7_0;
  COMMAND_SHIFT = new SignalEvent$KeyModifier$8_0;
  $VALUES_12 = initValues(_3Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeyModifier_2_classLit, {58:1, 138:1}, 71, [NONE_1, SHIFT, CTRL, ALT, META, COMMAND, CTRL_ALT, COMMAND_SHIFT]);
  COMMAND_IS_CTRL = !($clinit_539() , $clinit_539() , INSTANCE_3).isMac;
}

function values_13(){
  $clinit_519();
  return $VALUES_12;
}

function SignalEvent$KeyModifier(){
}

_ = SignalEvent$KeyModifier.prototype = new Enum;
_.getClass$ = function getClass_304(){
  return Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeyModifier_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 71:1};
var $VALUES_12, ALT, COMMAND, COMMAND_IS_CTRL, COMMAND_SHIFT, CTRL, CTRL_ALT, META, NONE_1, SHIFT;
function $check(event_0){
  return !event_0.nativeEvent.shiftKey && !event_0.nativeEvent.altKey && !event_0.nativeEvent.ctrlKey && !event_0.nativeEvent.metaKey;
}

function SignalEvent$KeyModifier$1_0(){
  this.name_0 = 'NONE';
  this.ordinal = 0;
}

function SignalEvent$KeyModifier$1(){
}

_ = SignalEvent$KeyModifier$1_0.prototype = SignalEvent$KeyModifier$1.prototype = new SignalEvent$KeyModifier;
_.check = function check_0(event_0){
  return !event_0.nativeEvent.shiftKey && !event_0.nativeEvent.altKey && !event_0.nativeEvent.ctrlKey && !event_0.nativeEvent.metaKey;
}
;
_.getClass$ = function getClass_305(){
  return Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeyModifier$1_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 71:1};
function $check_0(event_0){
  return !!event_0.nativeEvent.shiftKey && !event_0.nativeEvent.altKey && !event_0.nativeEvent.ctrlKey && !event_0.nativeEvent.metaKey;
}

function SignalEvent$KeyModifier$2_0(){
  this.name_0 = 'SHIFT';
  this.ordinal = 1;
}

function SignalEvent$KeyModifier$2(){
}

_ = SignalEvent$KeyModifier$2_0.prototype = SignalEvent$KeyModifier$2.prototype = new SignalEvent$KeyModifier;
_.check = function check_1(event_0){
  return !!event_0.nativeEvent.shiftKey && !event_0.nativeEvent.altKey && !event_0.nativeEvent.ctrlKey && !event_0.nativeEvent.metaKey;
}
;
_.getClass$ = function getClass_306(){
  return Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeyModifier$2_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 71:1};
function $check_1(event_0){
  return !event_0.nativeEvent.shiftKey && !event_0.nativeEvent.altKey && !!event_0.nativeEvent.ctrlKey && !event_0.nativeEvent.metaKey;
}

function SignalEvent$KeyModifier$3_0(){
  this.name_0 = 'CTRL';
  this.ordinal = 2;
}

function SignalEvent$KeyModifier$3(){
}

_ = SignalEvent$KeyModifier$3_0.prototype = SignalEvent$KeyModifier$3.prototype = new SignalEvent$KeyModifier;
_.check = function check_2(event_0){
  return !event_0.nativeEvent.shiftKey && !event_0.nativeEvent.altKey && !!event_0.nativeEvent.ctrlKey && !event_0.nativeEvent.metaKey;
}
;
_.getClass$ = function getClass_307(){
  return Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeyModifier$3_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 71:1};
function SignalEvent$KeyModifier$4_0(){
  this.name_0 = 'ALT';
  this.ordinal = 3;
}

function SignalEvent$KeyModifier$4(){
}

_ = SignalEvent$KeyModifier$4_0.prototype = SignalEvent$KeyModifier$4.prototype = new SignalEvent$KeyModifier;
_.check = function check_3(event_0){
  return !event_0.nativeEvent.shiftKey && !!event_0.nativeEvent.altKey && !event_0.nativeEvent.ctrlKey && !event_0.nativeEvent.metaKey;
}
;
_.getClass$ = function getClass_308(){
  return Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeyModifier$4_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 71:1};
function SignalEvent$KeyModifier$5_0(){
  this.name_0 = 'META';
  this.ordinal = 4;
}

function SignalEvent$KeyModifier$5(){
}

_ = SignalEvent$KeyModifier$5_0.prototype = SignalEvent$KeyModifier$5.prototype = new SignalEvent$KeyModifier;
_.check = function check_4(event_0){
  return !event_0.nativeEvent.shiftKey && !event_0.nativeEvent.altKey && !event_0.nativeEvent.ctrlKey && !!event_0.nativeEvent.metaKey;
}
;
_.getClass$ = function getClass_309(){
  return Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeyModifier$5_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 71:1};
function SignalEvent$KeyModifier$6_0(){
  this.name_0 = 'COMMAND';
  this.ordinal = 5;
}

function SignalEvent$KeyModifier$6(){
}

_ = SignalEvent$KeyModifier$6_0.prototype = SignalEvent$KeyModifier$6.prototype = new SignalEvent$KeyModifier;
_.check = function check_5(event_0){
  return COMMAND_IS_CTRL?$check_1(event_0):!event_0.nativeEvent.shiftKey && !event_0.nativeEvent.altKey && !event_0.nativeEvent.ctrlKey && !!event_0.nativeEvent.metaKey;
}
;
_.getClass$ = function getClass_310(){
  return Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeyModifier$6_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 71:1};
function SignalEvent$KeyModifier$7_0(){
  this.name_0 = 'CTRL_ALT';
  this.ordinal = 6;
}

function SignalEvent$KeyModifier$7(){
}

_ = SignalEvent$KeyModifier$7_0.prototype = SignalEvent$KeyModifier$7.prototype = new SignalEvent$KeyModifier;
_.check = function check_6(event_0){
  return !event_0.nativeEvent.shiftKey && !!event_0.nativeEvent.altKey && !!event_0.nativeEvent.ctrlKey && !event_0.nativeEvent.metaKey;
}
;
_.getClass$ = function getClass_311(){
  return Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeyModifier$7_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 71:1};
function SignalEvent$KeyModifier$8_0(){
  this.name_0 = 'COMMAND_SHIFT';
  this.ordinal = 7;
}

function SignalEvent$KeyModifier$8(){
}

_ = SignalEvent$KeyModifier$8_0.prototype = SignalEvent$KeyModifier$8.prototype = new SignalEvent$KeyModifier;
_.check = function check_7(event_0){
  var notCommandKey;
  notCommandKey = COMMAND_IS_CTRL?!!event_0.nativeEvent.metaKey:!!event_0.nativeEvent.ctrlKey;
  return !!event_0.nativeEvent.shiftKey && !event_0.nativeEvent.altKey && (($clinit_530() , logic_0).commandIsCtrl?!!event_0.nativeEvent.ctrlKey:!!event_0.nativeEvent.metaKey) && !notCommandKey;
}
;
_.getClass$ = function getClass_312(){
  return Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeyModifier$8_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 71:1};
function $clinit_528(){
  $clinit_528 = nullMethod;
  INPUT = new SignalEvent$KeySignalType_0('INPUT', 0);
  NAVIGATION = new SignalEvent$KeySignalType_0('NAVIGATION', 1);
  DELETE_0 = new SignalEvent$KeySignalType_0('DELETE', 2);
  NOEFFECT = new SignalEvent$KeySignalType_0('NOEFFECT', 3);
  SENTINAL = new SignalEvent$KeySignalType_0('SENTINAL', 4);
  $VALUES_13 = initValues(_3Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeySignalType_2_classLit, {58:1, 138:1}, 72, [INPUT, NAVIGATION, DELETE_0, NOEFFECT, SENTINAL]);
}

function SignalEvent$KeySignalType_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_14(){
  $clinit_528();
  return $VALUES_13;
}

function SignalEvent$KeySignalType(){
}

_ = SignalEvent$KeySignalType_0.prototype = SignalEvent$KeySignalType.prototype = new Enum;
_.getClass$ = function getClass_313(){
  return Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeySignalType_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 72:1};
var $VALUES_13, DELETE_0, INPUT, NAVIGATION, NOEFFECT, SENTINAL;
function $clinit_529(){
  $clinit_529 = nullMethod;
  CHARACTER = new SignalEvent$MoveUnit_0('CHARACTER', 0);
  WORD = new SignalEvent$MoveUnit_0('WORD', 1);
  LINE = new SignalEvent$MoveUnit_0('LINE', 2);
  PAGE = new SignalEvent$MoveUnit_0('PAGE', 3);
  DOCUMENT = new SignalEvent$MoveUnit_0('DOCUMENT', 4);
  $VALUES_14 = initValues(_3Lorg_waveprotocol_wave_client_common_util_SignalEvent$MoveUnit_2_classLit, {58:1, 138:1}, 73, [CHARACTER, WORD, LINE, PAGE, DOCUMENT]);
}

function SignalEvent$MoveUnit_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_15(){
  $clinit_529();
  return $VALUES_14;
}

function SignalEvent$MoveUnit(){
}

_ = SignalEvent$MoveUnit_0.prototype = SignalEvent$MoveUnit.prototype = new Enum;
_.getClass$ = function getClass_314(){
  return Lorg_waveprotocol_wave_client_common_util_SignalEvent$MoveUnit_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 73:1};
var $VALUES_14, CHARACTER, DOCUMENT, LINE, PAGE, WORD;
function $clinit_530(){
  $clinit_530 = nullMethod;
  var a_0, e, e$array, e$index, e$max, i, m_0;
  DEFAULT_FACTORY = new SignalEventImpl$1_0;
  currentUserAgent = ($clinit_538() , WEBKIT);
  currentOs = ($clinit_539() , $clinit_539() , INSTANCE_3).isWin?($clinit_536() , WINDOWS):INSTANCE_3.isMac?($clinit_536() , MAC):($clinit_536() , LINUX);
  logic_0 = new SignalKeyLogic_0(currentUserAgent, currentOs, ($clinit_515() , COMMAND_COMBO_DOESNT_GIVE_KEYPRESS));
  shiftMappings = initDim(_3I_classLit, {58:1}, -1, 128, 1);
  for (a_0 = 65; a_0 <= 90; ++a_0) {
    shiftMappings[a_0] = a_0 + 97 - 65;
  }
  shiftMappings[49] = 33;
  shiftMappings[50] = 64;
  shiftMappings[51] = 35;
  shiftMappings[52] = 36;
  shiftMappings[53] = 37;
  shiftMappings[54] = 94;
  shiftMappings[55] = 38;
  shiftMappings[56] = 42;
  shiftMappings[57] = 40;
  shiftMappings[48] = 41;
  shiftMappings[96] = 126;
  shiftMappings[45] = 95;
  shiftMappings[61] = 43;
  shiftMappings[91] = 123;
  shiftMappings[93] = 125;
  shiftMappings[92] = 124;
  shiftMappings[59] = 58;
  shiftMappings[39] = 34;
  shiftMappings[44] = 60;
  shiftMappings[46] = 62;
  shiftMappings[47] = 63;
  for (i = 1; i < shiftMappings.length; ++i) {
    m_0 = shiftMappings[i];
    m_0 > 0 && (shiftMappings[m_0] = i);
  }
  KEY_EVENTS = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringSetAdapter_0(new HashSet_0));
  COMPOSITION_EVENTS = new CollectionUtils$StringSetAdapter_0(new HashSet_0);
  MOUSE_EVENTS = new CollectionUtils$StringSetAdapter_0(new HashSet_0);
  MOUSE_BUTTON_EVENTS = new CollectionUtils$StringSetAdapter_0(new HashSet_0);
  MOUSE_BUTTONLESS_EVENTS = new CollectionUtils$StringSetAdapter_0(new HashSet_0);
  FOCUS_EVENTS = new CollectionUtils$StringSetAdapter_0(new HashSet_0);
  CLIPBOARD_EVENTS = new CollectionUtils$StringSetAdapter_0(new HashSet_0);
  CANCEL_BUBBLE_QUIRKS = new CollectionUtils$StringSetAdapter_0(new HashSet_0);
  for (e$array = initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['keydown', 'keypress', 'keyup']) , e$index = 0 , e$max = e$array.length; e$index < e$max; ++e$index) {
    e = e$array[e$index];
    $add_20(KEY_EVENTS, e);
  }
  for (e$array = initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['compositionstart', 'compositionend', 'compositionupdate', 'text']) , e$index = 0 , e$max = e$array.length; e$index < e$max; ++e$index) {
    e = e$array[e$index];
    $add_20(COMPOSITION_EVENTS, e);
    $add_20(CANCEL_BUBBLE_QUIRKS, e);
  }
  $add_20(COMPOSITION_EVENTS, 'textInput');
  $add_20(CANCEL_BUBBLE_QUIRKS, 'contextmenu');
  for (e$array = initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['mousewheel', 'DOMMouseScroll', 'mousemove', 'mouseover', 'mouseout', 'contextmenu']) , e$index = 0 , e$max = e$array.length; e$index < e$max; ++e$index) {
    e = e$array[e$index];
    $add_20(MOUSE_BUTTONLESS_EVENTS, e);
    $add_20(MOUSE_EVENTS, e);
  }
  for (e$array = initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['mousedown', 'mouseup', 'click', 'dblclick']) , e$index = 0 , e$max = e$array.length; e$index < e$max; ++e$index) {
    e = e$array[e$index];
    $add_20(MOUSE_BUTTON_EVENTS, e);
    $add_20(MOUSE_EVENTS, e);
  }
  for (e$array = initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['focus', 'blur', 'beforeeditfocus']) , e$index = 0 , e$max = e$array.length; e$index < e$max; ++e$index) {
    e = e$array[e$index];
    $add_20(FOCUS_EVENTS, e);
  }
  for (e$array = initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['cut', 'copy', 'paste']) , e$index = 0 , e$max = e$array.length; e$index < e$max; ++e$index) {
    e = e$array[e$index];
    $add_20(CLIPBOARD_EVENTS, e);
    $add_20(CLIPBOARD_EVENTS, 'before' + e);
  }
  computeKeySignalTypeResult = new SignalKeyLogic$Result_0;
}

--></script>
<script><!--
function $isCombo(this$static, letter, modifier){
  var keyCode;
  keyCode = this$static.cachedKeyCode;
  if (keyCode >= shiftMappings.length) {
    return false;
  }
  return (letter == keyCode || letter == shiftMappings[keyCode]) && modifier.check(this$static);
}

function $isRedoCombo(this$static){
  if ((($clinit_539() , $clinit_539() , INSTANCE_3).isMac || INSTANCE_3.isLinux) && $isCombo(this$static, 90, ($clinit_519() , COMMAND_SHIFT))) {
    return true;
  }
  return !INSTANCE_3.isMac && $isCombo(this$static, 89, ($clinit_519() , COMMAND));
}

function SignalEventImpl_0(){
  $clinit_530();
}

function create_6(factory, event_0, cancelBubbleIfNullified){
  var existing;
  $clinit_530();
  var signal;
  if (existing = dynamicCast(event_0['$se'], 146) , !!existing && existing.hasBeenConsumed) {
    return null;
  }
   else {
    signal = createInner(factory, event_0);
    cancelBubbleIfNullified && !signal && (event_0.stopPropagation() , undefined);
    return signal;
  }
}

function createInner(factory, event_0){
  var keyIdentifier, keySignalResult, signal;
  if ($contains_7(KEY_EVENTS, event_0.type)) {
    keySignalResult = computeKeySignalTypeResult;
    keyIdentifier = event_0.keyIdentifier;
    $computeKeySignalType(logic_0, keySignalResult, event_0.type, event_0.keyCode || 0, event_0.which || 0, keyIdentifier, !!event_0.metaKey, !!event_0.ctrlKey, !!event_0.altKey, !!event_0.shiftKey);
  }
   else {
    keySignalResult = null;
  }
  return createInner_0((signal = factory.create() , event_0['$se'] = signal , signal), event_0, keySignalResult);
}

function createInner_0(ret, event_0, keySignalResult){
  var type;
  ret.nativeEvent = event_0;
  if ($contains_7(KEY_EVENTS, ret.nativeEvent.type)) {
    type = keySignalResult.type_0;
    if (type) {
      ret.cachedKeyCode = keySignalResult.keyCode_0;
      ret.keySignalType = type;
    }
     else {
      ret = null;
    }
  }
   else 
    $equals_3('beforepaste', event_0.type) && (ret = null);
  return ret;
}

function SignalEventImpl(){
}

_ = SignalEventImpl_0.prototype = SignalEventImpl.prototype = new Object_0;
_.getClass$ = function getClass_315(){
  return Lorg_waveprotocol_wave_client_common_util_SignalEventImpl_2_classLit;
}
;
_.castableTypeMap$ = {146:1};
_.cachedKeyCode = -1;
_.hasBeenConsumed = false;
_.keySignalType = null;
_.nativeEvent = null;
var CANCEL_BUBBLE_QUIRKS, CLIPBOARD_EVENTS, COMPOSITION_EVENTS, DEFAULT_FACTORY, FOCUS_EVENTS, KEY_EVENTS, MOUSE_BUTTONLESS_EVENTS, MOUSE_BUTTON_EVENTS, MOUSE_EVENTS, computeKeySignalTypeResult, currentOs, currentUserAgent, logic_0, shiftMappings;
function SignalEventImpl$1_0(){
}

function SignalEventImpl$1(){
}

_ = SignalEventImpl$1_0.prototype = SignalEventImpl$1.prototype = new Object_0;
_.create = function create_7(){
  return new SignalEventImpl_0;
}
;
_.getClass$ = function getClass_316(){
  return Lorg_waveprotocol_wave_client_common_util_SignalEventImpl$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_534(){
  $clinit_534 = nullMethod;
  NAVIGATION_KEYS = new HashSet_0;
  NAVIGATION_KEY_IDENTIFIERS = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  $put_5(NAVIGATION_KEY_IDENTIFIERS, 'Left', valueOf_0(37));
  $put_5(NAVIGATION_KEY_IDENTIFIERS, 'Right', valueOf_0(39));
  $put_5(NAVIGATION_KEY_IDENTIFIERS, 'Up', valueOf_0(38));
  $put_5(NAVIGATION_KEY_IDENTIFIERS, 'Down', valueOf_0(40));
  $put_5(NAVIGATION_KEY_IDENTIFIERS, 'PageUp', valueOf_0(33));
  $put_5(NAVIGATION_KEY_IDENTIFIERS, 'PageDown', valueOf_0(34));
  $put_5(NAVIGATION_KEY_IDENTIFIERS, 'Home', valueOf_0(36));
  $put_5(NAVIGATION_KEY_IDENTIFIERS, 'End', valueOf_0(35));
  $each_2(NAVIGATION_KEY_IDENTIFIERS, new SignalKeyLogic$1_0);
}

function $computeKeySignalType(this$static, result, typeName, keyCode, which, keyIdentifier, metaKey, ctrlKey, altKey, shiftKey){
  var commandKey, computedKeyCode, hasKeyCodeButNotWhich, hasModifiersThatResultInNoKeyPress, isActuallyCtrlInput, isIME, isKeydownForInputKey, ret, startsWithUPlus, type, typeInt;
  ret = true;
  if ($equals_3('keydown', typeName)) {
    typeInt = 128;
  }
   else if ($equals_3('keypress', typeName)) {
    typeInt = 256;
  }
   else if ($equals_3('keyup', typeName)) {
    result.type_0 = null;
    return;
  }
   else {
    throw new AssertionError_0('Non-key-event passed to computeKeySignalType');
  }
  computedKeyCode = which != 0?which:keyCode;
  computedKeyCode == 10 && (computedKeyCode = 13);
  isIME = computedKeyCode == 229;
  commandKey = this$static.commandIsCtrl?ctrlKey:metaKey;
  switch (this$static.userAgent_0.ordinal) {
    case 0:
      if (typeInt == 128 && computedKeyCode > 63200) {
        result.type_0 = null;
        return;
      }
       else if (typeInt == 256) {
        if (computedKeyCode == 27 || computedKeyCode == 9) {
          result.type_0 = null;
          return;
        }
      }

      isActuallyCtrlInput = false;
      startsWithUPlus = keyIdentifier != null && keyIdentifier.indexOf('U+') == 0;
      if (isIME) {
        type = ($clinit_528() , INPUT);
      }
       else if ($equals_3('U+007F', keyIdentifier) || computedKeyCode == 8) {
        type = ($clinit_528() , DELETE_0);
      }
       else if ($containsKey_5(NAVIGATION_KEY_IDENTIFIERS, keyIdentifier)) {
        type = ($clinit_528() , NAVIGATION);
      }
       else if (computedKeyCode == 27 || $equals_3('U+0010', keyIdentifier)) {
        type = ($clinit_528() , NOEFFECT);
      }
       else if (computedKeyCode < 63200 && (typeInt == 256 || startsWithUPlus || computedKeyCode == 13)) {
        type = ($clinit_528() , INPUT);
        isActuallyCtrlInput = ctrlKey || this$static.commandComboDoesntGiveKeypress && commandKey;
      }
       else {
        type = ($clinit_528() , NOEFFECT);
      }

      isActuallyCtrlInput?computedKeyCode == 13 && (ret = typeInt == 128):isIME || keyCode == 9?(ret = typeInt == 128):(ret = maybeNullWebkitIE(typeInt, type));
      if (!ret) {
        result.type_0 = null;
        return;
      }

      break;
    case 1:
      hasKeyCodeButNotWhich = keyCode != 0 && which == 0;
      if (ctrlKey && !altKey && !shiftKey && computedKeyCode == 32) {
        if (typeInt != 128) {
          result.type_0 = null;
          return;
        }
      }
       else if (typeInt == 128) {
        result.type_0 = null;
        return;
      }

      computedKeyCode == 8?(type = ($clinit_528() , DELETE_0)):!hasKeyCodeButNotWhich || computedKeyCode == 13 || computedKeyCode == 9?(type = ($clinit_528() , INPUT)):computedKeyCode == 46?(type = ($clinit_528() , DELETE_0)):NAVIGATION_KEYS.map.containsKey(valueOf_0(computedKeyCode))?(type = ($clinit_528() , NAVIGATION)):(type = ($clinit_528() , NOEFFECT));
      break;
    case 2:
      isKeydownForInputKey = computedKeyCode == 9 || computedKeyCode == 32 || computedKeyCode == 13 || computedKeyCode >= 48 && computedKeyCode < 91 || computedKeyCode >= 96 && computedKeyCode < 112 || computedKeyCode >= 186;
      hasModifiersThatResultInNoKeyPress = altKey || ctrlKey && !shiftKey;
      if (typeInt == 128) {
        isKeydownForInputKey?(type = ($clinit_528() , INPUT)):computedKeyCode == 8 || computedKeyCode == 46?(type = ($clinit_528() , DELETE_0)):NAVIGATION_KEYS.map.containsKey(valueOf_0(computedKeyCode))?(type = ($clinit_528() , NAVIGATION)):(type = ($clinit_528() , NOEFFECT));
      }
       else {
        if (computedKeyCode == 27) {
          result.type_0 = null;
          return;
        }
        type = ($clinit_528() , INPUT);
      }

      hasModifiersThatResultInNoKeyPress || isIME || computedKeyCode == 9?(ret = typeInt == 128):(ret = maybeNullWebkitIE(typeInt, type));
      if (!ret) {
        result.type_0 = null;
        return;
      }

      break;
    default:throw new UnsupportedOperationException_1('Unhandled user agent');
  }
  if (ret) {
    result.type_0 = type;
    result.keyCode_0 = computedKeyCode;
  }
   else {
    result.type_0 = null;
    return;
  }
}

function SignalKeyLogic_0(userAgent, os, commandComboDoesntGiveKeypress){
  $clinit_534();
  this.userAgent_0 = userAgent;
  this.commandComboDoesntGiveKeypress = commandComboDoesntGiveKeypress;
  this.commandIsCtrl = os != ($clinit_536() , MAC);
}

function maybeNullWebkitIE(typeInt, type){
  if (typeInt == (type == ($clinit_528() , INPUT)?128:256)) {
    return false;
  }
  return true;
}

function SignalKeyLogic(){
}

_ = SignalKeyLogic_0.prototype = SignalKeyLogic.prototype = new Object_0;
_.getClass$ = function getClass_317(){
  return Lorg_waveprotocol_wave_client_common_util_SignalKeyLogic_2_classLit;
}
;
_.castableTypeMap$ = {};
_.commandComboDoesntGiveKeypress = false;
_.commandIsCtrl = false;
_.userAgent_0 = null;
var NAVIGATION_KEYS, NAVIGATION_KEY_IDENTIFIERS;
function SignalKeyLogic$1_0(){
}

function SignalKeyLogic$1(){
}

_ = SignalKeyLogic$1_0.prototype = SignalKeyLogic$1.prototype = new Object_0;
_.apply_0 = function apply_0(key, keyCode){
  $add_11(($clinit_534() , NAVIGATION_KEYS), dynamicCast(keyCode, 63));
}
;
_.getClass$ = function getClass_318(){
  return Lorg_waveprotocol_wave_client_common_util_SignalKeyLogic$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_536(){
  $clinit_536 = nullMethod;
  WINDOWS = new SignalKeyLogic$OperatingSystem_0('WINDOWS', 0);
  MAC = new SignalKeyLogic$OperatingSystem_0('MAC', 1);
  LINUX = new SignalKeyLogic$OperatingSystem_0('LINUX', 2);
  $VALUES_15 = initValues(_3Lorg_waveprotocol_wave_client_common_util_SignalKeyLogic$OperatingSystem_2_classLit, {58:1, 138:1}, 75, [WINDOWS, MAC, LINUX]);
}

function SignalKeyLogic$OperatingSystem_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_16(){
  $clinit_536();
  return $VALUES_15;
}

function SignalKeyLogic$OperatingSystem(){
}

_ = SignalKeyLogic$OperatingSystem_0.prototype = SignalKeyLogic$OperatingSystem.prototype = new Enum;
_.getClass$ = function getClass_319(){
  return Lorg_waveprotocol_wave_client_common_util_SignalKeyLogic$OperatingSystem_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 75:1};
var $VALUES_15, LINUX, MAC, WINDOWS;
function SignalKeyLogic$Result_0(){
  this.type_0 = ($clinit_528() , SENTINAL);
}

function SignalKeyLogic$Result(){
}

_ = SignalKeyLogic$Result_0.prototype = SignalKeyLogic$Result.prototype = new Object_0;
_.getClass$ = function getClass_320(){
  return Lorg_waveprotocol_wave_client_common_util_SignalKeyLogic$Result_2_classLit;
}
;
_.castableTypeMap$ = {};
_.keyCode_0 = 0;
function $clinit_538(){
  $clinit_538 = nullMethod;
  WEBKIT = new SignalKeyLogic$UserAgentType_0('WEBKIT', 0);
  GECKO = new SignalKeyLogic$UserAgentType_0('GECKO', 1);
  IE = new SignalKeyLogic$UserAgentType_0('IE', 2);
  $VALUES_16 = initValues(_3Lorg_waveprotocol_wave_client_common_util_SignalKeyLogic$UserAgentType_2_classLit, {58:1, 138:1}, 76, [WEBKIT, GECKO, IE]);
}

function SignalKeyLogic$UserAgentType_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_17(){
  $clinit_538();
  return $VALUES_16;
}

function SignalKeyLogic$UserAgentType(){
}

_ = SignalKeyLogic$UserAgentType_0.prototype = SignalKeyLogic$UserAgentType.prototype = new Enum;
_.getClass$ = function getClass_321(){
  return Lorg_waveprotocol_wave_client_common_util_SignalKeyLogic$UserAgentType_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 76:1};
var $VALUES_16, GECKO, IE, WEBKIT;
function $clinit_539(){
  $clinit_539 = nullMethod;
  INSTANCE_3 = new UserAgentRuntimeProperties_0(navigator.userAgent);
}

function UserAgentRuntimeProperties_0(userAgent){
  this.version = calculateVersion(userAgent);
  this.isMac = userAgent.indexOf('Mac') != -1;
  this.isWin = userAgent.indexOf('Windows') != -1;
  this.isLinux = userAgent.indexOf('Linux') != -1;
  userAgent.indexOf(' MSIE 7.') != -1;
  userAgent.indexOf(' MSIE 8.') != -1;
  this.isChrome = userAgent.indexOf('Chrome') != -1;
}

function calculateVersion(userAgent){
  var name_0, name$index, name$max, names, v;
  if (userAgent == null || !userAgent.length) {
    return -1;
  }
  names = initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['firefox', 'webkit', 'msie', 'minefield']);
  for (name$index = 0 , name$max = names.length; name$index < name$max; ++name$index) {
    name_0 = names[name$index];
    v = calculateVersion_0(name_0, userAgent);
    if (v >= 0) {
      return v;
    }
  }
  return -1;
}

function calculateVersion_0(name_0, userAgent){
  var index, major, minor, output;
  index = userAgent.toLowerCase().indexOf(name_0);
  if (index == -1) {
    return -1;
  }
  output = new Box_0;
  index += name_0.length + 1;
  if ((index = consumeDigit(index, userAgent, output)) == -1) {
    return -1;
  }
  major = dynamicCast(output.boxed, 63).value_0;
  ++index;
  if (consumeDigit(index, userAgent, output) == -1) {
    return -1;
  }
  minor = dynamicCast(output.boxed, 63).value_0;
  return major * 1000 + minor;
}

function consumeDigit(index, str, output){
  var $e0, c, nb;
  nb = new StringBuilder_0;
  while (index < str.length && null != String.fromCharCode(c = str.charCodeAt(index)).match(/\d/)) {
    nb.impl.string += String.fromCharCode(c);
    ++index;
  }
  if (nb.impl.string.length == 0) {
    return -1;
  }
  try {
    output.boxed = valueOf_0(__parseAndValidateInt(nb.impl.string, 10));
    return index;
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 147)) {
      return -1;
    }
     else 
      throw $e0;
  }
}

function UserAgentRuntimeProperties(){
}

_ = UserAgentRuntimeProperties_0.prototype = UserAgentRuntimeProperties.prototype = new Object_0;
_.getClass$ = function getClass_322(){
  return Lorg_waveprotocol_wave_client_common_util_UserAgentRuntimeProperties_2_classLit;
}
;
_.castableTypeMap$ = {};
_.isChrome = false;
_.isLinux = false;
_.isMac = false;
_.isWin = false;
_.version = 0;
var INSTANCE_3;
function $log(this$static, level, messages){
  (shouldLogToBuffer_0(this$static.module, level) || shouldLogToPanel_0(this$static.module, level)) && this$static.sink.lazyLog(level, messages);
}

function AbstractLogger(){
}

_ = AbstractLogger.prototype = new Object_0;
_.getClass$ = function getClass_323(){
  return Lorg_waveprotocol_wave_common_logging_AbstractLogger_2_classLit;
}
;
_.handleClientErrors = function handleClientErrors(level, t, messages){
  return;
}
;
_.logPlainTextInner = function logPlainTextInner(level, msg){
  this.sink.lazyLog(level, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ["<pre style='display:inline'>", $replaceAll($replaceAll($replaceAll($replaceAll($replaceAll(msg, '&', '&amp;'), '<', '&lt;'), '>', '&gt;'), '"', '&quot;'), "'", '&#39;'), '<\/pre>']));
}
;
_.castableTypeMap$ = {};
_.errorLogger = null;
_.fatalLogger = null;
_.sink = null;
_.traceLogger = null;
function $clinit_542(){
  $clinit_542 = nullMethod;
  var cookie, cookies, i;
  nativeSetupWebDriverTestPins('webdriverGetFatalError');
  modules = new TreeSet_0;
  enabledModulesBuffer = new HashSet_0;
  logbuffer = new InMemoryLogSink_0;
  enabledModules = new HashSet_0;
  listeners = new ArrayList_0;
  maxLevel_0 = ($clinit_1058() , TRACE).value_0;
  RESOURCES = new DomLogger_Resources_en_InlineClientBundleGenerator_0;
  $clinit_81();
  $push_0(toInject, ($clinit_176() , '.GMQ4-KSBNF{text-align:left;overflow:auto;width:100%;height:100%;}.GMQ4-KSBIF{border-bottom:1px dotted silver;font-family:monospace;}.GMQ4-KSBLF{font-weight:bold;}.GMQ4-KSBJF{color:red;}.GMQ4-KSBKF{color:red;font-weight:bold;}'));
  schedule();
  cookie = getCookie();
  if (cookie != null) {
    cookies = $split(cookie, '\\|', 0);
    for (i = 1; i < cookies.length; ++i) {
      $add_11(enabledModules, cookies[i]);
    }
  }
  outputCache = new ArrayList_0;
  TIMESTAMP_FORMAT = ($clinit_179() , new NumberFormat_1(['USD', '$', 2, 'US$']));
}

function $setupNativeLogging(module){
  if (typeof window[module + 'Log'] == 'undefined') {
    window[module + 'Log'] = function(msg){
      nativeLog(module, msg);
    }
    ;
    window[module + 'LogXml'] = function(xml){
      nativeLogXml(module, xml);
    }
    ;
    window[module + 'LogJava'] = function(label, javaObject){
      nativeLog_0(module, label, javaObject);
    }
    ;
    window[module + 'LogObject'] = function(object){
      var msg = '';
      for (a in object) {
        msg += a + ': ' + object[a] + '<br/>';
      }
      nativeLog(module, msg);
    }
    ;
  }
}

function $triggerOnNewLogger(){
  var l$iterator;
  for (l$iterator = new AbstractList$IteratorImpl_0(listeners); l$iterator.i < l$iterator.this$0_0.size_0();) {
    dynamicCast($next_6(l$iterator), 149);
  }
}

function DomLogger_0(module){
  $clinit_542();
  DomLogger_1.call(this, module, new DomLogger$GWTLogSink_0(module));
}

function DomLogger_1(module, logSink){
  this.sink = logSink;
  this.errorLogger = new AbstractLogger$LevelLogger_0(this, ($clinit_1058() , ERROR));
  this.fatalLogger = new AbstractLogger$LevelLogger_0(this, FATAL);
  this.traceLogger = new AbstractLogger$LevelLogger_0(this, TRACE);
  if (!$getEntry(modules.map, module)) {
    $put_0(modules.map, module, ($clinit_382() , FALSE)) == null;
    $triggerOnNewLogger();
  }
  this.module = module;
  $setupNativeLogging(module);
}

function appendEntry(formatted, level){
  $clinit_542();
  var entry;
  entry = $doc.createElement('div');
  entry.className = 'GMQ4-KSBIF';
  entry.innerHTML = formatted || '';
  switch (level.ordinal) {
    case 1:
      $addClassName(entry, 'GMQ4-KSBJF');
      break;
    case 0:
      $addClassName(entry, 'GMQ4-KSBKF');
      break;
    case 2:
      $addClassName(entry, 'GMQ4-KSBPF');
  }
  level == ($clinit_1058() , FATAL) && (latestFatalError = formatted);
  $add_9(outputCache, entry);
  maybeClearOutputCache();
}

function enable_0(outputElm){
  $clinit_542();
  outputElm_0 = outputElm;
  !!RESOURCES && $addClassName(outputElm, 'GMQ4-KSBNF');
  maybeClearOutputCache();
}

function formatLogEntry(module, msg){
  $clinit_542();
  return "<span class='GMQ4-KSBLF'>" + module + "<\/span> <span class='GMQ4-KSBOF'>(" + timeStamp() + "):<\/span> <span class='GMQ4-KSBMF'>" + msg + '<\/span>';
}

function maybeClearOutputCache(){
  var e, e$iterator;
  if (outputElm_0) {
    for (e$iterator = new AbstractList$IteratorImpl_0(outputCache); e$iterator.i < e$iterator.this$0_0.size_0();) {
      e = dynamicCastJso($next_6(e$iterator));
      outputElm_0.appendChild(e);
    }
    $clear_2(outputCache);
    outputElm_0.scrollTop = 1000000;
  }
}

function nativeLog(module, msg){
  $log_0((new DomLogger_0(module)).traceLogger, msg);
}

function nativeLog_0(module, label, javaObject){
  $log_2((new DomLogger_0(module)).traceLogger, label, javaObject);
}

function nativeLogXml(module, xml){
  $logXml((new DomLogger_0(module)).traceLogger, xml);
}

function nativeSetupWebDriverTestPins(hookName){
  $wnd[hookName] = function(){
    return latestFatalError;
  }
  ;
}

function notifyLoggerListenersIfErrorOrFatal(level){
  $clinit_542();
  var l_0, l$iterator;
  if (level == ($clinit_1058() , ERROR)) {
    for (l$iterator = new AbstractList$IteratorImpl_0(listeners); l$iterator.i < l$iterator.this$0_0.size_0();) {
      l_0 = dynamicCast($next_6(l$iterator), 149);
      $setTextOrHtml(l_0.this$0.error.directionalTextHelper, 'ERROR!', false);
    }
  }
   else if (level == FATAL) {
    for (l$iterator = new AbstractList$IteratorImpl_0(listeners); l$iterator.i < l$iterator.this$0_0.size_0();) {
      l_0 = dynamicCast($next_6(l$iterator), 149);
      $setTextOrHtml(l_0.this$0.fatal.directionalTextHelper, 'FATAL!', false);
    }
  }
}

function persistEnabledModules(){
  var outerIter, entry;
  $clinit_542();
  var $e0, cookie, s, s$iterator;
  cookie = '|';
  for (s$iterator = (outerIter = $keySet(enabledModules.map).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter)); s$iterator.val$outerIter.hasNext();) {
    s = dynamicCast((entry = dynamicCast(s$iterator.val$outerIter.next_0(), 66) , entry.getKey()), 1);
    cookie += s + '|';
  }
  try {
    setCookieValue(cookie);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (!instanceOf($e0, 150))
      throw $e0;
  }
}

function setCookieValue(value){
  var d;
  if ($equals_3(value, getCookie())) {
    return;
  }
  d = new Date_1;
  $setYear(d, d.jsdate.getFullYear() - 1900 + 1);
  setCookie('wdm', value, d);
}

function shouldLogToBuffer_0(module, level){
  $clinit_542();
  return enabledModulesBuffer.map.containsKey(module) || level.value_0 <= ($clinit_1058() , ERROR).value_0;
}

function shouldLogToPanel_0(module, level){
  $clinit_542();
  if (level.value_0 == ($clinit_1058() , FATAL).value_0) {
    return true;
  }
  return !!outputElm_0 && enabledModules.map.containsKey(module) && level.value_0 <= maxLevel_0;
}

function showOutput(){
  $clinit_542();
  var l$iterator;
  for (l$iterator = new AbstractList$IteratorImpl_0(listeners); l$iterator.i < l$iterator.this$0_0.size_0();) {
    dynamicCast($next_6(l$iterator), 149);
  }
}

function timeStamp(){
  $clinit_542();
  var ts;
  ts = (new Date).getTime() / 1000;
  return TIMESTAMP_FORMAT?$format(TIMESTAMP_FORMAT, ts):'' + ts;
}

function DomLogger(){
}

_ = DomLogger_0.prototype = DomLogger.prototype = new AbstractLogger;
_.getClass$ = function getClass_324(){
  return Lorg_waveprotocol_wave_client_debug_logger_DomLogger_2_classLit;
}
;
_.handleClientErrors = function handleClientErrors_0(level, t, messages){
}
;
_.logPlainTextInner = function logPlainTextInner_0(level, msg){
  this.sink.lazyLog(level, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ["<pre style='display:inline'>", $replaceAll($replaceAll($replaceAll($replaceAll($replaceAll(msg, '&', '&amp;'), '<', '&lt;'), '>', '&gt;'), '"', '&quot;'), "'", '&#39;'), '<\/pre>']));
}
;
_.shouldLog = function shouldLog(level){
  return shouldLogToBuffer_0(this.module, level) || shouldLogToPanel_0(this.module, level);
}
;
_.castableTypeMap$ = {};
_.module = null;
var RESOURCES = null, TIMESTAMP_FORMAT, enabledModules, enabledModulesBuffer, latestFatalError = '', listeners, logbuffer, maxLevel_0, modules, outputCache, outputElm_0 = null;
function BufferedLogger_0(){
  $clinit_542();
  DomLogger_1.call(this, 'selection', new BufferedLogger$BufferedLogSink_0(new DomLogger$GWTLogSink_0('selection')));
}

function BufferedLogger(){
}

_ = BufferedLogger_0.prototype = BufferedLogger.prototype = new DomLogger;
_.getClass$ = function getClass_325(){
  return Lorg_waveprotocol_wave_client_debug_logger_BufferedLogger_2_classLit;
}
;
_.castableTypeMap$ = {};
function LogSink(){
}

_ = LogSink.prototype = new Object_0;
_.getClass$ = function getClass_326(){
  return Lorg_waveprotocol_wave_common_logging_LogSink_2_classLit;
}
;
_.castableTypeMap$ = {213:1};
function BufferedLogger$BufferedLogSink_0(outputSink){
  this.buffer = new ArrayList_0;
  this.flush = new BufferedLogger$BufferedLogSink$1_0(this);
  this.outputSink = outputSink;
}

function BufferedLogger$BufferedLogSink(){
}

_ = BufferedLogger$BufferedLogSink_0.prototype = BufferedLogger$BufferedLogSink.prototype = new LogSink;
_.getClass$ = function getClass_327(){
  return Lorg_waveprotocol_wave_client_debug_logger_BufferedLogger$BufferedLogSink_2_classLit;
}
;
_.lazyLog = function lazyLog(level, messages){
  var doFlush;
  doFlush = this.buffer.size == 0;
  $add_9(this.buffer, new BufferedLogger$BufferedLogSink$LogMessage_0(messages, level));
  doFlush && addCommand(this.flush);
}
;
_.castableTypeMap$ = {213:1};
_.outputSink = null;
function BufferedLogger$BufferedLogSink$1_0(this$1){
  this.this$1 = this$1;
}

function BufferedLogger$BufferedLogSink$1(){
}

_ = BufferedLogger$BufferedLogSink$1_0.prototype = BufferedLogger$BufferedLogSink$1.prototype = new Object_0;
_.execute = function execute_8(){
  var m_0, m$iterator;
  for (m$iterator = new AbstractList$IteratorImpl_0(this.this$1.buffer); m$iterator.i < m$iterator.this$0_0.size_0();) {
    m_0 = dynamicCast($next_6(m$iterator), 148);
    $logToSink(m_0, this.this$1.outputSink);
  }
  $clear_2(this.this$1.buffer);
}
;
_.getClass$ = function getClass_328(){
  return Lorg_waveprotocol_wave_client_debug_logger_BufferedLogger$BufferedLogSink$1_2_classLit;
}
;
_.castableTypeMap$ = {28:1, 32:1};
_.this$1 = null;
function $logToSink(this$static, logSink){
  $lazyLog_0(logSink, this$static.level, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, [stringifyLogObject(this$static.message_0)]));
}

function BufferedLogger$BufferedLogSink$LogMessage_0(message, level){
  this.message_0 = message;
  this.level = level;
}

function BufferedLogger$BufferedLogSink$LogMessage(){
}

_ = BufferedLogger$BufferedLogSink$LogMessage_0.prototype = BufferedLogger$BufferedLogSink$LogMessage.prototype = new Object_0;
_.getClass$ = function getClass_329(){
  return Lorg_waveprotocol_wave_client_debug_logger_BufferedLogger$BufferedLogSink$LogMessage_2_classLit;
}
;
_.castableTypeMap$ = {148:1};
_.level = null;
_.message_0 = null;
function $lazyLog_0(this$static, level, messages){
  var formatted, shouldLogToBuffer, shouldLogToPanel;
  shouldLogToBuffer = shouldLogToBuffer_0(this$static.module, level);
  shouldLogToPanel = shouldLogToPanel_0(this$static.module, level);
  shouldLogToBuffer && $lazyLog_1(($clinit_542() , logbuffer), level, messages);
  if (shouldLogToPanel) {
    formatted = formatLogEntry(this$static.module, stringifyLogObject(messages), timeStamp());
    $clinit_542();
    showOutput();
    appendEntry(formatted, level);
  }
  notifyLoggerListenersIfErrorOrFatal(level);
}

function DomLogger$GWTLogSink_0(module){
  this.module = module;
}

function DomLogger$GWTLogSink(){
}

_ = DomLogger$GWTLogSink_0.prototype = DomLogger$GWTLogSink.prototype = new LogSink;
_.getClass$ = function getClass_330(){
  return Lorg_waveprotocol_wave_client_debug_logger_DomLogger$GWTLogSink_2_classLit;
}
;
_.lazyLog = function lazyLog_0(level, messages){
  $lazyLog_0(this, level, messages);
}
;
_.castableTypeMap$ = {213:1};
_.module = null;
function DomLogger_Resources_en_InlineClientBundleGenerator_0(){
}

function DomLogger_Resources_en_InlineClientBundleGenerator(){
}

_ = DomLogger_Resources_en_InlineClientBundleGenerator_0.prototype = DomLogger_Resources_en_InlineClientBundleGenerator.prototype = new Object_0;
_.getClass$ = function getClass_331(){
  return Lorg_waveprotocol_wave_client_debug_logger_DomLogger_1Resources_1en_1InlineClientBundleGenerator_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_552(){
  $clinit_552 = nullMethod;
  new Property$ImmutableProperty_0('Caption');
}

function constructXml(full){
  $clinit_552();
  if (!full) {
    return $wrap_3($wrap_2($appendText_0(new XmlStringBuilderDoc_0(null, ($clinit_1271() , ANY)), 'Hills', BLIP_TEXT), 'caption'), 'image', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['attachment', 'pics/hills.jpg']));
  }
  return $wrap_3($wrap_2($appendText_0(new XmlStringBuilderDoc_0(null, ($clinit_1271() , ANY)), 'Hills', BLIP_TEXT), 'caption'), 'image', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['attachment', 'pics/hills.jpg', 'style', 'full']));
}

function register(registry, attachmentsManager){
  var mutable;
  $clinit_552();
  var attachmentListener, eventHandler, renderer;
  attachmentListener = new ImageThumbnailAttachmentHandler_0;
  renderer = new ImageThumbnailRenderer_0(attachmentsManager, attachmentListener);
  eventHandler = new ImageThumbnailNodeEventHandler_0(($clinit_672() , logger_1), renderer);
  checkArgument_0(!!renderer, "can't bind attachment handler to a null renderer");
  checkState(!attachmentListener.renderer, 'renderer should only be set once');
  attachmentListener.renderer = renderer;
  $add_19(attachmentsManager.listeners, attachmentListener);
  $put_5(dynamicCast($modify_0(registry.data_0), 151).eventHandlers, 'image', eventHandler);
  mutable = dynamicCast($modify_0(registry.data_0), 151);
  $put_5(mutable.renderers, 'image', renderer);
  $put_5(mutable.mutationHandlers, 'image', renderer);
  registerTagForSelections('image', true, ($clinit_1371() , SHALLOW));
}

function $getElement_0(this$static, c){
  var e;
  e = dynamicCast($get_2(this$static.doodads.backend, c), 152);
  if (e) {
    if ($isContentAttached(e)) {
      return e;
    }
     else {
      $remove_6(this$static.doodads.backend, c);
    }
  }
  return null;
}

function $init_3(this$static, e, attachment){
  $put_2(this$static.doodads, attachment, e);
  $onContentUpdated(this$static, attachment);
  $onThumbnailUpdated(this$static, attachment);
  $onUploadStatusUpdated(this$static, attachment);
}

function $onContentUpdated(this$static, c){
  var e, metadata, url;
  e = $getElement_0(this$static, c);
  if (!e) {
    return;
  }
  url = c.url;
  url != null && $setAttachmentUrl(dynamicCast(dynamicCast((this$static.renderer , e).transientData.backend.get(valueOf_0(($clinit_563() , WIDGET).id_0)), 36), 153), url);
  metadata = $getContentImageMetadata(c);
  !!metadata && $setAttachmentSize(dynamicCast(dynamicCast((this$static.renderer , e).transientData.backend.get(valueOf_0(($clinit_563() , WIDGET).id_0)), 36), 153), metadata.this$0.thumbWidth, metadata.this$0.thumbHeight);
}

--></script>
<script><!--
function $onThumbnailUpdated(this$static, c){
  var e, metadata, url;
  e = $getElement_0(this$static, c);
  if (!e) {
    return;
  }
  url = c.url;
  url != null && $setThumbnailUrl(dynamicCast(dynamicCast((this$static.renderer , e).transientData.backend.get(valueOf_0(($clinit_563() , WIDGET).id_0)), 36), 153), url);
  metadata = $getThumbnailImageMetadata(c);
  !!metadata && $setThumbnailSize(dynamicCast(dynamicCast((this$static.renderer , e).transientData.backend.get(valueOf_0(($clinit_563() , WIDGET).id_0)), 36), 153), metadata.this$0.thumbWidth, metadata.this$0.thumbHeight);
  !metadata && ($clinit_560() , NOT_UPLOADING) == FAILED_AND_NOT_RETRYABLE && $displayDeadImage(dynamicCast(dynamicCast((this$static.renderer , e).transientData.backend.get(valueOf_0(($clinit_563() , WIDGET).id_0)), 36), 153));
}

function $onUploadStatusUpdated(this$static, c){
  var e, v;
  e = $getElement_0(this$static, c);
  if (!e) {
    return;
  }
  v = dynamicCast(dynamicCast((this$static.renderer , e).transientData.backend.get(valueOf_0(($clinit_563() , WIDGET).id_0)), 36), 153);
  switch (($clinit_560() , NOT_UPLOADING).ordinal) {
    case 0:
    case 1:
      v.progressWidget.element_0.style.display = 'none';
      break;
    case 2:
    case 3:
      $setValue_4(v.progressWidget);
      v.progressWidget.element_0.style.display = '';
      break;
    case 4:
      v.progressWidget.element_0.style.display = 'none';
      $displayDeadImage(v);
      break;
    default:throw new IllegalStateException_0;
  }
}

function ImageThumbnailAttachmentHandler_0(){
  this.doodads = ($clinit_1445() , $clinit_1445() , new CollectionUtils$IdentityHashMapAdapter_0);
}

function ImageThumbnailAttachmentHandler(){
}

_ = ImageThumbnailAttachmentHandler_0.prototype = ImageThumbnailAttachmentHandler.prototype = new Object_0;
_.getClass$ = function getClass_332(){
  return Lorg_waveprotocol_wave_client_doodad_attachment_ImageThumbnailAttachmentHandler_2_classLit;
}
;
_.castableTypeMap$ = {};
_.renderer = null;
function $clinit_554(){
  $clinit_554 = nullMethod;
  INSTANCE_4 = new NodeEventHandlerImpl_0;
}

function NodeEventHandlerImpl_0(){
}

function NodeEventHandlerImpl(){
}

_ = NodeEventHandlerImpl_0.prototype = NodeEventHandlerImpl.prototype = new Object_0;
_.getClass$ = function getClass_333(){
  return Lorg_waveprotocol_wave_client_editor_NodeEventHandlerImpl_2_classLit;
}
;
_.handleBackspaceAfterNode = function handleBackspaceAfterNode(element, event_0){
  return false;
}
;
_.handleBackspaceAtBeginning = function handleBackspaceAtBeginning(element, event_0){
  return false;
}
;
_.handleBackspaceNotAtBeginning = function handleBackspaceNotAtBeginning(element, event_0){
  return false;
}
;
_.handleClick = function handleClick(element, event_0){
  return false;
}
;
_.handleDelete = function handleDelete(element, event_0){
  return false;
}
;
_.handleDeleteAtEnd = function handleDeleteAtEnd(element, event_0){
  return false;
}
;
_.handleDeleteBeforeNode = function handleDeleteBeforeNode(element, event_0){
  return false;
}
;
_.handleDeleteNotAtEnd = function handleDeleteNotAtEnd(element, event_0){
  return false;
}
;
_.handleEnter = function handleEnter(element, event_0){
  return false;
}
;
_.handleLeft = function handleLeft(element, event_0){
  return false;
}
;
_.handleLeftAfterNode = function handleLeftAfterNode(element, event_0){
  return false;
}
;
_.handleLeftAtBeginning = function handleLeftAtBeginning(element, event_0){
  return false;
}
;
_.handleRight = function handleRight(element, event_0){
  return false;
}
;
_.handleRightAtEnd = function handleRightAtEnd(element, event_0){
  return false;
}
;
_.handleRightBeforeNode = function handleRightBeforeNode(element, event_0){
  return false;
}
;
_.onActivated = function onActivated(element){
}
;
_.onDeactivated = function onDeactivated(element){
}
;
_.castableTypeMap$ = {180:1};
var INSTANCE_4;
function ImageThumbnailNodeEventHandler_0(logger, renderer){
  $clinit_554();
  this.logger = logger;
  this.renderer = renderer;
}

function ImageThumbnailNodeEventHandler(){
}

_ = ImageThumbnailNodeEventHandler_0.prototype = ImageThumbnailNodeEventHandler.prototype = new NodeEventHandlerImpl;
_.getClass$ = function getClass_334(){
  return Lorg_waveprotocol_wave_client_doodad_attachment_ImageThumbnailNodeEventHandler_2_classLit;
}
;
_.handleBackspaceAfterNode = function handleBackspaceAfterNode_0(element, event_0){
  $log_2(this.logger.traceLogger, 'backspace after', element);
  $deleteNode(element.context.this$0.mutableContent, element);
  return true;
}
;
_.handleDeleteBeforeNode = function handleDeleteBeforeNode_0(element, event_0){
  $log_2(this.logger.traceLogger, 'Delete before', element);
  $deleteNode(element.context.this$0.mutableContent, element);
  return true;
}
;
_.handleLeftAfterNode = function handleLeftAfterNode_0(element, event_0){
  $setCaret_0(element.context.this$0.editingConcerns.getSelectionHelper(), new Point$El_0(dynamicCast(element.firstChild_0, 152), null));
  return true;
}
;
_.handleLeftAtBeginning = function handleLeftAtBeginning_0(element, event_0){
  $setCaret(element.context.this$0.editingConcerns.getSelectionHelper(), $getLocation_4(element.context.this$0.indexedDoc, before_0(element.context.this$0.renderingConcerns.this$0.renderedContentView, element)));
  return true;
}
;
_.handleRightAtEnd = function handleRightAtEnd_0(element, event_0){
  $setCaret(element.context.this$0.editingConcerns.getSelectionHelper(), $getLocation_4(element.context.this$0.indexedDoc, after_1(element.context.this$0.renderingConcerns.this$0.renderedContentView, element)));
  return true;
}
;
_.handleRightBeforeNode = function handleRightBeforeNode_0(element, event_0){
  $setCaret_0(element.context.this$0.editingConcerns.getSelectionHelper(), start_5(element.context.this$0.renderingConcerns.this$0.renderedContentView, dynamicCast(element.firstChild_0, 152)));
  return true;
}
;
_.onActivated = function onActivated_0(element){
  dynamicCast(dynamicCast(element.transientData.backend.get(valueOf_0(($clinit_563() , WIDGET).id_0)), 36), 153).listener = new ImageThumbnailNodeEventHandler$1_0(element);
}
;
_.castableTypeMap$ = {180:1};
_.logger = null;
_.renderer = null;
function $onClickImage(this$static){
  var thumbnail, url;
  thumbnail = ($clinit_580() , dynamicCast(this$static.val$element.transientData.backend.get(valueOf_0(PROPERTY.id_0)), 154));
  if (!$onClick_0(thumbnail)) {
    url = thumbnail.attachment.url;
    url != null && ($wnd.open(url, '_blank', '') , undefined);
  }
}

function $onRequestSetFullSizeMode(this$static, isOn){
  $setElementAttribute(this$static.val$element.context.this$0.mutableContent, this$static.val$element, 'style', isOn?'full':null);
}

function ImageThumbnailNodeEventHandler$1_0(val$element){
  this.val$element = val$element;
}

function ImageThumbnailNodeEventHandler$1(){
}

_ = ImageThumbnailNodeEventHandler$1_0.prototype = ImageThumbnailNodeEventHandler$1.prototype = new Object_0;
_.getClass$ = function getClass_335(){
  return Lorg_waveprotocol_wave_client_doodad_attachment_ImageThumbnailNodeEventHandler$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$element = null;
function $clinit_560(){
  $clinit_560 = nullMethod;
  NOT_UPLOADING = new SimpleAttachmentManager$UploadStatusCode_0('NOT_UPLOADING', 0);
  SUCCEEDED = new SimpleAttachmentManager$UploadStatusCode_0('SUCCEEDED', 1);
  IN_PROGRESS = new SimpleAttachmentManager$UploadStatusCode_0('IN_PROGRESS', 2);
  FAILED_AND_RETRYABLE = new SimpleAttachmentManager$UploadStatusCode_0('FAILED_AND_RETRYABLE', 3);
  FAILED_AND_NOT_RETRYABLE = new SimpleAttachmentManager$UploadStatusCode_0('FAILED_AND_NOT_RETRYABLE', 4);
  $VALUES_17 = initValues(_3Lorg_waveprotocol_wave_client_doodad_attachment_SimpleAttachmentManager$UploadStatusCode_2_classLit, {58:1, 138:1}, 77, [NOT_UPLOADING, SUCCEEDED, IN_PROGRESS, FAILED_AND_RETRYABLE, FAILED_AND_NOT_RETRYABLE]);
}

function SimpleAttachmentManager$UploadStatusCode_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_18(){
  $clinit_560();
  return $VALUES_17;
}

function SimpleAttachmentManager$UploadStatusCode(){
}

_ = SimpleAttachmentManager$UploadStatusCode_0.prototype = SimpleAttachmentManager$UploadStatusCode.prototype = new Enum;
_.getClass$ = function getClass_336(){
  return Lorg_waveprotocol_wave_client_doodad_attachment_SimpleAttachmentManager$UploadStatusCode_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 77:1};
var $VALUES_17, FAILED_AND_NOT_RETRYABLE, FAILED_AND_RETRYABLE, IN_PROGRESS, NOT_UPLOADING, SUCCEEDED;
function NodeMutationHandlerImpl_0(){
}

function NodeMutationHandlerImpl(){
}

_ = NodeMutationHandlerImpl_0.prototype = NodeMutationHandlerImpl.prototype = new Object_0;
_.getClass$ = function getClass_337(){
  return Lorg_waveprotocol_wave_client_editor_NodeMutationHandlerImpl_2_classLit;
}
;
_.onActivatedSubtree = function onActivatedSubtree(element){
}
;
_.onActivationStart = function onActivationStart(element){
}
;
_.onAddedToParent = function onAddedToParent(element, oldParent){
}
;
_.onAttributeModified = function onAttributeModified(element, name_0, oldValue, newValue){
}
;
_.onChildAdded = function onChildAdded(element, child){
}
;
_.onChildRemoved = function onChildRemoved(element, child){
}
;
_.onDeactivated_0 = function onDeactivated_0(element){
}
;
_.onDescendantsMutated = function onDescendantsMutated(element){
}
;
_.onEmptied = function onEmptied(element){
}
;
_.onRemovedFromParent = function onRemovedFromParent(element, newParent){
}
;
_.castableTypeMap$ = {179:1};
function RenderingMutationHandler(){
}

_ = RenderingMutationHandler.prototype = new NodeMutationHandlerImpl;
_.getClass$ = function getClass_338(){
  return Lorg_waveprotocol_wave_client_editor_RenderingMutationHandler_2_classLit;
}
;
_.castableTypeMap$ = {177:1, 179:1};
function $clinit_563(){
  $clinit_563 = nullMethod;
  WIDGET = new Property$ImmutableProperty_0('widget');
  LOGICAL_PANEL = new Property$ImmutableProperty_0('parent');
}

function $disassociateWidget(element){
  var old;
  old = dynamicCast(element.transientData.backend.get(valueOf_0(WIDGET.id_0)), 36);
  if (old) {
    $removeFromParent(old.element_0);
    element.transientData.backend.put(valueOf_0(WIDGET.id_0), null);
  }
}

function $maybeLogicalAttach(element){
  var p, w;
  w = dynamicCast(element.transientData.backend.get(valueOf_0(WIDGET.id_0)), 36);
  p = dynamicCast(element.transientData.backend.get(valueOf_0(LOGICAL_PANEL.id_0)), 201);
  !!p && !!w && p.doAdopt(w);
}

function $maybeLogicalDetach(element){
  var p, w;
  w = dynamicCast(element.transientData.backend.get(valueOf_0(WIDGET.id_0)), 36);
  p = dynamicCast(element.transientData.backend.get(valueOf_0(LOGICAL_PANEL.id_0)), 201);
  !!p && !!w && !!w.parent_0 && p.doOrphan(w);
}

function $setLogicalPanel(element, parent_0){
  var existingParent;
  existingParent = dynamicCast(element.transientData.backend.get(valueOf_0(LOGICAL_PANEL.id_0)), 201);
  if (!existingParent && !parent_0) {
    return;
  }
  checkState(!existingParent || !parent_0, 'setLogicalPanel called for an element that already has it');
  if ($isContentAttached(element)) {
    if (!parent_0) {
      $maybeLogicalDetach(element);
      element.transientData.backend.put(valueOf_0(LOGICAL_PANEL.id_0), null);
    }
     else {
      $put_3(element.transientData, LOGICAL_PANEL.id_0, parent_0);
      $maybeLogicalAttach(element);
    }
  }
}

function GwtRenderingMutationHandler(){
}

_ = GwtRenderingMutationHandler.prototype = new RenderingMutationHandler;
_.createDomImpl = function createDomImpl(element){
  var attachNodelet, implNodelet, w;
  w = this.createGwtWidget(element);
  if (this.flow == ($clinit_917() , USE_WIDGET)) {
    checkState(!!w, 'Cannot have null widget with USE_WIDGET');
    implNodelet = w.element_0;
    attachNodelet = null;
  }
   else {
    implNodelet = this.flow.createContainer();
    attachNodelet = implNodelet;
  }
  implNodelet.setAttribute('contentEditable', 'false');
  !!w && ($put_3(element.transientData, WIDGET.id_0, w) , !!attachNodelet && attachNodelet.appendChild(w.element_0) , $setContainerNodelet(element, this.getContainerNodelet(w)) , undefined);
  return implNodelet;
}
;
_.getClass$ = function getClass_339(){
  return Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler_2_classLit;
}
;
_.getContainerNodelet = function getContainerNodelet(w){
  return null;
}
;
_.onActivationStart_0 = function onActivationStart_0(element){
  $maybeLogicalAttach(element);
}
;
_.onActivationStart = function onActivationStart_1(element){
  this.onActivationStart_0(element);
}
;
_.onDeactivated = function onDeactivated_1(element){
  var nodelet;
  nodelet = element.implNodelet;
  this.flow == ($clinit_917() , USE_WIDGET)?null:nodelet;
  $maybeLogicalDetach(element);
  $disassociateWidget(element);
  $setLogicalPanel(element, null);
}
;
_.onDeactivated_0 = function onDeactivated_2(element){
  this.onDeactivated(element);
}
;
_.castableTypeMap$ = {177:1, 179:1, 181:1};
_.flow = null;
var LOGICAL_PANEL, WIDGET;
function $onAttributeModified_0(this$static, element, name_0, newValue){
  var newAttachment, oldAttachment, view, w;
  if ($equals_3('style', name_0)) {
    view = dynamicCast(dynamicCast(element.transientData.backend.get(valueOf_0(WIDGET.id_0)), 36), 153);
    $setFullSizeMode(view, $equals_3('full', newValue));
  }
   else if ($equals_3('attachment', name_0)) {
    w = ($clinit_580() , dynamicCast(element.transientData.backend.get(valueOf_0(PROPERTY.id_0)), 154));
    newAttachment = $getAttachment(this$static.manager, newValue);
    oldAttachment = w.attachment;
    if (newAttachment != oldAttachment) {
      !!oldAttachment && ($remove_6(this$static.attachmentHandler.doodads.backend, oldAttachment) , undefined);
      if (newAttachment) {
        dynamicCast(element.transientData.backend.get(valueOf_0(PROPERTY.id_0)), 154).attachment = newAttachment;
        $init_3(this$static.attachmentHandler, element, newAttachment);
      }
    }
  }
}

function ImageThumbnailRenderer_0(manager, handler){
  $clinit_563();
  this.flow = ($clinit_917() , USE_WIDGET);
  this.manager = manager;
  this.attachmentHandler = handler;
}

function ImageThumbnailRenderer(){
}

_ = ImageThumbnailRenderer_0.prototype = ImageThumbnailRenderer.prototype = new GwtRenderingMutationHandler;
_.createGwtWidget = function createGwtWidget(element){
  var widget;
  widget = new ImageThumbnailWidget_0;
  $setThumbnailSize(widget, 120, 90);
  return widget;
}
;
_.getClass$ = function getClass_340(){
  return Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailRenderer_2_classLit;
}
;
_.getContainerNodelet = function getContainerNodelet_0(w){
  return dynamicCast(w, 153).captionPanel.element_0;
}
;
_.onActivationStart_0 = function onActivationStart_2(element){
  $put_3(element.transientData, ($clinit_580() , PROPERTY).id_0, new ImageThumbnailWrapper_0(element));
  $each_2(element.attributes, new RenderingMutationHandler$1_0(this, element));
}
;
_.onAttributeModified = function onAttributeModified_0(element, name_0, oldValue, newValue){
  $onAttributeModified_0(this, element, name_0, newValue);
}
;
_.onDeactivated = function onDeactivated_3(element){
  var w;
  w = ($clinit_580() , dynamicCast(element.transientData.backend.get(valueOf_0(PROPERTY.id_0)), 154));
  !!w.attachment && ($remove_6(this.attachmentHandler.doodads.backend, w.attachment) , undefined);
  element.transientData.backend.put(valueOf_0(PROPERTY.id_0), null);
}
;
_.castableTypeMap$ = {177:1, 179:1, 181:1};
_.attachmentHandler = null;
_.manager = null;
function $clinit_567(){
  $clinit_567 = nullMethod;
  $clinit_579();
  $clinit_81();
  $push_0(toInject, ($clinit_176() , '.GMQ4-KSBBG{margin:5px 0 0 2px;display:inline-block;}.wave-editor-off .GMQ4-KSBDG{display:none;}.wave-editor-on .GMQ4-KSBDG{display:block;}.wave-editor-on .wave-editor-off .GMQ4-KSBDG{display:none;}.buttonContainer{position:absolute;z-index:100;top:4px;right:14px;}.buttonContainer *{position:absolute;top:0;right:0;}.chromeContainer{z-index:10;}.GMQ4-KSBBG{position:relative;display:inline-table;}.GMQ4-KSBBG .w-caption{outline:0;}.GMQ4-KSBAG{display:block;z-index:1;display:inline;}.itnw{height:' + chromeNorthWest.height_0 + 'px;width:' + chromeNorthWest.width_0 + 'px;overflow:hidden;background:url("' + chromeNorthWest.url + '") -' + chromeNorthWest.left_0 + 'px -' + chromeNorthWest.top_0 + 'px  no-repeat;position:absolute;top:0;left:0;width:6px;height:90px;}.itnc{height:' + chromeNorth.height_0 + 'px;overflow:hidden;background:url("' + chromeNorth.url + '") -' + chromeNorth.left_0 + 'px -' + chromeNorth.top_0 + 'px  repeat-x;position:absolute;top:0;left:6px;right:15px;width:auto;height:6px;}.itne{height:' + chromeNorthEast.height_0 + 'px;width:' + chromeNorthEast.width_0 + 'px;overflow:hidden;background:url("' + chromeNorthEast.url + '") -' + chromeNorthEast.left_0 + 'px -' + chromeNorthEast.top_0 + 'px  no-repeat;position:absolute;top:0;right:0;height:90px;width:15px;}.itcw{width:' + chromeWest.width_0 + 'px;overflow:hidden;background:url("' + chromeWest.url + '") -' + chromeWest.left_0 + 'px -' + chromeWest.top_0 + "px  repeat-y;position:absolute;top:90px;left:0;bottom:4px;width:6px;height:auto;}.ittt{width:1px;margin:6px 15px 4px 6px;}.itcc{position:absolute;top:0;left:0;right:0;bottom:0;height:auto;width:auto;background-repeat:no-repeat;background-position:center center;background-image:url('" + $moduleBase + "BC5A74670F706FA26A18CD58AFE873CE.cache.gif');}.iterr{height:" + errorAttachment.height_0 + 'px;width:' + errorAttachment.width_0 + 'px;overflow:hidden;background:url("' + errorAttachment.url + '") -' + errorAttachment.left_0 + 'px -' + errorAttachment.top_0 + 'px  no-repeat;position:absolute;top:0;left:0;right:0;bottom:0;height:auto;width:auto;background-repeat:no-repeat;background-position:center center;}.itci{margin:auto auto;position:relative;min-height:60px;}.itco{height:' + chromeCenter.height_0 + 'px;overflow:hidden;background:url("' + chromeCenter.url + '") -' + chromeCenter.left_0 + 'px -' + chromeCenter.top_0 + 'px  repeat-x;height:auto;width:auto;}.itce{width:' + chromeEast.width_0 + 'px;overflow:hidden;background:url("' + chromeEast.url + '") -' + chromeEast.left_0 + 'px -' + chromeEast.top_0 + 'px  repeat-y;position:absolute;top:90px;right:0;bottom:4px;width:15px;height:auto;}.itsw{height:' + chromeSouthWest.height_0 + 'px;width:' + chromeSouthWest.width_0 + 'px;overflow:hidden;background:url("' + chromeSouthWest.url + '") -' + chromeSouthWest.left_0 + 'px -' + chromeSouthWest.top_0 + 'px  no-repeat;position:absolute;bottom:0;left:0;height:4px;width:6px;}.itsc{height:' + chromeSouth.height_0 + 'px;overflow:hidden;background:url("' + chromeSouth.url + '") -' + chromeSouth.left_0 + 'px -' + chromeSouth.top_0 + 'px  repeat-x;position:absolute;bottom:0;left:6px;right:15px;height:4px;width:auto;}.itse{height:' + chromeSouthEast.height_0 + 'px;width:' + chromeSouthEast.width_0 + 'px;overflow:hidden;background:url("' + chromeSouthEast.url + '") -' + chromeSouthEast.left_0 + 'px -' + chromeSouthEast.top_0 + 'px  no-repeat;position:absolute;bottom:0;right:0;height:4px;width:15px;}.itimg{cursor:pointer;}.GMQ4-KSBCG{position:absolute;height:8px;bottom:0;left:0;right:0;z-index:3;background-color:white;}.GMQ4-KSBBG .w-caption{text-align:center;padding:4px;color:black;background-color:white;}table.GMQ4-KSBBG td.ww{width:6px;}table.GMQ4-KSBBG td.ee{width:15px;}table.GMQ4-KSBBG td.nn{height:90px;}table.GMQ4-KSBBG td.ss{height:4px;}table.GMQ4-KSBBG td.m{vertical-align:top;}table.GMQ4-KSBBG td.n{height:' + chromeNorth.height_0 + 'px;overflow:hidden;background:url("' + chromeNorth.url + '") -' + chromeNorth.left_0 + 'px -' + chromeNorth.top_0 + 'px  repeat-x;height:6px;}table.GMQ4-KSBBG td.nw{height:' + chromeNorthWest.height_0 + 'px;width:' + chromeNorthWest.width_0 + 'px;overflow:hidden;background:url("' + chromeNorthWest.url + '") -' + chromeNorthWest.left_0 + 'px -' + chromeNorthWest.top_0 + 'px  no-repeat;}table.GMQ4-KSBBG td.ne{height:' + chromeNorthEast.height_0 + 'px;width:' + chromeNorthEast.width_0 + 'px;overflow:hidden;background:url("' + chromeNorthEast.url + '") -' + chromeNorthEast.left_0 + 'px -' + chromeNorthEast.top_0 + 'px  no-repeat;}table.GMQ4-KSBBG td.w{width:' + chromeWest.width_0 + 'px;overflow:hidden;background:url("' + chromeWest.url + '") -' + chromeWest.left_0 + 'px -' + chromeWest.top_0 + 'px  repeat-y;}table.GMQ4-KSBBG td.e{width:' + chromeEast.width_0 + 'px;overflow:hidden;background:url("' + chromeEast.url + '") -' + chromeEast.left_0 + 'px -' + chromeEast.top_0 + 'px  repeat-y;}table.GMQ4-KSBBG td.sw{height:' + chromeSouthWest.height_0 + 'px;width:' + chromeSouthWest.width_0 + 'px;overflow:hidden;background:url("' + chromeSouthWest.url + '") -' + chromeSouthWest.left_0 + 'px -' + chromeSouthWest.top_0 + 'px  no-repeat;}table.GMQ4-KSBBG td.s{height:' + chromeSouth.height_0 + 'px;overflow:hidden;background:url("' + chromeSouth.url + '") -' + chromeSouth.left_0 + 'px -' + chromeSouth.top_0 + 'px  repeat-x;}table.GMQ4-KSBBG td.se{height:' + chromeSouthEast.height_0 + 'px;width:' + chromeSouthEast.width_0 + 'px;overflow:hidden;background:url("' + chromeSouthEast.url + '") -' + chromeSouthEast.left_0 + 'px -' + chromeSouthEast.top_0 + 'px  no-repeat;}table.GMQ4-KSBBG td.c{height:' + chromeCenter.height_0 + 'px;overflow:hidden;background:url("' + chromeCenter.url + '") -' + chromeCenter.left_0 + 'px -' + chromeCenter.top_0 + "px  repeat-x;text-align:center;}table.GMQ4-KSBBG div.l{margin:auto auto;background-image:url('data:image/gif;base64,R0lGODlhAAEAAcYBAMzMzP///9TU1ODg4Ovr6/Hx8fDw8Ojo6N7e3tLS0t3d3fb29vb29vT09PPz8/Hx8enp6dnZ2fj4+Ofn58/Pz8/Pz9fX1+Li4u7u7uvr69jY2NXV1fLy8vn5+eLi4tzc3Ovr6+Xl5dHR0ePj4/v7++np6d/f3+np6dra2vDw8Pz8/Nvb2+Dg4Pn5+fz8/NDQ0M3Nzebm5uTk5M3NzeTk5Nzc3MzMzMzMzNjY2NbW1s3NzdPT09vb287OztTU1NHR0dLS0tXV1dfX19jY2NHR0dPT087OztPT0+Xl5dra2tra2u/v7+3t7ezs7Orq6vHx8fLy8tfX1+bm5vT09M/Pz/X19eLi4uzs7PX19fj4+N7e3u7u7vr6+uPj4+rq6vPz89bW1tXV1dDQ0NnZ2eXl5eHh4d7e3u3t7eHh4e/v7+/v7/f3993d3fr6+vv7+9zc3P39/d/f3/b29vr6+vLy8ufn5/T09Pz8/Ofn5/f39+3t7ejo6OTk5P///////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQACgD/ACwAAAAAAAEAAQAH/oAAgoOEhYaHiImKi4yNjo+QkZKTlJWWl5iZmpucnZ6foKGio6SlpqeoqaqrrK2ur7CxsrO0tba3uLm6u7y9vr/AwcLDxMXGx8jJysvMzc7P0NHS09TV1tfY2drb3N3e3+Dh4uPk5ebn6Onq6+zt7u/w8fLz9PX29/j5+vv8/f7/AAMKHEiwoMGDCBMqXMiwocOHECNKnEixosWLGDNq3Mixo8ePIEOKHEmypMmTKFOqXMmypcuXMGPKnEmzps2bOHPq3Mmzp8+fQIMKHUq0qNGjSJMqXcq0qdOnUKNKnUq1qtWrWLNq3cq1q9evYMOKHUu2rNmzaNOqXcu2rdu3/nDjyp1Lt67du3jBbhiRokVeQQg4kFDhQpANHTfqKljQocSKF4JuwOhhY64AAxI8GLJBgULiuAMWTEDU40cPuQQYREA0A8gPuQUaUEi0o4hcAw4qILoRxIfcAw8sIKIgZIdcBAYuIPIxhIjcBBAwfDC0Y4UFI3MjZABhYgOMGQlwIODhnK6GECcOxKDhgQWPBHdFoGAhw0ONHLP/6t/Pv7///wAGKOCABBZo4IEIJqjgggw26OCDEEYo4YQUVmjhhRhmqOGGHHbo4YcghijiiCSWaOKJKKao4oostujiizDGKOOMNNZo44045qjjjjz26OOPQAYp5JBEFmnkkUgmH6nkkkw26eSTUEYp5ZRUVmnllVhmqeWWXHbp5ZfgBAIAIfkEAQoAfwAseAB4ABAAEAAAB4yAAIKDhIWFOwNXWAxbXRuGADwYVQtZLVwkXyaFSk9TSBEUVEpeKlyERwRQm4UyhQoGI5CCN4NIS1GzADo2ggRMPbpGRoInTcSzFBWCF05BszpiywBJEAizVEDBAD8XUhqGLwJEvYI5MjRJCTo6L0VgG9ODQSZWLFofSkNhVJBUOUlqrBCSAIaugwACAQAh+QQBCgB/ACx4AHgAEAAQAAAHiYAAgoOEhYUJChNpBl4sAoYAQwdLBg8ODQxqbIU4XmdoURUVQ1JrDAiDImROPIZoLVAbgmMQZpAAEG1dgiwTPrdKbmqCMkgwt1QuLYIeNDO3hTUXR9CEYGVDtzY6gxQfZr+FOj3Pg0c1H0FUNzcwFC8VNoVAQyhDQkE7QC/chkYJG3L4IBKvWrVAACH5BAEKAH8ALHgAeAAQABAAAAePgACCg4SFhT8oHhBOIWxHhgA5FwcnGWdbak5KhUEjSGwbRj1CXQ9PPINUJjI4hmZfTDuCOVYokABIDAOCSiwJtxFrV4JsZjq3FBJVgm9sx5BUHXKCFjxit0ptS4JHKD63TiojgkZgOCKQcA1Bgy9gOSIwgjf0AHGFFEUCCSJUPTM2bumgIEYMBRgBbykcFAgAIfkEAQoAfwAseAB4ABAAEAAAB4yAAIKDhIWFFGFvZR4mET+GAAkrcWUXNEgTMhaFRDwKFkAzMwIKJRAag0Y4PDuGSiATQIJAYxuQAGVbbII+OFS3Qmp1gmFCN7cVD0u8QceQFQ4GswIwt0N2XoIVCb+QdXIDgjZiP9WFHlkpAoMzVBQzgysncwsKhTZGMDqCLm50CLduODMwwtatg4ICAQAh+QQBCgB/ACx4AHgAEAAQAAAHiYAAgoOEhYUwQDkoKxFBFIYAVEE4Y0ofCHEKPoUVG2BHVDY6IhpWVkGDNkA+L4ZCNGVigj0JrZBvUhGCVEQzkAA+B2i7sr9GXgeCFY/GTSeCMEY3v0JMZII2M9OQXWpsgzfbhSYPTkeGBCtUVGMxU09KhnZ3blwtWXIYPJBBI2kLDM6U2fGr4KBAACH5BAEKAH8ALHgAeAAQABAAAAeIgACCg4SFhTc9Pzs+OyIwhgA6VEQJAkFCOFEihTYVLxUzADcVOyhJQIQwPTqGRx9KFYI3M6yQUWZBsjaQgkQsPLyFMx5lwYQzNB6CBi7AkAIxJoIyKl68WgcRghsOXBeGPE58m4Jaay14YxQVFlZ6XjiFCE95cnYOD2p7Q89lGQ8GDiBIYMxYIAAh+QQBCgB/ACx4AHgAEAAQAAAHi4AAgoOEhYY3OkYVFUY2hoM2M0YUYkREPYUmhjoURTsUg0ENLo9UQT4zgiMqTo8ACRZEgkskK64UQzmCC1xUrjZKY4IMLb6POh+2AGdZKK5EWhGCZQt1rhEsQYICS1hxhhYXCMYAb1B0MlE9RkFsIRcbhSsgT2pMTV4HHmGPRwgxGU5cQPHDlcFBgQAAOw==');background-repeat:no-repeat;background-position:center center;}table.GMQ4-KSBBG table.inner{table-layout:auto;width:auto;}"));
  schedule();
}

function $displayDeadImage(this$static){
  this$static.progressWidget.element_0.style.display = 'none';
  this$static.spin.element_0.style.display = 'none';
  this$static.errorLabel.element_0.setAttribute('title', 'Loading attachment failed.');
  this$static.errorLabel.element_0.style.display = '';
}

function $onErrorClicked(this$static){
  !!this$static.listener && $onClickImage(this$static.listener);
}

function $onImageClicked(this$static){
  !!this$static.listener && $onClickImage(this$static.listener);
}

function $onSpinClicked(this$static){
  !!this$static.listener && $onClickImage(this$static.listener);
}

function $setAttachmentSize(this$static, width, height){
  this$static.attachmentWidth = width;
  this$static.attachmentHeight = height;
}

function $setAttachmentUrl(this$static, url){
  this$static.attachmentUrl = url;
  if (this$static.isFullSize) {
    !this$static.doubleBufferLoader && (this$static.doubleBufferLoader = new ImageThumbnailWidget$DoubleBufferImage_0(this$static.spin, this$static.errorLabel, this$static.image));
    $loadImage(this$static.doubleBufferLoader, url);
    this$static.image.element_0.style['visibility'] = '';
  }
}

function $setFullSizeMode(this$static, isOn){
  var pstyle, parent_0;
  this$static.isFullSize = isOn;
  $setOn(this$static.button_0.controller, isOn);
  pstyle = $getParentElement((parent_0 = this$static.image.element_0.parentNode , (!parent_0 || parent_0.nodeType != 1) && (parent_0 = null) , parent_0)).style;
  if (isOn) {
    this$static.chromeContainer.element_0.style['display'] = ($clinit_47() , 'none');
    $setPixelSize(this$static.image, this$static.attachmentWidth, this$static.attachmentHeight);
    if (this$static.attachmentWidth == 0) {
      this$static.image.element_0.style['width'] = '';
      pstyle['width'] = '';
    }
     else {
      pstyle['width'] = this$static.attachmentWidth + ($clinit_68() , 'px');
    }
    if (this$static.attachmentHeight == 0) {
      this$static.image.element_0.style['height'] = '';
      pstyle['height'] = '';
    }
     else {
      pstyle['height'] = this$static.attachmentHeight + ($clinit_68() , 'px');
    }
    $setAttachmentUrl(this$static, this$static.attachmentUrl);
  }
   else {
    this$static.chromeContainer.element_0.style['display'] = '';
    $setThumbnailSize(this$static, this$static.thumbnailWidth, this$static.thumbnailHeight);
    $setThumbnailUrl(this$static, this$static.thumbnailUrl);
  }
}

function $setThumbnailSize(this$static, width, height){
  var pstyle, parent_0;
  this$static.thumbnailWidth = width;
  this$static.thumbnailHeight = height;
  if (this$static.isFullSize) {
    return;
  }
  $setPixelSize(this$static.image, width, height);
  pstyle = $getParentElement((parent_0 = this$static.image.element_0.parentNode , (!parent_0 || parent_0.nodeType != 1) && (parent_0 = null) , parent_0)).style;
  if (width == 0) {
    this$static.image.element_0.style['width'] = '';
    pstyle['width'] = '';
  }
   else {
    pstyle['width'] = width + ($clinit_68() , 'px');
  }
  if (height == 0) {
    this$static.image.element_0.style['height'] = '';
    pstyle['height'] = '';
  }
   else {
    pstyle['height'] = height + ($clinit_68() , 'px');
  }
}

function $setThumbnailUrl(this$static, url){
  var img;
  if ($equals_3(url, this$static.thumbnailUrl)) {
    return;
  }
  this$static.thumbnailUrl = url;
  if (this$static.isFullSize) {
    $clinit_296();
    img = $doc.createElement('img');
    img.src = url;
    prefetchImages.put(url, img);
  }
   else {
    !this$static.doubleBufferLoader && (this$static.doubleBufferLoader = new ImageThumbnailWidget$DoubleBufferImage_0(this$static.spin, this$static.errorLabel, this$static.image));
    $loadImage(this$static.doubleBufferLoader, url);
    this$static.image.element_0.style['visibility'] = '';
  }
}

function ImageThumbnailWidget_0(){
  $clinit_567();
  var buttonContainerElement, element, imageElement;
  this.clearButtonTask = new ImageThumbnailWidget$1_0(this);
  $initWidget(this, $createAndBindUi(this));
  element = this.element_0;
  setStyleName_0(this.element_0, 'GMQ4-KSBBG', true);
  element.setAttribute('contentEditable', 'false');
  this.errorLabel.element_0.style.display = 'none';
  this.spin.element_0.style.display = '';
  imageElement = this.image.element_0;
  $addClassName(imageElement, 'GMQ4-KSBAG');
  imageElement.style['visibility'] = ($clinit_78() , 'hidden');
  this.button_0 = createIconToggleButton(($clinit_1041() , PLUS_MINUS), new ImageThumbnailWidget$2_0(this));
  setStyleName_0(this.button_0.getStyleElement(), 'GMQ4-KSBDG', true);
  checkNotNull_0(this.button_0.element_0, 'addDebugClass: Element must not be null');
  $add_1(this.menuButtonContainer, this.button_0);
  buttonContainerElement = this.menuButtonContainer.element_0;
  buttonContainerElement.style['display'] = ($clinit_47() , 'none');
  $addDomHandler(this, new ImageThumbnailWidget$3_0(this), ($clinit_135() , $clinit_135() , TYPE_9));
  $addDomHandler(this, new ImageThumbnailWidget$4_0(this), ($clinit_133() , $clinit_133() , TYPE_8));
}

function ImageThumbnailWidget(){
}

_ = ImageThumbnailWidget_0.prototype = ImageThumbnailWidget.prototype = new Composite;
_.getClass$ = function getClass_341(){
  return Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWidget_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1, 153:1};
--></script>
<script><!--
_.attachmentHeight = 0;
_.attachmentUrl = null;
_.attachmentWidth = 0;
_.button_0 = null;
_.captionPanel = null;
_.chromeContainer = null;
_.doubleBufferLoader = null;
_.errorLabel = null;
_.image = null;
_.isFullSize = false;
_.listener = null;
_.menuButtonContainer = null;
_.progressWidget = null;
_.resizeButtonVisible = false;
_.spin = null;
_.thumbnailHeight = 0;
_.thumbnailUrl = null;
_.thumbnailWidth = 0;
function ImageThumbnailWidget$1_0(this$0){
  this.this$0 = this$0;
}

function ImageThumbnailWidget$1(){
}

_ = ImageThumbnailWidget$1_0.prototype = ImageThumbnailWidget$1.prototype = new Object_0;
_.execute = function execute_9(){
  var style;
  style = this.this$0.menuButtonContainer.element_0.style;
  this.this$0.resizeButtonVisible?(style['display'] = ($clinit_47() , 'block') , undefined):(style['display'] = ($clinit_47() , 'none') , undefined);
}
;
_.getClass$ = function getClass_342(){
  return Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWidget$1_2_classLit;
}
;
_.castableTypeMap$ = {209:1, 210:1};
_.this$0 = null;
function $onOff(this$static){
  currentEvent.stopPropagation();
  currentEvent.preventDefault();
  !!this$static.this$0.listener && $onRequestSetFullSizeMode(this$static.this$0.listener, false);
}

function $onOn(this$static){
  currentEvent.stopPropagation();
  currentEvent.preventDefault();
  !!this$static.this$0.listener && $onRequestSetFullSizeMode(this$static.this$0.listener, true);
}

function ImageThumbnailWidget$2_0(this$0){
  this.this$0 = this$0;
}

function ImageThumbnailWidget$2(){
}

_ = ImageThumbnailWidget$2_0.prototype = ImageThumbnailWidget$2.prototype = new Object_0;
_.getClass$ = function getClass_343(){
  return Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWidget$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function ImageThumbnailWidget$3_0(this$0){
  this.this$0 = this$0;
}

function ImageThumbnailWidget$3(){
}

_ = ImageThumbnailWidget$3_0.prototype = ImageThumbnailWidget$3.prototype = new Object_0;
_.getClass$ = function getClass_344(){
  return Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWidget$3_2_classLit;
}
;
_.onMouseOver = function onMouseOver(event_0){
  this.this$0.resizeButtonVisible = true;
  $clinit_1010();
  $schedule_2(scheduler_0, ($clinit_1013() , LOW), this.this$0.clearButtonTask);
}
;
_.castableTypeMap$ = {18:1, 25:1};
_.this$0 = null;
function ImageThumbnailWidget$4_0(this$0){
  this.this$0 = this$0;
}

function ImageThumbnailWidget$4(){
}

_ = ImageThumbnailWidget$4_0.prototype = ImageThumbnailWidget$4.prototype = new Object_0;
_.getClass$ = function getClass_345(){
  return Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWidget$4_2_classLit;
}
;
_.onMouseOut = function onMouseOut(event_0){
  this.this$0.resizeButtonVisible = false;
  $clinit_1010();
  $schedule_2(scheduler_0, ($clinit_1013() , LOW), this.this$0.clearButtonTask);
}
;
_.castableTypeMap$ = {17:1, 25:1};
_.this$0 = null;
function $loadImage(this$static, url){
  var doubleLoadHandler;
  if (this$static.onLoadHandlerRegistration) {
    $removeHandler(this$static.onLoadHandlerRegistration);
    $removeHandler(this$static.onErrorHandlerRegistration);
    $remove_1(($clinit_333() , get_0()), this$static.doubleLoadedImage);
  }
  doubleLoadHandler = new ImageThumbnailWidget$DoubleBufferImage$DoubleLoadHandler_0(this$static, url);
  this$static.onLoadHandlerRegistration = $addHandler_1(this$static.doubleLoadedImage, doubleLoadHandler, ($clinit_129() , $clinit_129() , TYPE_6));
  this$static.onErrorHandlerRegistration = $addHandler_1(this$static.doubleLoadedImage, doubleLoadHandler, ($clinit_98() , $clinit_98() , TYPE_2));
  this$static.error.element_0.style.display = 'none';
  this$static.doubleLoadedImage.element_0.style.display = 'none';
  $setUrl(this$static.doubleLoadedImage, url);
  $add_0(($clinit_333() , get_0()), this$static.doubleLoadedImage);
  this$static.imageToLoad.element_0.style['visibility'] = ($clinit_78() , 'hidden');
  this$static.imageToLoad.element_0.src.length == 0 && $setUrl(this$static.imageToLoad, url);
}

function ImageThumbnailWidget$DoubleBufferImage_0(spinner, error, imageToLoad){
  this.doubleLoadedImage = new Image_1;
  this.spinner = spinner;
  this.error = error;
  this.imageToLoad = imageToLoad;
}

function ImageThumbnailWidget$DoubleBufferImage(){
}

_ = ImageThumbnailWidget$DoubleBufferImage_0.prototype = ImageThumbnailWidget$DoubleBufferImage.prototype = new Object_0;
_.getClass$ = function getClass_346(){
  return Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWidget$DoubleBufferImage_2_classLit;
}
;
_.castableTypeMap$ = {};
_.error = null;
_.imageToLoad = null;
_.onErrorHandlerRegistration = null;
_.onLoadHandlerRegistration = null;
_.spinner = null;
function $cleanUp(this$static){
  var onErrorReg, onLoadReg;
  $remove_1(($clinit_333() , get_0()), this$static.this$1.doubleLoadedImage);
  onLoadReg = this$static.this$1.onLoadHandlerRegistration;
  onErrorReg = this$static.this$1.onErrorHandlerRegistration;
  $clinit_1010();
  $schedule_2(scheduler_0, ($clinit_1013() , LOW), new ImageThumbnailWidget$DoubleBufferImage$DoubleLoadHandler$1_0(onLoadReg, onErrorReg));
  this$static.this$1.onLoadHandlerRegistration = null;
  this$static.this$1.onErrorHandlerRegistration = null;
  this$static.completed = true;
}

function $onError(this$static){
  if (this$static.completed) {
    return;
  }
  $cleanUp(this$static);
  this$static.this$1.spinner.element_0.style.display = 'none';
  this$static.this$1.error.element_0.style.display = '';
}

function $onLoad_1(this$static){
  if (this$static.completed) {
    return;
  }
  $cleanUp(this$static);
  this$static.this$1.spinner.element_0.style.display = 'none';
  this$static.this$1.imageToLoad.element_0.style['visibility'] = '';
  $setUrl(this$static.this$1.imageToLoad, this$static.url);
}

function ImageThumbnailWidget$DoubleBufferImage$DoubleLoadHandler_0(this$1, url){
  this.this$1 = this$1;
  this.url = url;
}

function ImageThumbnailWidget$DoubleBufferImage$DoubleLoadHandler(){
}

_ = ImageThumbnailWidget$DoubleBufferImage$DoubleLoadHandler_0.prototype = ImageThumbnailWidget$DoubleBufferImage$DoubleLoadHandler.prototype = new Object_0;
_.getClass$ = function getClass_347(){
  return Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWidget$DoubleBufferImage$DoubleLoadHandler_2_classLit;
}
;
_.castableTypeMap$ = {10:1, 14:1, 25:1};
_.completed = false;
_.this$1 = null;
_.url = null;
function ImageThumbnailWidget$DoubleBufferImage$DoubleLoadHandler$1_0(val$onLoadReg, val$onErrorReg){
  this.val$onLoadReg = val$onLoadReg;
  this.val$onErrorReg = val$onErrorReg;
}

function ImageThumbnailWidget$DoubleBufferImage$DoubleLoadHandler$1(){
}

_ = ImageThumbnailWidget$DoubleBufferImage$DoubleLoadHandler$1_0.prototype = ImageThumbnailWidget$DoubleBufferImage$DoubleLoadHandler$1.prototype = new Object_0;
_.execute = function execute_10(){
  $removeHandler(this.val$onLoadReg);
  $removeHandler(this.val$onErrorReg);
}
;
_.getClass$ = function getClass_348(){
  return Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWidget$DoubleBufferImage$DoubleLoadHandler$1_2_classLit;
}
;
_.castableTypeMap$ = {209:1, 210:1};
_.val$onErrorReg = null;
_.val$onLoadReg = null;
function $createAndBindUi(owner){
  var attachRecord0, captionPanel, chromeContainer, domId0, domId0Element, domId1, domId1Element, domId2, domId2Element, domId3, domId3Element, domId4, domId4Element, domId5, domId5Element, domId6, domId6Element, errorLabel, f_HTMLPanel1, handlerMethodWithNameVeryUnlikelyToCollideWithUserFieldNames1, handlerMethodWithNameVeryUnlikelyToCollideWithUserFieldNames2, handlerMethodWithNameVeryUnlikelyToCollideWithUserFieldNames3, image, menuButtonContainer, progressWidget, spin;
  $clinit_579();
  domId0 = $createUniqueId($doc);
  menuButtonContainer = new SimplePanel_0;
  domId1 = $createUniqueId($doc);
  chromeContainer = new HTMLPanel_0("<div class='itnw' unselectable='on'><\/div> <div class='itnc' unselectable='on'><\/div> <div class='itne' unselectable='on'><\/div> <div class='itcw' unselectable='on'><\/div>  <div class='itce' unselectable='on'><\/div> <div class='itsw' unselectable='on'><\/div> <div class='itsc' unselectable='on'><\/div> <div class='itse' unselectable='on'><\/div>");
  domId2 = $createUniqueId($doc);
  image = new Image_1;
  domId3 = $createUniqueId($doc);
  spin = new Label_0;
  domId4 = $createUniqueId($doc);
  errorLabel = new Label_0;
  domId5 = $createUniqueId($doc);
  progressWidget = new ProgressWidget_0;
  domId6 = $createUniqueId($doc);
  captionPanel = new SimplePanel_0;
  f_HTMLPanel1 = new HTMLPanel_0("<span id='" + domId0 + "'><\/span> <span id='" + domId1 + "'><\/span> <table cellPadding='0' cellSpacing='0' class='ittt' unselectable='on'> <tr unselectable='on'> <td class='itco' style='visibility: visible' unselectable='on'> <div class='itci' unselectable='on'> <span id='" + domId2 + "'><\/span> <span id='" + domId3 + "'><\/span> <span id='" + domId4 + "'><\/span> <span id='" + domId5 + "'><\/span> <\/div> <\/td> <\/tr> <tr unselectable='on'> <td style='visibility: visible' unselectable='on'> <span id='" + domId6 + "'><\/span> <\/td> <\/tr> <\/table>");
  menuButtonContainer.getStyleElement()['className'] = 'buttonContainer';
  chromeContainer.element_0['className'] = 'chromeContainer';
  image.element_0['className'] = 'itimg';
  spin.element_0['className'] = 'itcc';
  errorLabel.element_0['className'] = 'iterr';
  progressWidget.element_0['className'] = 'GMQ4-KSBCG';
  attachRecord0 = attachToDom(f_HTMLPanel1.element_0);
  domId0Element = $doc.getElementById(domId0);
  domId1Element = $doc.getElementById(domId1);
  domId2Element = $doc.getElementById(domId2);
  domId3Element = $doc.getElementById(domId3);
  domId4Element = $doc.getElementById(domId4);
  domId5Element = $doc.getElementById(domId5);
  domId6Element = $doc.getElementById(domId6);
  attachRecord0.origParent?attachRecord0.origParent.insertBefore(attachRecord0.element, attachRecord0.origSibling):orphan(attachRecord0.element);
  $removeFromParent_0(menuButtonContainer);
  $add_7(f_HTMLPanel1.children_0, menuButtonContainer);
  domId0Element.parentNode.replaceChild(menuButtonContainer.element_0, domId0Element);
  $setParent(menuButtonContainer, f_HTMLPanel1);
  $removeFromParent_0(chromeContainer);
  $add_7(f_HTMLPanel1.children_0, chromeContainer);
  domId1Element.parentNode.replaceChild(chromeContainer.element_0, domId1Element);
  $setParent(chromeContainer, f_HTMLPanel1);
  $removeFromParent_0(image);
  $add_7(f_HTMLPanel1.children_0, image);
  domId2Element.parentNode.replaceChild(image.element_0, domId2Element);
  $setParent(image, f_HTMLPanel1);
  $removeFromParent_0(spin);
  $add_7(f_HTMLPanel1.children_0, spin);
  domId3Element.parentNode.replaceChild(spin.element_0, domId3Element);
  $setParent(spin, f_HTMLPanel1);
  $removeFromParent_0(errorLabel);
  $add_7(f_HTMLPanel1.children_0, errorLabel);
  domId4Element.parentNode.replaceChild(errorLabel.element_0, domId4Element);
  $setParent(errorLabel, f_HTMLPanel1);
  $removeFromParent_0(progressWidget);
  $add_7(f_HTMLPanel1.children_0, progressWidget);
  domId5Element.parentNode.replaceChild(progressWidget.element_0, domId5Element);
  $setParent(progressWidget, f_HTMLPanel1);
  $removeFromParent_0(captionPanel);
  $add_7(f_HTMLPanel1.children_0, captionPanel);
  domId6Element.parentNode.replaceChild(captionPanel.element_0, domId6Element);
  $setParent(captionPanel, f_HTMLPanel1);
  handlerMethodWithNameVeryUnlikelyToCollideWithUserFieldNames1 = new ImageThumbnailWidget_BinderImpl$1_0(owner);
  $addHandler_1(image, handlerMethodWithNameVeryUnlikelyToCollideWithUserFieldNames1, ($clinit_94() , $clinit_94() , TYPE_1));
  handlerMethodWithNameVeryUnlikelyToCollideWithUserFieldNames2 = new ImageThumbnailWidget_BinderImpl$2_0(owner);
  $addDomHandler(spin, handlerMethodWithNameVeryUnlikelyToCollideWithUserFieldNames2, TYPE_1);
  handlerMethodWithNameVeryUnlikelyToCollideWithUserFieldNames3 = new ImageThumbnailWidget_BinderImpl$3_0(owner);
  $addDomHandler(errorLabel, handlerMethodWithNameVeryUnlikelyToCollideWithUserFieldNames3, TYPE_1);
  owner.captionPanel = captionPanel;
  owner.chromeContainer = chromeContainer;
  owner.errorLabel = errorLabel;
  owner.image = image;
  owner.menuButtonContainer = menuButtonContainer;
  owner.progressWidget = progressWidget;
  owner.spin = spin;
  return f_HTMLPanel1;
}

function ImageThumbnailWidget_BinderImpl$1_0(val$owner){
  this.val$owner = val$owner;
}

function ImageThumbnailWidget_BinderImpl$1(){
}

_ = ImageThumbnailWidget_BinderImpl$1_0.prototype = ImageThumbnailWidget_BinderImpl$1.prototype = new Object_0;
_.getClass$ = function getClass_349(){
  return Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWidget_1BinderImpl$1_2_classLit;
}
;
_.onClick = function onClick_0(event_0){
  $onImageClicked(this.val$owner);
}
;
_.castableTypeMap$ = {8:1, 25:1};
_.val$owner = null;
function ImageThumbnailWidget_BinderImpl$2_0(val$owner){
  this.val$owner = val$owner;
}

function ImageThumbnailWidget_BinderImpl$2(){
}

_ = ImageThumbnailWidget_BinderImpl$2_0.prototype = ImageThumbnailWidget_BinderImpl$2.prototype = new Object_0;
_.getClass$ = function getClass_350(){
  return Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWidget_1BinderImpl$2_2_classLit;
}
;
_.onClick = function onClick_1(event_0){
  $onSpinClicked(this.val$owner);
}
;
_.castableTypeMap$ = {8:1, 25:1};
_.val$owner = null;
function ImageThumbnailWidget_BinderImpl$3_0(val$owner){
  this.val$owner = val$owner;
}

function ImageThumbnailWidget_BinderImpl$3(){
}

_ = ImageThumbnailWidget_BinderImpl$3_0.prototype = ImageThumbnailWidget_BinderImpl$3.prototype = new Object_0;
_.getClass$ = function getClass_351(){
  return Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWidget_1BinderImpl$3_2_classLit;
}
;
_.onClick = function onClick_2(event_0){
  $onErrorClicked(this.val$owner);
}
;
_.castableTypeMap$ = {8:1, 25:1};
_.val$owner = null;
function $clinit_579(){
  $clinit_579 = nullMethod;
  chromeCenter = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAADUCAYAAAC20fIWAAAAs0lEQVR42u3JCZLDIBADwPn/Y8Nh7kvR2MHZfUMMJVUjxJoXjDEQY+yGgbUWovWBu+CcLu6CRrxzhFN4OO8J76CR4/CE/4cDGglHQDgRCEZCVJxLRORDtD6ISDFBUrqRkDKRiZwzkW9kFEUpBaXcKJBaC2qtf9BYtSlY7Vw60ZqiQSOd1Xvf4DL4GoPLGOOLqZiTmBtrQhZrTsW5jGtZ+wsKYGMt6OWygAcPfgHXefDgR/AGYNOQdTAGPBsAAAAASUVORK5CYII=', 2, 212);
  chromeEast = new ImageResourcePrototype_0(($clinit_176() , 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAACCAYAAACHSIaUAAAAJElEQVR42mP4///ff3R89+7d/wwMDBJAzAfE7EDMxIANUKIZAJ42L1mNdjNCAAAAAElFTkSuQmCC'), 15, 2);
  chromeNorth = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAABaCAIAAAAdCRDpAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJJJREFUeNrsUIsNRCEIo4YF3H82Z+Hagr4lzoRUsR8U55yIyL03YbFgQBG45S7ZQhRP7GGVWawCsFh9MgCmSAUJYLn1dCmYgqEoVkQoSN20Ce8ElQ4Yz2aG8uLmrcgesAVu3gREJyAxnl4eSXfQA19eD3jNwumPie9f8qWL6CC5VPX7gO8Hm6k31OSN7g9cPwEGAGslFfZQ5oS8AAAAAElFTkSuQmCC', 2, 90);
  chromeNorthEast = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAABaCAYAAABnlQwOAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAshJREFUeNrUV22S2yAMlaj7Nf2VM+T+R8oZ8ns3G1RjhBAgcGza7pQZL17bQk9PT6Dg7XYjMMb1enVhpnVAZyyXy6V5eL/fw/Ql2CKi7y3gcP2D9sJfw/vtm3WYxhSXB2ORbwFZf+3tpXoXHFDh2fMFAT4/ly8WRNoWF+95re/JcB0Pvid9iecEWzHzgw0cX09+7fn+uSTL5BCz9U+e3zmEJ18f/IwWIZLYMsP+xel6sMGDr7fExZINIwQFOxknT2/81QeHgdHYRcMImXTMyIaJjicviELYdkch31CnihRJS3KTFcYMhTmmSoJ2atZCSQuGF6iSZQ6v5iLXLqiCKpF1FtAhRJFgohqhlEg5tDh8CVu8oQRhxEi194I9LHGTgtJALhSGrovaW2RtnnHEcws7xc31jFEZ2FJNHdJAEUabEdpp0h5r+Nv+xKlyllTIyLW8W0oD1P9QZVTPYfd0I3VRx5ByMTJyKgTTiqLOvZNaBlQrDReQg8Qhxym8wa4xFTXrWrJ0KUJHYfG4oSTRtixoAH11KlARjET3yNLHDUUI5e5JhsKKalvqAxDHdVx71kaNZ0td0MZc7WWduCvYVHGFXWnKlRoFBypNeu4QVsUs7jZlg+o+qLf9qJ4kFUOSKdYlSZbXvJNAPugwH9D7qRJP2MiLRpDVYYYA9nllQVYNTSUvosNsJ66H8oQWdrVr4lgkJex4SOamhkq2mzzrNnQB7gjEd47ZG/DL9lHvHYQw2knsrlefzoM9m4zGlc2kE0KrlbC73tiwdluLV2CjygEelSf0Tsix50FH4PcWcDvthO9Jc88Y9rV9AHb9C8m96PUwYc0mPxMznU3VlGc4I5JeN3iIbZgxPu35j6TqNGFwpqrEq/XL/9WYPy9V8GmpOuUZznqegk0zVbUL/6/CnkoVzGxDNEsY/HNtT3uGWbbh/yqMXQS/BRgAEQy4GkAorlEAAAAASUVORK5CYII=', 15, 90);
  chromeNorthWest = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAABaCAIAAAAU4rCTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAASVJREFUeNrsU22uwzAIi1Ev0PufrWfxEjCQbHr/n6ZV2po5fNiG4XmecT7X/Nz3vUP2FgJBwDpivgYjEesAUmgmkuuXny5VQFfr8l4QIhFRTNS6IRd68sKIDlcVGpzJFIS4BVujGPBgLyQaqBZ1gVGyd/qmmNQ0b6sjCzVVKIVwCKUTi5yJvCfDY6zsYuhiOFHOd8eS7vS3jqpZfqlfew/vrmgrv+KrnRitSxqPnZBsN12ErZJ8IMA2bWaXTbZ366GlHLfjLRHbaJlWl4XrLeGCNEZ3EDXH6LImXhbCcO5X1s/1Rep2z2C9gZpaJs45zM0fmxOZWk6IApp1uRqmOVTrFQt89X8jQz1qOo9eVtupblt4Pj/oD4ifEL5HIz8h/Hv2LwEGANSyQVbVnGanAAAAAElFTkSuQmCC', 6, 90);
  chromeSouth = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAAECAYAAACk7+45AAAAG0lEQVR42mO4e/fufxBmAAIJKGbgg2IGdhAGAOcSB4clGclZAAAAAElFTkSuQmCC', 2, 4);
  chromeSouthEast = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAECAYAAABREWWJAAAAQ0lEQVR42mO4e/fuf2yYgYFBGIh5gJgNiJkYcAAJNCwG1cgPxJxAzALEjLg086FhXqiNII2sQMyMTzM7FswGtRGvRgAzWRbmuPJntAAAAABJRU5ErkJggg==', 15, 4);
  chromeSouthWest = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAANElEQVR42mO4e/fuf2yYAQgYgZgFiDmBmB+IhYFYDCbBDMSsUEkeIOZlgAKYJEgnGxCzAwBvhhYLaMghRAAAAABJRU5ErkJggg==', 6, 4);
  chromeWest = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAACCAYAAAB7Xa1eAAAAFUlEQVR42mO4e/fu/////2FgBlwSAI6TLvtu0qYmAAAAAElFTkSuQmCC', 6, 2);
  errorAttachment = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAAsCAYAAADM1FBZAAAH40lEQVR42s1aC1BUVRg+IyoCw1tFCV+zIyuFDLZqmQ/QdEqmjNEmB6c0lUEbtUwdstRALTJTfAVoImuCmqJogvjCByr4Ft/iCxFFeemGuSDr4/Qf+Ja9XHYN1F1g5nPk7t1zz/ed//vOPefA2Gv+4ZxbEWwITgQ3gjvghmviMyvWGH/QeQd0tiPBi6AivAOocK0j7nFoVGSoM9aEloROhG4EP8JHhCDCSCAI1/xwTyd8x7qxEGgNlfsRhhGCCVMIMwnhwExcC8Y9/fCd1g1KRELgLcJAwheEqYS5hEhCFGE5EIVrc3GPuHcAiLRskNKSERhEGE34gbCQsIKwmpBAWAsk4NoK3PM9ysyfoBCmbwgTt4SKA0FAlMtiQhw6vJ7wlwzr8VkcRiWUMJzQk/AGoZklSThBPX+oOaMOBOREVhLmESYSBkMQF0sREDnfjvAuEuc7qFoXAlIia+CTHyFEb0IH0b4lykj4wIfwMeFrwq9QtRaBUaNGXeratWtRaGjo6YKCgiQZEeGTVYQFhMmEIWi3tVlNjjLqTHgfUTmHEANVaxAYNGhQrtKzXenySO9iry7tS8eOHXvBxGjEoJ1gtNvZbCYXpoP5eqKMphOWENRQtbqD6enpO21sbJ6kbVJoeD7jezcrNI6OjuWZmZmpRkZDjXamo13zmVyYDuYbDDPOM1VGKpXq3qeB3sWCgB7i9x49etxtMJNjFDwIvTBJzYIpa5WRWq1Od3Z2LNdk2+mkJMTvjo72FdHR0YcaxOSSUQiAmefDlDXKSKvVbnRxcSmLmOVTJCWgh7ju5ub2KD8/37ImR6R2gDojoZbRURgxYkS2Z2ePUmMEnt9m/OlNxpWd25WGhIRYzuSySB0ClRYYG4UjR46ktmjR4qnezFI8u8X4kxuMV1xlfGeCQuPs7Fx+7Nix7RYxeX0itW/fvrelZi7PYfy97oz3UjH+4CwRuELXLjKupf8P8OtS4ufnl2d2k9cnUmNjYw/KzbwzgXHRjMCBdYyXnWf80RnG/z3J+IVkV21LV+fyxMTEvS8w+SyESC+ESjOzRqq7u/vDaZN8Citr/w6VTy7jW/4wkNi4lAicZvzhCcb/OUIjc5jxyWN8CsX3ysrKNpow+XyESMBLjUZ9zDxp0qSz7m1baSsJ5FWZV3eNRkJtIJGynPHSYxSzmUTgIOMl+xkv2sO4+N748ePPv/bIxTqhDcGX8AnhW1NmzsnJ2dq0adNnaYkKTbV5qfYfX2I8Y4OBxOF4IkDq309nvHgv44W7GS9IZXxzpEJjb29fkZWVlfLaIleyTniT8AEhBCsxo2bu379/3kD/LiWV6l8nAtkG857720Di0haon0YEdjJ+bzvj+fT57c2Mq3wVDwICAnJeW+TK1glfwlzLjJk5KSkpzcnJoeJ6hqtWR9H5+DLMm0W1T+a9uctAIp+ULxLq72D8bjLjd4hU3ibGb9FoZUS7am1tbZ8kJyfveeXIlaXRcKy6TK4TlErl/WkTfAql0Sk1b9GBKgL2tqT+Lon6SUQgkfHc9YznUJldX834hCCfQtHeK0dufdIoLCzshDBlwQk7nVBfK6LzFMybQbUvzLuP8dYujHt1JPVTiMDWqvIR6t9cy/iNNUQgjvGrKxk/udRO17ZNK21ERMTRl47c+rzg5ebmbnFwcKhYF6UsKTuH8pFE5/0DMC+p/81wxmcHo3z06tP8cYPUv7aK8SsrGL8cTZ6hCF42WVlCZaXLy8vb8lKRCy8oCR9iFIy+4Ol0ug2BgYHXVW8rNKJ8qtWXRWeBMG+KwbyV6tOElyPUV1epn02xe/l3xi8uYfz8QsbP/sp4N2/Fg6FDh16t92ggkUSkdod5ZsDMtUYhJSVlD0Xq80u7XLVC/dKjKB9ZdOrNuyGcJrowlM+fUJ8mwWyh/jKauRdRiv3G+Jl5jGf9TPeGejy0trZ+mpqauvsFozERYiurkwoTWyckkojUCHih1mu2r69vwZggn6KHx1E+h0xEJ5k3baEhnXZRB6/GEgGhfhTUjyQC84nAL4yfnku+CKtC0GCfIvEcE6OxDCIHQfQ2lfMGSskL+6RTsLGllo/CokWLMkWk5u2301Wrv08WncK8iM7j1Flba8ZtCBkLSP0YqL+YCCyoKh+h/qnZBgIC6bPsdM5Ojo+NLJ7WQtwIiO0P8W0YdqhVYDcTtRcvN7OHh0fp0nDv4kr1hXnTJNG5jQgYic4zVPOnlkB9Mu+FSJSPXv3wmgT0mDPGu1i8rhsZDTVEngLRvSpLiv5pi633kdj4jZGXEr3fnBMzaw3z7jAenTXMK9QX5l1sMG+l+nOMd14KYXLxXBmReJSU2C79DLvrrepEYty4cef9eytL9NF5T5h3W83ovJkgMa8kOmuY96fa5WMKfXsoS4xs88SjUmaickQFudWpnAoLCzd7e3sXNW/e/FmTJk2emxtWVlbPPT09H2g0mk11HYk6GbsR4IWesMERlB/eFudi+z2hERHRv0etQP+C0d+O+nSyQkl1wwnOVLCNayREpMcBC9G/YeivW/X6AoeAnXAE9TlefeWHJessSGg9nic/mJmO/vVDfx1MHZoMMHFsJRqKxfRvbsTiefU7IqvDAeIczJbzLIAIPK/+h5X/c5Q7GtP9VxZACJ73csfGLzhUF6+/fdCgudEHz3u1A3wjf94glq7tsXVibrTH8+r0pxT/Ab6yc1THHcwDAAAAAElFTkSuQmCC', 49, 44);
}

var chromeCenter = null, chromeEast = null, chromeNorth = null, chromeNorthEast = null, chromeNorthWest = null, chromeSouth = null, chromeSouthEast = null, chromeSouthWest = null, chromeWest = null, errorAttachment = null;
function $clinit_580(){
  $clinit_580 = nullMethod;
  PROPERTY = new Property$ImmutableProperty_0('wrapper');
}

function ImageThumbnailWrapper_0(element){
  $clinit_580();
  this.element = element;
}

function ImageThumbnailWrapper(){
}

_ = ImageThumbnailWrapper_0.prototype = ImageThumbnailWrapper.prototype = new Object_0;
_.getClass$ = function getClass_352(){
  return Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWrapper_2_classLit;
}
;
_.castableTypeMap$ = {154:1};
_.attachment = null;
_.element = null;
var PROPERTY;
function $getContentImageMetadata(this$static){
  if (this$static.thumbWidth != 0 && this$static.thumbHeight != 0) {
    return new FakeAttachment$1_0(this$static);
  }
  return null;
}

function $getThumbnailImageMetadata(this$static){
  if (this$static.thumbWidth != 0 && this$static.thumbHeight != 0) {
    return new FakeAttachment$2_0(this$static);
  }
  return null;
}

function FakeAttachment_0(url, thumbHeight){
  this.url = url;
  this.thumbWidth = 120;
  this.thumbHeight = thumbHeight;
}

function FakeAttachment(){
}

_ = FakeAttachment_0.prototype = FakeAttachment.prototype = new Object_0;
_.getClass$ = function getClass_353(){
  return Lorg_waveprotocol_wave_client_doodad_attachment_testing_FakeAttachment_2_classLit;
}
;
_.castableTypeMap$ = {155:1};
_.thumbHeight = 0;
_.thumbWidth = 0;
_.url = null;
function FakeAttachment$1_0(this$0){
  this.this$0 = this$0;
}

function FakeAttachment$1(){
}

_ = FakeAttachment$1_0.prototype = FakeAttachment$1.prototype = new Object_0;
_.getClass$ = function getClass_354(){
  return Lorg_waveprotocol_wave_client_doodad_attachment_testing_FakeAttachment$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function FakeAttachment$2_0(this$0){
  this.this$0 = this$0;
}

function FakeAttachment$2(){
}

_ = FakeAttachment$2_0.prototype = FakeAttachment$2.prototype = new Object_0;
_.getClass$ = function getClass_355(){
  return Lorg_waveprotocol_wave_client_doodad_attachment_testing_FakeAttachment$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $getAttachment(this$static, id){
  return id != null?dynamicCast($get_12(this$static.map, id), 155):null;
}

function FakeAttachmentsManager_0(){
  this.map = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  this.listeners = new CollectionUtils$IdentitySetAdapter_0;
}

function FakeAttachmentsManager(){
}

_ = FakeAttachmentsManager_0.prototype = FakeAttachmentsManager.prototype = new Object_0;
_.getClass$ = function getClass_356(){
  return Lorg_waveprotocol_wave_client_doodad_attachment_testing_FakeAttachmentsManager_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_585(){
  var map;
  $clinit_585 = nullMethod;
  PREFIX = ($clinit_763() , DIFF_KEY);
  PAINT_KEYS = newStringSet(initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, [DIFF_INSERT_KEY]));
  BOUNDARY_KEYS = newStringSet(initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, [DIFF_DELETE_KEY]));
  PAINT_PROPERTIES = ($clinit_430() , map = new HashMap_1(1) , map.put('backgroundColor', 'yellow') , new Collections$UnmodifiableMap_0(map));
  paintFunc = new DiffAnnotationHandler$1_0;
  boundaryFunc = new DiffAnnotationHandler$2_0;
}

function DiffAnnotationHandler_0(painter){
  this.painter = painter;
}

function register_0(annotationRegistry, painterRegistry){
  $clinit_585();
  $registerPaintFunction(painterRegistry, PAINT_KEYS, paintFunc);
  $registerBoundaryFunction(painterRegistry, BOUNDARY_KEYS, boundaryFunc);
  $registerHandler(annotationRegistry, PREFIX, new DiffAnnotationHandler_0(painterRegistry.painter));
}

function DiffAnnotationHandler(){
}

_ = DiffAnnotationHandler_0.prototype = DiffAnnotationHandler.prototype = new Object_0;
_.getClass$ = function getClass_357(){
  return Lorg_waveprotocol_wave_client_doodad_diff_DiffAnnotationHandler_2_classLit;
}
;
_.handleAnnotationChange = function handleAnnotationChange(bundle, start, end, key, newValue){
  $scheduleRepaint(this.painter, bundle, start, end);
}
;
_.castableTypeMap$ = {246:1};
_.painter = null;
var BOUNDARY_KEYS, PAINT_KEYS, PAINT_PROPERTIES, PREFIX, boundaryFunc, paintFunc;
function DiffAnnotationHandler$1_0(){
}

function DiffAnnotationHandler$1(){
}

_ = DiffAnnotationHandler$1_0.prototype = DiffAnnotationHandler$1.prototype = new Object_0;
_.apply_1 = function apply_1(from, isEditing){
  return from.get(($clinit_763() , DIFF_INSERT_KEY)) != null?($clinit_585() , PAINT_PROPERTIES):($clinit_430() , $clinit_430() , EMPTY_MAP);
}
;
_.getClass$ = function getClass_358(){
  return Lorg_waveprotocol_wave_client_doodad_diff_DiffAnnotationHandler$1_2_classLit;
}
;
_.castableTypeMap$ = {185:1};
function DiffAnnotationHandler$2_0(){
}

function DiffAnnotationHandler$2(){
}

_ = DiffAnnotationHandler$2_0.prototype = DiffAnnotationHandler$2.prototype = new Object_0;
_.apply_2 = function apply_2(localDoc, parent_0, nodeAfter, before, after, isEditing){
  var elt, obj;
  obj = after.get(($clinit_763() , DIFF_DELETE_KEY));
  if (obj != null) {
    elt = $transparentCreate_0(localDoc, 'l:diffdel', ($clinit_430() , $clinit_430() , EMPTY_MAP), parent_0, nodeAfter);
    $setInnards((!instance_1 && (instance_1 = new DiffDeleteRenderer_0) , elt), dynamicCast(obj, 156).htmlElements);
    return elt;
  }
   else {
    return null;
  }
}
;
_.getClass$ = function getClass_359(){
  return Lorg_waveprotocol_wave_client_doodad_diff_DiffAnnotationHandler$2_2_classLit;
}
;
_.castableTypeMap$ = {186:1};
function $setInnards(element, deletedStuff){
  var e, e$iterator, nodelet;
  nodelet = element.containerNodelet;
  for (e$iterator = new AbstractList$IteratorImpl_0(deletedStuff); e$iterator.i < e$iterator.this$0_0.size_0();) {
    e = dynamicCastJso($next_6(e$iterator));
    nodelet.appendChild(e);
  }
}

function DiffDeleteRenderer_0(){
}

function DiffDeleteRenderer(){
}

_ = DiffDeleteRenderer_0.prototype = DiffDeleteRenderer.prototype = new Object_0;
_.createDomImpl = function createDomImpl_0(element){
  var nodelet;
  nodelet = $doc.createElement('span');
  nodelet.setAttribute('contentEditable', 'false');
  nodelet.style['white-space'] = 'pre-wrap';
  return $setContainerNodelet(element, nodelet) , nodelet;
}
;
_.getClass$ = function getClass_360(){
  return Lorg_waveprotocol_wave_client_doodad_diff_DiffDeleteRenderer_2_classLit;
}
;
_.castableTypeMap$ = {177:1};
var instance_1 = null;
function register_1(registry){
  var eventHandler, renderer, mutable, renderingMutationHandler, mutable_0;
  $registerRenderer(registry, 'events', ($clinit_783() , INSTANCE_7));
  $registerEventHandler(registry, 'events', ($clinit_554() , !instance_4 && (instance_4 = new ContentEvents$ContentEventsNodeHandler_0) , $clinit_554() , instance_4));
  $registerMutationHandler(registry, 'events', (!instance_5 && (instance_5 = new ContentEvents$ContentEventsNodeMutationHandler_0) , instance_5));
  $registerRenderer(registry, 'click', INSTANCE_7);
  $clinit_591();
  $registerEventHandler(registry, 'button', NODE_EVENT_HANDLER);
  $registerRenderingMutationHandler(registry, 'button', RENDERING_MUTATION_HANDLER);
  $clinit_618();
  $add_20(($clinit_645() , TAB_TARGETS), 'input');
  $add_20(TAB_TARGETS, 'textarea');
  $clinit_827();
  $registerEventHandler(registry, 'input', DEFAULT_EVENT_HANDLER);
  $registerRenderingMutationHandler(registry, 'input', DEFAULT_RENDERER_0);
  $registerEventHandler(registry, 'input', new Input_1);
  $registerRenderer(registry, 'input', new ParagraphRenderer_0(new Input$1_0));
  registerContainer('textarea', registry);
  $registerRenderer(registry, 'textarea', new Input$2_0);
  $clinit_625();
  eventHandler = new Password$PasswordEventHandler_0;
  renderer = new Password$PasswordRenderer_0(eventHandler);
  $put_5(dynamicCast($modify_0(registry.data_0), 151).eventHandlers, 'password', eventHandler);
  mutable = dynamicCast($modify_0(registry.data_0), 151);
  $put_5(mutable.renderers, 'password', renderer);
  $put_5(mutable.mutationHandlers, 'password', renderer);
  $registerRenderingMutationHandler(registry, 'label', ($clinit_604() , !instance_3 && (instance_3 = new LabelRenderingMutationHandler_0) , $clinit_604() , instance_3));
  $clinit_608();
  $registerRenderingMutationHandler(registry, 'radio', RADIO_BUTTON_MUTATING_RENDERER);
  $registerEventHandler(registry, 'radio', RADIO_BUTTON_NODE_EVENT_HANDLER);
  $clinit_611();
  $registerRenderer(registry, 'radiogroup', INSTANCE_7);
  $registerMutationHandler(registry, 'radiogroup', RADIO_GROUP_MUTATION_HANDLER);
  $clinit_597();
  renderingMutationHandler = (!instance_2 && (instance_2 = new CheckBox$CheckBoxRendereringMutationHandler_0) , instance_2);
  mutable_0 = dynamicCast($modify_0(registry.data_0), 151);
  $put_5(mutable_0.renderers, 'check', renderingMutationHandler);
  $put_5(mutable_0.mutationHandlers, 'check', renderingMutationHandler);
  $registerEventHandler(registry, 'check', CHECKBOX_NODE_EVENT_HANDLER);
}

--></script>
<script><!--
function $clinit_591(){
  $clinit_591 = nullMethod;
  BUTTON_LOGIC_PROP = new Property$ImmutableProperty_0('button_logic');
  RENDERING_MUTATION_HANDLER = new ButtonRenderingMutationHandler_0;
  NODE_EVENT_HANDLER = new Button$1_0;
}

var BUTTON_LOGIC_PROP, NODE_EVENT_HANDLER, RENDERING_MUTATION_HANDLER;
function Button$1_0(){
  $clinit_554();
}

function Button$1(){
}

_ = Button$1_0.prototype = Button$1.prototype = new NodeEventHandlerImpl;
_.getClass$ = function getClass_361(){
  return Lorg_waveprotocol_wave_client_doodad_form_button_Button$1_2_classLit;
}
;
_.handleClick = function handleClick_0(element, event_0){
  var events, last;
  last = element.lastChild_0;
  events = !!last && !last.isTextNode() && $equals_3(dynamicCast(last, 152).tagName_0, 'events')?last:null;
  return !!events && $handleClick(($clinit_782() , INSTANCE_6), events, event_0);
}
;
_.castableTypeMap$ = {180:1};
function $clinit_593(){
  $clinit_593 = nullMethod;
  $clinit_563();
  css_0 = ($clinit_595() , $clinit_595() , css_1);
  !!css_0 && ($clinit_81() , $push_0(toInject, ($clinit_176() , '.GMQ4-KSBGG{display:inline-block;white-space:normal;vertical-align:middle;cursor:pointer;display:inline-table;position:relative;}.GMQ4-KSBGG .w-caption:focus{outline:0;}.display .GMQ4-KSBGG{-moz-user-select:none;-khtml-user-select:none;}')) , flush() , undefined);
}

function $onContentEventsChanged(element){
  var buttonLogic;
  buttonLogic = dynamicCast(element.transientData.backend.get(valueOf_0(($clinit_591() , BUTTON_LOGIC_PROP).id_0)), 158);
  $setDisabled(buttonLogic.controller, !isClickingEnabled(element));
}

function ButtonRenderingMutationHandler_0(){
  $clinit_593();
  this.flow = ($clinit_917() , INLINE_0);
}

function ButtonRenderingMutationHandler(){
}

_ = ButtonRenderingMutationHandler_0.prototype = ButtonRenderingMutationHandler.prototype = new GwtRenderingMutationHandler;
_.createGwtWidget = function createGwtWidget_0(element){
  var buttonLogic, template;
  buttonLogic = new ClickButton_0;
  $put_3(element.transientData, ($clinit_591() , BUTTON_LOGIC_PROP).id_0, buttonLogic);
  template = new TextButton_0(($clinit_1045() , REGULAR_BUTTON));
  $setUiListener_0(template, buttonLogic.mouseListener);
  buttonLogic.buttonDisplay = template;
  $updateState(buttonLogic);
  setStyleName_0(template.element_0, 'GMQ4-KSBGG', true);
  return template;
}
;
_.getClass$ = function getClass_362(){
  return Lorg_waveprotocol_wave_client_doodad_form_button_ButtonRenderingMutationHandler_2_classLit;
}
;
_.getContainerNodelet = function getContainerNodelet_1(widget){
  return dynamicCast(widget, 157).middle;
}
;
_.onAddedToParent = function onAddedToParent_0(element, oldParent){
  $onContentEventsChanged(element);
}
;
_.onDescendantsMutated = function onDescendantsMutated_0(element){
  $onContentEventsChanged(element);
}
;
_.castableTypeMap$ = {177:1, 179:1, 181:1};
var css_0 = null;
function $clinit_595(){
  $clinit_595 = nullMethod;
  css_1 = new ButtonRenderingMutationHandler_Resources_safari_en_InlineClientBundleGenerator$1_0;
}

var css_1 = null;
function ButtonRenderingMutationHandler_Resources_safari_en_InlineClientBundleGenerator$1_0(){
}

function ButtonRenderingMutationHandler_Resources_safari_en_InlineClientBundleGenerator$1(){
}

_ = ButtonRenderingMutationHandler_Resources_safari_en_InlineClientBundleGenerator$1_0.prototype = ButtonRenderingMutationHandler_Resources_safari_en_InlineClientBundleGenerator$1.prototype = new Object_0;
_.getClass$ = function getClass_363(){
  return Lorg_waveprotocol_wave_client_doodad_form_button_ButtonRenderingMutationHandler_1Resources_1safari_1en_1InlineClientBundleGenerator$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_597(){
  $clinit_597 = nullMethod;
  CHECKBOX_NODE_EVENT_HANDLER = new CheckBox$1_2;
}

function setChecked(checkbox, checkValue){
  $clinit_597();
  checkArgument($equalsIgnoreCase('check', checkbox.tagName_0));
  $setElementAttribute(checkbox.context.this$0.mutableContent, checkbox, 'value', '' + checkValue);
}

var CHECKBOX_NODE_EVENT_HANDLER;
function CheckBox$1_2(){
  $clinit_554();
}

function CheckBox$1_1(){
}

_ = CheckBox$1_2.prototype = CheckBox$1_1.prototype = new NodeEventHandlerImpl;
_.getClass$ = function getClass_364(){
  return Lorg_waveprotocol_wave_client_doodad_form_check_CheckBox$1_2_classLit;
}
;
_.handleClick = function handleClick_1(element, event_0){
  setChecked(element, ($clinit_597() , checkArgument($equalsIgnoreCase('check', element.tagName_0)) , !($clinit_382() , $equalsIgnoreCase('true', dynamicCast($get_12(element.attributes, 'value'), 1))?TRUE:FALSE).value_0));
  event_0.shouldAllowDefault = true;
  return true;
}
;
_.castableTypeMap$ = {180:1};
function CheckBox$CheckBoxRendereringMutationHandler_0(){
}

function CheckBox$CheckBoxRendereringMutationHandler(){
}

_ = CheckBox$CheckBoxRendereringMutationHandler_0.prototype = CheckBox$CheckBoxRendereringMutationHandler.prototype = new RenderingMutationHandler;
_.createDomImpl = function createDomImpl_1(element){
  var inputElem, nonEditableSpan, e;
  inputElem = (e = $doc.createElement('INPUT') , e.type = 'checkbox' , e);
  inputElem.className = ($clinit_600() , 'GMQ4-KSBHG');
  nonEditableSpan = $doc.createElement('span');
  nonEditableSpan.setAttribute('contentEditable', 'false');
  nonEditableSpan.appendChild(inputElem);
  return nonEditableSpan;
}
;
_.getClass$ = function getClass_365(){
  return Lorg_waveprotocol_wave_client_doodad_form_check_CheckBox$CheckBoxRendereringMutationHandler_2_classLit;
}
;
_.onActivationStart = function onActivationStart_3(element){
  $each_2(element.attributes, new RenderingMutationHandler$1_0(this, element));
}
;
_.onAttributeModified = function onAttributeModified_1(element, name_0, oldValue, newValue){
  var checkboxElem, implNodelet;
  $equalsIgnoreCase('value', name_0) && (implNodelet = element.implNodelet , checkboxElem = implNodelet.firstChild , checkboxElem.checked = ($clinit_597() , checkArgument($equalsIgnoreCase('check', element.tagName_0)) , ($clinit_382() , $equalsIgnoreCase('true', dynamicCast($get_12(element.attributes, 'value'), 1))?TRUE:FALSE).value_0) , undefined);
}
;
_.castableTypeMap$ = {177:1, 179:1};
var instance_2 = null;
function $clinit_600(){
  $clinit_600 = nullMethod;
  css_2 = ($clinit_602() , $clinit_602() , css_3);
  !!css_2 && ($clinit_81() , $push_0(toInject, ($clinit_176() , '.GMQ4-KSBHG,.GMQ4-KSBIG{padding:4px;cursor:pointer;}')) , flush() , undefined);
}

var css_2;
function $clinit_602(){
  $clinit_602 = nullMethod;
  css_3 = new CheckConstants_Resources_en_InlineClientBundleGenerator$1_0;
}

var css_3 = null;
function CheckConstants_Resources_en_InlineClientBundleGenerator$1_0(){
}

function CheckConstants_Resources_en_InlineClientBundleGenerator$1(){
}

_ = CheckConstants_Resources_en_InlineClientBundleGenerator$1_0.prototype = CheckConstants_Resources_en_InlineClientBundleGenerator$1.prototype = new Object_0;
_.getClass$ = function getClass_366(){
  return Lorg_waveprotocol_wave_client_doodad_form_check_CheckConstants_1Resources_1en_1InlineClientBundleGenerator$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_604(){
  $clinit_604 = nullMethod;
  css_4 = ($clinit_606() , $clinit_606() , css_5);
  !!css_4 && ($clinit_81() , $push_0(toInject, ($clinit_176() , '')) , flush() , undefined);
}

function LabelRenderingMutationHandler_0(){
  $clinit_604();
}

function LabelRenderingMutationHandler(){
}

_ = LabelRenderingMutationHandler_0.prototype = LabelRenderingMutationHandler.prototype = new RenderingMutationHandler;
_.createDomImpl = function createDomImpl_2(element){
  var label;
  label = $doc.createElement('label');
  label.className = 'GMQ4-KSBJG';
  return $setContainerNodelet(element, label) , label;
}
;
_.getClass$ = function getClass_367(){
  return Lorg_waveprotocol_wave_client_doodad_form_check_LabelRenderingMutationHandler_2_classLit;
}
;
_.onActivationStart = function onActivationStart_4(element){
  $each_2(element.attributes, new RenderingMutationHandler$1_0(this, element));
}
;
_.onAttributeModified = function onAttributeModified_2(element, name_0, oldValue, newValue){
  $equals_3('for', name_0) && (element.implNodelet.htmlFor = element.context.this$0.documentUniqueString + newValue , undefined);
}
;
_.castableTypeMap$ = {177:1, 179:1};
var css_4, instance_3 = null;
function $clinit_606(){
  $clinit_606 = nullMethod;
  css_5 = new LabelRenderingMutationHandler_Resources_en_InlineClientBundleGenerator$1_0;
}

var css_5 = null;
function LabelRenderingMutationHandler_Resources_en_InlineClientBundleGenerator$1_0(){
}

function LabelRenderingMutationHandler_Resources_en_InlineClientBundleGenerator$1(){
}

_ = LabelRenderingMutationHandler_Resources_en_InlineClientBundleGenerator$1_0.prototype = LabelRenderingMutationHandler_Resources_en_InlineClientBundleGenerator$1.prototype = new Object_0;
_.getClass$ = function getClass_368(){
  return Lorg_waveprotocol_wave_client_doodad_form_check_LabelRenderingMutationHandler_1Resources_1en_1InlineClientBundleGenerator$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_608(){
  $clinit_608 = nullMethod;
  RADIO_BUTTON_MUTATING_RENDERER = new RadioButton$1_0;
  RADIO_BUTTON_NODE_EVENT_HANDLER = new RadioButton$2_0;
}

function getGroup(element){
  $clinit_608();
  var group;
  group = $getElementByName_0(element.context, dynamicCast($get_12(element.attributes, 'group'), 1));
  return $clinit_611() , $equals_3(group.tagName_0, 'radiogroup')?group:null;
}

var RADIO_BUTTON_MUTATING_RENDERER, RADIO_BUTTON_NODE_EVENT_HANDLER;
function $onAttributeModified_1(element, name_0, newValue){
  var elementName, group, groupName, inputElement;
  if ($equalsIgnoreCase('group', name_0)) {
    inputElement = element.implNodelet;
    inputElement.name = element.context.this$0.documentUniqueString + newValue;
  }
   else if ($equalsIgnoreCase('name', name_0)) {
    $log_0(($clinit_672() , logger_1).traceLogger, 'myname: ' + dynamicCast($get_12(element.attributes, 'name'), 1));
    element.implNodelet.id = element.context.this$0.documentUniqueString + newValue;
  }
  groupName = dynamicCast($get_12(element.attributes, 'group'), 1);
  elementName = dynamicCast($get_12(element.attributes, 'name'), 1);
  if (groupName != null && elementName != null) {
    $log_0(($clinit_672() , logger_1).traceLogger, 'myname: ' + dynamicCast($get_12(element.attributes, 'name'), 1));
    group = getGroup(element);
    if (group) {
      $log_0(logger_1.traceLogger, 'selected: ' + dynamicCast($get_12(group.attributes, 'value'), 1));
      elementName != null && $equals_3(elementName, dynamicCast($get_12(group.attributes, 'value'), 1)) && (($clinit_608() , element.implNodelet).checked = true , undefined);
    }
     else {
      $log_0(logger_1.traceLogger, 'Cannot find associated group');
    }
  }
}

function RadioButton$1_0(){
}

function RadioButton$1(){
}

_ = RadioButton$1_0.prototype = RadioButton$1.prototype = new RenderingMutationHandler;
_.createDomImpl = function createDomImpl_3(element){
  var radioInputElement, elem;
  radioInputElement = (elem = $doc.createElement('INPUT') , elem.type = 'radio' , elem.name = 'xx' , elem);
  radioInputElement.className = ($clinit_600() , 'GMQ4-KSBIG');
  radioInputElement.tabIndex = 0;
  return radioInputElement;
}
;
_.getClass$ = function getClass_369(){
  return Lorg_waveprotocol_wave_client_doodad_form_check_RadioButton$1_2_classLit;
}
;
_.onActivationStart = function onActivationStart_5(element){
  $each_2(element.attributes, new RenderingMutationHandler$1_0(this, element));
}
;
_.onAttributeModified = function onAttributeModified_3(element, name_0, oldValue, newValue){
  $onAttributeModified_1(element, name_0, newValue);
}
;
_.castableTypeMap$ = {177:1, 179:1};
function RadioButton$2_0(){
  $clinit_554();
}

function RadioButton$2(){
}

_ = RadioButton$2_0.prototype = RadioButton$2.prototype = new NodeEventHandlerImpl;
_.getClass$ = function getClass_370(){
  return Lorg_waveprotocol_wave_client_doodad_form_check_RadioButton$2_2_classLit;
}
;
_.handleClick = function handleClick_2(element, event_0){
  var group, isContentChecked, isImplChecked;
  isImplChecked = !!($clinit_608() , element.implNodelet).checked;
  isContentChecked = $equalsIgnoreCase('true', dynamicCast($get_12(element.attributes, 'value'), 1));
  if (isImplChecked && !isContentChecked) {
    group = getGroup(element);
    !!group && ($clinit_611() , $setElementAttribute(group.context.this$0.mutableContent, group, 'value', dynamicCast($get_12(element.attributes, 'name'), 1)));
  }
  event_0.shouldAllowDefault = true;
  return true;
}
;
_.castableTypeMap$ = {180:1};
function $clinit_611(){
  $clinit_611 = nullMethod;
  RADIO_GROUP_MUTATION_HANDLER = new RadioGroup$1_0;
}

var RADIO_GROUP_MUTATION_HANDLER;
function $onAttributeModified_2(element, name_0, newValue){
  var checked, button;
  if ($equalsIgnoreCase('value', name_0)) {
    checked = (button = dynamicCast($get_12(element.context.this$0.nameMap, newValue), 152) , !!button && ($clinit_608() , $equals_3(button.tagName_0, 'radio'))?button:null);
    !!checked && (($clinit_608() , checked.implNodelet).checked = true , undefined);
  }
}

function RadioGroup$1_0(){
}

function RadioGroup$1(){
}

_ = RadioGroup$1_0.prototype = RadioGroup$1.prototype = new NodeMutationHandlerImpl;
_.getClass$ = function getClass_371(){
  return Lorg_waveprotocol_wave_client_doodad_form_check_RadioGroup$1_2_classLit;
}
;
_.onActivationStart = function onActivationStart_6(element){
  $each_2(element.attributes, new RenderingMutationHandler$1_0(this, element));
}
;
_.onAttributeModified = function onAttributeModified_4(element, name_0, oldValue, newValue){
  $onAttributeModified_2(element, name_0, newValue);
}
;
_.castableTypeMap$ = {179:1};
function isClickingEnabled(element){
  var child;
  for (child = element.firstChild_0; child; child = child.next) {
    if (!child.isTextNode() && $equals_3(dynamicCast(child, 152).tagName_0, 'click')) {
      return false;
    }
  }
  return true;
}

function ContentEvents$ContentEventsNodeHandler_0(){
  $clinit_554();
}

function ContentEvents$ContentEventsNodeHandler(){
}

_ = ContentEvents$ContentEventsNodeHandler_0.prototype = ContentEvents$ContentEventsNodeHandler.prototype = new NodeEventHandlerImpl;
_.getClass$ = function getClass_372(){
  return Lorg_waveprotocol_wave_client_doodad_form_events_ContentEvents$ContentEventsNodeHandler_2_classLit;
}
;
_.handleClick = function handleClick_3(element, event_0){
  if (isClickingEnabled(element)) {
    $insertXml(element.context.this$0.mutableContent, new Point$El_0(element, null), $wrap_2(new XmlStringBuilderDoc_0(null, ($clinit_1271() , ANY)), 'click'));
    return true;
  }
   else {
    $emptyElement(element.context.this$0.mutableContent, element);
    return true;
  }
}
;
_.castableTypeMap$ = {180:1};
var instance_4 = null;
function ContentEvents$ContentEventsNodeMutationHandler_0(){
}

function ContentEvents$ContentEventsNodeMutationHandler(){
}

_ = ContentEvents$ContentEventsNodeMutationHandler_0.prototype = ContentEvents$ContentEventsNodeMutationHandler.prototype = new NodeMutationHandlerImpl;
_.getClass$ = function getClass_373(){
  return Lorg_waveprotocol_wave_client_doodad_form_events_ContentEvents$ContentEventsNodeMutationHandler_2_classLit;
}
;
_.onAddedToParent = function onAddedToParent_1(element, oldParent){
}
;
_.onDescendantsMutated = function onDescendantsMutated_1(element){
}
;
_.castableTypeMap$ = {179:1};
var instance_5 = null;
function $maybeSplitForNewline(){
  throw new UnsupportedOperationException_1('No more paragraphs');
}

function ParagraphEventHandler_0(){
  $clinit_554();
}

function attributeKeptOnNewline(key, value){
  if ($equals_3('t', key)) {
    if ($equals_3('li', value)) {
      return true;
    }
    return false;
  }
  return true;
}

function indent_3(p, delta){
  $clinit_554();
  var indent;
  indent = max(0, ($clinit_827() , getIndent(dynamicCast($get_12(p.attributes, 'i'), 1))) + delta);
  $setElementAttribute(p.context.this$0.mutableContent, p, 'i', indent == 0?null:indent + '');
}

function ParagraphEventHandler(){
}

_ = ParagraphEventHandler_0.prototype = ParagraphEventHandler.prototype = new NodeEventHandlerImpl;
_.getClass$ = function getClass_374(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphEventHandler_2_classLit;
}
;
_.handleBackspaceAtBeginning = function handleBackspaceAtBeginning_0(p, event_0){
  throw new UnsupportedOperationException_1('No more paragraphs');
}
;
_.handleDeleteAtEnd = function handleDeleteAtEnd_0(p, event_0){
  throw new UnsupportedOperationException_1('No more paragraphs');
}
;
_.handleEnter = function handleEnter_0(p, event_0){
  this.maybeSplitForNewline(p, event_0.caret);
  return true;
}
;
_.maybeSplitForNewline = function maybeSplitForNewline(p, splitAt){
  return $maybeSplitForNewline(splitAt.offset >= 0?new Point$Tx_0(splitAt.container, splitAt.offset):new Point$El_0(splitAt.container, splitAt.nodeAfter));
}
;
_.castableTypeMap$ = {180:1};
function LinoTextEventHandler(){
}

_ = LinoTextEventHandler.prototype = new ParagraphEventHandler;
_.getClass$ = function getClass_375(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_LinoTextEventHandler_2_classLit;
}
;
_.handleBackspaceAtBeginning = function handleBackspaceAtBeginning_1(p, event_0){
  return true;
}
;
_.handleDeleteAtEnd = function handleDeleteAtEnd_1(p, event_0){
  return true;
}
;
_.maybeSplitForNewline = function maybeSplitForNewline_0(p, splitAt){
  return splitAt.offset >= 0?new Point$Tx_0(splitAt.container, splitAt.offset):new Point$El_0(splitAt.container, splitAt.nodeAfter);
}
;
_.castableTypeMap$ = {180:1};
function $clinit_618(){
  $clinit_618 = nullMethod;
  $clinit_554();
  css_6 = ($clinit_623() , $clinit_623() , css_7);
  !!css_6 && ($clinit_81() , $push_0(toInject, ($clinit_176() , '.GMQ4-KSBKG,.GMQ4-KSBLG{display:block;border:1px solid silver;padding:4px;margin:4px 0;}')) , flush() , undefined);
}

function Input_1(){
}

function Input_0(){
}

_ = Input_1.prototype = Input_0.prototype = new LinoTextEventHandler;
_.getClass$ = function getClass_376(){
  return Lorg_waveprotocol_wave_client_doodad_form_input_Input_2_classLit;
}
;
_.castableTypeMap$ = {180:1};
var css_6;
function $clinit_619(){
  $clinit_619 = nullMethod;
  BULLET_CLASSNAMES = initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['bullet-type-0', 'bullet-type-1', 'bullet-type-2']);
}

function $createDomImpl(this$static, element){
  var nodelet;
  nodelet = this$static.createNodelet(element);
  $appendSpacer(($clinit_838() , nodelet));
  return $setContainerNodelet(element, nodelet) , nodelet;
}

function $updateRendering(this$static, element, type, listStyle, indent, alignment, direction){
  var behaviour, bulletType, bulletType$array, bulletType$index, bulletType$max, factor, fontSize, fontWeight, headingNum, implNodelet, isListItem, margin, newNodelet, style, toListItem;
  implNodelet = element.implNodelet;
  behaviour = of(type);
  toListItem = behaviour == ($clinit_837() , LIST);
  isListItem = $equalsIgnoreCase(implNodelet.tagName, 'li');
  if (isListItem != toListItem) {
    newNodelet = $doc.createElement(toListItem?'li':this$static.implTagName);
    replaceElement(implNodelet, newNodelet);
    $setImplNodelets(element, newNodelet, newNodelet);
    $ensureSpacerIfDoesntEndWithText(($clinit_838() , element).implNodelet);
    implNodelet = newNodelet;
  }
  fontSize = -1;
  fontWeight = null;
  $removeClassName(implNodelet, 'numbered');
  switch (behaviour.ordinal) {
    case 2:
      $equals_3('decimal', listStyle) && $addClassName(implNodelet, 'numbered');
      break;
    case 1:
      fontWeight = ($clinit_52() , BOLD);
      headingNum = __parseAndValidateInt(type.substr(1, type.length - 1), 10);
      factor = 1 - (headingNum - 1) / 3;
      fontSize = 1 + factor * 0.75;
  }
  for (bulletType$array = BULLET_CLASSNAMES , bulletType$index = 0 , bulletType$max = bulletType$array.length; bulletType$index < bulletType$max; ++bulletType$index) {
    bulletType = bulletType$array[bulletType$index];
    $removeClassName(implNodelet, bulletType);
  }
  if (behaviour == LIST) {
    listStyle == null && $addClassName(implNodelet, BULLET_CLASSNAMES[indent % 3]);
    ++indent;
  }
  margin = indent * 22;
  style = implNodelet.style;
  fontSize != -1?(style['fontSize'] = fontSize + ($clinit_68() , 'em') , undefined):(style['fontSize'] = '' , undefined);
  fontWeight?(style['fontWeight'] = 'bold' , undefined):(style['fontWeight'] = '' , undefined);
  alignment?(style['textAlign'] = alignment.css , undefined):(style['textAlign'] = '' , undefined);
  direction?(style['direction'] = direction.css , undefined):(style['direction'] = '' , undefined);
  if (margin == 0) {
    style['marginLeft'] = '';
    style['marginRight'] = '';
  }
   else {
    if (direction == ($clinit_833() , RTL_0)) {
      style['marginRight'] = margin + ($clinit_68() , 'px');
      style['marginLeft'] = '';
    }
     else {
      style['marginLeft'] = margin + ($clinit_68() , 'px');
      style['marginRight'] = '';
    }
  }
}

function DefaultParagraphHtmlRenderer_0(){
  $clinit_619();
  this.implTagName = 'div';
}

function DefaultParagraphHtmlRenderer(){
}

_ = DefaultParagraphHtmlRenderer_0.prototype = DefaultParagraphHtmlRenderer.prototype = new Object_0;
_.createDomImpl = function createDomImpl_4(element){
  var nodelet;
  return nodelet = this.createNodelet(element) , $appendSpacer(($clinit_838() , nodelet)) , $setContainerNodelet(element, nodelet) , nodelet;
}
;
_.createNodelet = function createNodelet(element){
  return $doc.createElement(this.implTagName);
}
;
_.getClass$ = function getClass_377(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_DefaultParagraphHtmlRenderer_2_classLit;
}
;
_.castableTypeMap$ = {177:1};
_.implTagName = null;
var BULLET_CLASSNAMES;
function Input$1_0(){
  $clinit_619();
  this.implTagName = 'div';
}

function Input$1(){
}

_ = Input$1_0.prototype = Input$1.prototype = new DefaultParagraphHtmlRenderer;
_.createNodelet = function createNodelet_0(element){
  var e;
  e = setContentEditable($doc.createElement('span'), true, true);
  e.className = ($clinit_618() , 'GMQ4-KSBKG');
  return e;
}
;
_.getClass$ = function getClass_378(){
  return Lorg_waveprotocol_wave_client_doodad_form_input_Input$1_2_classLit;
}
;
_.castableTypeMap$ = {177:1};
function Input$2_0(){
}

function Input$2(){
}

_ = Input$2_0.prototype = Input$2.prototype = new Object_0;
_.createDomImpl = function createDomImpl_5(element){
  var e;
  e = setContentEditable($doc.createElement('textarea'), true, true);
  e.className = ($clinit_618() , 'GMQ4-KSBLG');
  return $setContainerNodelet(element, e) , e;
}
;
_.getClass$ = function getClass_379(){
  return Lorg_waveprotocol_wave_client_doodad_form_input_Input$2_2_classLit;
}
;
_.castableTypeMap$ = {177:1};
function $clinit_623(){
  $clinit_623 = nullMethod;
  css_7 = new Input_Resources_en_InlineClientBundleGenerator$1_0;
}

var css_7 = null;
function Input_Resources_en_InlineClientBundleGenerator$1_0(){
}

function Input_Resources_en_InlineClientBundleGenerator$1(){
}

_ = Input_Resources_en_InlineClientBundleGenerator$1_0.prototype = Input_Resources_en_InlineClientBundleGenerator$1.prototype = new Object_0;
_.getClass$ = function getClass_380(){
  return Lorg_waveprotocol_wave_client_doodad_form_input_Input_1Resources_1en_1InlineClientBundleGenerator$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_625(){
  $clinit_625 = nullMethod;
  css_8 = ($clinit_630() , $clinit_630() , css_9);
  !!css_8 && ($clinit_81() , $push_0(toInject, ($clinit_176() , '.GMQ4-KSBMG{display:block;border:1px solid silver;padding:4px;margin:4px 0;width:99%;}')) , flush() , undefined);
}

var css_8;
function $clinit_626(){
  $clinit_626 = nullMethod;
  $clinit_554();
  HANDLE = new Property$MutableProperty_0('handle');
}

function $handleTyping(this$static, p){
  this$static.isMutatingLocallyToMatchUserInput = true;
  try {
    $setElementAttribute(p.context.this$0.mutableContent, p, 'value', p.implNodelet.value);
  }
   finally {
    this$static.isMutatingLocallyToMatchUserInput = false;
  }
}

function Password$PasswordEventHandler_0(){
  $clinit_626();
}

function Password$PasswordEventHandler(){
}

_ = Password$PasswordEventHandler_0.prototype = Password$PasswordEventHandler.prototype = new NodeEventHandlerImpl;
_.getClass$ = function getClass_381(){
  return Lorg_waveprotocol_wave_client_doodad_form_input_Password$PasswordEventHandler_2_classLit;
}
;
_.handleBackspaceAtBeginning = function handleBackspaceAtBeginning_2(p, event_0){
  return true;
}
;
_.handleDeleteAtEnd = function handleDeleteAtEnd_2(p, event_0){
  return true;
}
;
_.handleEnter = function handleEnter_1(element, event_0){
  return true;
}
;
_.onActivated = function onActivated_1(element){
  $put_3(element.transientData, HANDLE.id_0, registerEventHandler(element.implNodelet, 'keyup', false, new Password$PasswordEventHandler$1_0(this, element)));
}
;
_.onDeactivated = function onDeactivated_4(element){
  $unregister(dynamicCastJso(element.transientData.backend.get(valueOf_0(HANDLE.id_0))));
}
;
_.castableTypeMap$ = {180:1};
_.isMutatingLocallyToMatchUserInput = false;
var HANDLE;
function Password$PasswordEventHandler$1_0(this$1, val$element){
  this.this$1 = this$1;
  this.val$element = val$element;
}

function Password$PasswordEventHandler$1(){
}

_ = Password$PasswordEventHandler$1_0.prototype = Password$PasswordEventHandler$1.prototype = new Object_0;
_.getClass$ = function getClass_382(){
  return Lorg_waveprotocol_wave_client_doodad_form_input_Password$PasswordEventHandler$1_2_classLit;
}
;
_.onJavaScriptEvent = function onJavaScriptEvent(name_0, event_0){
  $handleTyping(this.this$1, this.val$element);
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
_.val$element = null;
function Password$PasswordRenderer_0(eventHandler){
  this.eventHandler = eventHandler;
}

function Password$PasswordRenderer(){
}

_ = Password$PasswordRenderer_0.prototype = Password$PasswordRenderer.prototype = new RenderingMutationHandler;
_.createDomImpl = function createDomImpl_6(element){
  var passwordElement, e;
  passwordElement = (e = $doc.createElement('INPUT') , e.type = 'password' , e);
  $addClassName(passwordElement, ($clinit_625() , 'GMQ4-KSBMG'));
  return passwordElement;
}
;
_.getClass$ = function getClass_383(){
  return Lorg_waveprotocol_wave_client_doodad_form_input_Password$PasswordRenderer_2_classLit;
}
;
_.onActivationStart = function onActivationStart_7(element){
  $each_2(element.attributes, new RenderingMutationHandler$1_0(this, element));
}
;
_.onAttributeModified = function onAttributeModified_5(element, name_0, oldValue, newValue){
  $equals_3('value', name_0) && !this.eventHandler.isMutatingLocallyToMatchUserInput && (element.implNodelet.value = newValue , undefined);
}
;
_.castableTypeMap$ = {177:1, 179:1};
_.eventHandler = null;
function $clinit_630(){
  $clinit_630 = nullMethod;
  css_9 = new Password_Resources_en_InlineClientBundleGenerator$1_0;
}

var css_9 = null;
function Password_Resources_en_InlineClientBundleGenerator$1_0(){
}

function Password_Resources_en_InlineClientBundleGenerator$1(){
}

_ = Password_Resources_en_InlineClientBundleGenerator$1_0.prototype = Password_Resources_en_InlineClientBundleGenerator$1.prototype = new Object_0;
_.getClass$ = function getClass_384(){
  return Lorg_waveprotocol_wave_client_doodad_form_input_Password_1Resources_1en_1InlineClientBundleGenerator$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_632(){
  $clinit_632 = nullMethod;
  WEB_SCHEMES = newStringSet(initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['http', 'https', 'ftp', 'mailto']));
  LINK_KEYS = initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['link', 'link/auto', 'link/manual', 'link/wave']);
}

function inferWaveRef(rawString){
  var $e0, $e1, e;
  try {
    return $clinit_1501() , $decodeWaveRefFromPath(rawString);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 160)) {
      e = $e0;
      try {
        return of_2($deserialiseWaveId(rawString));
      }
       catch ($e1) {
        $e1 = caught_0($e1);
        if (instanceOf($e1, 161)) {
          throw e;
        }
         else 
          throw $e1;
      }
    }
     else 
      throw $e0;
  }
}

function normalizeLink(rawLinkValue){
  var $e0, e, parts, ref, scheme, matchObj;
  checkNotNull(rawLinkValue);
  rawLinkValue = $trim(rawLinkValue);
  parts = splitUri(rawLinkValue);
  scheme = parts != null?parts[0]:null;
  if ((matchObj = (new RegExp("(\\?[\\w\\-:@!\\$&'\\(\\)\\*\\+,;=\\/\\?\\.]+|)($|#([\\w\\-:@!\\$&'\\(\\)\\*\\+,;=\\/\\?\\.]+|$))")).exec(rawLinkValue) , matchObj == null?false:rawLinkValue == matchObj[0]) || scheme != null && $contains_7(WEB_SCHEMES, scheme)) {
    return rawLinkValue;
  }
  try {
    if ($equals_3('wave', scheme)) {
      ref = ($clinit_1501() , $decodeWaveRefFromPath(parts[1]));
    }
     else if (scheme == null) {
      ref = inferWaveRef(rawLinkValue);
    }
     else if ($equals_3('waveid', scheme)) {
      ref = inferWaveRef(parts[1]);
    }
     else {
      throw new Link$InvalidLinkException_1('Unsupported URL scheme: ' + scheme);
    }
    return 'wave://' + ($clinit_1501() , $encode(ref, ($clinit_1500() , PATH)));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 160)) {
      e = $e0;
      throw new Link$InvalidLinkException_0(e);
    }
     else 
      throw $e0;
  }
}

function splitUri(uri){
  var scheme;
  scheme = extractScheme(uri);
  if (scheme == null || uri.length <= scheme.length + 3) {
    return null;
  }
  return initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, [scheme, $substring(uri, scheme.length + 3)]);
}

--></script>
<script><!--
function toHrefFromUri(uri){
  $clinit_632();
  var $e0, ref;
  try {
    uri = normalizeLink(uri);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 159)) {
      return null;
    }
     else 
      throw $e0;
  }
  if (uri.indexOf('wave://') == 0) {
    try {
      ref = ($clinit_1501() , $decodeWaveRefFromPath(uri.substr(7, uri.length - 7)));
      return '#' + $encode(ref, ($clinit_1500() , PATH));
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 160)) {
        return null;
      }
       else 
        throw $e0;
    }
  }
  return uri;
}

var LINK_KEYS, WEB_SCHEMES;
function Link$InvalidLinkException_0(cause){
  this.fillInStackTrace();
  this.cause = cause;
  this.detailMessage = 'Invalid link. Should either be a web url\nor, a Wave ref in the form: wave://example.com/w+1234/~/conv+root/b+abcd\nor be a valid serialized wave id';
}

function Link$InvalidLinkException_1(message){
  this.fillInStackTrace();
  this.detailMessage = message;
}

function Link$InvalidLinkException(){
}

_ = Link$InvalidLinkException_1.prototype = Link$InvalidLinkException_0.prototype = Link$InvalidLinkException.prototype = new Exception;
_.getClass$ = function getClass_385(){
  return Lorg_waveprotocol_wave_client_doodad_link_Link$InvalidLinkException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 58:1, 143:1, 159:1};
function $clinit_634(){
  $clinit_634 = nullMethod;
  KEYS = newStringSet(($clinit_632() , LINK_KEYS));
  BOUNDARY_KEYS_0 = KEYS;
  boundaryFunc_0 = new LinkAnnotationHandler$1_0;
}

function LinkAnnotationHandler_0(painter){
  this.painter = painter;
}

function register_6(registries, augmenter){
  $clinit_634();
  var annotationRegistry, handler, painterRegistry;
  painterRegistry = registries.paintRegistry;
  handler = new LinkAnnotationHandler_0(painterRegistry.painter);
  annotationRegistry = registries.annotationHandlerRegistry;
  validatePrefix('link');
  $put_5(dynamicCast($modify_0(annotationRegistry.data_0), 162).handlers, 'link', handler);
  $registerBehaviour(annotationRegistry, 'link', new LinkAnnotationHandler$2_0(($clinit_1072() , CONTENT)));
  $registerBehaviour(annotationRegistry, 'link/manual', new LinkAnnotationHandler$2_0(CONTENT));
  $registerBehaviour(annotationRegistry, 'link/wave', new LinkAnnotationHandler$2_0(CONTENT));
  $registerPaintFunction(painterRegistry, KEYS, new LinkAnnotationHandler$RenderFunc_0(augmenter));
  $registerBoundaryFunction(painterRegistry, BOUNDARY_KEYS_0, boundaryFunc_0);
}

function LinkAnnotationHandler(){
}

_ = LinkAnnotationHandler_0.prototype = LinkAnnotationHandler.prototype = new Object_0;
_.getClass$ = function getClass_386(){
  return Lorg_waveprotocol_wave_client_doodad_link_LinkAnnotationHandler_2_classLit;
}
;
_.handleAnnotationChange = function handleAnnotationChange_0(bundle, start, end, key, newValue){
  $scheduleRepaint(this.painter, bundle, start, end);
}
;
_.castableTypeMap$ = {246:1};
_.painter = null;
var BOUNDARY_KEYS_0, KEYS, boundaryFunc_0;
function LinkAnnotationHandler$1_0(){
}

function LinkAnnotationHandler$1(){
}

_ = LinkAnnotationHandler$1_0.prototype = LinkAnnotationHandler$1.prototype = new Object_0;
_.apply_2 = function apply_3(localDoc, parent_0, nodeAfter, before, after, isEditing){
  var attributes, e, suggestion;
  if (!isEditing) {
    return null;
  }
  attributes = maybeCreateSuggestions();
  if (!attributes || attributes.entrySet.this$0.attributes.size_0() == 0) {
    return null;
  }
  e = $transparentCreate(localDoc, 'l:suggestion', attributes, dynamicCast(parent_0, 152), dynamicCast(nodeAfter, 163));
  if (!e) {
    return null;
  }
  suggestion = dynamicCast(e.transientData.backend.get(valueOf_0(($clinit_644() , HAS_SUGGESTIONS_PROP).id_0)), 164);
  $registerElement(e.context.this$0.editingConcerns.getSuggestionsManager(), suggestion);
  return e;
}
;
_.getClass$ = function getClass_387(){
  return Lorg_waveprotocol_wave_client_doodad_link_LinkAnnotationHandler$1_2_classLit;
}
;
_.castableTypeMap$ = {186:1};
function AnnotationBehaviour$DefaultAnnotationBehaviour_0(family){
  this.family = family;
}

function AnnotationBehaviour$DefaultAnnotationBehaviour(){
}

_ = AnnotationBehaviour$DefaultAnnotationBehaviour_0.prototype = AnnotationBehaviour$DefaultAnnotationBehaviour.prototype = new Object_0;
_.getAnnotationFamily = function getAnnotationFamily(){
  return this.family;
}
;
_.getBias = function getBias(left, right, cursor){
  return $clinit_1073() , NEITHER;
}
;
_.getClass$ = function getClass_388(){
  return Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$DefaultAnnotationBehaviour_2_classLit;
}
;
_.getPriority = function getPriority(){
  return 1;
}
;
_.replace_0 = function replace_0(inside, outside, type){
  return type == ($clinit_1074() , RICH_TEXT)?($clinit_1076() , NEITHER_0):($clinit_1076() , INSIDE);
}
;
_.castableTypeMap$ = {247:1};
_.family = null;
function LinkAnnotationHandler$2_0($anonymous0){
  this.family = $anonymous0;
}

function LinkAnnotationHandler$2(){
}

_ = LinkAnnotationHandler$2_0.prototype = LinkAnnotationHandler$2.prototype = new AnnotationBehaviour$DefaultAnnotationBehaviour;
_.getBias = function getBias_0(left, right, cursor){
  var ret;
  ret = new Box_1(($clinit_1073() , NEITHER));
  $each_3(($clinit_634() , KEYS), new LinkAnnotationHandler$2$1_0(left, ret, right));
  return dynamicCast(ret.boxed, 105);
}
;
_.getClass$ = function getClass_389(){
  return Lorg_waveprotocol_wave_client_doodad_link_LinkAnnotationHandler$2_2_classLit;
}
;
_.getPriority = function getPriority_0(){
  return 10;
}
;
_.castableTypeMap$ = {247:1};
function LinkAnnotationHandler$2$1_0(val$left, val$ret, val$right){
  this.val$left = val$left;
  this.val$ret = val$ret;
  this.val$right = val$right;
}

function LinkAnnotationHandler$2$1(){
}

_ = LinkAnnotationHandler$2$1_0.prototype = LinkAnnotationHandler$2$1.prototype = new Object_0;
_.apply_3 = function apply_4(key){
  $get_12(this.val$left, key) != null?(this.val$ret.boxed = ($clinit_1073() , RIGHT_3)):$get_12(this.val$right, key) != null && (this.val$ret.boxed = ($clinit_1073() , LEFT_3));
}
;
_.getClass$ = function getClass_390(){
  return Lorg_waveprotocol_wave_client_doodad_link_LinkAnnotationHandler$2$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$left = null;
_.val$ret = null;
_.val$right = null;
function LinkAnnotationHandler$RenderFunc_0(augmenter){
  this.augmenter = augmenter;
}

function LinkAnnotationHandler$RenderFunc(){
}

_ = LinkAnnotationHandler$RenderFunc_0.prototype = LinkAnnotationHandler$RenderFunc.prototype = new Object_0;
_.apply_1 = function apply_5(from, isEditing){
  var content_0, ret, ret_0, map;
  content_0 = ($clinit_634() , ret_0 = null , from.containsKey('link')?(ret_0 = toHrefFromUri(dynamicCast(from.get('link'), 1))):from.containsKey('link/manual')?(ret_0 = toHrefFromUri(dynamicCast(from.get('link/manual'), 1))):from.containsKey('link/wave')?(ret_0 = toHrefFromUri(dynamicCast(from.get('link/wave'), 1))):from.containsKey('link/auto') && (ret_0 = toHrefFromUri(dynamicCast(from.get('link/auto'), 1))) , ret_0 != null?ret_0:null);
  content_0 != null?(ret = ($clinit_430() , map = new HashMap_1(1) , map.put('link', content_0) , new Collections$UnmodifiableMap_0(map))):(ret = ($clinit_430() , $clinit_430() , EMPTY_MAP));
  return this.augmenter.augment(from, isEditing, ret);
}
;
_.getClass$ = function getClass_391(){
  return Lorg_waveprotocol_wave_client_doodad_link_LinkAnnotationHandler$RenderFunc_2_classLit;
}
;
_.castableTypeMap$ = {185:1};
_.augmenter = null;
function $clinit_641(){
  $clinit_641 = nullMethod;
  LINK_RANGE_TRACKER_PROP = new Property$ImmutableProperty_0('link_rangetracker');
  plugins = new ArrayList_0;
  $clinit_81();
  $push_0(toInject, ($clinit_176() , "a.GMQ4-KSBLH,a.GMQ4-KSBIH,a.GMQ4-KSBGH{display:block;color:#003ea8;background-color:white;cursor:pointer;padding:3px 20px 4px 20px;margin:0 -2px !important;text-decoration:none;}.GMQ4-KSBHH a.GMQ4-KSBLH,.GMQ4-KSBHH a.GMQ4-KSBIH,.GMQ4-KSBHH a.GMQ4-KSBGH{color:white;background-color:#4086ff;text-decoration:none;}.GMQ4-KSBHH a.GMQ4-KSBLH label,.GMQ4-KSBHH a.GMQ4-KSBIH label{color:#c0d4ff;}.GMQ4-KSBLH label,.GMQ4-KSBIH label{margin-right:5px;text-decoration:underline;color:#7295cf;}.GMQ4-KSBLH span{font-weight:bold;text-decoration:none;}.GMQ4-KSBIH span{font-style:italic;text-decoration:none;}.GMQ4-KSBIH{background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHRJREFUeNpiYIABuxX/GQgAJmIVggAjEQo3AnEDw6GIC4woJh+KYERRZreCH0gmgBUzMDgyorgZXTFCrh5IKjDBBXAphIANQGzAxEAcEECEBmHgAMQXGPEqsVuhAPVgPsgZLDgUwYLzARAfACkE+ukhQIABAKZuHUYsPLRcAAAAAElFTkSuQmCC');background-repeat:no-repeat;background-position:5px 50%;}.GMQ4-KSBHH a.GMQ4-KSBIH{background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAGZJREFUeNpiYICC/0DAQAAwEasQrBhZ4X/sYAMQGzCgK0I3CSjED8T5QPwepIERWQMjEGCzHihVD6QUiHEqSLE+EJ9nYiAOCMBDgwjgAMQXCFmvAMQNUA/K41IEA/eBeD5MIUCAAQCexWwv78dj0QAAAABJRU5ErkJggg==');background-repeat:no-repeat;background-position:5px 50%;}.GMQ4-KSBGH span{margin-left:12px;text-decoration:none;}.GMQ4-KSBKH{width:100%;margin-top:1px;height:1px;border-top:1px solid #e3e8f2;}.GMQ4-KSBJH{background:#d0e8ff;}"));
  schedule();
}

function $findLinkAnnotationRange(this$static, doc){
  var key, key$array, key$index, key$max, range;
  for (key$array = ($clinit_632() , LINK_KEYS) , key$index = 0 , key$max = key$array.length; key$index < key$max; ++key$index) {
    key = key$array[key$index];
    range = getRangePrecedingElement(doc, this$static.contentElement, key);
    if (range) {
      return range;
    }
  }
  return null;
}

function $getOrCreateRangeTracker(context){
  var docElement, ret;
  docElement = dynamicCast(context.this$0.mutableContent.doc.substrate.getDocumentElement(), 152);
  ret = dynamicCast(docElement.transientData.backend.get(valueOf_0(LINK_RANGE_TRACKER_PROP.id_0)), 165);
  if (!ret) {
    ret = new RangeTracker_0(context.this$0.localAnnotations, 'current_link');
    $put_3(docElement.transientData, LINK_RANGE_TRACKER_PROP.id_0, ret);
  }
  return ret;
}

function $populateSuggestionMenu(this$static){
  var plugin$iterator, replaceRange;
  replaceRange = $findLinkAnnotationRange(this$static, this$static.contentElement.context.this$0.mutableContent);
  !!replaceRange && $trackRange(this$static.replacementRangeHelper, replaceRange);
  for (plugin$iterator = new AbstractList$IteratorImpl_0(plugins); plugin$iterator.i < plugin$iterator.this$0_0.size_0();) {
    throwClassCastExceptionUnlessNull($next_6(plugin$iterator));
    null.nullMethod(this$static.contentElement.context.this$0);
  }
}

function Suggestion_0(contentElement, documentContext){
  $clinit_641();
  this.contentElement = contentElement;
  this.replacementRangeHelper = $getOrCreateRangeTracker(documentContext);
}

function maybeCreateSuggestions(){
  $clinit_641();
  var attributes, plugin$iterator;
  attributes = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  for (plugin$iterator = new AbstractList$IteratorImpl_0(plugins); plugin$iterator.i < plugin$iterator.this$0_0.size_0();) {
    throwClassCastExceptionUnlessNull($next_6(plugin$iterator));
    null.nullMethod();
  }
  return new AttributesImpl_1(copyToJavaMap(attributes, new HashMap_0));
}

function register_7(handlerRegistry){
  $clinit_641();
  var renderer;
  renderer = new SuggestionRenderer_0;
  $put_5(dynamicCast($modify_0(handlerRegistry.data_0), 151).renderers, 'l:suggestion', renderer);
}

function Suggestion(){
}

_ = Suggestion_0.prototype = Suggestion.prototype = new Object_0;
_.getClass$ = function getClass_392(){
  return Lorg_waveprotocol_wave_client_doodad_suggestion_Suggestion_2_classLit;
}
;
_.castableTypeMap$ = {164:1};
_.contentElement = null;
_.replacementRangeHelper = null;
var LINK_RANGE_TRACKER_PROP, plugins;
function SuggestionButton_0(element){
  var clickButton;
  clickButton = createIconClickButton(($clinit_1041() , LIGHTBULB), new SuggestionButton$1_0(element));
  clickButton.element_0.style['display'] = ($clinit_47() , 'inline-block');
  $add_0(($clinit_333() , get_0()), clickButton);
  this.element = clickButton.element_0;
  $clinit_962();
  this.element[TRANSPARENCY] = ($clinit_1371() , DEEP);
  this.element.setAttribute('contentEditable', 'false');
}

function SuggestionButton(){
}

_ = SuggestionButton_0.prototype = SuggestionButton.prototype = new Object_0;
_.getClass$ = function getClass_393(){
  return Lorg_waveprotocol_wave_client_doodad_suggestion_SuggestionButton_2_classLit;
}
;
_.castableTypeMap$ = {};
_.element = null;
function $onClick(this$static){
  var suggestion;
  suggestion = dynamicCast(this$static.val$element.transientData.backend.get(valueOf_0(($clinit_644() , HAS_SUGGESTIONS_PROP).id_0)), 164);
  $showSuggestionsFor(this$static.val$element.context.this$0.editingConcerns.getSuggestionsManager(), suggestion);
}

function SuggestionButton$1_0(val$element){
  this.val$element = val$element;
}

function SuggestionButton$1(){
}

_ = SuggestionButton$1_0.prototype = SuggestionButton$1.prototype = new Object_0;
_.getClass$ = function getClass_394(){
  return Lorg_waveprotocol_wave_client_doodad_suggestion_SuggestionButton$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$element = null;
function $clinit_644(){
  $clinit_644 = nullMethod;
  HAS_SUGGESTIONS_PROP = new Property$ImmutableProperty_0('has-suggestions');
}

function SuggestionRenderer_0(){
  $clinit_644();
}

function SuggestionRenderer(){
}

_ = SuggestionRenderer_0.prototype = SuggestionRenderer.prototype = new Object_0;
_.createDomImpl = function createDomImpl_7(element){
  var display, nodelet, suggestions;
  suggestions = new Suggestion_0(element, element.context);
  $put_3(element.transientData, HAS_SUGGESTIONS_PROP.id_0, suggestions);
  display = new SuggestionButton_0(element);
  nodelet = $doc.createElement('l:suggestion');
  nodelet.setAttribute('contentEditable', 'false');
  return display.element;
}
;
_.getClass$ = function getClass_395(){
  return Lorg_waveprotocol_wave_client_doodad_suggestion_SuggestionRenderer_2_classLit;
}
;
_.castableTypeMap$ = {177:1};
var HAS_SUGGESTIONS_PROP;
function $clinit_645(){
  $clinit_645 = nullMethod;
  ROOT_HANDLER_REGISTRY = ($clinit_681() , ROOT);
  ROOT_ANNOTATION_REGISTRY = ($clinit_1342() , ROOT_0);
  ROOT_PAINT_REGISTRY = new PainterRegistryImpl_0(new AnnotationPainter_0((!instance_6 && (instance_6 = new BrowserBackedScheduler_0 , setDefaultTimerService() , undefined) , medium)));
  ROOT_REGISTRIES = new RegistriesImpl_0(ROOT_HANDLER_REGISTRY, ROOT_ANNOTATION_REGISTRY, ROOT_PAINT_REGISTRY);
  TAB_TARGETS = newStringSet(initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, []));
}

var ROOT_ANNOTATION_REGISTRY, ROOT_HANDLER_REGISTRY, ROOT_PAINT_REGISTRY, ROOT_REGISTRIES, TAB_TARGETS;
function $annotationIntervals(this$static, start, end, keys){
  checkPositionIndexesInRange(start, end, this$static.tree.sentinel.left_0.subtreeLength - 1);
  return !keys || $isSubsetOf(this$static.tree.knownKeys, keys)?new GenericAnnotationIntervalIterable_0(this$static, start, end, this$static.tree.knownKeys):new GenericAnnotationIntervalIterable_0(this$static, start, end, keys);
}

function $begin(this$static){
  if (this$static.cursor != -1) {
    throw new IllegalStateException_1('begin() called twice with no finish() in between');
  }
  this$static.openAnnotations.backend.clear();
  this$static.currentlyNotifying || $clear_5(this$static.queuedNotifications);
  this$static.cursor = 0;
  this$static.inheritedAnnotationsForInsertion = ($clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
}

function $collectAllAnnotationsAt(this$static, position, accu){
  checkElementIndex(position, this$static.tree.sentinel.left_0.subtreeLength - 1);
  $collectAllAnnotationsAtRaw(this$static.tree, position + 1, accu);
}

function $endAnnotationUnchecked(this$static, key){
  var a_0, end;
  a_0 = dynamicCast($getExisting(this$static.openAnnotations, key), 215);
  $remove_25(this$static.openAnnotations, key);
  end = this$static.cursor;
  $setAnnotation_2(this$static.tree, a_0.start, end, a_0.key, a_0.value_0);
  $queueNotification(this$static, a_0.start, end, a_0.key, a_0.value_0);
}

function $finish(this$static){
  var n;
  this$static.openAnnotations.backend.isEmpty() || $each_2(this$static.openAnnotations, new AnnotationTree$1_0);
  if (this$static.cursor == -1) {
    throw new IllegalStateException_1('finish() called with no matching begin()');
  }
  this$static.cursor = -1;
  this$static.inheritedAnnotationsForInsertion = null;
  $cleanupKnownKeys(this$static.tree);
  if (!this$static.currentlyNotifying) {
    try {
      this$static.currentlyNotifying = true;
      while (this$static.queuedNotifications.size != 0) {
        n = dynamicCast($removeFirst(this$static.queuedNotifications), 214);
        !!n.this$0.listener && $onAnnotationChange(n.this$0.listener, n.start, n.end, n.key, n.value_0);
      }
    }
     finally {
      $clear_5(this$static.queuedNotifications);
      this$static.currentlyNotifying = false;
    }
  }
}

function $firstAnnotationChange(this$static, start, end, key, fromValue){
  checkPositionIndexesInRange(start, end, this$static.tree.sentinel.left_0.subtreeLength - 1);
  checkNotNull_1(key, 'Key must not be null');
  return $firstAnnotationChange_4(this$static.tree, start, end, key, fromValue);
}

function $getAnnotation(this$static, location_0, key){
  checkElementIndex(location_0, this$static.tree.sentinel.left_0.subtreeLength - 1);
  checkNotNull_1(key, 'Key must not be null');
  return $getAnnotation_5(this$static.tree, location_0, key);
}

function $lastAnnotationChange(this$static, start, end, key, fromValue){
  checkPositionIndexesInRange(start, end, this$static.tree.sentinel.left_0.subtreeLength - 1);
  checkNotNull_1(key, 'Key must not be null');
  return $lastAnnotationChange_4(this$static.tree, start, end, key, fromValue);
}

function $queueNotification(this$static, start, end, key, value){
  var n, p;
  if (this$static.queuedNotifications.size != 0) {
    p = dynamicCast($getLast_0(this$static.queuedNotifications), 214);
    if (p.end == start && $equals_3(p.key, key) && equal_0(p.value_0, value)) {
      p.end = end;
      return;
    }
  }
  n = new AnnotationTree$Notification_0(this$static, start, end, key, value);
  $add_12(this$static.queuedNotifications, n);
}

function $rangedAnnotations(this$static, start, end, keys){
  checkPositionIndexesInRange(start, end, this$static.tree.sentinel.left_0.subtreeLength - 1);
  !keys && (keys = this$static.tree.knownKeys);
  return new GenericRangedAnnotationIterable_0(this$static, start, end, keys);
}

function $skip(this$static, distance){
  if (distance > this$static.tree.sentinel.left_0.subtreeLength - 1 - this$static.cursor) {
    throw new OpCursorException_0('Attempt to skip beyond end of document (cursor at ' + this$static.cursor + ', size is ' + (this$static.tree.sentinel.left_0.subtreeLength - 1) + ', distance is ' + distance + ')');
  }
  this$static.cursor += distance;
  $updateInheritedAnnotationsFromPosition(this$static, this$static.cursor - 1);
}

function $startAnnotation(this$static, key, value){
  if (key.charCodeAt(0) != 64 && value != null && !(value != null && value.castableTypeMap$ && !!value.castableTypeMap$[1])) {
    throw new IllegalArgumentException_1('Attempt to store a non-string object in a non-local annotation: ' + key + '=' + value);
  }
  if ($containsKey_5(this$static.openAnnotations, key)) {
    if (equal_0(value, dynamicCast($getExisting(this$static.openAnnotations, key), 215).value_0)) {
      return;
    }
    $endAnnotationUnchecked(this$static, key);
  }
  $put_5(this$static.openAnnotations, key, new AnnotationTree$OpenAnnotation_0(this$static.cursor, key, value));
}

function $updateInheritedAnnotationsFromPosition(this$static, position){
  $collectAllAnnotationsAt(this$static, position, this$static.inheritedAnnotationsForInsertion);
}

function AnnotationTree_0(oneValue, anotherValue, listener){
  $clinit_1445();
  this.openAnnotations = new CollectionUtils$StringMapAdapter_0(new HashMap_0);
  this.queuedNotifications = new LinkedList_0;
  checkNotNull_1(oneValue, 'The argument oneValue must not be null');
  checkNotNull_1(anotherValue, 'The argument anotherValue must not be null');
  checkArgument_0(!equals__devirtual$(oneValue, anotherValue), 'The arguments oneValue and anotherValue must not be equal');
  this.tree = new BasicAnnotationTree_0(oneValue, anotherValue);
  this.listener = listener;
}

function AnnotationTree(){
}

_ = AnnotationTree_0.prototype = AnnotationTree.prototype = new Object_0;
_.annotationIntervals = function annotationIntervals(start, end, keys){
  return checkPositionIndexesInRange(start, end, this.tree.sentinel.left_0.subtreeLength - 1) , !keys || $isSubsetOf(this.tree.knownKeys, keys)?new GenericAnnotationIntervalIterable_0(this, start, end, this.tree.knownKeys):new GenericAnnotationIntervalIterable_0(this, start, end, keys);
}
;
_.begin = function begin_0(){
  $begin(this);
}
;
_.delete_$ = function delete_$(deleteSize){
  if (deleteSize > this.tree.sentinel.left_0.subtreeLength - 1 - this.cursor) {
    throw new OpCursorException_0('Attempt to delete beyond end of document (cursor at ' + this.cursor + ', size is ' + (this.tree.sentinel.left_0.subtreeLength - 1) + ', deleteSize is ' + deleteSize + ')');
  }
  $collectAllAnnotationsAt(this, this.cursor + deleteSize - 1, this.inheritedAnnotationsForInsertion);
  $delete(this.tree, this.cursor, this.cursor + deleteSize);
}
;
_.endAnnotation = function endAnnotation(key){
  $endAnnotationUnchecked(this, key);
}
;
_.finish = function finish(){
  $finish(this);
}
;
_.firstAnnotationChange = function firstAnnotationChange(start, end, key, fromValue){
  return checkPositionIndexesInRange(start, end, this.tree.sentinel.left_0.subtreeLength - 1) , checkNotNull_1(key, 'Key must not be null') , $firstAnnotationChange_4(this.tree, start, end, key, fromValue);
}
;
_.forEachAnnotationAt = function forEachAnnotationAt(index, callback){
  checkElementIndex(index, this.tree.sentinel.left_0.subtreeLength - 1);
  $forEachAnnotationAtRaw(this.tree, index + 1, callback);
}
;
_.getAnnotation = function getAnnotation(location_0, key){
  return checkElementIndex(location_0, this.tree.sentinel.left_0.subtreeLength - 1) , checkNotNull_1(key, 'Key must not be null') , $getAnnotation_5(this.tree, location_0, key);
}
;
_.getClass$ = function getClass_396(){
  return Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree_2_classLit;
}
;
_.getInherited = function getInherited(key){
  return key.charCodeAt(0) != 64?dynamicCast($get_13(this.inheritedAnnotationsForInsertion, key, null), 1):null;
}
;
_.insert = function insert(insertSize){
  var end, start;
  $insertRaw(this.tree, this.cursor + 1, insertSize);
  start = this.cursor;
  end = this.cursor + insertSize;
  $each_2(this.inheritedAnnotationsForInsertion, new AnnotationTree$2_0(this, start, end));
  $each_3(this.tree.knownKeys, new AnnotationTree$3_0(this, start, end));
  this.cursor += insertSize;
}
;
_.knownKeysLive = function knownKeysLive(){
  return this.tree.knownKeys;
}
;
_.lastAnnotationChange = function lastAnnotationChange(start, end, key, fromValue){
  return checkPositionIndexesInRange(start, end, this.tree.sentinel.left_0.subtreeLength - 1) , checkNotNull_1(key, 'Key must not be null') , $lastAnnotationChange_4(this.tree, start, end, key, fromValue);
}
;
_.rangedAnnotations = function rangedAnnotations_0(start, end, keys){
  return $rangedAnnotations(this, start, end, keys);
}
;
_.size_0 = function size_26(){
  return this.tree.sentinel.left_0.subtreeLength - 1;
}
;
_.skip = function skip(distance){
  $skip(this, distance);
}
;
_.startAnnotation = function startAnnotation(key, value){
  $startAnnotation(this, key, value);
}
;
_.castableTypeMap$ = {};
_.currentlyNotifying = false;
_.cursor = -1;
_.inheritedAnnotationsForInsertion = null;
_.listener = null;
_.tree = null;
function $clinit_647(){
  $clinit_647 = nullMethod;
  ONE_OBJECT = new Object_1;
  ANOTHER_OBJECT = new Object_1;
}

function EditorAnnotationTree_0(listener){
  $clinit_647();
  AnnotationTree_0.call(this, ONE_OBJECT, ANOTHER_OBJECT, listener);
}

function EditorAnnotationTree(){
}

_ = EditorAnnotationTree_0.prototype = EditorAnnotationTree.prototype = new AnnotationTree;
_.getClass$ = function getClass_397(){
  return Lorg_waveprotocol_wave_client_editor_EditorAnnotationTree_2_classLit;
}
;
_.castableTypeMap$ = {};
var ANOTHER_OBJECT, ONE_OBJECT;
function $clinit_649(){
  $clinit_649 = nullMethod;
  $clinit_81();
  $push_0(toInject, ($clinit_176() , '.editor{position:relative;line-height:1.35;z-index:0;text-align:left;direction:ltr;}.oldBlipUi.editor{min-height:33px;}.newBlipUi.editor{margin-left:36px;margin-top:4px;}.document{text-align:left;direction:ltr;white-space:pre-wrap;}.document p{margin:0 0 0 0;}.document:focus{outline:0;}.simulated-li{display:list-item;list-style-type:disc;list-style-position:outside;}.numbered{list-style-type:decimal;}.bullet-type-0{list-style-type:disc;}.bullet-type-1{list-style-type:circle;}.bullet-type-2{list-style-type:square;}'));
  flush();
  nativeSetupWebDriverTestPins_0();
  $clinit_973();
  checkNotNull_1(new EditorImpl$7_0, 'null mutationListener');
}

function $checkContextConsistency(this$static){
  if (!(!(!!this$static.pasteExtractor && this$static.pasteExtractor.busy) && !(!!this$static.typing && ($isBusy(this$static.typing) || this$static.domMutationReverter.entries.size != 0)))) {
    !!this$static.content_0 && $flush_4(this$static.typing);
    $log_0(($clinit_672() , logger_1).errorLogger, 'Editor context methods called while editor is not consistent.');
  }
}

function $clearContent(this$static){
  var oldSink;
  if (this$static.content_0) {
    $updateDocumentEditState(this$static, false);
    $clinit_672();
    ++ignoreMutations;
    try {
      $each_0(this$static.domHandlers);
      $clearImpl(this$static.domHandlers.backend);
      if (this$static.ownsDocument) {
        this$static.div.removeChild(dynamicCast(this$static.content_0.fullContentView.inner_0.getDocumentElement(), 152).implNodelet);
      }
       else {
        oldSink = $replaceOutgoingSink(this$static.content_0, this$static.innerOutputSink);
        if (oldSink != this$static.outgoingOperationSink) {
          throw new RuntimeException_1('Document had a mysterious sink.  Restoration is unsafe');
        }
        $removeClassName(this$static.div, 'editor');
      }
    }
     finally {
      --ignoreMutations;
    }
  }
  this$static.content_0 = null;
}

function $debugConnectOpSinks(this$static, isConnected){
  var op, op$iterator;
  if (this$static.permitOperations == isConnected) {
    return;
  }
  this$static.permitOperations = isConnected;
  if (this$static.permitOperations) {
    for (op$iterator = new AbstractList$IteratorImpl_0(this$static.suppressedOutgoingOps); op$iterator.i < op$iterator.this$0_0.size_0();) {
      op = dynamicCast($next_6(op$iterator), 173);
      $consume_0(this$static.outgoingOperationSink, op);
    }
    this$static.suppressedOutgoingOps = null;
    $clinit_1010();
    $schedule_2(scheduler_0, ($clinit_1013() , LOW), this$static.consistencyQueue);
  }
   else {
    this$static.suppressedOutgoingOps = new ArrayList_0;
  }
}

function $debugToggleDebugDialog(this$static){
  var popup, debugDialog, listener, positioner, popup_1;
  popup = (!this$static.debugPopup && (this$static.debugPopup = (debugDialog = new DebugDialog_0(this$static) , positioner = new DebugPopupFactory$1_0 , listener = new DebugPopupFactory$2_0(debugDialog) , $clinit_672() , popup_1 = new Popup_0(positioner) , $add_1(popup_1.popupPanel, debugDialog) , $add_9(popup_1.listeners, listener) , popup_1)) , this$static.debugPopup);
  popup.showing?$hide_0(popup):$show_0(popup);
}

function $doSaveSelection(this$static){
  var range;
  if (this$static.passiveSelectionHelper) {
    range = $getSelectionRange(this$static.passiveSelectionHelper);
    !!range && $trackRange_0(this$static.savedSelection, range);
  }
}

function $editorRelevantEvent(this$static, event_0){
  return this$static.editing || $isTargetEditableInDisplayMode(event_0) || $equals_3('copy', event_0.nativeEvent.type);
}

function $fireKeyboardEvent(this$static, evt){
  var handled, l_0, l$iterator, outerIter, entry;
  handled = false;
  if (this$static.keySignalListeners) {
    for (l$iterator = (outerIter = $keySet(this$static.keySignalListeners.map).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter)); l$iterator.val$outerIter.hasNext();) {
      l_0 = dynamicCast((entry = dynamicCast(l$iterator.val$outerIter.next_0(), 66) , entry.getKey()), 170);
      handled = l_0.onKeySignal(this$static, evt) || handled;
    }
  }
  return handled;
}

function $flush(this$static, resume){
  if (this$static.permitOperations && $isConsistent(this$static)) {
    $execute_0(this$static.consistencyQueue);
    return true;
  }
   else {
    $log_0(($clinit_672() , logger_1).traceLogger, 'Deferring incoming operation');
    $schedule_0(this$static.consistencyQueue, resume);
    return false;
  }
}

function $flushSynchronous(this$static){
  !!this$static.content_0 && $flush_4(this$static.typing);
}

--></script>
<script><!--
function $generateReplaceTextOp(this$static, at, deletionSize, text){
  var builder;
  builder = new Nindo$Builder_0;
  $add_9(builder.mutationList, new Nindo$Skip_0(at));
  if (deletionSize > 0) {
    $supplementAnnotations(this$static.annotationLogic, at, ($clinit_1073() , RIGHT_3), ($clinit_1074() , PLAIN_TEXT));
    $add_9(builder.mutationList, new Nindo$DeleteCharacters_0(deletionSize));
  }
  if (text.length > 0) {
    $buildAnnotationStarts(this$static.caretStyles, builder);
    !text.length || $add_9(builder.mutationList, new Nindo$Characters_0(text));
    $buildAnnotationEnds(this$static.caretStyles, builder);
  }
  return new Nindo_0(builder.mutationList);
}

function $getDocument(this$static){
  $checkContextConsistency(this$static);
  return this$static.content_0.mutableContent;
}

function $getSelectionHelper(this$static){
  checkState(!!this$static.passiveSelectionHelper, 'Using the selection helper of an editor not set up.');
  $checkContextConsistency(this$static);
  return this$static.passiveSelectionHelper;
}

function $init_4(this$static, registries, bindings){
  checkState(this$static.ownsDocument == !!registries, 'Can only set registries on owned documents');
  this$static.registries = registries;
  this$static.keyBindings = bindings;
  this$static.eventHandler = new EditorEventHandler_0(new EditorImpl$EditorInteractorImpl_0(this$static), this$static.eventsSubHandler, ($clinit_782() , INSTANCE_6));
  $setEditing(this$static, false);
}

function $insertText(this$static, at, text, isReplace){
  var builder, location_0;
  text = $coerceString(($clinit_1271() , text));
  location_0 = $getLocation_0(this$static.content_0.mutableContent, getFilteredPoint(this$static.content_0.persistentContentView, at));
  isReplace || $supplementAnnotations(this$static.annotationLogic, location_0, this$static.currentSelectionBias, ($clinit_1074() , PLAIN_TEXT));
  builder = new Nindo$Builder_0;
  $add_9(builder.mutationList, new Nindo$Skip_0(location_0));
  $buildAnnotationStarts(this$static.caretStyles, builder);
  !text.length || $add_9(builder.mutationList, new Nindo$Characters_0(text));
  $buildAnnotationEnds(this$static.caretStyles, builder);
  $hackConsume(this$static.content_0.mutableContent, new Nindo_0(builder.mutationList));
  return $locate_0(this$static.content_0.mutableContent.doc, location_0 + text.length);
}

function $isConsistent(this$static){
  if (!this$static.content_0) {
    return true;
  }
  return !(!!this$static.pasteExtractor && this$static.pasteExtractor.busy) && !(!!this$static.typing && ($isBusy(this$static.typing) || this$static.domMutationReverter.entries.size != 0));
}

function $isTargetEditableInDisplayMode(event_0){
  var target;
  target = event_0.nativeEvent.target;
  target.nodeType == 3 && (target = $getParentElement(target));
  return isEditable_0(target);
}

function $isTyping(this$static){
  return !!this$static.typing && ($isBusy(this$static.typing) || this$static.domMutationReverter.entries.size != 0);
}

function $maybeRestoreAncestorScrollPositions(this$static){
  if (this$static.ancestorScrollTops) {
    $each(this$static.ancestorScrollTops, new EditorImpl$17_0);
    this$static.ancestorScrollTops = null;
  }
}

function $maybeSaveAncestorScrollPositions(this$static, e){
  $clinit_515();
  this$static.ancestorScrollTops = ($clinit_1445() , $clinit_1445() , new CollectionUtils$IdentityHashMapAdapter_0);
  while (e) {
    $put_2(this$static.ancestorScrollTops, e, valueOf_0(e.scrollTop || 0));
    e = $getParentElement(e);
  }
}

function $notifyTypingExtractor(this$static, htmlCaret){
  var $e0, e;
  checkNotNull_1(htmlCaret, 'Notifying typing extractor with invalid selection');
  try {
    $somethingHappened(this$static.typing, htmlCaret);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 171)) {
      e = $e0;
      $handleMissing(this$static.repairer, e);
    }
     else if (instanceOf($e0, 172)) {
      e = $e0;
      $handleInserted(this$static.repairer, e);
    }
     else 
      throw $e0;
  }
}

function $onIncomingOp(this$static, operation){
  $logLazyObjects(($clinit_672() , logger_1).traceLogger, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['Incoming operation', operation]));
  if (!this$static.content_0) {
    throw new IllegalStateException_1('Cannot apply op to uninitialized editor');
  }
  try {
    $nonUndoableOp(this$static.editorUndoManager, operation);
  }
   finally {
    $scheduleUpdateNotification_0(this$static.updateEvent, false, false, true, false);
  }
}

function $rebiasSelection(this$static, lastDirection){
  if (!!this$static.typing && ($isBusy(this$static.typing) || this$static.domMutationReverter.entries.size != 0)) {
    this$static.currentSelectionBias = ($clinit_1073() , LEFT_3);
    return;
  }
  !instance_6 && (instance_6 = new BrowserBackedScheduler_0 , setDefaultTimerService() , undefined);
  $schedule_5(high_0, new EditorImpl$10_0(this$static, lastDirection));
}

function $registerDomEventHandling(this$static){
  var event_0, event$array, event$index, event$max;
  for (event$array = ($clinit_695() , HANDLED_EVENTS) , event$index = 0 , event$max = event$array.length; event$index < event$max; ++event$index) {
    event_0 = event$array[event$index];
    $add_19(this$static.domHandlers, registerEventHandler(dynamicCast(this$static.content_0.fullContentView.inner_0.getDocumentElement(), 152).implNodelet, event_0, false, this$static));
  }
}

function $removeContent(this$static){
  var oldDoc;
  oldDoc = this$static.content_0;
  $clearContent(this$static);
  if (this$static.ownsDocument) {
    $setRendering(oldDoc);
    $replaceOutgoingSink(oldDoc, ($clinit_1422() , VOID));
  }
   else {
    checkState(!!oldDoc.logicalPanel, "Don't have a logicalPanel");
    $adjustLevel(oldDoc, ($clinit_741() , INTERACTIVE));
  }
  return oldDoc;
}

function $removeContentAndUnrender(this$static){
  var oldDoc;
  oldDoc = this$static.content_0;
  $clearContent(this$static);
  $setShelved(oldDoc);
  return oldDoc;
}

function $safelyRestoreSelection(this$static, selectionHelper, collapsed){
  var sel, selectionRestored;
  selectionRestored = false;
  sel = $getFocusedRange(this$static.savedSelection);
  if (sel) {
    $log_0(($clinit_672() , logger_1).traceLogger, 'Focusing, set selection at: ' + sel.focus_0);
    collapsed?$setCaret(selectionHelper, sel.focus_0):$setSelectionRange(selectionHelper, sel);
    selectionRestored = !!$getSelectionPoints(selectionHelper);
  }
  if (!selectionRestored) {
    $log_0(($clinit_672() , logger_1).traceLogger, 'Focusing at last valid point as a catch-all');
    $setCaret_0(selectionHelper, $getLastValidSelectionPoint(selectionHelper));
  }
}

function $setContent_0(this$static, newDoc){
  var docDiv, revertTask, sequencer, undoableDocument, undoingSequencer, docElement, docPainter;
  !!this$static.content_0 && $flush_4(this$static.typing);
  $clinit_672();
  ++ignoreMutations;
  try {
    !!this$static.suggestionsManager && $clear_8(this$static.suggestionsManager.suggestables);
    $clear_12(this$static.elementsWithDisplayEditModes);
    $clearContent(this$static);
    this$static.content_0 = newDoc;
    this$static.ownsDocument?$replaceOutgoingSink(this$static.content_0, this$static.outgoingOperationSink):(this$static.innerOutputSink = $replaceOutgoingSink(this$static.content_0, this$static.outgoingOperationSink));
    this$static.content_0.level.ordinal - ($clinit_741() , RENDERED).ordinal >= 0 || $setRendering(this$static.content_0);
    this$static.repairer = this$static.content_0.repairer;
    this$static.nodeManager = this$static.content_0.nodeManager;
    dynamicCast(this$static.content_0.fullContentView.inner_0.getDocumentElement(), 152);
    this$static.passiveSelectionHelper = new PassiveSelectionHelper_0(this$static.content_0.nodeManager, this$static.content_0.renderedContentView, this$static.content_0.indexedDoc);
    this$static.suggestionsManager = new InteractiveSuggestionsManager_0(this$static.passiveSelectionHelper);
    this$static.aggressiveSelectionHelper = new EditorImpl$12_0(this$static, this$static.nodeManager, this$static.content_0.renderedContentView, this$static.content_0.indexedDoc, this$static.content_0.mutableContent);
    this$static.caretMoveHelper = new CaretMovementHelperWebkitImpl_0(this$static.nodeManager);
    sequencer = this$static.content_0.sequencer;
    this$static.typing = new TypingExtractor_0(this$static.typingSink, this$static.nodeManager, this$static.content_0.filteredHtmlView, this$static.content_0.renderedContentView, this$static.repairer, new EditorImpl$13_0(this$static));
    this$static.responsibility = new ResponsibilityManagerImpl_0;
    this$static.editorUndoManager = new EditorUndoManagerImpl_0(new UndoManagerImpl_0, new EditorImpl$14_0(this$static), this$static.passiveSelectionHelper);
    undoingSequencer = new UndoableSequencer_0(sequencer, this$static.responsibility);
    undoableDocument = $createSequencedDocumentWrapper(this$static.content_0, undoingSequencer);
    this$static.pasteExtractor = new PasteExtractor_0(this$static.aggressiveSelectionHelper, undoableDocument, this$static.content_0.renderedContentView, this$static.content_0.persistentContentView, this$static.content_0.registries.annotationHandlerRegistry, undoingSequencer, this$static.content_0.indexedDoc);
    revertTask = new EditorImpl$15_0(this$static);
    this$static.domMutationReverter = new DomMutationReverter_0(new EditorImpl$16_0(this$static, revertTask));
    $hideDeath(dynamicCast(this$static.content_0.fullContentView.inner_0.getDocumentElement(), 152));
    this$static.caretStyles = new CaretAnnotations_0;
    this$static.caretStyles.resolver = this$static.annotationResolver;
    $clinit_704();
    docElement = this$static.content_0.context.this$0.mutableContent.doc.substrate.getDocumentElement();
    docPainter = dynamicCast($getProperty_0(($clinit_697() , DOC_PAINTER_PROP), dynamicCast(docElement, 152)), 183);
    !!docPainter && $doRun(docPainter);
    this$static.savedSelection = new RangeTracker_0(this$static.content_0.localAnnotations, 'savedsel');
    this$static.passiveSelectionHelper.savedSelection = this$static.savedSelection;
    this$static.annotationLogic = new AnnotationBehaviourLogic_0(($clinit_645() , ROOT_ANNOTATION_REGISTRY), this$static.content_0.mutableContent, this$static.caretStyles);
    $attachEditor(this$static.content_0, this$static.editorPackage, this$static.ownsDocument?this$static:null);
    docDiv = dynamicCast(this$static.content_0.fullContentView.inner_0.getDocumentElement(), 152).implNodelet;
    if (this$static.ownsDocument) {
      this$static.div.appendChild(docDiv);
      $addClassName(docDiv, 'document');
    }
     else {
      checkArgument_0(this$static.div == $getParentElement(docDiv), 'wrong content document');
    }
    docDiv.setAttribute('editableDocMarker', 'true');
    docDiv.setAttribute('spellcheck', 'false');
    $registerDomEventHandling(this$static);
    $setEditing(this$static, this$static.editing);
  }
   finally {
    --ignoreMutations;
  }
}

function $setEditing(this$static, editing){
  this$static.editing = editing;
  if (this$static.content_0) {
    $updateDocumentEditState(this$static, editing);
    $maybeCheckpoint(this$static.editorUndoManager);
    if (editing) {
      !this$static.innerOutputSink && $log_0(($clinit_672() , logger_1).errorLogger, 'Scheduling update with no inner output sink...');
      $scheduleUpdateNotification_0(this$static.updateEvent, false, true, false, false);
    }
  }
}

function $shouldTrackCursor(event_0){
  var keyCode, keySignalType;
  if ($contains_7(($clinit_530() , MOUSE_BUTTON_EVENTS), event_0.nativeEvent.type)) {
    return true;
  }
  if ($contains_7(KEY_EVENTS, event_0.nativeEvent.type)) {
    keySignalType = event_0.keySignalType;
    keyCode = event_0.cachedKeyCode;
    return keySignalType == ($clinit_528() , INPUT) || keySignalType == DELETE_0 || keySignalType == NAVIGATION && keyCode != 34 && keyCode != 33;
  }
  return false;
}

function $updateDocumentEditState(this$static, editing){
  var element, element$iterator, topLevel;
  topLevel = dynamicCast(this$static.content_0.fullContentView.inner_0.getDocumentElement(), 152).implNodelet;
  $put_3(dynamicCast(this$static.content_0.fullContentView.inner_0.getDocumentElement(), 152).transientData, ($clinit_704() , DOCUMENT_MODE).id_0, ($clinit_382() , editing?TRUE:FALSE));
  $removeClassName(topLevel, 'wave-editor-on');
  $removeClassName(topLevel, 'wave-editor-off');
  $addClassName(topLevel, editing?'wave-editor-on':'wave-editor-off');
  maybeScheduleRepaint(this$static.content_0.context, 0, $size_10(this$static.content_0.mutableContent.doc));
  topLevel.setAttribute('contentEditable', editing?'true':'false');
  topLevel.style['white-space'] = 'pre-wrap';
  for (element$iterator = $iterator_17(this$static.elementsWithDisplayEditModes); element$iterator.hasNext();) {
    element = dynamicCast(element$iterator.next_0(), 152);
    element.parent_0?onEditModeChange(element, editing):$remove_28(this$static.elementsWithDisplayEditModes, element);
  }
}

function EditorImpl(){
}

_ = EditorImpl.prototype = new LogicalPanel$Impl;
_.focus_2 = function focus_4(collapsed){
  var docElement;
  if (!this.attached) {
    $log_0(($clinit_672() , logger_1).errorLogger, "Shouldn't focus a detached editor");
    return;
  }
  if (this.editing && !!this.content_0) {
    this.content_0?(get_14() , null):null;
    docElement = dynamicCast(this.content_0.fullContentView.inner_0.getDocumentElement(), 152).implNodelet;
    $maybeSaveAncestorScrollPositions(this, docElement);
    ($clinit_373() , $clinit_373() , implWidget).focus_1(docElement);
    $maybeRestoreAncestorScrollPositions(this);
    $safelyRestoreSelection(this, this.aggressiveSelectionHelper, collapsed);
    $scheduleUpdateNotification_0(this.updateEvent, true, true, false, false);
  }
}
;
_.getClass$ = function getClass_398(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl_2_classLit;
}
;
_.getContent = function getContent(){
  return this.content_0;
}
;
_.getDocumentHtmlElement = function getDocumentHtmlElement(){
  return dynamicCast(this.content_0.fullContentView.inner_0.getDocumentElement(), 152).implNodelet;
}
;
_.getPersistentDocument = function getPersistentDocument(){
  return this.content_0.persistentContentView;
}
;
_.getSelectionHelper = function getSelectionHelper(){
  return checkState(!!this.passiveSelectionHelper, 'Using the selection helper of an editor not set up.') , $checkContextConsistency(this) , this.passiveSelectionHelper;
}
;
_.onAttach = function onAttach_2(){
  $onAttach(this);
  this.div['__editor'] = this;
}
;
_.onDetach = function onDetach_2(){
  this.div['__editor'] = null;
  $onDetach(this);
}
;
_.onJavaScriptEvent = function onJavaScriptEvent_0(name_0, rawEvent){
  var $e0, $e1, cancel, e, el, event_0, hackEditorNeverConsumes, isMutationEvent, savedDoc, trackCursor;
  hackEditorNeverConsumes = $equals_3(name_0, 'contextmenu') || $equals_3(name_0, 'click') || $equals_3(name_0, 'mousedown');
  try {
    event_0 = dynamicCast(create_6(($clinit_877() , FACTORY), rawEvent, !hackEditorNeverConsumes), 166);
    try {
      if (($clinit_539() , $clinit_539() , INSTANCE_3).isMac && !!rawEvent.ctrlKey && !!rawEvent.altKey && $eventGetTypeInt(rawEvent.type) == 256) {
        $log_0(($clinit_672() , logger_1).traceLogger, 'Cancelling dangerous: ' + rawEvent.type);
        rawEvent.preventDefault();
      }
    }
     catch ($e1) {
      $e1 = caught_0($e1);
      if (!instanceOf($e1, 144))
        throw $e1;
    }
    if (!event_0) {
      if (!hackEditorNeverConsumes) {
        try {
          rawEvent.stopPropagation();
        }
         catch ($e1) {
          $e1 = caught_0($e1);
          if (!instanceOf($e1, 144))
            throw $e1;
        }
      }
      return;
    }
    cancel = false;
    if (!hackEditorNeverConsumes) {
      if (this.editing || $isTargetEditableInDisplayMode(event_0) || $equals_3('copy', event_0.nativeEvent.type)) {
        try {
          event_0.nativeEvent.stopPropagation();
        }
         catch ($e1) {
          $e1 = caught_0($e1);
          if (!instanceOf($e1, 144))
            throw $e1;
        }
      }
       else {
        return;
      }
    }
    isMutationEvent = event_0.nativeEvent.type.indexOf('DOM') == 0;
    if (!isMutationEvent || ($clinit_672() , ignoreMutations <= 0)) {
      $clinit_672();
      ++ignoreMutations;
      try {
        if (this.debugDisabled) {
          cancel = false;
        }
         else if (!!this.pasteExtractor && this.pasteExtractor.busy) {
          $log_2(logger_1.traceLogger, 'Too busy to handle: ', event_0);
          cancel = true;
        }
         else {
          $clinit_973();
          caching = true;
          $push_1(this.responsibility.sequenceType, ($clinit_692() , DIRECT));
          try {
            cancel = $handleEvent(this.eventHandler, event_0);
          }
           finally {
            $endDirectSequence(this.responsibility);
          }
          if (!isMutationEvent) {
            trackCursor = $shouldTrackCursor(event_0);
            !instance_6 && (instance_6 = new BrowserBackedScheduler_0 , setDefaultTimerService() , undefined);
            $schedule_5(high_0, this.selectionSavingTask);
            $scheduleUpdateNotification_0(this.updateEvent, trackCursor, trackCursor, false, false);
          }
        }
        if (cancel && !isMutationEvent) {
          $log_2(logger_1.traceLogger, 'Prevent default: ', event_0);
          rawEvent.preventDefault();
        }
      }
       finally {
        --ignoreMutations;
      }
    }
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 167)) {
      e = $e0;
      $log_0(($clinit_672() , logger_1).errorLogger, 'Operation Exception - probably an invalid operation -> All bets are off!!! Not even going to try to repair!!');
      $logUncaughtExceptions(sUncaughtExceptionHandler.this$0, e);
      $showDeath(dynamicCast(this.content_0.fullContentView.inner_0.getDocumentElement(), 152));
      rawEvent.preventDefault();
      throw e;
    }
     else if (instanceOf($e0, 168)) {
      e = $e0;
      try {
        $logPlainText(($clinit_672() , logger_1).errorLogger, 'Invalid local operation swallowed ' + e);
      }
       catch ($e1) {
        $e1 = caught_0($e1);
        if (instanceOf($e1, 169)) {
          throw e;
        }
         else 
          throw $e1;
      }
    }
     else if (instanceOf($e0, 4)) {
      e = $e0;
      try {
        $log_0(($clinit_672() , logger_1).errorLogger, 'Repairing: ' + e);
        el = is_0(rawEvent.target)?$findElementWrapper_0(this.nodeManager, rawEvent.target):null;
        if (!el) {
          $clinit_670();
          savedDoc = $removeContent(this);
          $setShelved(savedDoc);
          $setContent_0(this, savedDoc);
          $flashShowRepair(dynamicCast(this.content_0.fullContentView.inner_0.getDocumentElement(), 152));
        }
         else {
          $revert(this.repairer, new Point$El_0(el, el.firstChild_0), new Point$El_0(el, null));
        }
        rawEvent.preventDefault();
      }
       finally {
        throw e;
      }
    }
     else 
      throw $e0;
  }
   finally {
    $clinit_973();
    caching = false;
    cache_0 = null;
  }
}
;
_.setContent = function setContent(op, schema){
  checkState(this.ownsDocument, 'Can not replace content not owned');
  $setContent_0(this, new ContentDocument_0(this.registries, op, schema));
}
;
_.toString$ = function toString_30(){
  return 'Editor: [Content: ' + this.content_0 + ']';
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1, 135:1, 201:1, 205:1, 206:1};
_.aggressiveSelectionHelper = null;
_.ancestorScrollTops = null;
_.annotationLogic = null;
_.caretMoveHelper = null;
_.caretStyles = null;
_.content_0 = null;
_.debugDisabled = false;
_.debugPopup = null;
_.div = null;
_.domMutationReverter = null;
_.editing = false;
_.editorUndoManager = null;
_.eventHandler = null;
_.innerOutputSink = null;
_.keySignalListeners = null;
_.nodeManager = null;
_.ownsDocument = false;
_.passiveSelectionHelper = null;
_.pasteExtractor = null;
_.permitOperations = true;
_.registries = null;
_.repairer = null;
_.responsibility = null;
_.savedSelection = null;
_.suggestionsManager = null;
_.suppressedOutgoingOps = null;
_.typing = null;
_.webkitEndOfLinkHackTextNode = null;
function EditorImpl$1_0(this$0){
  this.this$0 = this$0;
}

function EditorImpl$1(){
}

_ = EditorImpl$1_0.prototype = EditorImpl$1.prototype = new Object_0;
_.getClass$ = function getClass_399(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function EditorImpl$10_0(this$0, val$lastDirection){
  this.this$0 = this$0;
  this.val$lastDirection = val$lastDirection;
}

function EditorImpl$10(){
}

_ = EditorImpl$10_0.prototype = EditorImpl$10.prototype = new Object_0;
_.execute = function execute_11(){
  var current, focused, range;
  current = this.val$lastDirection;
  focused = $getSelectionRange($getSelectionHelper(this.this$0));
  if (focused) {
    range = (!focused.range && (focused.range = focused.anchor < focused.focus_0?new Range_2(focused.anchor, focused.focus_0):new Range_2(focused.focus_0, focused.anchor)) , focused.range);
    this.this$0.currentSelectionBias = $rebias(this.this$0.annotationLogic, range.start, range.end, current);
  }
   else {
    this.this$0.currentSelectionBias = ($clinit_1073() , LEFT_3);
  }
}
;
_.getClass$ = function getClass_400(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl$10_2_classLit;
}
;
_.castableTypeMap$ = {209:1, 210:1};
_.this$0 = null;
_.val$lastDirection = null;
function $clinit_652(){
  $clinit_652 = nullMethod;
  logger_0 = ($clinit_672() , logger_1);
}

function $findOrCreateValidSelectionPoint(this$static, point){
  var container, newContainer, nodeAfter, validContainerView, find_0;
  validContainerView = new PassiveSelectionHelper$ValidSelectionContainerView_0(this$static.renderedContentView);
  container = dynamicCast(point.container, 152);
  if (!isKnownInvalidTopContainerForCursor(container)) {
    return point;
  }
  nodeAfter = dynamicCast($getNodeAfter(point), 163);
  if (!nodeAfter) {
    newContainer = dynamicCast((find_0 = validContainerView.inner_0.getLastChild_0(container) , $getPreviousVisibleNodeDepthFirst(validContainerView, find_0, container, true)), 163);
  }
   else {
    newContainer = dynamicCast($getPreviousVisibleNodeDepthFirst(validContainerView, nodeAfter, null, false), 163);
    if (newContainer) {
      if (newContainer == nodeAfter) {
        newContainer = dynamicCast($getPreviousVisibleNodeDepthFirst(validContainerView, nodeAfter.parent_0, null, false), 163);
        if (newContainer == nodeAfter.parent_0) {
          return new Point$El_0($getParentElement_3(validContainerView, nodeAfter), nodeAfter);
        }
      }
      if (newContainer) {
        return new Point$El_0(newContainer, null);
      }
    }
    newContainer = dynamicCast($getNextVisibleNodeDepthFirst(validContainerView, nodeAfter, null), 163);
    if (newContainer) {
      return new Point$El_0(newContainer, dynamicCast($getFirstChild_4(this$static.renderedContentView, newContainer), 163));
    }
  }
  !newContainer && (newContainer = this$static.maybePlaceMissingCursorContainer(point));
  return newContainer?new Point$El_0(newContainer, null):null;
}

function $getLastValidSelectionPoint(this$static){
  var point;
  point = $findOrCreateValidSelectionPoint(this$static, new Point$El_0(dynamicCast(this$static.renderedContentView.inner_0.getDocumentElement(), 163), null));
  if (!point) {
    throw new RuntimeException_1('Could not create a valid selection point!');
  }
  return point;
}

function $getSelectionPoints(this$static){
  var anchor, focus_0, range, ret;
  get_14();
  try {
    this$static.needsCorrection = false;
    range = filterNonContentSelection(null);
    if (!range) {
      return null;
    }
    anchor = $nodeletPointToFixedContentPoint(this$static, range.anchor);
    focus_0 = range.isCollapsed?anchor:$nodeletPointToFixedContentPoint(this$static, range.focus_0);
    if (!anchor || !focus_0) {
      return null;
    }
    ret = range.isCollapsed?new FocusedContentRange_1(anchor):new FocusedContentRange_0(anchor, focus_0);
    this$static.needsCorrection && !!ret && $setSelectionPoints(this$static, ret.anchor, ret.focus_0);
    return ret;
  }
   finally {
    this$static.needsCorrection = false;
  }
}

function $getSelectionRange(this$static){
  var contentRange;
  contentRange = $getSelectionPoints(this$static);
  if (!contentRange) {
    return null;
  }
  return new FocusedRange_0($getLocation_4(this$static.mapper, contentRange.anchor), $getLocation_4(this$static.mapper, contentRange.focus_0));
}

function $nodeletPointToFixedContentPoint(this$static, point){
  var $e0, $e1, e, ret, textNodeLength;
  try {
    try {
      ret = $nodeletPointToWrapperPoint(this$static.nodeManager, point);
    }
     catch ($e1) {
      $e1 = caught_0($e1);
      if (instanceOf($e1, 4)) {
        e = $e1;
        $log_0(logger_0.errorLogger, 'CAUGHT RUNTIME EXCEPTION in nodeletPointToFixedContentPoint ' + e);
        ret = this$static.nodeletPointToWrapperPointAttempt2(point);
      }
       else 
        throw $e1;
    }
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 172)) {
      e = $e0;
      ret = e.contentPoint;
      this$static.needsCorrection = true;
    }
     else if (instanceOf($e0, 171)) {
      e = $e0;
      ret = before_0(this$static.renderedContentView, e.brokenNode);
      this$static.needsCorrection = true;
    }
     else 
      throw $e0;
  }
  if (!ret || ret.container == null) {
    return null;
  }
  if (ret.offset >= 0) {
    textNodeLength = dynamicCast(ret.container, 163).asText().data_0.length;
    if ($getTextOffset(ret) > textNodeLength) {
      $log_0(logger_0.errorLogger, "Text offset too big for text node, editor consistency: '(no editor available)'");
      ret = new Point$Tx_0(dynamicCast(ret.container, 163), textNodeLength);
    }
  }
   else if (isKnownInvalidTopContainerForCursor(dynamicCast(ret.container, 163))) {
    ret = $findOrCreateValidSelectionPoint(this$static, ret.asElementPoint());
    this$static.needsCorrection = true;
  }
  return ret;
}

function $saveSelection(this$static){
  var range;
  if (this$static.savedSelection) {
    range = $getSelectionRange(this$static);
    !!range && $trackRange_0(this$static.savedSelection, range);
  }
}

function $setCaret(this$static, caret){
  var collapsed;
  collapsed = $locate_0(this$static.mapper, caret);
  $setCaret_0(this$static, collapsed);
}

function $setCaret_0(this$static, caret){
  var nodeletCaret, asElementPoint;
  if (!caret) {
    throw new IllegalArgumentException_1('setCaret: caret may not be null');
  }
  caret = (asElementPoint = caret.asElementPoint() , !asElementPoint?caret:$findOrCreateValidSelectionPoint(this$static, asElementPoint));
  nodeletCaret = !caret?null:$wrapperPointToNodeletPoint(this$static.nodeManager, caret);
  !!nodeletCaret && ($clinit_973() , $clinit_973() , cache_0 = null , $clinit_973() , $clinit_973() , cache_0 = null , undefined);
  $saveSelection(this$static);
}

function $setSelectionPoints(this$static, anchor, focus_0){
  var collapsed, nodeletAnchor, nodeletFocus, range, asElementPoint, asElementPoint_0;
  collapsed = anchor == focus_0;
  anchor = (asElementPoint = anchor.asElementPoint() , !asElementPoint?anchor:$findOrCreateValidSelectionPoint(this$static, asElementPoint));
  focus_0 = collapsed?anchor:(asElementPoint_0 = focus_0.asElementPoint() , !asElementPoint_0?focus_0:$findOrCreateValidSelectionPoint(this$static, asElementPoint_0));
  nodeletAnchor = anchor?$wrapperPointToNodeletPoint(this$static.nodeManager, anchor):null;
  if (nodeletAnchor) {
    nodeletFocus = anchor == focus_0?nodeletAnchor:$wrapperPointToNodeletPoint(this$static.nodeManager, focus_0);
    if (nodeletFocus) {
      range = new FocusedPointRange_1(nodeletAnchor, nodeletFocus);
      !!range && ($clinit_973() , $clinit_973() , cache_0 = null , undefined);
    }
  }
  if (this$static.savedSelection) {
    range = new FocusedRange_0($getLocation_4(this$static.mapper, anchor), $getLocation_4(this$static.mapper, focus_0));
    $trackRange_0(this$static.savedSelection, range);
  }
}

function $setSelectionRange(this$static, selection){
  var anchor, focus_0;
  if (selection) {
    anchor = $locate_0(this$static.mapper, selection.anchor);
    focus_0 = selection.anchor == selection.focus_0?anchor:$locate_0(this$static.mapper, selection.focus_0);
    $setSelectionPoints(this$static, anchor, focus_0);
  }
}

function PassiveSelectionHelper_0(nodeManager, renderedContentView, locationMapper){
  $clinit_652();
  this.mapper = locationMapper;
  this.nodeManager = nodeManager;
  this.renderedContentView = renderedContentView;
}

function isKnownInvalidTopContainerForCursor(node){
  $clinit_652();
  if (!node) {
    return true;
  }
  return !node.parent_0 || ($clinit_819() , isLineContainer(($clinit_758() , INSTANCE_5), node));
}

function PassiveSelectionHelper(){
}

_ = PassiveSelectionHelper_0.prototype = PassiveSelectionHelper.prototype = new Object_0;
_.getClass$ = function getClass_401(){
  return Lorg_waveprotocol_wave_client_editor_selection_content_PassiveSelectionHelper_2_classLit;
}
;
_.maybePlaceMissingCursorContainer = function maybePlaceMissingCursorContainer(at){
  return null;
}
;
_.nodeletPointToWrapperPointAttempt2 = function nodeletPointToWrapperPointAttempt2(point){
  return null;
}
;
_.castableTypeMap$ = {};
_.mapper = null;
_.needsCorrection = false;
_.nodeManager = null;
_.renderedContentView = null;
_.savedSelection = null;
var logger_0;
function AggressiveSelectionHelper(){
}

_ = AggressiveSelectionHelper.prototype = new PassiveSelectionHelper;
--></script>
<script><!--
_.getClass$ = function getClass_402(){
  return Lorg_waveprotocol_wave_client_editor_selection_content_AggressiveSelectionHelper_2_classLit;
}
;
_.maybePlaceMissingCursorContainer = function maybePlaceMissingCursorContainer_0(at){
  var inserted, line;
  $log_0(logger_0.errorLogger, 'PROBLEM: Had to create a line container to accommodate the cursor!');
  isLineContainer(($clinit_758() , INSTANCE_5), dynamicCast(at.container, 163))?(line = dynamicCast(($clinit_1384() , appendLine_0(this.mutableDocument, dynamicCast(at.container, 152), ($clinit_1145() , EMPTY_MAP_0))), 152)):(line = dynamicCast(appendLine(this.mutableDocument, ($clinit_1145() , EMPTY_MAP_0)), 152));
  inserted = ($clinit_816() , dynamicCast(line.transientData.backend.get(valueOf_0(LINE_0.id_0)), 195)).paragraph;
  this.needsCorrection = true;
  return inserted;
}
;
_.nodeletPointToWrapperPointAttempt2 = function nodeletPointToWrapperPointAttempt2_0(nodelet){
  $flushSynchronous(this.this$0);
  this.needsCorrection = true;
  return $nodeletPointToWrapperPoint(this.nodeManager, nodelet);
}
;
_.castableTypeMap$ = {};
_.mutableDocument = null;
function EditorImpl$12_0(this$0, $anonymous1, $anonymous2, $anonymous3, $anonymous4){
  $clinit_652();
  this.this$0 = this$0;
  this.mapper = $anonymous3;
  this.nodeManager = $anonymous1;
  this.renderedContentView = $anonymous2;
  this.mutableDocument = $anonymous4;
}

function EditorImpl$12(){
}

_ = EditorImpl$12_0.prototype = EditorImpl$12.prototype = new AggressiveSelectionHelper;
_.getClass$ = function getClass_403(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl$12_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function EditorImpl$13_0(this$0){
  this.this$0 = this$0;
}

function EditorImpl$13(){
}

_ = EditorImpl$13_0.prototype = EditorImpl$13.prototype = new Object_0;
_.getClass$ = function getClass_404(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl$13_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $consume(this$static, op){
  var b;
  $consumeAndReturnInvertible_0(this$static.this$0.content_0.nindoSink, (b = new Nindo$Builder_0 , op.apply_5(new Nindo$2_0(b)) , $buildWithoutTrailingSkip(b)));
}

function EditorImpl$14_0(this$0){
  this.this$0 = this$0;
}

function EditorImpl$14(){
}

_ = EditorImpl$14_0.prototype = EditorImpl$14.prototype = new Object_0;
_.consume = function consume(op){
  var b;
  $consumeAndReturnInvertible_0(this.this$0.content_0.nindoSink, (b = new Nindo$Builder_0 , op.apply_5(new Nindo$2_0(b)) , $buildWithoutTrailingSkip(b)));
}
;
_.getClass$ = function getClass_405(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl$14_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function EditorImpl$15_0(this$0){
  this.this$0 = this$0;
}

function EditorImpl$15(){
}

_ = EditorImpl$15_0.prototype = EditorImpl$15.prototype = new Object_0;
_.execute = function execute_12(){
  $flush_3(this.this$0.domMutationReverter);
}
;
_.getClass$ = function getClass_406(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl$15_2_classLit;
}
;
_.castableTypeMap$ = {209:1, 210:1};
_.this$0 = null;
function $scheduleRevert(this$static){
  if (!$isTyping(this$static.this$0)) {
    $log_0(($clinit_672() , logger_1).traceLogger, 'WARNING: Dom removal outside of known typing context');
    $clinit_1010();
    $schedule_2(scheduler_0, ($clinit_1013() , LOW), this$static.val$revertTask);
  }
}

function EditorImpl$16_0(this$0, val$revertTask){
  this.this$0 = this$0;
  this.val$revertTask = val$revertTask;
}

function EditorImpl$16(){
}

_ = EditorImpl$16_0.prototype = EditorImpl$16.prototype = new Object_0;
_.getClass$ = function getClass_407(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl$16_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$revertTask = null;
function EditorImpl$17_0(){
}

function EditorImpl$17(){
}

_ = EditorImpl$17_0.prototype = EditorImpl$17.prototype = new Object_0;
_.apply_4 = function apply_6(e, i){
  dynamicCastJso(e).scrollTop = dynamicCast(i, 63).value_0;
}
;
_.getClass$ = function getClass_408(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl$17_2_classLit;
}
;
_.castableTypeMap$ = {};
function $consume_0(this$static, op){
  var $e0, e;
  try {
    this$static.this$0.permitOperations?this$static.this$0.innerOutputSink.consume(op):$add_9(this$static.this$0.suppressedOutgoingOps, op);
    $withinDirectSequence(this$static.this$0.responsibility)?$undoableOp(this$static.this$0.editorUndoManager, op):$nonUndoableOp(this$static.this$0.editorUndoManager, op);
    $scheduleUpdateNotification_0(this$static.this$0.updateEvent, false, false, true, $withinDirectSequence(this$static.this$0.responsibility));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 143)) {
      e = $e0;
      !this$static.this$0.innerOutputSink?$logPlainText_0(($clinit_672() , logger_1).fatalLogger, 'Output sink is null', new ClientDebugException_0(e)):$logPlainText_0(($clinit_672() , logger_1).fatalLogger, 'Output sink threw exception', e);
    }
     else 
      throw $e0;
  }
}

function EditorImpl$2_0(this$0){
  this.this$0 = this$0;
}

function EditorImpl$2(){
}

_ = EditorImpl$2_0.prototype = EditorImpl$2.prototype = new Object_0;
_.consume = function consume_0(op){
  $consume_0(this, op);
}
;
_.getClass$ = function getClass_409(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $aboutToFlush(this$static){
  var anchor, caret, hackedTextNode, link, nodeAfter;
  $flush_3(this$static.this$0.domMutationReverter);
  if (this$static.this$0.webkitEndOfLinkHackTextNode) {
    $clinit_672();
    ++ignoreMutations;
    try {
      caret = (this$static.this$0.content_0?(get_14() , null):null).focus_0;
      if (caret.offset >= 0) {
        hackedTextNode = dynamicCastJso(caret.container);
        link = hackedTextNode.previousSibling;
        while (!!link && link.nodeType == 3) {
          link = link.previousSibling;
        }
        if (!link) {
          $log_0(logger_1.errorLogger, 'No link before the link hack?');
          return;
        }
        anchor = link;
        $equalsIgnoreCase(anchor.tagName, 'a') || $log_0(logger_1.errorLogger, 'Some other element before the link hack? (' + anchor.tagName + ')');
        $getTextOffset(caret) == hackedTextNode.length?(nodeAfter = hackedTextNode.nextSibling):(nodeAfter = hackedTextNode.splitText($getTextOffset(caret)));
        moveNodes(anchor, anchor.nextSibling, nodeAfter);
        $clinit_973();
        new Point$Tx_0(hackedTextNode, hackedTextNode.length);
        cache_0 = null;
        cache_0 = null;
      }
       else {
        $log_0(logger_1.errorLogger, 'End of link hack caret not in text node!?');
      }
    }
     finally {
      this$static.this$0.webkitEndOfLinkHackTextNode = null;
      --ignoreMutations;
    }
  }
}

function $applyRepairingOperation(this$static, op){
  $push_1(this$static.this$0.responsibility.sequenceType, ($clinit_692() , DIRECT));
  try {
    $sourceNindoWithoutModifyingHtml(this$static.this$0.content_0, op);
  }
   finally {
    $endDirectSequence(this$static.this$0.responsibility);
  }
}

function $typingFinished(this$static, range){
  var n, newTextNode, newTextOffset, selection, selectionAffected;
  selection = this$static.this$0.content_0?(get_14() , null):null;
  selectionAffected = $zipRange(this$static.this$0.repairer, range);
  if (selectionAffected) {
    n = dynamicCastJso(selection.focus_0.container);
    newTextNode = n;
    if (selection.focus_0.offset < 0) {
      $log_2(($clinit_672() , logger_1).errorLogger, 'selection while typing is expected to be in text node, but is not ', selection.focus_0);
    }
     else {
      newTextOffset = $getTextOffset(selection.focus_0);
      while (n.nodeType == 3 && n.length < newTextOffset) {
        newTextOffset -= n.length;
        newTextNode = n.nextSibling;
      }
      $clinit_973();
      new Point$Tx_0(newTextNode, newTextOffset);
      cache_0 = null;
      cache_0 = null;
    }
  }
}

function $typingReplace(this$static, start, deletionSize, text, range){
  var $e0, e, location_0, op;
  location_0 = $getLocation_4(this$static.this$0.content_0.indexedDoc, start);
  op = $generateReplaceTextOp(this$static.this$0, location_0, deletionSize, text);
  try {
    $applyRepairingOperation(this$static, op);
    $typingFinished(this$static, range);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 168)) {
      e = $e0;
      $log_0(($clinit_672() , logger_1).errorLogger, 'Swallowing Error: Invalid operation sent to TypingSink (' + e + ')');
    }
     else 
      throw $e0;
  }
  this$static.this$0.currentSelectionBias = ($clinit_1073() , LEFT_3);
}

function EditorImpl$3_0(this$0){
  this.this$0 = this$0;
}

function EditorImpl$3(){
}

_ = EditorImpl$3_0.prototype = EditorImpl$3.prototype = new Object_0;
_.getClass$ = function getClass_410(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $getAnnotation_0(this$static, key){
  var at, biasLeft, browserSelection;
  browserSelection = $getSelectionRange(this$static.this$0.passiveSelectionHelper);
  if (!browserSelection) {
    $log_0(($clinit_672() , logger_1).errorLogger, 'No selection when resolving editor annotations.');
    return null;
  }
   else if (browserSelection.anchor != browserSelection.focus_0) {
    $log_0(($clinit_672() , logger_1).errorLogger, 'Resolving selection annotations is only supported while the browser selection is collapsed');
    return null;
  }
  at = browserSelection.focus_0;
  biasLeft = this$static.this$0.currentSelectionBias != ($clinit_1073() , RIGHT_3);
  return getAlignedAnnotation(this$static.this$0.content_0.mutableContent, at, key, biasLeft);
}

function EditorImpl$4_0(this$0){
  this.this$0 = this$0;
}

function EditorImpl$4(){
}

_ = EditorImpl$4_0.prototype = EditorImpl$4.prototype = new Object_0;
_.getClass$ = function getClass_411(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl$4_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function EditorImpl$7_0(){
}

function EditorImpl$7(){
}

_ = EditorImpl$7_0.prototype = EditorImpl$7.prototype = new Object_0;
_.getClass$ = function getClass_412(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl$7_2_classLit;
}
;
_.castableTypeMap$ = {};
function EditorImpl$8_0(this$0){
  this.this$0 = this$0;
}

function EditorImpl$8(){
}

_ = EditorImpl$8_0.prototype = EditorImpl$8.prototype = new Object_0;
_.execute = function execute_13(){
  $doSaveSelection(this.this$0);
}
;
_.getClass$ = function getClass_413(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl$8_2_classLit;
}
;
_.castableTypeMap$ = {209:1, 210:1};
_.this$0 = null;
function $execute_0(this$static){
  var backup;
  backup = this$static.commands;
  this$static.commands = ($clinit_1445() , $clinit_1445() , new LinkedList_0);
  while ($isConsistent(this$static.this$0) && !backup.isEmpty()) {
    dynamicCast(backup.poll(), 174).run();
  }
  backup.addAll(this$static.commands);
  this$static.commands = backup;
  this$static.commands.isEmpty() || this$static.this$0.permitOperations && ($clinit_1010() , $schedule_2(scheduler_0, ($clinit_1013() , LOW), this$static));
}

function $schedule_0(this$static, c){
  this$static.commands.add_0(c);
  this$static.this$0.permitOperations && ($clinit_1010() , $schedule_2(scheduler_0, ($clinit_1013() , LOW), this$static));
}

function EditorImpl$ConsistentStateCommandRunner_0(this$0){
  this.this$0 = this$0;
  this.commands = ($clinit_1445() , $clinit_1445() , new LinkedList_0);
}

function EditorImpl$ConsistentStateCommandRunner(){
}

_ = EditorImpl$ConsistentStateCommandRunner_0.prototype = EditorImpl$ConsistentStateCommandRunner.prototype = new Object_0;
_.execute = function execute_14(){
  $execute_0(this);
}
;
_.getClass$ = function getClass_414(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl$ConsistentStateCommandRunner_2_classLit;
}
;
_.castableTypeMap$ = {209:1, 210:1};
_.this$0 = null;
function $applyPaint(this$static, startLocation, endLocation, key, value){
  var isFullyStyled;
  isFullyStyled = $firstAnnotationChange_1(this$static.this$0.content_0.mutableContent.doc, startLocation, endLocation, key, value) == -1;
  this$static.this$0.editorUndoManager.pendingCheckpoint = new FocusedRange_0(startLocation, endLocation);
  $setAnnotation(this$static.this$0.content_0.mutableContent, startLocation, endLocation, key, isFullyStyled?null:value);
}

function $doCollapsedStyle(this$static, key, value){
  key = ($clinit_813() , 'style/' + key);
  $isAnnotated(this$static.this$0.caretStyles, key, value)?(this$static.this$0.caretStyles.annotations.put(key, null) , undefined):(this$static.this$0.caretStyles.annotations.put(key, value) , undefined);
  $scheduleUpdateNotification_0(this$static.this$0.updateEvent, false, false, true, false);
}

function $doStyle(this$static, start, end, key, value){
  key = ($clinit_813() , 'style/' + key);
  $applyPaint(this$static, $getLocation_4(this$static.this$0.content_0.indexedDoc, start), $getLocation_4(this$static.this$0.content_0.indexedDoc, end), key, value);
}

function $handleBlockLevelCommands(this$static, event_0, selection){
  var end, endLoc, l_0, listStyle, num, start, startLoc, type;
  start = selection.first;
  end = selection.second;
  if ($check_1(($clinit_519() , event_0))) {
    startLoc = $getLocation_4(this$static.this$0.content_0.indexedDoc, start);
    endLoc = $getLocation_4(this$static.this$0.content_0.indexedDoc, end);
    num = event_0.cachedKeyCode - 49 + 1;
    if (num >= 1 && num <= 6) {
      if (num == 5) {
        l_0 = getFirstLine(this$static.this$0.content_0.indexedDoc, $getLocation_4(this$static.this$0.content_0.indexedDoc, start));
        $equals_3('li', dynamicCast($get_12(l_0.lineElement.attributes, 't'), 1)) && !$equals_3('decimal', dynamicCast($get_12(l_0.lineElement.attributes, 'listyle'), 1))?(listStyle = 'decimal'):(listStyle = null);
        $clinit_827();
        traverse(this$static.this$0.content_0.indexedDoc, startLoc, endLoc, new Paragraph$3_0(new Paragraph$ListStyler_0(listStyle), true));
      }
       else {
        num == 6?(type = null):(type = 'h' + num);
        toggle(this$static.this$0.content_0.indexedDoc, startLoc, endLoc, ($clinit_827() , checkArgument_0(!$equals_3('li', type), "Don't use regularStyle() for list styles, use listStyle()") , new Paragraph$RegularStyler_0(type)));
      }
      $clinit_670();
      return true;
    }
     else if (num == 7) {
      $clinit_827();
      traverse(this$static.this$0.content_0.indexedDoc, startLoc, endLoc, new Paragraph$3_0(($clinit_832() , LEFT_1), true));
      traverse(this$static.this$0.content_0.indexedDoc, startLoc, endLoc, new Paragraph$3_0(($clinit_833() , LTR_0), true));
      $clinit_670();
      return true;
    }
     else if (num == 8) {
      $clinit_827();
      traverse(this$static.this$0.content_0.indexedDoc, startLoc, endLoc, new Paragraph$3_0(($clinit_832() , RIGHT_1), true));
      traverse(this$static.this$0.content_0.indexedDoc, startLoc, endLoc, new Paragraph$3_0(($clinit_833() , RTL_0), true));
      $clinit_670();
      return true;
    }
  }
   else if (event_0.cachedKeyCode == 9) {
    $handleTab(this$static, start, end, !!event_0.nativeEvent.shiftKey);
    return true;
  }
  return false;
}

function $handleCollapsedKeyCombo(this$static, event_0, caret){
  var combo;
  combo = getKeyCombo(event_0.nativeEvent);
  if (this$static.this$0.keyBindings.bindings.containsKey(combo)) {
    throwClassCastExceptionUnlessNull(this$static.this$0.keyBindings.bindings.get(combo)).nullMethod();
    return true;
  }
  switch (combo.ordinal) {
    case 2:
      $showSuggestionsNearestTo(this$static.this$0.suggestionsManager, caret);
      $clinit_670();
      return true;
    case 28:
    case 70:
      $doCollapsedStyle(this$static, 'fontWeight', 'bold');
      $clinit_670();
      return true;
    case 31:
    case 72:
      $doCollapsedStyle(this$static, 'fontStyle', 'italic');
      $clinit_670();
      return true;
    case 34:
    case 71:
      $doCollapsedStyle(this$static, 'textDecoration', 'underline');
      $clinit_670();
      return true;
  }
  return false;
}

function $handleCommand(this$static, event_0){
  var combo;
  if ($isCombo(event_0, 90, ($clinit_519() , COMMAND))) {
    $clinit_670();
    $undo(this$static.this$0.editorUndoManager);
    return true;
  }
  if ($isRedoCombo(event_0)) {
    $clinit_670();
    $redo(this$static.this$0.editorUndoManager);
    return true;
  }
  combo = $getKeyCombo(new EventWrapper_0(event_0.nativeEvent));
  switch (combo.ordinal) {
    case 40:
    case 63:
      $debugToggleDebugDialog(this$static.this$0);
      return true;
  }
  return false;
}

function $handleCopy(this$static){
  $log_0(($clinit_672() , logger_1).traceLogger, 'handling copy');
  return $clinit_670() , $handleCopyOrCutEvent(this$static.this$0.pasteExtractor, false);
}

function $handleCut(this$static){
  $maybeCheckpoint(this$static.this$0.editorUndoManager);
  $log_0(($clinit_672() , logger_1).traceLogger, 'handling cut');
  return $clinit_670() , $handleCopyOrCutEvent(this$static.this$0.pasteExtractor, true);
}

function $handlePaste(this$static){
  $maybeCheckpoint(this$static.this$0.editorUndoManager);
  $log_0(($clinit_672() , logger_1).traceLogger, 'handling paste');
  return $handlePasteEvent(this$static.this$0.pasteExtractor, this$static.this$0.currentSelectionBias);
}

function $handleRangeKeyCombo(this$static, event_0, selection){
  var combo, end, start;
  combo = getKeyCombo(event_0.nativeEvent);
  if (this$static.this$0.keyBindings.bindings.containsKey(combo)) {
    throwClassCastExceptionUnlessNull(this$static.this$0.keyBindings.bindings.get(combo)).nullMethod();
    return true;
  }
  start = selection.first;
  end = selection.second;
  switch (combo.ordinal) {
    case 28:
    case 70:
      $doStyle(this$static, start, end, 'fontWeight', 'bold');
      $clinit_670();
      return true;
    case 31:
    case 72:
      $doStyle(this$static, start, end, 'fontStyle', 'italic');
      $clinit_670();
      return true;
    case 34:
    case 71:
      $doStyle(this$static, start, end, 'textDecoration', 'underline');
      $clinit_670();
      return true;
  }
  return false;
}

function $handleTab(this$static, start, end, shiftDown){
  var fixedEnd, fixedStart, node, m_0;
  node = dynamicCast(start.container, 163);
  while (node) {
    if ($isTabTarget(node)) {
      break;
    }
    node = node.parent_0;
  }
  if (!node) {
    m_0 = this$static.this$0.content_0.indexedDoc;
    traverse(m_0, $getLocation_2(m_0.indexedDocLocationMapper.this$1, getFilteredPoint(m_0.this$0.persistentContentView, start)), $getLocation_2(m_0.indexedDocLocationMapper.this$1, getFilteredPoint(m_0.this$0.persistentContentView, end)), shiftDown?($clinit_827() , OUTDENTER):($clinit_827() , INDENTER));
    shiftDown?($clinit_670() , SHORTCUT_TABOUTDENT):($clinit_670() , SHORTCUT_TABINDENT);
  }
   else {
    $clinit_670();
    do {
      node = dynamicCast(getNextOrPrevNodeDepthFirst_1(this$static.this$0.content_0.mutableContent, node, null, true, !shiftDown), 163);
      if ($isTabTarget(node)) {
        break;
      }
    }
     while (node);
    if (node) {
      fixedStart = start_5(this$static.this$0.content_0.mutableContent, dynamicCast(node, 152));
      fixedEnd = new Point$El_0(node, null);
      $setSelectionPoints(this$static.this$0.passiveSelectionHelper, fixedStart, fixedEnd);
    }
  }
}

function $isTabTarget(node){
  var elem, nodeTagName;
  if (!node || !node.asElement()) {
    return false;
  }
  elem = node.asElement();
  nodeTagName = elem.tagName_0;
  return $contains_7(($clinit_645() , TAB_TARGETS), nodeTagName);
}

function EditorImpl$EditorEventsSubHandlerImpl_0(this$0){
  this.this$0 = this$0;
}

function EditorImpl$EditorEventsSubHandlerImpl(){
}

_ = EditorImpl$EditorEventsSubHandlerImpl_0.prototype = EditorImpl$EditorEventsSubHandlerImpl.prototype = new Object_0;
_.getClass$ = function getClass_415(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl$EditorEventsSubHandlerImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $checkpoint(this$static, currentRange){
  currentRange?(this$static.this$0.editorUndoManager.pendingCheckpoint = new FocusedRange_0($getLocation_0(this$static.this$0.content_0.mutableContent, currentRange.focus_0), $getLocation_0(this$static.this$0.content_0.mutableContent, currentRange.anchor)) , undefined):$maybeCheckpoint(this$static.this$0.editorUndoManager);
}

function $compositionEnd(this$static){
  var caret, composition, contentPoint;
  try {
    if (!this$static.this$0.imeExtractor.wrapper) {
      $log_0(($clinit_672() , logger_1).errorLogger, 'Composition end called with inactive ImeExtractor! Maybe caret was null initially?');
      return null;
    }
    $hackConsume(this$static.this$0.content_0.mutableContent, new Nindo_0((new Nindo$Builder_0).mutationList));
    composition = $getContent_0(this$static.this$0.imeExtractor);
    contentPoint = $deactivate(this$static.this$0.imeExtractor, this$static.this$0.content_0.fullContentView);
    caret = $insertText(this$static.this$0, contentPoint, composition, true);
    $setCaret_0(this$static.this$0.aggressiveSelectionHelper, caret);
    $rebiasSelection(this$static.this$0, ($clinit_1075() , FROM_LEFT));
    $startIndirectSequence(this$static.this$0.responsibility);
    $flushUpdates(this$static.this$0.updateEvent);
    $endIndirectSequence(this$static.this$0.responsibility);
    return $getSelectionPoints(this$static.this$0.passiveSelectionHelper);
  }
   finally {
    $clinit_672();
    --ignoreMutations;
  }
}

function $compositionStart(this$static, caret){
  $clinit_672();
  ++ignoreMutations;
  !!caret && $activate(this$static.this$0.imeExtractor, this$static.this$0.content_0.context, caret);
  $supplementAnnotations(this$static.this$0.annotationLogic, $getLocation_0(this$static.this$0.content_0.mutableContent, caret), this$static.this$0.currentSelectionBias, ($clinit_1074() , PLAIN_TEXT));
}

function $deleteRange(this$static, first, second, isReplace){
  isReplace && $supplementAnnotations(this$static.this$0.annotationLogic, $getLocation_0(this$static.this$0.content_0.mutableContent, first), ($clinit_1073() , RIGHT_3), ($clinit_1074() , PLAIN_TEXT));
  return $deleteRange_0(this$static.this$0.content_0.mutableContent, getFilteredPoint(this$static.this$0.content_0.persistentContentView, first), getFilteredPoint(this$static.this$0.content_0.persistentContentView, second)).first;
}

function $deleteWordEndingAt(this$static, caret){
  var end, start;
  end = $normalizePoint(this$static, caret);
  start = $getWordBoundary(this$static.this$0.caretMoveHelper, false);
  if (start) {
    $deleteRange_0(this$static.this$0.content_0.mutableContent, getFilteredPoint(this$static.this$0.content_0.persistentContentView, start), getFilteredPoint(this$static.this$0.content_0.persistentContentView, end));
    $rebiasSelection(this$static.this$0, ($clinit_1075() , FROM_RIGHT));
  }
}

function $deleteWordStartingAt(this$static, caret){
  var end, start;
  start = $normalizePoint(this$static, caret);
  end = $getWordBoundary(this$static.this$0.caretMoveHelper, true);
  if (end) {
    $deleteRange_0(this$static.this$0.content_0.mutableContent, getFilteredPoint(this$static.this$0.content_0.persistentContentView, start), getFilteredPoint(this$static.this$0.content_0.persistentContentView, end));
    $rebiasSelection(this$static.this$0, ($clinit_1075() , FROM_LEFT));
  }
}

function $hasContentSelection(this$static){
  return $isTyping(this$static.this$0) || !!filterNonContentSelection(this$static.this$0.content_0?(get_14() , null):null);
}

function $normalizePoint(this$static, caret){
  caret = normalizePoint(caret, this$static.this$0.content_0.selectionContent);
  caret = leftAlign_0(caret, this$static.this$0.content_0.fullContentView, this$static.this$0.content_0.selectionContent);
  caret = getFilteredPoint(this$static.this$0.content_0.selectionContent, caret);
  return caret;
}

function $notifyListeners(this$static, event_0){
  var handled;
  handled = false;
  $contains_7(($clinit_530() , KEY_EVENTS), event_0.nativeEvent.type) && $editorRelevantEvent(this$static.this$0, event_0) && (handled = $fireKeyboardEvent(this$static.this$0, event_0));
  return handled;
}

function $notifyTypingExtractor_0(this$static, caret, useHtmlCaret, isReplace){
  var htmlCaret;
  if (caret) {
    htmlCaret = $wrapperPointToNodeletPoint(this$static.this$0.nodeManager, caret);
  }
   else {
    if (useHtmlCaret) {
      $clinit_973();
      cache_0 = null;
      get_14();
      htmlCaret = null;
    }
     else {
      htmlCaret = null;
    }
  }
  if (htmlCaret) {
    !isReplace && !!caret && $supplementAnnotations(this$static.this$0.annotationLogic, $getLocation_0(this$static.this$0.content_0.mutableContent, caret), this$static.this$0.currentSelectionBias, ($clinit_1074() , PLAIN_TEXT));
    $notifyTypingExtractor(this$static.this$0, htmlCaret);
    return false;
  }
   else {
    $logPlainText(($clinit_672() , logger_1).errorLogger, "Null html caret in EditorImpl's notifyTypingExtractor, content caret: " + caret);
    return false;
  }
}

function EditorImpl$EditorInteractorImpl_0(this$0){
  this.this$0 = this$0;
}

function EditorImpl$EditorInteractorImpl(){
}

_ = EditorImpl$EditorInteractorImpl_0.prototype = EditorImpl$EditorInteractorImpl.prototype = new Object_0;
_.getClass$ = function getClass_416(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl$EditorInteractorImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function EditorImplWebkitMobile_0(e){
  $clinit_649();
  this.children_0 = new WidgetCollection_0(this);
  this.editorPackage = new EditorImpl$1_0(this);
  this.elementsWithDisplayEditModes = ($clinit_1456() , $clinit_1456() , new CopyOnWriteSet_0(HASH_SET));
  this.outgoingOperationSink = new EditorImpl$2_0(this);
  this.consistencyQueue = new EditorImpl$ConsistentStateCommandRunner_0(this);
  this.typingSink = new EditorImpl$3_0(this);
  this.imeExtractor = new ImeExtractor_0;
  this.currentSelectionBias = ($clinit_1073() , LEFT_3);
  this.keyBindings = ($clinit_964() , NONE_2);
  this.eventsSubHandler = new EditorImpl$EditorEventsSubHandlerImpl_0(this);
  this.updateEvent = new EditorUpdateEventImpl_0(this);
  this.annotationResolver = new EditorImpl$4_0(this);
  this.domHandlers = ($clinit_1445() , $clinit_1445() , new CollectionUtils$IdentitySetAdapter_0);
  this.selectionSavingTask = new EditorImpl$8_0(this);
  this.ownsDocument = true;
  this.div = e;
  this.element_0 = e;
}

function EditorImplWebkitMobile(){
}

_ = EditorImplWebkitMobile_0.prototype = EditorImplWebkitMobile.prototype = new EditorImpl;
_.focus_2 = function focus_5(collapsed){
}
;
_.getClass$ = function getClass_417(){
  return Lorg_waveprotocol_wave_client_editor_EditorImplWebkitMobile_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1, 135:1, 201:1, 205:1, 206:1};
function $clinit_670(){
  $clinit_670 = nullMethod;
  FULL_REPAIR = new EditorInstrumentor$Action_0('FULL_REPAIR', 0);
  PARTIAL_REPAIR = new EditorInstrumentor$Action_0('PARTIAL_REPAIR', 1);
  SHORTCUT_BOLD = new EditorInstrumentor$Action_0('SHORTCUT_BOLD', 2);
  SHORTCUT_ITALIC = new EditorInstrumentor$Action_0('SHORTCUT_ITALIC', 3);
  SHORTCUT_UNDERLINE = new EditorInstrumentor$Action_0('SHORTCUT_UNDERLINE', 4);
  SHORTCUT_TABINDENT = new EditorInstrumentor$Action_0('SHORTCUT_TABINDENT', 5);
  SHORTCUT_TABOUTDENT = new EditorInstrumentor$Action_0('SHORTCUT_TABOUTDENT', 6);
  SHORTCUT_TABFIELDS = new EditorInstrumentor$Action_0('SHORTCUT_TABFIELDS', 7);
  SHORTCUT_OPENNEARBYPOPUP = new EditorInstrumentor$Action_0('SHORTCUT_OPENNEARBYPOPUP', 8);
  SHORTCUT_HEADINGSTYLE = new EditorInstrumentor$Action_0('SHORTCUT_HEADINGSTYLE', 9);
  SHORTCUT_ALIGNMENT = new EditorInstrumentor$Action_0('SHORTCUT_ALIGNMENT', 10);
  CLIPBOARD_COPY = new EditorInstrumentor$Action_0('CLIPBOARD_COPY', 11);
  CLIPBOARD_PASTE_FROM_WAVE = new EditorInstrumentor$Action_0('CLIPBOARD_PASTE_FROM_WAVE', 12);
  CLIPBOARD_PASTE_FROM_OUTSIDE = new EditorInstrumentor$Action_0('CLIPBOARD_PASTE_FROM_OUTSIDE', 13);
  CLIPBOARD_CUT = new EditorInstrumentor$Action_0('CLIPBOARD_CUT', 14);
  UNDO = new EditorInstrumentor$Action_0('UNDO', 15);
  REDO = new EditorInstrumentor$Action_0('REDO', 16);
  $VALUES_18 = initValues(_3Lorg_waveprotocol_wave_client_editor_EditorInstrumentor$Action_2_classLit, {58:1, 138:1}, 79, [FULL_REPAIR, PARTIAL_REPAIR, SHORTCUT_BOLD, SHORTCUT_ITALIC, SHORTCUT_UNDERLINE, SHORTCUT_TABINDENT, SHORTCUT_TABOUTDENT, SHORTCUT_TABFIELDS, SHORTCUT_OPENNEARBYPOPUP, SHORTCUT_HEADINGSTYLE, SHORTCUT_ALIGNMENT, CLIPBOARD_COPY, CLIPBOARD_PASTE_FROM_WAVE, CLIPBOARD_PASTE_FROM_OUTSIDE, CLIPBOARD_CUT, UNDO, REDO]);
}

function EditorInstrumentor$Action_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_19(){
  $clinit_670();
  return $VALUES_18;
}

function EditorInstrumentor$Action(){
}

_ = EditorInstrumentor$Action_0.prototype = EditorInstrumentor$Action.prototype = new Enum;
_.getClass$ = function getClass_418(){
  return Lorg_waveprotocol_wave_client_editor_EditorInstrumentor$Action_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 79:1};
var $VALUES_18, CLIPBOARD_COPY, CLIPBOARD_CUT, CLIPBOARD_PASTE_FROM_OUTSIDE, CLIPBOARD_PASTE_FROM_WAVE, FULL_REPAIR, PARTIAL_REPAIR, REDO, SHORTCUT_ALIGNMENT, SHORTCUT_BOLD, SHORTCUT_HEADINGSTYLE, SHORTCUT_ITALIC, SHORTCUT_OPENNEARBYPOPUP, SHORTCUT_TABFIELDS, SHORTCUT_TABINDENT, SHORTCUT_TABOUTDENT, SHORTCUT_UNDERLINE, UNDO;
function EditorRuntimeException_0(reason){
  this.fillInStackTrace();
  this.detailMessage = reason;
}

function EditorRuntimeException(){
}

--></script>
<script><!--
_ = EditorRuntimeException_0.prototype = EditorRuntimeException.prototype = new RuntimeException;
_.getClass$ = function getClass_419(){
  return Lorg_waveprotocol_wave_client_editor_EditorRuntimeException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1};
function $clinit_672(){
  var l_0;
  $clinit_672 = nullMethod;
  logger_1 = (l_0 = new DomLogger_0('editor') , $clinit_542() , $add_11(enabledModulesBuffer, l_0.module) , l_0);
}

function createPopup_0(positioner, content_0, listener){
  $clinit_672();
  var popup;
  popup = new Popup_0(positioner);
  $add_1(popup.popupPanel, content_0);
  $add_9(popup.listeners, listener);
  return popup;
}

var ignoreMutations = 0, logger_1;
function $clinit_673(){
  $clinit_673 = nullMethod;
  new EditorUndoManager$1_0;
}

function EditorUndoManager$1_0(){
  $clinit_672();
}

function EditorUndoManager$1(){
}

_ = EditorUndoManager$1_0.prototype = EditorUndoManager$1.prototype = new Object_0;
_.getClass$ = function getClass_420(){
  return Lorg_waveprotocol_wave_client_editor_EditorUndoManager$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_675(){
  $clinit_675 = nullMethod;
  logger_2 = new DomLogger_0('undo');
  UNKNOWN_SELECTION = new FocusedRange_0(0, 0);
}

function $bypassUndoStack(this$static, op){
  this$static.bypass = true;
  try {
    $consume(this$static.sink, op);
  }
   finally {
    this$static.bypass = false;
  }
}

function $maybeCheckpoint(this$static){
  !this$static.pendingCheckpoint && (this$static.pendingCheckpoint = UNKNOWN_SELECTION);
}

function $nonUndoableOp(this$static, op){
  if (this$static.bypass) {
    return;
  }
  $nonUndoableOp_0(this$static.undoManager, op);
}

function $redo(this$static){
  var pair, redo, selection, transformedNonUndoable;
  pair = $redoPlus(this$static.undoManager);
  if (!pair || pair.first == null) {
    $shouldLog_0(logger_2.traceLogger) && $log(logger_2, ($clinit_1058() , TRACE), initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['cannot redo ' + this$static.redoSelectionStack.arrayList.size]));
    return;
  }
  redo = dynamicCast(pair.first, 173);
  transformedNonUndoable = dynamicCast(pair.second, 173);
  selection = $getSelectionRange(this$static.selectionHelper);
  selection?$push_1(this$static.undoSelectionStack, selection):$push_1(this$static.undoSelectionStack, UNKNOWN_SELECTION);
  $bypassUndoStack(this$static, redo);
  $restoreSelectionAfterUndoRedo(this$static, transformedNonUndoable, this$static.redoSelectionStack);
  $log_0(logger_2.traceLogger, 'Redoing!');
}

function $restoreSelectionAfterUndoRedo(this$static, transformedNonUndoable, selectionStack){
  var selection, anchor, focus_0;
  if (selectionStack.arrayList.size == 0) {
    $log(logger_2, ($clinit_1058() , ERROR), initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ["SelectionStack empty! This probably shouldn't be reached, but we can live with it."]));
    return null;
  }
  selection = dynamicCast($pop(selectionStack), 175);
  if (selection == UNKNOWN_SELECTION) {
    $log(logger_2, ($clinit_1058() , TRACE), initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['unknown selection']));
    return null;
  }
   else {
    !!transformedNonUndoable && (selection = (anchor = transformLocation(transformedNonUndoable, selection.anchor) , focus_0 = transformLocation(transformedNonUndoable, selection.focus_0) , new FocusedRange_0(anchor, focus_0)));
    $setSelectionRange(this$static.selectionHelper, selection);
    return selection;
  }
}

function $undo(this$static){
  var pair, selection, transformedNonUndoable, undo;
  pair = $undoPlus(this$static.undoManager);
  if (!pair || pair.first == null) {
    $shouldLog_0(logger_2.traceLogger) && $log(logger_2, ($clinit_1058() , TRACE), initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['cannot undo ' + this$static.undoSelectionStack.arrayList.size]));
    return;
  }
  undo = dynamicCast(pair.first, 173);
  transformedNonUndoable = dynamicCast(pair.second, 173);
  selection = $getSelectionRange(this$static.selectionHelper);
  selection?$push_1(this$static.redoSelectionStack, selection):$push_1(this$static.redoSelectionStack, UNKNOWN_SELECTION);
  $bypassUndoStack(this$static, undo);
  $restoreSelectionAfterUndoRedo(this$static, transformedNonUndoable, this$static.undoSelectionStack);
  $log_0(logger_2.traceLogger, 'Undoing!');
}

function $undoableOp(this$static, op){
  if (this$static.bypass) {
    return;
  }
  if (this$static.pendingCheckpoint) {
    $shouldLog_0(logger_2.traceLogger) && $log(logger_2, ($clinit_1058() , TRACE), initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['checkpointing, selection known?' + (this$static.pendingCheckpoint != UNKNOWN_SELECTION) + ' undo selection stack size: ' + this$static.undoSelectionStack.arrayList.size]));
    if (this$static.pendingCheckpoint == UNKNOWN_SELECTION) {
      this$static.pendingCheckpoint = $getSelectionRange(this$static.selectionHelper);
      !this$static.pendingCheckpoint && (this$static.pendingCheckpoint = UNKNOWN_SELECTION);
    }
    $checkpoint_0(this$static.undoManager.checkpointer);
    $push_1(this$static.undoSelectionStack, this$static.pendingCheckpoint);
    this$static.pendingCheckpoint = null;
  }
  $undoableOp_0(this$static.undoManager, op);
  if (this$static.redoSelectionStack.arrayList.size != 0) {
    $shouldLog_0(logger_2.traceLogger) && $log(logger_2, ($clinit_1058() , TRACE), initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['redoStack cleared ' + this$static.redoSelectionStack.arrayList.size]));
    $clear_2(this$static.redoSelectionStack.arrayList);
  }
}

function EditorUndoManagerImpl_0(undoManager, sink, selectionHelper){
  $clinit_675();
  this.undoSelectionStack = new Stack_0;
  this.redoSelectionStack = new Stack_0;
  checkNotNull_1(undoManager, 'UndoManager must not be null');
  checkNotNull_1(sink, 'Op sink must not be null');
  checkNotNull_1(selectionHelper, 'Selection helper must not be null');
  this.sink = sink;
  this.undoManager = undoManager;
  this.selectionHelper = selectionHelper;
}

function EditorUndoManagerImpl(){
}

_ = EditorUndoManagerImpl_0.prototype = EditorUndoManagerImpl.prototype = new Object_0;
_.getClass$ = function getClass_421(){
  return Lorg_waveprotocol_wave_client_editor_EditorUndoManagerImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.bypass = false;
_.pendingCheckpoint = null;
_.selectionHelper = null;
_.sink = null;
_.undoManager = null;
var UNKNOWN_SELECTION, logger_2;
function $debugGetAllUpdateEventNames(this$static){
  var events, l_0, l$iterator;
  events = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringSetAdapter_0(new HashSet_0));
  for (l$iterator = $iterator_17(this$static.updateListeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 176);
    $add_20(events, getClass__devirtual$(l_0).typeName);
  }
  return events;
}

function $debugSuppressUpdateEvent(this$static, name_0, suppress){
  suppress?$add_20(this$static.suppressedEventNames, name_0):$remove_26(this$static.suppressedEventNames, name_0);
}

function $flushUpdates(this$static){
  !instance_6 && (instance_6 = new BrowserBackedScheduler_0 , setDefaultTimerService() , undefined);
  $cancel_1(instance_6, this$static.notificationTask);
  $execute_1(this$static.notificationTask);
}

function $scheduleUpdateNotification_0(this$static, selectionCoordsChanged, selectionLocationChanged, contentChanged, userDirectlyChangedContent){
  var scheduler;
  this$static.notedSelectionCoordsChanged |= selectionCoordsChanged;
  this$static.notedSelectionLocationChanged |= selectionLocationChanged;
  this$static.notedContentChanged |= contentChanged;
  this$static.notedUserDirectlyChangedContent |= userDirectlyChangedContent;
  scheduler = (!instance_6 && (instance_6 = new BrowserBackedScheduler_0 , setDefaultTimerService() , undefined) , instance_6);
  $get_2(scheduler.taskInfos.backend, this$static.notificationTask) != null?(this$static.notifyAgain = true):$scheduleRepeating(scheduler, ($clinit_1013() , MEDIUM), this$static.notificationTask, 20, 500);
}

function EditorUpdateEventImpl_0(editor){
  this.updateListeners = ($clinit_1456() , $clinit_1456() , new CopyOnWriteSet_0(HASH_SET));
  this.suppressedEventNames = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringSetAdapter_0(new HashSet_0));
  this.notificationTask = new EditorUpdateEventImpl$1_0(this);
  this.editor = editor;
}

function EditorUpdateEventImpl(){
}

_ = EditorUpdateEventImpl_0.prototype = EditorUpdateEventImpl.prototype = new Object_0;
_.getClass$ = function getClass_422(){
  return Lorg_waveprotocol_wave_client_editor_EditorUpdateEventImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.editor = null;
_.notedContentChanged = false;
_.notedSelectionCoordsChanged = false;
_.notedSelectionLocationChanged = false;
_.notedUserDirectlyChangedContent = false;
_.notifyAgain = false;
function $execute_1(this$static){
  var l_0, l$iterator, ret;
  if ($isConsistent(this$static.this$0.editor)) {
    if (this$static.this$0.editor.content_0) {
      $shouldLog_0(($clinit_672() , logger_1).traceLogger) && $log_0(logger_1.traceLogger, 'EditorUpdateEvent: selCoords:' + this$static.this$0.notedSelectionCoordsChanged + ', selLoc:' + this$static.this$0.notedSelectionLocationChanged + ', content:' + this$static.this$0.notedContentChanged + ', userDirectlyChangedContent:' + this$static.this$0.notedUserDirectlyChangedContent);
      for (l$iterator = $iterator_17(this$static.this$0.updateListeners); l$iterator.hasNext();) {
        l_0 = dynamicCast(l$iterator.next_0(), 176);
        if ($contains_7(this$static.this$0.suppressedEventNames, getClass__devirtual$(l_0).typeName)) {
          continue;
        }
        l_0.onUpdate(this$static.this$0);
      }
      this$static.this$0.notedSelectionCoordsChanged = false;
      this$static.this$0.notedSelectionLocationChanged = false;
      this$static.this$0.notedContentChanged = false;
      this$static.this$0.notedUserDirectlyChangedContent = false;
    }
    this$static.delays = 0;
    $shouldLog_0(($clinit_672() , logger_1).traceLogger) && $log_0(logger_1.traceLogger, 'Notification sent');
  }
   else {
    $shouldLog_0(($clinit_672() , logger_1).traceLogger) && $log_0(logger_1.traceLogger, 'Notification deferred for consistency reasons');
    ++this$static.delays;
    this$static.delays == 20 && $log_0(logger_1.errorLogger, 'More than 20 notification delays encountered - possibly uncleared extraction state');
    this$static.this$0.notifyAgain = true;
  }
  ret = this$static.this$0.notifyAgain;
  this$static.this$0.notifyAgain = false;
  return ret;
}

function EditorUpdateEventImpl$1_0(this$0){
  this.this$0 = this$0;
}

function EditorUpdateEventImpl$1(){
}

_ = EditorUpdateEventImpl$1_0.prototype = EditorUpdateEventImpl$1.prototype = new Object_0;
_.execute_1 = function execute_15(){
  return $execute_1(this);
}
;
_.getClass$ = function getClass_423(){
  return Lorg_waveprotocol_wave_client_editor_EditorUpdateEventImpl$1_2_classLit;
}
;
_.toString$ = function toString_31(){
  return 'EditorUpdateEventImpl.notificationTask [update listeners: ' + this.this$0.updateListeners + ']';
}
;
_.castableTypeMap$ = {208:1, 210:1};
_.delays = 0;
_.this$0 = null;
function $clinit_680(){
  $clinit_680 = nullMethod;
  initRootRegistries();
}

function initRootRegistries(){
  $clinit_680();
  if (rootRegistriesInitialised) {
    return;
  }
  rootRegistriesInitialised = true;
  ($clinit_645() , TAB_TARGETS).backend.addAll(newStringSet(initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['caption', 'profile-field', 'text-setting'])).backend);
  $registerRenderer(ROOT_HANDLER_REGISTRY, 'l:ime', new ImeExtractor$1_0);
  register_8(ROOT_HANDLER_REGISTRY);
  $clinit_827();
  register_13(ROOT_HANDLER_REGISTRY);
  registerLines(ROOT_HANDLER_REGISTRY);
  register_11(ROOT_HANDLER_REGISTRY);
  $clinit_810();
  $registerEventHandler(ROOT_HANDLER_REGISTRY, 'br', INSTANCE_8);
  register_10(ROOT_HANDLER_REGISTRY);
  register_9(ROOT_HANDLER_REGISTRY);
  registerTagForSelections('l:p', false, ($clinit_1371() , NONE_4));
  registerTagForSelections('l:s', false, SHALLOW);
  registerTagForSelections('line', true, DEEP);
}

var rootRegistriesInitialised = false;
function $clinit_681(){
  $clinit_681 = nullMethod;
  handlerDataDomain = new ElementHandlerRegistry$1_0;
  ROOT = new ElementHandlerRegistry_0;
}

function $getNiceHtmlRenderer(this$static, target){
  return dynamicCast($get_12(dynamicCast(this$static.data_0.roCache, 151).niceHtmlRenderers, target.tagName_0), 178);
}

function $getRenderer(this$static, target){
  return dynamicCast($get_12(dynamicCast(this$static.data_0.roCache, 151).renderers, target.tagName_0), 177);
}

function $registerEventHandler(this$static, tag, eventHandler){
  $put_5(dynamicCast($modify_0(this$static.data_0), 151).eventHandlers, tag, eventHandler);
}

function $registerMutationHandler(this$static, tag, mutationHandler){
  $put_5(dynamicCast($modify_0(this$static.data_0), 151).mutationHandlers, tag, mutationHandler);
}

function $registerNiceHtmlRenderer(this$static, tag, renderer){
  $put_5(dynamicCast($modify_0(this$static.data_0), 151).niceHtmlRenderers, tag, renderer);
}

function $registerRenderer(this$static, tag, renderer){
  $put_5(dynamicCast($modify_0(this$static.data_0), 151).renderers, tag, renderer);
}

function $registerRenderingMutationHandler(this$static, tag, handler){
  var mutable;
  mutable = dynamicCast($modify_0(this$static.data_0), 151);
  $put_5(mutable.renderers, tag, handler);
  $put_5(mutable.mutationHandlers, tag, handler);
}

function ElementHandlerRegistry_0(){
  this.data_0 = new ChainedData_0(handlerDataDomain);
}

function ElementHandlerRegistry(){
}

_ = ElementHandlerRegistry_0.prototype = ElementHandlerRegistry.prototype = new Object_0;
_.getClass$ = function getClass_424(){
  return Lorg_waveprotocol_wave_client_editor_ElementHandlerRegistry_2_classLit;
}
;
_.castableTypeMap$ = {};
_.data_0 = null;
var ROOT, handlerDataDomain;
function ElementHandlerRegistry$1_0(){
}

function ElementHandlerRegistry$1(){
}

_ = ElementHandlerRegistry$1_0.prototype = ElementHandlerRegistry$1.prototype = new Object_0;
_.empty = function empty(){
  return new ElementHandlerRegistry$HandlerData_0;
}
;
_.getClass$ = function getClass_425(){
  return Lorg_waveprotocol_wave_client_editor_ElementHandlerRegistry$1_2_classLit;
}
;
_.readOnlyView = function readOnlyView(modifiable){
  return dynamicCast(modifiable, 151);
}
;
_.castableTypeMap$ = {};
function ElementHandlerRegistry$HandlerData_0(){
  this.renderers = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  this.eventHandlers = new CollectionUtils$StringMapAdapter_0(new HashMap_0);
  this.mutationHandlers = new CollectionUtils$StringMapAdapter_0(new HashMap_0);
  this.niceHtmlRenderers = new CollectionUtils$StringMapAdapter_0(new HashMap_0);
}

function ElementHandlerRegistry$HandlerData(){
}

_ = ElementHandlerRegistry$HandlerData_0.prototype = ElementHandlerRegistry$HandlerData.prototype = new Object_0;
_.getClass$ = function getClass_426(){
  return Lorg_waveprotocol_wave_client_editor_ElementHandlerRegistry$HandlerData_2_classLit;
}
;
_.castableTypeMap$ = {151:1};
function $getOrderedHtmlSelection(){
  return null;
}

function RenderingMutationHandler$1_0(val$handler, val$element){
  this.val$handler = val$handler;
  this.val$element = val$element;
}

function RenderingMutationHandler$1(){
}

_ = RenderingMutationHandler$1_0.prototype = RenderingMutationHandler$1.prototype = new Object_0;
_.apply_0 = function apply_7(key, item){
  this.val$handler.onAttributeModified(this.val$element, key, null, dynamicCast(item, 1));
}
;
_.getClass$ = function getClass_427(){
  return Lorg_waveprotocol_wave_client_editor_RenderingMutationHandler$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$element = null;
_.val$handler = null;
function $endDirectSequence(this$static){
  checkState(this$static.sequenceType.arrayList.size != 0 && $peek_0(this$static.sequenceType) === ($clinit_692() , DIRECT), 'end undoable sequence without begin');
  $pop(this$static.sequenceType);
}

function $endIndirectSequence(this$static){
  checkState(this$static.sequenceType.arrayList.size != 0 && $peek_0(this$static.sequenceType) === ($clinit_692() , INDIRECT), 'end non-undoable sequence without begin');
  $pop(this$static.sequenceType);
}

function $startIndirectSequence(this$static){
  $log_2(($clinit_672() , logger_1).traceLogger, 'Depth: ', valueOf_0(this$static.sequenceType.arrayList.size));
  $push_1(this$static.sequenceType, ($clinit_692() , INDIRECT));
}

function $withinDirectSequence(this$static){
  return (this$static.sequenceType.arrayList.size == 0?($clinit_692() , INDIRECT):dynamicCast($peek_0(this$static.sequenceType), 80)) == ($clinit_692() , DIRECT);
}

function ResponsibilityManagerImpl_0(){
  this.sequenceType = new Stack_0;
}

function ResponsibilityManagerImpl(){
}

_ = ResponsibilityManagerImpl_0.prototype = ResponsibilityManagerImpl.prototype = new Object_0;
_.getClass$ = function getClass_428(){
  return Lorg_waveprotocol_wave_client_editor_ResponsibilityManagerImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_692(){
  $clinit_692 = nullMethod;
  DIRECT = new ResponsibilityManagerImpl$SequenceType_0('DIRECT', 0);
  INDIRECT = new ResponsibilityManagerImpl$SequenceType_0('INDIRECT', 1);
  $VALUES_19 = initValues(_3Lorg_waveprotocol_wave_client_editor_ResponsibilityManagerImpl$SequenceType_2_classLit, {58:1, 138:1}, 80, [DIRECT, INDIRECT]);
}

function ResponsibilityManagerImpl$SequenceType_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_20(){
  $clinit_692();
  return $VALUES_19;
}

function ResponsibilityManagerImpl$SequenceType(){
}

_ = ResponsibilityManagerImpl$SequenceType_0.prototype = ResponsibilityManagerImpl$SequenceType.prototype = new Enum;
_.getClass$ = function getClass_429(){
  return Lorg_waveprotocol_wave_client_editor_ResponsibilityManagerImpl$SequenceType_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 80:1};
var $VALUES_19, DIRECT, INDIRECT;
function $contains_5(this$static, doc, node){
  var fromIncl, toExcl;
  fromIncl = this$static.nodeBefore == null?$getFirstChild_4(doc, this$static.after.container):$getNextSibling_3(doc, this$static.nodeBefore);
  toExcl = $getNodeAfter(this$static.after);
  return isBetween(doc, node, fromIncl, toExcl);
}

function $getPointBefore(this$static, doc){
  return new Point$El_0(this$static.after.container, this$static.nodeBefore == null?$getFirstChild_4(doc, this$static.after.container):$getNextSibling_3(doc, this$static.nodeBefore));
}

function $getStartNode(this$static, doc){
  var firstNode;
  firstNode = this$static.nodeBefore == null?$getFirstChild_4(doc, this$static.after.container):$getNextSibling_3(doc, this$static.nodeBefore);
  return firstNode;
}

function RestrictedRange_0(after, nodeBefore){
  this.after = after;
  this.nodeBefore = nodeBefore;
}

function around(doc, firstBoundedNode, lastBoundedNode){
  return new RestrictedRange_0(new Point$El_0($getParentElement_3(doc, lastBoundedNode), $getNextSibling_3(doc, lastBoundedNode)), $getPreviousSibling_3(doc, firstBoundedNode));
}

function between(nodeBefore, after){
  return new RestrictedRange_0(after, nodeBefore);
}

function boundedBy(parent_0, before, after){
  return new RestrictedRange_0(new Point$El_0(parent_0, after), before);
}

function collapsedAt_0(doc, collapsedAt){
  var node;
  return new RestrictedRange_0(collapsedAt, (node = $getNodeAfter(collapsedAt) , node == null?doc.getLastChild_0(collapsedAt.container):doc.getPreviousSibling(node)));
}

function isBetween(doc, node, fromIncl, toExcl){
  var n;
  for (n = fromIncl; n != null && (n == null?null:n) !== (toExcl == null?null:toExcl); n = $getNextSibling_3(doc, n)) {
    if ((n == null?null:n) === (node == null?null:node)) {
      return true;
    }
  }
  return false;
}

function RestrictedRange(){
}

_ = RestrictedRange_0.prototype = RestrictedRange.prototype = new Object_0;
_.getClass$ = function getClass_430(){
  return Lorg_waveprotocol_wave_client_editor_RestrictedRange_2_classLit;
}
;
_.toString$ = function toString_32(){
  return this.after.container + ' ->( ' + this.nodeBefore + ' - ' + $getNodeAfter(this.after) + ' )';
}
;
_.castableTypeMap$ = {};
_.after = null;
_.nodeBefore = null;
function UndoableSequencer_0(chainedSequencer, responsibility){
  this.responsibility = responsibility;
  this.sequencer = chainedSequencer;
}

function UndoableSequencer(){
}

_ = UndoableSequencer_0.prototype = UndoableSequencer.prototype = new Object_0;
_.begin = function begin_1(){
  $push_1(this.responsibility.sequenceType, ($clinit_692() , DIRECT));
}
;
_.consume_0 = function consume_1(op){
  $consumeAndReturnInvertible_0(this.sequencer.sink, op);
}
;
_.end_0 = function end_4(){
  $endDirectSequence(this.responsibility);
}
;
_.getClass$ = function getClass_431(){
  return Lorg_waveprotocol_wave_client_editor_UndoableSequencer_2_classLit;
}
;
_.castableTypeMap$ = {};
_.responsibility = null;
_.sequencer = null;
function $clinit_695(){
  $clinit_695 = nullMethod;
  HANDLED_EVENTS = initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['click', 'dblclick', 'mousedown', 'contextmenu', 'keypress', 'keydown', 'keyup', 'compositionstart', 'compositionend', 'compositionupdate', 'text', 'textInput', 'DOMSubtreeModified', 'DOMNodeInserted', 'DOMNodeRemoved', 'DOMNodeRemovedFromDocument', 'DOMNodeInsertedIntoDocument', 'DOMAttrModified', 'DOMCharacterDataModified', 'DOMElementNameChanged', 'DOMAttributeNameChanged', 'DOMMouseScroll', 'change', 'submit', 'reset', 'domfocusin', 'domfocusout', 'domactivate', 'cut', 'copy', 'paste', 'beforecut', 'beforecopy', 'beforepaste', 'afterupdate', 'beforeupdate', 'cellchange', 'dataavailable', 'datasetchanged', 'datasetcomplete', 'errorupdate', 'rowenter', 'rowexit', 'rowsdelete', 'rowinserted']);
}

var HANDLED_EVENTS;
function $clinit_696(){
  $clinit_696 = nullMethod;
  logger_3 = new DomLogger_0('editor-node');
}

function $compareTo_6(this$static, other){
  var ancestors, mine, minePrev, nca, search, theirs, theirsPrev;
  if (!$isContentAttached(this$static) || !$isContentAttached(other)) {
    throw new IllegalArgumentException_1('Cannot compare unattached nodes');
  }
  ancestors = new HashMap_0;
  minePrev = null;
  theirsPrev = null;
  mine = this$static;
  theirs = other;
  if (this$static == other || this$static == other) {
    return 0;
  }
  if (this$static != null && this$static.castableTypeMap$ && !!this$static.castableTypeMap$[190]) {
    minePrev = this$static;
    mine = this$static.parent_0;
  }
  if (other != null && other.castableTypeMap$ && !!other.castableTypeMap$[190]) {
    theirsPrev = other;
    theirs = other.parent_0;
  }
  while (mine) {
    ancestors.put(mine, minePrev);
    minePrev = mine;
    mine = mine.parent_0;
  }
  nca = theirs;
  while (!ancestors.containsKey(nca)) {
    theirsPrev = nca;
    nca = nca.parent_0;
  }
  minePrev = dynamicCast(ancestors.get(nca), 163);
  if (!minePrev) {
    return -1;
  }
  if (!theirsPrev) {
    return 1;
  }
  for (search = minePrev; search; search = search.prev) {
    if (search == theirsPrev) {
      return 1;
    }
  }
  return -1;
}

function $getImplNodeletRightwards(this$static){
  var node, nodelet, renderedContent;
  node = this$static;
  nodelet = null;
  renderedContent = this$static.context.this$0.renderingConcerns.this$0.renderedContentView;
  while (node) {
    nodelet = node.getImplNodelet();
    if (nodelet) {
      break;
    }
    node = dynamicCast($getNextSibling_3(renderedContent, node), 163);
  }
  return nodelet;
}

function $implInsertBefore(this$static, parent_0, from, to, refChild, oldContainerNodelet){
  var $e0, e;
  try {
    staticImplInsertBefore(parent_0, from, to, refChild, oldContainerNodelet);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 4)) {
      e = $e0;
      $printStackTrace(e);
      $log_0(logger_3.errorLogger, e + ' Scheduling revert.');
      $clinit_1010();
      $schedule_2(scheduler_0, ($clinit_1013() , LOW), new ContentNode$1_0(this$static));
    }
     else 
      throw $e0;
  }
}

function $isContentAttached(this$static){
  var e, root;
  e = this$static.isTextNode()?this$static.parent_0:dynamicCast(this$static, 152);
  root = dynamicCast(this$static.context.this$0.mutableContent.doc.substrate.getDocumentElement(), 152);
  while (e != root) {
    if (!e) {
      return false;
    }
    e = e.parent_0;
  }
  return true;
}

function $isOrIsAncestorOf(this$static, other){
  while (other) {
    if (this$static == other) {
      return true;
    }
    other = other.parent_0;
  }
  return false;
}

function $isRendered(this$static){
  return !!this$static.getImplNodelet() || this$static.isTextNode() && $isRendered(this$static.parent_0);
}

function $notifyAddedToParent(this$static, oldParent){
  var $e0, e, parent_0;
  try {
    this$static.onAddedToParent_0(oldParent);
    parent_0 = this$static.parent_0;
    parent_0.onChildAdded_0(this$static);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 4)) {
      e = $e0;
      $rethrowOrNoteErrorOnMutation(e);
    }
     else 
      throw $e0;
  }
}

function $notifyRemovedFromParent(this$static, oldParent, newParent){
  var $e0, e;
  try {
    this$static.onRemovedFromParent_0(newParent);
    oldParent.onChildRemoved_0(this$static);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 4)) {
      e = $e0;
      $rethrowOrNoteErrorOnMutation(e);
    }
     else 
      throw $e0;
  }
}

function $rethrowOrNoteErrorOnMutation(e){
  throw e;
}

function $toString_8(this$static){
  var $e0, contentString, name_0, nodeletString;
  name_0 = this$static.getClass$().typeName;
  name_0 = $substring(name_0, name_0.lastIndexOf(fromCodePoint(46)) + 1);
  nodeletString = 'destroyed';
  try {
    nodeletString = !this$static.getImplNodelet()?'null':$print_0(new Pretty_0, this$static.context.this$0.renderingConcerns.this$0.rawHtmlView, this$static.getImplNodelet());
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (!instanceOf($e0, 3))
      throw $e0;
  }
  contentString = $print_0(new Pretty_0, ($clinit_758() , INSTANCE_5), this$static);
  return name_0 + ': ' + contentString + ' / ' + nodeletString;
}

function staticImplInsertBefore(parent_0, from, toExcl, refChild, oldContainerNodelet){
  var containerNodelet, implRef, node, nodelet, parent_1;
  checkArgument_0(!toExcl || toExcl.parent_0 == from.parent_0, 'invalid toExcl');
  containerNodelet = parent_0.containerNodelet;
  if (containerNodelet) {
    implRef = null;
    for (node = refChild; node; node = node.next) {
      if (node.getImplNodelet()) {
        checkState(!!(parent_1 = node.getImplNodelet().parentNode , (!parent_1 || parent_1.nodeType != 1) && (parent_1 = null) , parent_1), 'implNodelet not attached');
        implRef = node.getImplNodelet();
        break;
      }
    }
    if (implRef) {
      containerNodelet = $getParentElement(implRef);
      if (!containerNodelet) {
        return;
      }
    }
    for (node = from; node != toExcl; node = node.next) {
      node.isTextNode() && $normaliseImpl(dynamicCast(node, 190));
      nodelet = node.getImplNodelet();
      !!nodelet && containerNodelet.insertBefore(nodelet, implRef);
    }
  }
   else {
    if (oldContainerNodelet) {
      for (node = from; node != toExcl; node = node.next) {
        nodelet = node.getImplNodelet();
        !!nodelet && $removeFromParent(nodelet);
      }
    }
  }
}

function ContentNode(){
}

_ = ContentNode.prototype = new Object_0;
_.breakBackRef = function breakBackRef(recurse){
}
;
_.compareTo$ = function compareTo_8(other){
  return $compareTo_6(this, dynamicCast(other, 163));
}
;
_.getClass$ = function getClass_432(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentNode_2_classLit;
}
;
_.getFirstChild = function getFirstChild(){
  return null;
}
;
_.getImplNodelet = function getImplNodelet(){
  return this.implNodelet;
}
;
_.getLastChild = function getLastChild(){
  return null;
}
;
_.normaliseImpl = function normaliseImpl(){
  return this.getImplNodelet();
}
;
_.onAddedToParent_0 = function onAddedToParent_2(previousParent){
}
;
_.onAttributeModified_0 = function onAttributeModified_6(name_0, oldValue, newValue){
}
;
_.onChildAdded_0 = function onChildAdded_0(child){
}
;
_.onChildRemoved_0 = function onChildRemoved_0(child){
}
;
_.onDescendantsMutated_0 = function onDescendantsMutated_2(){
}
;
_.onEmptied_0 = function onEmptied_0(){
}
;
_.onRemovedFromParent_0 = function onRemovedFromParent_0(newParent){
}
;
_.setImplNodelet = function setImplNodelet(nodelet){
  this.implNodelet = nodelet;
}
;
_.toString$ = function toString_33(){
  return $toString_8(this);
}
;
_.castableTypeMap$ = {61:1, 145:1, 163:1};
_.context = null;
_.implNodelet = null;
_.indexingContainer = null;
_.next = null;
_.parent_0 = null;
_.prev = null;
var logger_3;
function $clinit_697(){
  $clinit_697 = nullMethod;
  $clinit_696();
  COMPLEX_IMPLEMENTATION_MARKER = ($clinit_962() , $clinit_962() , ++markerIndex , '_x_' + markerIndex + '_cim');
}

function $init_5(this$static, attributes){
  var entry, entry$iterator;
  for (entry$iterator = attributes.entrySet_0().iterator_0(); entry$iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.next_0(), 66);
    $put_5(this$static.attributes, dynamicCast(entry.getKey(), 1), dynamicCast(entry.getValue(), 1));
  }
}

function $insertBefore_0(this$static, newChild, refChild, affectImpl){
  return $insertBefore_1(this$static, newChild, newChild.next, refChild, affectImpl, null);
}

--></script>
<script><!--
function $insertBefore_1(this$static, fromIncl, toExcl, refChild, affectImpl, factory){
  var movedNodes, newChild, next, node, node$iterator, oldContainerNodelet, oldParent, prev;
  if (fromIncl == toExcl) {
    return fromIncl;
  }
  if (!!refChild && refChild.parent_0 != this$static) {
    throw new IllegalArgumentException_1('insertBefore: refChild is not child of parent');
  }
  if ($isOrIsAncestorOf(fromIncl, this$static)) {
    throw new IllegalArgumentException_1('insertBefore: fromIncl is or is an ancestor of parent!');
  }
  if (!!toExcl && toExcl.parent_0 != fromIncl.parent_0) {
    throw new IllegalArgumentException_1('insertBefore: toExcl does not have the same parent as fromIncl!');
  }
  oldParent = fromIncl.parent_0;
  oldContainerNodelet = oldParent?oldParent.containerNodelet:null;
  newChild = fromIncl;
  if (!refChild) {
    prev = this$static.lastChild_0;
    this$static.lastChild_0 = fromIncl;
  }
   else {
    prev = refChild.prev;
    refChild.prev = fromIncl;
  }
  movedNodes = new ArrayList_0;
  while (true) {
    setCheck(movedNodes.array, movedNodes.size++, newChild);
    next = newChild.next;
    !newChild.prev?!!newChild.parent_0 && (newChild.parent_0.firstChild_0 = newChild.next , undefined):(newChild.prev.next = newChild.next);
    !newChild.next?!!newChild.parent_0 && (newChild.parent_0.lastChild_0 = newChild.prev , undefined):(newChild.next.prev = newChild.prev);
    !prev?(this$static.firstChild_0 = newChild):(prev.next = newChild);
    newChild.next = refChild;
    newChild.prev = prev;
    newChild.parent_0 = this$static;
    prev = newChild;
    if (next == toExcl) {
      !refChild?(this$static.lastChild_0 = newChild):(refChild.prev = newChild);
      break;
    }
    newChild = next;
  }
  !!factory && ($setupBehaviour(factory.this$0, fromIncl.asElement(), null) , undefined);
  affectImpl && $implInsertBefore(this$static, this$static, fromIncl, prev.next, refChild, oldContainerNodelet);
  if (oldParent) {
    $notifyChildrenMutated(oldParent);
    for (node$iterator = new AbstractList$IteratorImpl_0(movedNodes); node$iterator.i < node$iterator.this$0_0.size_0();) {
      node = dynamicCast($next_6(node$iterator), 163);
      $notifyRemovedFromParent(node, oldParent, this$static);
    }
  }
  for (node$iterator = new AbstractList$IteratorImpl_0(movedNodes); node$iterator.i < node$iterator.this$0_0.size_0();) {
    node = dynamicCast($next_6(node$iterator), 163);
    $notifyAddedToParent(node, oldParent);
  }
  $notifyChildrenMutated(this$static);
  return fromIncl;
}

function $notifyAttributeModified(this$static, name_0, oldValue, newValue){
  var $e0, e;
  try {
    this$static.onAttributeModified_0(name_0, oldValue, newValue);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 4)) {
      e = $e0;
      $rethrowOrNoteErrorOnMutation(e);
    }
     else 
      throw $e0;
  }
  !!this$static.parent_0 && $notifyChildrenMutated(this$static.parent_0);
}

function $notifyChildrenMutated(this$static){
  var $e0, e, element;
  element = this$static;
  while (element) {
    try {
      element.onDescendantsMutated_0();
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 4)) {
        e = $e0;
        $rethrowOrNoteErrorOnMutation(e);
      }
       else 
        throw $e0;
    }
    element = element.parent_0;
  }
}

function $notifyEmptied(this$static){
  var $e0, e;
  try {
    this$static.onEmptied_0();
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 4)) {
      e = $e0;
      $rethrowOrNoteErrorOnMutation(e);
    }
     else 
      throw $e0;
  }
}

function $reattachImplChildren(this$static){
  var container, node, renderedContent, find_0;
  renderedContent = this$static.context.this$0.renderingConcerns.this$0.renderedContentView;
  container = this$static.containerNodelet;
  if (container) {
    while (container.firstChild) {
      $removeFromParent(container.firstChild);
    }
    for (node = dynamicCast((find_0 = renderedContent.inner_0.getFirstChild_0(this$static) , $getNextVisibleNodeDepthFirst(renderedContent, find_0, this$static)), 163); node; node = dynamicCast($getNextSibling_3(renderedContent, node), 163)) {
      container.appendChild(node.getImplNodelet());
    }
  }
   else {
    $log_0(($clinit_672() , logger_1).errorLogger, 'You need to override this method for your doodad: ' + this$static.tagName_0);
  }
}

function $removeChild_0(this$static, oldChild, affectImpl){
  $removeChildren(this$static, oldChild, oldChild.next, affectImpl);
}

function $removeChildren(this$static, fromIncl, toExcl, affectImpl){
  if (fromIncl.parent_0 != this$static) {
    throw new IllegalArgumentException_1('removeChild: fromIncl is not child of parent');
  }
  if (!!toExcl && toExcl.parent_0 != this$static) {
    throw new IllegalArgumentException_1('removeChild: toExcl is not child of parent');
  }
  $removeChildrenInner(this$static, fromIncl, toExcl, affectImpl);
  $notifyChildrenMutated(this$static);
  !this$static.firstChild_0 && $notifyEmptied(this$static);
}

function $removeChildrenInner(this$static, fromIncl, toExcl, affectImpl){
  var node, node$iterator, nodeFirstChild, nodelet, oldChild, removedNodes;
  removedNodes = new ArrayList_0;
  for (node = fromIncl; node != toExcl;) {
    nodeFirstChild = node.getFirstChild();
    !!nodeFirstChild && $removeChildrenInner(node.asElement(), nodeFirstChild, null, affectImpl);
    oldChild = node;
    node = node.next;
    if (affectImpl) {
      nodelet = oldChild.normaliseImpl();
      !!nodelet && $removeFromParent(nodelet);
    }
    setCheck(removedNodes.array, removedNodes.size++, oldChild);
    !oldChild.prev?!!oldChild.parent_0 && (oldChild.parent_0.firstChild_0 = oldChild.next , undefined):(oldChild.prev.next = oldChild.next);
    !oldChild.next?!!oldChild.parent_0 && (oldChild.parent_0.lastChild_0 = oldChild.prev , undefined):(oldChild.next.prev = oldChild.prev);
    oldChild.prev = oldChild.next = oldChild.parent_0 = null;
    oldChild.breakBackRef(true);
  }
  for (node$iterator = new AbstractList$IteratorImpl_0(removedNodes); node$iterator.i < node$iterator.this$0_0.size_0();) {
    node = dynamicCast($next_6(node$iterator), 163);
    $notifyRemovedFromParent(node, this$static, null);
  }
}

function $setAutoAppendContainer(this$static, containerNodelet){
  $setContainerNodelet(this$static, containerNodelet);
  return containerNodelet;
}

function $setContainerNodelet(this$static, newNodelet){
  var implNodelet, node;
  if (newNodelet == this$static.containerNodelet) {
    return;
  }
  if (newNodelet) {
    emptyElement(newNodelet);
    for (node = this$static.firstChild_0; node; node = node.next) {
      node.isTextNode() && node.normaliseImpl();
      implNodelet = node.getImplNodelet();
      !!implNodelet && newNodelet.appendChild(implNodelet);
    }
  }
  $swapNodelet(this$static, this$static.containerNodelet == this$static.implNodelet?null:this$static.containerNodelet, newNodelet);
  this$static.containerNodelet = newNodelet;
}

function $setImplNodelets(this$static, domImplNodelet, containerNodelet){
  $swapNodelet(this$static, this$static.implNodelet, domImplNodelet);
  this$static.implNodelet = domImplNodelet;
  $setContainerNodelet(this$static, containerNodelet);
  if (domImplNodelet) {
    walkImpl(domImplNodelet);
    if (containerNodelet != domImplNodelet) {
      domImplNodelet.style['white-space'] = 'normal';
      if (containerNodelet) {
        domImplNodelet.style['white-space'] = 'prewrap';
        containerNodelet.innerHTML = '';
      }
    }
  }
}

function $swapNodelet(this$static, oldNodelet, newNodelet){
  !!oldNodelet && ($clinit_962() , oldNodelet[BACKREF_NAME] = null , undefined);
  !!newNodelet && ($clinit_962() , newNodelet[BACKREF_NAME] = this$static , undefined);
}

function $zipChildrenExcludingFrom(this$static, from, to){
  var filteredHtml, left, node, nodelet, nodeletData, renderedContent, ret, target, txt, find_0;
  $clinit_672();
  ++ignoreMutations;
  try {
    ret = false;
    renderedContent = this$static.context.this$0.renderingConcerns.this$0.renderedContentView;
    filteredHtml = this$static.context.this$0.renderingConcerns.this$0.filteredHtmlView;
    node = from;
    if (!from) {
      node = dynamicCast((find_0 = renderedContent.inner_0.getFirstChild_0(this$static) , $getNextVisibleNodeDepthFirst(renderedContent, find_0, this$static)), 163);
      nodelet = dynamicCastJso($getFirstChild_4(filteredHtml, this$static.implNodelet));
    }
     else {
      nodelet = from.getImplNodelet();
    }
    while (node) {
      node.getImplNodelet() != nodelet && node.setImplNodelet(nodelet);
      if (nodelet.nodeType == 3) {
        target = dynamicCast(node, 190).data_0;
        txt = nodelet.data;
        nodeletData = txt;
        left = target.length - txt.length;
        while (left > 0) {
          nodelet = dynamicCastJso($getNextSibling_3(filteredHtml, nodelet));
          nodeletData = nodelet.data;
          txt += nodeletData;
          left -= nodeletData.length;
        }
        if (left < 0) {
          !nodelet && (ret = true);
          nodelet.splitText(nodeletData.length + left);
        }
      }
      nodelet = dynamicCastJso($getNextSibling_3(filteredHtml, nodelet));
      node = dynamicCast($getNextSibling_3(renderedContent, node), 163);
      if (node == to) {
        break;
      }
    }
    !!node && node.isTextNode() && node.setImplNodelet(nodelet);
    return ret;
  }
   finally {
    --ignoreMutations;
  }
}

function walkImpl(element){
  var e, n;
  for (n = element.firstChild; n;) {
    if (n.nodeType == 3) {
      n = n.nextSibling;
    }
     else {
      e = n;
      ($clinit_962() , (e[TRANSPARENCY] || null) != null) || (e[COMPLEX_IMPLEMENTATION_MARKER] = true , undefined);
      walkImpl(e);
      n = n.nextSibling;
    }
  }
}

function ContentElement(){
}

_ = ContentElement.prototype = new ContentNode;
_.asElement = function asElement_0(){
  return this;
}
;
_.asText = function asText_0(){
  return null;
}
;
_.breakBackRef = function breakBackRef_0(recurse){
  var n;
  $swapNodelet(this, this.implNodelet, null);
  $swapNodelet(this, this.containerNodelet, null);
  if (recurse) {
    for (n = this.firstChild_0; n; n = n.next) {
      n.breakBackRef(true);
    }
  }
}
;
_.getClass$ = function getClass_433(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentElement_2_classLit;
}
;
_.getFirstChild = function getFirstChild_0(){
  return this.firstChild_0;
}
;
_.getImplNodelet = function getImplNodelet_0(){
  return this.implNodelet;
}
;
_.getLastChild = function getLastChild_0(){
  return this.lastChild_0;
}
;
_.getNodeType = function getNodeType(){
  return 1;
}
;
_.isConsistent_0 = function isConsistent_0(){
  var nodelet;
  return !this.implNodelet || (nodelet = this.getImplNodelet() , !!nodelet && !!$getParentElement(nodelet));
}
;
_.isTextNode = function isTextNode(){
  return false;
}
;
_.onRepair = function onRepair(){
}
;
_.revertImplementation = function revertImplementation(){
  var node, renderedContent, find_0;
  $clinit_672();
  ++ignoreMutations;
  try {
    renderedContent = this.context.this$0.renderingConcerns.this$0.renderedContentView;
    for (node = dynamicCast((find_0 = renderedContent.inner_0.getFirstChild_0(this) , $getNextVisibleNodeDepthFirst(renderedContent, find_0, this)), 163); node; node = dynamicCast($getNextSibling_3(renderedContent, node), 163)) {
      node.revertImplementation();
    }
    $reattachImplChildren(this);
    this.onRepair();
  }
   finally {
    --ignoreMutations;
  }
}
;
_.setImplNodelet = function setImplNodelet_0(nodelet){
  var element;
  checkNotNull_1(nodelet, 'Null nodelet not supported with this deprecated method, use setImplNodelets instead');
  checkState(!this.containerNodelet || this.containerNodelet == this.implNodelet, 'Cannot set only the impl nodelet if the container nodelet is different');
  checkArgument_0(nodelet.nodeType != 3, 'element cannot have text implnodelet');
  element = nodelet;
  !!this.containerNodelet && $setContainerNodelet(this, element);
  $swapNodelet(this, this.implNodelet, element);
  this.implNodelet = element;
}
;
_.castableTypeMap$ = {61:1, 145:1, 152:1, 163:1};
_.containerNodelet = null;
_.firstChild_0 = null;
_.lastChild_0 = null;
_.tagName_0 = null;
var COMPLEX_IMPLEMENTATION_MARKER;
function $clinit_698(){
  $clinit_698 = nullMethod;
  $clinit_697();
  css_10 = ($clinit_702() , $clinit_702() , css_11);
  !!css_10 && ($clinit_81() , $push_0(toInject, ($clinit_176() , '.GMQ4-KSBAH{display:inline-block;border:1px solid gray;background:silver;font-weight:bold;padding-left:1em;padding-right:1em;}')) , flush() , undefined);
  defaultMutationHandler = new NodeMutationHandlerImpl_0;
  defaultEventHandler = ($clinit_554() , $clinit_554() , INSTANCE_4);
  defaultRenderer = new AgentAdapter$1_0;
  noRenderer = new AgentAdapter$2_0;
}

function $setLogicalParent(this$static, parent_0){
  instanceOf(this$static.renderer, 181) && $setLogicalPanel((dynamicCast(this$static.renderer, 181) , this$static), parent_0);
}

function $setNodeEventHandler(this$static, newHandler){
  newHandler = dynamicCast(valueOrDefault(newHandler, defaultEventHandler), 180);
  if (this$static.nodeEventHandler == newHandler) {
    return;
  }
  this$static.nodeEventHandler.onDeactivated(this$static);
  this$static.nodeEventHandler = newHandler;
  this$static.nodeEventHandler.onActivated(this$static);
}

function $setNodeMutationHandler(this$static, handler){
  handler = dynamicCast(valueOrDefault(handler, defaultMutationHandler), 179);
  if (this$static.nodeMutationHandler == handler) {
    return;
  }
  this$static.nodeMutationHandler.onDeactivated_0(this$static);
  this$static.nodeMutationHandler = handler;
  this$static.nodeMutationHandler.onActivationStart(this$static);
}

function $setRenderer_0(this$static, renderer){
  var oldNodelet;
  checkNotNull_0(renderer, 'Null renderer');
  if (this$static.renderer == renderer) {
    return;
  }
  this$static.renderer = renderer;
  oldNodelet = this$static.implNodelet;
  $setContainerNodelet(this$static, null);
  $setImplNodelets(this$static, renderer.createDomImpl(this$static), this$static.containerNodelet);
  !!oldNodelet && $removeFromParent(oldNodelet);
}

function AgentAdapter_0(tagName, attributes, bundle, registry){
  $clinit_698();
  this.context = bundle;
  this.implNodelet = null;
  this.attributes = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  this.transientData = new CollectionUtils$IntMapAdapter_0(new HashMap_0);
  this.tagName_0 = tagName;
  this.nodeEventHandler = defaultEventHandler;
  this.nodeMutationHandler = defaultMutationHandler;
  this.renderer = noRenderer;
  this.element = this;
  this.registry = registry;
  $init_5(this, attributes);
}

function AgentAdapter(){
}

_ = AgentAdapter_0.prototype = AgentAdapter.prototype = new ContentElement;
_.getClass$ = function getClass_434(){
  return Lorg_waveprotocol_wave_client_editor_content_AgentAdapter_2_classLit;
}
;
_.onAddedToParent_0 = function onAddedToParent_3(oldParent){
  this.nodeMutationHandler.onAddedToParent(this.element, oldParent);
}
;
_.onAttributeModified_0 = function onAttributeModified_7(name_0, oldValue, newValue){
  this.nodeMutationHandler.onAttributeModified(this.element, name_0, oldValue, newValue);
}
;
_.onChildAdded_0 = function onChildAdded_1(child){
  this.nodeMutationHandler.onChildAdded(this.element, child);
}
;
_.onChildRemoved_0 = function onChildRemoved_1(child){
  this.nodeMutationHandler.onChildRemoved(this.element, child);
}
;
_.onDescendantsMutated_0 = function onDescendantsMutated_3(){
  this.nodeMutationHandler.onDescendantsMutated(this.element);
}
;
_.onEmptied_0 = function onEmptied_1(){
  this.nodeMutationHandler.onEmptied(this.element);
}
;
_.onRemovedFromParent_0 = function onRemovedFromParent_1(newParent){
  this.nodeMutationHandler.onRemovedFromParent(this.element, newParent);
  if (!newParent) {
    this.nodeEventHandler.onDeactivated(this);
    this.nodeMutationHandler.onDeactivated_0(this);
    this.renderer = null;
    this.nodeMutationHandler = null;
    this.nodeEventHandler = null;
  }
}
;
_.onRepair = function onRepair_0(){
  this.nodeMutationHandler.onActivationStart(this);
}
;
_.castableTypeMap$ = {61:1, 145:1, 152:1, 163:1, 187:1};
_.registry = null;
var css_10, defaultEventHandler, defaultMutationHandler, defaultRenderer, noRenderer;
function AgentAdapter$1_0(){
}

function AgentAdapter$1(){
}

_ = AgentAdapter$1_0.prototype = AgentAdapter$1.prototype = new Object_0;
_.createDomImpl = function createDomImpl_8(element){
  var unknown;
  unknown = $doc.createElement('div');
  unknown.className = ($clinit_698() , 'GMQ4-KSBAH');
  unknown.textContent = '<' + element.tagName_0 + '>' || '';
  unknown.setAttribute('contentEditable', 'false');
  return unknown;
}
;
_.getClass$ = function getClass_435(){
  return Lorg_waveprotocol_wave_client_editor_content_AgentAdapter$1_2_classLit;
}
;
_.castableTypeMap$ = {177:1};
function AgentAdapter$2_0(){
}

function AgentAdapter$2(){
}

_ = AgentAdapter$2_0.prototype = AgentAdapter$2.prototype = new Object_0;
_.createDomImpl = function createDomImpl_9(element){
  return null;
}
;
_.getClass$ = function getClass_436(){
  return Lorg_waveprotocol_wave_client_editor_content_AgentAdapter$2_2_classLit;
}
;
_.castableTypeMap$ = {177:1};
function $clinit_702(){
  $clinit_702 = nullMethod;
  css_11 = new AgentAdapter_Resources_en_InlineClientBundleGenerator$1_0;
}

var css_11 = null;
function AgentAdapter_Resources_en_InlineClientBundleGenerator$1_0(){
}

function AgentAdapter_Resources_en_InlineClientBundleGenerator$1(){
}

_ = AgentAdapter_Resources_en_InlineClientBundleGenerator$1_0.prototype = AgentAdapter_Resources_en_InlineClientBundleGenerator$1.prototype = new Object_0;
_.getClass$ = function getClass_437(){
  return Lorg_waveprotocol_wave_client_editor_content_AgentAdapter_1Resources_1en_1InlineClientBundleGenerator$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_704(){
  $clinit_704 = nullMethod;
  DOCUMENT_MODE = new Property$ImmutableProperty_0('doc_mode');
  PAINTER_PROP = new Property$MutableProperty_0('annotation-painter');
  REPAINT_KEY = '@' + prefixIncrementor++ + '/paint';
  DOC_PAINTER_PROP = new Property$MutableProperty_0('doc-annotation-painter');
  maybeScheduledPainters = new ConcurrentSet_0;
}

function $scheduleRepaint(this$static, bundle, start, end){
  var docPainter, size, docElement;
  docElement = bundle.this$0.mutableContent.doc.substrate.getDocumentElement();
  $setProperty_1(($clinit_697() , PAINTER_PROP), docElement, this$static);
  size = $size_10(bundle.this$0.mutableContent.doc);
  end = size < end + 3?size:end + 3;
  start = 0 > start - 3?0:start - 3;
  start == end && (start == 0?end < size && ++end:--start);
  $setAnnotation_0(bundle.this$0.localAnnotations, start, end, REPAINT_KEY, 'y');
  docPainter = getDocPainter(bundle);
  $schedule_6(this$static.scheduler, docPainter.task);
  $add_11(maybeScheduledPainters.set, docPainter);
}

function AnnotationPainter_0(scheduler){
  $clinit_704();
  this.scheduler = scheduler;
}

function clearDocPainter(bundle){
  $clinit_704();
  var existing;
  existing = dynamicCast($getProperty_0(($clinit_697() , DOC_PAINTER_PROP), dynamicCast(bundle.this$0.mutableContent.doc.substrate.getDocumentElement(), 152)), 183);
  !!existing && (existing.dead = true);
}

function createAndSetDocPainter(bundle, painterRegistry){
  $clinit_704();
  var docElement, docPainter, existing;
  docElement = bundle.this$0.mutableContent.doc.substrate.getDocumentElement();
  existing = dynamicCast($getProperty_0(($clinit_697() , DOC_PAINTER_PROP), dynamicCast(docElement, 152)), 183);
  !!existing && (existing.dead = true);
  docPainter = new AnnotationPainter$DocPainter_0(bundle, painterRegistry);
  $setProperty_1(DOC_PAINTER_PROP, docElement, docPainter);
}

function getDocPainter(bundle){
  var docElement, docPainter;
  docElement = bundle.this$0.mutableContent.doc.substrate.getDocumentElement();
  docPainter = dynamicCast($getProperty_0(($clinit_697() , DOC_PAINTER_PROP), dynamicCast(docElement, 152)), 183);
  if (!docPainter) {
    docPainter = new AnnotationPainter$DocPainter_0(bundle, ($clinit_645() , ROOT_PAINT_REGISTRY));
    $setProperty_1(DOC_PAINTER_PROP, docElement, docPainter);
  }
  return docPainter;
}

function isEditing_0(doc){
  $clinit_704();
  return isInEditingDocument(doc, doc.inner_0.getDocumentElement());
}

function isInEditingDocument(mgr, element){
  return $equals_2(($clinit_382() , TRUE), $getProperty_0(DOCUMENT_MODE, dynamicCast(element, 152)));
}

function maybeScheduleRepaint(bundle, start, end){
  $clinit_704();
  var painter;
  painter = dynamicCast($getProperty_0(($clinit_697() , PAINTER_PROP), dynamicCast(bundle.this$0.mutableContent.doc.substrate.getDocumentElement(), 152)), 182);
  !!painter && $scheduleRepaint(painter, bundle, start, end);
}

function AnnotationPainter(){
}

_ = AnnotationPainter_0.prototype = AnnotationPainter.prototype = new Object_0;
_.getClass$ = function getClass_438(){
  return Lorg_waveprotocol_wave_client_editor_content_AnnotationPainter_2_classLit;
}
;
_.castableTypeMap$ = {182:1};
_.scheduler = null;
var DOCUMENT_MODE, DOC_PAINTER_PROP, PAINTER_PROP, REPAINT_KEY, maybeScheduledPainters;
function $computeRenderAttrs(this$static){
  var func, func$iterator, isEditing, outerIter, entry;
  this$static.renderAttrs = new HashMap_0;
  isEditing = isEditing_0(this$static.localDoc);
  for (func$iterator = (outerIter = $keySet(dynamicCast(this$static.paintRegistry.data_0.roCache, 184).paintFuncs.map).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter)); func$iterator.val$outerIter.hasNext();) {
    func = dynamicCast((entry = dynamicCast(func$iterator.val$outerIter.next_0(), 66) , entry.getKey()), 185);
    $putAll(this$static.renderAttrs, func.apply_1(this$static.currentValues, isEditing));
  }
}

function $doRun(this$static){
  var allKeys, annotatorEnd, boundaryNodeAfter, boundaryParent, boundaryPoint, chunkEndNode, containingAnnotator, currentLocation, currentNode, docSize, element, first, firstPersistentChild, fromIncl, isAtStartOfTextNode, last, lastBoundaryElement, lastPersistentChild, maybeLocation, next, point, remainingIterations, startNode, textNode, toExcl;
  if (this$static.dead) {
    return false;
  }
  docSize = $size_10(this$static.mapper);
  maybeLocation = $firstAnnotationChange(this$static.localAnnotations.fullAnnotationSet, 0, docSize, ($clinit_704() , REPAINT_KEY), null);
  if (maybeLocation == -1) {
    maybeScheduledPainters.set.map.remove_2(this$static) != null;
    return false;
  }
  point = $locate_0(this$static.mapper, maybeLocation);
  containingAnnotator = $getAnnotatingElement(this$static, point.offset >= 0 || point.nodeAfter == null?point.container:point.nodeAfter);
  if (containingAnnotator != null) {
    first = $getFirstChild_4(this$static.persistentView, containingAnnotator);
    last = $getLastChild_3(this$static.persistentView, containingAnnotator);
    this$static.startLocation = $getLocation_3(this$static.mapper, dynamicCast(first, 163));
    $setAnnotation_0(this$static.localAnnotations, this$static.startLocation, $getLocation_4(this$static.mapper, after_1(this$static.persistentView, last)), REPAINT_KEY, 'y');
    startNode = containingAnnotator;
  }
   else {
    startNode = ensureNodeBoundaryReturnNextNode(point, this$static.localDoc, this$static.textNodeOrganiser);
    this$static.startLocation = maybeLocation;
  }
  currentNode = startNode;
  remainingIterations = 80;
  this$static.endLocation = $getEnd(this$static, this$static.startLocation, docSize, REPAINT_KEY);
  allKeys = dynamicCast(this$static.paintRegistry.data_0.roCache, 184).keys;
  this$static.nextChangingKeys = allKeys;
  this$static.chunkEnd = this$static.startLocation;
  this$static.currentValues = new HashMap_0;
  this$static.cursor = new GenericAnnotationCursor_0(this$static.localAnnotations, this$static.startLocation, this$static.endLocation, allKeys);
  $progress(this$static);
  chunkEndNode = $ensureNodeBoundary(this$static, $locate_0(this$static.mapper, this$static.chunkEnd));
  lastBoundaryElement = null;
  while (true) {
    currentLocation = currentNode == null?docSize:$getLocation_4(this$static.mapper, getFilteredPoint(this$static.persistentView, before_0(this$static.localDoc, currentNode)));
    while (this$static.chunkEnd <= currentLocation && this$static.chunkEnd < this$static.endLocation) {
      boundaryPoint = $locate_0(this$static.mapper, this$static.chunkEnd);
      $progress(this$static);
      chunkEndNode = $ensureNodeBoundary(this$static, $locate_0(this$static.mapper, this$static.chunkEnd));
      if (boundaryPoint.offset >= 0) {
        textNode = this$static.hardView.inner_0.asText_0(boundaryPoint.container);
        isAtStartOfTextNode = $getTextOffset(boundaryPoint) == 0;
        boundaryNodeAfter = $transparentSlice(this$static.localDoc, dynamicCast(isAtStartOfTextNode?textNode:$getNextSibling_3(this$static.hardView, textNode), 163));
        boundaryParent = boundaryNodeAfter != null?this$static.localDoc.inner_0.getParentElement(boundaryNodeAfter):$getParentElement_3(this$static.hardView, textNode);
      }
       else {
        boundaryNodeAfter = $getNodeAfter(boundaryPoint);
        boundaryNodeAfter != null && (boundaryNodeAfter = $transparentSlice(this$static.localDoc, dynamicCast(boundaryNodeAfter, 163)));
        boundaryParent = boundaryNodeAfter != null?this$static.localDoc.inner_0.getParentElement(boundaryNodeAfter):this$static.localDoc.inner_0.asElement_0(boundaryPoint.container);
      }
      lastBoundaryElement = $getBoundaryElement(this$static, boundaryParent, boundaryNodeAfter);
      if (this$static.chunkEnd == currentLocation) {
        break;
      }
    }
    if (currentLocation >= this$static.endLocation || remainingIterations <= 0) {
      $setAnnotation_0(this$static.localAnnotations, this$static.startLocation, currentLocation, REPAINT_KEY, null);
      break;
    }
    element = this$static.localDoc.inner_0.asElement_0(currentNode);
    if (element == null) {
      fromIncl = currentNode;
      toExcl = currentNode;
      while ($asText_1(this$static.localDoc, toExcl = this$static.localDoc.inner_0.getNextSibling(toExcl)) != null) {
        if (this$static.localDoc.inner_0.isSameNode(chunkEndNode, toExcl)) {
          break;
        }
      }
      this$static.renderAttrs.size_0() > 0?(next = getNextOrPrevNodeDepthFirst_1(this$static.localDoc, $wrap_0(this$static, this$static.renderAttrs, fromIncl, toExcl), null, false, true)):(next = toExcl != null?toExcl:$getNextNode(this$static, this$static.localDoc.inner_0.getParentElement(currentNode)));
    }
     else if ($equals_3(this$static.localDoc.inner_0.getTagName(element), this$static.paintRegistry.paintTagName)) {
      firstPersistentChild = $getFirstChild_4(this$static.hardView, element);
      if (firstPersistentChild == null) {
        next = getNextOrPrevNodeDepthFirst_1(this$static.localDoc, element, null, true, true);
        $transparentUnwrap(this$static.localDoc, dynamicCast(element, 152));
      }
       else {
        lastPersistentChild = $getLastChild_3(this$static.hardView, element);
        annotatorEnd = $getLocation_4(this$static.mapper, after_1(this$static.persistentView, lastPersistentChild));
        if (annotatorEnd > this$static.chunkEnd || !$rendersSame(this$static, this$static.renderAttrs, element)) {
          next = getNextOrPrevNodeDepthFirst_1(this$static.localDoc, element, null, true, true);
          $transparentUnwrap(this$static.localDoc, dynamicCast(element, 152));
          $setAnnotation_0(this$static.localAnnotations, currentLocation, annotatorEnd, REPAINT_KEY, 'y');
        }
         else {
          next = getNextOrPrevNodeDepthFirst_1(this$static.localDoc, element, null, false, true);
        }
      }
    }
     else if ($equals_3(this$static.localDoc.inner_0.getTagName(element), this$static.paintRegistry.boundaryTagName)) {
      next = getNextOrPrevNodeDepthFirst_1(this$static.localDoc, element, null, false, true);
      (element == null?null:element) !== (lastBoundaryElement == null?null:lastBoundaryElement) && $transparentDeepRemove(this$static.localDoc, dynamicCast(element, 163));
    }
     else {
      next = getNextOrPrevNodeDepthFirst_1(this$static.localDoc, element, null, true, true);
    }
    currentNode = next;
    --remainingIterations;
  }
  return true;
}

function $ensureNodeBoundary(this$static, point){
  return ensureNodeBoundaryReturnNextNode(point, this$static.localDoc, this$static.textNodeOrganiser);
}

function $getAnnotatingElement(this$static, node){
  var parent_0;
  for (parent_0 = this$static.localDoc.inner_0.getParentElement(node); parent_0 != null; parent_0 = this$static.localDoc.inner_0.getParentElement(parent_0)) {
    if ($equals_3(this$static.localDoc.inner_0.getTagName(parent_0), this$static.paintRegistry.paintTagName)) {
      return parent_0;
    }
  }
  return null;
}

--></script>
<script><!--
function $getBoundaryElement(this$static, parent_0, nodeAfter){
  var boundaryContainerElement, currentParent, func, func$iterator, isEditing, result, outerIter, entry;
  currentParent = parent_0;
  boundaryContainerElement = null;
  isEditing = isEditing_0(this$static.localDoc);
  for (func$iterator = (outerIter = $keySet(dynamicCast(this$static.paintRegistry.data_0.roCache, 184).boundaryFuncs.map).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter)); func$iterator.val$outerIter.hasNext();) {
    func = dynamicCast((entry = dynamicCast(func$iterator.val$outerIter.next_0(), 66) , entry.getKey()), 186);
    result = func.apply_2(this$static.localDoc, currentParent, nodeAfter, this$static.boundaryBefore, this$static.boundaryAfter, isEditing);
    if (!!result && !boundaryContainerElement) {
      boundaryContainerElement = $transparentCreate_0(this$static.localDoc, this$static.paintRegistry.boundaryTagName, ($clinit_430() , $clinit_430() , EMPTY_MAP), currentParent, nodeAfter);
      currentParent = boundaryContainerElement;
      nodeAfter = null;
      $transparentMove_0(this$static.localDoc, boundaryContainerElement, result, this$static.localDoc.inner_0.getNextSibling(result), null);
      $clinit_745();
      $setProperty_1(DEEP_TRANSPARENT, boundaryContainerElement, DEEP_TRANSPARENT_MARKER);
    }
  }
  return boundaryContainerElement;
}

function $getEnd(this$static, start, end, key){
  var ret;
  ret = $firstAnnotationChange(this$static.localAnnotations.fullAnnotationSet, start, end, key, 'y');
  return ret == -1?end:ret;
}

function $getNextNode(this$static, node){
  return getNextOrPrevNodeDepthFirst_1(this$static.localDoc, node, null, false, true);
}

function $progress(this$static){
  var changingKeys, start;
  start = this$static.chunkEnd;
  if (this$static.cursor.locations.heap.size == 0) {
    this$static.chunkEnd = this$static.endLocation;
    changingKeys = null;
  }
   else {
    changingKeys = $nextLocation(this$static.cursor);
    this$static.chunkEnd = this$static.cursor.currentLocation;
  }
  this$static.boundaryBefore = new HashMap_0;
  this$static.boundaryAfter = new HashMap_0;
  $each_3(this$static.nextChangingKeys, new AnnotationPainter$DocPainter$2_0(this$static, start));
  this$static.nextChangingKeys = changingKeys;
  $computeRenderAttrs(this$static);
}

function $rendersSame(this$static, attrs, annotatingElement){
  return !!attrs && $equals_4(attrs, this$static.localDoc.inner_0.getAttributes(annotatingElement));
}

function $wrap_0(this$static, attrs, fromIncl, toExcl){
  var el;
  el = $transparentCreate_0(this$static.localDoc, this$static.paintRegistry.paintTagName, attrs, this$static.localDoc.inner_0.getParentElement(fromIncl), fromIncl);
  $transparentMove_0(this$static.localDoc, el, fromIncl, toExcl, null);
  return el;
}

function AnnotationPainter$DocPainter_0(bundle, paintRegistry){
  this.task = new AnnotationPainter$DocPainter$1_0(this);
  this.localDoc = bundle.this$0.fullContentView;
  this.mapper = bundle.this$0.indexedDoc;
  this.textNodeOrganiser = bundle.this$0.indexedDoc;
  this.persistentView = bundle.this$0.persistentContentView;
  this.hardView = bundle.this$0.persistentContentView.hardDoc;
  this.localAnnotations = bundle.this$0.localAnnotations;
  this.paintRegistry = paintRegistry;
}

function AnnotationPainter$DocPainter(){
}

_ = AnnotationPainter$DocPainter_0.prototype = AnnotationPainter$DocPainter.prototype = new Object_0;
_.getClass$ = function getClass_439(){
  return Lorg_waveprotocol_wave_client_editor_content_AnnotationPainter$DocPainter_2_classLit;
}
;
_.castableTypeMap$ = {183:1};
_.boundaryAfter = null;
_.boundaryBefore = null;
_.chunkEnd = 0;
_.currentValues = null;
_.cursor = null;
_.dead = false;
_.endLocation = 0;
_.hardView = null;
_.localAnnotations = null;
_.localDoc = null;
_.mapper = null;
_.nextChangingKeys = null;
_.paintRegistry = null;
_.persistentView = null;
_.renderAttrs = null;
_.startLocation = 0;
_.textNodeOrganiser = null;
function AnnotationPainter$DocPainter$1_0(this$1){
  this.this$1 = this$1;
}

function AnnotationPainter$DocPainter$1(){
}

_ = AnnotationPainter$DocPainter$1_0.prototype = AnnotationPainter$DocPainter$1.prototype = new Object_0;
_.execute_1 = function execute_16(){
  return $doRun(this.this$1);
}
;
_.getClass$ = function getClass_440(){
  return Lorg_waveprotocol_wave_client_editor_content_AnnotationPainter$DocPainter$1_2_classLit;
}
;
_.castableTypeMap$ = {208:1, 210:1};
_.this$1 = null;
function AnnotationPainter$DocPainter$2_0(this$1, val$start){
  this.this$1 = this$1;
  this.val$start = val$start;
}

function AnnotationPainter$DocPainter$2(){
}

_ = AnnotationPainter$DocPainter$2_0.prototype = AnnotationPainter$DocPainter$2.prototype = new Object_0;
_.apply_3 = function apply_8(key){
  var newValue;
  newValue = $getAnnotation(this.this$1.localAnnotations.fullAnnotationSet, this.val$start, key);
  this.this$1.boundaryBefore.put(key, this.this$1.currentValues.get(key));
  this.this$1.boundaryAfter.put(key, newValue);
  newValue == null?this.this$1.currentValues.remove_2(key):this.this$1.currentValues.put(key, newValue);
}
;
_.getClass$ = function getClass_441(){
  return Lorg_waveprotocol_wave_client_editor_content_AnnotationPainter$DocPainter$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
_.val$start = 0;
function $appendXml(this$static, xml){
  return $insertXml(this$static, new Point$El_0(this$static.doc.substrate.getDocumentElement(), null), xml);
}

function $asElement_0(this$static, node){
  return this$static.doc.substrate.asElement_0(node);
}

function $at(location_0){
  var b;
  b = new Nindo$Builder_0;
  location_0 > 0 && $add_9(b.mutationList, new Nindo$Skip_0(location_0));
  return b;
}

function $createElement_1(this$static, point, attributes){
  var location_0, result;
  checkNotNull_1('line', 'createElement: tagName must not be null');
  point.offset >= 0?checkOffset(this$static, this$static.doc.substrate.asText_0(point.container), $getTextOffset(point), 'MutableDocumentImpl.createElement'):checkRelationship(this$static, this$static.doc.substrate.asElement_0(point.container), $getNodeAfter(point), 'MutableDocumentImpl.createElement');
  try {
    this$static.sequencer.begin();
    location_0 = $getLocation_4(this$static.doc, point);
    this$static.sequencer.consume_0(new Nindo_0($createElement_2(new AttributesImpl_1(attributes), $at(location_0)).mutationList));
    result = $locate_0(this$static.doc, location_0);
    return $asElement_1(this$static.doc, result.offset >= 0?this$static.doc.substrate.getNextSibling(result.container):$getNodeAfter(result));
  }
   finally {
    this$static.sequencer.end_0();
  }
}

function $createElement_2(attributes, builder){
  $add_9(builder.mutationList, new Nindo$ElementStart_0('line', attributes));
  $add_9(builder.mutationList, ($clinit_1167() , INSTANCE_13));
  return builder;
}

function $deleteElement(this$static, element, builder){
  $add_9(builder.mutationList, ($clinit_1166() , INSTANCE_12));
  $emptyElement_0(this$static, element, builder);
  $add_9(builder.mutationList, ($clinit_1165() , INSTANCE_11));
  return builder;
}

function $deleteNode(this$static, element){
  try {
    this$static.sequencer.begin();
    this$static.sequencer.consume_0(new Nindo_0($deleteElement(this$static, element, $at($getLocation_3(this$static.doc, element))).mutationList));
  }
   finally {
    this$static.sequencer.end_0();
  }
}

function $deleteRange_0(this$static, start, end){
  var atCommonAncestor, commonAncestorIndexMinusOne, e, el, endEl, endLocation, i, needToDoLeftmostDeleteSeparately, newEndPoint, prevRightEl, rightEl, s, startAncestors, startEl, startLocation, startPoint;
  start.offset >= 0?checkOffset(this$static, this$static.doc.substrate.asText_0(start.container), $getTextOffset(start), 'MutableDocumentImpl.deleteRange start point'):checkRelationship(this$static, this$static.doc.substrate.asElement_0(start.container), $getNodeAfter(start), 'MutableDocumentImpl.deleteRange start point');
  end.offset >= 0?checkOffset(this$static, this$static.doc.substrate.asText_0(end.container), $getTextOffset(end), 'MutableDocumentImpl.deleteRange end point'):checkRelationship(this$static, this$static.doc.substrate.asElement_0(end.container), $getNodeAfter(end), 'MutableDocumentImpl.deleteRange end point');
  startLocation = $getLocation_4(this$static.doc, start);
  endLocation = $getLocation_4(this$static.doc, end);
  if (startLocation > endLocation) {
    throw new IllegalArgumentException_1('MutableDocumentImpl.deleteRange: start is after end');
  }
  if (startLocation == endLocation) {
    return new PointRange_1(start, end);
  }
  try {
    this$static.sequencer.begin();
    newEndPoint = null;
    if (this$static.doc.substrate.isSameNode(enclosingElement(this$static, start.container), enclosingElement(this$static, end.container))) {
      this$static.sequencer.consume_0(new Nindo_0($deleteRangeInternal(this$static, startLocation, endLocation).mutationList));
      newEndPoint = $locate_0(this$static.doc, startLocation);
    }
     else {
      startEl = enclosingElement(this$static.doc, start.container);
      endEl = enclosingElement(this$static.doc, end.container);
      startAncestors = new ArrayList_0;
      for (el = startEl; el != null; el = this$static.doc.substrate.getParentElement(el)) {
        setCheck(startAncestors.array, startAncestors.size++, el);
      }
      commonAncestorIndexMinusOne = -2;
      needToDoLeftmostDeleteSeparately = true;
      for (rightEl = endEl , prevRightEl = endEl;; rightEl = this$static.doc.substrate.getParentElement(rightEl)) {
        atCommonAncestor = $indexOf_4(startAncestors, rightEl, 0) != -1;
        if (atCommonAncestor) {
          commonAncestorIndexMinusOne = $indexOf_4(startAncestors, rightEl, 0) - 1;
          needToDoLeftmostDeleteSeparately = commonAncestorIndexMinusOne >= 0;
          s = needToDoLeftmostDeleteSeparately?after_0(this$static.doc, (checkIndex(commonAncestorIndexMinusOne, startAncestors.size) , startAncestors.array[commonAncestorIndexMinusOne])):startLocation;
        }
         else {
          s = start_4(this$static.doc, rightEl);
        }
        e = (rightEl == null?null:rightEl) === (endEl == null?null:endEl)?endLocation:$getLocation_3(this$static.doc, dynamicCast(prevRightEl, 163));
        this$static.sequencer.consume_0(new Nindo_0($deleteRangeInternal(this$static, s, e).mutationList));
        !newEndPoint && (newEndPoint = $locate_0(this$static.doc, s));
        prevRightEl = rightEl;
        if (atCommonAncestor) {
          break;
        }
      }
      for (i = commonAncestorIndexMinusOne; i > 0; --i) {
        this$static.sequencer.consume_0(new Nindo_0($deleteRangeInternal(this$static, after_0(this$static.doc, (checkIndex(i - 1, startAncestors.size) , startAncestors.array[i - 1])), $getLocation_4(this$static.doc, new Point$El_0((checkIndex(i, startAncestors.size) , startAncestors.array[i]), null))).mutationList));
      }
      needToDoLeftmostDeleteSeparately && (this$static.sequencer.consume_0(new Nindo_0($deleteRangeInternal(this$static, startLocation, $getLocation_4(this$static.doc, new Point$El_0(startEl, null))).mutationList)) , undefined);
    }
    startPoint = $locate_0(this$static.doc, startLocation);
    return new PointRange_1(startPoint, newEndPoint);
  }
   finally {
    this$static.sequencer.end_0();
  }
}

function $deleteRangeInternal(this$static, startLocation, endLocation){
  var builder, end, next, node, size, start, stop_0, text;
  builder = $at(startLocation);
  start = $locate_0(this$static.doc, startLocation);
  end = $locate_0(this$static.doc, endLocation);
  if (start.offset >= 0) {
    if (this$static.doc.substrate.isSameNode(start.container, end.container)) {
      size = $getTextOffset(end) - $getTextOffset(start);
      size > 0 && $add_9(builder.mutationList, new Nindo$DeleteCharacters_0(size));
      return builder;
    }
     else {
      size = $getLength_1(this$static.doc, this$static.doc.substrate.asText_0(start.container)) - $getTextOffset(start);
      node = this$static.doc.substrate.getNextSibling(start.container);
      size > 0 && $add_9(builder.mutationList, new Nindo$DeleteCharacters_0(size));
    }
  }
   else {
    node = $getNodeAfter(start);
  }
  end.offset >= 0?(stop_0 = end.container):(stop_0 = $getNodeAfter(end));
  while ((node == null?null:node) !== (stop_0 == null?null:stop_0)) {
    next = this$static.doc.substrate.getNextSibling(node);
    text = this$static.doc.substrate.asText_0(node);
    text != null?($add_9(builder.mutationList, new Nindo$DeleteCharacters_0(this$static.doc.substrate.getData(text).length)) , undefined):$deleteElement(this$static, this$static.doc.substrate.asElement_0(node), builder);
    node = next;
  }
  if (end.offset >= 0) {
    size = $getTextOffset(end);
    size > 0 && $add_9(builder.mutationList, new Nindo$DeleteCharacters_0(size));
  }
  return builder;
}

function $emptyElement(this$static, element){
  try {
    this$static.sequencer.begin();
    this$static.sequencer.consume_0(new Nindo_0($emptyElement_0(this$static, element, $at(start_4(this$static.doc, element))).mutationList));
  }
   finally {
    this$static.sequencer.end_0();
  }
}

function $emptyElement_0(this$static, element, builder){
  var elChild, node;
  for (node = this$static.doc.substrate.getFirstChild_0(element); node != null; node = this$static.doc.substrate.getNextSibling(node)) {
    elChild = this$static.doc.substrate.asElement_0(node);
    elChild != null?($add_9(builder.mutationList, ($clinit_1166() , INSTANCE_12)) , $emptyElement_0(this$static, elChild, builder) , $add_9(builder.mutationList, ($clinit_1165() , INSTANCE_11)) , builder):($add_9(builder.mutationList, new Nindo$DeleteCharacters_0($getData_1(this$static.doc, this$static.doc.substrate.asText_0(node)).length)) , undefined);
  }
  return builder;
}

function $getFirstChild_1(this$static, node){
  return this$static.doc.substrate.getFirstChild_0(node);
}

function $getLocation_0(this$static, point){
  checkNotNull_1(point, 'getLocation: Null point');
  return $getLocation_4(this$static.doc, point);
}

function $hackConsume(this$static, op){
  this$static.sequencer.begin();
  try {
    this$static.sequencer.consume_0(op);
  }
   finally {
    this$static.sequencer.end_0();
  }
}

function $insertXml(this$static, point, xml){
  var builder, where;
  point.offset >= 0?checkOffset(this$static, this$static.doc.substrate.asText_0(point.container), $getTextOffset(point), 'MutableDocumentImpl.insertXml'):checkRelationship(this$static, this$static.doc.substrate.asElement_0(point.container), $getNodeAfter(point), 'MutableDocumentImpl.insertXml');
  try {
    this$static.sequencer.begin();
    where = $getLocation_4(this$static.doc, point);
    builder = $at(where);
    appendXmlToBuilder(xml, builder);
    this$static.sequencer.consume_0(new Nindo_0(builder.mutationList));
    return elementAfter(this$static, $locate_0(this$static.doc, where));
  }
   finally {
    this$static.sequencer.end_0();
  }
}

function $locate(this$static, location_0){
  return $locate_0(this$static.doc, location_0);
}

function $setAnnotation(this$static, start, end, key, value){
  checkPersistentKey(key);
  checkPositionIndexesInRange(start, end, $size_10(this$static.doc));
  if (start == end) {
    return;
  }
  try {
    this$static.sequencer.begin();
    this$static.sequencer.consume_0(setAnnotation(start, end, key, value));
  }
   finally {
    this$static.sequencer.end_0();
  }
}

function $setAttribute_1(name_0, value, builder){
  var map;
  $add_9(builder.mutationList, new Nindo$UpdateAttributes_0(($clinit_430() , map = new HashMap_1(1) , map.put(name_0, value) , new Collections$UnmodifiableMap_0(map))));
  return builder;
}

function $setAttributes(attrs, builder){
  $add_9(builder.mutationList, new Nindo$ReplaceAttributes_0(attrs));
  return builder;
}

function $setElementAttribute(this$static, element, name_0, value){
  var currentValue;
  currentValue = this$static.doc.substrate.getAttribute_0(element, name_0);
  if (value == null && currentValue == null || value != null && $equals_3(value, currentValue)) {
    return;
  }
  try {
    this$static.sequencer.begin();
    this$static.sequencer.consume_0(new Nindo_0($setAttribute_1(name_0, value, $at($getLocation_3(this$static.doc, element))).mutationList));
  }
   finally {
    this$static.sequencer.end_0();
  }
}

function $setElementAttributes(this$static, element, attrs){
  checkArgument_0((element == null?null:element) !== maskUndefined(this$static.doc.substrate.getDocumentElement()), 'Cannot touch root element');
  try {
    this$static.sequencer.begin();
    this$static.sequencer.consume_0(new Nindo_0($setAttributes(attrs, $at($getLocation_3(this$static.doc, dynamicCast(element, 163)))).mutationList));
  }
   finally {
    this$static.sequencer.end_0();
  }
}

function appendXmlToBuilder(xml, builder){
  var $e0, e, parser, xmlString;
  xmlString = xml.builder.impl.string;
  try {
    parser = new StreamingXmlParser_0(xmlString);
    while ($hasMore(parser.buffer) || parser.atSelfClosingStart) {
      $next_16(parser);
      switch ((!parser.current?null:parser.current.type_0).ordinal) {
        case 2:
          $characters(builder, $getText(parser.current));
          break;
        case 0:
          $add_9(builder.mutationList, new Nindo$ElementStart_0($getTagName_5(parser.current), new AttributesImpl_1(($clinit_1445() , copyToJavaMap($getAttributes_4(parser.current), new HashMap_0)))));
          break;
        case 1:
          $add_9(builder.mutationList, ($clinit_1167() , INSTANCE_13));
      }
    }
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 203)) {
      e = $e0;
      throw new IllegalArgumentException_2('Ill-formed xml: ' + xmlString, e);
    }
     else 
      throw $e0;
  }
}

function MutableDocumentImpl(){
}

_ = MutableDocumentImpl.prototype = new Object_0;
_.annotationIntervals = function annotationIntervals_0(start, end, keys){
  return $annotationIntervals_0(this.doc, start, end, keys);
}
;
_.asElement_0 = function asElement_1(node){
  return this.doc.substrate.asElement_0(node);
}
;
_.asText_0 = function asText_1(node){
  return this.doc.substrate.asText_0(node);
}
;
_.firstAnnotationChange = function firstAnnotationChange_0(start, end, key, fromValue){
  return $firstAnnotationChange_1(this.doc, start, end, key, dynamicCast(fromValue, 1));
}
;
_.forEachAnnotationAt = function forEachAnnotationAt_0(location_0, callback){
  this.doc.annotations.forEachAnnotationAt(location_0, new IndexedDocumentImpl$7_0(callback));
}
;
_.getAnnotation = function getAnnotation_0(start, key){
  return $getAnnotation_2(this.doc, start, key);
}
;
_.getAttribute_0 = function getAttribute(element, name_0){
  return this.doc.substrate.getAttribute_0(element, name_0);
}
;
_.getAttributes = function getAttributes(element){
  return this.doc.substrate.getAttributes(element);
}
;
_.getClass$ = function getClass_442(){
  return Lorg_waveprotocol_wave_model_document_MutableDocumentImpl_2_classLit;
}
;
_.getData = function getData(textNode){
  return this.doc.substrate.getData(textNode);
}
;
_.getDocumentElement = function getDocumentElement(){
  return this.doc.substrate.getDocumentElement();
}
;
_.getFirstChild_0 = function getFirstChild_1(node){
  return this.doc.substrate.getFirstChild_0(node);
}
;
_.getLastChild_0 = function getLastChild_1(node){
  return this.doc.substrate.getLastChild_0(node);
}
;
_.getLength = function getLength(textNode){
  return this.doc.substrate.getLength(textNode);
}
;
_.getNextSibling = function getNextSibling(node){
  return this.doc.substrate.getNextSibling(node);
}
;
_.getNodeType_0 = function getNodeType_0(node){
  return this.doc.substrate.getNodeType_0(node);
}
;
_.getParentElement = function getParentElement(node){
  return this.doc.substrate.getParentElement(node);
}
;
_.getPreviousSibling = function getPreviousSibling(node){
  return this.doc.substrate.getPreviousSibling(node);
}
;
_.getTagName = function getTagName(element){
  return this.doc.substrate.getTagName(element);
}
;
_.isSameNode = function isSameNode(node, other){
  return this.doc.substrate.isSameNode(node, other);
}
;
_.lastAnnotationChange = function lastAnnotationChange_0(start, end, key, fromValue){
  return $lastAnnotationChange_2(this.doc, start, end, key, dynamicCast(fromValue, 1));
}
;
_.rangedAnnotations = function rangedAnnotations_1(start, end, keys){
  return $rangedAnnotations_1(this.doc, start, end, keys);
}
;
_.size_0 = function size_27(){
  return $size_10(this.doc);
}
;
_.toString$ = function toString_34(){
  return 'MutableDI@' + toPowerOfTwoString(this.$H || (this.$H = ++sNextHashId)) + '[' + $toDebugString(this.doc) + ']';
}
;
_.castableTypeMap$ = {109:1};
_.doc = null;
_.sequencer = null;
function CMutableDocument_0(sequencer, document_0){
  this.sequencer = sequencer;
  this.doc = document_0;
}

function CMutableDocument(){
}

_ = CMutableDocument_0.prototype = CMutableDocument.prototype = new MutableDocumentImpl;
_.getClass$ = function getClass_443(){
  return Lorg_waveprotocol_wave_client_editor_content_CMutableDocument_2_classLit;
}
;
_.castableTypeMap$ = {109:1};
function register_8(registry){
  $registerRenderer(registry, 'doc', new ContentDocElement$1_0);
  $registerEventHandler(registry, 'doc', new ContentDocElement$2_0);
}

function ContentDocElement$1_0(){
}

function ContentDocElement$1(){
}

_ = ContentDocElement$1_0.prototype = ContentDocElement$1.prototype = new Object_0;
_.createDomImpl = function createDomImpl_10(element){
  return $setAutoAppendContainer(element, $doc.createElement('div'));
}
;
_.getClass$ = function getClass_444(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocElement$1_2_classLit;
}
;
_.castableTypeMap$ = {177:1};
function ContentDocElement$2_0(){
  $clinit_554();
}

function ContentDocElement$2(){
}

_ = ContentDocElement$2_0.prototype = ContentDocElement$2.prototype = new NodeEventHandlerImpl;
_.getClass$ = function getClass_445(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocElement$2_2_classLit;
}
;
_.handleBackspaceAtBeginning = function handleBackspaceAtBeginning_3(element, event_0){
  return true;
}
;
_.handleDeleteAtEnd = function handleDeleteAtEnd_3(element, event_0){
  return true;
}
;
_.handleLeftAtBeginning = function handleLeftAtBeginning_1(element, event_0){
  return true;
}
;
_.handleRightAtEnd = function handleRightAtEnd_1(element, event_0){
  return true;
}
;
_.castableTypeMap$ = {180:1};
function $clinit_718(){
  $clinit_718 = nullMethod;
  $clinit_728();
}

function $adjustLevel(this$static, newLevel){
  var currentLevel, i, old;
  old = this$static.level;
  for (i = this$static.level.ordinal + 1; i <= newLevel.ordinal; ++i) {
    currentLevel = ($clinit_741() , $clinit_741() , $VALUES_21)[i];
    switch (currentLevel.ordinal) {
      case 1:
        this$static.fullRawSubstrate.affectImpl || $setAffectHtml(this$static.fullRawSubstrate);
        break;
      case 2:
        checkState(this$static.fullRawSubstrate.affectImpl, 'rendered or higher state should imply affectHtml');
        break;
      case 3:
        break;
      default:throw new AssertionError_0('Unknown level ' + currentLevel);
    }
  }
  for (i = this$static.level.ordinal - 1; i >= newLevel.ordinal; --i) {
    currentLevel = ($clinit_741() , $clinit_741() , $VALUES_21)[i];
    switch (currentLevel.ordinal) {
      case 2:
        this$static.editingConcerns = ($clinit_771() , STUB_0);
        this$static.editorPackage = null;
        this$static.selectionMaintainer.editingConcerns = null;
        break;
      case 1:
        this$static.logicalPanel = null;
        break;
      case 0:
        this$static.fullRawSubstrate.affectImpl && $clearAffectHtml(this$static.fullRawSubstrate);
        clearDocPainter(this$static.context);
        break;
      default:throw new AssertionError_0('Unknown level ' + currentLevel);
    }
  }
  this$static.level = newLevel;
  return old;
}

function $attachEditor(this$static, editorBundle, panel){
  var oldLevel;
  checkNotNull_1(editorBundle, 'editorBundle must not be null');
  checkState(this$static.level != ($clinit_741() , EDITING), 'Cannot attach editor to a document already with an editor');
  !panel?checkState(!!this$static.logicalPanel, 'Must either already have a logical panel, or one must be provided'):(this$static.logicalPanel = panel);
  oldLevel = $adjustLevel(this$static, EDITING);
  this$static.editorPackage = editorBundle;
  this$static.editingConcerns = new ContentDocument$7_0(this$static);
  this$static.selectionMaintainer.editingConcerns = this$static.editingConcerns;
  $setupBehaviour(this$static, this$static.fullRawSubstrate.rootElement, oldLevel);
}

function $beginConsume(this$static, saveSelection){
  if (this$static.selectionMaintainer.savedSelectionDepth > 0) {
    $log_0(($clinit_672() , logger_1).errorLogger, 'Selection save/restore imbalance!');
    this$static.selectionMaintainer.savedSelectionDepth = 0;
  }
  saveSelection?$saveSelection_0(this$static.selectionMaintainer):++this$static.selectionMaintainer.savedSelectionDepth;
}

function $consume_5(this$static, operation){
  $consume_6(this$static, operation);
  !!this$static.editorPackage && ($onIncomingOp(this$static.editorPackage.this$0, operation) , undefined);
}

function $consume_6(this$static, operation){
  var $e0, e;
  if (!this$static.isConsistent) {
    throw new IllegalStateException_1('Document is not in a consistent state - must have died during a previous bad op');
  }
  this$static.isConsistent = false;
  $beginConsume(this$static, true);
  try {
    this$static.applyingToDocument = true;
    try {
      $consume_8(this$static.indexedDoc, operation, false);
    }
     finally {
      this$static.applyingToDocument = false;
    }
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 189)) {
      e = $e0;
      $dealWithBadOp(this$static, false, operation, e, true);
    }
     else if (instanceOf($e0, 4)) {
      e = $e0;
      $dealWithBadOp(this$static, false, operation, e, true);
    }
     else 
      throw $e0;
  }
  $flushNodeRepaint(this$static);
  $restoreSelection(this$static.selectionMaintainer, operation);
  this$static.isConsistent = true;
}

function $consumeLocal(this$static, nindo, saveSelection){
  var $e0, e, e1, op;
  if (!this$static.isConsistent) {
    throw new IllegalStateException_1('Document is not in a consistent state - must have died during a previous bad op');
  }
  if (validateLocalOps) {
    try {
      $maybeThrowOperationExceptionFor_0(this$static.indexedDoc, nindo);
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 189)) {
        e1 = $e0;
        $dealWithBadOp(this$static, true, nindo, e1, false);
      }
       else 
        throw $e0;
    }
  }
  this$static.isConsistent = false;
  $beginConsume(this$static, saveSelection);
  op = null;
  try {
    op = $consumeAndReturnInvertible(this$static.indexedDoc, nindo);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 189)) {
      e = $e0;
      $dealWithBadOp(this$static, true, nindo, e, true);
    }
     else if (instanceOf($e0, 4)) {
      e = $e0;
      $dealWithBadOp(this$static, true, nindo, e, true);
    }
     else 
      throw $e0;
  }
  $flushNodeRepaint(this$static);
  saveSelection?$restoreSelection(this$static.selectionMaintainer, op):--this$static.selectionMaintainer.savedSelectionDepth;
  this$static.isConsistent = true;
  return op;
}

function $createSequencedDocumentWrapper(this$static, sequencer){
  return new CMutableDocument_0(sequencer, this$static.indexedDoc);
}

function $dealWithBadOp(this$static, isLocal, operation, e, probableCorruption){
  var $e0, death, msg, oe, re;
  if (e != null && e.castableTypeMap$ && !!e.castableTypeMap$[189]) {
    oe = dynamicCast(e, 189);
    re = null;
  }
   else {
    oe = null;
    re = dynamicCast(e, 4);
  }
  msg = (probableCorruption?'DEATH: ':'') + 'Invalid ' + (isLocal?'LOCAL':'REMOTE') + ' operation: ' + operation + (!!oe && !!oe.violations?' Violation: ' + $firstDescription(oe.violations):' <No violation information!> ') + 'Exception: ' + e + ' IndexedDoc: ' + $toString_9(this$static.indexedDoc);
  $logPlainText(($clinit_672() , logger_1).errorLogger, msg);
  !oe?(death = re):isLocal && !probableCorruption?$getValidationResult(oe.violations) == ($clinit_1267() , INVALID_SCHEMA)?(death = new ContentDocument$SchemaViolatingLocalOperationException_0(oe.violations)):(death = new ContentDocument$BadOpLocalOperationException_0(oe.violations)):(death = new OperationRuntimeException_0('Invalid for current document', oe));
  if (this$static.repairer) {
    try {
      $revert_0(this$static.repairer, this$static.fullContentView, dynamicCast(this$static.fullContentView.inner_0.getDocumentElement(), 152));
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (!instanceOf($e0, 4))
        throw $e0;
    }
  }
  throw death;
}

function $flush_1(this$static, resume){
  return !this$static.editorPackage || $flush(this$static.editorPackage.this$0, resume);
}

function $flushNodeRepaint(this$static){
  var n, n$iterator;
  for (n$iterator = new AbstractList$IteratorImpl_0(this$static.nodesToRepaint); n$iterator.i < n$iterator.this$0_0.size_0();) {
    n = dynamicCast($next_6(n$iterator), 163);
    $repaintNode(this$static, n);
  }
  $clear_2(this$static.nodesToRepaint);
}

--></script>
<script><!--
function $initRootElementRendering(this$static, isRendering){
  var root;
  if (!!this$static.rootElement == isRendering) {
    return;
  }
  root = this$static.fullRawSubstrate.rootElement;
  if (isRendering) {
    this$static.rootElement = root.implNodelet;
    this$static.rawHtmlView = new HtmlViewImpl_0(this$static.rootElement);
    this$static.filteredHtmlView = new ContentDocument$FilteredHtml_0(this$static, this$static.rawHtmlView);
    this$static.strippingHtmlView = new StrippingHtmlView_0(this$static.rootElement);
    this$static.repairer = new Repairer_0(this$static.persistentContentView, this$static.renderedContentView, this$static.strippingHtmlView, this$static.repairListener);
    this$static.nodeManager = new NodeManager_0(this$static.filteredHtmlView, this$static.renderedContentView, this$static.repairer);
  }
   else {
    this$static.rootElement = null;
    this$static.rawHtmlView = null;
    this$static.filteredHtmlView = null;
    this$static.strippingHtmlView = null;
    this$static.repairer = null;
    this$static.nodeManager = null;
  }
}

function $maybeSetupModeNotifications(this$static, element){
  if (!!this$static.editorPackage && ($clinit_811() , !!getListener(element))) {
    onEditModeChange(element, this$static.editorPackage.this$0.editing);
    $add_22(this$static.editorPackage.this$0.elementsWithDisplayEditModes, element);
  }
}

function $postCreation(this$static, element){
  $containsKey_5(element.attributes, 'name') && $put_5(this$static.nameMap, dynamicCast($get_12(element.attributes, 'name'), 1), element);
}

function $repaintNode(this$static, node){
  var element, end, start, textNode;
  if (node.isTextNode()) {
    textNode = node.asText();
    if (textNode.parent_0) {
      start = $getLocation_3(this$static.indexedDoc, textNode);
      maybeScheduleRepaint(this$static.context, start, start + textNode.data_0.length);
    }
  }
   else {
    element = node.asElement();
    start = $getLocation_4(this$static.indexedDoc, start_5(this$static.indexedDoc, element));
    end = $getLocation_4(this$static.indexedDoc, new Point$El_0(element, null));
    maybeScheduleRepaint(this$static.context, start, end);
  }
}

function $replaceOutgoingSink(this$static, newSink){
  var oldSink;
  checkState(!!this$static.outgoingOperationSink, '');
  oldSink = this$static.outgoingOperationSink;
  this$static.outgoingOperationSink = newSink;
  return oldSink;
}

function $setInteractive(this$static, logicalPanel){
  var oldLevel;
  checkNotNull_1(logicalPanel, 'Null logicalPanel');
  if (this$static.logicalPanel == logicalPanel) {
    checkState(!!this$static.logicalPanel, "Don't have a logicalPanel");
    $adjustLevel(this$static, ($clinit_741() , INTERACTIVE));
    return;
  }
  this$static.logicalPanel = logicalPanel;
  oldLevel = $adjustLevel(this$static, ($clinit_741() , INTERACTIVE));
  $setupBehaviour(this$static, this$static.fullRawSubstrate.rootElement, oldLevel);
}

function $setRegistries(this$static, registriesBundle){
  this$static.registries = registriesBundle;
  this$static.registries?createAndSetDocPainter(this$static.context, this$static.registries.paintRegistry):clearDocPainter(this$static.context);
}

function $setRendering(this$static){
  var oldLevel;
  if (this$static.level == ($clinit_741() , RENDERED)) {
    return;
  }
  oldLevel = $adjustLevel(this$static, RENDERED);
  $setupBehaviour(this$static, this$static.fullRawSubstrate.rootElement, oldLevel);
}

function $setShelved(this$static){
  var oldLevel;
  oldLevel = $adjustLevel(this$static, ($clinit_741() , SHELVED));
  $setupBehaviour(this$static, this$static.fullRawSubstrate.rootElement, oldLevel);
}

function $setupBehaviour(this$static, element, oldLevel){
  var e, elementRegistry, mutationHandler, n, notRendered, shouldBeRendered;
  e = dynamicCast(element, 187);
  elementRegistry = this$static.registries.elementHandlerRegistry;
  if (!oldLevel) {
    mutationHandler = dynamicCast($get_12(dynamicCast(elementRegistry.data_0.roCache, 151).mutationHandlers, e.tagName_0), 179);
    mutationHandler != null && mutationHandler.castableTypeMap$ && !!mutationHandler.castableTypeMap$[188] && $setNodeMutationHandler(e, mutationHandler);
    oldLevel = ($clinit_741() , SHELVED);
  }
  notRendered = e.renderer == ($clinit_698() , noRenderer);
  shouldBeRendered = this$static.level.ordinal - ($clinit_741() , RENDERED).ordinal >= 0;
  switch (oldLevel.ordinal) {
    case 0:
      if (this$static.level.ordinal - SHELVED.ordinal <= 0)
        break;
      $setupRenderer(this$static, e, true);
      e == this$static.fullRawSubstrate.rootElement && $initRootElementRendering(this$static, true);
      $setNodeMutationHandler(e, dynamicCast($get_12(dynamicCast(elementRegistry.data_0.roCache, 151).mutationHandlers, e.tagName_0), 179));
    case 1:
      if (this$static.level.ordinal - RENDERED.ordinal <= 0)
        break;
      $setNodeEventHandler(e, dynamicCast($get_12(dynamicCast(elementRegistry.data_0.roCache, 151).eventHandlers, e.tagName_0), 180));
      !!e && $setLogicalParent(e, this$static.logicalPanel);
    case 2:
      if (this$static.level.ordinal - INTERACTIVE.ordinal <= 0)
        break;
      $maybeSetupModeNotifications(this$static, e);
  }
  switch (oldLevel.ordinal) {
    case 3:
      if (this$static.level.ordinal - EDITING.ordinal >= 0)
        break;
    case 2:
      if (this$static.level.ordinal - INTERACTIVE.ordinal >= 0)
        break;
      !!e && $setLogicalParent(e, this$static.logicalPanel);
      $setNodeEventHandler(e, null);
    case 1:
      if (this$static.level.ordinal - RENDERED.ordinal >= 0)
        break;
      mutationHandler = dynamicCast($get_12(dynamicCast(elementRegistry.data_0.roCache, 151).mutationHandlers, e.tagName_0), 179);
      mutationHandler != null && mutationHandler.castableTypeMap$ && !!mutationHandler.castableTypeMap$[188]?$setNodeMutationHandler(e, mutationHandler):$setNodeMutationHandler(e, null);
      $setupRenderer(this$static, e, false);
      e == this$static.fullRawSubstrate.rootElement && $initRootElementRendering(this$static, false);
  }
  for (n = e.firstChild_0; n; n = n.next) {
    n != null && n.castableTypeMap$ && !!n.castableTypeMap$[152]?$setupBehaviour(this$static, dynamicCast(n, 187), oldLevel):$setRendering_0(n.asText(), shouldBeRendered);
  }
  notRendered && shouldBeRendered && $implInsertBefore(e, e, e.firstChild_0, null, null, e.containerNodelet);
  oldLevel.ordinal - RENDERED.ordinal < 0 && this$static.level.ordinal - RENDERED.ordinal >= 0 && e.nodeMutationHandler.onActivatedSubtree(e);
}

function $setupRenderer(this$static, e, isRendering){
  var renderer;
  if (isRendering) {
    renderer = $getRenderer(this$static.registries.elementHandlerRegistry, e);
    $setRenderer_0(e, renderer?renderer:($clinit_698() , defaultRenderer));
  }
   else {
    $setRenderer_0(e, ($clinit_698() , noRenderer));
  }
}

function $sourceNindoWithoutModifyingHtml(this$static, nindo){
  $clearAffectHtml(this$static.persistentContentView.inner);
  try {
    $consumeAndReturnInvertible_0(this$static.dontSaveSelectionNindoSink, nindo);
  }
   finally {
    $setAffectHtml(this$static.persistentContentView.inner);
  }
}

function ContentDocument_0(initialRegistries, initialState, schema){
  $clinit_718();
  ContentDocument_1.call(this, schema);
  this.registries = initialRegistries;
  this.registries?createAndSetDocPainter(this.context, this.registries.paintRegistry):clearDocPainter(this.context);
  $consume_6(this, initialState);
  !!this.editorPackage && ($onIncomingOp(this.editorPackage.this$0, initialState) , undefined);
}

function ContentDocument_1(documentSchema){
  $clinit_718();
  var annotationListener, contentRoot;
  this.outgoingOperationSink = ($clinit_1422() , VOID);
  this.outgoingRepaintSink = new ContentDocument$1_0(this);
  this.nindoSink = new ContentDocument$SourceNindoSink_0(this, true);
  this.dontSaveSelectionNindoSink = new ContentDocument$SourceNindoSink_0(this, false);
  this.renderingConcerns = new ContentDocument$2_0(this);
  this.editingConcerns = ($clinit_771() , STUB_0);
  this.documentUniqueString = 'ed' + counter_0++ + '_';
  this.nameMap = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  this.nodesToRepaint = new ArrayList_0;
  this.factory = new ContentDocument$3_0(this);
  this.context = new ContentDocument$4_0(this);
  this.repairListener = new ContentDocument$5_0(this);
  this.level = ($clinit_741() , SHELVED);
  annotationListener = new ContentDocument$6_0(this);
  contentRoot = new AgentAdapter_0('doc', ($clinit_1145() , EMPTY_MAP_0), this.context, ($clinit_645() , ROOT_HANDLER_REGISTRY));
  this.sequencer = new EditorOperationSequencer_0(this.nindoSink);
  this.fullAnnotationSet = new EditorAnnotationTree_0(annotationListener);
  this.localAnnotations = new ContentDocument$LocalAnnotationSet_0(this, this.fullAnnotationSet);
  this.fullRawSubstrate = new ContentRawDocument_0(contentRoot, this.factory);
  this.fullContentView = new ContentDocument$FullContent_0(this, this.fullRawSubstrate);
  this.renderedContentView = new ContentDocument$RenderedContent_0(this.fullRawSubstrate);
  this.persistentContentView = new ContentDocument$PersistentContentDoc_0(this, this.fullRawSubstrate);
  this.indexedDoc = new ContentDocument$ContentIndexedDoc_0(this, this.persistentContentView, this.fullAnnotationSet, documentSchema);
  this.lazyPersistenceManager = new LazyPersistenceManager_0(this.outgoingRepaintSink, this.fullContentView, this.indexedDoc, this.persistentContentView, this.indexedDoc);
  $setPersistenceManager(this.persistentContentView, this.lazyPersistenceManager);
  this.selectionMaintainer = new SelectionMaintainer_0(this.indexedDoc);
  this.mutableContent = new CMutableDocument_0(this.sequencer, this.indexedDoc);
  this.selectionContent = ($clinit_971() , new FilterProduct_0(initValues(_3Lorg_waveprotocol_wave_model_document_util_FilteredView_2_classLit, {58:1, 138:1}, 121, [this.persistentContentView, this.renderedContentView])));
}

function ContentDocument(){
}

_ = ContentDocument_1.prototype = ContentDocument_0.prototype = ContentDocument.prototype = new Object_0;
_.getClass$ = function getClass_446(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument_2_classLit;
}
;
_.toString$ = function toString_35(){
  return $toString_9(this.indexedDoc);
}
;
_.castableTypeMap$ = {};
_.applyingToDocument = false;
_.editorPackage = null;
_.filteredHtmlView = null;
_.fullAnnotationSet = null;
_.fullContentView = null;
_.fullRawSubstrate = null;
_.indexedDoc = null;
_.isConsistent = true;
_.lazyPersistenceManager = null;
_.localAnnotations = null;
_.logicalPanel = null;
_.mutableContent = null;
_.nodeManager = null;
_.persistentContentView = null;
_.rawHtmlView = null;
_.registries = null;
_.renderedContentView = null;
_.repairer = null;
_.rootElement = null;
_.selectionContent = null;
_.selectionMaintainer = null;
_.sequencer = null;
_.strippingHtmlView = null;
var counter_0 = 1, validateLocalOps = true;
function $consume_7(this$static, op){
  this$static.this$0.outgoingOperationSink.consume(op);
  $flushNodeRepaint(this$static.this$0);
}

function ContentDocument$1_0(this$0){
  this.this$0 = this$0;
}

function ContentDocument$1(){
}

_ = ContentDocument$1_0.prototype = ContentDocument$1.prototype = new Object_0;
_.consume = function consume_2(op){
  this.this$0.outgoingOperationSink.consume(op);
  $flushNodeRepaint(this.this$0);
}
;
_.getClass$ = function getClass_447(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function ContentDocument$2_0(this$0){
  this.this$0 = this$0;
}

function ContentDocument$2(){
}

_ = ContentDocument$2_0.prototype = ContentDocument$2.prototype = new Object_0;
_.getClass$ = function getClass_448(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $createElement_3(this$static, tagName, attributes){
  var el;
  el = new AgentAdapter_0(tagName, attributes, this$static.this$0.context, this$static.this$0.registries.elementHandlerRegistry);
  $postCreation(this$static.this$0, el);
  return el;
}

function $createText(this$static, text){
  return new ContentTextNode_0(text, this$static.this$0.context);
}

function ContentDocument$3_0(this$0){
  this.this$0 = this$0;
}

function ContentDocument$3(){
}

_ = ContentDocument$3_0.prototype = ContentDocument$3.prototype = new Object_0;
_.getClass$ = function getClass_449(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $getElementByName_0(this$static, name_0){
  return dynamicCast($get_12(this$static.this$0.nameMap, name_0), 152);
}

function ContentDocument$4_0(this$0){
  this.this$0 = this$0;
  new ContentDocument$4$1_0(this);
}

function ContentDocument$4(){
}

_ = ContentDocument$4_0.prototype = ContentDocument$4.prototype = new Object_0;
_.getClass$ = function getClass_450(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$4_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $scheduleFinally_0(this$static, task){
  this$static.tasks.backend.size == 0 && !this$static.isExecuting && $scheduleFinally(($clinit_18() , INSTANCE), this$static.command);
  $add_19(this$static.tasks, task);
}

function FinalTaskRunnerImpl_0(){
  this.tasks = ($clinit_1445() , $clinit_1445() , new CollectionUtils$IdentitySetAdapter_0);
  this.command = new FinalTaskRunnerImpl$1_0(this);
}

function FinalTaskRunnerImpl(){
}

_ = FinalTaskRunnerImpl_0.prototype = FinalTaskRunnerImpl.prototype = new Object_0;
_.begin = function begin_2(){
}
;
_.end_0 = function end_5(){
}
;
_.getClass$ = function getClass_451(){
  return Lorg_waveprotocol_wave_client_scheduler_FinalTaskRunnerImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.isExecuting = false;
function ContentDocument$4$1_0(this$1){
  this.this$1 = this$1;
  FinalTaskRunnerImpl_0.call(this);
}

function ContentDocument$4$1(){
}

_ = ContentDocument$4$1_0.prototype = ContentDocument$4$1.prototype = new FinalTaskRunnerImpl;
_.begin = function begin_3(){
  $clinit_672();
  ++ignoreMutations;
  $saveSelection_0(this.this$1.this$0.selectionMaintainer);
}
;
_.end_0 = function end_6(){
  $restoreSelection(this.this$1.this$0.selectionMaintainer, null);
  $clinit_672();
  --ignoreMutations;
}
;
_.getClass$ = function getClass_452(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$4$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
function $onFullDocumentRevert(this$static){
  !!this$static.this$0.editorPackage && (this$static.this$0.editorPackage , $clinit_670() , undefined);
}

function $onRangeRevert(this$static){
  !!this$static.this$0.editorPackage && (this$static.this$0.editorPackage , $clinit_670() , undefined);
}

function ContentDocument$5_0(this$0){
  this.this$0 = this$0;
}

function ContentDocument$5(){
}

_ = ContentDocument$5_0.prototype = ContentDocument$5.prototype = new Object_0;
_.getClass$ = function getClass_453(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$5_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $onAnnotationChange(this$static, start, end, key, newValue){
  var $e0, e, handlers, ret;
  $clinit_672();
  ++ignoreMutations;
  try {
    handlers = $getHandlers(this$static.this$0.registries.annotationHandlerRegistry, key);
    while (handlers.next) {
      try {
        (ret = handlers.next , $getNext_0(handlers) , ret).handleAnnotationChange(this$static.this$0.context, start, end, key, newValue);
      }
       catch ($e0) {
        $e0 = caught_0($e0);
        if (instanceOf($e0, 143)) {
          e = $e0;
          $log_4(logger_1.errorLogger, 'Exception from annotation change handler', e);
        }
         else 
          throw $e0;
      }
    }
  }
   finally {
    --ignoreMutations;
  }
}

function ContentDocument$6_0(this$0){
  this.this$0 = this$0;
}

function ContentDocument$6(){
}

_ = ContentDocument$6_0.prototype = ContentDocument$6.prototype = new Object_0;
_.getClass$ = function getClass_454(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$6_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function ContentDocument$7_0(this$0){
  this.this$0 = this$0;
}

function ContentDocument$7(){
}

_ = ContentDocument$7_0.prototype = ContentDocument$7.prototype = new Object_0;
_.getClass$ = function getClass_455(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$7_2_classLit;
}
;
_.getSelectionHelper = function getSelectionHelper_0(){
  return this.this$0.editorPackage.this$0.passiveSelectionHelper;
}
;
_.getSuggestionsManager = function getSuggestionsManager(){
  return this.this$0.editorPackage.this$0.suggestionsManager;
}
;
_.getTypingExtractor = function getTypingExtractor(){
  return this.this$0.editorPackage.this$0.typing;
}
;
_.hasEditor = function hasEditor(){
  return true;
}
;
_.textNodeletAffected = function textNodeletAffected(nodelet, affectedAfterOffset, insertionAmount, changeType){
  $textNodeletAffected(this.this$0.selectionMaintainer, nodelet, affectedAfterOffset, insertionAmount, changeType);
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $clinit_728(){
  $clinit_728 = nullMethod;
  SIMPLE = new ContentDocument$AnnotationImplFactory$1_0;
  TREE = new ContentDocument$AnnotationImplFactory$2_0;
  STUB = new ContentDocument$AnnotationImplFactory$3_0;
  $VALUES_20 = initValues(_3Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory_2_classLit, {58:1, 138:1}, 81, [SIMPLE, TREE, STUB]);
}

function values_21(){
  $clinit_728();
  return $VALUES_20;
}

function ContentDocument$AnnotationImplFactory(){
}

_ = ContentDocument$AnnotationImplFactory.prototype = new Enum;
_.getClass$ = function getClass_456(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 81:1};
var $VALUES_20, SIMPLE, STUB, TREE;
function ContentDocument$AnnotationImplFactory$1_0(){
  this.name_0 = 'SIMPLE';
  this.ordinal = 0;
}

function ContentDocument$AnnotationImplFactory$1(){
}

_ = ContentDocument$AnnotationImplFactory$1_0.prototype = ContentDocument$AnnotationImplFactory$1.prototype = new ContentDocument$AnnotationImplFactory;
_.getClass$ = function getClass_457(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory$1_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 81:1};
function ContentDocument$AnnotationImplFactory$2_0(){
  this.name_0 = 'TREE';
  this.ordinal = 1;
}

function ContentDocument$AnnotationImplFactory$2(){
}

_ = ContentDocument$AnnotationImplFactory$2_0.prototype = ContentDocument$AnnotationImplFactory$2.prototype = new ContentDocument$AnnotationImplFactory;
_.getClass$ = function getClass_458(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory$2_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 81:1};
function ContentDocument$AnnotationImplFactory$3_0(){
  this.name_0 = 'STUB';
  this.ordinal = 2;
}

function ContentDocument$AnnotationImplFactory$3(){
}

_ = ContentDocument$AnnotationImplFactory$3_0.prototype = ContentDocument$AnnotationImplFactory$3.prototype = new ContentDocument$AnnotationImplFactory;
_.getClass$ = function getClass_459(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory$3_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 81:1};
function ContentDocument$LocalOperationException_0(violation){
  this.fillInStackTrace();
  this.detailMessage = '' + violation;
  checkNotNull_1(violation, 'Missing violation information');
  this.violation = violation;
}

function ContentDocument$LocalOperationException(){
}

_ = ContentDocument$LocalOperationException.prototype = new RuntimeException;
_.getClass$ = function getClass_460(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$LocalOperationException_2_classLit;
}
;
_.toString$ = function toString_36(){
  return 'LocalOperationException: ' + this.violation;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1, 168:1};
_.violation = null;
function ContentDocument$BadOpLocalOperationException_0(violation){
  ContentDocument$LocalOperationException_0.call(this, violation);
  checkArgument_0((violation.operationIllFormed.size == 0?violation.operationInvalid.size == 0?violation.schemaViolations.size == 0?($clinit_1267() , VALID):($clinit_1267() , INVALID_SCHEMA):($clinit_1267() , INVALID_DOCUMENT):($clinit_1267() , ILL_FORMED)) != ($clinit_1267() , INVALID_SCHEMA), 'Not a low level violation');
}

function ContentDocument$BadOpLocalOperationException(){
}

_ = ContentDocument$BadOpLocalOperationException_0.prototype = ContentDocument$BadOpLocalOperationException.prototype = new ContentDocument$LocalOperationException;
_.getClass$ = function getClass_461(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$BadOpLocalOperationException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1, 168:1};
function $annotationIntervals_0(this$static, start, end, keys){
  var iterable;
  !keys?(keys = $knownKeys(this$static)):$each_3(keys, new IndexedDocumentImpl$3_0);
  iterable = this$static.annotations.annotationIntervals(start, end, keys);
  return new IndexedDocumentImpl$8_0(iterable);
}

function $asElement_1(this$static, node){
  return this$static.substrate.asElement_0(node);
}

function $asOperation(this$static){
  var $e0, annotationsOp, bothOps, domOp, e, initialisation;
  if (($checkSizeConsistency(this$static, 'size') , this$static.offsetList.root.offset) == 0) {
    return $clinit_1369() , EMPTY_DOCUMENT_0;
  }
  domOp = $serializeDom(this$static);
  annotationsOp = $serializeAnnotations(this$static);
  try {
    bothOps = compose(domOp, annotationsOp);
    initialisation = bothOps != null && bothOps.castableTypeMap$ && !!bothOps.castableTypeMap$[218]?dynamicCast(bothOps, 218):new DocOpUtil$1_0(bothOps);
    return initialisation;
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 189)) {
      e = $e0;
      throw new OperationRuntimeException_0('Bug either in indexed document or the composer', e);
    }
     else 
      throw $e0;
  }
}

function $beginChange(this$static){
  this$static.inconsistent = true;
  $resetLocation(this$static);
  this$static.annotations.begin();
}

function $checkRetain(this$static, count){
  if (this$static.currentLocation + count > ($checkSizeConsistency(this$static, 'size') , this$static.offsetList.root.offset)) {
    throw new OpCursorException_0('Retain past end of document [location:' + (this$static.currentLocation + count) + '] [doc size:' + ($checkSizeConsistency(this$static, 'size') , this$static.offsetList.root.offset) + ']');
  }
}

function $checkSizeConsistency(this$static, msgPrefix){
  if (!!this$static.annotations && !!this$static.offsetList && this$static.offsetList.root.offset != this$static.annotations.size_0()) {
    throw new RuntimeException_1(msgPrefix + ': Document and annotations have inconsistent size: ' + this$static.offsetList.root.offset + ' vs ' + this$static.annotations.size_0() + ', respectively');
  }
}

function $consume_8(this$static, op, validate){
  var $e0, e;
  checkState(!this$static.inconsistent, 'The document is not in a consistent state');
  validate && $maybeThrowOperationExceptionFor(this$static, op);
  this$static.inconsistent = true;
  $resetLocation(this$static);
  this$static.annotations.begin();
  try {
    op.apply_5(this$static.invertibleCursor);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 217)) {
      e = $e0;
      throw new OperationException_1(e.detailMessage, e);
    }
     else 
      throw $e0;
  }
  $endChange(this$static);
}

function $consumeAndReturnInvertible(this$static, op){
  var $e0, e;
  checkState(!this$static.inconsistent, 'The document is not in a consistent state');
  $begin2(this$static.nindoCursor);
  try {
    $apply_19(op, this$static.nindoCursor);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 217)) {
      e = $e0;
      throw new OperationException_1(e.detailMessage, e);
    }
     else 
      throw $e0;
  }
  return $finish2(this$static.nindoCursor);
}

function $deleteCurrentContainer(this$static){
  var nextContainer;
  nextContainer = this$static.currentContainer.nextContainer;
  $remove_29(this$static.currentContainer);
  this$static.currentContainer = nextContainer;
}

function $doCharacters(this$static, characters){
  var domNode, newTextNode, previousNode, previousTextNode, textNode;
  this$static.annotations.insert(characters.length);
  previousNode = null;
  previousTextNode = null;
  if (this$static.currentOffset == 0) {
    previousNode = this$static.currentContainer.previousContainer;
    previousTextNode = this$static.substrate.asText_0(previousNode.value_0);
  }
  if (previousTextNode != null) {
    this$static.substrate.appendData(previousTextNode, characters);
    $increaseSize(previousNode, characters.length);
  }
   else {
    domNode = this$static.currentContainer.value_0;
    textNode = this$static.substrate.asText_0(domNode);
    if (textNode != null) {
      this$static.substrate.insertData_0(textNode, this$static.currentOffset, characters);
      $increaseSize(this$static.currentContainer, characters.length);
      this$static.currentOffset += characters.length;
    }
     else {
      newTextNode = this$static.substrate.createTextNode_0(characters, this$static.currentParent, this$static.currentContainer.value_0);
      $insertBefore_2(this$static, this$static.currentContainer, newTextNode, characters.length);
    }
  }
  this$static.currentLocation += characters.length;
}

function $doDeleteCharacters(this$static, deletionSize){
  var amountToDelete, currentLength, textBuilder, textNode;
  textBuilder = new StringBuilder_0;
  if (this$static.deletionDepth <= 0) {
    textNode = this$static.substrate.asText_0(this$static.currentContainer.value_0);
    currentLength = this$static.substrate.getLength(textNode);
    if (this$static.currentOffset + deletionSize < currentLength) {
      $append_8(textBuilder, $substring_0(this$static.substrate.getData(textNode), this$static.currentOffset, this$static.currentOffset + deletionSize));
      this$static.substrate.deleteData_0(textNode, this$static.currentOffset, deletionSize);
      $increaseSize(this$static.currentContainer, -deletionSize);
    }
     else {
      if (this$static.currentOffset > 0) {
        amountToDelete = currentLength - this$static.currentOffset;
        $append_8(textBuilder, $substring(this$static.substrate.getData(textNode), this$static.currentOffset));
        this$static.substrate.deleteData_0(textNode, this$static.currentOffset, amountToDelete);
        $increaseSize(this$static.currentContainer, -amountToDelete);
        deletionSize -= amountToDelete;
        this$static.currentContainer = this$static.currentContainer.nextContainer;
        this$static.currentOffset = 0;
      }
      while (deletionSize > 0) {
        textNode = this$static.substrate.asText_0(this$static.currentContainer.value_0);
        currentLength = this$static.substrate.getLength(textNode);
        if (currentLength <= deletionSize) {
          $append_8(textBuilder, this$static.substrate.getData(textNode));
          this$static.substrate.removeChild_0(this$static.currentParent, textNode);
          $deleteCurrentContainer(this$static);
          deletionSize -= currentLength;
        }
         else {
          $append_8(textBuilder, this$static.substrate.getData(textNode).substr(0, deletionSize - 0));
          this$static.substrate.deleteData_0(textNode, 0, deletionSize);
          $increaseSize(this$static.currentContainer, -deletionSize);
          break;
        }
      }
    }
  }
   else {
    while (deletionSize > 0) {
      textNode = this$static.substrate.asText_0(this$static.currentContainer.value_0);
      if (deletionSize < this$static.substrate.getLength(textNode)) {
        $append_8(textBuilder, this$static.substrate.getData(textNode).substr(0, deletionSize - 0));
        this$static.substrate.deleteData_0(textNode, 0, deletionSize);
        $increaseSize(this$static.currentContainer, -deletionSize);
        break;
      }
       else {
        $append_8(textBuilder, this$static.substrate.getData(textNode));
        deletionSize -= this$static.currentContainer.size;
        $deleteCurrentContainer(this$static);
      }
    }
  }
  return textBuilder.impl.string;
}

function $doElementEnd(this$static){
  this$static.annotations.insert(1);
  ++this$static.currentLocation;
  this$static.currentContainer = this$static.currentContainer.nextContainer;
  this$static.currentParent = this$static.substrate.getParentElement(this$static.currentParent);
}

function $doElementStart(this$static, tagName, attributes){
  var newElement;
  $splitCurrent(this$static);
  newElement = this$static.substrate.createElement_0(tagName, attributes, this$static.currentParent, this$static.currentContainer.value_0);
  $insertBefore_2(this$static, this$static.currentContainer, newElement, 1);
  $insertBefore_8(this$static.currentContainer, null, 1);
  this$static.annotations.insert(1);
  this$static.currentContainer = this$static.currentContainer.previousContainer;
  this$static.currentParent = newElement;
  ++this$static.currentLocation;
}

function $doEndAnnotation(this$static, key){
  if (key.charCodeAt(0) == 64) {
    throw new IllegalArgumentException_1('Cannot access local annotations');
  }
  this$static.annotations.endAnnotation(key);
}

--></script>
<script><!--
function $doStartAnnotation(this$static, key, value){
  if (key.charCodeAt(0) == 64) {
    throw new IllegalArgumentException_1('Cannot access local annotations');
  }
  this$static.annotations.startAnnotation(key, value);
}

function $endChange(this$static){
  if (this$static.currentLocation != ($checkSizeConsistency(this$static, 'size') , this$static.offsetList.root.offset)) {
    throw new OperationException_0('Operation size does not match document size [operation size:' + this$static.currentLocation + '] [doc size:' + ($checkSizeConsistency(this$static, 'size') , this$static.offsetList.root.offset) + ']');
  }
  this$static.annotations.finish();
  $checkSizeConsistency(this$static, 'finish');
  this$static.inconsistent = false;
}

function $firstAnnotationChange_1(this$static, start, end, key, fromValue){
  if (key.charCodeAt(0) == 64) {
    throw new IllegalArgumentException_1('Cannot access local annotations');
  }
  return this$static.annotations.firstAnnotationChange(start, end, key, fromValue);
}

function $getAnnotation_2(this$static, start, key){
  if (key.charCodeAt(0) == 64) {
    throw new IllegalArgumentException_1('Cannot access local annotations');
  }
  return dynamicCast(this$static.annotations.getAnnotation(start, key), 1);
}

function $getData_1(this$static, textNode){
  return this$static.substrate.getData(textNode);
}

function $getLastLocationIn(this$static, node){
  var indexingContainer, lastChild;
  lastChild = this$static.substrate.getLastChild_0(node);
  if (lastChild != null) {
    if (this$static.substrate.asElement_0(lastChild) != null) {
      return $getLastLocationIn(this$static, lastChild) + 1;
    }
     else {
      indexingContainer = this$static.substrate.getIndexingContainer(lastChild);
      return $offset(indexingContainer) + indexingContainer.size;
    }
  }
   else 
    return (node == null?null:node) === maskUndefined(this$static.substrate.getDocumentElement())?($checkSizeConsistency(this$static, 'size') , this$static.offsetList.root.offset):$offset(this$static.substrate.getIndexingContainer(node)) + 1;
}

function $getLength_1(this$static, textNode){
  return this$static.substrate.getLength(textNode);
}

function $getLocation_1(this$static, node){
  var indexingContainer;
  checkNotNull_1(node, 'Cannot get the location of a null node');
  indexingContainer = this$static.substrate.getIndexingContainer(node);
  if (!indexingContainer) {
    throw new IllegalArgumentException_1('getLocation: node has no indexing container - ' + node);
  }
  if (!indexingContainer.nextContainer) {
    throw new IllegalArgumentException_1('getLocation: node probably removed from DOM - ' + node);
  }
  return $offset(indexingContainer);
}

function $getLocation_2(this$static, point){
  var nodeAfter;
  checkNotNull_1(point, 'Cannot get the location of a null point');
  point.offset >= 0?checkOffset(this$static, this$static.substrate.asText_0(point.container), $getTextOffset(point), 'IndexedDocumentImpl#getLocation'):checkRelationship(this$static, this$static.substrate.asElement_0(point.container), $getNodeAfter(point), 'IndexedDocumentImpl#getLocation');
  if (point.offset >= 0) {
    return $getLocation_3(this$static, dynamicCast(point.container, 163)) + $getTextOffset(point);
  }
   else {
    nodeAfter = $getNodeAfter(point);
    return nodeAfter == null?$getLastLocationIn(this$static, point.container):$getLocation_3(this$static, dynamicCast(nodeAfter, 163));
  }
}

function $getParentOf(this$static, container){
  var counter, domNode, i, parent_0;
  domNode = container.value_0;
  if (domNode != null) {
    return this$static.substrate.getParentElement(domNode);
  }
  counter = 0;
  container = container.previousContainer;
  while (container.value_0 == null) {
    ++counter;
    container = container.previousContainer;
  }
  domNode = container.value_0;
  parent_0 = this$static.substrate.asElement_0(domNode);
  parent_0 == null && (parent_0 = this$static.substrate.getParentElement(domNode));
  for (i = 0; i < counter; ++i) {
    parent_0 = this$static.substrate.getParentElement(parent_0);
  }
  return parent_0;
}

function $indexChildren(this$static, element){
  var child, childElement, childText, sentinel, sentinel_0;
  sentinel = this$static.offsetList.root;
  for (child = this$static.substrate.getFirstChild_0(element); child != null; child = this$static.substrate.getNextSibling(child)) {
    childElement = this$static.substrate.asElement_0(child);
    if (childElement != null) {
      sentinel_0 = this$static.offsetList.root;
      this$static.substrate.setIndexingContainer(childElement, $insertBefore_8(sentinel_0, childElement, 1));
      $indexChildren(this$static, childElement);
      $insertBefore_8(sentinel_0, null, 1);
    }
     else {
      childText = this$static.substrate.asText_0(child);
      $insertBefore_2(this$static, sentinel, childText, this$static.substrate.getLength(childText));
    }
  }
}

function $insertBefore_2(this$static, container, domNode, size){
  this$static.substrate.setIndexingContainer(domNode, $insertBefore_8(container, domNode, size));
}

function $knownKeys(this$static){
  var knownKeys;
  knownKeys = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringSetAdapter_0(new HashSet_0));
  $each_3(this$static.annotations.knownKeysLive(), new IndexedDocumentImpl$6_0(knownKeys));
  return knownKeys;
}

function $lastAnnotationChange_2(this$static, start, end, key, fromValue){
  if (key.charCodeAt(0) == 64) {
    throw new IllegalArgumentException_1('Cannot access local annotations');
  }
  return this$static.annotations.lastAnnotationChange(start, end, key, fromValue);
}

function $locate_0(this$static, location_0){
  checkPositionIndex(location_0, this$static.offsetList.root.offset);
  return $performActionAt(this$static.offsetList, location_0, this$static.pointFinder);
}

function $maybeThrowOperationExceptionFor(this$static, op){
  var vc;
  if (validate_1(null, this$static.schemaConstraints, this$static.autoDoc, op) != ($clinit_1267() , VALID)) {
    vc = new DocOpAutomaton$ViolationCollector_0;
    validate_1(vc, this$static.schemaConstraints, this$static.autoDoc, op);
    throw new OperationException_2(vc);
  }
}

function $maybeThrowOperationExceptionFor_0(this$static, op){
  var vc;
  vc = validate_0(this$static, op, this$static.schemaConstraints);
  if ((vc.operationIllFormed.size == 0?vc.operationInvalid.size == 0?vc.schemaViolations.size == 0?($clinit_1267() , VALID):($clinit_1267() , INVALID_SCHEMA):($clinit_1267() , INVALID_DOCUMENT):($clinit_1267() , ILL_FORMED)) != ($clinit_1267() , VALID)) {
    throw new OperationException_2(vc);
  }
}

function $moveToCurrentLocation(this$static){
  $performActionAt(this$static.offsetList, this$static.currentLocation, this$static.locationUpdater);
}

function $rangedAnnotations_1(this$static, start, end, keys){
  var iterable;
  !keys?(keys = $knownKeys(this$static)):$each_3(keys, new IndexedDocumentImpl$3_0);
  iterable = this$static.annotations.rangedAnnotations(start, end, keys);
  return new IndexedDocumentImpl$9_0(iterable);
}

function $resetLocation(this$static){
  this$static.currentLocation = 0;
  this$static.currentOffset = 0;
  this$static.currentParent = this$static.substrate.getDocumentElement();
  this$static.currentContainer = this$static.offsetList.root.nextContainer;
}

function $serializeAnnotations(this$static){
  var annotationsOp, b, i, i$iterator, last;
  b = new AnnotationsNormalizer_0(new UncheckedDocOpBuffer_0);
  last = null;
  for (i$iterator = this$static.annotations.annotationIntervals(0, ($checkSizeConsistency(this$static, 'size') , this$static.offsetList.root.offset), $knownKeys(this$static)).iterator_0(); i$iterator.hasNext();) {
    i = dynamicCast(i$iterator.next_0(), 219);
    i.diffFromLeft.each(new IndexedDocumentImpl$4_0(b));
    $retain_0(b, i.end - i.start);
    last = i;
  }
  ($checkSizeConsistency(this$static, 'size') , this$static.offsetList.root.offset) > 0 && last.annotations.each(new IndexedDocumentImpl$5_0(b));
  annotationsOp = dynamicCast(($flushAnnotations(b) , b.target_0.finish_0()), 173);
  return annotationsOp;
}

function $serializeDom(this$static){
  var b, depth, domOp, elementNode, node, node$iterator, textNode, returnValue_0;
  b = new DocOpBuilder_0;
  depth = 0;
  for (node$iterator = new EvaluableOffsetList$1_0(this$static.offsetList); node$iterator.nextContainer != node$iterator.this$0.root;) {
    node = (returnValue_0 = node$iterator.nextContainer.value_0 , node$iterator.nextContainer = node$iterator.nextContainer.nextContainer , returnValue_0);
    if (node != null) {
      textNode = this$static.substrate.asText_0(node);
      if (textNode != null) {
        $characters_3(b, this$static.substrate.getData(textNode));
      }
       else {
        elementNode = this$static.substrate.asElement_0(node);
        $elementStart_3(b, this$static.substrate.getTagName(elementNode), new AttributesImpl_1(this$static.substrate.getAttributes(elementNode)));
        ++depth;
      }
    }
     else {
      --depth;
      depth >= 0 && ($add_9(b.accu, ($clinit_1312() , INSTANCE_15)) , b);
    }
  }
  domOp = new BufferedDocOpImpl_0(dynamicCast($toArray_1(b.accu, ($clinit_1294() , EMPTY_ARRAY_2)), 193));
  return domOp;
}

function $size_10(this$static){
  $checkSizeConsistency(this$static, 'size');
  return this$static.offsetList.root.offset;
}

function $splitCurrent(this$static){
  var domNode, newDomNode;
  if (this$static.currentOffset != 0) {
    domNode = this$static.substrate.asText_0(this$static.currentContainer.value_0);
    newDomNode = this$static.substrate.splitText_0(domNode, this$static.currentOffset);
    this$static.currentContainer = $split_1(this$static.currentContainer, this$static.currentOffset, newDomNode);
    this$static.substrate.setIndexingContainer(newDomNode, this$static.currentContainer);
    this$static.currentOffset = 0;
  }
}

function $splitText_0(this$static, textNode, offset){
  if (this$static.inconsistent) {
    throw new IllegalStateException_1('Cannot splitText() during a modification');
  }
  if (offset == 0) {
    return textNode;
  }
   else if (offset >= this$static.substrate.getLength(textNode)) {
    return null;
  }
  this$static.currentLocation = this$static.getLocation(textNode) + offset;
  $performActionAt(this$static.offsetList, this$static.currentLocation, this$static.locationUpdater);
  $splitCurrent(this$static);
  return this$static.substrate.asText_0(this$static.currentContainer.value_0);
}

function $toDebugString(this$static){
  var $e0, e;
  try {
    return toPrettyXmlString(($clinit_1356() , $clinit_1356() , new DocOpUtil$1_0(scrub_0($asOperation(this$static)))));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 4)) {
      e = $e0;
      $clinit_1356();
      return '#<!BROKEN># (' + e + ')';
    }
     else 
      throw $e0;
  }
}

function $toString_9(this$static){
  return 'IndexedDI@' + toPowerOfTwoString(!this$static?0:this$static.$H || (this$static.$H = ++sNextHashId)) + '[' + $toDebugString(this$static) + ']';
}

function IndexedDocumentImpl_0(substrate, rawAnnotations, constraints){
  this.pointFinder = new IndexedDocumentImpl$1_0(this);
  this.locationUpdater = new IndexedDocumentImpl$2_0(this);
  this.autoDoc = new Automatons$1_0(this);
  this.invertibleCursor = new IndexedDocumentImpl$InvertibleCursor_0(this);
  this.nindoCursor = new IndexedDocumentImpl$NonInvertibleCursor_0(this);
  checkNotNull_1(constraints, 'Null schema not allowed, use DocumentSchema.NO_SCHEMA_CONSTRAINTS');
  this.schemaConstraints = constraints;
  this.annotations = rawAnnotations?rawAnnotations:new StubModifiableAnnotations_0;
  this.substrate = substrate;
  this.offsetList = new EvaluableOffsetList_0;
  $indexChildren(this, substrate.getDocumentElement());
  $resetLocation(this);
  if (this.offsetList.root.offset > 0) {
    this.annotations.begin();
    this.annotations.insert(this.offsetList.root.offset);
    this.annotations.finish();
  }
}

function IndexedDocumentImpl(){
}

_ = IndexedDocumentImpl_0.prototype = IndexedDocumentImpl.prototype = new Object_0;
_.annotationIntervals = function annotationIntervals_1(start, end, keys){
  return $annotationIntervals_0(this, start, end, keys);
}
;
_.asElement_0 = function asElement_2(node){
  return this.substrate.asElement_0(node);
}
;
_.asText_0 = function asText_2(node){
  return this.substrate.asText_0(node);
}
;
_.firstAnnotationChange = function firstAnnotationChange_1(start, end, key, fromValue){
  return $firstAnnotationChange_1(this, start, end, key, dynamicCast(fromValue, 1));
}
;
_.forEachAnnotationAt = function forEachAnnotationAt_1(location_0, callback){
  this.annotations.forEachAnnotationAt(location_0, new IndexedDocumentImpl$7_0(callback));
}
;
_.getAnnotation = function getAnnotation_1(start, key){
  return $getAnnotation_2(this, start, key);
}
;
_.getAttribute_0 = function getAttribute_0(element, name_0){
  return this.substrate.getAttribute_0(element, name_0);
}
;
_.getAttributes = function getAttributes_0(element){
  return this.substrate.getAttributes(element);
}
;
_.getClass$ = function getClass_462(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl_2_classLit;
}
;
_.getData = function getData_0(textNode){
  return this.substrate.getData(textNode);
}
;
_.getDocumentElement = function getDocumentElement_0(){
  return this.substrate.getDocumentElement();
}
;
_.getFirstChild_0 = function getFirstChild_2(node){
  return this.substrate.getFirstChild_0(node);
}
;
_.getLastChild_0 = function getLastChild_2(node){
  return this.substrate.getLastChild_0(node);
}
;
_.getLength = function getLength_0(textNode){
  return this.substrate.getLength(textNode);
}
;
_.getLocation = function getLocation(node){
  return $getLocation_1(this, node);
}
;
_.getNextSibling = function getNextSibling_0(node){
  return this.substrate.getNextSibling(node);
}
;
_.getNodeType_0 = function getNodeType_1(node){
  return this.substrate.getNodeType_0(node);
}
;
_.getParentElement = function getParentElement_0(node){
  return this.substrate.getParentElement(node);
}
;
_.getPreviousSibling = function getPreviousSibling_0(node){
  return this.substrate.getPreviousSibling(node);
}
;
_.getTagName = function getTagName_0(element){
  return this.substrate.getTagName(element);
}
;
_.isSameNode = function isSameNode_0(node, other){
  return this.substrate.isSameNode(node, other);
}
;
_.lastAnnotationChange = function lastAnnotationChange_1(start, end, key, fromValue){
  return $lastAnnotationChange_2(this, start, end, key, dynamicCast(fromValue, 1));
}
;
_.rangedAnnotations = function rangedAnnotations_2(start, end, keys){
  return $rangedAnnotations_1(this, start, end, keys);
}
;
_.size_0 = function size_28(){
  return $checkSizeConsistency(this, 'size') , this.offsetList.root.offset;
}
;
_.splitText_0 = function splitText(textNode, offset){
  return $splitText_0(this, textNode, offset);
}
;
_.toString$ = function toString_37(){
  return 'IndexedDI@' + toPowerOfTwoString(this.$H || (this.$H = ++sNextHashId)) + '[' + $toDebugString(this) + ']';
}
;
_.castableTypeMap$ = {109:1};
_.annotations = null;
_.currentContainer = null;
_.currentLocation = 0;
_.currentOffset = 0;
_.currentParent = null;
_.deletionDepth = 0;
_.inconsistent = false;
_.offsetList = null;
_.schemaConstraints = null;
_.substrate = null;
function $getLocation_3(this$static, node){
  node = dynamicCast($getNextVisibleNodeDepthFirst(this$static.this$0.persistentContentView, node, null), 163);
  return !node?($checkSizeConsistency(this$static, 'size') , this$static.offsetList.root.offset):$getLocation_1(this$static, node);
}

function $getLocation_4(this$static, point){
  return $getLocation_2(this$static.indexedDocLocationMapper.this$1, getFilteredPoint(this$static.this$0.persistentContentView, point));
}

function $splitText_1(this$static, textNode, offset){
  $saveSelection_0(this$static.this$0.selectionMaintainer);
  try {
    return dynamicCast($splitText_0(this$static, textNode, offset), 190);
  }
   finally {
    $restoreSelection(this$static.this$0.selectionMaintainer, null);
  }
}

function $splitText_2(this$static, textNode, offset){
  return $splitText_1(this$static, dynamicCast(textNode, 190), offset);
}

function ContentDocument$ContentIndexedDoc_0(this$0, doc, annotations, schema){
  this.this$0 = this$0;
  IndexedDocumentImpl_0.call(this, doc, annotations, schema);
  this.indexedDocLocationMapper = new ContentDocument$ContentIndexedDoc$1_0(this);
}

function ContentDocument$ContentIndexedDoc(){
}

_ = ContentDocument$ContentIndexedDoc_0.prototype = ContentDocument$ContentIndexedDoc.prototype = new IndexedDocumentImpl;
_.getClass$ = function getClass_463(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$ContentIndexedDoc_2_classLit;
}
;
_.getLocation = function getLocation_0(node){
  return $getLocation_3(this, dynamicCast(node, 163));
}
;
_.splitText_0 = function splitText_0(textNode, offset){
  return $splitText_1(this, dynamicCast(textNode, 190), offset);
}
;
_.castableTypeMap$ = {109:1};
_.this$0 = null;
function ContentDocument$ContentIndexedDoc$1_0(this$1){
  this.this$1 = this$1;
}

function ContentDocument$ContentIndexedDoc$1(){
}

_ = ContentDocument$ContentIndexedDoc$1_0.prototype = ContentDocument$ContentIndexedDoc$1.prototype = new Object_0;
_.getClass$ = function getClass_464(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$ContentIndexedDoc$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
function $asText_1(this$static, node){
  return this$static.inner_0.asText_0(node);
}

function $isSameNode_0(this$static, node, other){
  return this$static.inner_0.isSameNode(node, other);
}

function IdentityView(){
}

_ = IdentityView.prototype = new Object_0;
_.asElement_0 = function asElement_3(node){
  return this.inner_0.asElement_0(node);
}
;
_.asText_0 = function asText_3(node){
  return this.inner_0.asText_0(node);
}
;
_.getAttribute_0 = function getAttribute_1(element, name_0){
  return this.inner_0.getAttribute_0(element, name_0);
}
;
_.getAttributes = function getAttributes_1(element){
  return this.inner_0.getAttributes(element);
}
;
_.getClass$ = function getClass_465(){
  return Lorg_waveprotocol_wave_model_document_util_IdentityView_2_classLit;
}
;
_.getData = function getData_1(textNode){
  return this.inner_0.getData(textNode);
}
;
_.getDocumentElement = function getDocumentElement_1(){
  return this.inner_0.getDocumentElement();
}
;
_.getFirstChild_0 = function getFirstChild_3(node){
  return this.inner_0.getFirstChild_0(node);
}
;
_.getLastChild_0 = function getLastChild_3(node){
  return this.inner_0.getLastChild_0(node);
}
;
_.getLength = function getLength_1(textNode){
  return this.inner_0.getLength(textNode);
}
;
_.getNextSibling = function getNextSibling_1(node){
  return this.inner_0.getNextSibling(node);
}
;
_.getNodeType_0 = function getNodeType_2(node){
  return this.inner_0.getNodeType_0(node);
}
;
_.getParentElement = function getParentElement_1(node){
  return this.inner_0.getParentElement(node);
}
;
_.getPreviousSibling = function getPreviousSibling_1(node){
  return this.inner_0.getPreviousSibling(node);
}
;
_.getTagName = function getTagName_1(element){
  return this.inner_0.getTagName(element);
}
;
_.isSameNode = function isSameNode_1(node, other){
  return this.inner_0.isSameNode(node, other);
}
;
_.castableTypeMap$ = {109:1, 122:1, 125:1};
_.inner_0 = null;
function $getFirstChild_4(this$static, node){
  var find_0;
  find_0 = this$static.inner_0.getFirstChild_0(node);
  return $getNextVisibleNodeDepthFirst(this$static, find_0, node);
}

function $getLastChild_3(this$static, node){
  var find_0;
  find_0 = this$static.inner_0.getLastChild_0(node);
  return $getPreviousVisibleNodeDepthFirst(this$static, find_0, node, true);
}

function $getNextSibling_3(this$static, node){
  var find_0, parent_0;
  parent_0 = $getParentElement_3(this$static, node);
  find_0 = this$static.getNextOrPrevNodeDepthFirst(this$static.inner_0, node, parent_0, false, true);
  return $getNextVisibleNodeDepthFirst(this$static, find_0, parent_0);
}

function $getNextVisibleNodeDepthFirst(this$static, find_0, stopAt){
  while (find_0 != null) {
    switch (this$static.getSkipLevel(find_0).ordinal) {
      case 0:
        return find_0;
      case 1:
        find_0 = this$static.getNextOrPrevNodeDepthFirst(this$static.inner_0, find_0, stopAt, true, true);
        break;
      case 2:
        find_0 = this$static.getNextOrPrevNodeDepthFirst(this$static.inner_0, find_0, stopAt, false, true);
        break;
      case 3:
        return null;
      default:throw new RuntimeException_1('Unimplemented');
    }
  }
  return null;
}

function $getParentElement_3(this$static, node){
  var element;
  element = this$static.inner_0.getParentElement(node);
  while (element != null) {
    switch (this$static.getSkipLevel(element).ordinal) {
      case 0:
        return element;
      case 1:
        element = this$static.inner_0.getParentElement(element);
        break;
      case 2:
        element = this$static.inner_0.getParentElement(element);
        break;
      case 3:
        return null;
      default:throw new RuntimeException_1('Unimplemented');
    }
  }
  return null;
}

function $getPreviousSibling_3(this$static, node){
  var find_0, parent_0;
  parent_0 = $getParentElement_3(this$static, node);
  find_0 = this$static.getNextOrPrevNodeDepthFirst(this$static.inner_0, node, parent_0, false, false);
  return $getPreviousVisibleNodeDepthFirst(this$static, find_0, parent_0, true);
}

function $getPreviousVisibleNodeDepthFirst(this$static, find_0, stopAt, enterFirst){
  var enter;
  enter = enterFirst;
  while (find_0 != null) {
    switch (this$static.getSkipLevel(find_0).ordinal) {
      case 0:
        return find_0;
      case 1:
        find_0 = this$static.getNextOrPrevNodeDepthFirst(this$static.inner_0, find_0, stopAt, enter, false);
        break;
      case 2:
        find_0 = this$static.getNextOrPrevNodeDepthFirst(this$static.inner_0, find_0, stopAt, false, false);
        break;
      case 3:
        return null;
      default:throw new RuntimeException_1('Unimplemented');
    }
    enter = true;
  }
  return null;
}

function $getVisibleNode(this$static, node){
  if (node == null) {
    return null;
  }
  switch (this$static.getSkipLevel(node).ordinal) {
    case 0:
      return node;
    case 1:
    case 2:
      return $getParentElement_3(this$static, node);
    case 3:
      return null;
    default:throw new RuntimeException_1('Unimplemented');
  }
}

function FilteredView_0(innerView){
  checkNotNull_1(innerView, 'IdentityView (or subclass): Inner document may not be null!');
  this.inner_0 = innerView;
}

function FilteredView(){
}

_ = FilteredView.prototype = new IdentityView;
_.getClass$ = function getClass_466(){
  return Lorg_waveprotocol_wave_model_document_util_FilteredView_2_classLit;
}
;
_.getFirstChild_0 = function getFirstChild_4(node){
  var find_0;
  return find_0 = this.inner_0.getFirstChild_0(node) , $getNextVisibleNodeDepthFirst(this, find_0, node);
}
;
_.getLastChild_0 = function getLastChild_4(node){
  var find_0;
  return find_0 = this.inner_0.getLastChild_0(node) , $getPreviousVisibleNodeDepthFirst(this, find_0, node, true);
}
;
_.getNextOrPrevNodeDepthFirst = function getNextOrPrevNodeDepthFirst(doc, start, stopAt, enter, rightwards){
  return getNextOrPrevNodeDepthFirst_1(doc, start, stopAt, enter, rightwards);
}
;
_.getNextSibling = function getNextSibling_2(node){
  return $getNextSibling_3(this, node);
}
;
_.getParentElement = function getParentElement_2(node){
  return $getParentElement_3(this, node);
}
;
_.getPreviousSibling = function getPreviousSibling_2(node){
  return $getPreviousSibling_3(this, node);
}
;
_.onBeforeFilter = function onBeforeFilter(at){
}
;
_.castableTypeMap$ = {109:1, 121:1, 122:1, 125:1};
function $getNextOrPrevNodeDepthFirst_0(this$static, doc, start, stopAt, enter, rightwards){
  var $e0, e, next, stopAtWrapper, tries;
  if (start.nodeType != 3 && !!start[$clinit_697() , COMPLEX_IMPLEMENTATION_MARKER]) {
    e = start;
    while ($clinit_962() , !(!!e && (e[BACKREF_NAME] || null) != null)) {
      e = $getParentElement(e);
    }
    stopAtWrapper = null;
    for (tries = 1; tries <= 3; ++tries) {
      try {
        stopAtWrapper = $findNodeWrapper(this$static.this$0.nodeManager, stopAt);
        break;
      }
       catch ($e0) {
        $e0 = caught_0($e0);
        if (instanceOf($e0, 191)) {
          stopAt = $getParentElement(stopAt);
        }
         else 
          throw $e0;
      }
    }
    next = dynamicCast(getNextOrPrevNodeDepthFirst_1(this$static.this$0.renderedContentView, !e?null:dynamicCast(e[BACKREF_NAME] || null, 152), stopAtWrapper, enter, rightwards), 163);
    return next?next.getImplNodelet():null;
  }
   else {
    return dynamicCastJso(getNextOrPrevNodeDepthFirst_1(doc, start, stopAt, enter, rightwards));
  }
}

function $getSkipLevel(this$static, node){
  var element, level;
  if (node.nodeType == 3 || ($clinit_962() , !!node && (node[BACKREF_NAME] || null) != null)) {
    return $clinit_1371() , NONE_4;
  }
   else {
    element = node;
    level = ($clinit_962() , dynamicCast(element[TRANSPARENCY] || null, 120));
    if (!level) {
      if (!$isOrHasChild(dynamicCastJso(this$static.inner_0.getDocumentElement()), element)) {
        return $clinit_1371() , INVALID;
      }
      element[TRANSPARENCY] = ($clinit_1371() , SHALLOW);
      element[TRANSPARENT_BACKREF] = this$static;
      $add_9(this$static.invadingElements, element);
    }
    return !level?($clinit_1371() , SHALLOW):level;
  }
}

function ContentDocument$FilteredHtml_0(this$0, rawView){
  this.this$0 = this$0;
  checkNotNull_1(rawView, 'IdentityView (or subclass): Inner document may not be null!');
  this.inner_0 = rawView;
  this.invadingElements = new ArrayList_0;
}

function ContentDocument$FilteredHtml(){
}

_ = ContentDocument$FilteredHtml_0.prototype = ContentDocument$FilteredHtml.prototype = new FilteredView;
_.getClass$ = function getClass_467(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$FilteredHtml_2_classLit;
}
;
_.getNextOrPrevNodeDepthFirst = function getNextOrPrevNodeDepthFirst_0(doc, start, stopAt, enter, rightwards){
  return $getNextOrPrevNodeDepthFirst_0(this, doc, dynamicCastJso(start), dynamicCastJso(stopAt), enter, rightwards);
}
;
_.getSkipLevel = function getSkipLevel(node){
  return $getSkipLevel(this, dynamicCastJso(node));
}
;
_.castableTypeMap$ = {109:1, 121:1, 122:1, 125:1};
_.this$0 = null;
function $transparentCreate(this$static, tagName, attributes, parent_0, nodeAfter){
  $saveSelection_0(this$static.this$0.selectionMaintainer);
  try {
    return $transparentCreate_1(this$static.this$0.persistentContentView, tagName, attributes, parent_0, nodeAfter);
  }
   finally {
    $restoreSelection(this$static.this$0.selectionMaintainer, null);
  }
}

function $transparentCreate_0(this$static, tagName, attributes, parent_0, nodeAfter){
  return $transparentCreate(this$static, tagName, attributes, dynamicCast(parent_0, 152), dynamicCast(nodeAfter, 163));
}

function $transparentDeepRemove(this$static, node){
  $saveSelection_0(this$static.this$0.selectionMaintainer);
  try {
    $transparentDeepRemove_0(this$static.this$0.persistentContentView, node);
  }
   finally {
    $restoreSelection(this$static.this$0.selectionMaintainer, null);
  }
}

function $transparentMove(this$static, newParent, fromIncl, toExcl, refChild){
  $saveSelection_0(this$static.this$0.selectionMaintainer);
  try {
    $transparentMove_1(this$static.this$0.persistentContentView, newParent, fromIncl, toExcl, refChild);
  }
   finally {
    $restoreSelection(this$static.this$0.selectionMaintainer, null);
  }
}

function $transparentMove_0(this$static, newParent, fromIncl, toExcl, refChild){
  $transparentMove(this$static, newParent, dynamicCast(fromIncl, 163), dynamicCast(toExcl, 163), refChild);
}

function $transparentSlice(this$static, splitAt){
  return dynamicCast($transparentSlice_0(this$static.this$0.persistentContentView, splitAt), 163);
}

function $transparentUnwrap(this$static, element){
  $saveSelection_0(this$static.this$0.selectionMaintainer);
  try {
    $transparentUnwrap_0(this$static.this$0.persistentContentView, element);
  }
   finally {
    $restoreSelection(this$static.this$0.selectionMaintainer, null);
  }
}

function ContentDocument$FullContent_0(this$0, inner){
  this.this$0 = this$0;
  checkNotNull_1(inner, 'IdentityView (or subclass): Inner document may not be null!');
  this.inner_0 = inner;
}

function ContentDocument$FullContent(){
}

_ = ContentDocument$FullContent_0.prototype = ContentDocument$FullContent.prototype = new IdentityView;
_.getClass$ = function getClass_468(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$FullContent_2_classLit;
}
;
_.toString$ = function toString_38(){
  return 'FullContentView: ' + $toString_8(dynamicCast(this.inner_0.getDocumentElement(), 152));
}
;
_.castableTypeMap$ = {109:1, 122:1, 125:1};
_.this$0 = null;
function $clinit_741(){
  $clinit_741 = nullMethod;
  SHELVED = new ContentDocument$Level_0('SHELVED', 0);
  RENDERED = new ContentDocument$Level_0('RENDERED', 1);
  INTERACTIVE = new ContentDocument$Level_0('INTERACTIVE', 2);
  EDITING = new ContentDocument$Level_0('EDITING', 3);
  $VALUES_21 = initValues(_3Lorg_waveprotocol_wave_client_editor_content_ContentDocument$Level_2_classLit, {58:1, 138:1}, 82, [SHELVED, RENDERED, INTERACTIVE, EDITING]);
}

function ContentDocument$Level_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_22(){
  $clinit_741();
  return $VALUES_21;
}

function ContentDocument$Level(){
}

_ = ContentDocument$Level_0.prototype = ContentDocument$Level.prototype = new Enum;
--></script>
<script><!--
_.getClass$ = function getClass_469(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$Level_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 82:1};
var $VALUES_21, EDITING, INTERACTIVE, RENDERED, SHELVED;
function $annotationIntervals_1(this$static, start, end, keys){
  return $annotationIntervals(this$static.fullAnnotationSet, start, end, keys);
}

function $checkLocalKey(key){
  if (key.charCodeAt(0) != 64) {
    throw new IllegalArgumentException_1('Not a local annotation key: ' + key);
  }
}

function $resetAnnotation(this$static, start, end, key, value){
  checkPositionIndexesInRange(start, end, this$static.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1);
  $checkLocalKey(key);
  if (end - start > 0) {
    $begin(this$static.fullAnnotationSet);
    $startAnnotation(this$static.fullAnnotationSet, key, null);
    start > 0 && $skip(this$static.fullAnnotationSet, start);
    $startAnnotation(this$static.fullAnnotationSet, key, value);
    $skip(this$static.fullAnnotationSet, end - start);
    $startAnnotation(this$static.fullAnnotationSet, key, null);
    this$static.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1 - end > 0 && $skip(this$static.fullAnnotationSet, this$static.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1 - end);
    $endAnnotationUnchecked(this$static.fullAnnotationSet, key);
    $finish(this$static.fullAnnotationSet);
  }
}

function $setAnnotation_0(this$static, start, end, key, value){
  checkPositionIndexesInRange(start, end, this$static.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1);
  $checkLocalKey(key);
  if (end - start > 0) {
    $begin(this$static.fullAnnotationSet);
    start > 0 && $skip(this$static.fullAnnotationSet, start);
    $startAnnotation(this$static.fullAnnotationSet, key, value);
    end - start > 0 && $skip(this$static.fullAnnotationSet, end - start);
    $endAnnotationUnchecked(this$static.fullAnnotationSet, key);
    $finish(this$static.fullAnnotationSet);
  }
}

function LocalAnnotationSetImpl(){
}

_ = LocalAnnotationSetImpl.prototype = new Object_0;
_.annotationIntervals = function annotationIntervals_2(start, end, keys){
  return $annotationIntervals(this.fullAnnotationSet, start, end, keys);
}
;
_.firstAnnotationChange = function firstAnnotationChange_2(start, end, key, fromValue){
  return $firstAnnotationChange(this.fullAnnotationSet, start, end, key, fromValue);
}
;
_.forEachAnnotationAt = function forEachAnnotationAt_2(location_0, callback){
  throw new RuntimeException_1('not implemented');
}
;
_.getAnnotation = function getAnnotation_2(start, key){
  return $getAnnotation(this.fullAnnotationSet, start, key);
}
;
_.getClass$ = function getClass_470(){
  return Lorg_waveprotocol_wave_model_document_util_LocalAnnotationSetImpl_2_classLit;
}
;
_.lastAnnotationChange = function lastAnnotationChange_2(start, end, key, fromValue){
  return $lastAnnotationChange(this.fullAnnotationSet, start, end, key, fromValue);
}
;
_.rangedAnnotations = function rangedAnnotations_3(start, end, keys){
  return $rangedAnnotations(this.fullAnnotationSet, start, end, keys);
}
;
_.size_0 = function size_29(){
  return this.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1;
}
;
_.castableTypeMap$ = {};
_.fullAnnotationSet = null;
function $consume_9(this$static, op){
  var $e0, e;
  try {
    $consume_6(this$static.this$0, op);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 167)) {
      e = $e0;
      throw e.opException;
    }
     else 
      throw $e0;
  }
}

function $endLocalAnnotation(this$static, key){
  $checkLocalKey(key);
  $endAnnotationUnchecked(this$static.fullAnnotationSet, key);
}

function $startLocalAnnotation(this$static, key, value){
  $checkLocalKey(key);
  $startAnnotation(this$static.fullAnnotationSet, key, value);
}

function ContentDocument$LocalAnnotationSet_0(this$0, fullAnnotationSet){
  this.this$0 = this$0;
  this.fullAnnotationSet = fullAnnotationSet;
}

function ContentDocument$LocalAnnotationSet(){
}

_ = ContentDocument$LocalAnnotationSet_0.prototype = ContentDocument$LocalAnnotationSet.prototype = new LocalAnnotationSetImpl;
_.getClass$ = function getClass_471(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$LocalAnnotationSet_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $clinit_745(){
  $clinit_745 = nullMethod;
  DEEP_TRANSPARENT_MARKER = new Object_1;
  DEEP_TRANSPARENT = new Property$ImmutableProperty_0('p_deep_transparent');
  HARD = new Property$ImmutableProperty_0('p_hard');
}

function $createElement_4(this$static, tagName, attributes, parent_0, nodeAfter){
  nodeAfter = $transparentSlice_0(this$static, nodeAfter);
  nodeAfter != null && (parent_0 = dynamicCast(nodeAfter, 163).parent_0);
  return $createElement_7(this$static.fullDoc, tagName, attributes, parent_0, nodeAfter);
}

function $createTextNode_0(this$static, data, parent_0, nodeAfter){
  nodeAfter = $transparentSlice_0(this$static, nodeAfter);
  nodeAfter != null && (parent_0 = dynamicCast(nodeAfter, 163).parent_0);
  return $createTextNode_4(this$static.fullDoc, data, parent_0, nodeAfter);
}

function $getSkipLevel_0(this$static, node){
  return !!dynamicCast(node, 163).indexingContainer || (node == null?null:node) === maskUndefined(this$static.fullDoc.getDocumentElement_0())?($clinit_1371() , NONE_4):$isDeepTransparent(this$static, node)?($clinit_1371() , DEEP):($clinit_1371() , SHALLOW);
}

function $isDeepTransparent(this$static, node){
  var element;
  element = this$static.inner_0.asElement_0(node);
  return element == null || $getProperty_0(DEEP_TRANSPARENT, dynamicCast(element, 152)) != null;
}

function $isHard(this$static, node){
  var element;
  element = this$static.inner_0.asElement_0(node);
  return element == null || !!dynamicCast(element, 163).indexingContainer || $getProperty_0(HARD, dynamicCast(element, 152)) != null;
}

function $transparentCreate_1(this$static, tagName, attributes, parent_0, nodeAfter){
  var el;
  checkRelationship(this$static.fullDoc, parent_0, nodeAfter, 'transparentCreate');
  el = $createElement_7(this$static.fullDoc, tagName, attributes, parent_0, nodeAfter);
  return el;
}

function $transparentDeepRemove_0(this$static, node){
  if (!!dynamicCast(node, 163).indexingContainer || $getFirstChild_4(this$static.filteredDoc, node) != null) {
    throw new IllegalArgumentException_1('transparentDeepRemove: Cannot directly manipulate persistent elements');
  }
  $removeChild_3(this$static.fullDoc, dynamicCast(node, 163).parent_0, node);
}

function $transparentMove_1(this$static, newParent, fromIncl, toExcl, refChild){
  var node;
  if (!!refChild && dynamicCast(refChild, 163).parent_0 != newParent) {
    throw new IllegalArgumentException_1('refChild must be a child of newParent');
  }
  if (toExcl) {
    for (node = fromIncl; node != toExcl; node = dynamicCast(node, 163).next) {
      if (!node) {
        throw new IllegalArgumentException_1('toExcl must be null or be an indirect, following sibling of fromIncl');
      }
    }
  }
  $insertBefore_5(this$static.fullDoc, newParent, fromIncl, toExcl, refChild);
}

function $transparentSetAttribute_0(element, name_0, value){
  if (dynamicCast(element, 163).indexingContainer) {
    throw new IllegalArgumentException_1('transparentSetAttribute: node must not be persistent');
  }
  value != null?($setAttribute_2(dynamicCast(element, 152), name_0, value) , undefined):($removeAttribute_1(dynamicCast(element, 152), name_0) , undefined);
}

function $transparentSlice_0(this$static, splitAt){
  var newParent, newSibling, nodeAfter, parent_0;
  if (splitAt == null) {
    return null;
  }
  parent_0 = dynamicCast(splitAt, 163).parent_0;
  if (!parent_0) {
    throw new IllegalArgumentException_1('transparentSlice: Cannot split before the root element');
  }
  while (!$isHard(this$static, parent_0)) {
    newParent = dynamicCast(parent_0, 163).parent_0;
    if (!newParent) {
      throw new RuntimeException_1('The root node is not persistent!?!?');
    }
    if ((splitAt == null?null:splitAt) === maskUndefined(dynamicCast(parent_0, 163).getFirstChild())) {
      splitAt = parent_0;
    }
     else {
      nodeAfter = dynamicCast(parent_0, 163).next;
      newSibling = $createElement_7(this$static.fullDoc, dynamicCast(parent_0, 152).tagName_0, ($clinit_1445() , copyToJavaMap(dynamicCast(parent_0, 152).attributes, new HashMap_0)), newParent, nodeAfter);
      $insertBefore_4(this$static.fullDoc, newSibling, dynamicCast(splitAt, 163), null, null, null);
      splitAt = newSibling;
    }
    parent_0 = newParent;
  }
  return splitAt;
}

function $transparentUnwrap_0(this$static, element){
  var parent_0;
  if (dynamicCast(element, 163).indexingContainer) {
    throw new IllegalArgumentException_1('transparentUnwrap: Cannot directly manipulate persistent elements');
  }
  parent_0 = dynamicCast(element, 163).parent_0;
  $insertBefore_5(this$static.fullDoc, parent_0, dynamicCast(element, 163).getFirstChild(), null, element);
  $removeChild_3(this$static.fullDoc, parent_0, element);
}

function PersistentContent(){
}

_ = PersistentContent.prototype = new FilteredView;
_.appendData = function appendData(textNode, arg){
  $appendData_0(this.fullDoc, textNode, arg);
}
;
_.createElement_0 = function createElement(tagName, attributes, parent_0, nodeAfter){
  return $createElement_4(this, tagName, attributes, parent_0, nodeAfter);
}
;
_.createTextNode_0 = function createTextNode(data, parent_0, nodeAfter){
  return $createTextNode_0(this, data, parent_0, nodeAfter);
}
;
_.deleteData_0 = function deleteData(textNode, offset, count){
  $deleteData_1(this.fullDoc, textNode, offset, count);
}
;
_.getClass$ = function getClass_472(){
  return Lorg_waveprotocol_wave_model_document_util_PersistentContent_2_classLit;
}
;
_.getIndexingContainer = function getIndexingContainer(domNode){
  return dynamicCast(domNode, 163).indexingContainer;
}
;
_.getSkipLevel = function getSkipLevel_0(node){
  return !!dynamicCast(node, 163).indexingContainer || (node == null?null:node) === maskUndefined(this.fullDoc.getDocumentElement_0())?($clinit_1371() , NONE_4):$isDeepTransparent(this, node)?($clinit_1371() , DEEP):($clinit_1371() , SHALLOW);
}
;
_.insertData_0 = function insertData(textNode, offset, arg){
  $insertData_2(this.fullDoc, textNode, offset, arg);
}
;
_.onBeforeFilter = function onBeforeFilter_0(at){
}
;
_.removeAttribute_0 = function removeAttribute(element, name_0){
  $removeAttribute_1(dynamicCast(element, 152), name_0);
}
;
_.removeChild_0 = function removeChild(parent_0, oldChild){
  $removeChild_3(this.fullDoc, dynamicCast(oldChild, 163).parent_0, oldChild);
}
;
_.setAttribute_0 = function setAttribute(element, name_0, value){
  $setAttribute_2(dynamicCast(element, 152), name_0, value);
}
;
_.setIndexingContainer = function setIndexingContainer(domNode, indexingNode){
  dynamicCast(domNode, 163).indexingContainer = indexingNode;
}
;
_.splitText_0 = function splitText_1(textNode, offset){
  return $splitText_4(this.fullDoc, textNode, offset);
}
;
_.toString$ = function toString_39(){
  return 'PersistentContent ' + createChildren(this, this.inner_0.getDocumentElement());
}
;
_.castableTypeMap$ = {109:1, 121:1, 122:1, 125:1};
_.fullDoc = null;
_.hardDoc = null;
var DEEP_TRANSPARENT, DEEP_TRANSPARENT_MARKER, HARD;
function RepaintingPersistentContent_0(fullDoc){
  checkNotNull_1(fullDoc, 'IdentityView (or subclass): Inner document may not be null!');
  this.inner_0 = fullDoc;
  this.filteredDoc = this;
  this.fullDoc = fullDoc;
  $clinit_745();
  $setProperty_1(HARD, fullDoc.getDocumentElement_0(), HARD);
  this.hardDoc = new PersistentContent$HardContent_0(this);
}

function RepaintingPersistentContent(){
}

_ = RepaintingPersistentContent.prototype = new PersistentContent;
_.createTextNode_0 = function createTextNode_0(data, parent_0, nodeAfter){
  var textNode;
  return textNode = $createTextNode_0(this, data, parent_0, nodeAfter) , $add_9(this.this$0.nodesToRepaint, textNode) , textNode;
}
;
_.getClass$ = function getClass_473(){
  return Lorg_waveprotocol_wave_model_document_util_RepaintingPersistentContent_2_classLit;
}
;
_.insertData_0 = function insertData_0(textNode, offset, arg){
  $insertData_2(this.fullDoc, textNode, offset, arg);
  offset == 0 && ($add_9(this.this$0.nodesToRepaint, dynamicCast(textNode, 163)) , undefined);
}
;
_.removeChild_0 = function removeChild_0(parent_0, oldChild){
  var fullViewParent;
  fullViewParent = dynamicCast(oldChild, 163).parent_0;
  $removeChild_3(this.fullDoc, dynamicCast(oldChild, 163).parent_0, oldChild);
  !dynamicCast(fullViewParent, 163).getFirstChild() && $add_9(this.this$0.nodesToRepaint, fullViewParent);
}
;
_.castableTypeMap$ = {109:1, 121:1, 122:1, 125:1};
function PersistentContentView(){
}

_ = PersistentContentView.prototype = new RepaintingPersistentContent;
_.getClass$ = function getClass_474(){
  return Lorg_waveprotocol_wave_client_editor_content_PersistentContentView_2_classLit;
}
;
_.castableTypeMap$ = {109:1, 121:1, 122:1, 125:1};
_.inner = null;
function $createElement_5(this$static, tagName, attributes, parent_0, nodeAfter){
  var node;
  if (this$static.persistenceManager.nodeCreationDelegate) {
    node = $createElement_8(this$static.persistenceManager, tagName, attributes);
    $add_9(this$static.this$0.nodesToRepaint, node);
    return node;
  }
  return $createElement_4(this$static, tagName, attributes, parent_0, nodeAfter);
}

function $createTextNode_2(this$static, data, parent_0, nodeAfter){
  var node, textNode;
  if (this$static.persistenceManager.nodeCreationDelegate) {
    node = $createTextNode_5(this$static.persistenceManager, data);
    $add_9(this$static.this$0.nodesToRepaint, node);
    return node;
  }
  return textNode = $createTextNode_0(this$static, data, parent_0, nodeAfter) , $add_9(this$static.this$0.nodesToRepaint, textNode) , textNode;
}

function $onBeforeFilter(this$static, at){
  if (this$static.this$0.isConsistent && !this$static.isInsideFilter) {
    this$static.isInsideFilter = true;
    $updateLazyNodes(this$static.persistenceManager, dynamicCast(at.container, 163));
    this$static.isInsideFilter = false;
  }
}

function $setPersistenceManager(this$static, persistenceManager){
  checkArgument_0(!!persistenceManager, "Can't use a null persistence manager.");
  checkState(!this$static.persistenceManager, "Can't set persistence manager twice.");
  this$static.persistenceManager = persistenceManager;
}

function ContentDocument$PersistentContentDoc_0(this$0, fullRawSubstrate){
  $clinit_745();
  this.this$0 = this$0;
  RepaintingPersistentContent_0.call(this, fullRawSubstrate, $clinit_697());
  this.inner = fullRawSubstrate;
}

function ContentDocument$PersistentContentDoc(){
}

_ = ContentDocument$PersistentContentDoc_0.prototype = ContentDocument$PersistentContentDoc.prototype = new PersistentContentView;
_.createElement_0 = function createElement_0(tagName, attributes, parent_0, nodeAfter){
  return $createElement_5(this, tagName, attributes, dynamicCast(parent_0, 152), dynamicCast(nodeAfter, 163));
}
;
_.createTextNode_0 = function createTextNode_1(data, parent_0, nodeAfter){
  return $createTextNode_2(this, data, dynamicCast(parent_0, 152), dynamicCast(nodeAfter, 163));
}
;
_.getClass$ = function getClass_475(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$PersistentContentDoc_2_classLit;
}
;
_.onBeforeFilter = function onBeforeFilter_1(at){
  $onBeforeFilter(this, at);
}
;
_.castableTypeMap$ = {109:1, 121:1, 122:1, 125:1};
_.isInsideFilter = false;
_.persistenceManager = null;
_.this$0 = null;
function ContentDocument$RenderedContent_0(rawView){
  checkNotNull_1(rawView, 'IdentityView (or subclass): Inner document may not be null!');
  this.inner_0 = rawView;
}

function ContentDocument$RenderedContent(){
}

_ = ContentDocument$RenderedContent_0.prototype = ContentDocument$RenderedContent.prototype = new FilteredView;
_.getClass$ = function getClass_476(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$RenderedContent_2_classLit;
}
;
_.getSkipLevel = function getSkipLevel_1(node){
  return $isRendered(dynamicCast(node, 163))?($clinit_1371() , NONE_4):($clinit_1371() , SHALLOW);
}
;
_.castableTypeMap$ = {109:1, 121:1, 122:1, 125:1};
function ContentDocument$SchemaViolatingLocalOperationException_0(violation){
  ContentDocument$LocalOperationException_0.call(this, violation);
  checkArgument_0((violation.operationIllFormed.size == 0?violation.operationInvalid.size == 0?violation.schemaViolations.size == 0?($clinit_1267() , VALID):($clinit_1267() , INVALID_SCHEMA):($clinit_1267() , INVALID_DOCUMENT):($clinit_1267() , ILL_FORMED)) == ($clinit_1267() , INVALID_SCHEMA), 'Not a schema violation');
}

function ContentDocument$SchemaViolatingLocalOperationException(){
}

_ = ContentDocument$SchemaViolatingLocalOperationException_0.prototype = ContentDocument$SchemaViolatingLocalOperationException.prototype = new ContentDocument$LocalOperationException;
_.getClass$ = function getClass_477(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$SchemaViolatingLocalOperationException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1, 168:1};
function $consumeAndReturnInvertible_0(this$static, op){
  var docOp;
  docOp = $consumeLocal(this$static.this$0, op, this$static.saveSelection);
  this$static.this$0.outgoingOperationSink.consume(docOp);
  return docOp;
}

function ContentDocument$SourceNindoSink_0(this$0, saveSelection){
  this.this$0 = this$0;
  this.saveSelection = saveSelection;
}

function ContentDocument$SourceNindoSink(){
}

_ = ContentDocument$SourceNindoSink_0.prototype = ContentDocument$SourceNindoSink.prototype = new Object_0;
_.getClass$ = function getClass_478(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$SourceNindoSink_2_classLit;
}
;
_.castableTypeMap$ = {};
_.saveSelection = false;
_.this$0 = null;
function $getProperty_0(property, element){
  return element.transientData.backend.get(valueOf_0(property.id_0));
}

function $setProperty_0(property, element, value){
  $put_3(element.transientData, property.id_0, value);
}

function $setProperty_1(property, element, value){
  $setProperty_0(property, dynamicCast(element, 152), value);
}

function ContentNode$1_0(this$0){
  this.this$0 = this$0;
}

function ContentNode$1(){
}

_ = ContentNode$1_0.prototype = ContentNode$1.prototype = new Object_0;
_.execute = function execute_17(){
  $revert(this.this$0.context.this$0.renderingConcerns.this$0.repairer, new Point$El_0(this.this$0.parent_0, this.this$0), null);
}
;
_.getClass$ = function getClass_479(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentNode$1_2_classLit;
}
;
_.castableTypeMap$ = {209:1, 210:1};
_.this$0 = null;
function $asPoint(this$static){
  return this$static.offset >= 0?new Point$Tx_0(this$static.container, this$static.offset):new Point$El_0(this$static.container, this$static.nodeAfter);
}

function $getNodeBefore(this$static){
  return this$static.offset >= 0?null:!this$static.nodeAfter?dynamicCast(this$static.container, 163).getLastChild():dynamicCast(this$static.nodeAfter, 163).prev;
}

function $isAtBeginning(this$static){
  return this$static.offset >= 0?this$static.offset == 0:this$static.nodeAfter == this$static.container.getFirstChild();
}

function $isAtEnd(this$static){
  return this$static.offset >= 0?this$static.offset == dynamicCast(this$static.container, 190).data_0.length:!this$static.nodeAfter;
}

function $maybeMoveOut(this$static){
  var dir;
  dir = 0;
  this$static.offset >= 0?this$static.offset == 0?(dir = -1):this$static.offset >= dynamicCast(this$static.container, 190).data_0.length && (dir = 1):this$static.nodeAfter == this$static.container.getFirstChild()?(dir = -1):!this$static.nodeAfter && (dir = 1);
  if (dir != 0) {
    this$static.nodeAfter = this$static.container;
    this$static.container = this$static.nodeAfter.parent_0;
    dir == 1 && (this$static.nodeAfter = this$static.nodeAfter.next);
    this$static.offset = -1;
    return true;
  }
   else {
    return false;
  }
}

function $set_2(this$static, container, nodeAfter){
  this$static.container = container;
  this$static.nodeAfter = nodeAfter;
  this$static.offset = -1;
  return this$static;
}

function $set_3(this$static, container, offset){
  this$static.container = container;
  this$static.offset = offset;
  this$static.nodeAfter = null;
  return this$static;
}

function $setToAfter(this$static, node){
  $set_2(this$static, node.parent_0, node.next);
  return this$static;
}

function $setToBefore(this$static, node){
  $set_2(this$static, node.parent_0, node);
  return this$static;
}

function $setToBeginning(this$static, node){
  node != null && node.castableTypeMap$ && !!node.castableTypeMap$[152]?$set_2(this$static, dynamicCast(node, 152), node.getFirstChild()):$set_3(this$static, dynamicCast(node, 190), 0);
  return this$static;
}

function $setToEnd(this$static, node){
  var textNode;
  if (node != null && node.castableTypeMap$ && !!node.castableTypeMap$[152]) {
    $set_2(this$static, dynamicCast(node, 152), null);
  }
   else {
    textNode = dynamicCast(node, 190);
    $set_3(this$static, textNode, textNode.data_0.length);
  }
  return this$static;
}

function ContentPoint_0(container, nodeAfter){
  this.container = container;
  this.nodeAfter = nodeAfter;
  this.offset = -1;
}

function ContentPoint_1(textNode, offset){
  this.container = textNode;
  this.nodeAfter = null;
  this.offset = offset;
}

function fromPoint(point){
  return point.offset >= 0?new ContentPoint_1(dynamicCast(point.container, 190), $getTextOffset(point)):new ContentPoint_0(dynamicCast(point.container, 152), dynamicCast($getNodeAfter(point), 163));
}

function ContentPoint(){
}

_ = ContentPoint_1.prototype = ContentPoint_0.prototype = ContentPoint.prototype = new Object_0;
_.equals$ = function equals_21(o){
  var point;
  if (o === this)
    return true;
  if (o != null && o.castableTypeMap$ && !!o.castableTypeMap$[192]) {
    point = dynamicCast(o, 192);
    return this.container == point.container && this.offset == point.offset && (this.nodeAfter == point.nodeAfter || this.nodeAfter == point.nodeAfter);
  }
  return false;
}
;
_.getClass$ = function getClass_480(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentPoint_2_classLit;
}
;
_.hashCode$ = function hashCode_21(){
  return getHashCode(this.container) + 37 * this.offset + 1009 * getHashCode(this.nodeAfter);
}
;
_.toString$ = function toString_40(){
  return '(' + $toString_8(this.container) + ':' + (this.offset >= 0?valueOf_0(this.offset):this.nodeAfter) + ')';
}
;
_.castableTypeMap$ = {192:1};
_.container = null;
_.nodeAfter = null;
_.offset = 0;
function PointRange_0(collapsedAt){
  this.first = collapsedAt;
  this.second = collapsedAt;
  this.isCollapsed = true;
}

function PointRange_1(first, second){
  this.first = first;
  this.second = second;
  this.isCollapsed = $equals_6(first, second);
}

function PointRange(){
}

_ = PointRange_1.prototype = PointRange_0.prototype = PointRange.prototype = new Object_0;
_.equals$ = function equals_22(obj){
  var other;
  if (this === obj) {
    return true;
  }
  if (obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[253]) {
    other = dynamicCast(obj, 253);
    return $equals_6(this.first, other.first) && $equals_6(this.second, other.second);
  }
  return false;
}
;
_.getClass$ = function getClass_481(){
  return Lorg_waveprotocol_wave_model_document_util_PointRange_2_classLit;
}
;
_.hashCode$ = function hashCode_22(){
  var result;
  result = 31 + (!this.first?0:$hashCode_3(this.first));
  result = 31 * result + (!this.second?0:$hashCode_3(this.second));
  return result;
}
;
_.toString$ = function toString_41(){
  return this.isCollapsed?'Collapsed:[' + this.first + ']':'Range:[' + this.first + ', ' + this.second + ']';
}
;
_.castableTypeMap$ = {253:1};
_.first = null;
_.isCollapsed = false;
_.second = null;
function ContentRange_0(first, second){
  this.first = first;
  this.second = second;
  this.isCollapsed = $equals_6(first, second);
}

function ContentRange(){
}

_ = ContentRange_0.prototype = ContentRange.prototype = new PointRange;
_.getClass$ = function getClass_482(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentRange_2_classLit;
}
;
_.castableTypeMap$ = {253:1};
function $clinit_758(){
  $clinit_758 = nullMethod;
  INSTANCE_5 = new FullContentView_0;
}

function $asElement_3(node){
  return node?node.asElement():null;
}

function $asText_2(node){
  return node?node.asText():null;
}

function $getAttribute_3(element, name_0){
  return dynamicCast($get_12(element.attributes, name_0), 1);
}

function FullContentView_0(){
}

function FullContentView(){
}

_ = FullContentView_0.prototype = FullContentView.prototype = new Object_0;
_.asElement_0 = function asElement_4(node){
  return $asElement_3(dynamicCast(node, 163));
}
;
_.asText_0 = function asText_4(node){
  return $asText_2(dynamicCast(node, 163));
}
;
_.getAttribute_0 = function getAttribute_2(element, name_0){
  return $getAttribute_3(dynamicCast(element, 152), name_0);
}
;
_.getAttributes = function getAttributes_2(element){
  return $clinit_1445() , copyToJavaMap(dynamicCast(element, 152).attributes, new HashMap_0);
}
;
_.getClass$ = function getClass_483(){
  return Lorg_waveprotocol_wave_client_editor_content_FullContentView_2_classLit;
}
;
_.getData = function getData_2(textNode){
  return dynamicCast(textNode, 190).data_0;
}
;
_.getDocumentElement_0 = function getDocumentElement_2(){
  throw new RuntimeException_1('This is not implemented because the view is meant as a generic singleton');
}
;
_.getDocumentElement = function getDocumentElement_3(){
  return this.getDocumentElement_0();
}
;
_.getFirstChild_0 = function getFirstChild_5(node){
  return dynamicCast(node, 163).getFirstChild();
}
;
_.getLastChild_0 = function getLastChild_5(node){
  return dynamicCast(node, 163).getLastChild();
}
;
_.getLength = function getLength_2(textNode){
  return dynamicCast(textNode, 190).data_0.length;
}
;
_.getNextSibling = function getNextSibling_3(node){
  return dynamicCast(node, 163).next;
}
;
_.getNodeType_0 = function getNodeType_3(node){
  return dynamicCast(node, 163).getNodeType();
}
;
_.getParentElement = function getParentElement_3(node){
  return dynamicCast(node, 163).parent_0;
}
;
_.getPreviousSibling = function getPreviousSibling_3(node){
  return dynamicCast(node, 163).prev;
}
;
_.getTagName = function getTagName_2(element){
  return dynamicCast(element, 152).tagName_0;
}
;
_.isSameNode = function isSameNode_2(node, other){
  return dynamicCast(node, 163) == dynamicCast(other, 163);
}
;
_.castableTypeMap$ = {109:1, 125:1};
var INSTANCE_5;
function $appendData(this$static, textNode, arg){
  $clinit_672();
  ++ignoreMutations;
  try {
    $insertData_1(this$static, textNode, textNode.data_0.length, arg);
  }
   finally {
    --ignoreMutations;
  }
}

function $appendData_0(this$static, textNode, arg){
  $appendData(this$static, dynamicCast(textNode, 190), arg);
}

function $clearAffectHtml(this$static){
  checkState(this$static.affectImpl, 'Already not affectImpl');
  this$static.affectImpl = false;
}

function $createElement_6(this$static, tagName, attributes, parent_0, nodeAfter){
  var newElement;
  newElement = $createElement_3(this$static.factory, tagName, attributes);
  $clinit_672();
  ++ignoreMutations;
  try {
    $insertBefore_4(this$static, parent_0, newElement, null, nodeAfter, this$static.factory);
    return newElement;
  }
   finally {
    --ignoreMutations;
  }
}

function $createElement_7(this$static, tagName, attributes, parent_0, nodeAfter){
  return $createElement_6(this$static, tagName, attributes, dynamicCast(parent_0, 152), dynamicCast(nodeAfter, 163));
}

function $createTextNode_3(this$static, data, parent_0, nodeAfter){
  var newTextNode;
  newTextNode = $createText(this$static.factory, data);
  $clinit_672();
  ++ignoreMutations;
  try {
    $insertBefore_3(this$static, parent_0, newTextNode, nodeAfter);
    return newTextNode;
  }
   finally {
    --ignoreMutations;
  }
}

function $createTextNode_4(this$static, data, parent_0, nodeAfter){
  return $createTextNode_3(this$static, data, dynamicCast(parent_0, 152), dynamicCast(nodeAfter, 163));
}

function $deleteData_0(this$static, textNode, offset, count){
  $clinit_672();
  ++ignoreMutations;
  try {
    $deleteData_2(textNode, offset, count, this$static.affectImpl);
  }
   finally {
    --ignoreMutations;
  }
}

function $deleteData_1(this$static, textNode, offset, count){
  $deleteData_0(this$static, dynamicCast(textNode, 190), offset, count);
}

function $insertBefore_3(this$static, parent_0, newChild, refChild){
  $clinit_672();
  ++ignoreMutations;
  try {
    return $insertBefore_0(parent_0, newChild, refChild, this$static.affectImpl);
  }
   finally {
    --ignoreMutations;
  }
}

function $insertBefore_4(this$static, parent_0, from, to, refChild, factory){
  $clinit_672();
  ++ignoreMutations;
  try {
    return $insertBefore_1(parent_0, from, to, refChild, this$static.affectImpl, factory);
  }
   finally {
    --ignoreMutations;
  }
}

function $insertBefore_5(this$static, parent_0, from, to, refChild){
  return $insertBefore_4(this$static, parent_0, dynamicCast(from, 163), to, refChild, null);
}

function $insertData_1(this$static, textNode, offset, arg){
  $clinit_672();
  ++ignoreMutations;
  try {
    $insertData_3(textNode, offset, arg, this$static.affectImpl);
  }
   finally {
    --ignoreMutations;
  }
}

function $insertData_2(this$static, textNode, offset, arg){
  $insertData_1(this$static, dynamicCast(textNode, 190), offset, arg);
}

--></script>
<script><!--
function $removeAttribute_1(element, name_0){
  var old;
  $clinit_672();
  ++ignoreMutations;
  try {
    old = dynamicCast($get_12(element.attributes, name_0), 1);
    $remove_25(element.attributes, name_0);
    $notifyAttributeModified(element, name_0, old, null);
  }
   finally {
    --ignoreMutations;
  }
}

function $removeChild_2(this$static, parent_0, oldChild){
  $clinit_672();
  ++ignoreMutations;
  try {
    $removeChild_0(parent_0, oldChild, this$static.affectImpl);
  }
   finally {
    --ignoreMutations;
  }
}

function $removeChild_3(this$static, parent_0, oldChild){
  $removeChild_2(this$static, dynamicCast(parent_0, 152), dynamicCast(oldChild, 163));
}

function $setAffectHtml(this$static){
  checkState(!this$static.affectImpl, 'Already affectImpl is true');
  this$static.affectImpl = true;
}

function $setAttribute_2(element, name_0, value){
  var old;
  $clinit_672();
  ++ignoreMutations;
  try {
    old = dynamicCast($get_12(element.attributes, name_0), 1);
    $put_5(element.attributes, name_0, value);
    $notifyAttributeModified(element, name_0, old, value);
  }
   finally {
    --ignoreMutations;
  }
}

function $splitText_3(this$static, textNode, offset){
  $clinit_672();
  ++ignoreMutations;
  try {
    return $splitText_5(textNode, offset, this$static.affectImpl);
  }
   finally {
    --ignoreMutations;
  }
}

function $splitText_4(this$static, textNode, offset){
  return $splitText_3(this$static, dynamicCast(textNode, 190), offset);
}

function ContentRawDocument_0(rootElement, factory){
  $clinit_758();
  this.rootElement = rootElement;
  this.factory = factory;
}

function ContentRawDocument(){
}

_ = ContentRawDocument_0.prototype = ContentRawDocument.prototype = new FullContentView;
_.appendData = function appendData_0(textNode, arg){
  $appendData(this, dynamicCast(textNode, 190), arg);
}
;
_.createElement_0 = function createElement_1(tagName, attributes, parent_0, nodeAfter){
  return $createElement_6(this, tagName, attributes, dynamicCast(parent_0, 152), dynamicCast(nodeAfter, 163));
}
;
_.createTextNode_0 = function createTextNode_2(data, parent_0, nodeAfter){
  return $createTextNode_3(this, data, dynamicCast(parent_0, 152), dynamicCast(nodeAfter, 163));
}
;
_.deleteData_0 = function deleteData_0(textNode, offset, count){
  $deleteData_0(this, dynamicCast(textNode, 190), offset, count);
}
;
_.getClass$ = function getClass_484(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentRawDocument_2_classLit;
}
;
_.getDocumentElement_0 = function getDocumentElement_4(){
  return this.rootElement;
}
;
_.getIndexingContainer = function getIndexingContainer_0(domNode){
  return dynamicCast(domNode, 163).indexingContainer;
}
;
_.insertData_0 = function insertData_1(textNode, offset, arg){
  $insertData_1(this, dynamicCast(textNode, 190), offset, arg);
}
;
_.removeAttribute_0 = function removeAttribute_0(element, name_0){
  $removeAttribute_1(dynamicCast(element, 152), name_0);
}
;
_.removeChild_0 = function removeChild_1(parent_0, oldChild){
  $removeChild_2(this, dynamicCast(parent_0, 152), dynamicCast(oldChild, 163));
}
;
_.setAttribute_0 = function setAttribute_0(element, name_0, value){
  $setAttribute_2(dynamicCast(element, 152), name_0, value);
}
;
_.setIndexingContainer = function setIndexingContainer_0(domNode, indexingContainer){
  dynamicCast(domNode, 163).indexingContainer = indexingContainer;
}
;
_.splitText_0 = function splitText_2(textNode, offset){
  return $splitText_3(this, dynamicCast(textNode, 190), offset);
}
;
_.castableTypeMap$ = {109:1, 125:1};
_.affectImpl = false;
_.factory = null;
_.rootElement = null;
function $clinit_761(){
  $clinit_761 = nullMethod;
  $clinit_696();
  nodeletOffsetOutput = new HtmlPoint_0;
}

function $deleteData_2(this$static, offset, count, affectImpl){
  var data, filteredHtml, fromIncl, next, node, nodelet, subOffset, toExcl, nodelet_0;
  data = this$static.data_0;
  $setContentData(this$static, data.substr(0, offset - 0) + $substring_0(data, offset + count, data.length));
  if (affectImpl) {
    if (nodelet_0 = this$static.getImplNodelet() , !!nodelet_0 && !!$getParentElement(nodelet_0)) {
      $findNodeletWithOffset_0(this$static, offset, nodeletOffsetOutput, this$static.context);
      nodelet = nodeletOffsetOutput.node;
      subOffset = nodeletOffsetOutput.offset;
      if (nodelet.length - subOffset >= count) {
        nodelet.deleteData(subOffset, count);
        this$static.context.this$0.editingConcerns.textNodeletAffected(nodelet, subOffset, -count, ($clinit_794() , DATA));
      }
       else {
        toExcl = $implSplitText(this$static, offset + count);
        fromIncl = $implSplitText(this$static, offset);
        filteredHtml = this$static.context.this$0.renderingConcerns.this$0.filteredHtmlView;
        for (node = fromIncl; node != toExcl && !!node;) {
          next = dynamicCastJso($getNextSibling_3(filteredHtml, node));
          $removeFromParent(node);
          node = next;
        }
      }
    }
     else {
      this$static.implNodelet.deleteData(offset, count);
    }
  }
}

function $findNodeletWithOffset(this$static, offset, output){
  var next;
  $findNodeletWithOffset_1(this$static, offset, output, (next = checkNodeAndNeighbour(this$static) , !next?null:next.getImplNodelet()));
}

function $findNodeletWithOffset_0(this$static, offset, output){
  var $e0, e, tries, next;
  for (tries = 0; tries < 3; ++tries) {
    try {
      $findNodeletWithOffset_1(this$static, offset, output, (next = checkNodeAndNeighbour(this$static) , !next?null:next.getImplNodelet()));
      return;
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 171)) {
        e = $e0;
        $handleMissing(this$static.context.this$0.renderingConcerns.this$0.repairer, e);
      }
       else 
        throw $e0;
    }
  }
  throw new EditorRuntimeException_0("Tried to repair and it just wouldn't work");
}

function $findNodeletWithOffset_1(this$static, offset, output, nextImpl){
  var filteredHtml, nodelet, prevSum, sum;
  filteredHtml = this$static.context.this$0.renderingConcerns.this$0.filteredHtmlView;
  sum = 0;
  for (nodelet = this$static.implNodelet; nodelet != nextImpl; nodelet = dynamicCastJso($getNextSibling_3(filteredHtml, nodelet))) {
    prevSum = sum;
    sum += nodelet.length;
    if (sum >= offset) {
      output.node = nodelet;
      output.offset = offset - prevSum;
      return;
    }
  }
  output.node = null;
}

function $getOffset(this$static, textNodelet){
  var $e0, next;
  try {
    return $getOffset_0(this$static, textNodelet, (next = checkNodeAndNeighbour(this$static) , !next?null:next.getImplNodelet()));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 143)) {
      throw new InconsistencyException$HtmlMissing_0(this$static, dynamicCast($getParentElement_3(this$static.context.this$0.renderingConcerns.this$0.renderedContentView, this$static), 152).implNodelet);
    }
     else 
      throw $e0;
  }
}

function $getOffset_0(this$static, textNodelet, nextImpl){
  return getOffset(textNodelet, this$static.implNodelet, nextImpl, this$static.context.this$0.renderingConcerns.this$0.filteredHtmlView);
}

function $implSplitText(this$static, offset){
  var nodeletOffset, ret, text;
  $findNodeletWithOffset_0(this$static, offset, nodeletOffsetOutput, this$static.context);
  text = nodeletOffsetOutput.node;
  if (text.length == nodeletOffsetOutput.offset) {
    return text.nextSibling;
  }
   else if (nodeletOffsetOutput.offset == 0) {
    return text;
  }
   else {
    nodeletOffset = nodeletOffsetOutput.offset;
    ret = text.splitText(nodeletOffset);
    this$static.context.this$0.editingConcerns.textNodeletAffected(text, nodeletOffset, -10000, ($clinit_794() , SPLIT));
    return ret;
  }
}

function $insertData_3(this$static, offset, arg, affectImpl){
  var data, nodelet, nodeletOffset;
  data = this$static.data_0;
  $setContentData(this$static, data.substr(0, offset - 0) + arg + $substring_0(data, offset, data.length));
  if (affectImpl) {
    $findNodeletWithOffset_0(this$static, offset, nodeletOffsetOutput, this$static.context);
    nodelet = nodeletOffsetOutput.node;
    nodeletOffset = nodeletOffsetOutput.offset;
    nodelet.insertData(nodeletOffset, arg);
    this$static.context.this$0.editingConcerns.textNodeletAffected(nodelet, nodeletOffset, arg.length, ($clinit_794() , DATA));
  }
}

function $normaliseImpl(this$static){
  var $e0, e, i, nodelet, repairer;
  repairer = this$static.context.this$0.renderingConcerns.this$0.repairer;
  for (i = 0; i < 50; ++i) {
    try {
      $normaliseImplThrow(this$static);
      return this$static.implNodelet;
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 171)) {
        e = $e0;
        $handleMissing(repairer, e);
      }
       else if (instanceOf($e0, 4)) {
        $revert(repairer, before_0(this$static.context.this$0.renderingConcerns.this$0.renderedContentView, this$static), null);
      }
       else 
        throw $e0;
    }
  }
  nodelet = this$static.implNodelet;
  this$static.context.this$0.editingConcerns.textNodeletAffected(nodelet, -1000, -1000, ($clinit_794() , REPLACE_DATA));
  nodelet.data = this$static.data_0;
  return nodelet;
}

function $normaliseImplThrow(this$static){
  var filteredHtml, first, next, nextImpl, nodelet, nodelet_0;
  (!$isContentAttached(this$static) || !(nodelet_0 = this$static.getImplNodelet() , !!nodelet_0 && !!$getParentElement(nodelet_0))) && (!this$static.implNodelet || this$static.implNodelet.length != this$static.data_0.length) && (this$static.implNodelet = $doc.createTextNode(this$static.data_0) , undefined);
  first = this$static.implNodelet;
  if (first.length == this$static.data_0.length) {
    return;
  }
  next = checkNodeAndNeighbour(this$static);
  filteredHtml = this$static.context.this$0.renderingConcerns.this$0.filteredHtmlView;
  nextImpl = !next?null:next.getImplNodelet();
  for (nodelet = first; nodelet != nextImpl && !!nodelet; nodelet = dynamicCastJso($getNextSibling_3(filteredHtml, first))) {
    if (nodelet != first) {
      this$static.context.this$0.editingConcerns.textNodeletAffected(nodelet, -1000, -1000, ($clinit_794() , REMOVE));
      $removeFromParent(nodelet);
    }
  }
  this$static.context.this$0.editingConcerns.textNodeletAffected(first, -1000, -1000, ($clinit_794() , REPLACE_DATA));
  first.data = this$static.data_0;
}

function $setContentData(this$static, newData){
  var parent_0;
  if (!$equals_3(newData, this$static.data_0)) {
    this$static.data_0 = newData;
    parent_0 = this$static.parent_0;
    !!parent_0 && $notifyChildrenMutated(parent_0);
  }
}

function $setRendering_0(this$static, isRendering){
  if (!!this$static.implNodelet == isRendering) {
    return;
  }
  isRendering?(this$static.implNodelet = $doc.createTextNode(this$static.data_0) , undefined):(this$static.implNodelet = null);
}

function $splitText_5(this$static, offset, affectImpl){
  var first, nodelet, second, sibling;
  if (offset == 0) {
    return this$static;
  }
   else if (offset >= this$static.data_0.length) {
    return null;
  }
  affectImpl?(nodelet = $implSplitText(this$static, offset)):(nodelet = $doc.createTextNode(''));
  first = this$static.data_0.substr(0, offset - 0);
  second = $substring(this$static.data_0, offset);
  sibling = new ContentTextNode_1(second, nodelet, this$static.context);
  $setContentData(this$static, first);
  $insertBefore_0(this$static.parent_0, sibling, this$static.next, false);
  return sibling;
}

function ContentTextNode_0(data, bundle){
  $clinit_761();
  this.context = bundle;
  this.implNodelet = null;
  this.data_0 = data;
}

function ContentTextNode_1(data, wrapped, bundle){
  $clinit_696();
  this.context = bundle;
  this.implNodelet = wrapped;
  this.data_0 = data;
}

function checkNodeAndNeighbour(node){
  var next, parentElement, renderedContent, nodelet, nodelet_0;
  renderedContent = node.context.this$0.renderingConcerns.this$0.renderedContentView;
  if (!(nodelet = node.getImplNodelet() , !!nodelet && !!$getParentElement(nodelet))) {
    parentElement = dynamicCast($getParentElement_3(renderedContent, node), 152).implNodelet;
    throw new InconsistencyException$HtmlMissing_0(node, parentElement);
  }
  next = dynamicCast($getNextSibling_3(renderedContent, node), 163);
  if (!!next && !(nodelet_0 = next.getImplNodelet() , !!nodelet_0 && !!$getParentElement(nodelet_0))) {
    parentElement = dynamicCast($getParentElement_3(renderedContent, node), 152).implNodelet;
    throw new InconsistencyException$HtmlMissing_0(next, parentElement);
  }
  return next;
}

function getOffset(textNodelet, startNode, nextImpl, view){
  $clinit_761();
  var nodelet, offset;
  offset = 0;
  for (nodelet = startNode; nodelet != nextImpl; nodelet = dynamicCastJso($getNextSibling_3(view, nodelet))) {
    if (nodelet == textNodelet) {
      return offset;
    }
    offset += nodelet.length;
  }
  throw new EditorRuntimeException_0("Didn't find text nodelet to get offset for");
}

function sumTextNodes(fromIncl, toExcl, filteredHtml){
  $clinit_761();
  var data, n;
  data = '';
  for (n = fromIncl; n != toExcl && !!n; n = dynamicCastJso($getNextSibling_3(filteredHtml, n))) {
    data += n.data;
  }
  return $replace_1(data, 160, 32);
}

function sumTextNodesLength(fromIncl, toExcl, filteredHtml){
  var length_0, n;
  length_0 = 0;
  for (n = fromIncl; n != toExcl && !!n; n = dynamicCastJso($getNextSibling_3(filteredHtml, n))) {
    length_0 += n.length;
  }
  return length_0;
}

function ContentTextNode(){
}

_ = ContentTextNode_1.prototype = ContentTextNode_0.prototype = ContentTextNode.prototype = new ContentNode;
_.asElement = function asElement_5(){
  return null;
}
;
_.asText = function asText_5(){
  return this;
}
;
_.getClass$ = function getClass_485(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentTextNode_2_classLit;
}
;
_.getImplNodelet = function getImplNodelet_1(){
  return this.implNodelet;
}
;
_.getNodeType = function getNodeType_4(){
  return 3;
}
;
_.isConsistent_0 = function isConsistent_1(){
  var $e0, nodelet, filteredHtml, next, next_0;
  try {
    return (nodelet = this.getImplNodelet() , !!nodelet && !!$getParentElement(nodelet)) && $equals_3((next = (next_0 = checkNodeAndNeighbour(this) , !next_0?null:next_0.getImplNodelet()) , filteredHtml = this.context.this$0.renderingConcerns.this$0.filteredHtmlView , sumTextNodes(this.implNodelet, next, filteredHtml)), this.data_0);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 171)) {
      return false;
    }
     else if (instanceOf($e0, 3)) {
      return false;
    }
     else 
      throw $e0;
  }
}
;
_.isTextNode = function isTextNode_0(){
  return true;
}
;
_.normaliseImpl = function normaliseImpl_0(){
  return $normaliseImpl(this);
}
;
_.onAddedToParent_0 = function onAddedToParent_4(previousParent){
  var nodelet;
  (nodelet = this.getImplNodelet() , !!nodelet && !!$getParentElement(nodelet)) || (!this.implNodelet || this.implNodelet.length != this.data_0.length) && (this.implNodelet = $doc.createTextNode(this.data_0) , undefined);
}
;
_.revertImplementation = function revertImplementation_0(){
  this.implNodelet = $doc.createTextNode(this.data_0);
}
;
_.castableTypeMap$ = {61:1, 145:1, 163:1, 190:1};
_.data_0 = '';
var nodeletOffsetOutput;
function $clinit_763(){
  $clinit_763 = nullMethod;
  DIFF_KEY = '@' + prefixIncrementor++ + '/diff';
  DIFF_INSERT_KEY = DIFF_KEY + '/ins';
  DIFF_DELETE_KEY = DIFF_KEY + '/del';
  INSERT_MARKER = new Object_1;
}

function $consume_10(this$static, op){
  var size;
  checkState(!this$static.target_0, 'Diff inner target not initialised');
  this$static.operation = op;
  $consume_9(this$static.inner, this$static.opWrapper);
  size = this$static.inner.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1;
  $each_1(this$static.deleteInfos, new DiffHighlightingFilter$3_0(this$static, size));
}

function $maybeSavePreviousDeleteInfo(this$static){
  !!this$static.currentDeleteInfo && $put_3(this$static.deleteInfos, this$static.currentDeleteLocation, this$static.currentDeleteInfo);
}

function DiffHighlightingFilter_0(contentDocument){
  $clinit_763();
  this.opWrapper = new DiffHighlightingFilter$1_0(this);
  this.filter = new DiffHighlightingFilter$2_0(this);
  this.inner = contentDocument;
}

function clearDiffs(target){
  $clinit_763();
  guardedResetAnnotation(target, target.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1, DIFF_INSERT_KEY);
  guardedResetAnnotation(target, target.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1, DIFF_DELETE_KEY);
}

function DiffHighlightingFilter(){
}

_ = DiffHighlightingFilter_0.prototype = DiffHighlightingFilter.prototype = new Object_0;
_.getClass$ = function getClass_486(){
  return Lorg_waveprotocol_wave_client_editor_content_DiffHighlightingFilter_2_classLit;
}
;
_.castableTypeMap$ = {};
_.currentDeleteInfo = null;
_.currentDeleteLocation = 0;
_.currentLocation = 0;
_.deleteInfos = null;
_.diffDepth = 0;
_.inner = null;
_.operation = null;
_.target_0 = null;
var DIFF_DELETE_KEY, DIFF_INSERT_KEY, DIFF_KEY, INSERT_MARKER;
function DiffOpWrapperBase(){
}

_ = DiffOpWrapperBase.prototype = new Object_0;
_.applyComponent = function applyComponent(i, c){
  throw new UnsupportedOperationException_1(this.exceptionMessage);
}
;
_.getClass$ = function getClass_487(){
  return Lorg_waveprotocol_wave_client_editor_content_DiffOpWrapperBase_2_classLit;
}
;
_.size_0 = function size_30(){
  throw new UnsupportedOperationException_1(this.exceptionMessage);
}
;
_.castableTypeMap$ = {173:1};
_.exceptionMessage = null;
function DiffHighlightingFilter$1_0(this$0){
  this.this$0 = this$0;
  this.exceptionMessage = "The document isn't expected to call this method";
}

function DiffHighlightingFilter$1(){
}

_ = DiffHighlightingFilter$1_0.prototype = DiffHighlightingFilter$1.prototype = new DiffOpWrapperBase;
_.apply_5 = function apply_9(innerCursor){
  if (!this.this$0.inner.this$0.applyingToDocument) {
    this.this$0.operation.apply_5(innerCursor);
    return;
  }
  this.this$0.target_0 = innerCursor;
  this.this$0.deleteInfos = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$IntMapAdapter_0(new HashMap_0));
  this.this$0.currentDeleteInfo = null;
  this.this$0.currentDeleteLocation = -1;
  this.this$0.currentLocation = 0;
  this.this$0.operation.apply_5(this.this$0.filter);
  $maybeSavePreviousDeleteInfo(this.this$0);
  this.this$0.target_0 = null;
}
;
_.getClass$ = function getClass_488(){
  return Lorg_waveprotocol_wave_client_editor_content_DiffHighlightingFilter$1_2_classLit;
}
;
_.toString$ = function toString_42(){
  return 'DiffOpWrapper(' + this.this$0.operation + ')';
}
;
_.castableTypeMap$ = {173:1};
_.this$0 = null;
function $deletify(this$static, element){
  var n;
  if (!element) {
    return;
  }
  styleElement(element, ($clinit_959() , DELETE_1));
  for (n = element.firstChild; n; n = n.nextSibling) {
    n.nodeType == 3 || $deletify(this$static, n);
  }
}

function $isOutsideInsertionAnnotation(this$static){
  var location_0;
  location_0 = this$static.this$0.currentLocation;
  return $firstAnnotationChange(this$static.this$0.inner.fullAnnotationSet, location_0, location_0 + 1, ($clinit_763() , DIFF_INSERT_KEY), null) == -1;
}

function $updateDeleteInfo(this$static){
  if (this$static.this$0.currentLocation != this$static.this$0.currentDeleteLocation || !this$static.this$0.currentDeleteInfo) {
    $maybeSavePreviousDeleteInfo(this$static.this$0);
    this$static.this$0.currentDeleteInfo = dynamicCast($getAnnotation(this$static.this$0.inner.fullAnnotationSet, this$static.this$0.currentLocation, ($clinit_763() , DIFF_DELETE_KEY)), 156);
    !this$static.this$0.currentDeleteInfo && (this$static.this$0.currentDeleteInfo = new DiffHighlightingFilter$DeleteInfo_0);
  }
  this$static.this$0.currentDeleteLocation = this$static.this$0.currentLocation;
}

function DiffHighlightingFilter$2_0(this$0){
  this.this$0 = this$0;
}

function DiffHighlightingFilter$2(){
}

_ = DiffHighlightingFilter$2_0.prototype = DiffHighlightingFilter$2.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary(map){
  this.this$0.target_0.annotationBoundary(map);
}
;
_.characters_0 = function characters_0(characters){
  this.this$0.diffDepth == 0 && $startLocalAnnotation(this.this$0.inner, ($clinit_763() , DIFF_INSERT_KEY), INSERT_MARKER);
  this.this$0.target_0.characters_0(characters);
  this.this$0.currentLocation += characters.length;
  this.this$0.diffDepth == 0 && $endLocalAnnotation(this.this$0.inner, ($clinit_763() , DIFF_INSERT_KEY));
}
;
_.deleteCharacters = function deleteCharacters(text){
  var e, endLocation, index, location_0, nextIndex, nextScanLocation, scanLocation, surroundedInfo;
  if (this.this$0.diffDepth == 0 && $isOutsideInsertionAnnotation(this)) {
    location_0 = this.this$0.currentLocation;
    endLocation = location_0 + text.length;
    $updateDeleteInfo(this);
    scanLocation = location_0;
    do {
      surroundedInfo = dynamicCast($getAnnotation(this.this$0.inner.fullAnnotationSet, scanLocation, ($clinit_763() , DIFF_DELETE_KEY)), 156);
      nextScanLocation = $firstAnnotationChange(this.this$0.inner.fullAnnotationSet, scanLocation, endLocation, DIFF_DELETE_KEY, surroundedInfo);
      nextScanLocation == -1 && (nextScanLocation = endLocation);
      index = scanLocation - location_0;
      nextIndex = nextScanLocation - location_0;
      e = $doc.createElement('span');
      styleElement(e, ($clinit_959() , DELETE_1));
      e.textContent = text.substr(index, nextIndex - index) || '';
      $add_9(this.this$0.currentDeleteInfo.htmlElements, e);
      !!surroundedInfo && $addAll_0(this.this$0.currentDeleteInfo.htmlElements, surroundedInfo.htmlElements);
      scanLocation = nextScanLocation;
    }
     while (nextScanLocation < endLocation);
  }
  this.this$0.target_0.deleteCharacters(text);
}
;
_.deleteElementEnd = function deleteElementEnd(){
  this.this$0.target_0.deleteElementEnd();
  --this.this$0.diffDepth;
}
;
_.deleteElementStart = function deleteElementStart(type, attrs){
  var currentElement, e;
  if (this.this$0.diffDepth == 0 && $isOutsideInsertionAnnotation(this)) {
    currentElement = dynamicCast(dynamicCast(this.this$0.inner.this$0.indexedDoc.currentContainer.value_0, 163), 152);
    e = currentElement.implNodelet;
    ($clinit_819() , $equals_3('line', currentElement.tagName_0)) && (e = $doc.createElement('br'));
    if (e) {
      e = e.cloneNode(true);
      $deletify(this, e);
      $updateDeleteInfo(this);
      $add_9(this.this$0.currentDeleteInfo.htmlElements, e);
    }
  }
  ++this.this$0.diffDepth;
  this.this$0.target_0.deleteElementStart(type, attrs);
}
;
_.elementEnd = function elementEnd(){
  this.this$0.target_0.elementEnd();
  ++this.this$0.currentLocation;
  --this.this$0.diffDepth;
  this.this$0.diffDepth == 0 && $endLocalAnnotation(this.this$0.inner, ($clinit_763() , DIFF_INSERT_KEY));
}
;
_.elementStart = function elementStart(tagName, attributes){
  this.this$0.diffDepth == 0 && $startLocalAnnotation(this.this$0.inner, ($clinit_763() , DIFF_INSERT_KEY), INSERT_MARKER);
  ++this.this$0.diffDepth;
  this.this$0.target_0.elementStart(tagName, attributes);
  ++this.this$0.currentLocation;
}
;
_.getClass$ = function getClass_489(){
  return Lorg_waveprotocol_wave_client_editor_content_DiffHighlightingFilter$2_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes(oldAttrs, newAttrs){
  ++this.this$0.currentLocation;
  this.this$0.target_0.replaceAttributes(oldAttrs, newAttrs);
}
;
_.retain = function retain(itemCount){
  this.this$0.currentLocation += itemCount;
  this.this$0.target_0.retain(itemCount);
}
;
_.updateAttributes = function updateAttributes(attrUpdate){
  ++this.this$0.currentLocation;
  this.this$0.target_0.updateAttributes(attrUpdate);
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $apply_1(this$static, location_0, _item){
  var existing, item;
  if (location_0 == this$static.val$size) {
    return;
  }
  if (_item != null && _item.castableTypeMap$ && !!_item.castableTypeMap$[156]) {
    item = dynamicCast(_item, 156);
    existing = dynamicCast($getAnnotation(this$static.this$0.inner.fullAnnotationSet, location_0, ($clinit_763() , DIFF_DELETE_KEY)), 156);
    !!existing && $addAll_0(item.htmlElements, existing.htmlElements);
    $setAnnotation_0(this$static.this$0.inner, location_0, location_0 + 1, DIFF_DELETE_KEY, item);
  }
}

function DiffHighlightingFilter$3_0(this$0, val$size){
  this.this$0 = this$0;
  this.val$size = val$size;
}

function DiffHighlightingFilter$3(){
}

_ = DiffHighlightingFilter$3_0.prototype = DiffHighlightingFilter$3.prototype = new Object_0;
_.getClass$ = function getClass_490(){
  return Lorg_waveprotocol_wave_client_editor_content_DiffHighlightingFilter$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$size = 0;
function DiffHighlightingFilter$DeleteInfo_0(){
  this.htmlElements = new ArrayList_0;
}

function DiffHighlightingFilter$DeleteInfo(){
}

_ = DiffHighlightingFilter$DeleteInfo_0.prototype = DiffHighlightingFilter$DeleteInfo.prototype = new Object_0;
_.getClass$ = function getClass_491(){
  return Lorg_waveprotocol_wave_client_editor_content_DiffHighlightingFilter$DeleteInfo_2_classLit;
}
;
_.castableTypeMap$ = {156:1};
function $clinit_771(){
  $clinit_771 = nullMethod;
  STUB_0 = new ExtendedClientDocumentContext$LowLevelEditingConcerns$1_0;
}

var STUB_0;
function ExtendedClientDocumentContext$LowLevelEditingConcerns$1_0(){
}

function ExtendedClientDocumentContext$LowLevelEditingConcerns$1(){
}

_ = ExtendedClientDocumentContext$LowLevelEditingConcerns$1_0.prototype = ExtendedClientDocumentContext$LowLevelEditingConcerns$1.prototype = new Object_0;
_.getClass$ = function getClass_492(){
  return Lorg_waveprotocol_wave_client_editor_content_ExtendedClientDocumentContext$LowLevelEditingConcerns$1_2_classLit;
}
;
_.getSelectionHelper = function getSelectionHelper_1(){
  throw new IllegalStateException_1('Not in an editing context');
}
;
_.getSuggestionsManager = function getSuggestionsManager_0(){
  throw new IllegalStateException_1('Not in an editing context');
}
;
_.getTypingExtractor = function getTypingExtractor_0(){
  throw new IllegalStateException_1('Not in an editing context');
}
;
_.hasEditor = function hasEditor_0(){
  return false;
}
;
_.textNodeletAffected = function textNodeletAffected_0(nodelet, affectedAfterOffset, insertionAmount, changeType){
}
;
_.castableTypeMap$ = {};
function FocusedPointRange_1(anchor, focus_0){
  this.anchor = dynamicCast(checkNotNull_1(anchor, 'anchor'), 248);
  this.focus_0 = dynamicCast(checkNotNull_1(focus_0, 'focus'), 248);
  this.isCollapsed = $equals_6(anchor, focus_0);
}

function FocusedPointRange(){
}

_ = FocusedPointRange_1.prototype = FocusedPointRange.prototype = new Object_0;
_.equals$ = function equals_23(obj){
  var other;
  if (this === obj)
    return true;
  if (obj == null)
    return false;
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[249]))
    return false;
  other = dynamicCast(obj, 249);
  if (!$equals_6(this.anchor, other.anchor))
    return false;
  if (!$equals_6(this.focus_0, other.focus_0))
    return false;
  return true;
}
;
_.getClass$ = function getClass_493(){
  return Lorg_waveprotocol_wave_model_document_util_FocusedPointRange_2_classLit;
}
;
_.hashCode$ = function hashCode_23(){
  var result;
  result = 31 + $hashCode_3(this.anchor);
  result = 31 * result + $hashCode_3(this.focus_0);
  return result;
}
;
_.toString$ = function toString_43(){
  return 'FocusedPointRange(' + this.anchor + ' -> ' + this.focus_0 + ')';
}
;
_.castableTypeMap$ = {249:1};
_.anchor = null;
_.focus_0 = null;
_.isCollapsed = false;
function $asOrderedRange(this$static, isOrdered){
  if (!this$static.orderedRange) {
    this$static.orderedRange = isOrdered?new ContentRange_0(this$static.anchor, this$static.focus_0):new ContentRange_0(this$static.focus_0, this$static.anchor);
    this$static.isOrdered = isOrdered;
  }
   else {
    checkState(isOrdered == this$static.isOrdered, 'Different isOrdered input from last time');
  }
  return this$static.orderedRange;
}

function FocusedContentRange_0(anchor, focus_0){
  FocusedPointRange_1.call(this, anchor, focus_0);
}

function FocusedContentRange_1(collapsedAt){
  this.anchor = collapsedAt;
  this.focus_0 = collapsedAt;
  this.isCollapsed = true;
}

function FocusedContentRange(){
}

_ = FocusedContentRange_1.prototype = FocusedContentRange_0.prototype = FocusedContentRange.prototype = new FocusedPointRange;
_.getClass$ = function getClass_494(){
  return Lorg_waveprotocol_wave_client_editor_content_FocusedContentRange_2_classLit;
}
;
_.castableTypeMap$ = {249:1};
_.isOrdered = false;
_.orderedRange = null;
function attribute_0(e, attribute, attributeDisplayString){
  var value;
  value = e.getAttribute(attribute) || '';
  return value != null && !($equals_3(attribute, 'contentEditable') && $equals_3(value, 'inherit'))?' ' + attributeDisplayString + "='" + value + "'":'';
}

function newLine(indent){
  var i, res;
  res = '<br/>';
  for (i = 0; i < indent; ++i) {
    res += '&nbsp;&nbsp';
  }
  return res;
}

--></script>
<script><!--
function print_0(n, selection, indent, multiLine){
  var child, collapsed, e, endMarker, endNodeAfter, endOffset, pretty, printEndMarker, printStartMarker, ret, singleLineHtml, startMarker, startNodeAfter, startOffset, value;
  collapsed = !!selection && selection.isCollapsed;
  printStartMarker = !!selection && dynamicCastJso(selection.first.container) == n;
  printEndMarker = !!selection && !collapsed && dynamicCastJso(selection.second.container) == n;
  startMarker = printStartMarker?collapsed?'|':'[':'';
  endMarker = printEndMarker?']':'';
  if (n.nodeType == 3) {
    value = $replaceAll($replaceAll(n.nodeValue, '\xA0', '\u25AA'), ' ', '\u25AB');
    startOffset = printStartMarker?$getTextOffset(selection.first):0;
    endOffset = printEndMarker?$getTextOffset(selection.second):value.length;
    ret = "'" + value.substr(0, startOffset - 0) + startMarker + value.substr(startOffset, endOffset - startOffset) + endMarker + $substring_0(value, endOffset, value.length) + "'";
    return multiLine?$replaceAll($replaceAll($replaceAll(ret, '&', '&amp;'), '<', '&lt;'), '>', '&gt;'):ret;
  }
   else {
    e = n;
    if (e.childNodes.length == 0) {
      return (multiLine?'&lt;':'<') + e.tagName.toLowerCase() + (styleName_0(e) + attribute_0(e, 'src', 'src') + attribute_0(e, 'contentEditable', 'editable') + attribute_0(e, 'sp', 'sp')) + '/' + (multiLine?'&gt;':'>');
    }
     else {
      singleLineHtml = multiLine && e.childNodes.length == 1 && e.firstChild.childNodes.length == 0;
      pretty = (multiLine?'&lt;':'<') + e.tagName.toLowerCase() + (styleName_0(e) + attribute_0(e, 'src', 'src') + attribute_0(e, 'contentEditable', 'editable') + attribute_0(e, 'sp', 'sp')) + '' + (multiLine?'&gt;':'>');
      child = e.firstChild;
      startNodeAfter = dynamicCastJso($getNodeAfter(selection.first));
      endNodeAfter = dynamicCastJso($getNodeAfter(selection.second));
      while (child) {
        pretty += (multiLine && !singleLineHtml?newLine(indent + 1):'') + (printStartMarker && child == startNodeAfter?startMarker:'') + (printEndMarker && child == endNodeAfter?endMarker:'') + print_0(child, selection, indent + 1, multiLine);
        child = child.nextSibling;
      }
      printEndMarker && !endNodeAfter && (pretty += endMarker);
      return pretty + (multiLine && !singleLineHtml?newLine(indent):'') + ((multiLine?'&lt;/':'<\/') + e.tagName.toLowerCase() + (multiLine?'&gt;':'>'));
    }
  }
}

function styleName_0(e){
  var name_0;
  name_0 = e.className;
  return name_0.length > 0?" class='" + e.className + "'":'';
}

function HtmlPoint_0(){
  this.node = null;
  this.offset = 0;
}

function HtmlPoint(){
}

_ = HtmlPoint_0.prototype = HtmlPoint.prototype = new Object_0;
_.getClass$ = function getClass_495(){
  return Lorg_waveprotocol_wave_client_editor_content_HtmlPoint_2_classLit;
}
;
_.toString$ = function toString_44(){
  return print_0(this.node, new PointRange_0(nodeOffsetToNodeletPoint(this.node, this.offset)), 0, false);
}
;
_.castableTypeMap$ = {};
_.node = null;
_.offset = 0;
function $actuallyPersist(this$static, localNode){
  var op, opBuffer, position, remainder, op_0;
  if (this$static.persistedView.inner_0.isSameNode(localNode, dynamicCast($getVisibleNode(this$static.persistedView, localNode), 163))) {
    throw new IllegalArgumentException_1('opaquePersist: element must not be persistent');
  }
  position = $getLocation_4(this$static.persistedLocations, getFilteredPoint(this$static.persistedView, new Point$El_0(localNode, null)));
  remainder = $size_10(this$static.persistedLocations) - position;
  opBuffer = new DocOpBuffer_0;
  position > 0 && $add_9(opBuffer.accu, new OperationComponents$Retain_0(position));
  buildDomInitializationFromSubtree(this$static.localDoc, localNode, opBuffer);
  remainder > 0 && $add_9(opBuffer.accu, new OperationComponents$Retain_0(remainder));
  op = (op_0 = new BufferedDocOpImpl_0(dynamicCast($toArray_1(opBuffer.accu, ($clinit_1292() , EMPTY_ARRAY_1)), 193)) , checkWellformedness(op_0) , op_0);
  this$static.nodeCreationDelegate = new ReadableTreeWalker_0(this$static.localDoc, localNode);
  $consume_11(this$static.sink, op);
  checkState($checkComplete(this$static.nodeCreationDelegate), 'Walk of tree did not match up...');
  this$static.nodeCreationDelegate = null;
}

function $createElement_8(this$static, tagName, attributes){
  checkState(!!this$static.nodeCreationDelegate, 'Lazy persistence delegated an element creation when not a delegate.');
  return dynamicCast($checkElement(this$static.nodeCreationDelegate, tagName, attributes), 152);
}

function $createTextNode_5(this$static, data){
  checkState(!!this$static.nodeCreationDelegate, 'Lazy persistence delegated a text node creationgwhen not a delegate.');
  return dynamicCast($checkTextNode(this$static.nodeCreationDelegate, data), 190);
}

function $updateLazyNodes(this$static, at){
  for (; !dynamicCast(at, 163).indexingContainer; at = dynamicCast(this$static.localDoc.inner_0.getParentElement(at), 163)) {
    if ($containsKey_0(this$static.lazilyPersistedNodes.backend, at)) {
      $remove_6(this$static.lazilyPersistedNodes.backend, at);
      $actuallyPersist(this$static, at);
      break;
    }
    if ($isSameNode_0(this$static.localDoc, at, dynamicCast(this$static.localDoc.inner_0.getDocumentElement(), 163))) {
      break;
    }
  }
}

function LazyPersistenceManager_0(outgoingSink, localDoc, persistedLocations, persistedView, localCorrectionSink){
  this.lazilyPersistedNodes = ($clinit_1445() , $clinit_1445() , new CollectionUtils$IdentityHashMapAdapter_0);
  this.sink = new LazyPersistenceManager$1_0(localCorrectionSink, outgoingSink);
  this.localDoc = localDoc;
  this.persistedLocations = persistedLocations;
  this.persistedView = persistedView;
}

function LazyPersistenceManager(){
}

_ = LazyPersistenceManager_0.prototype = LazyPersistenceManager.prototype = new Object_0;
_.getClass$ = function getClass_496(){
  return Lorg_waveprotocol_wave_client_editor_content_LazyPersistenceManager_2_classLit;
}
;
_.castableTypeMap$ = {};
_.localDoc = null;
_.nodeCreationDelegate = null;
_.persistedLocations = null;
_.persistedView = null;
_.sink = null;
function $consume_11(this$static, op){
  var $e0, e;
  try {
    $consume_8(this$static.val$localCorrectionSink, op, true);
    $consume_7(this$static.val$outgoingSink, op);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 189)) {
      e = $e0;
      $log_3(($clinit_672() , logger_1).fatalLogger, e);
    }
     else 
      throw $e0;
  }
}

function LazyPersistenceManager$1_0(val$localCorrectionSink, val$outgoingSink){
  this.val$localCorrectionSink = val$localCorrectionSink;
  this.val$outgoingSink = val$outgoingSink;
}

function LazyPersistenceManager$1(){
}

_ = LazyPersistenceManager$1_0.prototype = LazyPersistenceManager$1.prototype = new Object_0;
_.consume = function consume_3(op){
  $consume_11(this, op);
}
;
_.getClass$ = function getClass_497(){
  return Lorg_waveprotocol_wave_client_editor_content_LazyPersistenceManager$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$localCorrectionSink = null;
_.val$outgoingSink = null;
function $clinit_782(){
  $clinit_782 = nullMethod;
  INSTANCE_6 = new NodeEventRouter_0;
}

function $handleBackspace(this$static, node, event_0){
  return $isAtBeginning(event_0.caret)?$handleBackspaceAtBeginning_0(this$static, node, event_0):$handleBackspaceNotAtBeginning(this$static, node, event_0);
}

function $handleBackspaceAfterNode(this$static, node, event_0){
  var element;
  element = node.asElement();
  if (!!element && dynamicCast(element, 187).nodeEventHandler.handleBackspaceAfterNode(element, event_0)) {
    return true;
  }
   else {
    if (!!element && !element.firstChild_0) {
      !!element.indexingContainer && $deleteNode(element.context.this$0.mutableContent, element);
      return true;
    }
     else {
      $setToEnd(event_0.caret, node);
      return $isAtBeginning(event_0.caret)?$handleBackspaceAtBeginning_0(this$static, node, event_0):$handleBackspaceNotAtBeginning(this$static, node, event_0);
    }
  }
}

function $handleBackspaceAtBeginning_0(this$static, node, event_0){
  var element;
  element = node.asElement();
  return !!element && dynamicCast(element, 187).nodeEventHandler.handleBackspaceAtBeginning(element, event_0) || $handleBackspace(this$static, $setToBefore(event_0.caret, node).container, event_0);
}

function $handleBackspaceNotAtBeginning(this$static, node, event_0){
  var childBefore, element;
  element = node.asElement();
  if (!element) {
    return handleTextNodeDeleteAction(node.asText(), event_0, true);
  }
   else if (dynamicCast(element, 187).nodeEventHandler.handleBackspaceNotAtBeginning(element, event_0)) {
    return true;
  }
   else {
    childBefore = $getNodeBefore(event_0.caret, ($clinit_758() , INSTANCE_5));
    return !!childBefore && $handleBackspaceAfterNode(this$static, childBefore, event_0);
  }
}

function $handleClick(this$static, node, event_0){
  var element, parent_0;
  element = node.asElement();
  if (!!element && dynamicCast(element, 187).nodeEventHandler.handleClick(element, event_0)) {
    return true;
  }
   else {
    parent_0 = node.parent_0;
    if (!!parent_0 && $handleClick(this$static, parent_0, event_0)) {
      return true;
    }
     else {
      event_0.shouldAllowDefault = true;
      return false;
    }
  }
}

function $handleDelete(this$static, node, event_0){
  var element, element_0;
  element = node.asElement();
  return !!element && dynamicCast(element, 187).nodeEventHandler.handleDelete(element, event_0) || ($isAtEnd(event_0.caret)?(element_0 = node.asElement() , !!element_0 && dynamicCast(element_0, 187).nodeEventHandler.handleDeleteAtEnd(element_0, event_0) || $handleDelete(this$static, $setToAfter(event_0.caret, node).container, event_0)):$handleDeleteNotAtEnd(this$static, node, event_0));
}

function $handleDeleteBeforeNode(this$static, node, event_0){
  var element;
  element = node.asElement();
  if (!!element && dynamicCast(element, 187).nodeEventHandler.handleDeleteBeforeNode(element, event_0)) {
    return true;
  }
   else {
    if (!!element && !node.getFirstChild()) {
      !!element.indexingContainer && $deleteNode(element.context.this$0.mutableContent, element);
      return true;
    }
     else {
      $setToBeginning(event_0.caret, node);
      return $handleDelete(this$static, node, event_0);
    }
  }
}

function $handleDeleteNotAtEnd(this$static, node, event_0){
  var child, element;
  element = node.asElement();
  if (!element) {
    return handleTextNodeDeleteAction(node.asText(), event_0, false);
  }
   else if (dynamicCast(element, 187).nodeEventHandler.handleDeleteNotAtEnd(element, event_0)) {
    return true;
  }
   else {
    child = event_0.caret.nodeAfter;
    return !!child && $handleDeleteBeforeNode(this$static, child, event_0);
  }
}

function $handleEnter(this$static, node, event_0){
  var element, parent_0;
  element = node.asElement();
  if (!!element && dynamicCast(element, 187).nodeEventHandler.handleEnter(element, event_0)) {
    return true;
  }
   else {
    parent_0 = node.parent_0;
    !!parent_0 && event_0.caret.container == node && $maybeMoveOut(event_0.caret);
    return !!parent_0 && $handleEnter(this$static, parent_0, event_0);
  }
}

function $handleLeft(this$static, node, event_0){
  var caret, child, element;
  element = node.asElement();
  if (!!element && dynamicCast(element, 187).nodeEventHandler.handleLeft(element, event_0)) {
    return true;
  }
   else {
    caret = event_0.caret;
    if (caret.offset >= 0?caret.offset == 0:caret.nodeAfter == caret.container.getFirstChild()) {
      if ($handleLeftAtBeginning(this$static, caret.container, event_0)) {
        return true;
      }
       else {
        event_0.shouldAllowDefault = true;
        return false;
      }
    }
     else {
      child = $getNodeBefore(caret, ($clinit_758() , INSTANCE_5));
      if (!!child && $handleLeftAfterNode(child, event_0)) {
        return true;
      }
       else {
        event_0.shouldAllowDefault = true;
        return false;
      }
    }
  }
}

function $handleLeftAfterNode(node, event_0){
  var element;
  element = node.asElement();
  if (!!element && dynamicCast(element, 187).nodeEventHandler.handleLeftAfterNode(element, event_0)) {
    return true;
  }
   else {
    event_0.shouldAllowDefault = true;
    return false;
  }
}

function $handleLeftAtBeginning(this$static, node, event_0){
  var element;
  element = node.asElement();
  if (!!element && dynamicCast(element, 187).nodeEventHandler.handleLeftAtBeginning(element, event_0)) {
    return true;
  }
   else {
    if ($handleLeft(this$static, $setToBefore(event_0.caret, node).container, event_0)) {
      return true;
    }
     else {
      event_0.shouldAllowDefault = true;
      return false;
    }
  }
}

function $handleRight(this$static, node, event_0){
  var caret, child, element;
  element = node.asElement();
  if (!!element && dynamicCast(element, 187).nodeEventHandler.handleRight(element, event_0)) {
    return true;
  }
   else {
    caret = event_0.caret;
    if (caret.offset >= 0?caret.offset == dynamicCast(caret.container, 190).data_0.length:!caret.nodeAfter) {
      if ($handleRightAtEnd(this$static, caret.container, event_0)) {
        return true;
      }
       else {
        event_0.shouldAllowDefault = true;
        return false;
      }
    }
     else if (node.isTextNode()) {
      event_0.shouldAllowDefault = true;
      return false;
    }
     else {
      child = caret.nodeAfter;
      if (!!child && $handleRightBeforeNode(child, event_0)) {
        return true;
      }
       else {
        event_0.shouldAllowDefault = true;
        return false;
      }
    }
  }
}

function $handleRightAtEnd(this$static, node, event_0){
  var element;
  element = node.asElement();
  if (!!element && dynamicCast(element, 187).nodeEventHandler.handleRightAtEnd(element, event_0)) {
    return true;
  }
   else {
    if ($handleRight(this$static, $setToAfter(event_0.caret, node).container, event_0)) {
      return true;
    }
     else {
      event_0.shouldAllowDefault = true;
      return false;
    }
  }
}

function $handleRightBeforeNode(node, event_0){
  var element;
  element = node.asElement();
  if (!!element && dynamicCast(element, 187).nodeEventHandler.handleRightBeforeNode(element, event_0)) {
    return true;
  }
   else {
    event_0.shouldAllowDefault = true;
    return false;
  }
}

function NodeEventRouter_0(){
}

function handleTextNodeDeleteAction(node, event_0, isBackSpace){
  var $e0, a_0, b, caret, e1, implDataLength, filteredHtml, next, next_0;
  try {
    implDataLength = (next = (next_0 = checkNodeAndNeighbour(node) , !next_0?null:next_0.getImplNodelet()) , filteredHtml = node.context.this$0.renderingConcerns.this$0.filteredHtmlView , sumTextNodesLength(node.implNodelet, next, filteredHtml));
    implDataLength <= 1 && $flush_4(node.context.this$0.editingConcerns.getTypingExtractor());
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 171)) {
      e1 = $e0;
      $handleMissing(node.context.this$0.renderingConcerns.this$0.repairer, e1);
      return true;
    }
     else 
      throw $e0;
  }
  if (!$isContentAttached(node)) {
    return true;
  }
  if (node.data_0.length <= 1) {
    $deleteRange_0(node.context.this$0.mutableContent, new Point$Tx_0(node, 0), new Point$Tx_0(node, 1));
  }
   else {
    caret = $asPoint(event_0.caret);
    if (isBackSpace) {
      a_0 = new Point$Tx_0(dynamicCast(caret.container, 163), $getTextOffset(caret) - 1);
      b = caret;
    }
     else {
      a_0 = caret;
      b = new Point$Tx_0(dynamicCast(caret.container, 163), $getTextOffset(caret) + 1);
    }
    $deleteRange_0(node.context.this$0.mutableContent, a_0, b);
  }
  return true;
}

function NodeEventRouter(){
}

_ = NodeEventRouter_0.prototype = NodeEventRouter.prototype = new Object_0;
_.getClass$ = function getClass_498(){
  return Lorg_waveprotocol_wave_client_editor_content_NodeEventRouter_2_classLit;
}
;
_.castableTypeMap$ = {};
var INSTANCE_6;
function $clinit_783(){
  $clinit_783 = nullMethod;
  INSTANCE_7 = new NullRenderer_0;
}

function NullRenderer_0(){
}

function NullRenderer(){
}

_ = NullRenderer_0.prototype = NullRenderer.prototype = new Object_0;
_.createDomImpl = function createDomImpl_11(element){
  return null;
}
;
_.getClass$ = function getClass_499(){
  return Lorg_waveprotocol_wave_client_editor_content_NullRenderer_2_classLit;
}
;
_.castableTypeMap$ = {177:1};
var INSTANCE_7;
function $clinit_785(){
  $clinit_785 = nullMethod;
  paintDataDomain = new PainterRegistryImpl$1_0;
}

function $registerBoundaryFunction(this$static, dependentKeys, function_$){
  var modifying;
  modifying = dynamicCast($modify_0(this$static.data_0), 184);
  modifying.keys.backend.addAll(dependentKeys.backend);
  $add_11(modifying.boundaryFuncs, function_$);
}

function $registerPaintFunction(this$static, dependentKeys, function_$){
  var modifying;
  modifying = dynamicCast($modify_0(this$static.data_0), 184);
  modifying.keys.backend.addAll(dependentKeys.backend);
  $add_11(modifying.paintFuncs, function_$);
}

function PainterRegistryImpl_0(painter){
  $clinit_785();
  checkNotNull_1(painter, 'Null painter');
  this.data_0 = new ChainedData_0(paintDataDomain);
  this.painter = painter;
  this.paintTagName = 'l:s';
  this.boundaryTagName = 'l:b';
}

function PainterRegistryImpl(){
}

_ = PainterRegistryImpl_0.prototype = PainterRegistryImpl.prototype = new Object_0;
_.getClass$ = function getClass_500(){
  return Lorg_waveprotocol_wave_client_editor_content_PainterRegistryImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.boundaryTagName = null;
_.data_0 = null;
_.paintTagName = null;
_.painter = null;
var paintDataDomain;
function PainterRegistryImpl$1_0(){
}

function PainterRegistryImpl$1(){
}

_ = PainterRegistryImpl$1_0.prototype = PainterRegistryImpl$1.prototype = new Object_0;
_.empty = function empty_0(){
  return new PainterRegistryImpl$PaintData_0;
}
;
_.getClass$ = function getClass_501(){
  return Lorg_waveprotocol_wave_client_editor_content_PainterRegistryImpl$1_2_classLit;
}
;
_.readOnlyView = function readOnlyView_0(modifiable){
  return dynamicCast(modifiable, 184);
}
;
_.castableTypeMap$ = {};
function PainterRegistryImpl$PaintData_0(){
  this.boundaryFuncs = new HashSet_0;
  this.paintFuncs = new HashSet_0;
  this.keys = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringSetAdapter_0(new HashSet_0));
}

function PainterRegistryImpl$PaintData(){
}

_ = PainterRegistryImpl$PaintData_0.prototype = PainterRegistryImpl$PaintData.prototype = new Object_0;
_.getClass$ = function getClass_502(){
  return Lorg_waveprotocol_wave_client_editor_content_PainterRegistryImpl$PaintData_2_classLit;
}
;
_.castableTypeMap$ = {184:1};
function applyModifier(range, modifier){
  var anchor, focus_0;
  return anchor = transformLocation(modifier, range.anchor) , focus_0 = transformLocation(modifier, range.focus_0) , new FocusedRange_0(anchor, focus_0);
}

function RegistriesImpl_0(elementHandlerRegistry, annotationHandlerRegistry, paintRegistry){
  this.elementHandlerRegistry = elementHandlerRegistry;
  this.annotationHandlerRegistry = annotationHandlerRegistry;
  this.paintRegistry = paintRegistry;
}

function RegistriesImpl(){
}

_ = RegistriesImpl_0.prototype = RegistriesImpl.prototype = new Object_0;
_.getClass$ = function getClass_503(){
  return Lorg_waveprotocol_wave_client_editor_content_RegistriesImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.annotationHandlerRegistry = null;
_.elementHandlerRegistry = null;
_.paintRegistry = null;
function $matchesSelectionTextNodes(this$static, nodelet, affectedAfterOffset){
  if (!this$static.savedSelection) {
    return false;
  }
  if ($isOrdered(this$static.savedSelection)) {
    if (nodelet == this$static.savedSelectionAnchorTextNodelet) {
      return this$static.savedSelectionAnchorOffset > affectedAfterOffset;
    }
     else if (nodelet == this$static.savedSelectionFocusTextNodelet) {
      return true;
    }
  }
   else {
    if (nodelet == this$static.savedSelectionFocusTextNodelet) {
      return this$static.savedSelectionFocusOffset > affectedAfterOffset;
    }
     else if (nodelet == this$static.savedSelectionAnchorTextNodelet) {
      return true;
    }
  }
  return false;
}

function $maybeUpdateNodeOffsets(this$static, nodelet, affectedAfterOffset, newNodelet, offsetDifference){
  if (nodelet == this$static.savedSelectionAnchorTextNodelet && this$static.savedSelectionAnchorOffset > affectedAfterOffset) {
    this$static.savedSelectionAnchorOffset += offsetDifference;
    this$static.savedSelectionAnchorTextNodelet = newNodelet;
  }
  if (nodelet == this$static.savedSelectionFocusTextNodelet && this$static.savedSelectionFocusOffset > affectedAfterOffset) {
    this$static.savedSelectionFocusOffset += offsetDifference;
    this$static.savedSelectionFocusTextNodelet = newNodelet;
  }
}

function $restoreSelection(this$static, modifier){
  --this$static.savedSelectionDepth;
  if (!!this$static.editingConcerns && this$static.savedSelectionDepth == 0) {
    try {
      if (this$static.savedSelection) {
        this$static.needToRestoreSelection |= false;
        if (this$static.needToRestoreSelection || ($clinit_973() , true)) {
          !!modifier && (this$static.savedSelection = applyModifier(this$static.savedSelection, modifier));
          $log_0(($clinit_672() , logger_1).traceLogger, 'Restoring selection');
          $size_10(this$static.document_0) >= 4 && $setSelectionRange(this$static.editingConcerns.getSelectionHelper(), this$static.savedSelection);
        }
         else {
          $log_0(($clinit_672() , logger_1).traceLogger, 'Not restoring selection');
        }
      }
    }
     finally {
      this$static.savedSelection = null;
      this$static.savedSelectionAnchorTextNodelet = null;
      this$static.savedSelectionAnchorOffset = 0;
      this$static.savedSelectionFocusTextNodelet = null;
      this$static.savedSelectionFocusOffset = 0;
    }
  }
}

function $saveSelection_0(this$static){
  var helper;
  if (!!this$static.editingConcerns && this$static.savedSelectionDepth == 0) {
    this$static.needToRestoreSelection = false;
    helper = this$static.editingConcerns.getSelectionHelper();
    !!helper && get_14();
  }
  ++this$static.savedSelectionDepth;
}

function $textNodeletAffected(this$static, nodelet, affectedAfterOffset, insertionAmount, changeType){
  if (this$static.needToRestoreSelection) {
    return;
  }
  switch (changeType.ordinal) {
    case 0:
      $matchesSelectionTextNodes(this$static, nodelet, affectedAfterOffset)?(this$static.needToRestoreSelection = true):$maybeUpdateNodeOffsets(this$static, nodelet, affectedAfterOffset, nodelet, insertionAmount);
      return;
    case 1:
      $matchesSelectionTextNodes(this$static, nodelet, affectedAfterOffset) && ($clinit_515() , this$static.needToRestoreSelection = true);
      return;
    case 3:
      return;
    case 2:
    case 4:
      (nodelet == this$static.savedSelectionAnchorTextNodelet || nodelet == this$static.savedSelectionFocusTextNodelet) && (this$static.needToRestoreSelection = true);
      return;
  }
}

function SelectionMaintainer_0(document_0){
  this.document_0 = document_0;
}

function SelectionMaintainer(){
}

_ = SelectionMaintainer_0.prototype = SelectionMaintainer.prototype = new Object_0;
_.getClass$ = function getClass_504(){
  return Lorg_waveprotocol_wave_client_editor_content_SelectionMaintainer_2_classLit;
}
;
_.castableTypeMap$ = {};
_.document_0 = null;
_.editingConcerns = null;
_.needToRestoreSelection = false;
_.savedSelection = null;
_.savedSelectionAnchorOffset = 0;
_.savedSelectionAnchorTextNodelet = null;
_.savedSelectionDepth = 0;
_.savedSelectionFocusOffset = 0;
_.savedSelectionFocusTextNodelet = null;
function $clinit_794(){
  $clinit_794 = nullMethod;
  DATA = new SelectionMaintainer$TextNodeChangeType_0('DATA', 0);
  SPLIT = new SelectionMaintainer$TextNodeChangeType_0('SPLIT', 1);
  MOVE = new SelectionMaintainer$TextNodeChangeType_0('MOVE', 2);
  REMOVE = new SelectionMaintainer$TextNodeChangeType_0('REMOVE', 3);
  REPLACE_DATA = new SelectionMaintainer$TextNodeChangeType_0('REPLACE_DATA', 4);
  $VALUES_22 = initValues(_3Lorg_waveprotocol_wave_client_editor_content_SelectionMaintainer$TextNodeChangeType_2_classLit, {58:1, 138:1}, 84, [DATA, SPLIT, MOVE, REMOVE, REPLACE_DATA]);
}

function SelectionMaintainer$TextNodeChangeType_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_23(){
  $clinit_794();
  return $VALUES_22;
}

function SelectionMaintainer$TextNodeChangeType(){
}

_ = SelectionMaintainer$TextNodeChangeType_0.prototype = SelectionMaintainer$TextNodeChangeType.prototype = new Enum;
_.getClass$ = function getClass_505(){
  return Lorg_waveprotocol_wave_client_editor_content_SelectionMaintainer$TextNodeChangeType_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 84:1};
var $VALUES_22, DATA, MOVE, REMOVE, REPLACE_DATA, SPLIT;
function $clinit_796(){
  $clinit_796 = nullMethod;
  PERMITTED_ATTRIBUTES = newStringSet(initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['alt', 'height', 'width', 'src']));
  RENDERER = new ImgDoodad$ImgRenderer_0;
}

function register_9(registry){
  $clinit_796();
  $registerRenderingMutationHandler(registry, 'img', RENDERER);
  $registerEventHandler(registry, 'img', ($clinit_554() , $clinit_554() , INSTANCE_4));
}

var PERMITTED_ATTRIBUTES, RENDERER;
function ImgDoodad$ImgRenderer_0(){
}

function ImgDoodad$ImgRenderer(){
}

_ = ImgDoodad$ImgRenderer_0.prototype = ImgDoodad$ImgRenderer.prototype = new RenderingMutationHandler;
_.createDomImpl = function createDomImpl_12(element){
  var imgTag;
  imgTag = $doc.createElement('img');
  imgTag.setAttribute('contentEditable', 'false');
  return imgTag;
}
;
_.getClass$ = function getClass_506(){
  return Lorg_waveprotocol_wave_client_editor_content_img_ImgDoodad$ImgRenderer_2_classLit;
}
;
_.onActivationStart = function onActivationStart_8(element){
  $each_2(element.attributes, new RenderingMutationHandler$1_0(this, element));
}
;
_.onAttributeModified = function onAttributeModified_8(element, name_0, oldValue, newValue){
  $contains_7(($clinit_796() , PERMITTED_ATTRIBUTES), name_0) && (newValue == null?(element.implNodelet.removeAttribute(name_0) , undefined):(element.implNodelet.setAttribute(name_0, newValue) , undefined));
}
;
_.castableTypeMap$ = {177:1, 179:1};
function $clinit_798(){
  $clinit_798 = nullMethod;
  EVENT_HANDLER = new AnnotationBoundaryRenderer$1_0;
}

function AnnotationBoundaryRenderer_0(){
  $clinit_798();
}

function AnnotationBoundaryRenderer(){
}

_ = AnnotationBoundaryRenderer_0.prototype = AnnotationBoundaryRenderer.prototype = new Object_0;
_.createDomImpl = function createDomImpl_13(element){
  var nodelet;
  nodelet = $doc.createElement('span');
  nodelet.setAttribute('contentEditable', 'false');
  $setContainerNodelet(element, nodelet);
  return nodelet;
}
;
_.getClass$ = function getClass_507(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_AnnotationBoundaryRenderer_2_classLit;
}
;
_.castableTypeMap$ = {177:1};
var EVENT_HANDLER;
function AnnotationBoundaryRenderer$1_0(){
  $clinit_554();
}

function AnnotationBoundaryRenderer$1(){
}

_ = AnnotationBoundaryRenderer$1_0.prototype = AnnotationBoundaryRenderer$1.prototype = new NodeEventHandlerImpl;
_.getClass$ = function getClass_508(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_AnnotationBoundaryRenderer$1_2_classLit;
}
;
_.handleBackspaceAfterNode = function handleBackspaceAfterNode_1(element, event_0){
  return false;
}
;
_.handleDeleteBeforeNode = function handleDeleteBeforeNode_1(element, event_0){
  return false;
}
;
_.castableTypeMap$ = {180:1};
function getRangePrecedingElement(doc, element, key){
  $getLocation_3(doc.doc, element);
  return getRangePrecedingLocation(doc, $getLocation_3(doc.doc, element), key);
}

function getRangePrecedingLocation(doc, end, key){
  var attemptsLeft, currentAnnotation, start;
  currentAnnotation = null;
  attemptsLeft = 3;
  while (end > 0 && (currentAnnotation = $getAnnotation_2(doc.doc, end - 1, key)) == null && attemptsLeft >= 0) {
    --end;
    --attemptsLeft;
  }
  if (currentAnnotation == null) {
    return null;
  }
  start = $lastAnnotationChange_2(doc.doc, 0, end, key, currentAnnotation);
  return new Range_2(start, end);
}

function $clinit_801(){
  $clinit_801 = nullMethod;
  mutationHandlerRegistry = new HashMap_0;
  eventHandlerRegistry = new HashMap_0;
}

function register_10(registry){
  var mutable;
  $clinit_801();
  var boundaryRenderer, paintRenderer;
  paintRenderer = new AnnotationSpreadRenderer_0;
  mutable = dynamicCast($modify_0(registry.data_0), 151);
  $put_5(mutable.renderers, 'l:s', paintRenderer);
  $put_5(mutable.mutationHandlers, 'l:s', paintRenderer);
  $registerNiceHtmlRenderer(registry, 'l:s', ($clinit_899() , SHALLOW_CLONE_RENDERER));
  boundaryRenderer = new AnnotationBoundaryRenderer_0;
  $put_5(dynamicCast($modify_0(registry.data_0), 151).renderers, 'l:b', boundaryRenderer);
  $registerEventHandler(registry, 'l:b', ($clinit_798() , EVENT_HANDLER));
}

var eventHandlerRegistry, mutationHandlerRegistry;
--></script>
<script><!--
function $applyAttribute(element, name_0, newValue){
  var $e0, implNodelet, scrubbedValue, scheme, implNodelet_0;
  implNodelet = element.implNodelet;
  if ($equals_3(name_0, 'link')) {
    if (newValue != null) {
      scrubbedValue = (scheme = extractScheme(newValue) , scheme == null || $equalsIgnoreCase('http', scheme) || $equalsIgnoreCase('https', scheme) || $equalsIgnoreCase('mailto', scheme) || $equalsIgnoreCase('ftp', scheme))?newValue:'#';
      implNodelet.setAttribute('href', scrubbedValue);
      scrubbedValue.indexOf('#') == 0?(implNodelet.removeAttribute('target') , undefined):(implNodelet.setAttribute('target', '_blank') , undefined);
    }
     else {
      implNodelet.removeAttribute('href');
    }
  }
   else if ($equals_3(name_0, 'mouseListener')) {
    implNodelet_0 = element.implNodelet;
    newValue == null?null:throwClassCastExceptionUnlessNull(($clinit_801() , eventHandlerRegistry).get(newValue));
    implNodelet_0.__listener = null;
    sinkEvents(implNodelet_0, (implNodelet_0.__eventBits || 0) & -126);
  }
   else {
    try {
      implNodelet.style[name_0] = newValue;
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 4)) {
        $log_0(($clinit_672() , logger_1).errorLogger, 'Failed to set CSS property ' + name_0 + ' -> ' + newValue);
      }
       else 
        throw $e0;
    }
  }
}

function $maybeConvertToAnchor(element, toAnchor){
  var isAnchor, newNodelet, nodelet;
  nodelet = element.implNodelet;
  isAnchor = $equalsIgnoreCase(nodelet.tagName, 'a');
  if (isAnchor != toAnchor) {
    nodelet.__listener = null;
    sinkEvents(nodelet, (nodelet.__eventBits || 0) & -126);
    newNodelet = createHtml(toAnchor);
    replaceElement(nodelet, newNodelet);
    $setImplNodelets(element, newNodelet, newNodelet);
  }
}

function $onAttributeModified_3(element, name_0, newValue){
  if ($equals_3(name_0, 'link')) {
    $maybeConvertToAnchor(element, newValue != null);
    $each_2(element.attributes, new AnnotationSpreadRenderer$2_0(element));
  }
   else {
    $applyAttribute(element, name_0, newValue);
  }
}

function $onRemovedFromParent_0(element, newParent){
  if (newParent) {
    return;
  }
  $removeListener(element.implNodelet);
}

function $removeListener(implNodelet){
  implNodelet.__listener = null;
  sinkEvents(implNodelet, (implNodelet.__eventBits || 0) & -126);
}

function AnnotationSpreadRenderer_0(){
  this.mutatedElements = new HashSet_0;
  this.mutationNotificationTask = new AnnotationSpreadRenderer$1_0(this);
}

function createHtml(isAnchor){
  var e;
  e = isAnchor?$doc.createElement('a'):$doc.createElement('span');
  e.setAttribute('x', 'y');
  return e;
}

function getMutationHandler(element){
  var handlerId;
  handlerId = dynamicCast($get_12(element.attributes, 'mutationListener'), 1);
  return handlerId == null?null:throwClassCastExceptionUnlessNull(($clinit_801() , mutationHandlerRegistry).get(handlerId));
}

function AnnotationSpreadRenderer(){
}

_ = AnnotationSpreadRenderer_0.prototype = AnnotationSpreadRenderer.prototype = new RenderingMutationHandler;
_.createDomImpl = function createDomImpl_14(element){
  return $setAutoAppendContainer(element, createHtml(false));
}
;
_.getClass$ = function getClass_509(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_AnnotationSpreadRenderer_2_classLit;
}
;
_.onActivationStart = function onActivationStart_9(element){
  $each_2(element.attributes, new RenderingMutationHandler$1_0(this, element));
}
;
_.onAttributeModified = function onAttributeModified_9(element, name_0, oldValue, newValue){
  $onAttributeModified_3(element, name_0, newValue);
}
;
_.onDescendantsMutated = function onDescendantsMutated_4(element){
  var scheduler;
  getMutationHandler(element);
  scheduler = (!instance_6 && (instance_6 = new BrowserBackedScheduler_0 , setDefaultTimerService() , undefined) , instance_6);
  $get_2(scheduler.taskInfos.backend, this.mutationNotificationTask) != null || $scheduleDelayed(scheduler, ($clinit_1013() , MEDIUM), this.mutationNotificationTask, 200);
}
;
_.onRemovedFromParent = function onRemovedFromParent_2(element, newParent){
  $onRemovedFromParent_0(element, newParent);
}
;
_.castableTypeMap$ = {177:1, 179:1};
function AnnotationSpreadRenderer$1_0(this$0){
  this.this$0 = this$0;
}

function AnnotationSpreadRenderer$1(){
}

_ = AnnotationSpreadRenderer$1_0.prototype = AnnotationSpreadRenderer$1.prototype = new Object_0;
_.execute = function execute_18(){
  var context, element, element$iterator, outerIter, entry;
  for (element$iterator = (outerIter = $keySet(this.this$0.mutatedElements.map).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter)); element$iterator.val$outerIter.hasNext();) {
    element = dynamicCast((entry = dynamicCast(element$iterator.val$outerIter.next_0(), 66) , entry.getKey()), 152);
    context = element.context;
    if (!context.this$0.editingConcerns.hasEditor()) {
      continue;
    }
    getMutationHandler(element);
  }
  this.this$0.mutatedElements.map.clear();
}
;
_.getClass$ = function getClass_510(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_AnnotationSpreadRenderer$1_2_classLit;
}
;
_.castableTypeMap$ = {209:1, 210:1};
_.this$0 = null;
function AnnotationSpreadRenderer$2_0(val$element){
  this.val$element = val$element;
}

function AnnotationSpreadRenderer$2(){
}

_ = AnnotationSpreadRenderer$2_0.prototype = AnnotationSpreadRenderer$2.prototype = new Object_0;
_.apply_0 = function apply_10(key, value){
  $applyAttribute(this.val$element, key, dynamicCast(value, 1));
}
;
_.getClass$ = function getClass_511(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_AnnotationSpreadRenderer$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$element = null;
function $clinit_805(){
  $clinit_805 = nullMethod;
  CAPTION_EVENT_HANDLER = new Caption$1_0;
}

function register_11(registry){
  $clinit_805();
  var renderer;
  $registerEventHandler(registry, 'caption', CAPTION_EVENT_HANDLER);
  renderer = new ParagraphRenderer_0(new Caption$2_0);
  $put_5(dynamicCast($modify_0(registry.data_0), 151).mutationHandlers, 'caption', renderer);
  $put_5(dynamicCast($modify_0(registry.data_0), 151).renderers, 'caption', renderer);
}

var CAPTION_EVENT_HANDLER;
function Caption$1_0(){
  $clinit_554();
}

function Caption$1(){
}

_ = Caption$1_0.prototype = Caption$1.prototype = new LinoTextEventHandler;
_.getClass$ = function getClass_512(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_Caption$1_2_classLit;
}
;
_.onActivated = function onActivated_2(element){
  $clinit_811();
  $put_3(element.transientData, EDIT_MODE_LISTENER_PROP.id_0, ($clinit_815() , $clinit_815() , INSTANCE_9));
}
;
_.castableTypeMap$ = {180:1};
function Caption$2_0(){
  $clinit_619();
  this.implTagName = 'div';
}

function Caption$2(){
}

_ = Caption$2_0.prototype = Caption$2.prototype = new DefaultParagraphHtmlRenderer;
_.createNodelet = function createNodelet_1(element){
  var e;
  e = $doc.createElement(this.implTagName);
  e.className = 'w-caption';
  return e;
}
;
_.getClass$ = function getClass_513(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_Caption$2_2_classLit;
}
;
_.castableTypeMap$ = {177:1};
function $buildAnnotationEnds(this$static, b){
  var key, key$iterator, outerIter, entry;
  for (key$iterator = (outerIter = $keySet(this$static.annotations).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter)); key$iterator.val$outerIter.hasNext();) {
    key = dynamicCast((entry = dynamicCast(key$iterator.val$outerIter.next_0(), 66) , entry.getKey()), 1);
    $add_9(b.mutationList, new Nindo$EndAnnotation_0(key));
  }
  this$static.annotations.clear();
}

function $buildAnnotationStarts(this$static, b){
  var entry, entry$iterator;
  for (entry$iterator = this$static.annotations.entrySet_0().iterator_0(); entry$iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.next_0(), 66);
    $add_9(b.mutationList, new Nindo$StartAnnotation_0(dynamicCast(entry.getKey(), 1), dynamicCast(entry.getValue(), 1)));
  }
}

function $isAnnotated(this$static, key, value){
  var current;
  current = this$static.annotations.containsKey(key)?dynamicCast(this$static.annotations.get(key), 1):this$static.resolver?$getAnnotation_0(this$static.resolver, key):null;
  return current == null?value == null:$equals_3(current, value);
}

function CaretAnnotations_0(){
  this.annotations = new HashMap_0;
}

function CaretAnnotations(){
}

_ = CaretAnnotations_0.prototype = CaretAnnotations.prototype = new Object_0;
_.getClass$ = function getClass_514(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_CaretAnnotations_2_classLit;
}
;
_.castableTypeMap$ = {};
_.resolver = null;
function $clinit_810(){
  $clinit_810 = nullMethod;
  $clinit_554();
  INSTANCE_8 = new ChunkyElementHandler_0;
}

function ChunkyElementHandler_0(){
}

function ChunkyElementHandler(){
}

_ = ChunkyElementHandler_0.prototype = ChunkyElementHandler.prototype = new NodeEventHandlerImpl;
_.getClass$ = function getClass_515(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_ChunkyElementHandler_2_classLit;
}
;
_.handleBackspaceAfterNode = function handleBackspaceAfterNode_2(element, event_0){
  $deleteNode(element.context.this$0.mutableContent, element);
  return true;
}
;
_.handleDeleteBeforeNode = function handleDeleteBeforeNode_2(element, event_0){
  $deleteNode(element.context.this$0.mutableContent, element);
  return true;
}
;
_.handleLeftAfterNode = function handleLeftAfterNode_1(element, event_0){
  placeCaretBeforeElement(element.context.this$0.editingConcerns.getSelectionHelper(), element);
  return true;
}
;
_.handleRightBeforeNode = function handleRightBeforeNode_1(element, event_0){
  placeCaretAfterElement(element.context.this$0.editingConcerns.getSelectionHelper(), element);
  return true;
}
;
_.castableTypeMap$ = {180:1};
var INSTANCE_8;
function $clinit_811(){
  $clinit_811 = nullMethod;
  EDIT_MODE_LISTENER_PROP = new Property$ImmutableProperty_0('display_edit_mode');
}

function getListener(node){
  $clinit_811();
  var e;
  e = node;
  return e?dynamicCast(e.transientData.backend.get(valueOf_0(EDIT_MODE_LISTENER_PROP.id_0)), 194):null;
}

function onEditModeChange(node, isEditing){
  var implNodelet;
  $clinit_811();
  var listener;
  listener = getListener(node);
  !!node && !!listener && (implNodelet = node.containerNodelet , !!implNodelet && (implNodelet.setAttribute('contentEditable', isEditing?'true':'false') , implNodelet.style['white-space'] = 'pre-wrap' , implNodelet) , undefined);
}

var EDIT_MODE_LISTENER_PROP;
function $clinit_813(){
  $clinit_813 = nullMethod;
  renderFunc = new StyleAnnotationHandler$1_0;
  KEYS_0 = newStringSet(initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['style/backgroundColor', 'style/color', 'style/fontFamily', 'style/fontSize', 'style/fontStyle', 'style/fontWeight', 'style/textDecoration', 'style/verticalAlign']));
}

function StyleAnnotationHandler_0(painter){
  this.painter = painter;
}

function StyleAnnotationHandler(){
}

_ = StyleAnnotationHandler_0.prototype = StyleAnnotationHandler.prototype = new Object_0;
_.getClass$ = function getClass_516(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_StyleAnnotationHandler_2_classLit;
}
;
_.handleAnnotationChange = function handleAnnotationChange_1(bundle, start, end, key, newValue){
  $scheduleRepaint(this.painter, bundle, start, end);
}
;
_.castableTypeMap$ = {246:1};
_.painter = null;
var KEYS_0, renderFunc;
function StyleAnnotationHandler$1_0(){
}

function StyleAnnotationHandler$1(){
}

_ = StyleAnnotationHandler$1_0.prototype = StyleAnnotationHandler$1.prototype = new Object_0;
_.apply_1 = function apply_11(from, isEditing){
  var entry, entry$iterator, map;
  map = new HashMap_0;
  for (entry$iterator = from.entrySet_0().iterator_0(); entry$iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.next_0(), 66);
    dynamicCast(entry.getKey(), 1).indexOf('style/') == 0 && map.put(($clinit_813() , $substring(dynamicCast(entry.getKey(), 1), 6)), dynamicCast(entry.getValue(), 1));
  }
  return map;
}
;
_.getClass$ = function getClass_517(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_StyleAnnotationHandler$1_2_classLit;
}
;
_.castableTypeMap$ = {185:1};
function $clinit_815(){
  $clinit_815 = nullMethod;
  INSTANCE_9 = new UpdateContentEditable_0;
}

function UpdateContentEditable_0(){
}

function UpdateContentEditable(){
}

_ = UpdateContentEditable_0.prototype = UpdateContentEditable.prototype = new Object_0;
_.getClass$ = function getClass_518(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_UpdateContentEditable_2_classLit;
}
;
_.castableTypeMap$ = {194:1};
var INSTANCE_9;
function $clinit_816(){
  $clinit_816 = nullMethod;
  LINE_0 = new Property$ImmutableProperty_0('line');
  FIRST_LINE = new Property$MutableProperty_0('fline');
}

function Line_0(cxt, lineElement){
  $clinit_816();
  this.cxt = cxt;
  this.lineElement = lineElement;
  this.paragraph = $transparentCreate_0(cxt.this$0.fullContentView, 'l:p', cxt.this$0.mutableContent.doc.substrate.getAttributes(lineElement), lineElement.parent_0, lineElement.next);
  $clinit_745();
  $setProperty_1(HARD, ($clinit_697() , this.paragraph), HARD);
  lineElement.transientData.backend.put(valueOf_0(LINE_0.id_0), this);
  this.paragraph.transientData.backend.put(valueOf_0(LINE_0.id_0), this);
}

function Line(){
}

_ = Line_0.prototype = Line.prototype = new Object_0;
_.getClass$ = function getClass_519(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_Line_2_classLit;
}
;
_.toString$ = function toString_45(){
  return 'Line(' + createNode(($clinit_758() , INSTANCE_5), this.lineElement).builder.impl.string + ', ' + this.cachedNumberValue + ')';
}
;
_.castableTypeMap$ = {195:1};
_.cachedNumberValue = -1;
_.cxt = null;
_.lineElement = null;
_.next = null;
_.paragraph = null;
_.previous = null;
var FIRST_LINE, LINE_0;
function $handleNewChild(this$static, container, child){
  var before, cxt, element, line, paragraph, previousDirectSibling, previousLine, previousPersistentSibling, previousFirst, e;
  if (this$static.nested) {
    return;
  }
  this$static.nested = true;
  try {
    cxt = container.context;
    element = child.asElement();
    if (!!element && ($clinit_819() , $equals_3('line', element.tagName_0))) {
      line = new Line_0(cxt, element);
      previousDirectSibling = child.prev;
      previousPersistentSibling = dynamicCast(container.context.this$0.mutableContent.doc.substrate.getPreviousSibling(child), 163);
      if (!previousPersistentSibling) {
        previousFirst = ($clinit_816() , dynamicCast(container.transientData.backend.get(valueOf_0(FIRST_LINE.id_0)), 195));
        !!previousFirst && (checkNotNull_1(previousFirst, 'Next line must not be null') , line.next = previousFirst , line.previous = line.next.previous , line.next.previous = line , !!line.previous && (line.previous.next = line) , undefined);
        $put_3(container.transientData, FIRST_LINE.id_0, line);
      }
       else {
        element.parent_0 == container?(previousLine = ($clinit_816() , dynamicCast(previousDirectSibling.asElement().transientData.backend.get(valueOf_0(LINE_0.id_0)), 195))):(previousLine = ($clinit_816() , dynamicCast(element.parent_0.transientData.backend.get(valueOf_0(LINE_0.id_0)), 195)));
        checkNotNull_1(previousLine, 'Previous line must not be null');
        line.previous = previousLine;
        line.next = line.previous.next;
        line.previous.next = line;
        !!line.next && (line.next.previous = line);
      }
      paragraph = line.paragraph;
      if (element.parent_0 != container) {
        $transparentMove(cxt.this$0.fullContentView, paragraph, dynamicCast(paragraph.next, 163), dynamicCast(null, 163), null);
        $transparentMove_0(cxt.this$0.fullContentView, container, paragraph, null, element.parent_0.next);
        $transparentMove_0(cxt.this$0.fullContentView, container, element, null, paragraph);
      }
    }
     else {
      before = child.prev;
      paragraph = !before?null:(e = before.asElement() , !!e && $equals_3(e.tagName_0, 'l:p')?e:null);
      !!paragraph && $transparentMove_0(cxt.this$0.fullContentView, paragraph, child, child.next, null);
    }
  }
   finally {
    this$static.nested = false;
  }
}

function $handleRemovedChild(this$static, container, child){
  var cxt, element, line, previousLine;
  if (this$static.nested) {
    return;
  }
  if ($isContentAttached(child)) {
    $log_0(($clinit_672() , logger_1).errorLogger, 'Node was moved and not removed?');
    return;
  }
  this$static.nested = true;
  try {
    cxt = container.context;
    element = child.asElement();
    if (!!element && ($clinit_819() , $equals_3('line', element.tagName_0))) {
      line = ($clinit_816() , dynamicCast(element.transientData.backend.get(valueOf_0(LINE_0.id_0)), 195));
      if (line.paragraph.firstChild_0) {
        previousLine = line.previous;
        previousLine?($transparentMove(cxt.this$0.fullContentView, previousLine.paragraph, dynamicCast(line.paragraph.firstChild_0, 163), dynamicCast(null, 163), null) , undefined):$transparentUnwrap(cxt.this$0.fullContentView, line.paragraph);
      }
      !!line.paragraph.parent_0 && $transparentDeepRemove(line.cxt.this$0.fullContentView, line.paragraph);
      !!line.next && (line.next.previous = line.previous);
      !!line.previous && (line.previous.next = line.next);
      line.previous = line.next = null;
    }
  }
   finally {
    this$static.nested = false;
  }
}

function LineContainerParagraphiser_0(){
  this.lineHandler = new LineContainerParagraphiser$LineHandler_0(this);
}

function LineContainerParagraphiser(){
}

_ = LineContainerParagraphiser_0.prototype = LineContainerParagraphiser.prototype = new NodeMutationHandlerImpl;
_.getClass$ = function getClass_520(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_LineContainerParagraphiser_2_classLit;
}
;
_.onChildAdded = function onChildAdded_2(container, child){
  ($clinit_819() , !child.isTextNode() && $equals_3(dynamicCast(child, 152).tagName_0, 'line')) || $handleNewChild(this, container, child);
}
;
_.onChildRemoved = function onChildRemoved_2(element, child){
  $handleRemovedChild(this, element, child);
}
;
_.castableTypeMap$ = {179:1, 188:1};
_.nested = false;
function $onAttributeModified_4(element, name_0, newValue){
  if (!($clinit_816() , dynamicCast(element.transientData.backend.get(valueOf_0(LINE_0.id_0)), 195))) {
    return;
  }
  $transparentSetAttribute_0(dynamicCast(element.transientData.backend.get(valueOf_0(LINE_0.id_0)), 195).paragraph, name_0, newValue);
}

function LineContainerParagraphiser$LineHandler_0(this$0){
  this.this$0 = this$0;
}

function LineContainerParagraphiser$LineHandler(){
}

_ = LineContainerParagraphiser$LineHandler_0.prototype = LineContainerParagraphiser$LineHandler.prototype = new RenderingMutationHandler;
_.createDomImpl = function createDomImpl_15(element){
  return null;
}
;
_.getClass$ = function getClass_521(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_LineContainerParagraphiser$LineHandler_2_classLit;
}
;
_.onActivationStart = function onActivationStart_10(element){
  $each_2(element.attributes, new RenderingMutationHandler$1_0(this, element));
}
;
_.onAddedToParent = function onAddedToParent_5(element, oldParent){
  $handleNewChild(this.this$0, dynamicCast(element.context.this$0.mutableContent.doc.substrate.getParentElement(element), 152), element);
}
;
_.onAttributeModified = function onAttributeModified_10(element, name_0, oldValue, newValue){
  $onAttributeModified_4(element, name_0, newValue);
}
;
_.castableTypeMap$ = {177:1, 179:1, 188:1};
_.this$0 = null;
function $clinit_819(){
  $clinit_819 = nullMethod;
  DEFAULT_PARAGRAPHISER = new LineContainerParagraphiser_0;
  DEFAULT_RENDERER = new LineRendering$1_0;
  DEFAULT_PARAGRAPH_EVENT_HANDLER = new LocalParagraphEventHandler_0;
}

function registerContainer(containerTagName, registry){
  $clinit_819();
  $clinit_1384();
  $add_11(lineContainerTagnames, containerTagName);
  $registerMutationHandler(registry, containerTagName, DEFAULT_PARAGRAPHISER);
  $registerRenderer(registry, containerTagName, DEFAULT_RENDERER);
  $registerNiceHtmlRenderer(registry, containerTagName, ($clinit_899() , SHALLOW_CLONE_RENDERER));
}

function registerLines(registry){
  $clinit_819();
  $registerRenderingMutationHandler(registry, 'l:p', ($clinit_827() , DEFAULT_RENDERER_0));
  $registerEventHandler(registry, 'l:p', DEFAULT_PARAGRAPH_EVENT_HANDLER);
  $registerNiceHtmlRenderer(registry, 'l:p', DEFAULT_NICE_HTML_RENDERER);
  $registerRenderingMutationHandler(registry, 'line', DEFAULT_PARAGRAPHISER.lineHandler);
}

var DEFAULT_PARAGRAPHISER, DEFAULT_PARAGRAPH_EVENT_HANDLER, DEFAULT_RENDERER;
function LineRendering$1_0(){
}

function LineRendering$1(){
}

_ = LineRendering$1_0.prototype = LineRendering$1.prototype = new Object_0;
_.createDomImpl = function createDomImpl_16(element){
  var e;
  e = $doc.createElement('ul');
  e.style['padding'] = 0 + ($clinit_68() , 'px');
  e.style['margin'] = '0px';
  return $setContainerNodelet(element, e) , e;
}
;
_.getClass$ = function getClass_522(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_LineRendering$1_2_classLit;
}
;
_.castableTypeMap$ = {177:1};
function $handleBackspaceAtBeginning_1(paragraph){
  var line, lineElement;
  line = ($clinit_816() , dynamicCast(paragraph.transientData.backend.get(valueOf_0(LINE_0.id_0)), 195));
  lineElement = line.lineElement;
  if ((!line.lineElement?0:getIndent(dynamicCast($get_12(line.lineElement.attributes, 'i'), 1))) > 0) {
    indent_3(lineElement, -1);
  }
   else {
    switch (of(dynamicCast($get_12(line.lineElement.attributes, 't'), 1)).ordinal) {
      case 2:
        $setElementAttribute(lineElement.context.this$0.mutableContent, lineElement, 't', null);
        $setElementAttribute(lineElement.context.this$0.mutableContent, lineElement, 'listyle', null);
        break;
      default:$maybeRemove(line);
    }
  }
  return true;
}

function $maybeRemove(line){
  var at, attrs, doc, lineElement, needsAdjusting, prevLineElement, prevParagraph, previousLine;
  doc = line.cxt.this$0.mutableContent;
  lineElement = line.lineElement;
  previousLine = line.previous;
  if (previousLine) {
    prevLineElement = previousLine.lineElement;
    prevParagraph = previousLine.paragraph;
    if (maskUndefined(doc.doc.substrate.getNextSibling(prevLineElement)) === (lineElement == null?null:lineElement)) {
      attrs = doc.doc.substrate.getAttributes(lineElement);
      $setElementAttributes(doc, prevLineElement, new AttributesImpl_1(attrs));
    }
    at = $getLocation_0(doc, new Point$El_0(prevParagraph, null));
    needsAdjusting = !prevParagraph.firstChild_0;
    $deleteNode(doc, lineElement);
    needsAdjusting?$setCaret_0(lineElement.context.this$0.editingConcerns.getSelectionHelper(), new Point$El_0(prevParagraph, doc.doc.substrate.getFirstChild_0(prevParagraph))):$setCaret_0(lineElement.context.this$0.editingConcerns.getSelectionHelper(), $locate_0(doc.doc, at));
  }
}

function LocalParagraphEventHandler_0(){
  $clinit_554();
}

function LocalParagraphEventHandler(){
}

_ = LocalParagraphEventHandler_0.prototype = LocalParagraphEventHandler.prototype = new NodeEventHandlerImpl;
_.getClass$ = function getClass_523(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_LocalParagraphEventHandler_2_classLit;
}
;
_.handleBackspaceAtBeginning = function handleBackspaceAtBeginning_4(paragraph, event_0){
  return $handleBackspaceAtBeginning_1(paragraph);
}
;
_.handleDeleteAtEnd = function handleDeleteAtEnd_4(p, event_0){
  var line;
  line = ($clinit_816() , dynamicCast(p.transientData.backend.get(valueOf_0(LINE_0.id_0)), 195));
  !!line.next && $maybeRemove(line.next);
  return true;
}
;
_.handleEnter = function handleEnter_2(element, event_0){
  var contentPoint, currentAttrs, doc, entry, entry$iterator, line, newLineElement, newLocalParagraph, point, secondAttrs, doc_0, lineElement, next;
  contentPoint = event_0.caret;
  if (contentPoint.offset < 0 && contentPoint.container != element) {
    return true;
  }
  point = contentPoint.offset >= 0?new Point$Tx_0(contentPoint.container, contentPoint.offset):new Point$El_0(contentPoint.container, contentPoint.nodeAfter);
  point.offset >= 0?dynamicCast(point.container, 163):dynamicCast(nodeBefore_0(($clinit_758() , INSTANCE_5), point.asElementPoint()), 163);
  line = ($clinit_816() , dynamicCast(element.transientData.backend.get(valueOf_0(LINE_0.id_0)), 195));
  if (of(dynamicCast($get_12(element.attributes, 't'), 1)) == ($clinit_837() , LIST) && (lineElement = dynamicCast(element.transientData.backend.get(valueOf_0(LINE_0.id_0)), 195).lineElement , doc_0 = lineElement.context.this$0.mutableContent , next = dynamicCast(doc_0.doc.substrate.getNextSibling(lineElement), 163) , !next || !!next.asElement() && ($clinit_819() , $equals_3('line', next.asElement().tagName_0)))) {
    return $handleBackspaceAtBeginning_1(element);
  }
  secondAttrs = new HashMap_0;
  doc = element.context.this$0.mutableContent;
  currentAttrs = line.cxt.this$0.mutableContent.doc.substrate.getAttributes(line.lineElement);
  if (currentAttrs) {
    for (entry$iterator = currentAttrs.entrySet_0().iterator_0(); entry$iterator.hasNext();) {
      entry = dynamicCast(entry$iterator.next_0(), 66);
      attributeKeptOnNewline(dynamicCast(entry.getKey(), 1), dynamicCast(entry.getValue(), 1)) && secondAttrs.put(dynamicCast(entry.getKey(), 1), dynamicCast(entry.getValue(), 1));
    }
  }
  secondAttrs.size_0() == 0 && (secondAttrs = ($clinit_1145() , EMPTY_MAP_0));
  newLineElement = dynamicCast($createElement_1(doc, $locate(doc, (checkNotNull_1(point, 'getLocation: Null point') , $getLocation_4(doc.doc, point))), secondAttrs), 152);
  newLocalParagraph = dynamicCast(newLineElement.transientData.backend.get(valueOf_0(LINE_0.id_0)), 195).paragraph;
  $setCaret_0(element.context.this$0.editingConcerns.getSelectionHelper(), start_5(element.context.this$0.renderingConcerns.this$0.renderedContentView, newLocalParagraph));
  return true;
}
;
_.castableTypeMap$ = {180:1};
function $markDirty(this$static, paraElement, oldIndent){
  var indent;
  indent = getIndent(oldIndent);
  (!$containsKey_0(this$static.dirtyElements.backend, paraElement) || dynamicCast($get_2(this$static.dirtyElements.backend, paraElement), 63).value_0 > indent) && $put_2(this$static.dirtyElements, paraElement, valueOf_0(indent));
}

function $markDirty_0(this$static, paraElement, indent){
  (!$containsKey_0(this$static.dirtyElements.backend, paraElement) || dynamicCast($get_2(this$static.dirtyElements.backend, paraElement), 63).value_0 > indent) && $put_2(this$static.dirtyElements, paraElement, valueOf_0(indent));
}

function $markRemoved(this$static, elem){
  var line, next;
  line = ($clinit_816() , dynamicCast(elem.transientData.backend.get(valueOf_0(LINE_0.id_0)), 195));
  if (!line) {
    return;
  }
  next = line.next;
  !!next && $markDirty_0(this$static, next.paragraph, $containsKey_0(this$static.dirtyElements.backend, line.paragraph)?min_0(!line.lineElement?0:getIndent(dynamicCast($get_12(line.lineElement.attributes, 'i'), 1)), dynamicCast($get_2(this$static.dirtyElements.backend, line.paragraph), 63).value_0):!line.lineElement?0:getIndent(dynamicCast($get_12(line.lineElement.attributes, 'i'), 1)));
}

function $minIndent(this$static, line){
  return min_0(!line.lineElement?0:getIndent(dynamicCast($get_12(line.lineElement.attributes, 'i'), 1)), dynamicCast($get_2(this$static.dirtyElements.backend, line.paragraph), 63).value_0);
}

function $renumber(this$static, aroundLine){
  var importance, line, minimumIndent, startingLine, startingNumber;
  if (!aroundLine.paragraph.implNodelet) {
    $remove_6(this$static.dirtyElements.backend, aroundLine.paragraph);
    return;
  }
  minimumIndent = min_0(!aroundLine.lineElement?0:getIndent(dynamicCast($get_12(aroundLine.lineElement.attributes, 'i'), 1)), dynamicCast($get_2(this$static.dirtyElements.backend, aroundLine.paragraph), 63).value_0);
  startingLine = aroundLine;
  startingNumber = 1;
  line = aroundLine;
  while (line) {
    importance = importance_0(minimumIndent, isDecimalListItem(line.paragraph), !line.lineElement?0:getIndent(dynamicCast($get_12(line.lineElement.attributes, 'i'), 1)));
    if (importance == ($clinit_826() , MATCH)) {
      if (line.cachedNumberValue != -1) {
        startingLine = line;
        startingNumber = line.cachedNumberValue;
        break;
      }
    }
     else if (importance == SUPERIOR) {
      break;
    }
    startingLine = line;
    line = line.previous;
  }
  $renumberRange(this$static, startingLine, minimumIndent, startingNumber);
}

function $renumberAll(this$static){
  var data, data$iterator, line, lines, docIds, list, nextDocId;
  lines = (list = new ArrayList_0 , nextDocId = initDim(_3I_classLit, {58:1}, -1, 1, 1) , docIds = ($clinit_1445() , $clinit_1445() , new CollectionUtils$IdentityHashMapAdapter_0) , $each(this$static.dirtyElements, new OrderedListRenumberer$1_0(this$static, docIds, nextDocId, list)) , sort_1(list) , list);
  for (data$iterator = new AbstractList$IteratorImpl_0(lines); data$iterator.i < data$iterator.this$0_0.size_0();) {
    data = dynamicCast($next_6(data$iterator), 196);
    line = data.line;
    $containsKey_0(this$static.dirtyElements.backend, line.paragraph) && $renumber(this$static, line);
  }
  $clearImpl(this$static.dirtyElements.backend);
}

--></script>
<script><!--
function $renumberRange(this$static, startingLine, minimumIndent, startingNumber){
  var currentIndent, isNumbered, line, num, numbers;
  line = startingLine;
  currentIndent = !startingLine.lineElement?0:getIndent(dynamicCast($get_12(startingLine.lineElement.attributes, 'i'), 1));
  numbers = new OrderedListRenumberer$LevelNumbers_0(currentIndent, startingNumber);
  while (line) {
    currentIndent = !line.lineElement?0:getIndent(dynamicCast($get_12(line.lineElement.attributes, 'i'), 1));
    isNumbered = isDecimalListItem(line.paragraph);
    $setLevel(numbers, currentIndent);
    if (importance_0(minimumIndent, isNumbered, currentIndent) == ($clinit_826() , SUPERIOR) && line != startingLine) {
      break;
    }
    if (isNumbered) {
      num = numbers.numbers[numbers.currentLevel]++;
      if (line.cachedNumberValue != num) {
        line.cachedNumberValue = num;
        line.paragraph.implNodelet.setAttribute('value', '' + num);
      }
    }
     else {
      numbers.numbers[numbers.currentLevel] = 1;
    }
    $remove_6(this$static.dirtyElements.backend, line.paragraph);
    line = line.next;
  }
}

function OrderedListRenumberer_0(){
  this.dirtyElements = ($clinit_1445() , $clinit_1445() , new CollectionUtils$IdentityHashMapAdapter_0);
}

function importance_0(relativeToIndent, isNumberedItem, indent){
  if (indent == relativeToIndent && isNumberedItem) {
    return $clinit_826() , MATCH;
  }
  if (indent <= relativeToIndent) {
    return $clinit_826() , SUPERIOR;
  }
  return $clinit_826() , INFERIOR;
}

function OrderedListRenumberer(){
}

_ = OrderedListRenumberer_0.prototype = OrderedListRenumberer.prototype = new Object_0;
_.getClass$ = function getClass_524(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer_2_classLit;
}
;
_.castableTypeMap$ = {};
function $apply_3(this$static, paraElement){
  var docId, line, mapper;
  line = $isContentAttached(paraElement)?($clinit_816() , dynamicCast(paraElement.transientData.backend.get(valueOf_0(LINE_0.id_0)), 195)):null;
  if (line) {
    line.cachedNumberValue = -1;
    mapper = paraElement.context.this$0.indexedDoc;
    if ($containsKey_0(this$static.val$docIds.backend, mapper)) {
      docId = dynamicCast($get_2(this$static.val$docIds.backend, mapper), 63).value_0;
    }
     else {
      docId = this$static.val$nextDocId[0]++;
      $put_2(this$static.val$docIds, mapper, valueOf_0(docId));
    }
    $add_9(this$static.val$list, new OrderedListRenumberer$ComparableLine_0(line, docId, $minIndent(this$static.this$0, line), $getLocation_3(mapper, line.lineElement)));
  }
}

function OrderedListRenumberer$1_0(this$0, val$docIds, val$nextDocId, val$list){
  this.this$0 = this$0;
  this.val$docIds = val$docIds;
  this.val$nextDocId = val$nextDocId;
  this.val$list = val$list;
}

function OrderedListRenumberer$1(){
}

_ = OrderedListRenumberer$1_0.prototype = OrderedListRenumberer$1.prototype = new Object_0;
_.apply_4 = function apply_12(paraElement, oldIndent){
  $apply_3(this, dynamicCast(paraElement, 152), dynamicCast(oldIndent, 63));
}
;
_.getClass$ = function getClass_525(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$docIds = null;
_.val$list = null;
_.val$nextDocId = null;
function $compareTo_7(this$static, d2){
  if (this$static.docId != d2.docId) {
    return this$static.docId - d2.docId;
  }
  if (this$static.minIndent != d2.minIndent) {
    return this$static.minIndent - d2.minIndent;
  }
  return this$static.location_0 - d2.location_0;
}

function OrderedListRenumberer$ComparableLine_0(line, docId, minIndent, location_0){
  this.line = line;
  this.docId = docId;
  this.minIndent = minIndent;
  this.location_0 = location_0;
}

function OrderedListRenumberer$ComparableLine(){
}

_ = OrderedListRenumberer$ComparableLine_0.prototype = OrderedListRenumberer$ComparableLine.prototype = new Object_0;
_.compareTo$ = function compareTo_9(d2){
  return $compareTo_7(this, dynamicCast(d2, 196));
}
;
_.getClass$ = function getClass_526(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer$ComparableLine_2_classLit;
}
;
_.castableTypeMap$ = {61:1, 196:1};
_.docId = 0;
_.line = null;
_.location_0 = 0;
_.minIndent = 0;
function $$init_76(this$static){
  var i;
  this$static.numbers = initDim(_3I_classLit, {58:1}, -1, 51, 1);
  for (i = 0; i < this$static.numbers.length; ++i) {
    this$static.numbers[i] = 1;
  }
}

function $setLevel(this$static, level){
  var i;
  for (i = this$static.currentLevel + 1; i <= level; ++i) {
    this$static.numbers[i] = 1;
  }
  this$static.currentLevel = level;
}

function OrderedListRenumberer$LevelNumbers_0(initialLevel, initialNumber){
  $$init_76(this);
  $setLevel(this, initialLevel);
  this.numbers[this.currentLevel] = initialNumber;
}

function OrderedListRenumberer$LevelNumbers(){
}

_ = OrderedListRenumberer$LevelNumbers_0.prototype = OrderedListRenumberer$LevelNumbers.prototype = new Object_0;
_.getClass$ = function getClass_527(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer$LevelNumbers_2_classLit;
}
;
_.toString$ = function toString_46(){
  return 'current=' + this.currentLevel + ', ' + toString__devirtual$(this.numbers);
}
;
_.castableTypeMap$ = {};
_.currentLevel = 0;
function $clinit_826(){
  $clinit_826 = nullMethod;
  SUPERIOR = new OrderedListRenumberer$RelativeImportance_0('SUPERIOR', 0);
  INFERIOR = new OrderedListRenumberer$RelativeImportance_0('INFERIOR', 1);
  MATCH = new OrderedListRenumberer$RelativeImportance_0('MATCH', 2);
  $VALUES_23 = initValues(_3Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer$RelativeImportance_2_classLit, {58:1, 138:1}, 85, [SUPERIOR, INFERIOR, MATCH]);
}

function OrderedListRenumberer$RelativeImportance_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_24(){
  $clinit_826();
  return $VALUES_23;
}

function OrderedListRenumberer$RelativeImportance(){
}

_ = OrderedListRenumberer$RelativeImportance_0.prototype = OrderedListRenumberer$RelativeImportance.prototype = new Enum;
_.getClass$ = function getClass_528(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer$RelativeImportance_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 85:1};
var $VALUES_23, INFERIOR, MATCH, SUPERIOR;
function $clinit_827(){
  $clinit_827 = nullMethod;
  DEFAULT_RENDERER_0 = new ParagraphRenderer_0(new DefaultParagraphHtmlRenderer_0);
  DEFAULT_NICE_HTML_RENDERER = new ParagraphNiceHtmlRenderer_0;
  DEFAULT_EVENT_HANDLER = new ParagraphEventHandler_0;
  INDENTER = new Paragraph$1_0;
  OUTDENTER = new Paragraph$2_0;
}

function getFirstLine(mapper, start){
  $clinit_827();
  var doc, first, point;
  point = (checkPositionIndex(start, mapper.offsetList.root.offset) , $performActionAt(mapper.offsetList, start, mapper.pointFinder));
  doc = dynamicCast(point.container, 163).context.this$0.mutableContent;
  $clinit_1384();
  checkArgument_0(!isUnsupportedParagraphDocument(doc), 'Paragraph docs no longer supported');
  first = dynamicCast(getRelatedLineElement(doc, point), 163);
  if (!first) {
    return null;
  }
  return $clinit_816() , dynamicCast(first.asElement().transientData.backend.get(valueOf_0(LINE_0.id_0)), 195);
}

function getIndent(str){
  $clinit_827();
  var $e0;
  if (str == null) {
    return 0;
  }
  try {
    return min_0(max(0, __parseAndValidateInt(str, 10)), 50);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 147)) {
      return 0;
    }
     else 
      throw $e0;
  }
}

function isDecimalListItem(e){
  $clinit_827();
  return $equals_3('li', dynamicCast($get_12(e.attributes, 't'), 1)) && $equals_3('decimal', dynamicCast($get_12(e.attributes, 'listyle'), 1));
}

function isHeading(node){
  $clinit_827();
  var size, tagName;
  tagName = dynamicCast($get_12(node.attributes, 't'), 1);
  if (tagName != null && tagName.length == 2) {
    if (tagName.charCodeAt(0) == 104 || tagName.charCodeAt(0) == 72) {
      size = tagName.charCodeAt(1) - 48;
      if (size >= 1 && size <= 4) {
        return true;
      }
    }
  }
  return false;
}

function register_13(registry){
  $clinit_827();
  $registerEventHandler(registry, 'p', DEFAULT_EVENT_HANDLER);
  $registerRenderingMutationHandler(registry, 'p', DEFAULT_RENDERER_0);
}

function toggle(mapper, start, end, style){
  var applied;
  $clinit_827();
  traverse(mapper, start, end, new Paragraph$3_0(style, !(applied = initValues(_3Z_classLit, {58:1}, -1, [true, false]) , traverse(mapper, start, end, new Paragraph$4_0(applied, style)) , applied[0] && applied[1])));
}

function traverse(mapper, start, end, action){
  $clinit_827();
  var lineAt, lineTag, position;
  lineAt = getFirstLine(mapper, start);
  if (!lineAt) {
    return;
  }
  while (lineAt) {
    lineTag = lineAt.lineElement;
    position = $getLocation_3(mapper, lineTag);
    if (position >= end) {
      break;
    }
    action.execute_2(lineTag);
    lineAt = lineAt.next;
  }
}

var DEFAULT_EVENT_HANDLER, DEFAULT_NICE_HTML_RENDERER, DEFAULT_RENDERER_0, INDENTER, OUTDENTER;
function Paragraph$1_0(){
}

function Paragraph$1(){
}

_ = Paragraph$1_0.prototype = Paragraph$1.prototype = new Object_0;
_.execute_2 = function execute_19(e){
  indent_3(e, 1);
}
;
_.getClass$ = function getClass_529(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$1_2_classLit;
}
;
_.castableTypeMap$ = {83:1};
function Paragraph$2_0(){
}

function Paragraph$2(){
}

_ = Paragraph$2_0.prototype = Paragraph$2.prototype = new Object_0;
_.execute_2 = function execute_20(e){
  indent_3(e, -1);
}
;
_.getClass$ = function getClass_530(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$2_2_classLit;
}
;
_.castableTypeMap$ = {83:1};
function Paragraph$3_0(val$style, val$isOn){
  this.val$style = val$style;
  this.val$isOn = val$isOn;
}

function Paragraph$3(){
}

_ = Paragraph$3_0.prototype = Paragraph$3.prototype = new Object_0;
_.execute_2 = function execute_21(e){
  this.val$style.apply_6(e, this.val$isOn);
}
;
_.getClass$ = function getClass_531(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$3_2_classLit;
}
;
_.castableTypeMap$ = {83:1};
_.val$isOn = false;
_.val$style = null;
function Paragraph$4_0(val$applied, val$style){
  this.val$applied = val$applied;
  this.val$style = val$style;
}

function Paragraph$4(){
}

_ = Paragraph$4_0.prototype = Paragraph$4.prototype = new Object_0;
_.execute_2 = function execute_22(e){
  this.val$applied[0] &= equal_0(this.val$style.type_0, dynamicCast($get_12(e.attributes, 't'), 1));
  this.val$applied[1] = true;
}
;
_.getClass$ = function getClass_532(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$4_2_classLit;
}
;
_.castableTypeMap$ = {83:1};
_.val$applied = null;
_.val$style = null;
function $clinit_832(){
  $clinit_832 = nullMethod;
  var a_0, a$array, a$index, a$max;
  LEFT_1 = new Paragraph$Alignment_0('LEFT', 0, 'l', 'left');
  RIGHT_1 = new Paragraph$Alignment_0('RIGHT', 1, 'r', 'right');
  CENTER_1 = new Paragraph$Alignment_0('CENTER', 2, 'c', 'center');
  JUSTIFY_0 = new Paragraph$Alignment_0('JUSTIFY', 3, 'j', 'justify');
  $VALUES_24 = initValues(_3Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$Alignment_2_classLit, {58:1, 138:1}, 86, [LEFT_1, RIGHT_1, CENTER_1, JUSTIFY_0]);
  map_0 = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  for (a$array = $VALUES_24 , a$index = 0 , a$max = a$array.length; a$index < a$max; ++a$index) {
    a_0 = a$array[a$index];
    $put_5(map_0, a_0.value_0, a_0);
  }
}

function $apply_4(this$static, e, on){
  $setElementAttribute(e.context.this$0.mutableContent, e, 'a', this$static == LEFT_1?null:on?this$static.value_0:null);
}

function $isApplied(this$static, e){
  var val;
  val = fromValue_0(dynamicCast($get_12(e.attributes, 'a'), 1));
  return this$static == (!val?LEFT_1:val);
}

function Paragraph$Alignment_0(enum$name, enum$ordinal, value, css){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
  this.value_0 = value;
  this.css = css;
}

function fromValue_0(v){
  $clinit_832();
  return v != null?dynamicCast($get_12(map_0, v), 86):null;
}

function values_25(){
  $clinit_832();
  return $VALUES_24;
}

function Paragraph$Alignment(){
}

_ = Paragraph$Alignment_0.prototype = Paragraph$Alignment.prototype = new Enum;
_.apply_6 = function apply_13(e, on){
  $setElementAttribute(e.context.this$0.mutableContent, e, 'a', this == LEFT_1?null:on?this.value_0:null);
}
;
_.execute_2 = function execute_23(e){
  $setElementAttribute(e.context.this$0.mutableContent, e, 'a', this == LEFT_1?null:this.value_0);
}
;
_.getClass$ = function getClass_533(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$Alignment_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 83:1, 86:1, 88:1};
_.css = null;
_.value_0 = null;
var $VALUES_24, CENTER_1, JUSTIFY_0, LEFT_1, RIGHT_1, map_0;
function $clinit_833(){
  $clinit_833 = nullMethod;
  var a_0, a$array, a$index, a$max;
  LTR_0 = new Paragraph$Direction_0('LTR', 0, 'l', 'ltr', ($clinit_832() , LEFT_1), RIGHT_1);
  RTL_0 = new Paragraph$Direction_0('RTL', 1, 'r', 'rtl', RIGHT_1, LEFT_1);
  $VALUES_25 = initValues(_3Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$Direction_2_classLit, {58:1, 138:1}, 87, [LTR_0, RTL_0]);
  map_1 = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  for (a$array = $VALUES_25 , a$index = 0 , a$max = a$array.length; a$index < a$max; ++a$index) {
    a_0 = a$array[a$index];
    $put_5(map_1, a_0.value_0, a_0);
  }
}

function Paragraph$Direction_0(enum$name, enum$ordinal, value, css, alignment, oppositeAlignment){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
  this.value_0 = value;
  this.css = css;
  this.alignment = alignment;
  this.oppositeAlignment = oppositeAlignment;
}

function fromValue_1(v){
  $clinit_833();
  return v != null?dynamicCast($get_12(map_1, v), 87):null;
}

function values_26(){
  $clinit_833();
  return $VALUES_25;
}

function Paragraph$Direction(){
}

_ = Paragraph$Direction_0.prototype = Paragraph$Direction.prototype = new Enum;
_.apply_6 = function apply_14(e, on){
  $setElementAttribute(e.context.this$0.mutableContent, e, 'd', this == LTR_0?null:on?this.value_0:null);
  on && $isApplied(this.oppositeAlignment, e) && $apply_4(this.alignment, e, true);
}
;
_.execute_2 = function execute_24(e){
  $setElementAttribute(e.context.this$0.mutableContent, e, 'd', this == LTR_0?null:this.value_0);
  $isApplied(this.oppositeAlignment, e) && $apply_4(this.alignment, e, true);
}
;
_.getClass$ = function getClass_534(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$Direction_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 83:1, 87:1, 88:1};
_.alignment = null;
_.css = null;
_.oppositeAlignment = null;
_.value_0 = null;
var $VALUES_25, LTR_0, RTL_0, map_1;
function Paragraph$ListStyler_0(type){
  this.type_0 = type;
}

function Paragraph$ListStyler(){
}

_ = Paragraph$ListStyler_0.prototype = Paragraph$ListStyler.prototype = new Object_0;
_.apply_6 = function apply_15(e, isOn){
  $setElementAttribute(e.context.this$0.mutableContent, e, 't', isOn?'li':null);
  $setElementAttribute(e.context.this$0.mutableContent, e, 'listyle', isOn?this.type_0:null);
}
;
_.getClass$ = function getClass_535(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$ListStyler_2_classLit;
}
;
_.castableTypeMap$ = {88:1};
_.type_0 = null;
function Paragraph$RegularStyler_0(type){
  this.type_0 = type;
}

function Paragraph$RegularStyler(){
}

_ = Paragraph$RegularStyler_0.prototype = Paragraph$RegularStyler.prototype = new Object_0;
_.apply_6 = function apply_16(e, isOn){
  $setElementAttribute(e.context.this$0.mutableContent, e, 't', isOn?this.type_0:null);
  $setElementAttribute(e.context.this$0.mutableContent, e, 'listyle', null);
}
;
_.getClass$ = function getClass_536(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$RegularStyler_2_classLit;
}
;
_.castableTypeMap$ = {88:1};
_.type_0 = null;
function $clinit_837(){
  $clinit_837 = nullMethod;
  var i;
  DEFAULT_0 = new ParagraphBehaviour_0('DEFAULT', 0);
  HEADING = new ParagraphBehaviour_0('HEADING', 1);
  LIST = new ParagraphBehaviour_0('LIST', 2);
  $VALUES_26 = initValues(_3Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphBehaviour_2_classLit, {58:1, 138:1}, 89, [DEFAULT_0, HEADING, LIST]);
  subtypeMappings = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  $put_5(subtypeMappings, 'p', DEFAULT_0);
  for (i = 1; i <= 4; ++i) {
    $put_5(subtypeMappings, 'h' + i, HEADING);
  }
  $put_5(subtypeMappings, 'li', LIST);
}

function ParagraphBehaviour_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function of(subtype){
  $clinit_837();
  var b;
  b = dynamicCast($get_12(subtypeMappings, subtype != null?subtype:''), 89);
  return dynamicCast(valueOrDefault(b, DEFAULT_0), 89);
}

function values_27(){
  $clinit_837();
  return $VALUES_26;
}

function ParagraphBehaviour(){
}

_ = ParagraphBehaviour_0.prototype = ParagraphBehaviour.prototype = new Enum;
_.getClass$ = function getClass_537(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphBehaviour_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 89:1};
var $VALUES_26, DEFAULT_0, HEADING, LIST, subtypeMappings;
function $clinit_838(){
  $clinit_838 = nullMethod;
  $clinit_839();
  $clinit_672();
}

function $clinit_839(){
  $clinit_839 = nullMethod;
  $clinit_838();
  BR_REF = ($clinit_962() , $clinit_962() , ++markerIndex , '_x_' + markerIndex + '_br');
}

function $appendSpacer(paragraph){
  var spacer;
  spacer = $getSpacer(paragraph);
  paragraph.appendChild(spacer);
}

function $getSpacer(paragraph){
  var last, spacer;
  last = paragraph.lastChild;
  spacer = paragraph[BR_REF] || null;
  if (!spacer) {
    spacer = $isSpacer(last)?last:$doc.createElement('br');
    $clinit_962();
    spacer[TRANSPARENCY] = ($clinit_1371() , DEEP);
    paragraph[BR_REF] = spacer;
  }
   else if ($isSpacer(last) && last != spacer) {
    !!$getParentElement(spacer) && $removeFromParent(spacer);
    spacer = last;
    $clinit_962();
    spacer[TRANSPARENCY] = ($clinit_1371() , DEEP);
    paragraph[BR_REF] = spacer;
  }
  return spacer;
}

function $isSpacer(n){
  var e;
  if (!n) {
    return false;
  }
  if (n.nodeType == 3) {
    return false;
  }
  e = n;
  return $equals_3(e.tagName.toLowerCase(), 'br') && ($clinit_962() , !(!!e && (e[BACKREF_NAME] || null) != null));
}

var BR_REF;
function $ensureSpacerIfDoesntEndWithText(paragraph){
  var last, spacer;
  last = paragraph.lastChild;
  spacer = $getSpacer(paragraph);
  last == spacer && (last = last.previousSibling);
  !last || last.nodeType == 1?paragraph.appendChild(spacer):$removeFromParent(spacer);
}

function $renderAndAppendParagraph(contentView, dest, child, selectionMatcher){
  var br;
  renderChildren(contentView, dest, child, selectionMatcher);
  br = $doc.createElement('br');
  dest.appendChild(br);
  $maybeNoteHtml(selectionMatcher, child, br);
  return child;
}

function $renderHeadingItem(view, dest, src, selectionMatcher){
  var e, tagName;
  e = $doc.createElement('h' + ($clinit_827() , tagName = dynamicCast($get_12(src.attributes, 't'), 1) , tagName.charCodeAt(1) - 48));
  dest.appendChild(e);
  renderChildren(view, e, src, selectionMatcher);
  $maybeNoteHtml(selectionMatcher, src, e);
  return src;
}

function ParagraphNiceHtmlRenderer_0(){
}

function doInnards(view, dest, src, selectionMatcher){
  renderChildren(view, dest, src, selectionMatcher);
  $maybeNoteHtml(selectionMatcher, src, dest);
}

function ParagraphNiceHtmlRenderer(){
}

_ = ParagraphNiceHtmlRenderer_0.prototype = ParagraphNiceHtmlRenderer.prototype = new Object_0;
_.getClass$ = function getClass_538(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphNiceHtmlRenderer_2_classLit;
}
;
_.renderSequence = function renderSequence(view, firstItem, stopAt, destParent, selectionMatcher){
  var el, helper, indent, isDecimal, node, prev;
  checkArgument_1(firstItem != null && firstItem.castableTypeMap$ && !!firstItem.castableTypeMap$[152], 'firstItem must be an instance of ContentElement ', initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, [firstItem.getClass$()]));
  prev = null;
  helper = new ParagraphNiceHtmlRenderer$HtmlStack_0(destParent);
  for (node = firstItem; !!node && node != stopAt; prev = node , node = dynamicCast(view.getNextSibling(node), 163)) {
    el = dynamicCast(node, 152);
    indent = ($clinit_827() , getIndent(dynamicCast($get_12(el.attributes, 'i'), 1)));
    if (isHeading(el)) {
      $equalsIgnoreCase((helper.elementStack.size == 0?helper.topParent:dynamicCastJso($get_3(helper.elementStack, helper.elementStack.size - 1))).tagName, 'li') && $remove_10(helper.elementStack, helper.elementStack.size - 1);
      $restack(helper, ($clinit_844() , BLOCKQUOTE), indent);
      $renderHeadingItem(view, helper.elementStack.size == 0?helper.topParent:dynamicCastJso($get_3(helper.elementStack, helper.elementStack.size - 1)), el, selectionMatcher);
    }
     else {
      if (($clinit_819() , $equals_3(el.tagName_0, 'l:p')) && $equals_3('li', dynamicCast($get_12(el.attributes, 't'), 1))) {
        isDecimal = $equals_3('li', dynamicCast($get_12(el.attributes, 't'), 1)) && $equals_3('decimal', dynamicCast($get_12(el.attributes, 'listyle'), 1));
        $equalsIgnoreCase((helper.elementStack.size == 0?helper.topParent:dynamicCastJso($get_3(helper.elementStack, helper.elementStack.size - 1))).tagName, 'li') && $remove_10(helper.elementStack, helper.elementStack.size - 1);
        $restack(helper, isDecimal?($clinit_844() , OL):($clinit_844() , UL), indent + 1);
        $push_2(helper, $doc.createElement('li'));
        doInnards(view, helper.elementStack.size == 0?helper.topParent:dynamicCastJso($get_3(helper.elementStack, helper.elementStack.size - 1)), el, selectionMatcher);
      }
       else {
        indent + 1 != helper.elementStack.size && $equalsIgnoreCase((helper.elementStack.size == 0?helper.topParent:dynamicCastJso($get_3(helper.elementStack, helper.elementStack.size - 1))).tagName, 'li') && $remove_10(helper.elementStack, helper.elementStack.size - 1);
        $restack(helper, ($clinit_844() , BLOCKQUOTE), indent);
        $renderAndAppendParagraph(view, helper.elementStack.size == 0?helper.topParent:dynamicCastJso($get_3(helper.elementStack, helper.elementStack.size - 1)), el, selectionMatcher);
      }
    }
  }
  return prev;
}
;
_.castableTypeMap$ = {178:1};
function $push_2(this$static, e){
  (this$static.elementStack.size == 0?this$static.topParent:dynamicCastJso($get_3(this$static.elementStack, this$static.elementStack.size - 1))).appendChild(e);
  $add_9(this$static.elementStack, e);
}

function $restack(this$static, t, indentLevel){
  var depth, i;
  while (indentLevel < this$static.elementStack.size) {
    $remove_10(this$static.elementStack, this$static.elementStack.size - 1);
  }
  depth = indentLevel - this$static.elementStack.size;
  for (i = 0; i < depth; ++i) {
    $push_2(this$static, t.createElement_1());
  }
}

function ParagraphNiceHtmlRenderer$HtmlStack_0(topParent){
  this.elementStack = new ArrayList_0;
  this.topParent = topParent;
}

function ParagraphNiceHtmlRenderer$HtmlStack(){
}

_ = ParagraphNiceHtmlRenderer$HtmlStack_0.prototype = ParagraphNiceHtmlRenderer$HtmlStack.prototype = new Object_0;
_.getClass$ = function getClass_539(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphNiceHtmlRenderer$HtmlStack_2_classLit;
}
;
_.castableTypeMap$ = {};
_.topParent = null;
function $clinit_844(){
  $clinit_844 = nullMethod;
  BLOCKQUOTE = new ParagraphNiceHtmlRenderer$IndentType$1_0;
  UL = new ParagraphNiceHtmlRenderer$IndentType$2_0;
  OL = new ParagraphNiceHtmlRenderer$IndentType$3_0;
  $VALUES_27 = initValues(_3Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphNiceHtmlRenderer$IndentType_2_classLit, {58:1, 138:1}, 90, [BLOCKQUOTE, UL, OL]);
}

function values_28(){
  $clinit_844();
  return $VALUES_27;
}

function ParagraphNiceHtmlRenderer$IndentType(){
}

_ = ParagraphNiceHtmlRenderer$IndentType.prototype = new Enum;
_.getClass$ = function getClass_540(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphNiceHtmlRenderer$IndentType_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 90:1};
var $VALUES_27, BLOCKQUOTE, OL, UL;
function ParagraphNiceHtmlRenderer$IndentType$1_0(){
  this.name_0 = 'BLOCKQUOTE';
  this.ordinal = 0;
}

function ParagraphNiceHtmlRenderer$IndentType$1(){
}

_ = ParagraphNiceHtmlRenderer$IndentType$1_0.prototype = ParagraphNiceHtmlRenderer$IndentType$1.prototype = new ParagraphNiceHtmlRenderer$IndentType;
_.createElement_1 = function createElement_2(){
  return $doc.createElement('blockquote');
}
;
_.getClass$ = function getClass_541(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphNiceHtmlRenderer$IndentType$1_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 90:1};
function ParagraphNiceHtmlRenderer$IndentType$2_0(){
  this.name_0 = 'UL';
  this.ordinal = 1;
}

function ParagraphNiceHtmlRenderer$IndentType$2(){
}

_ = ParagraphNiceHtmlRenderer$IndentType$2_0.prototype = ParagraphNiceHtmlRenderer$IndentType$2.prototype = new ParagraphNiceHtmlRenderer$IndentType;
_.createElement_1 = function createElement_3(){
  return $doc.createElement('ul');
}
;
_.getClass$ = function getClass_542(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphNiceHtmlRenderer$IndentType$2_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 90:1};
function ParagraphNiceHtmlRenderer$IndentType$3_0(){
  this.name_0 = 'OL';
  this.ordinal = 2;
}

function ParagraphNiceHtmlRenderer$IndentType$3(){
}

_ = ParagraphNiceHtmlRenderer$IndentType$3_0.prototype = ParagraphNiceHtmlRenderer$IndentType$3.prototype = new ParagraphNiceHtmlRenderer$IndentType;
_.createElement_1 = function createElement_4(){
  return $doc.createElement('ol');
}
;
_.getClass$ = function getClass_543(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphNiceHtmlRenderer$IndentType$3_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 90:1};
function $onAttributeModified_5(this$static, p, name_0, oldValue, newValue){
  if (!p.implNodelet) {
    return;
  }
  if ($equals_3('t', name_0) || $equals_3('listyle', name_0)) {
    of(newValue);
    $add_19(this$static.elementsToRender, p);
    $scheduleFinally_0(this$static.runner, this$static.batchRenderCommand);
    $scheduleRenumber(this$static, p, dynamicCast($get_12(p.attributes, 'i'), 1));
  }
   else if ($equals_3('i', name_0)) {
    $add_19(this$static.elementsToRender, p);
    $scheduleFinally_0(this$static.runner, this$static.batchRenderCommand);
    $markDirty(this$static.renumberer, p, oldValue);
    this$static.renumberer.dirtyElements.backend.size != 0 && $scheduleFinally_0(this$static.runner, this$static.batchRenderCommand);
  }
   else 
    $equals_3('a', name_0)?($add_19(this$static.elementsToRender, p) , $scheduleFinally_0(this$static.runner, this$static.batchRenderCommand)):$equals_3('d', name_0) && ($add_19(this$static.elementsToRender, p) , $scheduleFinally_0(this$static.runner, this$static.batchRenderCommand));
}

function $scheduleRenumber(this$static, p, oldIndent){
  $markDirty(this$static.renumberer, p, oldIndent);
  this$static.renumberer.dirtyElements.backend.size != 0 && $scheduleFinally_0(this$static.runner, this$static.batchRenderCommand);
}

function ParagraphRenderer_0(htmlRenderer){
  ParagraphRenderer_1.call(this, htmlRenderer, new OrderedListRenumberer_0, new FinalTaskRunnerImpl_0);
}

function ParagraphRenderer_1(htmlRenderer, renumberer, finalTaskRunner){
  this.elementsToRender = ($clinit_1445() , $clinit_1445() , new CollectionUtils$IdentitySetAdapter_0);
  this.batchRenderCommand = new ParagraphRenderer$1_0(this);
  checkNotNull_1(htmlRenderer, 'Null html renderer');
  this.htmlRenderer = htmlRenderer;
  this.renumberer = renumberer;
  this.runner = finalTaskRunner;
}

function ParagraphRenderer(){
}

_ = ParagraphRenderer_0.prototype = ParagraphRenderer.prototype = new RenderingMutationHandler;
_.createDomImpl = function createDomImpl_17(element){
  return $createDomImpl(this.htmlRenderer, element);
}
;
_.getClass$ = function getClass_544(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphRenderer_2_classLit;
}
;
_.onActivatedSubtree = function onActivatedSubtree_0(p){
  $each_2(p.attributes, new RenderingMutationHandler$1_0(this, p));
  !!p.implNodelet && $ensureSpacerIfDoesntEndWithText(($clinit_838() , p).implNodelet);
}
;
_.onAddedToParent = function onAddedToParent_6(element, oldParent){
  $markDirty(this.renumberer, element, dynamicCast($get_12(element.attributes, 'i'), 1));
  this.renumberer.dirtyElements.backend.size != 0 && $scheduleFinally_0(this.runner, this.batchRenderCommand);
}
;
_.onAttributeModified = function onAttributeModified_11(p, name_0, oldValue, newValue){
  $onAttributeModified_5(this, p, name_0, oldValue, newValue);
}
;
_.onChildAdded = function onChildAdded_3(p, child){
  $ensureSpacerIfDoesntEndWithText(($clinit_838() , child.getImplNodelet() , p.implNodelet));
}
;
_.onChildRemoved = function onChildRemoved_3(p, child){
  $ensureSpacerIfDoesntEndWithText(($clinit_838() , child.getImplNodelet() , p.implNodelet));
}
;
_.onEmptied = function onEmptied_2(p){
  p.implNodelet.childNodes.length == 0 && $appendSpacer(($clinit_838() , p.implNodelet));
}
;
--></script>
<script><!--
_.onRemovedFromParent = function onRemovedFromParent_3(element, newParent){
  $markRemoved(this.renumberer, element);
  this.renumberer.dirtyElements.backend.size != 0 && $scheduleFinally_0(this.runner, this.batchRenderCommand);
}
;
_.castableTypeMap$ = {177:1, 179:1};
_.htmlRenderer = null;
_.renumberer = null;
_.runner = null;
function $render(this$static, p){
  var indent;
  if (!p.implNodelet) {
    return;
  }
  indent = getIndent(dynamicCast($get_12(p.attributes, 'i'), 1));
  $clinit_672();
  ++ignoreMutations;
  $saveSelection_0(p.context.this$0.selectionMaintainer);
  $updateRendering(this$static.this$0.htmlRenderer, p, dynamicCast($get_12(p.attributes, 't'), 1), dynamicCast($get_12(p.attributes, 'listyle'), 1), indent, fromValue_0(dynamicCast($get_12(p.attributes, 'a'), 1)), fromValue_1(dynamicCast($get_12(p.attributes, 'd'), 1)));
  $restoreSelection(p.context.this$0.selectionMaintainer, null);
  --ignoreMutations;
}

function ParagraphRenderer$1_0(this$0){
  this.this$0 = this$0;
}

function ParagraphRenderer$1(){
}

_ = ParagraphRenderer$1_0.prototype = ParagraphRenderer$1.prototype = new Object_0;
_.execute = function execute_25(){
  var e;
  while (this.this$0.elementsToRender.backend.size != 0) {
    e = dynamicCast($someElement(this.this$0.elementsToRender), 152);
    $remove_23(this.this$0.elementsToRender, e);
    $render(this, e);
  }
  $renumberAll(this.this$0.renumberer);
}
;
_.getClass$ = function getClass_545(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphRenderer$1_2_classLit;
}
;
_.castableTypeMap$ = {209:1, 210:1};
_.this$0 = null;
function $setEnabled_0(this$static, enabled){
  if (enabled) {
    $add_22(this$static.editorImpl.updateEvent.updateListeners, this$static);
  }
   else {
    $remove_28(this$static.editorImpl.updateEvent.updateListeners, this$static);
    $removeFromParent(this$static.DEBUG_CURSOR);
  }
  this$static.enabled = enabled;
}

function CursorDisplay_0(editorImpl){
  this.DEBUG_CURSOR = $doc.createElement('div');
  this.editorImpl = editorImpl;
  this.DEBUG_CURSOR.textContent = 'o';
  this.DEBUG_CURSOR.style['zIndex'] = '1000';
  this.DEBUG_CURSOR.style['position'] = ($clinit_63() , 'absolute');
}

function CursorDisplay(){
}

_ = CursorDisplay_0.prototype = CursorDisplay.prototype = new Object_0;
_.getClass$ = function getClass_546(){
  return Lorg_waveprotocol_wave_client_editor_debug_CursorDisplay_2_classLit;
}
;
_.onUpdate = function onUpdate(event_0){
  $clinit_973();
}
;
_.castableTypeMap$ = {176:1};
_.editorImpl = null;
_.enabled = false;
function $getAnnotations(this$static){
  var ann, ann$iterator, doc, end, rangedAnnotations, retval;
  doc = this$static.editorImpl.content_0.mutableContent;
  end = $size_10(doc.doc);
  rangedAnnotations = $rangedAnnotations(this$static.editorImpl.content_0.localAnnotations.fullAnnotationSet, 0, end, null);
  retval = new StringBuilder_0;
  for (ann$iterator = new GenericRangedAnnotationIterable$GenericRangedAnnotationIterator_0(rangedAnnotations.a_0, rangedAnnotations.start, rangedAnnotations.end, rangedAnnotations.keys); ann$iterator.entries.heap.size != 0;) {
    ann = $next_25(ann$iterator);
    ann.value_0 != null && $append_8(retval, '(' + ann.start + ',' + ann.end + ') : ' + ann.key + '=' + ann.value_0 + '\n');
  }
  return retval.impl.string;
}

function $initTextArea(area){
  area.element_0['readOnly'] = true;
  $setStyleName(area, getStylePrimaryName(area.element_0) + '-readonly', true);
  area.element_0.rows = 40;
  area.element_0.cols = 80;
}

function $onHide(this$static){
  $remove_28(this$static.editorImpl.updateEvent.updateListeners, this$static.updateListener);
  $showUpdates(this$static.logPanel, false);
}

function $onShow(this$static){
  switch (this$static.previousSelection.ordinal) {
    case 1:
    case 0:
    case 2:
    case 3:
      $add_22(this$static.editorImpl.updateEvent.updateListeners, this$static.updateListener);
      $onUpdate_0(this$static.updateListener);
      $showUpdates(this$static.logPanel, false);
      break;
    case 4:
      $showUpdates(this$static.logPanel, true);
      $remove_28(this$static.editorImpl.updateEvent.updateListeners, this$static.updateListener);
  }
}

function $setChecked_0(this$static, button){
  $setValue_1(button, ($clinit_382() , $clinit_382() , TRUE));
  button == this$static.domButton?$setNewSelection_0(this$static, ($clinit_856() , DOM_0)):button == this$static.localXmlButton?$setNewSelection_0(this$static, ($clinit_856() , LOCAL_XML)):button == this$static.persistenDocumentButton?$setNewSelection_0(this$static, ($clinit_856() , PERSISTENT_DOCUMENT)):button == this$static.annotationButton?$setNewSelection_0(this$static, ($clinit_856() , ANNOTATIONS)):button == this$static.logButton?$setNewSelection_0(this$static, ($clinit_856() , LOG_0)):button == this$static.optionsButton && $setNewSelection_0(this$static, ($clinit_856() , OPTIONS));
}

function $setNewSelection_0(this$static, selection){
  switch (this$static.previousSelection.ordinal) {
    case 1:
      $remove_0(this$static.mainPanel, this$static.dom);
      break;
    case 0:
      $remove_0(this$static.mainPanel, this$static.localXml);
      break;
    case 2:
      $remove_0(this$static.mainPanel, this$static.persistenDocumentContent);
      break;
    case 3:
      $remove_0(this$static.mainPanel, this$static.annotationContent);
      break;
    case 4:
      $removeFromParent(this$static.logPanel.logContainer);
      break;
    case 5:
      $remove_0(this$static.mainPanel, this$static.debugOptions.panel);
  }
  switch (selection.ordinal) {
    case 1:
      $add_2(this$static.mainPanel, this$static.dom);
      break;
    case 0:
      $add_2(this$static.mainPanel, this$static.localXml);
      break;
    case 2:
      $add_2(this$static.mainPanel, this$static.persistenDocumentContent);
      break;
    case 3:
      $add_2(this$static.mainPanel, this$static.annotationContent);
      break;
    case 4:
      $attachTo(this$static.logPanel, this$static.mainPanel.element_0);
      break;
    case 5:
      $refresh(this$static.debugOptions);
      $add_2(this$static.mainPanel, this$static.debugOptions.panel);
  }
  this$static.previousSelection = selection;
  $onShow(this$static);
}

function DebugDialog_0(editorImpl){
  this.dom = new TextArea_1;
  this.localXml = new TextArea_1;
  this.persistenDocumentContent = new TextArea_1;
  this.annotationContent = new TextArea_1;
  this.mainPanel = new FlowPanel_0;
  this.groupName = '__debug_dialog_selector_' + radioId++;
  this.domButton = new RadioButton_1(this.groupName, ($clinit_856() , DOM_0).displayName);
  this.localXmlButton = new RadioButton_1(this.groupName, LOCAL_XML.displayName);
  this.persistenDocumentButton = new RadioButton_1(this.groupName, PERSISTENT_DOCUMENT.displayName);
  this.annotationButton = new RadioButton_1(this.groupName, ANNOTATIONS.displayName);
  this.logButton = new RadioButton_1(this.groupName, LOG_0.displayName);
  this.optionsButton = new RadioButton_1(this.groupName, OPTIONS.displayName);
  this.radioButtonHandler = new DebugDialog$1_0(this);
  this.logPanel = new DebugDialog$LogPanel_0(($clinit_542() , logbuffer));
  this.updateListener = new DebugDialog$2_0(this);
  this.editorImpl = editorImpl;
  this.debugOptions = new DebugOptions_0(editorImpl);
  $initWidget(this, this.mainPanel);
  $add_2(this.mainPanel, this.domButton);
  $add_2(this.mainPanel, this.localXmlButton);
  $add_2(this.mainPanel, this.persistenDocumentButton);
  $add_2(this.mainPanel, this.annotationButton);
  $add_2(this.mainPanel, this.logButton);
  $add_2(this.mainPanel, this.optionsButton);
  this.mainPanel.element_0.insertBefore($doc.createElement('br'), null);
  this.previousSelection = PERSISTENT_DOCUMENT;
  $addDomHandler(this.domButton, this.radioButtonHandler, ($clinit_94() , $clinit_94() , TYPE_1));
  $addDomHandler(this.localXmlButton, this.radioButtonHandler, TYPE_1);
  $addDomHandler(this.persistenDocumentButton, this.radioButtonHandler, TYPE_1);
  $addDomHandler(this.annotationButton, this.radioButtonHandler, TYPE_1);
  $addDomHandler(this.logButton, this.radioButtonHandler, TYPE_1);
  $addDomHandler(this.optionsButton, this.radioButtonHandler, TYPE_1);
  $initTextArea(this.dom);
  $initTextArea(this.localXml);
  $initTextArea(this.persistenDocumentContent);
  $initTextArea(this.annotationContent);
  $setChecked_0(this, this.persistenDocumentButton);
}

function DebugDialog(){
}

_ = DebugDialog_0.prototype = DebugDialog.prototype = new Composite;
_.getClass$ = function getClass_547(){
  return Lorg_waveprotocol_wave_client_editor_debug_DebugDialog_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
_.debugOptions = null;
_.editorImpl = null;
_.previousSelection = null;
var radioId = 0;
function DebugDialog$1_0(this$0){
  this.this$0 = this$0;
}

function DebugDialog$1(){
}

_ = DebugDialog$1_0.prototype = DebugDialog$1.prototype = new Object_0;
_.getClass$ = function getClass_548(){
  return Lorg_waveprotocol_wave_client_editor_debug_DebugDialog$1_2_classLit;
}
;
_.onClick = function onClick_3(e){
  $setChecked_0(this.this$0, dynamicCast(e.source, 197));
}
;
_.castableTypeMap$ = {8:1, 25:1};
_.this$0 = null;
function $onUpdate_0(this$static){
  switch (this$static.this$0.previousSelection.ordinal) {
    case 1:
      $setText_2(this$static.this$0.dom, formatImplDomString(this$static.this$0.editorImpl));
      break;
    case 0:
      $setText_2(this$static.this$0.localXml, formatContentDomString(this$static.this$0.editorImpl));
      break;
    case 2:
      $setText_2(this$static.this$0.persistenDocumentContent, formatPersistentDomString(this$static.this$0.editorImpl));
      break;
    case 3:
      $setText_2(this$static.this$0.annotationContent, $getAnnotations(this$static.this$0));
  }
}

function DebugDialog$2_0(this$0){
  this.this$0 = this$0;
}

function DebugDialog$2(){
}

_ = DebugDialog$2_0.prototype = DebugDialog$2.prototype = new Object_0;
_.getClass$ = function getClass_549(){
  return Lorg_waveprotocol_wave_client_editor_debug_DebugDialog$2_2_classLit;
}
;
_.onUpdate = function onUpdate_0(dummy){
  $onUpdate_0(this);
}
;
_.castableTypeMap$ = {176:1};
_.this$0 = null;
function $appendLogLine(this$static, line){
  var element;
  element = $doc.createElement('div');
  element.innerHTML = line || '';
  element.style['borderBottomStyle'] = 'dotted';
  element.style['borderWidth'] = 1 + ($clinit_68() , 'px');
  element.style['borderColor'] = '#c0c0c0';
  this$static.logContainer.appendChild(element);
  this$static.lastElement = element;
}

function $attachTo(this$static, el){
  el.appendChild(this$static.logContainer);
}

function $fillContent(this$static){
  var s, s$iterator, strs;
  this$static.logContainer.innerHTML = '';
  strs = $showAll(this$static.log);
  for (s$iterator = new AbstractList$IteratorImpl_0(strs); s$iterator.i < s$iterator.this$0_0.size_0();) {
    s = dynamicCast($next_6(s$iterator), 1);
    $appendLogLine(this$static, s);
  }
  !!this$static.lastElement && $scrollIntoView(this$static.lastElement);
}

function $showUpdates(this$static, enable){
  if (enable) {
    $fillContent(this$static);
    $add_11(this$static.log.sinks, this$static.domSink);
  }
   else {
    this$static.log.sinks.map.remove_2(this$static.domSink) != null;
  }
}

function DebugDialog$LogPanel_0(log){
  this.logContainer = $doc.createElement('div');
  this.domSink = new DebugDialog$LogPanel$1_0(this);
  this.log = log;
  this.logContainer.style['width'] = 800 + ($clinit_68() , 'px');
  this.logContainer.style['height'] = '500px';
  this.logContainer.style['overflow'] = ($clinit_58() , 'scroll');
}

function DebugDialog$LogPanel(){
}

_ = DebugDialog$LogPanel_0.prototype = DebugDialog$LogPanel.prototype = new Object_0;
_.getClass$ = function getClass_550(){
  return Lorg_waveprotocol_wave_client_editor_debug_DebugDialog$LogPanel_2_classLit;
}
;
_.castableTypeMap$ = {};
_.lastElement = null;
_.log = null;
function DebugDialog$LogPanel$1_0(this$1){
  this.this$1 = this$1;
}

function DebugDialog$LogPanel$1(){
}

_ = DebugDialog$LogPanel$1_0.prototype = DebugDialog$LogPanel$1.prototype = new LogSink;
_.getClass$ = function getClass_551(){
  return Lorg_waveprotocol_wave_client_editor_debug_DebugDialog$LogPanel$1_2_classLit;
}
;
_.lazyLog = function lazyLog_1(level, messages){
  $appendLogLine(this.this$1, stringifyLogObject(messages));
  $scrollIntoView(this.this$1.lastElement);
}
;
_.castableTypeMap$ = {213:1};
_.this$1 = null;
function $clinit_856(){
  $clinit_856 = nullMethod;
  LOCAL_XML = new DebugDialog$Selection_0('LOCAL_XML', 0, 'localXml');
  DOM_0 = new DebugDialog$Selection_0('DOM', 1, 'dom');
  PERSISTENT_DOCUMENT = new DebugDialog$Selection_0('PERSISTENT_DOCUMENT', 2, 'persistentDocument');
  ANNOTATIONS = new DebugDialog$Selection_0('ANNOTATIONS', 3, 'annotations');
  LOG_0 = new DebugDialog$Selection_0('LOG', 4, 'log');
  OPTIONS = new DebugDialog$Selection_0('OPTIONS', 5, 'options');
  $VALUES_28 = initValues(_3Lorg_waveprotocol_wave_client_editor_debug_DebugDialog$Selection_2_classLit, {58:1, 138:1}, 91, [LOCAL_XML, DOM_0, PERSISTENT_DOCUMENT, ANNOTATIONS, LOG_0, OPTIONS]);
}

function DebugDialog$Selection_0(enum$name, enum$ordinal, displayName){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
  this.displayName = displayName;
}

function values_29(){
  $clinit_856();
  return $VALUES_28;
}

function DebugDialog$Selection(){
}

_ = DebugDialog$Selection_0.prototype = DebugDialog$Selection.prototype = new Enum;
_.getClass$ = function getClass_552(){
  return Lorg_waveprotocol_wave_client_editor_debug_DebugDialog$Selection_2_classLit;
}
;
_.toString$ = function toString_47(){
  return this.displayName;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 91:1};
_.displayName = null;
var $VALUES_28, ANNOTATIONS, DOM_0, LOCAL_XML, LOG_0, OPTIONS, PERSISTENT_DOCUMENT;
function $addCheckBox_0(panel, caption, initValue, handler){
  var box;
  box = new CheckBox_1(caption);
  $setValue_1(box, ($clinit_382() , initValue?TRUE:FALSE));
  $addValueChangeHandler_0(box, handler);
  $add_6(panel, box);
}

function $refresh(this$static){
  var updates;
  updates = this$static.editor.updateEvent;
  $clear(this$static.updateEventsPanel);
  $each_3($debugGetAllUpdateEventNames(updates), new DebugOptions$7_0(this$static, updates));
}

function DebugOptions_0(editorImpl){
  var contentInput, cursorDisplay, errorLabel, insertXmlButton, rhs;
  this.panel = new HorizontalPanel_0;
  this.optionsPanel = new VerticalPanel_0;
  this.updateEventsPanel = new VerticalPanel_0;
  this.editor = editorImpl;
  cursorDisplay = new CursorDisplay_0(editorImpl);
  $addCheckBox_0(this.optionsPanel, 'Editor on', !editorImpl.debugDisabled, new DebugOptions$1_0(editorImpl));
  $addCheckBox_0(this.optionsPanel, 'Receive/send ops', editorImpl.permitOperations, new DebugOptions$2_0(editorImpl));
  $addCheckBox_0(this.optionsPanel, 'Cancel unsafe combos', ($clinit_873() , $clinit_873() , cancelUnsafeKeyEvents), new DebugOptions$3_0);
  $addCheckBox_0(this.optionsPanel, 'Show xy-selection cursor', cursorDisplay.enabled, new DebugOptions$4_0(cursorDisplay));
  $addCheckBox_0(this.optionsPanel, 'Check local ops', ($clinit_718() , validateLocalOps), new DebugOptions$5_0);
  $add_6(this.optionsPanel, new HTML_1('<br/>Permitted update event listeners:'));
  $add_6(this.optionsPanel, this.updateEventsPanel);
  this.updateEventsPanel.element_0.style['paddingLeft'] = 10 + ($clinit_68() , 'px');
  $add_3(this.panel, this.optionsPanel);
  rhs = new VerticalPanel_0;
  $add_6(rhs, new HTML_1('XML to insert at current cursor location.<br/>Ensure there is no extra whitespace anywhere between your tags!'));
  contentInput = new TextArea_1;
  contentInput.element_0.rows = 10;
  contentInput.element_0.cols = 40;
  $add_6(rhs, contentInput);
  errorLabel = new Label_1('');
  insertXmlButton = new Button_1('Insert');
  $addDomHandler(insertXmlButton, new DebugOptions$6_0(this, errorLabel, contentInput), ($clinit_94() , $clinit_94() , TYPE_1));
  $add_6(rhs, errorLabel);
  $add_6(rhs, insertXmlButton);
  $add_3(this.panel, rhs);
}

function DebugOptions(){
}

_ = DebugOptions_0.prototype = DebugOptions.prototype = new Object_0;
_.getClass$ = function getClass_553(){
  return Lorg_waveprotocol_wave_client_editor_debug_DebugOptions_2_classLit;
}
;
_.castableTypeMap$ = {};
_.editor = null;
function DebugOptions$1_0(val$editorImpl){
  this.val$editorImpl = val$editorImpl;
}

function DebugOptions$1(){
}

_ = DebugOptions$1_0.prototype = DebugOptions$1.prototype = new Object_0;
_.getClass$ = function getClass_554(){
  return Lorg_waveprotocol_wave_client_editor_debug_DebugOptions$1_2_classLit;
}
;
_.onValueChange = function onValueChange_1(event_0){
  this.val$editorImpl.debugDisabled = !dynamicCast(event_0.value_0, 136).value_0;
}
;
_.castableTypeMap$ = {24:1, 25:1};
_.val$editorImpl = null;
function DebugOptions$2_0(val$editorImpl){
  this.val$editorImpl = val$editorImpl;
}

function DebugOptions$2(){
}

_ = DebugOptions$2_0.prototype = DebugOptions$2.prototype = new Object_0;
_.getClass$ = function getClass_555(){
  return Lorg_waveprotocol_wave_client_editor_debug_DebugOptions$2_2_classLit;
}
;
_.onValueChange = function onValueChange_2(event_0){
  $debugConnectOpSinks(this.val$editorImpl, dynamicCast(event_0.value_0, 136).value_0);
}
;
_.castableTypeMap$ = {24:1, 25:1};
_.val$editorImpl = null;
function DebugOptions$3_0(){
}

function DebugOptions$3(){
}

_ = DebugOptions$3_0.prototype = DebugOptions$3.prototype = new Object_0;
_.getClass$ = function getClass_556(){
  return Lorg_waveprotocol_wave_client_editor_debug_DebugOptions$3_2_classLit;
}
;
_.onValueChange = function onValueChange_3(event_0){
  $clinit_873();
  cancelUnsafeKeyEvents = dynamicCast(event_0.value_0, 136).value_0;
}
;
_.castableTypeMap$ = {24:1, 25:1};
function DebugOptions$4_0(val$cursorDisplay){
  this.val$cursorDisplay = val$cursorDisplay;
}

function DebugOptions$4(){
}

_ = DebugOptions$4_0.prototype = DebugOptions$4.prototype = new Object_0;
_.getClass$ = function getClass_557(){
  return Lorg_waveprotocol_wave_client_editor_debug_DebugOptions$4_2_classLit;
}
;
_.onValueChange = function onValueChange_4(event_0){
  $setEnabled_0(this.val$cursorDisplay, dynamicCast(event_0.value_0, 136).value_0);
}
;
_.castableTypeMap$ = {24:1, 25:1};
_.val$cursorDisplay = null;
function DebugOptions$5_0(){
}

function DebugOptions$5(){
}

_ = DebugOptions$5_0.prototype = DebugOptions$5.prototype = new Object_0;
_.getClass$ = function getClass_558(){
  return Lorg_waveprotocol_wave_client_editor_debug_DebugOptions$5_2_classLit;
}
;
_.onValueChange = function onValueChange_5(event_0){
  $clinit_718();
  validateLocalOps = dynamicCast(event_0.value_0, 136).value_0;
}
;
_.castableTypeMap$ = {24:1, 25:1};
function DebugOptions$6_0(this$0, val$errorLabel, val$contentInput){
  this.this$0 = this$0;
  this.val$errorLabel = val$errorLabel;
  this.val$contentInput = val$contentInput;
}

function DebugOptions$6(){
}

_ = DebugOptions$6_0.prototype = DebugOptions$6.prototype = new Object_0;
_.getClass$ = function getClass_559(){
  return Lorg_waveprotocol_wave_client_editor_debug_DebugOptions$6_2_classLit;
}
;
_.onClick = function onClick_4(event_0){
  var $e0, e, selection, xml, selection_0;
  this.this$0.editor.focus_2(true);
  selection = (selection_0 = $getSelectionPoints($getSelectionHelper(this.this$0.editor)) , !selection_0?null:$asOrderedRange(selection_0, ($clinit_973() , true)));
  if (!selection) {
    $setTextOrHtml(this.val$errorLabel.directionalTextHelper, "Don't know where to insert this", false);
    return;
  }
  try {
    xml = innerXml1($parse(($clinit_1364() , $getPropertyString(this.val$contentInput.element_0, 'value'))));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 4)) {
      $setTextOrHtml(this.val$errorLabel.directionalTextHelper, 'Ill formed XML', false);
      return;
    }
     else 
      throw $e0;
  }
  try {
    $insertXml($getDocument(this.this$0.editor), selection.second, xml);
    $setTextOrHtml(this.val$errorLabel.directionalTextHelper, '', false);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 4)) {
      e = $e0;
      $setTextOrHtml(this.val$errorLabel.directionalTextHelper, 'Invalid XML: ' + e.getMessage(), false);
    }
     else 
      throw $e0;
  }
}
;
_.castableTypeMap$ = {8:1, 25:1};
_.this$0 = null;
_.val$contentInput = null;
_.val$errorLabel = null;
function DebugOptions$7_0(this$0, val$updates){
  this.this$0 = this$0;
  this.val$updates = val$updates;
}

function DebugOptions$7(){
}

_ = DebugOptions$7_0.prototype = DebugOptions$7.prototype = new Object_0;
_.apply_3 = function apply_17(element){
  $addCheckBox_0(this.this$0.updateEventsPanel, element, !$contains_7(this.val$updates.suppressedEventNames, element), new DebugOptions$7$1_0(this.val$updates, element));
}
;
_.getClass$ = function getClass_560(){
  return Lorg_waveprotocol_wave_client_editor_debug_DebugOptions$7_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$updates = null;
function DebugOptions$7$1_0(val$updates, val$element){
  this.val$updates = val$updates;
  this.val$element = val$element;
}

function DebugOptions$7$1(){
}

_ = DebugOptions$7$1_0.prototype = DebugOptions$7$1.prototype = new Object_0;
_.getClass$ = function getClass_561(){
  return Lorg_waveprotocol_wave_client_editor_debug_DebugOptions$7$1_2_classLit;
}
;
_.onValueChange = function onValueChange_6(event_0){
  $debugSuppressUpdateEvent(this.val$updates, this.val$element, !dynamicCast(event_0.value_0, 136).value_0);
}
;
_.castableTypeMap$ = {24:1, 25:1};
_.val$element = null;
_.val$updates = null;
function DebugPopupFactory$1_0(){
}

function DebugPopupFactory$1(){
}

_ = DebugPopupFactory$1_0.prototype = DebugPopupFactory$1.prototype = new Object_0;
_.getClass$ = function getClass_562(){
  return Lorg_waveprotocol_wave_client_editor_debug_DebugPopupFactory$1_2_classLit;
}
;
_.setPopupPositionAndMakeVisible = function setPopupPositionAndMakeVisible(reference, popup){
  var popupStyle;
  popupStyle = popup.style;
  popupStyle['top'] = 50 + ($clinit_68() , 'px');
  popupStyle['left'] = '50px';
  popupStyle['visibility'] = ($clinit_78() , 'visible');
  popupStyle['position'] = ($clinit_63() , 'fixed');
}
;
_.castableTypeMap$ = {};
function DebugPopupFactory$2_0(val$debugDialog){
  this.val$debugDialog = val$debugDialog;
}

function DebugPopupFactory$2(){
}

_ = DebugPopupFactory$2_0.prototype = DebugPopupFactory$2.prototype = new Object_0;
_.getClass$ = function getClass_563(){
  return Lorg_waveprotocol_wave_client_editor_debug_DebugPopupFactory$2_2_classLit;
}
;
_.onHide = function onHide(source){
  $onHide(this.val$debugDialog);
}
;
_.onShow = function onShow(source){
  $onShow(this.val$debugDialog);
}
;
_.castableTypeMap$ = {212:1};
_.val$debugDialog = null;
function $compositionEnd_0(this$static){
  this$static.delayAfterTextInput = false;
  if (!this$static.browserComposing) {
    $log_0(this$static.logger.errorLogger, "CEH: State was not 'composing' during a compositionend event!");
    return;
  }
  this$static.browserComposing = false;
  if (this$static.modifiesDomAndFiresTextInputAfterComposition) {
    $log_0(this$static.logger.traceLogger, 'ce schedule');
    $scheduleDelayed_0(this$static.timer, this$static.endTask, 0);
  }
   else {
    $log_0(this$static.logger.traceLogger, 'ce now');
    this$static.appComposing = false;
    $compositionEnd_2(this$static.listener);
  }
}

function $compositionStart_0(this$static){
  if (this$static.browserComposing) {
    $log_0(this$static.logger.errorLogger, "CEH: State was already 'composing' during a compositionstart event!");
    return;
  }
  this$static.delayAfterTextInput && $flush_2(this$static);
  this$static.delayAfterTextInput = false;
  this$static.browserComposing = true;
  if (this$static.modifiesDomAndFiresTextInputAfterComposition && $get_2(this$static.timer.scheduler.taskInfos.backend, this$static.endTask) != null) {
    $cancel_1(this$static.timer.scheduler, this$static.endTask);
    return;
  }
  this$static.appComposing = true;
  $compositionStart_1(this$static.listener.this$0);
}

function $flush_2(this$static){
  if (this$static.appComposing) {
    $cancel_1(this$static.timer.scheduler, this$static.endTask);
    $execute_2(this$static.endTask);
  }
   else {
    return;
  }
}

function $handleCompositionEvent(this$static, typeName){
  if ($equals_3('compositionstart', typeName)) {
    $compositionStart_0(this$static);
  }
   else if ($equals_3('text', typeName) || $equals_3('compositionupdate', typeName))
  ;
  else if ($equals_3('compositionend', typeName)) {
    $compositionEnd_0(this$static);
  }
   else if ($equals_3('textInput', typeName)) {
    $textInput(this$static);
  }
   else {
    throw new AssertionError_0('unreachable');
  }
  return false;
}

function $handleOtherEvent(this$static){
  if (this$static.modifiesDomAndFiresTextInputAfterComposition && !this$static.browserComposing) {
    $flush_2(this$static);
  }
   else {
    return;
  }
}

function $textInput(this$static){
  if (this$static.modifiesDomAndFiresTextInputAfterComposition && this$static.appComposing && !this$static.browserComposing) {
    this$static.delayAfterTextInput = true;
    $scheduleDelayed_0(this$static.timer, this$static.endTask, 0);
  }
}

function CompositionEventHandler_0(timer, listener, logger, modifiesDomAndFiresTextinputAfterComposition){
  this.endTask = new CompositionEventHandler$1_0(this);
  this.timer = timer;
  this.listener = listener;
  this.logger = logger;
  this.modifiesDomAndFiresTextInputAfterComposition = modifiesDomAndFiresTextinputAfterComposition;
}

function CompositionEventHandler(){
}

_ = CompositionEventHandler_0.prototype = CompositionEventHandler.prototype = new Object_0;
_.getClass$ = function getClass_564(){
  return Lorg_waveprotocol_wave_client_editor_event_CompositionEventHandler_2_classLit;
}
;
_.castableTypeMap$ = {};
_.appComposing = false;
_.browserComposing = false;
_.delayAfterTextInput = false;
_.listener = null;
_.logger = null;
_.modifiesDomAndFiresTextInputAfterComposition = false;
_.timer = null;
function $execute_2(this$static){
  this$static.this$0.delayAfterTextInput = false;
  if (this$static.this$0.browserComposing) {
    return;
  }
  this$static.this$0.appComposing = false;
  $compositionEnd_2(this$static.this$0.listener);
}

function CompositionEventHandler$1_0(this$0){
  this.this$0 = this$0;
}

function CompositionEventHandler$1(){
}

_ = CompositionEventHandler$1_0.prototype = CompositionEventHandler$1.prototype = new Object_0;
_.execute = function execute_26(){
  $execute_2(this);
}
;
_.getClass$ = function getClass_565(){
  return Lorg_waveprotocol_wave_client_editor_event_CompositionEventHandler$1_2_classLit;
}
;
_.castableTypeMap$ = {209:1, 210:1};
_.this$0 = null;
function $clinit_873(){
  $clinit_873 = nullMethod;
  logger_4 = ($clinit_672() , logger_1);
}

function $checkBlackWhiteListConsistency(sEvent){
  var isConsistent, message;
  isConsistent = !($isWhiteListedCombo(sEvent) && $isBlackListedCombo(sEvent));
  if (!isConsistent) {
    message = 'Combo both whitelisted and blacklisted! ' + sEvent.cachedKeyCode;
    $logPlainText(logger_4.errorLogger, message);
  }
  return isConsistent;
}

function $checkForWebkitEndOfLinkHack(this$static, signal){
  var e, selection, textNode;
  if (signal.nativeEvent.target.nodeType == 3 && ($equals_3(signal.nativeEvent.type, 'DOMCharacterDataModified') || $equals_3(signal.nativeEvent.type, 'DOMNodeInserted'))) {
    textNode = signal.nativeEvent.target;
    if (textNode.length > 0) {
      e = textNode.previousSibling;
      if (!!e && e.nodeType != 3 && $equals_3(e.tagName.toLowerCase(), 'a')) {
        selection = this$static.editorInteractor.this$0.content_0?(get_14() , null):null;
        selection.isCollapsed && $getTextOffset(selection.focus_0) == 0 && (this$static.editorInteractor.this$0.webkitEndOfLinkHackTextNode = textNode , undefined);
      }
    }
  }
}

function $checkIfValidSelectionNeeded(this$static, event_0){
  if (event_0.nativeEvent.type.indexOf('DOM') == 0 || $contains_7(($clinit_530() , FOCUS_EVENTS), event_0.nativeEvent.type)) {
    return false;
  }
   else if ($contains_7(($clinit_530() , KEY_EVENTS), event_0.nativeEvent.type) && this$static.state == ($clinit_876() , NORMAL_0)) {
    if (event_0.cachedKeyCode == 229) {
      return false;
    }
     else if (event_0.keySignalType == ($clinit_528() , INPUT)) {
      return false;
    }
  }
  return true;
}

function $compositionEnd_1(this$static){
  this$static.cachedSelection = $compositionEnd(this$static.editorInteractor);
  this$static.state = ($clinit_876() , NORMAL_0);
}

function $compositionStart_1(this$static){
  var caret;
  this$static.state == ($clinit_876() , COMPOSITION) && $log_0(logger_4.errorLogger, 'State was already IME during a compositionstart event!');
  if (!this$static.cachedSelection) {
    $log_0(logger_4.errorLogger, "No selection during a composition start event? Maybe it's deep inside some doodad's html?");
    caret = null;
  }
   else 
    this$static.cachedSelection.isCollapsed?(caret = this$static.cachedSelection.focus_0):(caret = $deleteCachedSelectionRangeAndInvalidate(this$static, true));
  this$static.state = COMPOSITION;
  $compositionStart(this$static.editorInteractor, caret);
}

function $deleteCachedSelectionRangeAndInvalidate(this$static, isReplace){
  var caret, end, start;
  $checkpoint(this$static.editorInteractor, this$static.cachedSelection);
  $clinit_973();
  start = this$static.cachedSelection.anchor;
  end = this$static.cachedSelection.focus_0;
  caret = $deleteRange(this$static.editorInteractor, start, end, isReplace);
  this$static.cachedSelection = null;
  $setCaret_0(this$static.editorInteractor.this$0.aggressiveSelectionHelper, caret);
  return caret;
}

--></script>
<script><!--
function $handleEvent(this$static, signal){
  var $e0, e, retVal;
  if ($notifyListeners(this$static.editorInteractor, signal)) {
    return false;
  }
  this$static.hadInitialSelection = $hasContentSelection(this$static.editorInteractor);
  try {
    retVal = $handleEventInner(this$static, signal);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 198)) {
      e = $e0;
      e.lostSelection && $log_3(($clinit_672() , logger_1).errorLogger, e);
      retVal = e.lostSelection;
    }
     else 
      throw $e0;
  }
  return retVal;
}

function $handleEventInner(this$static, event_0){
  var node;
  this$static.cachedSelection = null;
  if ($contains_7(($clinit_530() , MOUSE_EVENTS), event_0.nativeEvent.type)) {
    $flushSynchronous(this$static.editorInteractor.this$0);
    node = $findElementWrapper_0(this$static.editorInteractor.this$0.nodeManager, event_0.nativeEvent.target);
    event_0.caret = new ContentPoint_0(node, null);
    if (!!node && $equals_3('click', event_0.nativeEvent.type)) {
      $handleClick(this$static.router, node, event_0);
      this$static.editorInteractor.this$0.caretStyles.annotations.clear();
      $rebiasSelection(this$static.editorInteractor.this$0, ($clinit_1075() , NEUTRAL_0));
      return !event_0.shouldAllowDefault;
    }
     else {
      return false;
    }
  }
  if ($checkIfValidSelectionNeeded(this$static, event_0)) {
    $refreshEditorWithCaret(this$static, event_0);
    if (!this$static.cachedSelection) {
      return this$static.editorInteractor.this$0.editing;
    }
  }
  this$static.weirdComposition && this$static.state == ($clinit_876() , COMPOSITION) && ($contains_7(COMPOSITION_EVENTS, event_0.nativeEvent.type) || $handleOtherEvent(this$static.compositionHandler));
  if ($contains_7(KEY_EVENTS, event_0.nativeEvent.type)) {
    return $handleKeyEvent(this$static, event_0);
  }
   else if ($contains_7(COMPOSITION_EVENTS, event_0.nativeEvent.type)) {
    return this$static.useCompositionEvents && $handleCompositionEvent(this$static.compositionHandler, event_0.nativeEvent.type);
  }
   else if ($contains_7(CLIPBOARD_EVENTS, event_0.nativeEvent.type)) {
    return $equals_3('paste', event_0.nativeEvent.type)?$handlePaste(this$static.subHandler):$equals_3('cut', event_0.nativeEvent.type)?$handleCut(this$static.subHandler):$equals_3('copy', event_0.nativeEvent.type) && $handleCopy(this$static.subHandler);
  }
   else if (event_0.nativeEvent.type.indexOf('DOM') == 0) {
    if (!$isTyping(this$static.editorInteractor.this$0)) {
      if (event_0.nativeEvent.target.nodeType == 3) {
        this$static.cachedSelection = $getSelectionPoints(this$static.editorInteractor.this$0.aggressiveSelectionHelper);
        if (this$static.cachedSelection) {
          this$static.cachedSelection.isCollapsed || $logPlainText(logger_4.traceLogger, 'WARNING: Probable IME input on non-collapsed range not handled!!!');
          $logPlainText(logger_4.traceLogger, 'Notifying typing extractor for probable IME-caused mutation event');
          $notifyTypingExtractor_0(this$static.editorInteractor, this$static.cachedSelection.focus_0, false, false);
        }
      }
    }
    ($clinit_515() , LIES_ABOUT_CARET_AT_LINK_END_BOUNDARY) && $checkForWebkitEndOfLinkHack(this$static, event_0);
    $handleMutationEvent(this$static.subHandler.this$0.domMutationReverter, event_0);
    return false;
  }
   else if ($contains_7(FOCUS_EVENTS, event_0.nativeEvent.type)) {
    return false;
  }
   else {
    $log_0(logger_4.traceLogger, 'Cancelling: ' + event_0.nativeEvent.type);
    return true;
  }
}

function $handleEventsManuallyOnNode(this$static, event_0, caret){
  if ($isCombo(event_0, 13, ($clinit_519() , NONE_1))) {
    $refreshEditorWithCaret(this$static, event_0);
    caret = $asPoint(event_0.caret);
    $checkpoint(this$static.editorInteractor, new FocusedContentRange_1(caret));
    $handleEnter(this$static.router, dynamicCast(caret.container, 163), event_0);
    $rebiasSelection(this$static.editorInteractor.this$0, ($clinit_1075() , FROM_LEFT));
    return true;
  }
   else if ($isCombo(event_0, 13, SHIFT)) {
    return true;
  }
  return false;
}

function $handleInputOrDeleteKeyEvent(this$static, event_0, keySignalType){
  var caret, isCollapsed, isDelete, isReplace, moveUnit, node;
  isCollapsed = (this$static.editorInteractor.this$0.content_0?(get_14() , null):null) != null && (this$static.editorInteractor.this$0.content_0?(get_14() , null):null).isCollapsed;
  isReplace = false;
  if (isCollapsed) {
    moveUnit = event_0.keySignalType == ($clinit_528() , DELETE_0)?($clinit_539() , $clinit_539() , INSTANCE_3).isMac?event_0.nativeEvent.altKey?($clinit_529() , WORD):(($clinit_530() , logic_0).commandIsCtrl?!!event_0.nativeEvent.ctrlKey:!!event_0.nativeEvent.metaKey)?($clinit_529() , LINE):($clinit_529() , CHARACTER):(($clinit_530() , logic_0).commandIsCtrl?!!event_0.nativeEvent.ctrlKey:!!event_0.nativeEvent.metaKey)?($clinit_529() , WORD):($clinit_529() , CHARACTER):($clinit_529() , CHARACTER);
    if (moveUnit != ($clinit_529() , CHARACTER)) {
      if ((event_0.keySignalType == DELETE_0?($clinit_539() , $clinit_539() , INSTANCE_3).isMac?event_0.nativeEvent.altKey?WORD:(($clinit_530() , logic_0).commandIsCtrl?!!event_0.nativeEvent.ctrlKey:!!event_0.nativeEvent.metaKey)?LINE:CHARACTER:(($clinit_530() , logic_0).commandIsCtrl?!!event_0.nativeEvent.ctrlKey:!!event_0.nativeEvent.metaKey)?WORD:CHARACTER:CHARACTER) == WORD) {
        if (event_0.cachedKeyCode == 8) {
          $refreshEditorWithCaret(this$static, event_0);
          caret = this$static.cachedSelection.focus_0;
          $deleteWordEndingAt(this$static.editorInteractor, caret);
        }
         else if (event_0.cachedKeyCode == 46) {
          $refreshEditorWithCaret(this$static, event_0);
          caret = this$static.cachedSelection.focus_0;
          $deleteWordStartingAt(this$static.editorInteractor, caret);
        }
      }
      return true;
    }
     else {
      caret = null;
    }
  }
   else {
    $refreshEditorWithCaret(this$static, event_0);
    isDelete = keySignalType == ($clinit_528() , DELETE_0);
    event_0.cachedKeyCode == 229?(caret = this$static.cachedSelection.focus_0):(caret = $deleteCachedSelectionRangeAndInvalidate(this$static, !isDelete));
    if (isDelete) {
      return true;
    }
     else {
      isReplace = true;
    }
  }
  if (keySignalType == ($clinit_528() , DELETE_0)) {
    $refreshEditorWithCaret(this$static, event_0);
    caret = this$static.cachedSelection.focus_0;
    node = dynamicCast(caret.container, 163);
    $checkpoint(this$static.editorInteractor, new FocusedContentRange_1(caret));
    switch (($clinit_503() , getKeyCombo_0(event_0.cachedKeyCode, !!event_0.nativeEvent.ctrlKey, !!event_0.nativeEvent.shiftKey, !!event_0.nativeEvent.altKey, !!event_0.nativeEvent.metaKey)).ordinal) {
      case 21:
      case 22:
        $rebiasSelection(this$static.editorInteractor.this$0, ($clinit_1075() , FROM_RIGHT));
        return $handleBackspace(this$static.router, node, event_0);
      case 24:
        if ($clinit_515() , HAS_OLD_SCHOOL_CLIPBOARD_SHORTCUTS) {
          throw new RuntimeException_1('Shift delete should have been caughtas an accelerator event!');
        }
         else {
          $rebiasSelection(this$static.editorInteractor.this$0, ($clinit_1075() , FROM_LEFT));
          return $handleDelete(this$static.router, node, event_0);
        }

      case 23:
        $rebiasSelection(this$static.editorInteractor.this$0, ($clinit_1075() , FROM_LEFT));
        return $handleDelete(this$static.router, node, event_0);
    }
  }
   else if ($handleEventsManuallyOnNode(this$static, event_0, caret)) {
    return true;
  }
  return $handleNormalTyping(this$static, event_0, caret, isReplace);
}

function $handleKeyEvent(this$static, event_0){
  var keySignalType;
  keySignalType = event_0.keySignalType;
  switch (this$static.state.ordinal) {
    case 0:
      if (isAcceleratorInner(event_0, ($clinit_539() , $clinit_539() , INSTANCE_3).isMac, ($clinit_515() , HAS_OLD_SCHOOL_CLIPBOARD_SHORTCUTS))) {
        $refreshEditorWithCaret(this$static, event_0);
        if ($handleCommand(this$static.subHandler, event_0) || $handleBlockLevelCommands(this$static.subHandler, event_0, $asOrderedRange(this$static.cachedSelection, ($clinit_973() , true)))) {
          return true;
        }
        if (this$static.cachedSelection.isCollapsed) {
          if ($handleCollapsedKeyCombo(this$static.subHandler, event_0, this$static.cachedSelection.focus_0)) {
            return true;
          }
        }
         else {
          if ($handleRangeKeyCombo(this$static.subHandler, event_0, $asOrderedRange(this$static.cachedSelection, ($clinit_973() , true)))) {
            return true;
          }
        }
        return $shouldCancelAcceleratorBrowserDefault(this$static, event_0);
      }

      switch (keySignalType.ordinal) {
        case 0:
        case 2:
          return $handleInputOrDeleteKeyEvent(this$static, event_0, keySignalType);
        case 1:
          return $handleNavigationKeyEvents(this$static, event_0);
        case 3:
          return false;
      }

      throw new RuntimeException_1('Unhandled signal type');
    case 1:
      return false;
    default:throw new RuntimeException_1('Unhandled state');
  }
}

function $handleNavigationKeyEvents(this$static, event_0){
  var node;
  $checkpoint(this$static.editorInteractor, null);
  this$static.editorInteractor.this$0.caretStyles.annotations.clear();
  node = dynamicCast(this$static.cachedSelection.focus_0.container, 163);
  $log_0(logger_4.traceLogger, 'Navigation event');
  if (event_0.cachedKeyCode == 37) {
    $handleLeft(this$static.router, node, event_0);
    $rebiasSelection(this$static.editorInteractor.this$0, ($clinit_1075() , FROM_RIGHT));
    return !event_0.shouldAllowDefault;
  }
   else if (event_0.cachedKeyCode == 39) {
    $handleRight(this$static.router, node, event_0);
    $rebiasSelection(this$static.editorInteractor.this$0, ($clinit_1075() , FROM_LEFT));
    return !event_0.shouldAllowDefault;
  }
   else {
    $rebiasSelection(this$static.editorInteractor.this$0, ($clinit_1075() , NEUTRAL_0));
  }
  return false;
}

function $handleNormalTyping(this$static, event_0, caret, isReplace){
  var c, useTypingExtractor;
  useTypingExtractor = event_0.cachedKeyCode == 229;
  if (useTypingExtractor) {
    if ($isTyping(this$static.editorInteractor.this$0)) {
      $log_0(logger_4.traceLogger, 'Not notifying typing extractor, already notified');
    }
     else {
      $log_0(logger_4.traceLogger, 'Notifying typing extractor');
      return $notifyTypingExtractor_0(this$static.editorInteractor, caret, !caret, isReplace);
    }
    return false;
  }
   else {
    c = event_0.cachedKeyCode & 65535;
    $refreshEditorWithCaret(this$static, event_0);
    caret = this$static.cachedSelection.focus_0;
    caret = $insertText(this$static.editorInteractor.this$0, caret, String.fromCharCode(c), isReplace);
    caret = $normalizePoint(this$static.editorInteractor, caret);
    this$static.cachedSelection = null;
    $setCaret_0(this$static.editorInteractor.this$0.aggressiveSelectionHelper, caret);
    $rebiasSelection(this$static.editorInteractor.this$0, ($clinit_1075() , FROM_LEFT));
    return true;
  }
}

function $isAllowableCombo(this$static, sEvent){
  $checkBlackWhiteListConsistency(sEvent);
  if ($isWhiteListedCombo(sEvent)) {
    return true;
  }
  if (this$static.useWhiteListing) {
    return false;
  }
   else {
    $shouldLog_0(logger_4.traceLogger) && $log_2(logger_4.traceLogger, 'not in whitelist: ', sEvent);
    return !$isBlackListedCombo(sEvent);
  }
}

function $isAlternateClipboardCombo(signal){
  switch (($clinit_503() , getKeyCombo_0(signal.cachedKeyCode, !!signal.nativeEvent.ctrlKey, !!signal.nativeEvent.shiftKey, !!signal.nativeEvent.altKey, !!signal.nativeEvent.metaKey)).ordinal) {
    case 24:
    case 27:
    case 26:
      return true;
    default:return false;
  }
}

function $isBlackListedCombo(event_0){
  var keyCombo;
  keyCombo = ($clinit_503() , getKeyCombo_0(event_0.cachedKeyCode, !!event_0.nativeEvent.ctrlKey, !!event_0.nativeEvent.shiftKey, !!event_0.nativeEvent.altKey, !!event_0.nativeEvent.metaKey));
  if (keyCombo.ordinal == 44) {
    return true;
  }
  if (($clinit_539() , $clinit_539() , INSTANCE_3).isMac) {
    switch (keyCombo.ordinal) {
      case 29:
      case 30:
      case 33:
        return true;
    }
    if (keyCombo.ordinal == 59) {
      return true;
    }
  }
  return false;
}

function $isWhiteListedCombo(signal){
  var keyCombo;
  keyCombo = ($clinit_503() , getKeyCombo_0(signal.cachedKeyCode, !!signal.nativeEvent.ctrlKey, !!signal.nativeEvent.shiftKey, !!signal.nativeEvent.altKey, !!signal.nativeEvent.metaKey));
  switch (keyCombo.ordinal) {
    case 41:
    case 42:
    case 43:
    case 61:
    case 62:
    case 67:
    case 46:
    case 47:
    case 48:
    case 49:
    case 50:
    case 51:
    case 55:
    case 56:
    case 57:
    case 58:
    case 60:
    case 65:
    case 66:
      return true;
  }
  if ($clinit_515() , HAS_OLD_SCHOOL_CLIPBOARD_SHORTCUTS) {
    if ($isAlternateClipboardCombo(signal)) {
      return true;
    }
  }
  return false;
}

function $refreshEditorWithCaret(this$static, event_0){
  $flushSynchronous(this$static.editorInteractor.this$0);
  this$static.cachedSelection = $getSelectionPoints(this$static.editorInteractor.this$0.aggressiveSelectionHelper);
  if (this$static.cachedSelection) {
    event_0.caret = fromPoint(this$static.cachedSelection.focus_0);
  }
   else {
    throw new EditorEventHandler$SelectionLostException_0('Null selection after force flushing editor, event = ' + event_0.nativeEvent.type, this$static.hadInitialSelection);
  }
}

function $shouldCancelAcceleratorBrowserDefault(this$static, acceleratorEvent){
  if ($check(($clinit_519() , acceleratorEvent))) {
    return acceleratorEvent.cachedKeyCode == 45 || cancelUnsafeKeyEvents;
  }
  if ($isAllowableCombo(this$static, acceleratorEvent)) {
    $log_0(logger_4.traceLogger, 'Allowing event');
    return false;
  }
  $shouldLog_0(logger_4.traceLogger) && $log_1(logger_4.traceLogger, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['unsafe combo: ', acceleratorEvent.nativeEvent.type, valueOf_0(acceleratorEvent.cachedKeyCode)]));
  return cancelUnsafeKeyEvents;
}

function EditorEventHandler_0(editorInteractor, subHandler, router){
  $clinit_873();
  EditorEventHandler_1.call(this, new SchedulerTimerService_1((!instance_6 && (instance_6 = new BrowserBackedScheduler_0 , setDefaultTimerService() , undefined) , instance_6), ($clinit_1013() , CRITICAL)), editorInteractor, subHandler, router, ($clinit_515() , SUPPORTS_COMPOSITION_EVENTS));
}

function EditorEventHandler_1(criticalTimerService, interactor, subHandler, router, useCompositionEvents){
  this.compositionListener = new EditorEventHandler$1_0(this);
  this.weirdComposition = ($clinit_515() , true);
  this.state = ($clinit_876() , NORMAL_0);
  this.editorInteractor = interactor;
  this.subHandler = subHandler;
  this.router = router;
  this.useWhiteListing = false;
  this.compositionHandler = new CompositionEventHandler_0(criticalTimerService, this.compositionListener, logger_4, this.weirdComposition);
  this.useCompositionEvents = useCompositionEvents;
}

function isAcceleratorInner(event_0, isMac, quirksHasOldSchoolClipboardShortcuts){
  var maybeAltKey;
  switch (event_0.keySignalType.ordinal) {
    case 0:
      maybeAltKey = !isMac && !!event_0.nativeEvent.altKey;
      return !!event_0.nativeEvent.ctrlKey || !!event_0.nativeEvent.metaKey || event_0.cachedKeyCode == 9 || maybeAltKey;
    case 2:
      return quirksHasOldSchoolClipboardShortcuts && event_0.cachedKeyCode == 46 && $check_0(($clinit_519() , event_0));
    case 1:
      return false;
    case 3:
      return true;
  }
  throw new RuntimeException_1('Unknown KeySignal type');
}

function EditorEventHandler(){
}

_ = EditorEventHandler_0.prototype = EditorEventHandler.prototype = new Object_0;
_.getClass$ = function getClass_566(){
  return Lorg_waveprotocol_wave_client_editor_event_EditorEventHandler_2_classLit;
}
;
_.castableTypeMap$ = {};
_.cachedSelection = null;
_.compositionHandler = null;
_.editorInteractor = null;
_.hadInitialSelection = false;
_.router = null;
_.subHandler = null;
_.useCompositionEvents = false;
_.useWhiteListing = false;
var cancelUnsafeKeyEvents = true, logger_4;
function $compositionEnd_2(this$static){
  $clinit_672();
  ++ignoreMutations;
  try {
    $compositionEnd_1(this$static.this$0);
  }
   finally {
    --ignoreMutations;
  }
}

function EditorEventHandler$1_0(this$0){
  this.this$0 = this$0;
}

function EditorEventHandler$1(){
}

_ = EditorEventHandler$1_0.prototype = EditorEventHandler$1.prototype = new Object_0;
_.getClass$ = function getClass_567(){
  return Lorg_waveprotocol_wave_client_editor_event_EditorEventHandler$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function EditorEventHandler$SelectionLostException_0(message, lost){
  this.fillInStackTrace();
  this.detailMessage = message + '. Selection was ' + (lost?'':'not ') + 'lost.';
  this.lostSelection = lost;
}

function EditorEventHandler$SelectionLostException(){
}

_ = EditorEventHandler$SelectionLostException_0.prototype = EditorEventHandler$SelectionLostException.prototype = new Exception;
_.getClass$ = function getClass_568(){
  return Lorg_waveprotocol_wave_client_editor_event_EditorEventHandler$SelectionLostException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 58:1, 143:1, 198:1};
_.lostSelection = false;
function $clinit_876(){
  $clinit_876 = nullMethod;
  NORMAL_0 = new EditorEventHandler$State_0('NORMAL', 0);
  COMPOSITION = new EditorEventHandler$State_0('COMPOSITION', 1);
  $VALUES_29 = initValues(_3Lorg_waveprotocol_wave_client_editor_event_EditorEventHandler$State_2_classLit, {58:1, 138:1}, 92, [NORMAL_0, COMPOSITION]);
}

function EditorEventHandler$State_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_30(){
  $clinit_876();
  return $VALUES_29;
}

function EditorEventHandler$State(){
}

_ = EditorEventHandler$State_0.prototype = EditorEventHandler$State.prototype = new Enum;
_.getClass$ = function getClass_569(){
  return Lorg_waveprotocol_wave_client_editor_event_EditorEventHandler$State_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 92:1};
var $VALUES_29, COMPOSITION, NORMAL_0;
function $clinit_877(){
  $clinit_877 = nullMethod;
  $clinit_530();
  FACTORY = new EditorEventImpl$1_0;
}

function EditorEventImpl_0(){
  $clinit_877();
}

function EditorEventImpl(){
}

_ = EditorEventImpl_0.prototype = EditorEventImpl.prototype = new SignalEventImpl;
_.getClass$ = function getClass_570(){
  return Lorg_waveprotocol_wave_client_editor_event_EditorEventImpl_2_classLit;
}
;
_.castableTypeMap$ = {146:1, 166:1};
_.caret = null;
_.shouldAllowDefault = false;
var FACTORY;
function EditorEventImpl$1_0(){
}

function EditorEventImpl$1(){
}

_ = EditorEventImpl$1_0.prototype = EditorEventImpl$1.prototype = new Object_0;
_.create = function create_10(){
  return new EditorEventImpl_0;
}
;
_.getClass$ = function getClass_571(){
  return Lorg_waveprotocol_wave_client_editor_event_EditorEventImpl$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function $addEntry(this$static, entry){
  $add_9(this$static.entries, entry);
  $scheduleRevert(this$static.listener);
}

function $flush_3(this$static){
  var i;
  this$static.entries.size > 0 && $log_0(($clinit_672() , logger_1).traceLogger, 'DomMutation Flush of ' + this$static.entries.size + ' mutations.');
  for (i = this$static.entries.size - 1; i >= 0; --i) {
    $undo_0(dynamicCast($get_3(this$static.entries, i), 199));
  }
  for (i = 0; i < this$static.entries.size; ++i) {
    $cleanup_0(dynamicCast($get_3(this$static.entries, i), 199));
  }
  $clear_2(this$static.entries);
}

function $handleMutationEvent(this$static, event_0){
  var ignorableWhenEmpty, target;
  if ($equals_3(event_0.nativeEvent.type, 'DOMNodeRemoved')) {
    target = event_0.nativeEvent.target;
    ignorableWhenEmpty = target.nodeType == 3 || ($clinit_962() , !(!!target && (target[BACKREF_NAME] || null) != null));
    if (ignorableWhenEmpty && this$static.entries.size == 0)
    ;
    else {
      $log_0(($clinit_672() , logger_1).traceLogger, 'REVERT REMOVAL: ' + (target.nodeType == 3?target.data:target.tagName));
      $addEntry(this$static, new DomMutationReverter$RemovalEntry_0(target, $getParentElement(target), target.nextSibling, ignorableWhenEmpty));
    }
  }
}

function DomMutationReverter_0(listener){
  this.entries = new ArrayList_0;
  this.listener = listener;
}

function DomMutationReverter(){
}

_ = DomMutationReverter_0.prototype = DomMutationReverter.prototype = new Object_0;
_.getClass$ = function getClass_572(){
  return Lorg_waveprotocol_wave_client_editor_extract_DomMutationReverter_2_classLit;
}
;
_.castableTypeMap$ = {};
_.listener = null;
function $cleanup_0(this$static){
  if (this$static.removeAfter) {
    $log_0(($clinit_672() , logger_1).traceLogger, 'REVERT CLEANUP: ' + (this$static.removedNode.nodeType == 3?this$static.removedNode.data:this$static.removedNode.tagName));
    $removeFromParent(this$static.removedNode);
  }
}

function $undo_0(this$static){
  this$static.oldParent.insertBefore(this$static.removedNode, this$static.oldNodeAfter);
}

function DomMutationReverter$RemovalEntry_0(removedNode, oldParent, oldNodeAfter, removeAfter){
  if (!oldParent) {
    throw new IllegalArgumentException_1('Old parent cannot be null');
  }
  this.removeAfter = removeAfter;
  this.removedNode = removedNode;
  this.oldParent = oldParent;
  this.oldNodeAfter = oldNodeAfter;
}

function DomMutationReverter$RemovalEntry(){
}

_ = DomMutationReverter$RemovalEntry_0.prototype = DomMutationReverter$RemovalEntry.prototype = new Object_0;
_.getClass$ = function getClass_573(){
  return Lorg_waveprotocol_wave_client_editor_extract_DomMutationReverter$RemovalEntry_2_classLit;
}
;
_.castableTypeMap$ = {199:1};
_.oldNodeAfter = null;
_.oldParent = null;
_.removeAfter = false;
_.removedNode = null;
function $activate(this$static, cxt, location_0){
  var container, nodeAfter, point;
  $clearWrapper(this$static, cxt.this$0.fullContentView);
  point = ensureNodeBoundary(transparentSlice(location_0, cxt), cxt.this$0.fullContentView, cxt.this$0.indexedDoc);
  container = dynamicCast(point.container, 163).asElement();
  nodeAfter = dynamicCast($getNodeAfter(point), 163);
  !!nodeAfter && (container = nodeAfter.parent_0);
  this$static.wrapper = $transparentCreate_0(cxt.this$0.fullContentView, 'l:ime', ($clinit_430() , $clinit_430() , EMPTY_MAP), container, nodeAfter);
  this$static.wrapper.containerNodelet.appendChild(this$static.imeContainer);
  $clinit_973();
  cache_0 = null;
  cache_0 = null;
}

function $clearContainer(this$static){
  this$static.imeInput.innerHTML = '';
  $appendSpacer(($clinit_838() , this$static.imeInput));
  new Point$El_0(this$static.imeInput, this$static.imeInput.firstChild);
}

function $clearWrapper(this$static, doc){
  !!this$static.wrapper && !!this$static.wrapper.parent_0 && $transparentDeepRemove(doc, this$static.wrapper);
  this$static.wrapper = null;
  $clearContainer(this$static);
}

function $deactivate(this$static, doc){
  var ret;
  ret = new Point$El_0(dynamicCast(doc.inner_0.getParentElement(this$static.wrapper), 163), dynamicCast(doc.inner_0.getNextSibling(this$static.wrapper), 163));
  $clearWrapper(this$static, doc);
  return ret;
}

function $getContent_0(this$static){
  return this$static.wrapper?this$static.imeContainer.textContent:null;
}

function ImeExtractor_0(){
  this.imeContainer = $doc.createElement('span');
  $clinit_962();
  this.imeContainer[TRANSPARENCY] = ($clinit_1371() , DEEP);
  this.imeContainer[MAY_CONTAIN_SELECTION] = true;
  $clinit_515();
  this.imeContainer.style['display'] = ($clinit_47() , 'inline-block');
  setContentEditable(this.imeContainer, false, false);
  this.imeInput = $doc.createElement('span');
  this.imeInput.style['display'] = 'inline-block';
  this.imeInput.style['outline'] = '0';
  setContentEditable(this.imeInput, true, false);
  this.imeInput[TRANSPARENCY] = DEEP;
  this.imeInput[MAY_CONTAIN_SELECTION] = true;
  this.imeContainer.appendChild(this.imeInput);
  $clearContainer(this);
}

function ImeExtractor(){
}

_ = ImeExtractor_0.prototype = ImeExtractor.prototype = new Object_0;
_.getClass$ = function getClass_574(){
  return Lorg_waveprotocol_wave_client_editor_extract_ImeExtractor_2_classLit;
}
;
_.castableTypeMap$ = {};
_.imeInput = null;
_.wrapper = null;
function ImeExtractor$1_0(){
}

function ImeExtractor$1(){
}

_ = ImeExtractor$1_0.prototype = ImeExtractor$1.prototype = new Object_0;
_.createDomImpl = function createDomImpl_18(element){
  return $setAutoAppendContainer(element, $doc.createElement('span'));
}
;
_.getClass$ = function getClass_575(){
  return Lorg_waveprotocol_wave_client_editor_extract_ImeExtractor$1_2_classLit;
}
;
_.castableTypeMap$ = {177:1};
function InconsistencyException_0(where){
  this.fillInStackTrace();
  this.where = where;
}

function InconsistencyException(){
}

_ = InconsistencyException.prototype = new Exception;
_.getClass$ = function getClass_576(){
  return Lorg_waveprotocol_wave_client_editor_extract_InconsistencyException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 58:1, 143:1, 191:1};
_.where = null;
function InconsistencyException$HtmlInserted_0(contentPoint, htmlPoint){
  InconsistencyException_0.call(this, dynamicCastJso(htmlPoint.container));
  this.contentPoint = contentPoint;
  this.htmlPoint = htmlPoint;
}

function InconsistencyException$HtmlInserted(){
}

_ = InconsistencyException$HtmlInserted_0.prototype = InconsistencyException$HtmlInserted.prototype = new InconsistencyException;
_.getClass$ = function getClass_577(){
  return Lorg_waveprotocol_wave_client_editor_extract_InconsistencyException$HtmlInserted_2_classLit;
}
;
_.toString$ = function toString_48(){
  return 'HtmlInserted: ' + this.contentPoint;
}
;
_.castableTypeMap$ = {3:1, 58:1, 143:1, 172:1, 191:1};
_.contentPoint = null;
_.htmlPoint = null;
function InconsistencyException$HtmlMissing_0(brokenNode, where){
  this.fillInStackTrace();
  this.where = where;
  checkNotNull_1(brokenNode, 'Broken node is unspecified');
  this.brokenNode = brokenNode;
}

function InconsistencyException$HtmlMissing(){
}

_ = InconsistencyException$HtmlMissing_0.prototype = InconsistencyException$HtmlMissing.prototype = new InconsistencyException;
_.getClass$ = function getClass_578(){
  return Lorg_waveprotocol_wave_client_editor_extract_InconsistencyException$HtmlMissing_2_classLit;
}
;
_.toString$ = function toString_49(){
  return 'HtmlMissing: ' + this.brokenNode + ' in ' + this.where;
}
;
_.castableTypeMap$ = {3:1, 58:1, 143:1, 171:1, 191:1};
_.brokenNode = null;
function $extractNormalizedAnnotation(this$static, normalizedStart, normalizedEnd){
  var end, interested, start;
  start = $getLocation_0(this$static.doc, normalizedStart);
  end = $getLocation_0(this$static.doc, normalizedEnd);
  interested = $filterContentAnnotations(this$static, $knownKeys(this$static.doc.doc));
  return trimAnnotations($rangedAnnotations_1(this$static.doc.doc, start, end, interested), start, end - start);
}

function $filterContentAnnotations(this$static, known){
  var interested;
  interested = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringSetAdapter_0(new HashSet_0));
  $each_3(known, new PasteAnnotationLogic$4_0(this$static, interested));
  return interested;
}

function $interpretReplace(this$static, key, type, builder, inside, outside, current, changeCollector){
  var logic;
  logic = $getClosestBehaviour(this$static.annotationLogic, key);
  if (logic) {
    switch (logic.replace_0(inside, outside, type).ordinal) {
      case 0:
        return $safeSet(builder, key, (checkNotNull_1(key, 'StringMap cannot contain null keys') , inside.backend.get(key)), (checkNotNull_1(key, 'StringMap cannot contain null keys') , current.backend.get(key)), changeCollector);
      case 1:
        return $safeSet(builder, key, (checkNotNull_1(key, 'StringMap cannot contain null keys') , outside.backend.get(key)), (checkNotNull_1(key, 'StringMap cannot contain null keys') , current.backend.get(key)), changeCollector);
      case 2:
        return $safeSet(builder, key, null, (checkNotNull_1(key, 'StringMap cannot contain null keys') , current.backend.get(key)), changeCollector);
    }
  }
  return false;
}

function $safeSet(builder, key, newValue, oldValue, changeCollector){
  var newString, oldString;
  newString = newValue == null?null:toString__devirtual$(newValue);
  oldString = oldValue == null?null:toString__devirtual$(oldValue);
  if (newString == null?oldString != null:!$equals_3(newString, oldString)) {
    $add_9(builder.mutationList, new Nindo$StartAnnotation_0(key, newString));
    checkNotNull_1(key, 'StringMap cannot contain null keys');
    changeCollector.backend.put(key, newString);
    return true;
  }
   else {
    return false;
  }
}

function $stripKeys(this$static, annotationSet, position, cursorBias, type, builder){
  var after, before, changedAnnotations, inside, outside;
  before = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  after = new CollectionUtils$StringMapAdapter_0(new HashMap_0);
  $each_3($knownKeys(annotationSet.doc), new PasteAnnotationLogic$1_0(position, annotationSet, before, after));
  inside = cursorBias == ($clinit_1073() , RIGHT_3)?after:before;
  outside = cursorBias == RIGHT_3?before:after;
  changedAnnotations = new CollectionUtils$StringMapAdapter_0(new HashMap_0);
  $each_3($knownKeys(annotationSet.doc), new PasteAnnotationLogic$2_0(this$static, type, builder, inside, outside, before, changedAnnotations));
  return changedAnnotations;
}

--></script>
<script><!--
function $unstripKeys(builder, stripKeys, ignoreSet){
  $each_3(stripKeys, new PasteAnnotationLogic$3_0(ignoreSet, builder));
}

function PasteAnnotationLogic_0(doc, annotationLogic){
  this.doc = doc;
  this.annotationLogic = annotationLogic;
}

function trimAnnotations(rangedAnnotations, offset, length_0){
  var ann, ann$iterator, nEnd, nStart, ret, iterator;
  ret = new ArrayList_0;
  for (ann$iterator = (iterator = rangedAnnotations.val$iterable.iterator_0() , new IndexedDocumentImpl$9$1_0(iterator)); ann$iterator.val$iterator.hasNext();) {
    ann = $next_13(ann$iterator);
    nStart = max(0, ann.start - offset);
    nEnd = min_0(ann.end - offset, length_0);
    $add_9(ret, new RangedAnnotationImpl_0(ann.key, dynamicCast(ann.value_0, 1), nStart, nEnd));
  }
  return ret;
}

function PasteAnnotationLogic(){
}

_ = PasteAnnotationLogic_0.prototype = PasteAnnotationLogic.prototype = new Object_0;
_.getClass$ = function getClass_579(){
  return Lorg_waveprotocol_wave_client_editor_extract_PasteAnnotationLogic_2_classLit;
}
;
_.castableTypeMap$ = {};
_.annotationLogic = null;
_.doc = null;
function PasteAnnotationLogic$1_0(val$position, val$annotationSet, val$before, val$after){
  this.val$position = val$position;
  this.val$annotationSet = val$annotationSet;
  this.val$before = val$before;
  this.val$after = val$after;
}

function PasteAnnotationLogic$1(){
}

_ = PasteAnnotationLogic$1_0.prototype = PasteAnnotationLogic$1.prototype = new Object_0;
_.apply_3 = function apply_18(key){
  var afterV, beforeV;
  if (this.val$position > 0) {
    beforeV = $getAnnotation_2(this.val$annotationSet.doc, this.val$position - 1, key);
    beforeV != null && $put_5(this.val$before, key, beforeV);
  }
  if (this.val$position < $size_10(this.val$annotationSet.doc)) {
    afterV = $getAnnotation_2(this.val$annotationSet.doc, this.val$position, key);
    afterV != null && $put_5(this.val$after, key, afterV);
  }
}
;
_.getClass$ = function getClass_580(){
  return Lorg_waveprotocol_wave_client_editor_extract_PasteAnnotationLogic$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$after = null;
_.val$annotationSet = null;
_.val$before = null;
_.val$position = 0;
function PasteAnnotationLogic$2_0(this$0, val$type, val$builder, val$inside, val$outside, val$before, val$changedAnnotations){
  this.this$0 = this$0;
  this.val$type = val$type;
  this.val$builder = val$builder;
  this.val$inside = val$inside;
  this.val$outside = val$outside;
  this.val$before = val$before;
  this.val$changedAnnotations = val$changedAnnotations;
}

function PasteAnnotationLogic$2(){
}

_ = PasteAnnotationLogic$2_0.prototype = PasteAnnotationLogic$2.prototype = new Object_0;
_.apply_3 = function apply_19(key){
  $interpretReplace(this.this$0, key, this.val$type, this.val$builder, this.val$inside, this.val$outside, this.val$before, this.val$changedAnnotations);
}
;
_.getClass$ = function getClass_581(){
  return Lorg_waveprotocol_wave_client_editor_extract_PasteAnnotationLogic$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$before = null;
_.val$builder = null;
_.val$changedAnnotations = null;
_.val$inside = null;
_.val$outside = null;
_.val$type = null;
function PasteAnnotationLogic$3_0(val$ignoreSet, val$builder){
  this.val$ignoreSet = val$ignoreSet;
  this.val$builder = val$builder;
}

function PasteAnnotationLogic$3(){
}

_ = PasteAnnotationLogic$3_0.prototype = PasteAnnotationLogic$3.prototype = new Object_0;
_.apply_3 = function apply_20(element){
  $contains_7(this.val$ignoreSet, element) || ($add_9(this.val$builder.mutationList, new Nindo$EndAnnotation_0(element)) , undefined);
}
;
_.getClass$ = function getClass_582(){
  return Lorg_waveprotocol_wave_client_editor_extract_PasteAnnotationLogic$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$builder = null;
_.val$ignoreSet = null;
function PasteAnnotationLogic$4_0(this$0, val$interested){
  this.this$0 = this$0;
  this.val$interested = val$interested;
}

function PasteAnnotationLogic$4(){
}

_ = PasteAnnotationLogic$4_0.prototype = PasteAnnotationLogic$4.prototype = new Object_0;
_.apply_3 = function apply_21(key){
  var behaviour;
  behaviour = $getClosestBehaviour(this.this$0.annotationLogic, key);
  !!behaviour && behaviour.getAnnotationFamily() == ($clinit_1072() , CONTENT) && $add_20(this.val$interested, key);
}
;
_.getClass$ = function getClass_583(){
  return Lorg_waveprotocol_wave_client_editor_extract_PasteAnnotationLogic$4_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$interested = null;
function $clinit_895(){
  $clinit_895 = nullMethod;
  LOG_1 = new DomLogger_0('paste');
  clipboard = ($clinit_494() , $clinit_494() , INSTANCE_2);
  pasteBuffer_0 = clipboard.pasteBuffer;
  !INSTANCE_10 && (INSTANCE_10 = new PasteFormatRenderer_0);
}

function $at_0(pos){
  var builder;
  builder = new Nindo$Builder_0;
  checkState(!builder.hasBeenUsed, 'Cannot reuse a builder');
  builder.hasBeenUsed = true;
  $add_9(builder.mutationList, new Nindo$Skip_0(pos));
  return builder;
}

function $extract(this$static, srcContainer, previousSelection, cursorBias){
  var $e0, affectedKeys, ann, ann$iterator, annotations, builder, caret, createdFromXmlString, cursorLocation, deserialize, destDoc, destOperationSequencer, end, locationAfter, mapper, modified, mutationBuilder, nindo, pos, range, start, startTime, timeTaken, tokenizer, waveXml, annotations_0;
  destDoc = this$static.mutableDocument;
  destOperationSequencer = this$static.operationSequencer;
  mapper = this$static.mutableDocument;
  start = getFilteredPoint(this$static.persistentContent, previousSelection.first);
  end = getFilteredPoint(this$static.persistentContent, previousSelection.second);
  if (!previousSelection.isCollapsed) {
    range = $deleteRange_0(destDoc, start, end);
    end = range.second;
  }
  pos = (checkNotNull_1(end, 'getLocation: Null point') , $getLocation_4(mapper.doc, end));
  waveXml = null;
  annotations = null;
  if (this$static.useSemanticCopyPaste) {
    waveXml = $maybeGetWaveXml(srcContainer);
    annotations = (annotations_0 = $maybeGetAttributeFromContainer(srcContainer, 'data-wave-annotations') , annotations_0 != null && $log_0(LOG.traceLogger, 'found serialized annotations: ' + annotations_0) , annotations_0);
  }
  cursorBias = ($clinit_1073() , LEFT_3);
  if (this$static.useSemanticCopyPaste && waveXml != null) {
    if (waveXml.length) {
      $clinit_670();
      builder = $at_0(pos);
      createdFromXmlString = createFromXmlStringWithContraints(waveXml, ($clinit_1271() , BLIP_TEXT));
      modified = $stripKeys(this$static.annotationLogic, destDoc, pos, cursorBias, ($clinit_1074() , RICH_TEXT), builder);
      startTime = (new Date).getTime();
      appendXmlToBuilder(createdFromXmlString, builder);
      timeTaken = (new Date).getTime() - startTime;
      $log_0(LOG_1.traceLogger, 'time taken: ' + timeTaken);
      $unstripKeys(builder, new CollectionUtils$StringSetAdapter_0(modified.backend.keySet_0()), ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringSetAdapter_0(new HashSet_0)));
      nindo = new Nindo_0(builder.mutationList);
      try {
        $maybeThrowOperationExceptionFor_0(this$static.validator, nindo);
        locationAfter = (checkNotNull_1(end, 'getLocation: Null point') , $getLocation_4(destDoc.doc, end)) + createdFromXmlString.length_0;
        $push_1(destOperationSequencer.responsibility.sequenceType, ($clinit_692() , DIRECT));
        $consumeAndReturnInvertible_0(destOperationSequencer.sequencer.sink, nindo);
        $endDirectSequence(destOperationSequencer.responsibility);
        $setCaret(this$static.aggressiveSelectionHelper, locationAfter);
        $log_0(LOG_1.traceLogger, 'annotations: ' + annotations);
        if (annotations != null && !!annotations.length) {
          deserialize = deserialize_0(annotations);
          for (ann$iterator = new AbstractList$IteratorImpl_0(deserialize); ann$iterator.i < ann$iterator.this$0_0.size_0();) {
            ann = dynamicCast($next_6(ann$iterator), 142);
            $setAnnotation(destDoc, pos + ann.start, pos + ann.end, ann.key, dynamicCast(ann.value_0, 1));
            $log_0(LOG_1.traceLogger, 'pos: ' + pos + 'start: ' + (pos + ann.start) + ' end: ' + (pos + ann.end) + ' key: ' + ann.key + ' value: ' + dynamicCast(ann.value_0, 1));
          }
        }
      }
       catch ($e0) {
        $e0 = caught_0($e0);
        if (instanceOf($e0, 189)) {
          $log_0(LOG_1.errorLogger, 'Semantic paste failed');
          $setCaret_0(this$static.aggressiveSelectionHelper, end);
        }
         else 
          throw $e0;
      }
    }
  }
   else {
    $clinit_670();
    tokenizer = new RichTextTokenizerImpl_0(new HtmlViewImpl_0(srcContainer));
    builder = $at_0(pos);
    modified = $stripKeys(this$static.annotationLogic, destDoc, pos, cursorBias, ($clinit_1074() , RICH_TEXT), builder);
    mutationBuilder = new RichTextMutationBuilder_0(modified);
    affectedKeys = $applyMutations(mutationBuilder, tokenizer, builder, destDoc, dynamicCast(end.container, 163));
    $unstripKeys(builder, new CollectionUtils$StringSetAdapter_0(modified.backend.keySet_0()), affectedKeys);
    nindo = new Nindo_0(builder.mutationList);
    try {
      $maybeThrowOperationExceptionFor_0(this$static.validator, nindo);
      $push_1(destOperationSequencer.responsibility.sequenceType, ($clinit_692() , DIRECT));
      $consumeAndReturnInvertible_0(destOperationSequencer.sequencer.sink, nindo);
      $endDirectSequence(destOperationSequencer.responsibility);
      cursorLocation = pos + mutationBuilder.lastGoodCursorOffset;
      caret = $locate_0(mapper.doc, cursorLocation);
      $setCaret_0(this$static.aggressiveSelectionHelper, caret);
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 189)) {
        $log_0(LOG_1.errorLogger, 'Paste failed');
        $setCaret_0(this$static.aggressiveSelectionHelper, end);
      }
       else 
        throw $e0;
    }
  }
  srcContainer.innerHTML = '';
  focus_3(dynamicCast(destDoc.doc.substrate.getDocumentElement(), 152).containerNodelet);
}

function $handleCopyOrCutEvent(this$static, isCut){
  var contentSelection, selection, selection_0;
  contentSelection = (selection_0 = $getSelectionPoints(this$static.aggressiveSelectionHelper) , !selection_0?null:$asOrderedRange(selection_0, ($clinit_973() , true)));
  if (!contentSelection) {
    return true;
  }
  selection = $getSelectionRange(this$static.aggressiveSelectionHelper);
  $performCopyOrCut(this$static, contentSelection, isCut);
  this$static.busy = true;
  $addCommand(new PasteExtractor$2_0(this$static, isCut, selection));
  return false;
}

function $handlePasteEvent(this$static, cursorBias){
  var previousSelection, selection;
  previousSelection = (selection = $getSelectionPoints(this$static.aggressiveSelectionHelper) , !selection?null:$asOrderedRange(selection, ($clinit_973() , true)));
  if (!previousSelection) {
    return true;
  }
  this$static.busy = true;
  $prepareForPaste(pasteBuffer_0);
  $addCommand(new PasteExtractor$1_0(this$static, previousSelection, cursorBias));
  return false;
}

function $performCopyOrCut(this$static, contentSelection, isCut){
  var $e0, commonAncestor, debugString, e, first, fragment, newRange, normalizedAnnotations, normalizedEnd, normalizedStart, second, selectionMatcher, xmlInRange;
  if (contentSelection.isCollapsed) {
    return;
  }
  first = contentSelection.first;
  second = contentSelection.second;
  selectionMatcher = new SelectionMatcher_0(first, second);
  commonAncestor = dynamicCast(nearestCommonAncestor_0(this$static.renderedContent, dynamicCast(first.container, 163), dynamicCast(second.container, 163)), 163);
  fragment = $renderTree(this$static.renderedContent, commonAncestor, selectionMatcher);
  checkNotNull_1(selectionMatcher.htmlStart?selectionMatcher.htmlStart.getPoint():null, 'html start is null, first: ' + first);
  checkNotNull_1(selectionMatcher.htmlEnd?selectionMatcher.htmlEnd.getPoint():null, 'html end is null second: ' + second);
  newRange = new PointRange_1(selectionMatcher.htmlStart?selectionMatcher.htmlStart.getPoint():null, selectionMatcher.htmlEnd?selectionMatcher.htmlEnd.getPoint():null);
  normalizedStart = getFilteredPoint(this$static.persistentContent, contentSelection.first);
  normalizedEnd = getFilteredPoint(this$static.persistentContent, contentSelection.second);
  if (this$static.useSemanticCopyPaste) {
    debugString = 'Start: ' + contentSelection.first + ' End: ' + contentSelection.second + ' docDebug: ' + $toDebugString(this$static.mutableDocument.doc);
    try {
      xmlInRange = $renderRange(this$static.subtreeRenderer, normalizedStart, normalizedEnd);
      normalizedAnnotations = $extractNormalizedAnnotation(this$static.annotationLogic, normalizedStart, normalizedEnd);
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 143)) {
        e = $e0;
        $logPlainText(LOG_1.errorLogger, debugString);
        throw new RuntimeException_3(e);
      }
       else 
        throw $e0;
    }
  }
   else {
    xmlInRange = null;
    normalizedAnnotations = null;
  }
  isCut && $deleteRange_0(this$static.mutableDocument, normalizedStart, normalizedEnd).first;
  $fillBufferAndSetSelection(clipboard, fragment, newRange, xmlInRange, normalizedAnnotations);
}

function PasteExtractor_0(aggressiveSelectionHelper, mutableDocument, renderedContent, persistentContent, annotationRegistry, operationSequencer, validator){
  $clinit_895();
  this.aggressiveSelectionHelper = aggressiveSelectionHelper;
  this.mutableDocument = mutableDocument;
  this.operationSequencer = operationSequencer;
  this.renderedContent = renderedContent;
  this.persistentContent = persistentContent;
  this.validator = validator;
  this.subtreeRenderer = new SubTreeXmlRenderer_0(mutableDocument);
  this.annotationLogic = new PasteAnnotationLogic_0(mutableDocument, annotationRegistry);
  this.useSemanticCopyPaste = true;
}

function PasteExtractor(){
}

_ = PasteExtractor_0.prototype = PasteExtractor.prototype = new Object_0;
_.getClass$ = function getClass_584(){
  return Lorg_waveprotocol_wave_client_editor_extract_PasteExtractor_2_classLit;
}
;
_.castableTypeMap$ = {};
_.aggressiveSelectionHelper = null;
_.annotationLogic = null;
_.busy = false;
_.mutableDocument = null;
_.operationSequencer = null;
_.persistentContent = null;
_.renderedContent = null;
_.subtreeRenderer = null;
_.useSemanticCopyPaste = false;
_.validator = null;
var LOG_1, clipboard, pasteBuffer_0;
function PasteExtractor$1_0(this$0, val$previousSelection, val$cursorBias){
  this.this$0 = this$0;
  this.val$previousSelection = val$previousSelection;
  this.val$cursorBias = val$cursorBias;
}

function PasteExtractor$1(){
}

_ = PasteExtractor$1_0.prototype = PasteExtractor$1.prototype = new Object_0;
_.execute = function execute_27(){
  $extract(this.this$0, ($clinit_895() , pasteBuffer_0).element, this.val$previousSelection, this.val$cursorBias);
  this.this$0.busy = false;
}
;
_.getClass$ = function getClass_585(){
  return Lorg_waveprotocol_wave_client_editor_extract_PasteExtractor$1_2_classLit;
}
;
_.castableTypeMap$ = {28:1, 32:1};
_.this$0 = null;
_.val$cursorBias = null;
_.val$previousSelection = null;
function PasteExtractor$2_0(this$0, val$isCut, val$selection){
  this.this$0 = this$0;
  this.val$isCut = val$isCut;
  this.val$selection = val$selection;
}

function PasteExtractor$2(){
}

_ = PasteExtractor$2_0.prototype = PasteExtractor$2.prototype = new Object_0;
_.execute = function execute_28(){
  this.val$isCut?$setCaret(this.this$0.aggressiveSelectionHelper, $asRange(this.val$selection).start):$setSelectionRange(this.this$0.aggressiveSelectionHelper, this.val$selection);
  this.this$0.busy = false;
}
;
_.getClass$ = function getClass_586(){
  return Lorg_waveprotocol_wave_client_editor_extract_PasteExtractor$2_2_classLit;
}
;
_.castableTypeMap$ = {28:1, 32:1};
_.this$0 = null;
_.val$isCut = false;
_.val$selection = null;
function $renderTree(view, node, selectionMatcher){
  var holder;
  holder = $doc.createElement('div');
  renderSequence_0(view, node, node.next, holder, selectionMatcher);
  return holder;
}

function PasteFormatRenderer_0(){
}

function getSemanticHandler(node){
  var element, handler;
  if (node != null && node.castableTypeMap$ && !!node.castableTypeMap$[187]) {
    element = dynamicCast(node, 187);
    handler = $getNiceHtmlRenderer(element.registry, element);
    return handler?handler:($clinit_899() , DEEP_CLONE_RENDERER);
  }
   else {
    return $clinit_899() , DEEP_CLONE_RENDERER;
  }
}

function renderChildren(view, parent_0, contentParent, selectionMatcher){
  var current, done, semanticHandler;
  current = contentParent.getFirstChild();
  while (current) {
    done = (semanticHandler = getSemanticHandler(current) , semanticHandler.renderSequence(view, current, null, parent_0, selectionMatcher));
    current = dynamicCast(view.getNextSibling(done), 163);
  }
}

function renderSequence_0(view, firstItem, stopAt, dstParent, selectionMatcher){
  var semanticHandler;
  semanticHandler = getSemanticHandler(firstItem);
  return semanticHandler.renderSequence(view, firstItem, stopAt, dstParent, selectionMatcher);
}

function PasteFormatRenderer(){
}

_ = PasteFormatRenderer_0.prototype = PasteFormatRenderer.prototype = new Object_0;
_.getClass$ = function getClass_587(){
  return Lorg_waveprotocol_wave_client_editor_extract_PasteFormatRenderer_2_classLit;
}
;
_.castableTypeMap$ = {};
var INSTANCE_10 = null;
function $clinit_899(){
  $clinit_899 = nullMethod;
  DEEP_CLONE_RENDERER = new PasteFormatRenderers$1_0;
  SHALLOW_CLONE_RENDERER = new PasteFormatRenderers$2_0;
}

var DEEP_CLONE_RENDERER, SHALLOW_CLONE_RENDERER;
function PasteFormatRenderers$1_0(){
}

function PasteFormatRenderers$1(){
}

_ = PasteFormatRenderers$1_0.prototype = PasteFormatRenderers$1.prototype = new Object_0;
_.getClass$ = function getClass_588(){
  return Lorg_waveprotocol_wave_client_editor_extract_PasteFormatRenderers$1_2_classLit;
}
;
_.renderSequence = function renderSequence_1(view, firstItem, stopAt, dstParent, selectionMatcher){
  var clone, implNodelet;
  firstItem != null && firstItem.castableTypeMap$ && !!firstItem.castableTypeMap$[152] && $log_0(($clinit_672() , logger_1).traceLogger, 'deep cloning: ' + dynamicCast(firstItem, 152).tagName_0);
  implNodelet = firstItem.getImplNodelet();
  clone = implNodelet?implNodelet.cloneNode(true):null;
  if (clone) {
    dstParent.appendChild(clone);
    $maybeNoteHtml(selectionMatcher, firstItem, clone);
  }
   else {
    (maskUndefined(selectionMatcher.contentStart.container) === (firstItem == null?null:firstItem) || $equals_6(selectionMatcher.contentStart, new Point$El_0(firstItem.parent_0, firstItem))) && (selectionMatcher.htmlStart = dstParent.hasChildNodes()?new SelectionMatcher$LazyPointImpl_0(dstParent.lastChild, ($clinit_909() , AFTER_NODE)):new SelectionMatcher$LazyPointImpl_0(dstParent, ($clinit_909() , AT_START)));
    (maskUndefined(selectionMatcher.contentEnd.container) === (firstItem == null?null:firstItem) || $equals_6(selectionMatcher.contentEnd, new Point$El_0(firstItem.parent_0, firstItem))) && (selectionMatcher.htmlEnd = dstParent.hasChildNodes()?new SelectionMatcher$LazyPointImpl_0(dstParent.lastChild, ($clinit_909() , AFTER_NODE)):new SelectionMatcher$LazyPointImpl_0(dstParent, ($clinit_909() , AT_START)));
  }
  return firstItem;
}
;
_.castableTypeMap$ = {178:1};
function PasteFormatRenderers$2_0(){
}

function PasteFormatRenderers$2(){
}

_ = PasteFormatRenderers$2_0.prototype = PasteFormatRenderers$2.prototype = new Object_0;
_.getClass$ = function getClass_589(){
  return Lorg_waveprotocol_wave_client_editor_extract_PasteFormatRenderers$2_2_classLit;
}
;
_.renderSequence = function renderSequence_2(view, firstItem, stopAt, dstParent, selectionMatcher){
  var clone, container, implNodelet;
  implNodelet = firstItem.getImplNodelet();
  clone = implNodelet?implNodelet.cloneNode(false):null;
  if (clone) {
    dstParent.appendChild(clone);
    $maybeNoteHtml(selectionMatcher, firstItem, clone);
  }
   else {
    (maskUndefined(selectionMatcher.contentStart.container) === (firstItem == null?null:firstItem) || $equals_6(selectionMatcher.contentStart, new Point$El_0(firstItem.parent_0, firstItem))) && (selectionMatcher.htmlStart = dstParent.hasChildNodes()?new SelectionMatcher$LazyPointImpl_0(dstParent.lastChild, ($clinit_909() , AFTER_NODE)):new SelectionMatcher$LazyPointImpl_0(dstParent, ($clinit_909() , AT_START)));
    (maskUndefined(selectionMatcher.contentEnd.container) === (firstItem == null?null:firstItem) || $equals_6(selectionMatcher.contentEnd, new Point$El_0(firstItem.parent_0, firstItem))) && (selectionMatcher.htmlEnd = dstParent.hasChildNodes()?new SelectionMatcher$LazyPointImpl_0(dstParent.lastChild, ($clinit_909() , AFTER_NODE)):new SelectionMatcher$LazyPointImpl_0(dstParent, ($clinit_909() , AT_START)));
  }
  if (firstItem != null && firstItem.castableTypeMap$ && !!firstItem.castableTypeMap$[152]) {
    !!clone && !!clone?(container = clone):(container = dstParent);
    renderChildren(view, container, firstItem, selectionMatcher);
  }
  return firstItem;
}
;
_.castableTypeMap$ = {178:1};
function $clinit_903(){
  $clinit_903 = nullMethod;
  $clinit_81();
  $push_0(toInject, ($clinit_176() , '.GMQ4-KSBDH{border:1px solid red;background-color:#ffc0c0;}.GMQ4-KSBBH{border:2px solid red;background-color:#ffc0c0;color:#c00;text-decoration:line-through;}.GMQ4-KSBCH{background-color:#ccc;text-decoration:line-through;}'));
  flush();
}

function $flashShowRepair(regionNode){
  var t;
  $log_0(($clinit_672() , logger_1).errorLogger, 'repairing region: ' + regionNode);
  if (!regionNode.implNodelet) {
    return;
  }
  $addClassName(regionNode.implNodelet, 'GMQ4-KSBDH');
  t = new Repairer$1_0(regionNode);
  $cancel_1(t.timerService.scheduler, t);
  t.isRepeating = false;
  t.isRepeating = false;
  t.scheduledAgain = true;
  $scheduleDelayed_1(t.timerService, t);
}

function $handle(this$static, error){
  $log_4(($clinit_672() , logger_1).errorLogger, 'handleMissing: ', error);
  $revert(this$static, before_0(this$static.renderedView, error.brokenNode), null);
}

function $handleInserted(this$static, error){
  $log_4(($clinit_672() , logger_1).errorLogger, 'handleInserted: ', error);
  $revert(this$static, error.contentPoint, null);
}

function $handleMissing(this$static, error){
  $log_4(($clinit_672() , logger_1).errorLogger, 'handleMissing: ', error);
  $revert(this$static, before_0(this$static.renderedView, error.brokenNode), null);
}

function $hideDeath(regionNode){
  !!regionNode.implNodelet && $removeClassName(regionNode.implNodelet, 'GMQ4-KSBBH');
}

function $reattachImplChildren_0(this$static, parentNodelet, nodeletBefore, nodeletAfter, first, last){
  var node, nodelet;
  while (true) {
    nodelet = !nodeletBefore?this$static.strippingView.getFirstChild_1(parentNodelet):this$static.strippingView.getNextSibling_0(nodeletBefore);
    if (!nodelet || nodelet == nodeletAfter) {
      break;
    }
    !!$getParentElement(nodelet) && $removeFromParent(nodelet);
  }
  for (node = first; node != last; node = dynamicCast($getNextSibling_3(this$static.renderedView, node), 163)) {
    parentNodelet.insertBefore(node.getImplNodelet(), nodeletAfter);
  }
}

function $revert(this$static, start, end){
  $onRangeRevert(this$static.listener);
  $revertWithoutNotification(this$static, start, end);
}

function $revert_0(this$static, doc, element){
  var end, start;
  start = new Point$El_0(element, doc.getFirstChild_0(element));
  end = new Point$El_0(element, null);
  (element == null?null:element) === maskUndefined(doc.inner_0.getDocumentElement())?$onFullDocumentRevert(this$static.listener):$onRangeRevert(this$static.listener);
  $revertWithoutNotification(this$static, start, end);
}

function $revertInner(this$static, start, end){
  var before, first, last, node, nodeletAfter, nodeletBefore, parentNodelet, renderedContent, node_0;
  renderedContent = this$static.renderedView;
  before = dynamicCast((node_0 = $getNodeAfter(start) , node_0 == null?renderedContent.getLastChild_0(start.container):renderedContent.getPreviousSibling(node_0)), 163);
  nodeletBefore = !before?null:before.getImplNodelet();
  !nodeletBefore?(parentNodelet = dynamicCast($getVisibleNode(renderedContent, dynamicCast(start.container, 163)), 163).getImplNodelet()):(parentNodelet = $getParentElement(nodeletBefore));
  first = dynamicCast($getNodeAfter(start), 163);
  last = !end?null:dynamicCast($getNodeAfter(end), 163);
  for (node = first; node != last; node = dynamicCast($getNextSibling_3(renderedContent, node), 163)) {
    if (!end && node.isConsistent_0()) {
      break;
    }
    node.revertImplementation();
  }
  nodeletAfter = !node?null:node.getImplNodelet();
  $reattachImplChildren_0(this$static, parentNodelet, nodeletBefore, nodeletAfter, first, node);
}

function $revertWithoutNotification(this$static, start, end){
  var $e0, $e1, attempt, t1, t2;
  if (start.container == null) {
    $revert_0(this$static, this$static.renderedView, dynamicCast(this$static.renderedView.inner_0.getDocumentElement(), 152));
    return;
  }
  $clinit_672();
  ++ignoreMutations;
  try {
    $logPlainText(logger_1.errorLogger, 'REPAIRING!! ' + start.container);
    $flashShowRepair(dynamicCast(start.container, 152));
    try {
      $revertInner(this$static, start, end);
      return;
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 4)) {
        t1 = $e0;
        $logPlainText(logger_1.errorLogger, 'exception while revertInner: ' + t1);
        for (attempt = dynamicCast(start.container, 163); attempt; attempt = attempt.parent_0) {
          try {
            attempt.revertImplementation();
            return;
          }
           catch ($e1) {
            $e1 = caught_0($e1);
            if (instanceOf($e1, 4)) {
              t2 = $e1;
              $logPlainText(logger_1.errorLogger, 'Exception while revertImplementation: ' + t2);
              if ((attempt == null?null:attempt) === maskUndefined(this$static.persistentView.inner_0.getDocumentElement())) {
                throw t1;
              }
            }
             else 
              throw $e1;
          }
        }
      }
       else 
        throw $e0;
    }
  }
   finally {
    --ignoreMutations;
  }
  $logPlainText(logger_1.traceLogger, 'Revert successful');
}

function $showDeath(regionNode){
  !!regionNode.implNodelet && $addClassName(regionNode.implNodelet, 'GMQ4-KSBBH');
}

function $zipRange(this$static, range){
  var $e0;
  try {
    return $zipChildrenExcludingFrom(dynamicCast(range.after.container, 152), dynamicCast(range.nodeBefore, 163), dynamicCast($getNodeAfter(range.after), 163));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 4)) {
      $revert(this$static, $getPointBefore(range, this$static.persistentView), range.after);
      return true;
    }
     else 
      throw $e0;
  }
}

function Repairer_0(persistentView, renderedView, strippingView, listener){
  $clinit_903();
  this.persistentView = persistentView;
  this.renderedView = renderedView;
  this.strippingView = strippingView;
  this.listener = listener;
}

function Repairer(){
}

_ = Repairer_0.prototype = Repairer.prototype = new Object_0;
_.getClass$ = function getClass_590(){
  return Lorg_waveprotocol_wave_client_editor_extract_Repairer_2_classLit;
}
;
_.castableTypeMap$ = {};
_.listener = null;
_.persistentView = null;
_.renderedView = null;
_.strippingView = null;
function ScheduleTimer_0(timerService){
  this.timerService = timerService;
}

function ScheduleTimer_1(priority){
  ScheduleTimer_0.call(this, new SchedulerTimerService_1((!instance_6 && (instance_6 = new BrowserBackedScheduler_0 , setDefaultTimerService() , undefined) , instance_6), priority));
}

function ScheduleTimer(){
}

_ = ScheduleTimer.prototype = new Object_0;
_.execute_1 = function execute_29(){
  this.scheduledAgain = false;
  $removeClassName(this.val$regionNode.implNodelet, ($clinit_903() , 'GMQ4-KSBDH'));
  return this.isRepeating || this.scheduledAgain;
}
;
_.getClass$ = function getClass_591(){
  return Lorg_waveprotocol_wave_client_scheduler_ScheduleTimer_2_classLit;
}
;
_.castableTypeMap$ = {208:1, 210:1};
_.isRepeating = false;
_.scheduledAgain = false;
_.timerService = null;
function Repairer$1_0(val$regionNode){
  this.val$regionNode = val$regionNode;
  ScheduleTimer_1.call(this, ($clinit_1013() , LOW));
}

function Repairer$1(){
}

_ = Repairer$1_0.prototype = Repairer$1.prototype = new ScheduleTimer;
_.getClass$ = function getClass_592(){
  return Lorg_waveprotocol_wave_client_editor_extract_Repairer$1_2_classLit;
}
;
_.castableTypeMap$ = {208:1, 210:1};
_.val$regionNode = null;
function $getCorespondingPointInEmptyElement(selection, source, clone){
  return source != null && source.castableTypeMap$ && !!source.castableTypeMap$[152] && !source.getFirstChild() && $equals_6(selection, new Point$El_0(source, null))?clone?new SelectionMatcher$EagerPoint_0(new Point$El_0(clone, null)):new SelectionMatcher$EagerPoint_0(new Point$El_0($getParentElement(null), null)):null;
}

function $matchTextSelection(selection, source, clone){
  return selection.offset >= 0 && maskUndefined(selection.container) === (source == null?null:source)?new SelectionMatcher$EagerPoint_0(new Point$Tx_0(clone, $getTextOffset(selection))):null;
}

--></script>
<script><!--
function $maybeNoteHtml(this$static, source, clone){
  var matchedTextSelection, p, matchedTextSelection_0, p_0;
  checkArgument_0(!!source, 'Source must be non-null');
  checkArgument_0(!!source.parent_0, 'Source must have parent.');
  if (!this$static.htmlStart) {
    $equals_6(this$static.contentStart, new Point$El_0(source.parent_0, source))?(this$static.htmlStart = new SelectionMatcher$LazyPointImpl_0(clone, ($clinit_909() , BEFORE_NODE))):$equals_6(this$static.contentStart, new Point$El_0(source.parent_0, source.next)) && (this$static.htmlStart = new SelectionMatcher$LazyPointImpl_0(clone, ($clinit_909() , AFTER_NODE)));
    matchedTextSelection = $matchTextSelection(this$static.contentStart, source, clone);
    !!matchedTextSelection && (this$static.htmlStart = matchedTextSelection);
    p = $getCorespondingPointInEmptyElement(this$static.contentStart, source, clone);
    !!p && (this$static.htmlStart = p);
  }
  if (!this$static.htmlEnd) {
    $equals_6(this$static.contentEnd, new Point$El_0(source.parent_0, source))?(this$static.htmlEnd = new SelectionMatcher$LazyPointImpl_0(clone, ($clinit_909() , BEFORE_NODE))):$equals_6(this$static.contentEnd, new Point$El_0(source.parent_0, source.next)) && (this$static.htmlEnd = new SelectionMatcher$LazyPointImpl_0(clone, ($clinit_909() , AFTER_NODE)));
    matchedTextSelection_0 = $matchTextSelection(this$static.contentEnd, source, clone);
    !!matchedTextSelection_0 && (this$static.htmlEnd = matchedTextSelection_0);
    p_0 = $getCorespondingPointInEmptyElement(this$static.contentEnd, source, clone);
    !!p_0 && (this$static.htmlEnd = p_0);
  }
}

function SelectionMatcher_0(contentStart, contentEnd){
  this.contentStart = contentStart;
  this.contentEnd = contentEnd;
}

function SelectionMatcher(){
}

_ = SelectionMatcher_0.prototype = SelectionMatcher.prototype = new Object_0;
_.getClass$ = function getClass_593(){
  return Lorg_waveprotocol_wave_client_editor_extract_SelectionMatcher_2_classLit;
}
;
_.castableTypeMap$ = {};
_.contentEnd = null;
_.contentStart = null;
_.htmlEnd = null;
_.htmlStart = null;
function SelectionMatcher$EagerPoint_0(p){
  this.explicit = p;
}

function SelectionMatcher$EagerPoint(){
}

_ = SelectionMatcher$EagerPoint_0.prototype = SelectionMatcher$EagerPoint.prototype = new Object_0;
_.getClass$ = function getClass_594(){
  return Lorg_waveprotocol_wave_client_editor_extract_SelectionMatcher$EagerPoint_2_classLit;
}
;
_.getPoint = function getPoint(){
  return this.explicit;
}
;
_.castableTypeMap$ = {};
_.explicit = null;
function $clinit_909(){
  $clinit_909 = nullMethod;
  BEFORE_NODE = new SelectionMatcher$LazyPoint$Type_0('BEFORE_NODE', 0);
  AFTER_NODE = new SelectionMatcher$LazyPoint$Type_0('AFTER_NODE', 1);
  AT_START = new SelectionMatcher$LazyPoint$Type_0('AT_START', 2);
  $VALUES_30 = initValues(_3Lorg_waveprotocol_wave_client_editor_extract_SelectionMatcher$LazyPoint$Type_2_classLit, {58:1, 138:1}, 93, [BEFORE_NODE, AFTER_NODE, AT_START]);
}

function SelectionMatcher$LazyPoint$Type_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_31(){
  $clinit_909();
  return $VALUES_30;
}

function SelectionMatcher$LazyPoint$Type(){
}

_ = SelectionMatcher$LazyPoint$Type_0.prototype = SelectionMatcher$LazyPoint$Type.prototype = new Enum;
_.getClass$ = function getClass_595(){
  return Lorg_waveprotocol_wave_client_editor_extract_SelectionMatcher$LazyPoint$Type_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 93:1};
var $VALUES_30, AFTER_NODE, AT_START, BEFORE_NODE;
function SelectionMatcher$LazyPointImpl_0(ref, pointType){
  this.ref = ref;
  this.pointType = pointType;
}

function SelectionMatcher$LazyPointImpl(){
}

_ = SelectionMatcher$LazyPointImpl_0.prototype = SelectionMatcher$LazyPointImpl.prototype = new Object_0;
_.getClass$ = function getClass_596(){
  return Lorg_waveprotocol_wave_client_editor_extract_SelectionMatcher$LazyPointImpl_2_classLit;
}
;
_.getPoint = function getPoint_0(){
  var parent_0, parent_1;
  switch (this.pointType.ordinal) {
    case 1:
      return new Point$El_0((parent_0 = this.ref.parentNode , (!parent_0 || parent_0.nodeType != 1) && (parent_0 = null) , parent_0), this.ref.nextSibling);
    case 0:
      return new Point$El_0((parent_1 = this.ref.parentNode , (!parent_1 || parent_1.nodeType != 1) && (parent_1 = null) , parent_1), this.ref);
    case 2:
      return new Point$El_0(this.ref, this.ref.firstChild);
    default:throw new RuntimeException_1('invalid case');
  }
}
;
_.castableTypeMap$ = {};
_.pointType = null;
_.ref = null;
function $augmentBuilder(this$static, node, inclusion){
  var asElement, asText, builder, child, data, end, nodeRange, start, tStart;
  nodeRange = new Range_2($getLocation_3(this$static.doc.doc, dynamicCast(node, 163)), $getNodeEnd(this$static, node));
  builder = new XmlStringBuilderDoc_0(null, ($clinit_1271() , ANY));
  if (!$shouldInclude(inclusion, nodeRange)) {
    return builder;
  }
  asElement = this$static.doc.doc.substrate.asElement_0(node);
  if (this$static.doc.doc.substrate.asElement_0(node) != null) {
    for (child = this$static.doc.doc.substrate.getFirstChild_0(node); child != null; child = this$static.doc.doc.substrate.getNextSibling(child)) {
      $append_10(builder, $augmentBuilder(this$static, child, inclusion));
    }
    $wrap_1(builder, this$static.doc.doc.substrate.getTagName(asElement), ($clinit_1445() , new CollectionUtils$StringMapAdapter_0(this$static.doc.doc.substrate.getAttributes(asElement))));
  }
   else {
    asText = this$static.doc.doc.substrate.asText_0(node);
    tStart = $getLocation_3(this$static.doc.doc, dynamicCast(asText, 163));
    data = this$static.doc.doc.substrate.getData(asText);
    start = max(0, inclusion.start - tStart);
    end = min_0(data.length, inclusion.end - tStart);
    $appendText_0(builder, data.substr(start, end - start), BLIP_TEXT);
  }
  return builder;
}

function $getNodeEnd(this$static, node){
  var nextSibling, parent_0;
  nextSibling = this$static.doc.doc.substrate.getNextSibling(node);
  if (nextSibling != null) {
    return $getLocation_3(this$static.doc.doc, dynamicCast(nextSibling, 163));
  }
   else {
    parent_0 = this$static.doc.doc.substrate.getParentElement(node);
    return (parent_0 == null?null:parent_0) === maskUndefined(this$static.doc.doc.substrate.getDocumentElement())?$size_10(this$static.doc.doc):$getNodeEnd(this$static, parent_0) - 1;
  }
}

function $renderRange(this$static, start, end){
  var asElement, asText, builder, child, inclusion, nearestCommonAncestor, substring, tStart;
  nearestCommonAncestor = nearestCommonAncestor_0(this$static.doc, start.offset >= 0 || start.nodeAfter == null?start.container:start.nodeAfter, end.offset >= 0 || end.nodeAfter == null?end.container:end.nodeAfter);
  inclusion = new Range_2($getLocation_0(this$static.doc, start), $getLocation_0(this$static.doc, end));
  builder = new XmlStringBuilderDoc_0(null, ($clinit_1271() , BLIP_TEXT));
  asElement = this$static.doc.doc.substrate.asElement_0(nearestCommonAncestor);
  if (asElement != null) {
    for (child = this$static.doc.doc.substrate.getFirstChild_0(asElement); child != null; child = this$static.doc.doc.substrate.getNextSibling(child)) {
      $append_10(builder, $augmentBuilder(this$static, child, inclusion));
    }
    (asElement == null?null:asElement) !== maskUndefined(this$static.doc.doc.substrate.getDocumentElement()) && $shouldInclude(inclusion, new Range_2($getLocation_3(this$static.doc.doc, dynamicCast(asElement, 163)), $getNodeEnd(this$static, asElement))) && $wrap_1(builder, this$static.doc.doc.substrate.getTagName(asElement), ($clinit_1445() , new CollectionUtils$StringMapAdapter_0(this$static.doc.doc.substrate.getAttributes(asElement))));
  }
   else {
    asText = this$static.doc.doc.substrate.asText_0(nearestCommonAncestor);
    tStart = $getLocation_3(this$static.doc.doc, dynamicCast(asText, 163));
    substring = $substring_0(this$static.doc.doc.substrate.getData(asText), inclusion.start - tStart, inclusion.end - tStart);
    $appendText_0(builder, substring, BLIP_TEXT);
  }
  return builder;
}

function $shouldInclude(inclusion, nodeRange){
  if (nodeRange.start < inclusion.start && nodeRange.end > inclusion.end) {
    return false;
  }
  if (nodeRange.end <= inclusion.start || nodeRange.start >= inclusion.end) {
    return false;
  }
  return true;
}

function SubTreeXmlRenderer_0(doc){
  this.doc = doc;
}

function SubTreeXmlRenderer(){
}

_ = SubTreeXmlRenderer_0.prototype = SubTreeXmlRenderer.prototype = new Object_0;
_.getClass$ = function getClass_597(){
  return Lorg_waveprotocol_wave_client_editor_extract_SubTreeXmlRenderer_2_classLit;
}
;
_.castableTypeMap$ = {};
_.doc = null;
function $findTypingState(this$static, selection){
  var i, t;
  for (i = 0; i < this$static.numStates; ++i) {
    t = dynamicCast($get_3(this$static.statePool, i), 200);
    if (!t.contentRange) {
      continue;
    }
    if ($isPartOfThisState(t, selection)) {
      return t;
    }
  }
  return null;
}

function $flush_4(this$static){
  var i, t;
  $aboutToFlush(this$static.sink);
  for (i = 0; i < this$static.numStates; ++i) {
    t = dynamicCast($get_3(this$static.statePool, i), 200);
    if (!t.contentRange) {
      continue;
    }
    $flush_5(t);
  }
  this$static.numStates = 0;
}

function $getFreshTypingState(this$static){
  var t;
  ++this$static.numStates;
  if (this$static.numStates > this$static.statePool.size) {
    t = new TypingExtractor$TypingState_0(this$static);
    $add_9(this$static.statePool, t);
    return t;
  }
   else {
    return dynamicCast($get_3(this$static.statePool, this$static.numStates - 1), 200);
  }
}

function $isBusy(this$static){
  var i, t;
  for (i = 0; i < this$static.numStates; ++i) {
    t = dynamicCast($get_3(this$static.statePool, i), 200);
    if (!t.contentRange) {
      continue;
    }
    return true;
  }
  return false;
}

function $somethingHappened(this$static, previousSelectionStart){
  var filteredHtml, node, nodeAfter, nodeBefore, t;
  checkNotNull_1(previousSelectionStart, 'Typing extractor notified with null selection');
  node = previousSelectionStart.offset >= 0?dynamicCastJso(previousSelectionStart.container):null;
  if (!node) {
    filteredHtml = this$static.filteredHtmlView;
    nodeBefore = dynamicCastJso(nodeBefore_0(filteredHtml, previousSelectionStart.asElementPoint()));
    nodeAfter = dynamicCastJso($getNodeAfter(previousSelectionStart));
    if (!!nodeBefore && nodeBefore.nodeType == 3) {
      node = nodeBefore;
      previousSelectionStart = new Point$Tx_0(node, 0);
    }
     else if (!!nodeAfter && nodeAfter.nodeType == 3) {
      node = nodeAfter;
      previousSelectionStart = new Point$Tx_0(node, node.length);
    }
  }
  t = $findTypingState(this$static, previousSelectionStart);
  if (!t) {
    t = $getFreshTypingState(this$static);
    if (node) {
      checkNotNull_1(previousSelectionStart.asTextPoint(), 'previousSelectionStart must be a text point');
      $startTypingSequence_0(t, previousSelectionStart.asTextPoint());
    }
     else {
      checkState(previousSelectionStart.offset < 0, 'previousSelectionStart must not be a text point');
      $startTypingSequence(t, previousSelectionStart.asElementPoint());
    }
  }
   else {
    $continueTypingSequence(t, previousSelectionStart);
  }
  t.lastTextNode = node;
  $schedule_5(this$static.timerService, this$static.flushCmd);
}

function TypingExtractor_0(sink, manager, filteredHtmlView, renderedContentView, repairer, selectionSource){
  TypingExtractor_1.call(this, sink, manager, new SchedulerTimerService_1((!instance_6 && (instance_6 = new BrowserBackedScheduler_0 , setDefaultTimerService() , undefined) , instance_6), ($clinit_1013() , CRITICAL)), filteredHtmlView, renderedContentView, repairer, selectionSource);
}

function TypingExtractor_1(sink, manager, service, filteredHtmlView, renderedContentView, repairer, selectionSource){
  this.statePool = new ArrayList_0;
  this.sink = sink;
  this.manager = manager;
  this.selectionSource = selectionSource;
  this.timerService = service;
  this.filteredHtmlView = filteredHtmlView;
  this.renderedContentView = renderedContentView;
  this.repairer = repairer;
  this.flushCmd = new TypingExtractor$1_0(this);
}

function TypingExtractor(){
}

_ = TypingExtractor_0.prototype = TypingExtractor.prototype = new Object_0;
_.getClass$ = function getClass_598(){
  return Lorg_waveprotocol_wave_client_editor_extract_TypingExtractor_2_classLit;
}
;
_.castableTypeMap$ = {};
_.filteredHtmlView = null;
_.flushCmd = null;
_.manager = null;
_.numStates = 0;
_.renderedContentView = null;
_.repairer = null;
_.searchingForAdjacentArea = false;
_.selectionSource = null;
_.sink = null;
_.timerService = null;
function TypingExtractor$1_0(this$0){
  this.this$0 = this$0;
}

function TypingExtractor$1(){
}

_ = TypingExtractor$1_0.prototype = TypingExtractor$1.prototype = new Object_0;
_.execute = function execute_30(){
  $flush_4(this.this$0);
}
;
_.getClass$ = function getClass_599(){
  return Lorg_waveprotocol_wave_client_editor_extract_TypingExtractor$1_2_classLit;
}
;
_.castableTypeMap$ = {209:1, 210:1};
_.this$0 = null;
function $checkNeighbouringTextNodes(this$static, previousSelectionStart){
  var filteredHtml, nextNode, nextNodelet, prev, renderedContent, selNode, selOffset;
  if (this$static.this$0.searchingForAdjacentArea) {
    return;
  }
  try {
    this$static.this$0.searchingForAdjacentArea = true;
    filteredHtml = this$static.this$0.filteredHtmlView;
    renderedContent = this$static.this$0.renderedContentView;
    selNode = dynamicCastJso(previousSelectionStart.container);
    selOffset = $getTextOffset(previousSelectionStart);
    if (selOffset == 0 && this$static.firstWrapper.implNodelet == selNode) {
      prev = dynamicCast($getPreviousSibling_3(renderedContent, this$static.firstWrapper), 163);
      !!prev && prev.isTextNode() && (this$static.firstWrapper = dynamicCast(prev, 190));
    }
     else {
      nextNode = dynamicCast($getNextSibling_3(renderedContent, this$static.lastWrapper), 163);
      nextNodelet = nextNode?nextNode.getImplNodelet():null;
      selOffset == selNode.length && maskUndefined($getNextSibling_3(filteredHtml, selNode)) === (nextNodelet == null?null:nextNodelet) && !!nextNode && nextNode.isTextNode() && (this$static.lastWrapper = dynamicCast(nextNode, 190));
    }
  }
   finally {
    this$static.this$0.searchingForAdjacentArea = false;
  }
}

function $clear_9(this$static){
  this$static.contentRange = null;
  this$static.firstWrapper = null;
  this$static.lastWrapper = null;
  this$static.htmlRange = null;
  this$static.minpre = 0;
  this$static.lastTextNode = null;
}

function $continueTypingSequence(this$static, previousSelectionStart){
  if (this$static.firstWrapper) {
    $updateMinPre(this$static, previousSelectionStart);
    $checkNeighbouringTextNodes(this$static, previousSelectionStart);
  }
}

function $flush_5(this$static){
  var $e0, deleteEndIndex, deleteSize, deleting, e, insertEndIndex, inserting, minpostLeft, newValue, originalValue, start, startIndex, startNode, filteredHtml, fromIncl, toExcl;
  try {
    if (!this$static.contentRange) {
      return;
    }
    newValue = (filteredHtml = this$static.this$0.filteredHtmlView , fromIncl = dynamicCastJso($getStartNode(this$static.htmlRange, filteredHtml)) , toExcl = dynamicCastJso($getNodeAfter(this$static.htmlRange.after)) , sumTextNodes(fromIncl, toExcl, filteredHtml));
    if (!this$static.firstWrapper) {
      newValue.length > 0 && $typingReplace(this$static.this$0.sink, this$static.contentRange.after, 0, newValue, this$static.contentRange);
    }
     else {
      originalValue = this$static.firstWrapper.data_0 + (this$static.firstWrapper != this$static.lastWrapper?this$static.lastWrapper.data_0:'');
      $getOrderedHtmlSelection(this$static.this$0.selectionSource.this$0);
      $getOrderedHtmlSelection(this$static.this$0.selectionSource.this$0);
      this$static.minpre = 0;
      this$static.minpre < 0 && (this$static.minpre = 0);
      deleteEndIndex = originalValue.length;
      insertEndIndex = newValue.length;
      startIndex = min_0(this$static.minpre, deleteEndIndex);
      while (startIndex > 0 && originalValue.charCodeAt(startIndex - 1) != newValue.charCodeAt(startIndex - 1)) {
        --startIndex;
      }
      while (startIndex < deleteEndIndex && startIndex < insertEndIndex && originalValue.charCodeAt(startIndex) == newValue.charCodeAt(startIndex)) {
        ++startIndex;
      }
      minpostLeft = 0;
      while (minpostLeft > 0 && originalValue.charCodeAt(deleteEndIndex) != newValue.charCodeAt(insertEndIndex)) {
        ++deleteEndIndex;
        ++insertEndIndex;
        --minpostLeft;
      }
      while (startIndex < deleteEndIndex && startIndex < insertEndIndex && originalValue.charCodeAt(deleteEndIndex - 1) == newValue.charCodeAt(insertEndIndex - 1)) {
        --deleteEndIndex;
        --insertEndIndex;
      }
      deleting = startIndex < deleteEndIndex;
      inserting = startIndex < insertEndIndex;
      deleteSize = deleteEndIndex - startIndex;
      startNode = this$static.firstWrapper;
      if (this$static.firstWrapper.data_0.length < startIndex) {
        startIndex -= this$static.firstWrapper.data_0.length;
        startNode = this$static.lastWrapper;
      }
      start = new Point$Tx_0(startNode, startIndex);
      (deleting || inserting) && $typingReplace(this$static.this$0.sink, start, deleteSize, newValue.substr(startIndex, insertEndIndex - startIndex), this$static.contentRange);
    }
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 4)) {
      e = $e0;
      $log_3(($clinit_672() , logger_1).errorLogger, e);
      !this$static.contentRange?$revert_0(this$static.this$0.repairer, this$static.this$0.renderedContentView, dynamicCast(this$static.this$0.renderedContentView.inner_0.getDocumentElement(), 152)):$revert(this$static.this$0.repairer, $getPointBefore(this$static.contentRange, this$static.this$0.renderedContentView), this$static.contentRange.after);
      $clear_9(this$static);
    }
     else 
      throw $e0;
  }
   finally {
    $clear_9(this$static);
  }
}

function $getAbsoluteOffset(this$static, point){
  var filteredHtml, toFind;
  if ($partOfMutatingRange(this$static, dynamicCastJso(point.container))) {
    toFind = dynamicCastJso(point.container);
    filteredHtml = this$static.this$0.filteredHtmlView;
    return getOffset(toFind, dynamicCastJso($getStartNode(this$static.htmlRange, filteredHtml)), dynamicCastJso($getNodeAfter(this$static.htmlRange.after)), filteredHtml) + $getTextOffset(point);
  }
  return -1;
}

function $isPartOfThisState(this$static, point){
  var node;
  node = point.offset >= 0?dynamicCastJso(point.container):null;
  if (!node) {
    return maskUndefined($getNodeAfter(this$static.htmlRange.after)) === maskUndefined($getNodeAfter(point)) && maskUndefined(this$static.htmlRange.after.container) === maskUndefined(point.container) || $getNodeAfter(point) != null && $partOfMutatingRange(this$static, dynamicCastJso($getNodeAfter(point)));
  }
  return node == this$static.lastTextNode || $contains_5(this$static.htmlRange, this$static.this$0.filteredHtmlView, node);
}

function $partOfMutatingRange(this$static, node){
  return $contains_5(this$static.htmlRange, this$static.this$0.filteredHtmlView, node);
}

function $startTypingSequence(this$static, point){
  this$static.htmlRange = collapsedAt_0(this$static.this$0.filteredHtmlView, point);
  this$static.contentRange = boundedBy(getBackReference(dynamicCastJso(this$static.htmlRange.after.container)), getBackReference(dynamicCastJso(this$static.htmlRange.nodeBefore)), getBackReference(dynamicCastJso($getNodeAfter(this$static.htmlRange.after))));
}

function $startTypingSequence_0(this$static, previousSelectionStart){
  var $e0, after, before, cnodeAfter, e, filteredHtml, htmlNodeAfter, htmlNodeBefore, htmlParent, node, nodeAfter, renderedContent, wrapper;
  node = dynamicCastJso(previousSelectionStart.container);
  renderedContent = this$static.this$0.renderedContentView;
  filteredHtml = this$static.this$0.filteredHtmlView;
  try {
    wrapper = $findTextWrapper(this$static.this$0.manager, node, true);
    this$static.firstWrapper = wrapper;
    this$static.lastWrapper = wrapper;
    $checkNeighbouringTextNodes(this$static, previousSelectionStart);
    this$static.contentRange = around(renderedContent, this$static.firstWrapper, this$static.lastWrapper);
    htmlNodeBefore = dynamicCastJso($getPreviousSibling_3(filteredHtml, this$static.firstWrapper.implNodelet));
    htmlParent = dynamicCastJso($getParentElement_3(filteredHtml, node));
    cnodeAfter = dynamicCast($getNodeAfter(this$static.contentRange.after), 163);
    htmlNodeAfter = !cnodeAfter?null:cnodeAfter.getImplNodelet();
    this$static.htmlRange = between(htmlNodeBefore, new Point$El_0(htmlParent, htmlNodeAfter));
    $partOfMutatingRange(this$static, dynamicCastJso(filteredHtml.inner_0.asText_0(dynamicCastJso(previousSelectionStart.container)))) && (this$static.minpre = $getTextOffset(previousSelectionStart) + $getOffset_0(this$static.firstWrapper, node, htmlNodeAfter));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 172)) {
      e = $e0;
      nodeAfter = dynamicCastJso($getNodeAfter(e.htmlPoint));
      if (nodeAfter.nodeType != 3) {
        throw e;
      }
      this$static.contentRange = collapsedAt_0(renderedContent, e.contentPoint);
      before = this$static.contentRange.nodeBefore == null?null:dynamicCast(this$static.contentRange.nodeBefore, 163).getImplNodelet();
      after = $getNodeAfter(this$static.contentRange.after) == null?null:dynamicCast($getNodeAfter(this$static.contentRange.after), 163).getImplNodelet();
      this$static.htmlRange = between(before, new Point$El_0(dynamicCast(this$static.contentRange.after.container, 163).getImplNodelet(), after));
    }
     else 
      throw $e0;
  }
}

function $updateMinPre(this$static, selectionStart){
  var newVal;
  if (!selectionStart) {
    this$static.minpre = 0;
    return;
  }
  newVal = $getAbsoluteOffset(this$static, selectionStart);
  newVal == -1 && (newVal = 0);
  this$static.minpre = min_0(this$static.minpre, newVal);
}

function TypingExtractor$TypingState_0(this$0){
  this.this$0 = this$0;
}

function TypingExtractor$TypingState(){
}

_ = TypingExtractor$TypingState_0.prototype = TypingExtractor$TypingState.prototype = new Object_0;
_.getClass$ = function getClass_600(){
  return Lorg_waveprotocol_wave_client_editor_extract_TypingExtractor$TypingState_2_classLit;
}
;
_.castableTypeMap$ = {200:1};
_.contentRange = null;
_.firstWrapper = null;
_.htmlRange = null;
_.lastTextNode = null;
_.lastWrapper = null;
_.minpre = 0;
_.this$0 = null;
function $clinit_917(){
  $clinit_917 = nullMethod;
  INLINE_0 = new GwtRenderingMutationHandler$Flow$1_0;
  BLOCK_0 = new GwtRenderingMutationHandler$Flow$2_0;
  USE_WIDGET = new GwtRenderingMutationHandler$Flow$3_0;
  $VALUES_31 = initValues(_3Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow_2_classLit, {58:1, 138:1}, 94, [INLINE_0, BLOCK_0, USE_WIDGET]);
}

function values_32(){
  $clinit_917();
  return $VALUES_31;
}

function GwtRenderingMutationHandler$Flow(){
}

_ = GwtRenderingMutationHandler$Flow.prototype = new Enum;
_.getClass$ = function getClass_601(){
  return Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 94:1};
var $VALUES_31, BLOCK_0, INLINE_0, USE_WIDGET;
function GwtRenderingMutationHandler$Flow$1_0(){
  this.name_0 = 'INLINE';
  this.ordinal = 0;
}

function GwtRenderingMutationHandler$Flow$1(){
}

_ = GwtRenderingMutationHandler$Flow$1_0.prototype = GwtRenderingMutationHandler$Flow$1.prototype = new GwtRenderingMutationHandler$Flow;
_.createContainer = function createContainer(){
  return $doc.createElement('span');
}
;
_.getClass$ = function getClass_602(){
  return Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow$1_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 94:1};
function GwtRenderingMutationHandler$Flow$2_0(){
  this.name_0 = 'BLOCK';
  this.ordinal = 1;
}

function GwtRenderingMutationHandler$Flow$2(){
}

_ = GwtRenderingMutationHandler$Flow$2_0.prototype = GwtRenderingMutationHandler$Flow$2.prototype = new GwtRenderingMutationHandler$Flow;
_.createContainer = function createContainer_0(){
  return $doc.createElement('div');
}
;
_.getClass$ = function getClass_603(){
  return Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow$2_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 94:1};
function GwtRenderingMutationHandler$Flow$3_0(){
  this.name_0 = 'USE_WIDGET';
  this.ordinal = 2;
}

function GwtRenderingMutationHandler$Flow$3(){
}

_ = GwtRenderingMutationHandler$Flow$3_0.prototype = GwtRenderingMutationHandler$Flow$3.prototype = new GwtRenderingMutationHandler$Flow;
_.createContainer = function createContainer_1(){
  throw new AssertionError_0('No container for Replace');
}
;
_.getClass$ = function getClass_604(){
  return Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow$3_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 94:1};
function $clinit_923(){
  $clinit_923 = nullMethod;
  $clinit_1384();
  checkNotNull_1('body', 'Top level tag name must not be null');
  topLevelContainerTagname = 'body';
  $add_11(lineContainerTagnames, 'body');
  initRootRegistries();
}

function $$init_93(this$static){
  var level, level$array, level$index, level$max;
  this$static.logger = new DomLogger_0('test');
  this$static.displayDoc1 = new EditorHarness$1_0;
  this$static.setContentButton = new Button_2('Set content:', new EditorHarness$2_0(this$static));
  this$static.operationOutput = new HTML_0;
  this$static.testEditorRegistries = ($clinit_645() , ROOT_REGISTRIES);
  this$static.clearLogButton = new Button_2('Clear log', new EditorHarness$3_0(this$static));
  this$static.quietButton = new Button_2('Quiet (app runs faster)', new EditorHarness$4_0(this$static));
  this$static.loudButton = new Button_2('Loud (more info)', new EditorHarness$5_0(this$static));
  this$static.createEditor2DocDetached = new CheckBox_1('Create detached');
  this$static.queue = new ArrayList_0;
  this$static.queuingCheck = new CheckBox_1('Queue');
  this$static.queuingCheckHandler = new EditorHarness$6_0(this$static);
  this$static.playButton = new Button_2('Play', new EditorHarness$7_0(this$static));
  this$static.clearAnnotationsButton = new Button_2('Clear Annotations', new EditorHarness$8_0(this$static));
  this$static.diffCheck = new CheckBox_1('Diffs');
  this$static.diffCheckHandler = new EditorHarness$9_0(this$static);
  this$static.disabledCheck = new CheckBox_1('Disable');
  this$static.disabledCheckHandler = new EditorHarness$10_0(this$static);
  this$static.documentModeSelect = new ListBox_0;
  for (level$array = ($clinit_741() , $clinit_741() , $VALUES_21) , level$index = 0 , level$max = level$array.length; level$index < level$max; ++level$index) {
    level = level$array[level$index];
    $addItem(this$static.documentModeSelect, level.name_0);
  }
  $addDomHandler(this$static.documentModeSelect, new EditorHarness$11_0(this$static), ($clinit_91() , $clinit_91() , TYPE_0));
  this$static.clearEditorsButton = new Button_2('Clear', new EditorHarness$12_0(this$static));
  new EditorHarness$13_0(this$static);
  this$static.editor1Sink = new EditorHarness$14_0(this$static);
  this$static.editor2Sink = new EditorHarness$15_0(this$static);
}

function $clearEditors(this$static){
  $syncEditors(this$static, '');
  $clinit_1384();
  appendLine(this$static.editor2.content_0.mutableContent, ($clinit_1145() , EMPTY_MAP_0));
}

function $createEditToggleCheckBox(editor){
  var check;
  check = new CheckBox_1('Toggle edit');
  $addValueChangeHandler_0(check, new EditorHarness$16_0(editor));
  return check;
}

function $createEditor(this$static, id){
  var editor, e;
  $clinit_672();
  editor = ($clinit_680() , e = $doc.createElement('div') , e.className = 'editor' , new EditorImplWebkitMobile_0(e));
  editor.element_0.id = id;
  !editor.keySignalListeners && (editor.keySignalListeners = new HashSet_0);
  $add_11(editor.keySignalListeners, this$static);
  return editor;
}

function $initContentOracle(this$static){
  var content_0, content$index, content$max, extra;
  this$static.contentOracle = new MultiWordSuggestOracle_0;
  this$static.contentSuggestBox = new SuggestBox_0(this$static.contentOracle);
  this$static.contentSuggestBox.element_0.id = 'content-box';
  $add_4(this$static.contentOracle, '');
  $add_4(this$static.contentOracle, 'abcd');
  $addHandler_1(this$static.contentSuggestBox, new EditorHarness$18_0(this$static), (!TYPE_13 && (TYPE_13 = new GwtEvent$Type_0) , TYPE_13));
  extra = this$static.extendSampleContent();
  if (extra != null) {
    for (content$index = 0 , content$max = extra.length; content$index < content$max; ++content$index) {
      content_0 = extra[content$index];
      $add_4(this$static.contentOracle, content_0);
    }
  }
}

function $logUncaughtExceptions(this$static, t){
  $setTextOrHtml(this$static.fatal.directionalTextHelper, 'FATAL!', false);
  $log_3(this$static.logger.fatalLogger, t);
  $printStackTrace(t);
}

function $lottaLogging(){
  $clinit_542();
  $addAll(enabledModules, modules);
  $add_11(enabledModules, 'test');
  persistEnabledModules();
  $add_11(enabledModules, 'editor');
  persistEnabledModules();
  $add_11(enabledModules, 'editor-node');
  persistEnabledModules();
  $add_11(enabledModules, 'operator');
  persistEnabledModules();
  $add_11(enabledModules, 'dragdrop');
  persistEnabledModules();
}

--></script>
<script><!--
function $outputBothEditorStates(this$static){
  $outputEditorState(this$static, this$static.editor1, this$static.prettyContent1, this$static.prettyHtml1);
  $outputEditorState(this$static, this$static.editor2, this$static.prettyContent2, this$static.prettyHtml2);
}

function $outputEditorState(this$static, editor, prettyContent, prettyHtml){
  var printer;
  printer = new EditorHarness$17_0(this$static, editor, prettyContent, prettyHtml);
  $flush_1(editor.content_0, printer) && $run_0(printer);
}

function $outputOperation(this$static, operation){
  this$static.quiet || ($setTextOrHtml(this$static.operationOutput.directionalTextHelper, operation?toString__devirtual$(operation):'', false) , undefined);
}

function $playOne(this$static){
  var $e0, operation, t;
  if (this$static.queue.size > 0) {
    operation = dynamicCast($remove_10(this$static.queue, 0), 173);
    try {
      this$static.quiet || ($setTextOrHtml(this$static.operationOutput.directionalTextHelper, operation?toString__devirtual$(operation):'', false) , undefined);
      $execute_3(this$static.editorBundle2, operation);
      $outputEditorState(this$static, this$static.editor2, this$static.prettyContent2, this$static.prettyHtml2);
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 3)) {
        t = $e0;
        $logUncaughtExceptions(sUncaughtExceptionHandler.this$0, t);
      }
       else 
        throw $e0;
    }
  }
  this$static.playButton.element_0['disabled'] = !(this$static.queue.size > 0);
  this$static.playButton.element_0.innerHTML = 'Play' + (this$static.queue.size > 0?' (' + this$static.queue.size + ')':'') || '';
}

function $registerDoodads(this$static, registries){
  var handler, painterRegistry;
  registerContainer('body', registries.elementHandlerRegistry);
  $clinit_813();
  painterRegistry = registries.paintRegistry;
  handler = new StyleAnnotationHandler_0(painterRegistry.painter);
  $registerHandler(registries.annotationHandlerRegistry, 'style', handler);
  $registerBehaviour(registries.annotationHandlerRegistry, 'style', new AnnotationBehaviour$DefaultAnnotationBehaviour_0(($clinit_1072() , CONTENT)));
  $registerPaintFunction(painterRegistry, KEYS_0, renderFunc);
  register_0(registries.annotationHandlerRegistry, registries.paintRegistry);
  register_6(registries, new EditorHarness$23_0);
  this$static.extend(registries);
}

function $setEditing_0(editor, isEditing){
  $setEditing(editor, isEditing);
  editor.editing && undefined;
}

function $setEditorLevel(this$static){
  var current, n$iterator, newLevel;
  newLevel = ($clinit_741() , $clinit_741() , $VALUES_21)[this$static.documentModeSelect.element_0.selectedIndex];
  current = this$static.doc1.level;
  $log(this$static.logger, ($clinit_1058() , TRACE), initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['Switching to ' + newLevel]));
  if (current == newLevel) {
    return;
  }
  if (current == EDITING) {
    newLevel == SHELVED?$removeContentAndUnrender(this$static.editor1):$removeContent(this$static.editor1);
    $replaceOutgoingSink(this$static.doc1, this$static.editor1Sink);
  }
  newLevel == SHELVED?$setShelved(this$static.doc1):newLevel == EDITING?$setContent_0(this$static.editor1, this$static.doc1):newLevel == RENDERED?$setRendering(this$static.doc1):$setInteractive(this$static.doc1, this$static.displayDoc1);
  if (this$static.doc1.level == RENDERED || this$static.doc1.level == INTERACTIVE) {
    this$static.displayDoc1.element_0.appendChild(dynamicCast(this$static.doc1.fullContentView.inner_0.getDocumentElement(), 152).implNodelet);
  }
   else if (this$static.doc1.level == SHELVED) {
    for (n$iterator = ($clinit_1350() , $iterator_14(iterate(this$static.doc1.fullContentView, dynamicCast(this$static.doc1.fullContentView.inner_0.getDocumentElement(), 163), null, FORWARD_DEPTH_FIRST_ITERATOR))); n$iterator.next != null;) {
      dynamicCast($next_21(n$iterator), 163);
    }
  }
}

function $setFromContentBox(this$static){
  var content_0;
  content_0 = $getPropertyString(this$static.contentSuggestBox.box.element_0, 'value');
  !!this$static.contentOracle && $add_4(this$static.contentOracle, content_0);
  $syncEditors(this$static, '<body><line/> ' + content_0 + '<\/body>');
}

function $setPlayButtonState(this$static){
  this$static.playButton.element_0['disabled'] = !(this$static.queue.size > 0);
  this$static.playButton.element_0.innerHTML = 'Play' + (this$static.queue.size > 0?' (' + this$static.queue.size + ')':'') || '';
}

function $syncEditors(this$static, content_0){
  var $e0, docDiv, e, editorDiv, end, end2, middle, op, schema, start, start2, useHack, vc;
  try {
    op = $asOperation($parse(($clinit_1364() , content_0)));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 202)) {
      e = $e0;
      instanceOf(e.cause, 203)?$log_4(this$static.logger.errorLogger, 'Ill-formed XML string ', e.cause):$log_4(this$static.logger.errorLogger, 'Error', e);
      return;
    }
     else 
      throw $e0;
  }
  schema = ($clinit_1434() , BLIP_SCHEMA_CONSTRAINTS);
  vc = new DocOpAutomaton$ViolationCollector_0;
  if (($clinit_1301() , checkNotNull_1(schema, 'Schema constraints required, if not, use DocumentSchema.NO_SCHEMA_CONSTRAINTS') , validate_1(vc, schema, ($clinit_1259() , EMPTY_DOCUMENT), op)) != ($clinit_1267() , VALID)) {
    $log_2(this$static.logger.errorLogger, 'That content does not conform to the schema', vc);
    return;
  }
  useHack = $getValue_0(this$static.createEditor2DocDetached).value_0;
  start = (new Date).getTime();
  this$static.doc1 = new ContentDocument_0(this$static.testEditorRegistries, op, schema);
  middle = (new Date).getTime();
  $setContent_0(this$static.editor1, this$static.doc1);
  end = (new Date).getTime();
  $log(this$static.logger, ($clinit_1058() , TRACE), initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['Set content1 took: ' + (end - start) + ' (Pojo creation: ' + (middle - start) + ', rendering: ' + (end - middle)]));
  start = (new Date).getTime();
  this$static.doc2 = new ContentDocument_1(schema);
  $setRegistries(this$static.doc2, this$static.testEditorRegistries);
  $setContent_0(this$static.editor2, this$static.doc2);
  if (useHack) {
    docDiv = dynamicCast(this$static.doc2.fullContentView.inner_0.getDocumentElement(), 152).implNodelet;
    editorDiv = this$static.editor2.element_0;
    $removeFromParent(docDiv);
    start2 = (new Date).getTime();
    $consume_5(this$static.doc2, op);
    end2 = (new Date).getTime();
    editorDiv.appendChild(docDiv);
  }
   else {
    start2 = (new Date).getTime();
    $consume_5(this$static.doc2, op);
    end2 = (new Date).getTime();
  }
  end = (new Date).getTime();
  $log(this$static.logger, TRACE, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['Set content2 took: ' + (end - start) + ' Just the op: ' + (end2 - start2) + ' Op + appendChild: ' + (end - start2)]));
  this$static.documentModeSelect.element_0.selectedIndex = this$static.doc1.level.ordinal;
  $outputEditorState(this$static, this$static.editor1, this$static.prettyContent1, this$static.prettyHtml1);
  $outputEditorState(this$static, this$static.editor2, this$static.prettyContent2, this$static.prettyHtml2);
}

function EditorHarness_0(){
  var $e0, clearContentBoxButton, editMain, editorStack1, editorStack2, editors, handler, keysRegistry, operations, r;
  $$init_93(this);
  try {
    $setValue_1(this.queuingCheck, ($clinit_382() , $clinit_382() , FALSE));
    this.playButton.element_0['disabled'] = !(this.queue.size > 0);
    this.playButton.element_0.innerHTML = 'Play' + (this.queue.size > 0?' (' + this.queue.size + ')':'') || '';
    this.log = new HTML_0;
    this.log.getStyleElement()['className'] = 'log';
    this.log.element_0.id = 'log1';
    this.error = new HTML_0;
    this.error.element_0.id = 'error1';
    this.error.getStyleElement()['className'] = 'redIndicator';
    this.fatal = new HTML_0;
    this.fatal.element_0.id = 'fatal1';
    this.fatal.getStyleElement()['className'] = 'redIndicator';
    $clinit_542();
    $add_9(listeners, new EditorHarness$19_0(this));
    this.prettyContent1 = new HTML_0;
    setStyleName_0(this.prettyContent1.getStyleElement(), 'content', true);
    this.prettyContent2 = new HTML_0;
    setStyleName_0(this.prettyContent2.getStyleElement(), 'content', true);
    this.prettyHtml1 = new HTML_0;
    setStyleName_0(this.prettyHtml1.getStyleElement(), 'html', true);
    this.prettyHtml2 = new HTML_0;
    setStyleName_0(this.prettyHtml2.getStyleElement(), 'html', true);
    documentSchema_0 = ($clinit_1434() , BLIP_SCHEMA_CONSTRAINTS);
    $registerDoodads(this, this.testEditorRegistries);
    this.editor1 = $createEditor(this, 'editor1');
    this.editorBundle1 = new EditorHarness$EditorBundle_0(this, this.editor1, true);
    this.editor2 = $createEditor(this, 'editor2');
    this.editorBundle2 = new EditorHarness$EditorBundle_0(this, this.editor2, false);
    this.toggleEditCheck1 = $createEditToggleCheckBox(this.editor1);
    this.toggleEditCheck2 = $createEditToggleCheckBox(this.editor2);
    this.operationOutput.getStyleElement()['className'] = 'operation';
    editMain = new FlowPanel_0;
    editMain.element_0['className'] = 'main';
    editors = new HorizontalPanel_0;
    editorStack1 = new FlowPanel_0;
    editorStack2 = new FlowPanel_0;
    $add_2(editorStack1, this.editor1);
    $add_2(editorStack1, this.displayDoc1);
    $add_2(editorStack1, this.toggleEditCheck1);
    $add_2(editorStack1, this.disabledCheck);
    $add_2(editorStack1, this.documentModeSelect);
    $add_2(editorStack1, this.prettyContent1);
    $add_2(editorStack2, this.editor2);
    $add_2(editorStack2, this.toggleEditCheck2);
    $add_2(editorStack2, this.diffCheck);
    $add_2(editorStack2, this.createEditor2DocDetached);
    $add_2(editorStack2, this.prettyContent2);
    $add_3(editors, editorStack1);
    $add_3(editors, this.prettyHtml1);
    $add_3(editors, editorStack2);
    $add_3(editors, this.prettyHtml2);
    operations = new HorizontalPanel_0;
    operations.vertAlign = ($clinit_290() , ALIGN_MIDDLE);
    $addDomHandler(this.queuingCheck, this.queuingCheckHandler, ($clinit_94() , $clinit_94() , TYPE_1));
    $addDomHandler(this.disabledCheck, this.disabledCheckHandler, TYPE_1);
    $addDomHandler(this.diffCheck, this.diffCheckHandler, TYPE_1);
    this.playButton.element_0['disabled'] = !(this.queue.size > 0);
    this.playButton.element_0.innerHTML = 'Play' + (this.queue.size > 0?' (' + this.queue.size + ')':'') || '';
    $add_3(operations, this.clearAnnotationsButton);
    $add_3(operations, this.queuingCheck);
    $add_3(operations, this.playButton);
    $add_3(operations, new Label_1('Operation:'));
    $add_3(operations, this.operationOutput);
    $add(editMain, operations, editMain.element_0);
    $add(editMain, editors, editMain.element_0);
    $initContentOracle(this);
    this.widgetRow = new FlowPanel_0;
    $add_2(this.widgetRow, this.clearEditorsButton);
    $add_2(this.widgetRow, this.setContentButton);
    $add_2(this.widgetRow, new InlineLabel_1('<body><line/>'));
    $add_2(this.widgetRow, this.contentSuggestBox);
    $add_2(this.widgetRow, new InlineLabel_1('<\/body>'));
    clearContentBoxButton = new Button_2('Clear text', new EditorHarness$20_0(this));
    clearContentBoxButton.element_0.id = 'clear-content-box';
    $add_2(this.widgetRow, clearContentBoxButton);
    clearContentBoxButton.element_0.style.display = 'none';
    $add_2(this.widgetRow, new FlowPanel_0);
    $add_2(this.widgetRow, this.clearLogButton);
    $add_2(this.widgetRow, this.quietButton);
    $add_2(this.widgetRow, this.loudButton);
    $add_2(editMain, this.widgetRow);
    $add_2(editMain, this.error);
    $add_2(editMain, this.fatal);
    $add_2(editMain, this.log);
    sUncaughtExceptionHandler = new EditorHarness$21_0(this);
    $initWidget(this, editMain);
    enable_0(this.log.element_0);
    $lottaLogging();
    keysRegistry = new KeyBindingRegistry_0;
    $init_4(this.editor1, this.testEditorRegistries, keysRegistry);
    $init_4(this.editor2, this.testEditorRegistries, keysRegistry);
    $add_22(this.editor1.updateEvent.updateListeners, new EditorHarness$22_0(this));
    this.editor1.innerOutputSink = this.editor1Sink;
    this.editor2.innerOutputSink = this.editor2Sink;
    $syncEditors(this, '');
    $clinit_1384();
    appendLine(this.editor2.content_0.mutableContent, ($clinit_1145() , EMPTY_MAP_0));
    $setEditing(this.editor1, true);
    $setEditing(this.editor2, false);
    $setValue_1(this.toggleEditCheck2, FALSE);
    $setValue_1(this.toggleEditCheck1, TRUE);
    $outputEditorState(this, this.editor1, this.prettyContent1, this.prettyHtml1);
    $outputEditorState(this, this.editor2, this.prettyContent2, this.prettyHtml2);
    this.quiet || ($setTextOrHtml(this.operationOutput.directionalTextHelper, '', false) , undefined);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 4)) {
      r = $e0;
      handler = sUncaughtExceptionHandler;
      handler?$logUncaughtExceptions(handler.this$0, r):$log_3(this.logger.errorLogger, r);
      throw r;
    }
     else 
      throw $e0;
  }
}

function EditorHarness(){
}

_ = EditorHarness.prototype = new Composite;
_.extend = function extend(registries){
}
;
_.extendSampleContent = function extendSampleContent(){
  return null;
}
;
_.getClass$ = function getClass_605(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness_2_classLit;
}
;
_.onKeySignal = function onKeySignal(sender, event_0){
  $clinit_1010();
  $schedule_2(scheduler_0, ($clinit_1013() , LOW), new EditorHarness$25_0(this, sender));
  return false;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1, 170:1};
_.contentOracle = null;
_.contentSuggestBox = null;
_.doc1 = null;
_.doc2 = null;
_.editor1 = null;
_.editor2 = null;
_.editorBundle1 = null;
_.editorBundle2 = null;
_.error = null;
_.fatal = null;
_.log = null;
_.prettyContent1 = null;
_.prettyContent2 = null;
_.prettyHtml1 = null;
_.prettyHtml2 = null;
_.quiet = false;
_.randomTestCounter = 0;
_.toggleEditCheck1 = null;
_.toggleEditCheck2 = null;
_.widgetRow = null;
function DefaultTestHarness$1_0(){
  $clinit_923();
  EditorHarness_0.call(this);
}

function DefaultTestHarness$1(){
}

_ = DefaultTestHarness$1_0.prototype = DefaultTestHarness$1.prototype = new EditorHarness;
_.extend = function extend_0(registries){
  var attachmentManager, a_0, a_1, a_2, a_3;
  register_1(registries.elementHandlerRegistry);
  attachmentManager = new FakeAttachmentsManager_0;
  a_0 = new FakeAttachment_0('pics/Snow.jpg', 80);
  $put_5(attachmentManager.map, 'pics/Snow.jpg', a_0);
  a_1 = new FakeAttachment_0('pics/yosemite.jpg', 80);
  $put_5(attachmentManager.map, 'pics/yosemite.jpg', a_1);
  a_2 = new FakeAttachment_0('pics/hills.jpg', 74);
  $put_5(attachmentManager.map, 'pics/hills.jpg', a_2);
  a_3 = new FakeAttachment_0('pics/wave.gif', 74);
  $put_5(attachmentManager.map, 'pics/wave.gif', a_3);
  register(registries.elementHandlerRegistry, attachmentManager);
  register_6(registries, new DefaultTestHarness$1$2_0);
  register_7(registries.elementHandlerRegistry);
  $registerRenderer(registries.elementHandlerRegistry, 'l:diffdel', (!instance_1 && (instance_1 = new DiffDeleteRenderer_0) , instance_1));
}
;
_.extendSampleContent = function extendSampleContent_0(){
  return initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['abcd' + ($clinit_552() , $wrap_3($wrap_2($appendText_0(new XmlStringBuilderDoc_0(null, ($clinit_1271() , ANY)), 'Yosemite', BLIP_TEXT), 'caption'), 'image', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['attachment', 'pics/yosemite.jpg'])).builder.impl.string) + $wrap_3($wrap_2($appendText_0(new XmlStringBuilderDoc_0(null, ANY), 'Hills', BLIP_TEXT), 'caption'), 'image', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['attachment', 'pics/hills.jpg'])).builder.impl.string + constructXml(true).builder.impl.string, $wrap_3($wrap_2($appendText_0(new XmlStringBuilderDoc_0(null, ANY), 'Yosemite', BLIP_TEXT), 'caption'), 'image', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['attachment', 'pics/yosemite.jpg'])).builder.impl.string + $wrap_3($wrap_2($appendText_0(new XmlStringBuilderDoc_0(null, ANY), 'Hills', BLIP_TEXT), 'caption'), 'image', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['attachment', 'pics/hills.jpg'])).builder.impl.string + '<line t="li"/>Some stuff']);
}
;
_.getClass$ = function getClass_606(){
  return Lorg_waveprotocol_wave_client_editor_harness_DefaultTestHarness$1_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1, 170:1};
function $onClick_0(thumbnail){
  var e, newId;
  e = thumbnail.element;
  newId = $wnd.prompt("New attachment id, or 'remove' to remove the attribute", dynamicCast($get_12(e.attributes, 'attachment'), 1));
  if (newId == null) {
    return true;
  }
  $equals_3('remove', newId) && (newId = null);
  $setElementAttribute(e.context.this$0.mutableContent, e, 'attachment', newId);
  return true;
}

function DefaultTestHarness$1$2_0(){
}

function DefaultTestHarness$1$2(){
}

_ = DefaultTestHarness$1$2_0.prototype = DefaultTestHarness$1$2.prototype = new Object_0;
_.augment = function augment(annotations, isEditing, current){
  return current;
}
;
_.getClass$ = function getClass_607(){
  return Lorg_waveprotocol_wave_client_editor_harness_DefaultTestHarness$1$2_2_classLit;
}
;
_.castableTypeMap$ = {};
function DefaultTestHarness$2_0(val$selector, val$editorHarness, val$eventHarness){
  this.val$selector = val$selector;
  this.val$editorHarness = val$editorHarness;
  this.val$eventHarness = val$eventHarness;
}

function DefaultTestHarness$2(){
}

_ = DefaultTestHarness$2_0.prototype = DefaultTestHarness$2.prototype = new Object_0;
_.getClass$ = function getClass_608(){
  return Lorg_waveprotocol_wave_client_editor_harness_DefaultTestHarness$2_2_classLit;
}
;
_.onChange = function onChange_0(e){
  if ($isItemSelected(this.val$selector)) {
    this.val$editorHarness.element_0.style['display'] = ($clinit_47() , 'block');
    this.val$eventHarness.element_0.style['display'] = 'none';
  }
   else {
    this.val$editorHarness.element_0.style['display'] = ($clinit_47() , 'none');
    this.val$eventHarness.element_0.style['display'] = 'block';
  }
}
;
_.castableTypeMap$ = {7:1, 25:1};
_.val$editorHarness = null;
_.val$eventHarness = null;
_.val$selector = null;
function EditorHarness$1_0(){
  this.children_0 = new WidgetCollection_0(this);
  this.element_0 = $doc.createElement('div');
  this.element_0.style['border'] = '1px dashed silver';
}

function EditorHarness$1(){
}

_ = EditorHarness$1_0.prototype = EditorHarness$1.prototype = new LogicalPanel$Impl;
_.getClass$ = function getClass_609(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$1_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1, 135:1, 201:1};
function EditorHarness$10_0(this$0){
  this.this$0 = this$0;
}

function EditorHarness$10(){
}

_ = EditorHarness$10_0.prototype = EditorHarness$10.prototype = new Object_0;
_.getClass$ = function getClass_610(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$10_2_classLit;
}
;
_.onClick = function onClick_5(e){
  this.this$0.editor1.debugDisabled = $getValue_0(this.this$0.disabledCheck).value_0;
}
;
_.castableTypeMap$ = {8:1, 25:1};
_.this$0 = null;
function EditorHarness$11_0(this$0){
  this.this$0 = this$0;
}

function EditorHarness$11(){
}

_ = EditorHarness$11_0.prototype = EditorHarness$11.prototype = new Object_0;
_.getClass$ = function getClass_611(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$11_2_classLit;
}
;
_.onChange = function onChange_1(event_0){
  $setEditorLevel(this.this$0);
}
;
_.castableTypeMap$ = {7:1, 25:1};
_.this$0 = null;
function EditorHarness$12_0(this$0){
  this.this$0 = this$0;
}

function EditorHarness$12(){
}

_ = EditorHarness$12_0.prototype = EditorHarness$12.prototype = new Object_0;
_.getClass$ = function getClass_612(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$12_2_classLit;
}
;
_.onClick = function onClick_6(e){
  $clearEditors(this.this$0);
}
;
_.castableTypeMap$ = {8:1, 25:1};
_.this$0 = null;
function EditorHarness$13_0(this$0){
  this.this$0 = this$0;
}

function EditorHarness$13(){
}

_ = EditorHarness$13_0.prototype = EditorHarness$13.prototype = new Object_0;
_.execute_1 = function execute_31(){
  ++this.this$0.randomTestCounter;
  $log_0(this.this$0.logger.traceLogger, 'Random test #' + this.this$0.randomTestCounter);
  return true;
}
;
_.getClass$ = function getClass_613(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$13_2_classLit;
}
;
_.castableTypeMap$ = {208:1, 210:1};
_.this$0 = null;
function $consume_13(this$static, operation){
  var $e0, t;
  try {
    if (operation) {
      if ($getValue_0(this$static.this$0.queuingCheck).value_0) {
        $add_9(this$static.this$0.queue, operation);
        $setPlayButtonState(this$static.this$0);
      }
       else {
        $execute_3(this$static.this$0.editorBundle2, operation);
      }
    }
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 3)) {
      t = $e0;
      $logUncaughtExceptions(sUncaughtExceptionHandler.this$0, t);
    }
     else 
      throw $e0;
  }
   finally {
    $outputOperation(this$static.this$0, operation);
  }
}

function EditorHarness$14_0(this$0){
  this.this$0 = this$0;
}

function EditorHarness$14(){
}

_ = EditorHarness$14_0.prototype = EditorHarness$14.prototype = new Object_0;
_.consume = function consume_4(operation){
  $consume_13(this, operation);
}
;
_.getClass$ = function getClass_614(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$14_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $consume_14(this$static, operation){
  var $e0, t;
  try {
    !!operation && $execute_3(this$static.this$0.editorBundle1, operation);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 3)) {
      t = $e0;
      $logUncaughtExceptions(sUncaughtExceptionHandler.this$0, t);
    }
     else 
      throw $e0;
  }
   finally {
    $outputOperation(this$static.this$0, operation);
  }
}

function EditorHarness$15_0(this$0){
  this.this$0 = this$0;
}

function EditorHarness$15(){
}

_ = EditorHarness$15_0.prototype = EditorHarness$15.prototype = new Object_0;
_.consume = function consume_5(operation){
  $consume_14(this, operation);
}
;
_.getClass$ = function getClass_615(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$15_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function EditorHarness$16_0(val$editor){
  this.val$editor = val$editor;
}

function EditorHarness$16(){
}

_ = EditorHarness$16_0.prototype = EditorHarness$16.prototype = new Object_0;
_.getClass$ = function getClass_616(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$16_2_classLit;
}
;
_.onValueChange = function onValueChange_7(event_0){
  $setEditing_0(this.val$editor, dynamicCast(event_0.value_0, 136).value_0);
}
;
_.castableTypeMap$ = {24:1, 25:1};
_.val$editor = null;
function $run_0(this$static){
  var content_0, html;
  if (!this$static.this$0.quiet) {
    content_0 = formatContentDomString(this$static.val$editor);
    html = formatImplDomString(this$static.val$editor);
    content_0 != null && ($setTextOrHtml(this$static.val$prettyContent.directionalTextHelper, content_0, false) , undefined);
    html != null && ($setTextOrHtml(this$static.val$prettyHtml.directionalTextHelper, html, false) , undefined);
  }
}

function EditorHarness$17_0(this$0, val$editor, val$prettyContent, val$prettyHtml){
  this.this$0 = this$0;
  this.val$editor = val$editor;
  this.val$prettyContent = val$prettyContent;
  this.val$prettyHtml = val$prettyHtml;
}

function EditorHarness$17(){
}

_ = EditorHarness$17_0.prototype = EditorHarness$17.prototype = new Object_0;
_.getClass$ = function getClass_617(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$17_2_classLit;
}
;
_.run = function run_3(){
  $run_0(this);
}
;
_.castableTypeMap$ = {174:1};
_.this$0 = null;
_.val$editor = null;
_.val$prettyContent = null;
_.val$prettyHtml = null;
function EditorHarness$18_0(this$0){
  this.this$0 = this$0;
}

function EditorHarness$18(){
}

_ = EditorHarness$18_0.prototype = EditorHarness$18.prototype = new Object_0;
_.getClass$ = function getClass_618(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$18_2_classLit;
}
;
_.castableTypeMap$ = {22:1, 23:1, 25:1};
_.this$0 = null;
function EditorHarness$19_0(this$0){
  this.this$0 = this$0;
}

function EditorHarness$19(){
}

_ = EditorHarness$19_0.prototype = EditorHarness$19.prototype = new Object_0;
_.getClass$ = function getClass_619(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$19_2_classLit;
}
;
_.castableTypeMap$ = {149:1};
_.this$0 = null;
function EditorHarness$2_0(this$0){
  this.this$0 = this$0;
}

function EditorHarness$2(){
}

_ = EditorHarness$2_0.prototype = EditorHarness$2.prototype = new Object_0;
_.getClass$ = function getClass_620(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$2_2_classLit;
}
;
_.onClick = function onClick_7(e){
  $setFromContentBox(this.this$0);
}
;
_.castableTypeMap$ = {8:1, 25:1};
_.this$0 = null;
function EditorHarness$20_0(this$0){
  this.this$0 = this$0;
}

function EditorHarness$20(){
}

_ = EditorHarness$20_0.prototype = EditorHarness$20.prototype = new Object_0;
_.getClass$ = function getClass_621(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$20_2_classLit;
}
;
_.onClick = function onClick_8(e){
  $setValue_2(this.this$0.contentSuggestBox.box);
}
;
_.castableTypeMap$ = {8:1, 25:1};
_.this$0 = null;
function EditorHarness$21_0(this$0){
  this.this$0 = this$0;
}

function EditorHarness$21(){
}

_ = EditorHarness$21_0.prototype = EditorHarness$21.prototype = new Object_0;
_.getClass$ = function getClass_622(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$21_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function EditorHarness$22_0(this$0){
  this.this$0 = this$0;
}

function EditorHarness$22(){
}

_ = EditorHarness$22_0.prototype = EditorHarness$22.prototype = new Object_0;
_.getClass$ = function getClass_623(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$22_2_classLit;
}
;
_.onUpdate = function onUpdate_1(event_0){
  $outputBothEditorStates(this.this$0);
}
;
_.castableTypeMap$ = {176:1};
_.this$0 = null;
function EditorHarness$23_0(){
}

function EditorHarness$23(){
}

_ = EditorHarness$23_0.prototype = EditorHarness$23.prototype = new Object_0;
_.augment = function augment_0(annotations, isEditing, current){
  return current;
}
;
_.getClass$ = function getClass_624(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$23_2_classLit;
}
;
_.castableTypeMap$ = {};
function EditorHarness$25_0(this$0, val$sender){
  this.this$0 = this$0;
  this.val$sender = val$sender;
}

function EditorHarness$25(){
}

_ = EditorHarness$25_0.prototype = EditorHarness$25.prototype = new Object_0;
_.execute = function execute_32(){
  this.val$sender == this.this$0.editor1?$outputEditorState(this.this$0, this.this$0.editor1, this.this$0.prettyContent1, this.this$0.prettyHtml1):$outputEditorState(this.this$0, this.this$0.editor2, this.this$0.prettyContent2, this.this$0.prettyHtml2);
}
;
_.getClass$ = function getClass_625(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$25_2_classLit;
}
;
_.castableTypeMap$ = {209:1, 210:1};
_.this$0 = null;
_.val$sender = null;
function EditorHarness$3_0(this$0){
  this.this$0 = this$0;
}

function EditorHarness$3(){
}

_ = EditorHarness$3_0.prototype = EditorHarness$3.prototype = new Object_0;
_.getClass$ = function getClass_626(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$3_2_classLit;
}
;
_.onClick = function onClick_9(e){
  if (this.this$0.log) {
    $setTextOrHtml(this.this$0.log.directionalTextHelper, '', true);
    $setTextOrHtml(this.this$0.error.directionalTextHelper, '', false);
    $setTextOrHtml(this.this$0.fatal.directionalTextHelper, '', false);
  }
}
;
_.castableTypeMap$ = {8:1, 25:1};
_.this$0 = null;
function EditorHarness$4_0(this$0){
  this.this$0 = this$0;
}

function EditorHarness$4(){
}

_ = EditorHarness$4_0.prototype = EditorHarness$4.prototype = new Object_0;
_.getClass$ = function getClass_627(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$4_2_classLit;
}
;
_.onClick = function onClick_10(e){
  $clinit_542();
  maxLevel_0 = ($clinit_1058() , ERROR).value_0;
  $add_11(enabledModules, 'test');
  persistEnabledModules();
  this.this$0.quiet = true;
}
;
_.castableTypeMap$ = {8:1, 25:1};
_.this$0 = null;
function EditorHarness$5_0(this$0){
  this.this$0 = this$0;
}

function EditorHarness$5(){
}

_ = EditorHarness$5_0.prototype = EditorHarness$5.prototype = new Object_0;
_.getClass$ = function getClass_628(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$5_2_classLit;
}
;
_.onClick = function onClick_11(e){
  $lottaLogging();
  this.this$0.quiet = false;
}
;
_.castableTypeMap$ = {8:1, 25:1};
_.this$0 = null;
function EditorHarness$6_0(this$0){
  this.this$0 = this$0;
}

function EditorHarness$6(){
}

_ = EditorHarness$6_0.prototype = EditorHarness$6.prototype = new Object_0;
_.getClass$ = function getClass_629(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$6_2_classLit;
}
;
_.onClick = function onClick_12(e){
  if (!$getValue_0(this.this$0.queuingCheck).value_0) {
    while (this.this$0.queue.size > 0) {
      $playOne(this.this$0);
    }
  }
}
;
_.castableTypeMap$ = {8:1, 25:1};
_.this$0 = null;
function EditorHarness$7_0(this$0){
  this.this$0 = this$0;
}

function EditorHarness$7(){
}

--></script>
<script><!--
_ = EditorHarness$7_0.prototype = EditorHarness$7.prototype = new Object_0;
_.getClass$ = function getClass_630(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$7_2_classLit;
}
;
_.onClick = function onClick_13(e){
  $playOne(this.this$0);
}
;
_.castableTypeMap$ = {8:1, 25:1};
_.this$0 = null;
function EditorHarness$8_0(this$0){
  this.this$0 = this$0;
}

function EditorHarness$8(){
}

_ = EditorHarness$8_0.prototype = EditorHarness$8.prototype = new Object_0;
_.getClass$ = function getClass_631(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$8_2_classLit;
}
;
_.onClick = function onClick_14(e){
  clearDiffs($getDiffFilter(this.this$0.editorBundle1.diffState).inner);
}
;
_.castableTypeMap$ = {8:1, 25:1};
_.this$0 = null;
function EditorHarness$9_0(this$0){
  this.this$0 = this$0;
}

function EditorHarness$9(){
}

_ = EditorHarness$9_0.prototype = EditorHarness$9.prototype = new Object_0;
_.getClass$ = function getClass_632(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$9_2_classLit;
}
;
_.onClick = function onClick_15(e){
  this.this$0.editorBundle2.showDiffs = $getValue_0(this.this$0.diffCheck).value_0;
}
;
_.castableTypeMap$ = {8:1, 25:1};
_.this$0 = null;
function $execute_3(this$static, op){
  this$static.showDiffs?$consume_15(this$static.diffState, op):$consume_5(this$static.is1?this$static.this$0.doc1:this$static.this$0.doc2, op);
}

function EditorHarness$EditorBundle_0(this$0, editor, is1){
  this.this$0 = this$0;
  this.diffState = new HighlightingDiffState_0(editor);
  this.is1 = is1;
}

function EditorHarness$EditorBundle(){
}

_ = EditorHarness$EditorBundle_0.prototype = EditorHarness$EditorBundle.prototype = new Object_0;
_.getClass$ = function getClass_633(){
  return Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$EditorBundle_2_classLit;
}
;
_.castableTypeMap$ = {};
_.diffState = null;
_.is1 = false;
_.showDiffs = false;
_.this$0 = null;
function $onModuleLoad_0(){
  var $e0, e, editorHarness, eventHarness, selector, topLevel;
  while (true) {
    try {
      editorHarness = new DefaultTestHarness$1_0;
      eventHarness = new SignalEventHarness_0;
      topLevel = new FlowPanel_0;
      selector = new ListBox_0;
      $insertItem(selector, 'edit', 'edit');
      $insertItem(selector, 'event', 'event');
      selector.element_0.id = 'page-mode-selector';
      $addDomHandler(selector, new DefaultTestHarness$2_0(selector, editorHarness, eventHarness), ($clinit_91() , $clinit_91() , TYPE_0));
      $add(topLevel, selector, topLevel.element_0);
      $add(topLevel, editorHarness, topLevel.element_0);
      $add(topLevel, eventHarness, topLevel.element_0);
      $add_0(($clinit_333() , get_0()), topLevel);
      break;
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 4)) {
        e = $e0;
        if (!$wnd.confirm('Exception on module load, try again?')) {
          throw e;
        }
      }
       else if (instanceOf($e0, 150)) {
        e = $e0;
        if (!$wnd.confirm('Error on module load, try again?')) {
          throw e;
        }
      }
       else 
        throw $e0;
    }
  }
}

function $consume_15(this$static, operation){
  $consume_10($getDiffFilter(this$static), operation);
}

function $getDiffFilter(this$static){
  checkNotNull(this$static.editor.content_0);
  if (this$static.editor.content_0 != this$static.currentContentDoc) {
    this$static.currentContentDoc = this$static.editor.content_0;
    this$static.diffFilter = new DiffHighlightingFilter_0(this$static.currentContentDoc.localAnnotations);
  }
  return this$static.diffFilter;
}

function HighlightingDiffState_0(editor){
  this.editor = editor;
}

function HighlightingDiffState(){
}

_ = HighlightingDiffState_0.prototype = HighlightingDiffState.prototype = new Object_0;
_.getClass$ = function getClass_634(){
  return Lorg_waveprotocol_wave_client_editor_harness_HighlightingDiffState_2_classLit;
}
;
_.castableTypeMap$ = {};
_.currentContentDoc = null;
_.diffFilter = null;
_.editor = null;
function SignalEventHarness_0(){
  var clearButton, event_0, event$array, event$index, event$max, eventMain, eventText;
  this.eventTestLog = $doc.createElement('div');
  clearButton = new Button_2('Clear', new SignalEventHarness$1_0(this));
  clearButton.element_0.id = 'clear-event-log';
  eventMain = new FlowPanel_0;
  eventText = new TextArea_1;
  eventText.element_0.id = 'event-input';
  this.eventTestLog.id = 'event-signal-log';
  this.eventTestLog.style['borderColor'] = 'black';
  this.eventTestLog.style['borderWidth'] = 1 + ($clinit_68() , 'px');
  this.eventTestLog.style['borderStyle'] = ($clinit_41() , 'solid');
  for (event$array = initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['keydown', 'keypress', 'keyup']) , event$index = 0 , event$max = event$array.length; event$index < event$max; ++event$index) {
    event_0 = event$array[event$index];
    registerEventHandler(eventText.element_0, event_0, false, new SignalEventHarness$2_0(this));
  }
  $add(eventMain, eventText, eventMain.element_0);
  $add(eventMain, clearButton, eventMain.element_0);
  eventMain.element_0.appendChild(this.eventTestLog);
  $initWidget(this, eventMain);
}

function SignalEventHarness(){
}

_ = SignalEventHarness_0.prototype = SignalEventHarness.prototype = new Composite;
_.getClass$ = function getClass_635(){
  return Lorg_waveprotocol_wave_client_editor_harness_SignalEventHarness_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
function SignalEventHarness$1_0(this$0){
  this.this$0 = this$0;
}

function SignalEventHarness$1(){
}

_ = SignalEventHarness$1_0.prototype = SignalEventHarness$1.prototype = new Object_0;
_.getClass$ = function getClass_636(){
  return Lorg_waveprotocol_wave_client_editor_harness_SignalEventHarness$1_2_classLit;
}
;
_.onClick = function onClick_16(e){
  this.this$0.eventTestLog.innerHTML = '';
}
;
_.castableTypeMap$ = {8:1, 25:1};
_.this$0 = null;
function $addInfo(this$static, info, value){
  var el;
  el = $doc.createElement('span');
  $addClassName(el, 'event-info-' + info.name_0.toLowerCase());
  el.textContent = value || '';
  this$static.this$0.eventTestLog.appendChild($doc.createTextNode(' ' + info + ':'));
  this$static.this$0.eventTestLog.appendChild(el);
}

function SignalEventHarness$2_0(this$0){
  this.this$0 = this$0;
}

function SignalEventHarness$2(){
}

_ = SignalEventHarness$2_0.prototype = SignalEventHarness$2.prototype = new Object_0;
_.getClass$ = function getClass_637(){
  return Lorg_waveprotocol_wave_client_editor_harness_SignalEventHarness$2_2_classLit;
}
;
_.onJavaScriptEvent = function onJavaScriptEvent_1(name_0, event_0){
  var signal;
  signal = ($clinit_530() , create_6(DEFAULT_FACTORY, event_0, true));
  if (!signal) {
    return;
  }
  $addInfo(this, ($clinit_989() , TYPE_17), name_0);
  $addInfo(this, KEYSIGNAL, signal.keySignalType.name_0);
  $addInfo(this, KEYCODE, '' + signal.cachedKeyCode);
  $addInfo(this, GETSHIFT, !!signal.nativeEvent.shiftKey + '');
  $addInfo(this, GETALT, !!signal.nativeEvent.altKey + '');
  $addInfo(this, GETCTRL, !!signal.nativeEvent.ctrlKey + '');
  $addInfo(this, GETMETA, !!signal.nativeEvent.metaKey + '');
  $addInfo(this, GETCOMMAND, (logic_0.commandIsCtrl?!!signal.nativeEvent.ctrlKey:!!signal.nativeEvent.metaKey) + '');
  this.this$0.eventTestLog.appendChild($doc.createElement('br'));
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $clinit_958(){
  $clinit_958 = nullMethod;
  $clinit_81();
  $push_0(toInject, ($clinit_176() , '.GMQ4-KSBFH{background-color:#ff0;}.GMQ4-KSBEH{background-color:#ffd0d0;text-decoration:line-through;}'));
  flush();
  $clinit_962();
  ++markerIndex;
}

function styleElement(element, type){
  $clinit_958();
  switch (type.ordinal) {
    case 0:
      $addClassName(element, 'GMQ4-KSBFH');
      break;
    case 1:
      $addClassName(element, 'GMQ4-KSBEH');
      $clinit_962();
      element[TRANSPARENCY] = ($clinit_1371() , DEEP);
      element.setAttribute('contentEditable', 'false');
  }
}

function $clinit_959(){
  $clinit_959 = nullMethod;
  INSERT_0 = new DiffManager$DiffType_0('INSERT', 0);
  DELETE_1 = new DiffManager$DiffType_0('DELETE', 1);
  $VALUES_32 = initValues(_3Lorg_waveprotocol_wave_client_editor_impl_DiffManager$DiffType_2_classLit, {58:1, 138:1}, 95, [INSERT_0, DELETE_1]);
}

function DiffManager$DiffType_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_33(){
  $clinit_959();
  return $VALUES_32;
}

function DiffManager$DiffType(){
}

_ = DiffManager$DiffType_0.prototype = DiffManager$DiffType.prototype = new Enum;
_.getClass$ = function getClass_638(){
  return Lorg_waveprotocol_wave_client_editor_impl_DiffManager$DiffType_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 95:1};
var $VALUES_32, DELETE_1, INSERT_0;
function $clinit_961(){
  $clinit_961 = nullMethod;
  new HtmlViewImpl_0(null);
}

function $asElement_4(node){
  return node.nodeType == 1?node:null;
}

function $asText_3(node){
  return node.nodeType == 3?node:null;
}

function $getAttribute_4(element, name_0){
  return $equals_3(name_0, 'class')?element.className:element.getAttribute(name_0) || '';
}

function $getParentElement_5(node){
  var parent_0;
  return parent_0 = dynamicCastJso(node).parentNode , (!parent_0 || parent_0.nodeType != 1) && (parent_0 = null) , parent_0;
}

function $isSameNode_1(node, other){
  return node == other || !!node && node == other;
}

function HtmlViewImpl_0(documentElement){
  $clinit_961();
  this.documentElement_0 = documentElement;
}

function HtmlViewImpl(){
}

_ = HtmlViewImpl_0.prototype = HtmlViewImpl.prototype = new Object_0;
_.asElement_0 = function asElement_6(node){
  return $asElement_4(dynamicCastJso(node));
}
;
_.asText_0 = function asText_6(node){
  return $asText_3(dynamicCastJso(node));
}
;
_.getAttribute_0 = function getAttribute_3(element, name_0){
  return $getAttribute_4(dynamicCastJso(element), name_0);
}
;
_.getAttributes = function getAttributes_3(element){
  return dynamicCastJso(element) , $clinit_430() , $clinit_430() , EMPTY_MAP;
}
;
_.getClass$ = function getClass_639(){
  return Lorg_waveprotocol_wave_client_editor_impl_HtmlViewImpl_2_classLit;
}
;
_.getData = function getData_3(textNode){
  return dynamicCastJso(textNode).data;
}
;
_.getDocumentElement = function getDocumentElement_5(){
  return this.documentElement_0;
}
;
_.getFirstChild_1 = function getFirstChild_6(node){
  return node.firstChild;
}
;
_.getFirstChild_0 = function getFirstChild_7(node){
  return this.getFirstChild_1(dynamicCastJso(node));
}
;
_.getLastChild_1 = function getLastChild_6(node){
  return node.lastChild;
}
;
_.getLastChild_0 = function getLastChild_7(node){
  return this.getLastChild_1(dynamicCastJso(node));
}
;
_.getLength = function getLength_3(textNode){
  return dynamicCastJso(textNode).length;
}
;
_.getNextSibling_0 = function getNextSibling_4(node){
  return node.nextSibling;
}
;
_.getNextSibling = function getNextSibling_5(node){
  return this.getNextSibling_0(dynamicCastJso(node));
}
;
_.getNodeType_0 = function getNodeType_5(node){
  return dynamicCastJso(node).nodeType;
}
;
_.getParentElement = function getParentElement_4(node){
  var parent_0;
  return parent_0 = dynamicCastJso(node).parentNode , (!parent_0 || parent_0.nodeType != 1) && (parent_0 = null) , parent_0;
}
;
_.getPreviousSibling_0 = function getPreviousSibling_4(node){
  return node.previousSibling;
}
;
_.getPreviousSibling = function getPreviousSibling_5(node){
  return this.getPreviousSibling_0(dynamicCastJso(node));
}
;
_.getTagName = function getTagName_3(element){
  return dynamicCastJso(element).tagName;
}
;
_.isSameNode = function isSameNode_3(node, other){
  return $isSameNode_1(dynamicCastJso(node), dynamicCastJso(other));
}
;
_.castableTypeMap$ = {109:1, 125:1};
_.documentElement_0 = null;
function $clinit_962(){
  $clinit_962 = nullMethod;
  BACKREF_NAME = (++markerIndex , '_x_' + markerIndex + '_cn');
  TRANSPARENCY = (++markerIndex , '_x_' + markerIndex + '_tl');
  TRANSPARENT_BACKREF = (++markerIndex , '_x_' + markerIndex + '_tb');
  MAY_CONTAIN_SELECTION = (++markerIndex , '_x_' + markerIndex + '_mcs');
}

function $elementNodeToWrapperPoint(this$static, container, nodeAfter){
  var filteredHtml;
  filteredHtml = this$static.filteredHtmlView;
  if (maskUndefined($getVisibleNode(filteredHtml, nodeAfter)) !== (nodeAfter == null?null:nodeAfter)) {
    nodeAfter = dynamicCastJso($getNextSibling_3(filteredHtml, nodeAfter));
    !!nodeAfter && (container = $getParentElement(nodeAfter));
  }
  return new Point$El_0($findElementWrapper_0(this$static, container), $findNodeWrapper(this$static, nodeAfter));
}

function $findElementWrapper_0(this$static, element){
  var filteredHtml, visibleElement;
  if (!element) {
    return null;
  }
  filteredHtml = this$static.filteredHtmlView;
  visibleElement = dynamicCastJso($getVisibleNode(filteredHtml, element));
  return visibleElement?$nullifyIfWrongDocument(this$static, !visibleElement?null:dynamicCast(visibleElement[BACKREF_NAME] || null, 152)):null;
}

function $findNodeWrapper(this$static, node){
  if (!node) {
    return null;
  }
  return node.nodeType == 3?$findTextWrapper(this$static, node, false):$findElementWrapper_0(this$static, node);
}

function $findTextWrapper(this$static, target, attemptRepair){
  var $e0, current, filteredHtml, maybeText, nextNode, nextNodelet, nodeletBeforeTextNodes, parentElement, parentNodelet, possibleOwner, possibleOwnerNode, renderedContent, wrapperBeforeTextNodes, find_2, find_4, nodelet, find_5, nodelet_0;
  if (!target) {
    return null;
  }
  renderedContent = this$static.renderedContentView;
  filteredHtml = this$static.filteredHtmlView;
  current = target;
  for (nodeletBeforeTextNodes = dynamicCastJso($getPreviousSibling_3(filteredHtml, target)); nodeletBeforeTextNodes; nodeletBeforeTextNodes = dynamicCastJso($getPreviousSibling_3(filteredHtml, nodeletBeforeTextNodes))) {
    maybeText = dynamicCastJso(filteredHtml.inner_0.asText_0(nodeletBeforeTextNodes));
    if (!maybeText) {
      break;
    }
    current = maybeText;
  }
  parentNodelet = dynamicCastJso($getParentElement_3(filteredHtml, target));
  if (!parentNodelet) {
    throw new RuntimeException_1('Somehow we are asking for the wrapper of something not in the editor??');
  }
  parentElement = !parentNodelet?null:dynamicCast(parentNodelet[BACKREF_NAME] || null, 152);
  if (!nodeletBeforeTextNodes) {
    possibleOwnerNode = dynamicCast((find_2 = renderedContent.inner_0.getFirstChild_0(parentElement) , $getNextVisibleNodeDepthFirst(renderedContent, find_2, parentElement)), 163);
  }
   else {
    wrapperBeforeTextNodes = ($clinit_962() , !nodeletBeforeTextNodes?null:dynamicCast(nodeletBeforeTextNodes[BACKREF_NAME] || null, 152));
    possibleOwnerNode = dynamicCast($getNextSibling_3(renderedContent, wrapperBeforeTextNodes), 163);
  }
  while (true) {
    if (!possibleOwnerNode) {
      throw new InconsistencyException$HtmlInserted_0(new Point$El_0(parentElement, null), new Point$El_0(parentNodelet, (find_4 = filteredHtml.inner_0.getFirstChild_0(parentNodelet) , $getNextVisibleNodeDepthFirst(filteredHtml, find_4, parentNodelet))));
    }
    try {
      possibleOwner = dynamicCast(possibleOwnerNode, 190);
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 204)) {
        if (nodelet = possibleOwnerNode.getImplNodelet() , !!nodelet && !!$getParentElement(nodelet)) {
          throw new InconsistencyException$HtmlInserted_0(new Point$El_0(parentElement, possibleOwnerNode), new Point$El_0(parentNodelet, !nodeletBeforeTextNodes?(find_5 = filteredHtml.inner_0.getFirstChild_0(parentNodelet) , $getNextVisibleNodeDepthFirst(filteredHtml, find_5, parentNodelet)):$getNextSibling_3(filteredHtml, nodeletBeforeTextNodes)));
        }
         else {
          throw new InconsistencyException$HtmlMissing_0(possibleOwnerNode, parentNodelet);
        }
      }
       else 
        throw $e0;
    }
    nextNode = dynamicCast($getNextSibling_3(renderedContent, possibleOwner), 163);
    if (!!nextNode && !(nodelet_0 = nextNode.getImplNodelet() , !!nodelet_0 && !!$getParentElement(nodelet_0))) {
      throw new InconsistencyException$HtmlMissing_0(nextNode, parentNodelet);
    }
    if (current != possibleOwner.implNodelet) {
      if (attemptRepair) {
        possibleOwner.implNodelet = current;
        return !!possibleOwner && possibleOwner.context.this$0.renderingConcerns.this$0.renderedContentView == this$static.renderedContentView?possibleOwner:null;
      }
       else {
        throw new InconsistencyException$HtmlInserted_0(new Point$El_0(parentElement, possibleOwner), new Point$El_0(parentNodelet, current));
      }
    }
    nextNodelet = !nextNode?null:nextNode.getImplNodelet();
    while (current != nextNodelet && !!current) {
      if (current == target) {
        return !!possibleOwner && possibleOwner.context.this$0.renderingConcerns.this$0.renderedContentView == this$static.renderedContentView?possibleOwner:null;
      }
      current = dynamicCastJso($getNextSibling_3(filteredHtml, current));
    }
    possibleOwnerNode = nextNode;
  }
}

function $nodeOffsetToWrapperPoint(this$static, node, offset){
  var container;
  if (node.nodeType == 3) {
    return $textNodeToWrapperPoint(this$static, node, offset);
  }
   else {
    container = node;
    return $elementNodeToWrapperPoint(this$static, container, offset >= container.childNodes.length?null:container.childNodes[offset]);
  }
}

function $nodeletPointToWrapperPoint(this$static, nodelet){
  return nodelet.offset >= 0?$textNodeToWrapperPoint(this$static, dynamicCastJso(nodelet.container), $getTextOffset(nodelet)):$elementNodeToWrapperPoint(this$static, dynamicCastJso(nodelet.container), dynamicCastJso($getNodeAfter(nodelet)));
}

function $nullifyIfWrongDocument(this$static, node){
  return !!node && node.context.this$0.renderingConcerns.this$0.renderedContentView == this$static.renderedContentView?node:null;
}

function $textNodeToWrapperPoint(this$static, text, offset){
  var e, textNode;
  if (dynamicCast($getParentElement(text)[TRANSPARENCY] || null, 120) == ($clinit_1371() , DEEP)) {
    e = $getParentElement(text);
    return $elementNodeToWrapperPoint(this$static, $getParentElement(e), e);
  }
   else {
    textNode = $findTextWrapper(this$static, text, true);
    return new Point$Tx_0(textNode, offset + $getOffset(textNode, text));
  }
}

function $wrapperElementPointToNodeletPoint(this$static, point){
  var container, el, lastWrappedNodelet, nodeletAfter, parentNode, visibleNode;
  if ($getNodeAfter(point) == null) {
    container = dynamicCast(point.container, 152).containerNodelet;
    if (!container) {
      return null;
    }
    lastWrappedNodelet = container.lastChild;
    while (!!lastWrappedNodelet && lastWrappedNodelet.nodeType != 3 && !($clinit_962() , !lastWrappedNodelet?null:dynamicCast(lastWrappedNodelet[BACKREF_NAME] || null, 152))) {
      lastWrappedNodelet = lastWrappedNodelet.previousSibling;
    }
    nodeletAfter = !lastWrappedNodelet?container.firstChild:lastWrappedNodelet.nextSibling;
  }
   else {
    nodeletAfter = $getImplNodeletRightwards(dynamicCast($getNodeAfter(point), 163));
  }
  if (!nodeletAfter) {
    visibleNode = dynamicCast($getVisibleNode(this$static.renderedContentView, dynamicCast(point.container, 163)), 163).asElement();
    el = visibleNode.containerNodelet;
    return el?new Point$El_0(el, null):null;
  }
   else {
    parentNode = nodeletAfter.parentNode;
    return parentNode?new Point$El_0(parentNode, nodeletAfter):null;
  }
}

function $wrapperPointToNodeletPoint(this$static, point){
  var output;
  if (point.offset >= 0) {
    output = $wrapperTextPointToHtmlPoint(this$static, point);
    return new Point$Tx_0(output.node, output.offset);
  }
   else {
    return $wrapperElementPointToNodeletPoint(this$static, point);
  }
}

function $wrapperTextPointToHtmlPoint(this$static, point){
  var $e0, attempt, e, output;
  output = new HtmlPoint_0;
  for (attempt = 1; attempt <= 2; ++attempt) {
    try {
      $findNodeletWithOffset(dynamicCast(point.container, 190), $getTextOffset(point), output);
      break;
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 171)) {
        e = $e0;
        $handle(this$static.repairer, e);
      }
       else 
        throw $e0;
    }
  }
  if (!output.node) {
    throw new EditorRuntimeException_0("Don't know what to do with this - offset too big? point: " + point);
  }
  return output;
}

function NodeManager_0(filteredHtmlView, renderedContentView, repairer){
  $clinit_962();
  this.filteredHtmlView = filteredHtmlView;
  this.renderedContentView = renderedContentView;
  this.repairer = repairer;
}

function getBackReference(nodelet){
  $clinit_962();
  return !nodelet?null:dynamicCast(nodelet[BACKREF_NAME] || null, 152);
}

function NodeManager(){
}

_ = NodeManager_0.prototype = NodeManager.prototype = new Object_0;
_.getClass$ = function getClass_640(){
  return Lorg_waveprotocol_wave_client_editor_impl_NodeManager_2_classLit;
}
;
_.castableTypeMap$ = {};
_.filteredHtmlView = null;
_.renderedContentView = null;
_.repairer = null;
var BACKREF_NAME, MAY_CONTAIN_SELECTION, TRANSPARENCY, TRANSPARENT_BACKREF, markerIndex = 0;
function $maybeStrip(node){
  var element, n;
  if (!node || node.nodeType == 3)
    return false;
  element = node;
  $clinit_962();
  if (!(!!element && (element[BACKREF_NAME] || null) != null)) {
    while (n = element.firstChild) {
      element.parentNode.insertBefore(n, element);
    }
    $removeFromParent(element);
    return true;
  }
  return false;
}

function StrippingHtmlView_0(documentElement){
  $clinit_961();
  this.documentElement_0 = documentElement;
}

function StrippingHtmlView(){
}

_ = StrippingHtmlView_0.prototype = StrippingHtmlView.prototype = new HtmlViewImpl;
_.getClass$ = function getClass_641(){
  return Lorg_waveprotocol_wave_client_editor_impl_StrippingHtmlView_2_classLit;
}
;
_.getFirstChild_1 = function getFirstChild_8(node){
  var n;
  while ($maybeStrip(n = node.firstChild)) {
  }
  return n;
}
;
_.getLastChild_1 = function getLastChild_8(node){
  var n;
  while ($maybeStrip(n = node.lastChild)) {
  }
  return n;
}
;
_.getNextSibling_0 = function getNextSibling_6(node){
  var n;
  while ($maybeStrip(n = node.nextSibling)) {
  }
  return n;
}
;
_.getPreviousSibling_0 = function getPreviousSibling_6(node){
  var n;
  while ($maybeStrip(n = node.previousSibling)) {
  }
  return n;
}
;
_.castableTypeMap$ = {109:1, 125:1};
function $clinit_964(){
  $clinit_964 = nullMethod;
  NONE_2 = new KeyBindingRegistry_0;
}

function KeyBindingRegistry_0(){
  $clinit_964();
  this.bindings = new HashMap_0;
}

function KeyBindingRegistry(){
}

_ = KeyBindingRegistry_0.prototype = KeyBindingRegistry.prototype = new Object_0;
_.getClass$ = function getClass_642(){
  return Lorg_waveprotocol_wave_client_editor_keys_KeyBindingRegistry_2_classLit;
}
;
_.castableTypeMap$ = {};
var NONE_2;
function EditorOperationSequencer_0(sink){
  this.sink = sink;
}

function EditorOperationSequencer(){
}

_ = EditorOperationSequencer_0.prototype = EditorOperationSequencer.prototype = new Object_0;
_.begin = function begin_4(){
}
;
_.consume_0 = function consume_6(operation){
  $consumeAndReturnInvertible_0(this.sink, operation);
}
;
_.end_0 = function end_7(){
}
;
_.getClass$ = function getClass_643(){
  return Lorg_waveprotocol_wave_client_editor_operation_EditorOperationSequencer_2_classLit;
}
;
_.castableTypeMap$ = {};
_.sink = null;
function $getWordBoundary(this$static, forward_0){
  var $e0, boundary, e, s, selection;
  boundary = null;
  s = getSelectionGuarded();
  forward_0?(s.modify('move', ($clinit_978() , FORWARD).name_0, ($clinit_979() , WORD_0).name_0) , undefined):(s.modify('move', ($clinit_978() , BACKWARD).name_0, ($clinit_979() , WORD_0).name_0) , undefined);
  try {
    selection = getSelectionGuarded();
    s.getRangeAt(0);
    boundary = $nodeOffsetToWrapperPoint(this$static.nodeManager, selection.focusNode, selection.focusOffset);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 171)) {
      e = $e0;
      $log_4(($clinit_672() , logger_1).fatalLogger, 'html missing not handled', e);
    }
     else if (instanceOf($e0, 172)) {
      e = $e0;
      $log_4(($clinit_672() , logger_1).fatalLogger, 'html inserted not handled', e);
    }
     else 
      throw $e0;
  }
  return boundary;
}

function CaretMovementHelperWebkitImpl_0(nodeManager){
  this.nodeManager = nodeManager;
}

function CaretMovementHelperWebkitImpl(){
}

_ = CaretMovementHelperWebkitImpl_0.prototype = CaretMovementHelperWebkitImpl.prototype = new Object_0;
_.getClass$ = function getClass_644(){
  return Lorg_waveprotocol_wave_client_editor_selection_content_CaretMovementHelperWebkitImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.nodeManager = null;
function $getSkipLevel_1(this$static, node){
  if ($isRendered(node)) {
    if (this$static.inner_0.asText_0(node) != null) {
      return $clinit_1371() , DEEP;
    }
    return isKnownInvalidTopContainerForCursor(node)?($clinit_1371() , SHALLOW):($clinit_1371() , NONE_4);
  }
   else {
    return $clinit_1371() , DEEP;
  }
}

function PassiveSelectionHelper$ValidSelectionContainerView_0(rawView){
  checkNotNull_1(rawView, 'IdentityView (or subclass): Inner document may not be null!');
  this.inner_0 = rawView;
}

function PassiveSelectionHelper$ValidSelectionContainerView(){
}

_ = PassiveSelectionHelper$ValidSelectionContainerView_0.prototype = PassiveSelectionHelper$ValidSelectionContainerView.prototype = new FilteredView;
_.getClass$ = function getClass_645(){
  return Lorg_waveprotocol_wave_client_editor_selection_content_PassiveSelectionHelper$ValidSelectionContainerView_2_classLit;
}
;
_.getSkipLevel = function getSkipLevel_2(node){
  return $getSkipLevel_1(this, dynamicCast(node, 163));
}
;
_.castableTypeMap$ = {109:1, 121:1, 122:1, 125:1};
function filterNonContentSelection(htmlSelection){
  var el, htmlFocus, parent_0;
  if (!htmlSelection) {
    return null;
  }
  htmlFocus = htmlSelection.focus_0;
  htmlFocus.offset >= 0?(el = (parent_0 = dynamicCastJso(htmlFocus.container).parentNode , (!parent_0 || parent_0.nodeType != 1) && (parent_0 = null) , parent_0)):(el = dynamicCastJso(htmlFocus.container));
  while ($clinit_962() , !(!!el && (el[BACKREF_NAME] || null) != null)) {
    if (dynamicCast(el[TRANSPARENCY] || null, 120) == ($clinit_1371() , DEEP) || !!el[$clinit_697() , COMPLEX_IMPLEMENTATION_MARKER]) {
      if (!el[MAY_CONTAIN_SELECTION]) {
        htmlSelection = null;
        break;
      }
    }
    el = $getParentElement(el);
  }
  return htmlSelection;
}

function placeCaretAfterElement(selection, element){
  $setCaret_0(selection, getFilteredPoint(element.context.this$0.renderingConcerns.this$0.renderedContentView, new Point$El_0(element.parent_0, element.next)));
}

function placeCaretBeforeElement(selection, element){
  $setCaret_0(selection, getFilteredPoint(element.context.this$0.renderingConcerns.this$0.renderedContentView, new Point$El_0(element.parent_0, element)));
}

function $clinit_971(){
  $clinit_971 = nullMethod;
  UNSKIPPED_TRANSIENT_CONTAINERS = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringSetAdapter_0(new HashSet_0));
  SHALLOW_SKIPPED_TRANSIENT_CONTAINERS = new CollectionUtils$StringSetAdapter_0(new HashSet_0);
  SHALLOW_SKIPPED_PERSISTENT_CONTAINERS = new CollectionUtils$StringSetAdapter_0(new HashSet_0);
  DEEP_SKIPPED_PERSISTENT_CONTAINERS = new CollectionUtils$StringSetAdapter_0(new HashSet_0);
}

function $resolveSkip(node, skipLevels){
  var elt, isRendered, tagName, tagName_0;
  elt = node.asElement();
  if (!elt) {
    return $clinit_1371() , NONE_4;
  }
  isRendered = skipLevels[1] == ($clinit_1371() , NONE_4);
  switch (skipLevels[0].ordinal) {
    case 0:
      return isRendered?NONE_4:(tagName = elt.tagName_0 , $contains_7(SHALLOW_SKIPPED_PERSISTENT_CONTAINERS, tagName)?SHALLOW:$contains_7(DEEP_SKIPPED_PERSISTENT_CONTAINERS, tagName)?DEEP:NONE_4);
    case 1:
    case 2:
      return tagName_0 = elt.tagName_0 , $contains_7(UNSKIPPED_TRANSIENT_CONTAINERS, tagName_0)?NONE_4:$contains_7(SHALLOW_SKIPPED_TRANSIENT_CONTAINERS, tagName_0)?SHALLOW:DEEP;
  }
  return INVALID;
}

function registerTagForSelections(tag, isPersistent, skipLevel){
  $clinit_971();
  switch (skipLevel.ordinal) {
    case 0:
      isPersistent || $add_20(UNSKIPPED_TRANSIENT_CONTAINERS, tag);
      break;
    case 1:
      isPersistent?$add_20(SHALLOW_SKIPPED_PERSISTENT_CONTAINERS, tag):$add_20(SHALLOW_SKIPPED_TRANSIENT_CONTAINERS, tag);
      break;
    case 2:
      isPersistent && $add_20(DEEP_SKIPPED_PERSISTENT_CONTAINERS, tag);
  }
}

var DEEP_SKIPPED_PERSISTENT_CONTAINERS, SHALLOW_SKIPPED_PERSISTENT_CONTAINERS, SHALLOW_SKIPPED_TRANSIENT_CONTAINERS, UNSKIPPED_TRANSIENT_CONTAINERS;
function $clinit_973(){
  $clinit_973 = nullMethod;
  new BufferedLogger_0;
  $clinit_975();
}

function get_14(){
  $clinit_973();
  if (caching) {
    cache_0 = null;
    return cache_0;
  }
   else {
    return null;
  }
}

var cache_0 = null, caching = false;
function $clinit_975(){
  $clinit_975 = nullMethod;
  $clinit_973();
}

function $setCaret_3(this$static, node){
  $clinit_515();
  this$static.setBaseAndExtent(node, 0, node, 0);
}

function getSelectionGuarded(){
  var selection;
  selection = $wnd.getSelection();
  if (!!selection && isUnreadable(selection.anchorNode)) {
    $setCaret_3(selection, ($clinit_973() , $doc.activeElement));
    return selection;
  }
  return selection;
}

--></script>
<script><!--
function $clinit_978(){
  $clinit_978 = nullMethod;
  FORWARD = new SelectionWebkit$Direction_0('FORWARD', 0);
  BACKWARD = new SelectionWebkit$Direction_0('BACKWARD', 1);
  LEFT_2 = new SelectionWebkit$Direction_0('LEFT', 2);
  RIGHT_2 = new SelectionWebkit$Direction_0('RIGHT', 3);
  $VALUES_33 = initValues(_3Lorg_waveprotocol_wave_client_editor_selection_html_SelectionWebkit$Direction_2_classLit, {58:1, 138:1}, 96, [FORWARD, BACKWARD, LEFT_2, RIGHT_2]);
}

function SelectionWebkit$Direction_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_34(){
  $clinit_978();
  return $VALUES_33;
}

function SelectionWebkit$Direction(){
}

_ = SelectionWebkit$Direction_0.prototype = SelectionWebkit$Direction.prototype = new Enum;
_.getClass$ = function getClass_646(){
  return Lorg_waveprotocol_wave_client_editor_selection_html_SelectionWebkit$Direction_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 96:1};
var $VALUES_33, BACKWARD, FORWARD, LEFT_2, RIGHT_2;
function $clinit_979(){
  $clinit_979 = nullMethod;
  CHARACTER_0 = new SelectionWebkit$MoveUnit_0('CHARACTER', 0);
  WORD_0 = new SelectionWebkit$MoveUnit_0('WORD', 1);
  SENTENCE = new SelectionWebkit$MoveUnit_0('SENTENCE', 2);
  LINE_1 = new SelectionWebkit$MoveUnit_0('LINE', 3);
  PARAGRAPH = new SelectionWebkit$MoveUnit_0('PARAGRAPH', 4);
  $VALUES_34 = initValues(_3Lorg_waveprotocol_wave_client_editor_selection_html_SelectionWebkit$MoveUnit_2_classLit, {58:1, 138:1}, 97, [CHARACTER_0, WORD_0, SENTENCE, LINE_1, PARAGRAPH]);
}

function SelectionWebkit$MoveUnit_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_35(){
  $clinit_979();
  return $VALUES_34;
}

function SelectionWebkit$MoveUnit(){
}

_ = SelectionWebkit$MoveUnit_0.prototype = SelectionWebkit$MoveUnit.prototype = new Enum;
_.getClass$ = function getClass_647(){
  return Lorg_waveprotocol_wave_client_editor_selection_html_SelectionWebkit$MoveUnit_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 97:1};
var $VALUES_34, CHARACTER_0, LINE_1, PARAGRAPH, SENTENCE, WORD_0;
function $getFromKeyboardSpecifiedDirectionOnly(el){
  while (true) {
    if (!el) {
      el = null;
      break;
    }
    break;
  }
  return el;
}

function $registerElement(this$static, element){
  $put_1(this$static.suggestables, element.contentElement, element);
}

function $setCurrent(this$static, newCurrent){
  var alreadyShown, element, suggestable;
  alreadyShown = false;
  if (this$static.current) {
    !newCurrent?$hide_0(this$static.popupCloser.this$0.popup):$clearRange(this$static.current.value_0.replacementRangeHelper);
    alreadyShown = true;
  }
  if (newCurrent) {
    this$static.current = newCurrent;
    suggestable = this$static.current.value_0;
    $clearItems(this$static.menu);
    $populateSuggestionMenu(suggestable);
    $moveSelectionDown(this$static.menu);
    element = suggestable.contentElement;
    this$static.popupAnchor = element.implNodelet;
    !this$static.savedSelection && (this$static.savedSelection = $getSelectionRange(this$static.selectionHelper));
    alreadyShown?$move_0(this$static.popup):$show_0(this$static.popup);
  }
}

function $showSuggestionsFor(this$static, suggestable){
  var element;
  $cancelScheduledClose(this$static.popupCloser);
  element = suggestable.contentElement;
  $isContentAttached(element) && $setCurrent(this$static, $getElement(this$static.suggestables, element));
}

function $showSuggestionsNearestTo(this$static, location_0){
  var newCurrent, found;
  $cancelScheduledClose(this$static.popupCloser);
  newCurrent = $findBefore(this$static.suggestables, dynamicCast(location_0.container, 163));
  !newCurrent?(newCurrent = $getFirst(this$static.suggestables)):$isLast(this$static.suggestables, newCurrent) || $getNext(newCurrent);
  if (!newCurrent) {
    return false;
  }
  $setCurrent(this$static, (found = $getFromKeyboardSpecifiedDirectionOnly(newCurrent) , !found && $getFromKeyboardSpecifiedDirectionOnly(newCurrent) , found));
  return !!newCurrent;
}

function InteractiveSuggestionsManager_0(selectionHelper){
  this.handler = new InteractiveSuggestionsManager$1_0(this);
  this.menu = new SuggestionMenu_0(this.handler);
  this.suggestables = new LinkedPruningSequenceMap_0(new LinkedPruningSequenceMap$1_0);
  this.popupCloser = new InteractiveSuggestionsManager$PopupCloser_0(this, new SchedulerTimerService_0((!instance_6 && (instance_6 = new BrowserBackedScheduler_0 , setDefaultTimerService() , undefined) , instance_6)));
  this.popup = createPopup_0(this, this.menu, this);
  this.closeSuggestionMenuDelayMs = 500;
  this.selectionHelper = selectionHelper;
}

function InteractiveSuggestionsManager(){
}

_ = InteractiveSuggestionsManager_0.prototype = InteractiveSuggestionsManager.prototype = new Object_0;
_.getClass$ = function getClass_648(){
  return Lorg_waveprotocol_wave_client_editor_sugg_InteractiveSuggestionsManager_2_classLit;
}
;
_.onHide = function onHide_0(source){
  try {
    !!this.savedSelection && $setSelectionRange(this.selectionHelper, this.savedSelection);
  }
   finally {
    this.savedSelection = null;
    if (this.current) {
      $clearRange(this.current.value_0.replacementRangeHelper);
      this.current = null;
    }
  }
}
;
_.onShow = function onShow_0(source){
  $clinit_973();
  cache_0 = null;
  $clinit_373();
  $focus_0(this.menu.element_0);
}
;
_.setPopupPositionAndMakeVisible = function setPopupPositionAndMakeVisible_0(reference, popup){
  var popupStyle;
  popupStyle = popup.style;
  popupStyle['left'] = $getAbsoluteLeft(this.popupAnchor) - (popup.offsetWidth || 0) + 26 + ($clinit_68() , 'px');
  popupStyle['top'] = $getAbsoluteBottom(this.popupAnchor) + 5 + 'px';
  popupStyle['visibility'] = ($clinit_78() , 'visible');
}
;
_.castableTypeMap$ = {212:1};
_.closeSuggestionMenuDelayMs = 0;
_.current = null;
_.popup = null;
_.popupAnchor = null;
_.savedSelection = null;
_.selectionHelper = null;
function $handleLeftRight(this$static, isRight){
  var newCurrent;
  newCurrent = isRight?$getNext(this$static.this$0.current):$getPrev(this$static.this$0.current);
  newCurrent == this$static.this$0.current && (newCurrent = null);
  $setCurrent(this$static.this$0, newCurrent);
}

function InteractiveSuggestionsManager$1_0(this$0){
  this.this$0 = this$0;
}

function InteractiveSuggestionsManager$1(){
}

_ = InteractiveSuggestionsManager$1_0.prototype = InteractiveSuggestionsManager$1.prototype = new Object_0;
_.getClass$ = function getClass_649(){
  return Lorg_waveprotocol_wave_client_editor_sugg_InteractiveSuggestionsManager$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $cancelScheduledClose(this$static){
  $cancel_1(this$static.timerService.scheduler, this$static.task);
}

function $scheduleClose(this$static){
  $scheduleDelayed_0(this$static.timerService, this$static.task, this$static.this$0.closeSuggestionMenuDelayMs);
}

function InteractiveSuggestionsManager$PopupCloser_0(this$0, timerService){
  this.this$0 = this$0;
  this.task = new InteractiveSuggestionsManager$PopupCloser$1_0(this);
  this.timerService = timerService;
}

function InteractiveSuggestionsManager$PopupCloser(){
}

_ = InteractiveSuggestionsManager$PopupCloser_0.prototype = InteractiveSuggestionsManager$PopupCloser.prototype = new Object_0;
_.getClass$ = function getClass_650(){
  return Lorg_waveprotocol_wave_client_editor_sugg_InteractiveSuggestionsManager$PopupCloser_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.timerService = null;
function InteractiveSuggestionsManager$PopupCloser$1_0(this$1){
  this.this$1 = this$1;
}

function InteractiveSuggestionsManager$PopupCloser$1(){
}

_ = InteractiveSuggestionsManager$PopupCloser$1_0.prototype = InteractiveSuggestionsManager$PopupCloser$1.prototype = new Object_0;
_.execute = function execute_33(){
  $hide_0(this.this$1.this$0.popup);
}
;
_.getClass$ = function getClass_651(){
  return Lorg_waveprotocol_wave_client_editor_sugg_InteractiveSuggestionsManager$PopupCloser$1_2_classLit;
}
;
_.castableTypeMap$ = {209:1, 210:1};
_.this$1 = null;
function $clinit_986(){
  $clinit_986 = nullMethod;
  $clinit_81();
  $push_0(toInject, ($clinit_176() , "a.GMQ4-KSBLH,a.GMQ4-KSBIH,a.GMQ4-KSBGH{display:block;color:#003ea8;background-color:white;cursor:pointer;padding:3px 20px 4px 20px;margin:0 -2px !important;text-decoration:none;}.GMQ4-KSBHH a.GMQ4-KSBLH,.GMQ4-KSBHH a.GMQ4-KSBIH,.GMQ4-KSBHH a.GMQ4-KSBGH{color:white;background-color:#4086ff;text-decoration:none;}.GMQ4-KSBHH a.GMQ4-KSBLH label,.GMQ4-KSBHH a.GMQ4-KSBIH label{color:#c0d4ff;}.GMQ4-KSBLH label,.GMQ4-KSBIH label{margin-right:5px;text-decoration:underline;color:#7295cf;}.GMQ4-KSBLH span{font-weight:bold;text-decoration:none;}.GMQ4-KSBIH span{font-style:italic;text-decoration:none;}.GMQ4-KSBIH{background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHRJREFUeNpiYIABuxX/GQgAJmIVggAjEQo3AnEDw6GIC4woJh+KYERRZreCH0gmgBUzMDgyorgZXTFCrh5IKjDBBXAphIANQGzAxEAcEECEBmHgAMQXGPEqsVuhAPVgPsgZLDgUwYLzARAfACkE+ukhQIABAKZuHUYsPLRcAAAAAElFTkSuQmCC');background-repeat:no-repeat;background-position:5px 50%;}.GMQ4-KSBHH a.GMQ4-KSBIH{background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAGZJREFUeNpiYICC/0DAQAAwEasQrBhZ4X/sYAMQGzCgK0I3CSjED8T5QPwepIERWQMjEGCzHihVD6QUiHEqSLE+EJ9nYiAOCMBDgwjgAMQXCFmvAMQNUA/K41IEA/eBeD5MIUCAAQCexWwv78dj0QAAAABJRU5ErkJggg==');background-repeat:no-repeat;background-position:5px 50%;}.GMQ4-KSBGH span{margin-left:12px;text-decoration:none;}.GMQ4-KSBKH{width:100%;margin-top:1px;height:1px;border-top:1px solid #e3e8f2;}.GMQ4-KSBJH{background:#d0e8ff;}"));
  flush();
}

function $handleEventInner_0(this$static, event_0){
  var index, item, keyCode, target;
  switch ($eventGetTypeInt(event_0.type)) {
    case 262144:
      event_0.preventDefault();
      break;
    case 256:
    case 128:
      {
        keyCode = event_0.keyCode || 0;
        switch (keyCode) {
          case 37:
          case 39:
            $handleLeftRight(this$static.handler, keyCode == 39);
            event_0.stopPropagation();
            return;
          case 13:
            event_0.stopPropagation();
        }
        if (keyCode >= 49 && keyCode <= 57) {
          index = keyCode - 49;
          if (index >= 0 && index < this$static.items.size) {
            item = dynamicCast($get_3(this$static.items, index), 39);
            if (!item) {
              return;
            }
            $execute(item.command);
            event_0.preventDefault();
          }
        }
        break;
      }

    case 32:
      {
        target = event_0.relatedTarget;
        $isOrHasChild(this$static.element_0, target) || $scheduleClose(this$static.handler.this$0.popupCloser);
        break;
      }

    case 16:
      {
        $cancelScheduledClose(this$static.handler.this$0.popupCloser);
        break;
      }

  }
}

function SuggestionMenu_0(handler){
  $clinit_986();
  MenuBar_1.call(this, $clinit_314());
  this.handler = handler;
  this.eventsToSink == -1?sinkEvents(this.element_0, 262400 | (this.element_0.__eventBits || 0)):(this.eventsToSink |= 262400);
}

function SuggestionMenu(){
}

_ = SuggestionMenu_0.prototype = SuggestionMenu.prototype = new MenuBar;
_.getClass$ = function getClass_652(){
  return Lorg_waveprotocol_wave_client_editor_sugg_SuggestionMenu_2_classLit;
}
;
_.onBrowserEvent = function onBrowserEvent_5(event_0){
  var sEvent;
  sEvent = ($clinit_530() , create_6(DEFAULT_FACTORY, event_0, true));
  !!sEvent && $handleEventInner_0(this, event_0);
  $onBrowserEvent_1(this, event_0);
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
_.handler = null;
function $clinit_989(){
  $clinit_989 = nullMethod;
  TYPE_17 = new TestConstants$EventInfo_0('TYPE', 0);
  KEYSIGNAL = new TestConstants$EventInfo_0('KEYSIGNAL', 1);
  KEYCODE = new TestConstants$EventInfo_0('KEYCODE', 2);
  GETSHIFT = new TestConstants$EventInfo_0('GETSHIFT', 3);
  GETALT = new TestConstants$EventInfo_0('GETALT', 4);
  GETCTRL = new TestConstants$EventInfo_0('GETCTRL', 5);
  GETMETA = new TestConstants$EventInfo_0('GETMETA', 6);
  GETCOMMAND = new TestConstants$EventInfo_0('GETCOMMAND', 7);
  $VALUES_35 = initValues(_3Lorg_waveprotocol_wave_client_editor_testtools_TestConstants$EventInfo_2_classLit, {58:1, 138:1}, 98, [TYPE_17, KEYSIGNAL, KEYCODE, GETSHIFT, GETALT, GETCTRL, GETMETA, GETCOMMAND]);
}

function TestConstants$EventInfo_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_36(){
  $clinit_989();
  return $VALUES_35;
}

function TestConstants$EventInfo(){
}

_ = TestConstants$EventInfo_0.prototype = TestConstants$EventInfo.prototype = new Enum;
_.getClass$ = function getClass_653(){
  return Lorg_waveprotocol_wave_client_editor_testtools_TestConstants$EventInfo_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 98:1};
var $VALUES_35, GETALT, GETCOMMAND, GETCTRL, GETMETA, GETSHIFT, KEYCODE, KEYSIGNAL, TYPE_17;
function $biasFromContainers(this$static, at){
  var atContainerEnd, atContainerStart;
  atContainerStart = isAtLineStart(this$static.doc, at);
  atContainerEnd = isAtLineEnd(this$static.doc, at);
  return atContainerStart && atContainerEnd?($clinit_1073() , NEITHER):atContainerStart?($clinit_1073() , RIGHT_3):atContainerEnd?($clinit_1073() , LEFT_3):($clinit_1073() , NEITHER);
}

function $buildBoundaryMaps(this$static, location_0){
  var keysToCheck, leftValues, rightValues;
  this$static.leftSide.backend.clear();
  this$static.rightSide.backend.clear();
  leftValues = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  rightValues = new CollectionUtils$StringMapAdapter_0(new HashMap_0);
  keysToCheck = new CollectionUtils$StringSetAdapter_0(new HashSet_0);
  location_0 > 0 && (this$static.doc.doc.annotations.forEachAnnotationAt(location_0 - 1, new IndexedDocumentImpl$7_0(new AnnotationBehaviourLogic$3_0(leftValues, keysToCheck))) , undefined);
  location_0 < $size_10(this$static.doc.doc) && (this$static.doc.doc.annotations.forEachAnnotationAt(location_0, new IndexedDocumentImpl$7_0(new AnnotationBehaviourLogic$4_0(rightValues, keysToCheck))) , undefined);
  $each_3(keysToCheck, new AnnotationBehaviourLogic$5_0(this$static, leftValues, rightValues));
}

function $rebias(this$static, start, end, lastMovement){
  var bestPriority, bias;
  checkState(!!this$static.doc, 'Cannot call out of init/reset cycle.');
  checkPositionIndexesInRange(start, end, $size_10(this$static.doc.doc));
  if (start != end) {
    return $clinit_1073() , RIGHT_3;
  }
  bestPriority = new Box_1(new Double_0(0));
  bias = new Box_1($biasFromContainers(this$static, $locate_0(this$static.doc.doc, start)));
  bias.boxed === ($clinit_1073() , NEITHER)?(bias.boxed = toBiasDirection(lastMovement)):(bestPriority.boxed = new Double_0(5));
  $buildBoundaryMaps(this$static, start);
  $each_2(this$static.leftSide, new AnnotationBehaviourLogic$1_0(this$static, bestPriority, bias, lastMovement));
  return dynamicCast(bias.boxed, 105);
}

function $shouldInheritFromRight(bias, inherit){
  switch (inherit.ordinal) {
    case 0:
      if (bias == ($clinit_1073() , RIGHT_3)) {
        return true;
      }

      break;
    case 1:
      if (bias == ($clinit_1073() , LEFT_3) || bias == NEITHER) {
        return true;
      }

  }
  return false;
}

function $supplementAnnotations(this$static, location_0, bias, type){
  checkState(!!this$static.doc, 'Cannot call out of init/reset cycle.');
  $buildBoundaryMaps(this$static, location_0);
  $locate_0(this$static.doc.doc, location_0);
  $each_2(this$static.leftSide, new AnnotationBehaviourLogic$2_0(this$static, bias, type, location_0));
}

function AnnotationBehaviourLogic_0(registry, doc, caret){
  this.leftSide = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  this.rightSide = new CollectionUtils$StringMapAdapter_0(new HashMap_0);
  this.registry = registry;
  this.doc = doc;
  this.caret = caret;
}

function AnnotationBehaviourLogic(){
}

_ = AnnotationBehaviourLogic_0.prototype = AnnotationBehaviourLogic.prototype = new Object_0;
_.getClass$ = function getClass_654(){
  return Lorg_waveprotocol_wave_client_editor_util_AnnotationBehaviourLogic_2_classLit;
}
;
_.castableTypeMap$ = {};
_.caret = null;
_.doc = null;
_.registry = null;
function AnnotationBehaviourLogic$1_0(this$0, val$bestPriority, val$bias, val$lastMovement){
  this.this$0 = this$0;
  this.val$bestPriority = val$bestPriority;
  this.val$bias = val$bias;
  this.val$lastMovement = val$lastMovement;
}

function AnnotationBehaviourLogic$1(){
}

_ = AnnotationBehaviourLogic$1_0.prototype = AnnotationBehaviourLogic$1.prototype = new Object_0;
_.apply_0 = function apply_22(key, value){
  var behaviour, behaviours, priority, ret;
  behaviours = $getBehaviours(this.this$0.registry, key);
  while (behaviours.next) {
    behaviour = (ret = behaviours.next , $getNext_1(behaviours) , ret);
    priority = behaviour.getPriority();
    if (priority > dynamicCast(this.val$bestPriority.boxed, 137).value_0) {
      this.val$bestPriority.boxed = new Double_0(priority);
      this.val$bias.boxed = behaviour.getBias(this.this$0.leftSide, this.this$0.rightSide, this.val$lastMovement);
    }
  }
}
;
_.getClass$ = function getClass_655(){
  return Lorg_waveprotocol_wave_client_editor_util_AnnotationBehaviourLogic$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$bestPriority = null;
_.val$bias = null;
_.val$lastMovement = null;
function AnnotationBehaviourLogic$2_0(this$0, val$bias, val$type, val$location){
  this.this$0 = this$0;
  this.val$bias = val$bias;
  this.val$type = val$type;
  this.val$location = val$location;
}

function AnnotationBehaviourLogic$2(){
}

_ = AnnotationBehaviourLogic$2_0.prototype = AnnotationBehaviourLogic$2.prototype = new Object_0;
_.apply_0 = function apply_23(key, value){
  var behaviours, direction, inheritFromRight, newValue, oldValue, ret;
  if (this.this$0.caret.annotations.containsKey(key)) {
    return;
  }
  direction = ($clinit_1076() , INSIDE);
  behaviours = $getBehaviours(this.this$0.registry, key);
  if (behaviours.next) {
    direction = (ret = behaviours.next , $getNext_1(behaviours) , ret).replace_0(this.this$0.rightSide, this.this$0.leftSide, this.val$type);
    inheritFromRight = $shouldInheritFromRight(this.val$bias, direction);
  }
   else {
    inheritFromRight = this.val$bias == ($clinit_1073() , RIGHT_3);
  }
  if (inheritFromRight) {
    newValue = getAlignedAnnotation(this.this$0.doc, this.val$location, key, false);
    oldValue = $getAnnotation_2(this.this$0.doc.doc, this.val$location - 1, key);
    (newValue == null?oldValue == null:$equals_3(newValue, oldValue)) || (this.this$0.caret.annotations.put(key, newValue) , undefined);
  }
   else 
    direction == NEITHER_0 && this.val$location > 0 && $getAnnotation_2(this.this$0.doc.doc, this.val$location - 1, key) != null && (this.this$0.caret.annotations.put(key, null) , undefined);
}
;
_.getClass$ = function getClass_656(){
  return Lorg_waveprotocol_wave_client_editor_util_AnnotationBehaviourLogic$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$bias = null;
_.val$location = 0;
_.val$type = null;
function $apply_6(this$static, key, value){
  if (value != null) {
    $put_5(this$static.val$leftValues, key, value);
    $add_20(this$static.val$keysToCheck, key);
  }
}

function AnnotationBehaviourLogic$3_0(val$leftValues, val$keysToCheck){
  this.val$leftValues = val$leftValues;
  this.val$keysToCheck = val$keysToCheck;
}

function AnnotationBehaviourLogic$3(){
}

_ = AnnotationBehaviourLogic$3_0.prototype = AnnotationBehaviourLogic$3.prototype = new Object_0;
_.apply_0 = function apply_24(key, value){
  $apply_6(this, key, dynamicCast(value, 1));
}
;
_.getClass$ = function getClass_657(){
  return Lorg_waveprotocol_wave_client_editor_util_AnnotationBehaviourLogic$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$keysToCheck = null;
_.val$leftValues = null;
function $apply_7(this$static, key, value){
  if (value != null) {
    $put_5(this$static.val$rightValues, key, value);
    $add_20(this$static.val$keysToCheck, key);
  }
}

function AnnotationBehaviourLogic$4_0(val$rightValues, val$keysToCheck){
  this.val$rightValues = val$rightValues;
  this.val$keysToCheck = val$keysToCheck;
}

function AnnotationBehaviourLogic$4(){
}

_ = AnnotationBehaviourLogic$4_0.prototype = AnnotationBehaviourLogic$4.prototype = new Object_0;
_.apply_0 = function apply_25(key, value){
  $apply_7(this, key, dynamicCast(value, 1));
}
;
_.getClass$ = function getClass_658(){
  return Lorg_waveprotocol_wave_client_editor_util_AnnotationBehaviourLogic$4_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$keysToCheck = null;
_.val$rightValues = null;
function AnnotationBehaviourLogic$5_0(this$0, val$leftValues, val$rightValues){
  this.this$0 = this$0;
  this.val$leftValues = val$leftValues;
  this.val$rightValues = val$rightValues;
}

function AnnotationBehaviourLogic$5(){
}

_ = AnnotationBehaviourLogic$5_0.prototype = AnnotationBehaviourLogic$5.prototype = new Object_0;
_.apply_3 = function apply_26(key){
  var left, right;
  left = dynamicCast($get_12(this.val$leftValues, key), 1);
  right = dynamicCast($get_12(this.val$rightValues, key), 1);
  if (left == null?right != null:!$equals_3(left, right)) {
    $put_5(this.this$0.leftSide, key, left);
    $put_5(this.this$0.rightSide, key, right);
  }
}
;
_.getClass$ = function getClass_659(){
  return Lorg_waveprotocol_wave_client_editor_util_AnnotationBehaviourLogic$5_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$leftValues = null;
_.val$rightValues = null;
function formatContentDomString(editor){
  var $e0;
  if (!editor || $isConsistent(editor)) {
    if (editor) {
      $getOrderedHtmlSelection(editor);
      try {
        return $print(new Pretty_0, editor.content_0.fullContentView);
      }
       catch ($e0) {
        $e0 = caught_0($e0);
        if (!instanceOf($e0, 172))
          if (!instanceOf($e0, 171))
            throw $e0;
      }
    }
     else {
      return null;
    }
  }
  $logPlainText(($clinit_672() , logger_1).errorLogger, 'EditorDocFormatter called with inconsistent Doc');
  return null;
}

function formatImplDomString(editor){
  var view;
  if (!editor || $isConsistent(editor)) {
    $clinit_973();
    view = editor.content_0.rawHtmlView;
    return $print(new Pretty_0, view);
  }
   else {
    $logPlainText(($clinit_672() , logger_1).errorLogger, 'EditorDocFormatter called with inconsistent Doc');
    return null;
  }
}

function formatPersistentDomString(editor){
  if (!editor || $isConsistent(editor)) {
    return toPrettyXmlString($asOperation(editor.content_0.indexedDoc));
  }
   else {
    $logPlainText(($clinit_672() , logger_1).errorLogger, 'EditorDocFormatter called with inconsistent Doc');
    return null;
  }
}

function nativeSetupWebDriverTestPins_0(){
  $wnd['webdriverEditorGetContent'] = function(editorDiv){
    return webdriverEditorGetContent(editorDiv);
  }
  ;
  $wnd['webdriverEditorSetContent'] = function(editorDiv, content_0){
    webdriverEditorSetContent(editorDiv, content_0);
  }
  ;
  $wnd['webdriverEditorGetStartSelection'] = function(editorDiv){
    var range;
    return range = getSelectionWithFlush(editorDiv) , !range?-1:range.start;
  }
  ;
  $wnd['webdriverEditorGetEndSelection'] = function(editorDiv){
    var range;
    return range = getSelectionWithFlush(editorDiv) , !range?-1:range.end;
  }
  ;
  $wnd['webdriverEditorSetSelection'] = function(editorDiv, start, end){
    var editor;
    editor = !editorDiv?null:dynamicCast(editorDiv['__editor'] || null, 205);
    $setSelectionRange(editor.getSelectionHelper(), new FocusedRange_0(start, end));
  }
  ;
  $wnd['webdriverEditorGetEndSelection'] = function(editorDiv){
    var range;
    return range = getSelectionWithFlush(editorDiv) , !range?-1:range.end;
  }
  ;
  $wnd['webdriverEditorGetDocDiv'] = function(editorDiv){
    var editor;
    return editor = !editorDiv?null:dynamicCast(editorDiv['__editor'] || null, 205) , editor.getDocumentHtmlElement();
  }
  ;
  $wnd['webdriverEditorGetLocalDiffAnnotations'] = function(editorDiv){
    return webdriverEditorGetLocalDiffAnnotations(editorDiv);
  }
  ;
  $wnd['webdriverEditorGetLocalContent'] = function(editorDiv){
    return webdriverEditorGetLocalContent(editorDiv);
  }
  ;
}

function getSelectionWithFlush(editorDiv){
  var editor, selection;
  editor = !editorDiv?null:dynamicCast(editorDiv['__editor'] || null, 205);
  if (editor) {
    editor != null && editor.castableTypeMap$ && !!editor.castableTypeMap$[206] && $flushSynchronous(dynamicCast(editor, 206));
    return selection = $getSelectionRange(editor.getSelectionHelper()) , selection?(!selection.range && (selection.range = selection.anchor < selection.focus_0?new Range_2(selection.anchor, selection.focus_0):new Range_2(selection.focus_0, selection.anchor)) , selection.range):null;
  }
  return null;
}

function webdriverEditorGetContent(editorDiv){
  var content_0, editor;
  editor = !editorDiv?null:dynamicCast(editorDiv['__editor'] || null, 205);
  if (editor) {
    editor != null && editor.castableTypeMap$ && !!editor.castableTypeMap$[206] && $flushSynchronous(dynamicCast(editor, 206));
    content_0 = innerXml1(editor.getPersistentDocument()).builder.impl.string;
    return content_0 == null?null:'_' + content_0;
  }
   else {
    return 'Error in webdriverEditorGetContent';
  }
}

function webdriverEditorGetLocalContent(editorDiv){
  var editor;
  editor = !editorDiv?null:dynamicCast(editorDiv['__editor'] || null, 205);
  if (editor) {
    editor != null && editor.castableTypeMap$ && !!editor.castableTypeMap$[206] && $flushSynchronous(dynamicCast(editor, 206));
    return innerXml1(editor.getContent().fullContentView).builder.impl.string;
  }
   else {
    return 'Error in webdriverEditorGetLocalContent';
  }
}

function webdriverEditorGetLocalDiffAnnotations(editorDiv){
  var annotations, ans, editor, interval, interval$iterator, isDeletion, isInsertion, j, keys, symbol;
  editor = !editorDiv?null:dynamicCast(editorDiv['__editor'] || null, 205);
  if (!editor) {
    return 'Error in webdriverEditorGetContent';
  }
  editor != null && editor.castableTypeMap$ && !!editor.castableTypeMap$[206] && $flushSynchronous(dynamicCast(editor, 206));
  ans = new StringBuilder_2('');
  keys = newStringSet(initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, [($clinit_763() , DIFF_INSERT_KEY), DIFF_DELETE_KEY]));
  annotations = editor.getContent().localAnnotations;
  $annotationIntervals_1(annotations, 0, annotations.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1, keys);
  for (interval$iterator = $iterator_15($annotationIntervals_1(annotations, 0, annotations.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1, keys)); interval$iterator.first || interval$iterator.entries.heap.size != 0;) {
    interval = $next_23(interval$iterator);
    isInsertion = interval.annotations.getExisting(DIFF_INSERT_KEY) != null;
    isDeletion = interval.annotations.getExisting(DIFF_DELETE_KEY) != null;
    isInsertion && isDeletion?(symbol = 42):isInsertion?(symbol = 43):isDeletion?(symbol = 45):(symbol = 46);
    for (j = 0; j < interval.end - interval.start; ++j) {
      ans.impl.string += String.fromCharCode(symbol);
    }
  }
  return ans.impl.string;
}

function webdriverEditorSetContent(editorDiv, content_0){
  var editor;
  editor = !editorDiv?null:dynamicCast(editorDiv['__editor'] || null, 205);
  if (editor) {
    checkNotNull_1(documentSchema_0, 'documentSchema is not set');
    editor.setContent($asOperation($parse(($clinit_1364() , content_0))), documentSchema_0);
  }
}

var documentSchema_0 = null;
function $cancel_1(this$static, command){
  var info;
  info = dynamicCast($remove_6(this$static.taskInfos.backend, command), 207);
  if (info) {
    $remove_21(this$static.jobs, info.priority, command);
    $removeDelayedJob(this$static.delayedJobs, info.id_0);
    this$static.taskInfos.backend.size == 0 && (this$static.nextSliceRunTime = 1.7976931348623157E308 , $cancel_0(this$static.timer.timer));
  }
}

function $getNextRunTime(this$static){
  return this$static.jobs.jobCount == 0?$getNextDueDelayedJobTime(this$static.delayedJobs):0;
}

function $maybeScheduleSlice(this$static){
  if (this$static.nextSliceRunTime > 0) {
    $schedule(this$static.timer.timer, 1);
    this$static.nextSliceRunTime = 0;
  }
}

function $maybeScheduleSlice_0(this$static, when){
  if (this$static.nextSliceRunTime > when) {
    $schedule_4(this$static.timer, when);
    this$static.nextSliceRunTime = when;
  }
}

function $schedule_2(this$static, priority, task){
  checkArgument_0(priority != ($clinit_1013() , INTERNAL_SUPPRESS), "Don't use internal level");
  $scheduleJob(this$static, priority, task);
}

function $schedule_3(this$static, priority, process){
  checkArgument_0(priority != ($clinit_1013() , INTERNAL_SUPPRESS), "Don't use internal level");
  $scheduleJob(this$static, priority, process);
}

function $scheduleDelayed(this$static, priority, task, minimumTime){
  checkArgument_0(minimumTime >= 0, 'Minimum time must be at least zero');
  checkArgument_0(priority != ($clinit_1013() , INTERNAL_SUPPRESS), "Don't use internal level");
  minimumTime == 0 && (checkArgument_0(priority != INTERNAL_SUPPRESS, "Don't use internal level") , $scheduleJob(this$static, priority, task));
  $scheduleDelayedJob(this$static, priority, task, minimumTime, -1);
}

--></script>
<script><!--
function $scheduleDelayedJob(this$static, priority, job, minimumTime, interval){
  var info, now, startTime, info_0;
  info = dynamicCast($get_2(this$static.taskInfos.backend, job), 207);
  !!info && $cancel_1(this$static, job);
  now = (new Date).getTime();
  startTime = now + minimumTime;
  info = (info_0 = new TaskInfo_1(priority, startTime, interval, job) , $put_2(this$static.taskInfos, job, info_0) , info_0);
  $addDelayedJob(this$static.delayedJobs, info);
  $maybeScheduleSlice_0(this$static, startTime);
}

function $scheduleJob(this$static, priority, job){
  var info, info_0;
  info = dynamicCast($get_2(this$static.taskInfos.backend, job), 207);
  if (info) {
    if (priority == info.priority) {
      return;
    }
    $cancel_1(this$static, job);
  }
  info_0 = new TaskInfo_0(priority, job);
  $put_2(this$static.taskInfos, job, info_0);
  $add_16(this$static.jobs, priority, job);
  $maybeScheduleSlice(this$static);
}

function $scheduleRepeating(this$static, priority, process, minimumTime, interval){
  checkArgument_0(minimumTime >= 0, 'Minimum time must be at least zero');
  checkArgument_0(interval >= 0, 'Interval must be at least zero');
  checkArgument_0(priority != ($clinit_1013() , INTERNAL_SUPPRESS), "Don't use internal level");
  interval == 0 && minimumTime == 0 && (checkArgument_0(priority != INTERNAL_SUPPRESS, "Don't use internal level") , $scheduleJob(this$static, priority, process));
  $scheduleDelayedJob(this$static, priority, process, minimumTime, interval);
}

function $triggerOnJobExecuted(this$static){
  var l$iterator;
  for (l$iterator = $iterator_17(this$static.listeners); l$iterator.hasNext();) {
    throwClassCastExceptionUnlessNull(l$iterator.next_0());
    null.nullMethod();
  }
}

function $workAll(this$static, priority, endTime){
  var moreTime, moreWork;
  if (dynamicCast(this$static.jobs.priorities.backend.get(valueOf_0(priority.ordinal)), 211).size_0() != 0) {
    do {
      moreWork = $workUnit(this$static, priority);
      moreTime = (new Date).getTime() < endTime;
    }
     while (moreWork && moreTime);
    return moreTime;
  }
  return true;
}

function $workSlice(this$static){
  var delayedJob, end, info, now, p, p$array, p$index, p$max;
  now = (new Date).getTime();
  $clinit_1013();
  while ($workUnit(this$static, CRITICAL)) {
  }
  while (delayedJob = $getDueDelayedJob(this$static.delayedJobs, now)) {
    info = dynamicCast($get_2(this$static.taskInfos.backend, delayedJob), 207);
    $add_16(this$static.jobs, info.priority, delayedJob);
  }
  end = now + 100;
  for (p$array = $VALUES_36 , p$index = 0 , p$max = p$array.length; p$index < p$max; ++p$index) {
    p = p$array[p$index];
    if (!$workAll(this$static, p, end)) {
      return;
    }
  }
}

function $workUnit(this$static, priority){
  var isFinished, job, start, task;
  $removeFirst_0(this$static.jobs, priority);
  job = this$static.jobs.returnJob;
  if (!job) {
    return false;
  }
  start = (new Date).getTime();
  if (job != null && job.castableTypeMap$ && !!job.castableTypeMap$[208]) {
    isFinished = !dynamicCast(this$static.jobs.returnJob, 208).execute_1();
    if (isFinished) {
      $cancel_1(this$static, job);
    }
     else {
      task = dynamicCast($get_2(this$static.taskInfos.backend, job), 207);
      !!task && $containsKey_0(this$static.taskInfos.backend, job) && ($calculateNextExecuteTime(task, start)?$addDelayedJob(this$static.delayedJobs, task):$containsKey_5(this$static.delayedJobs.delayedJobs, task.id_0) || $add_16(this$static.jobs, priority, job));
    }
  }
   else {
    task = dynamicCast(this$static.jobs.returnJob, 209);
    $cancel_1(this$static, job);
    task.execute();
  }
  ~~Math.max(Math.min((new Date).getTime() - start, 2147483647), -2147483648);
  $triggerOnJobExecuted(this$static);
  return this$static.taskInfos.backend.size != 0;
}

function BrowserBackedScheduler_0(){
  this.runner = new BrowserBackedScheduler$1_0(this);
  this.taskInfos = ($clinit_1445() , $clinit_1445() , new CollectionUtils$IdentityHashMapAdapter_0);
  this.delayedJobs = new DelayedJobRegistry_0;
  this.listeners = ($clinit_1456() , new CopyOnWriteSet_0(LIST_SET));
  this.timer = new GwtSimpleTimer_0(this.runner);
  this.jobs = new JobRegistry_0;
}

function BrowserBackedScheduler(){
}

_ = BrowserBackedScheduler_0.prototype = BrowserBackedScheduler.prototype = new Object_0;
_.getClass$ = function getClass_660(){
  return Lorg_waveprotocol_wave_client_scheduler_BrowserBackedScheduler_2_classLit;
}
;
_.toString$ = function toString_50(){
  var b;
  return 'Scheduler[ids:' + (b = new StringBuilder_0 , $each(this.taskInfos, new BrowserBackedScheduler$2_0(b)) , b.impl.string) + ', jobs:' + $toString_12(this.jobs) + ', delayed: ' + $toString_11(this.delayedJobs) + ']';
}
;
_.castableTypeMap$ = {};
_.jobs = null;
_.nextSliceRunTime = 1.7976931348623157E308;
_.timer = null;
function $run_1(this$static){
  var next;
  this$static.this$0.nextSliceRunTime = 1.7976931348623157E308;
  $workSlice(this$static.this$0);
  next = $getNextRunTime(this$static.this$0);
  next == 0?$maybeScheduleSlice(this$static.this$0):next > 0 && $maybeScheduleSlice_0(this$static.this$0, next);
}

function BrowserBackedScheduler$1_0(this$0){
  this.this$0 = this$0;
}

function BrowserBackedScheduler$1(){
}

_ = BrowserBackedScheduler$1_0.prototype = BrowserBackedScheduler$1.prototype = new Object_0;
_.getClass$ = function getClass_661(){
  return Lorg_waveprotocol_wave_client_scheduler_BrowserBackedScheduler$1_2_classLit;
}
;
_.run = function run_4(){
  $run_1(this);
}
;
_.castableTypeMap$ = {174:1};
_.this$0 = null;
function $apply_8(this$static, key, item){
  $append_8(this$static.val$b, '{ task: ' + item);
  $append_8(this$static.val$b, '; ');
  $append_8(this$static.val$b, 'job: ' + key + ' } ');
}

function BrowserBackedScheduler$2_0(val$b){
  this.val$b = val$b;
}

function BrowserBackedScheduler$2(){
}

_ = BrowserBackedScheduler$2_0.prototype = BrowserBackedScheduler$2.prototype = new Object_0;
_.apply_4 = function apply_27(key, item){
  $apply_8(this, dynamicCast(key, 210), dynamicCast(item, 207));
}
;
_.getClass$ = function getClass_662(){
  return Lorg_waveprotocol_wave_client_scheduler_BrowserBackedScheduler$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$b = null;
function $addCommand(command){
  !instance_6 && (instance_6 = new BrowserBackedScheduler_0 , setDefaultTimerService() , undefined);
  $schedule_5(high_0, new CommandQueue$1$1_0(command));
}

function CommandQueue$1$1_0(val$command){
  this.val$command = val$command;
}

function CommandQueue$1$1(){
}

_ = CommandQueue$1$1_0.prototype = CommandQueue$1$1.prototype = new Object_0;
_.execute = function execute_34(){
  this.val$command.execute();
}
;
_.getClass$ = function getClass_663(){
  return Lorg_waveprotocol_wave_client_scheduler_CommandQueue$1$1_2_classLit;
}
;
_.castableTypeMap$ = {209:1, 210:1};
_.val$command = null;
function $addDelayedJob(this$static, info){
  $put_5(this$static.delayedJobs, info.id_0, info);
  $addDelayedTime(this$static, info);
}

function $addDelayedTime(this$static, info){
  while (this$static.delayedJobIds.backend.containsKey(new Double_0(info.nextExecuteTime))) {
    info.nextExecuteTime += Math.random() * 0.1;
  }
  $offer(this$static.jobTimes.queue, new Double_0(info.nextExecuteTime));
  $put_4(this$static.delayedJobIds, info.nextExecuteTime, info.id_0);
}

function $getDueDelayedJob(this$static, now){
  var id, info, job, time;
  while (this$static.jobTimes.queue.heap.size > 0 && dynamicCast($peek(this$static.jobTimes.queue), 137).value_0 <= now + 0.99) {
    time = dynamicCast($poll(this$static.jobTimes.queue), 137).value_0;
    if (!this$static.delayedJobIds.backend.containsKey(new Double_0(time))) {
      continue;
    }
    id = dynamicCast(this$static.delayedJobIds.backend.get(new Double_0(time)), 1);
    info = dynamicCast($get_12(this$static.delayedJobs, id), 207);
    job = info.job;
    $removeDelayedJob(this$static, id);
    return job;
  }
  return null;
}

function $getNextDueDelayedJobTime(this$static){
  return this$static.jobTimes.queue.heap.size > 0?dynamicCast($peek(this$static.jobTimes.queue), 137).value_0:-1;
}

function $removeDelayedJob(this$static, id){
  if ($containsKey_5(this$static.delayedJobs, id)) {
    this$static.delayedJobIds.backend.remove_2(new Double_0(dynamicCast($get_12(this$static.delayedJobs, id), 207).nextExecuteTime));
    $remove_25(this$static.delayedJobs, id);
  }
}

function $toString_11(this$static){
  return 'DJR[jobTimes:' + this$static.jobTimes + ',delayedJobIds:' + this$static.delayedJobIds + ',delayedJobs:' + this$static.delayedJobs + ']';
}

function DelayedJobRegistry_0(){
  this.jobTimes = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$NumberPriorityQueueAdapter_0(new PriorityQueue_0));
  this.delayedJobIds = new CollectionUtils$NumberMapAdapter_0(new HashMap_0);
  this.delayedJobs = new CollectionUtils$StringMapAdapter_0(new HashMap_0);
}

function DelayedJobRegistry(){
}

_ = DelayedJobRegistry_0.prototype = DelayedJobRegistry.prototype = new Object_0;
_.getClass$ = function getClass_664(){
  return Lorg_waveprotocol_wave_client_scheduler_DelayedJobRegistry_2_classLit;
}
;
_.toString$ = function toString_51(){
  return 'DJR[jobTimes:' + this.jobTimes + ',delayedJobIds:' + this.delayedJobIds + ',delayedJobs:' + this.delayedJobs + ']';
}
;
_.castableTypeMap$ = {};
function FinalTaskRunnerImpl$1_0(this$0){
  this.this$0 = this$0;
}

function FinalTaskRunnerImpl$1(){
}

_ = FinalTaskRunnerImpl$1_0.prototype = FinalTaskRunnerImpl$1.prototype = new Object_0;
_.execute = function execute_35(){
  var task;
  this.this$0.begin();
  this.this$0.isExecuting = true;
  try {
    while (this.this$0.tasks.backend.size != 0) {
      task = dynamicCast($someElement(this.this$0.tasks), 209);
      $remove_23(this.this$0.tasks, task);
      task.execute();
    }
  }
   finally {
    this.this$0.isExecuting = false;
    this.this$0.end_0();
  }
}
;
_.getClass$ = function getClass_665(){
  return Lorg_waveprotocol_wave_client_scheduler_FinalTaskRunnerImpl$1_2_classLit;
}
;
_.castableTypeMap$ = {28:1};
_.this$0 = null;
function $schedule_4(this$static, when){
  var interval;
  interval = ~~Math.max(Math.min(when - (new Date).getTime(), 2147483647), -2147483648);
  $schedule(this$static.timer, interval >= 1?interval:1);
}

function GwtSimpleTimer_0(task){
  this.timer = new GwtSimpleTimer$2_0(this);
  this.task = task;
}

function GwtSimpleTimer(){
}

_ = GwtSimpleTimer_0.prototype = GwtSimpleTimer.prototype = new Object_0;
_.getClass$ = function getClass_666(){
  return Lorg_waveprotocol_wave_client_scheduler_GwtSimpleTimer_2_classLit;
}
;
_.castableTypeMap$ = {};
_.task = null;
function GwtSimpleTimer$2_0(this$0){
  $clinit_2();
  this.this$0 = this$0;
}

function GwtSimpleTimer$2(){
}

_ = GwtSimpleTimer$2_0.prototype = GwtSimpleTimer$2.prototype = new Timer;
_.getClass$ = function getClass_667(){
  return Lorg_waveprotocol_wave_client_scheduler_GwtSimpleTimer$2_2_classLit;
}
;
_.run = function run_5(){
  $run_1(this.this$0.task);
}
;
_.castableTypeMap$ = {34:1};
_.this$0 = null;
function $add_16(this$static, priority, job){
  var queue;
  queue = dynamicCast(this$static.priorities.backend.get(valueOf_0(priority.ordinal)), 211);
  if (queue.remove_1(job)) {
    queue.add_0(job);
    return;
  }
   else {
    queue.add_0(job);
    ++this$static.jobCount;
  }
}

function $remove_21(this$static, priority, job){
  dynamicCast(this$static.priorities.backend.get(valueOf_0(priority.ordinal)), 211).remove_1(job) && --this$static.jobCount;
}

function $removeFirst_0(this$static, priority){
  var queue;
  queue = dynamicCast(this$static.priorities.backend.get(valueOf_0(priority.ordinal)), 211);
  if (queue.isEmpty()) {
    this$static.returnJob = null;
  }
   else {
    this$static.returnJob = dynamicCast(queue.poll(), 210);
    --this$static.jobCount;
  }
}

function $toString_12(this$static){
  var p, p$array, p$index, p$max, result;
  result = new StringBuilder_0;
  for (p$array = ($clinit_1013() , $clinit_1013() , $VALUES_36) , p$index = 0 , p$max = p$array.length; p$index < p$max; ++p$index) {
    p = p$array[p$index];
    result.impl.string += ' { priority: ' + p + '; ';
    $append_8(result, ' jobs: ' + this$static.priorities.backend.get(valueOf_0(p.ordinal)) + '; } ');
  }
  return result.impl.string;
}

function JobRegistry_0(){
  var p, p$array, p$index, p$max;
  this.priorities = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$IntMapAdapter_0(new HashMap_0));
  for (p$array = ($clinit_1013() , $clinit_1013() , $VALUES_36) , p$index = 0 , p$max = p$array.length; p$index < p$max; ++p$index) {
    p = p$array[p$index];
    $put_3(this.priorities, p.ordinal, new LinkedList_0);
  }
}

function JobRegistry(){
}

_ = JobRegistry_0.prototype = JobRegistry.prototype = new Object_0;
_.getClass$ = function getClass_668(){
  return Lorg_waveprotocol_wave_client_scheduler_JobRegistry_2_classLit;
}
;
_.toString$ = function toString_52(){
  return $toString_12(this);
}
;
_.castableTypeMap$ = {};
_.jobCount = 0;
_.returnJob = null;
function $clinit_1010(){
  $clinit_1010 = nullMethod;
  scheduler_0 = (!instance_6 && (instance_6 = new BrowserBackedScheduler_0 , setDefaultTimerService() , undefined) , instance_6);
}

var scheduler_0;
function $clinit_1013(){
  $clinit_1013 = nullMethod;
  CRITICAL = new Scheduler$Priority_0('CRITICAL', 0);
  HIGH = new Scheduler$Priority_0('HIGH', 1);
  MEDIUM = new Scheduler$Priority_0('MEDIUM', 2);
  LOW = new Scheduler$Priority_0('LOW', 3);
  INTERNAL_SUPPRESS = new Scheduler$Priority_0('INTERNAL_SUPPRESS', 4);
  $VALUES_36 = initValues(_3Lorg_waveprotocol_wave_client_scheduler_Scheduler$Priority_2_classLit, {58:1, 138:1}, 99, [CRITICAL, HIGH, MEDIUM, LOW, INTERNAL_SUPPRESS]);
}

function Scheduler$Priority_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_37(){
  $clinit_1013();
  return $VALUES_36;
}

function Scheduler$Priority(){
}

_ = Scheduler$Priority_0.prototype = Scheduler$Priority.prototype = new Enum;
_.getClass$ = function getClass_669(){
  return Lorg_waveprotocol_wave_client_scheduler_Scheduler$Priority_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 99:1};
var $VALUES_36, CRITICAL, HIGH, INTERNAL_SUPPRESS, LOW, MEDIUM;
function setDefaultTimerService(){
  new SchedulerTimerService_1(instance_6, ($clinit_1013() , LOW));
  high_0 = new SchedulerTimerService_1(instance_6, HIGH);
  medium = new SchedulerTimerService_1(instance_6, MEDIUM);
}

var high_0 = null, instance_6 = null, medium = null;
function $schedule_5(this$static, task){
  $schedule_2(this$static.scheduler, this$static.priority, task);
}

function $schedule_6(this$static, process){
  $schedule_3(this$static.scheduler, this$static.priority, process);
}

function $scheduleDelayed_0(this$static, task, minimumTime){
  $scheduleDelayed(this$static.scheduler, this$static.priority, task, minimumTime);
}

function $scheduleDelayed_1(this$static, process){
  $scheduleRepeating(this$static.scheduler, this$static.priority, process, 800, 0);
}

function SchedulerTimerService_0(scheduler){
  SchedulerTimerService_1.call(this, scheduler, ($clinit_1013() , LOW));
}

function SchedulerTimerService_1(scheduler, priority){
  (new Date).getTime();
  this.scheduler = scheduler;
  this.priority = priority;
}

function SchedulerTimerService(){
}

_ = SchedulerTimerService_1.prototype = SchedulerTimerService_0.prototype = SchedulerTimerService.prototype = new Object_0;
_.getClass$ = function getClass_670(){
  return Lorg_waveprotocol_wave_client_scheduler_SchedulerTimerService_2_classLit;
}
;
_.castableTypeMap$ = {};
_.priority = null;
_.scheduler = null;
function $calculateNextExecuteTime(this$static, now){
  if (this$static.interval > 0) {
    this$static.nextExecuteTime = Math.floor((now - this$static.startTime) / this$static.interval + 1) * this$static.interval + this$static.startTime;
    return true;
  }
  return false;
}

function TaskInfo_0(p, job){
  this.id_0 = '' + ++nextId;
  this.priority = p;
  this.startTime = 0;
  this.interval = 0;
  this.nextExecuteTime = 0;
  this.job = job;
}

function TaskInfo_1(p, startTime, interval, job){
  this.id_0 = '' + ++nextId;
  this.priority = p;
  this.startTime = startTime;
  this.interval = interval;
  this.nextExecuteTime = startTime;
  this.job = job;
}

function TaskInfo(){
}

_ = TaskInfo_1.prototype = TaskInfo_0.prototype = TaskInfo.prototype = new Object_0;
_.getClass$ = function getClass_671(){
  return Lorg_waveprotocol_wave_client_scheduler_TaskInfo_2_classLit;
}
;
_.toString$ = function toString_53(){
  return 'TaskInfo { id: ' + this.id_0 + '; priority: ' + this.priority + '; startTime: ' + this.startTime + '; interval: ' + this.interval + '; nextExecuteTime: ' + this.nextExecuteTime + ' }';
}
;
_.castableTypeMap$ = {207:1};
_.interval = 0;
_.job = null;
_.nextExecuteTime = 0;
_.priority = null;
_.startTime = 0;
var nextId = 0;
function $clinit_1022(){
  $clinit_1022 = nullMethod;
  NORMAL_1 = new ButtonDisplay$ButtonState_0('NORMAL', 0);
  HOVER = new ButtonDisplay$ButtonState_0('HOVER', 1);
  DOWN_0 = new ButtonDisplay$ButtonState_0('DOWN', 2);
  DISABLED = new ButtonDisplay$ButtonState_0('DISABLED', 3);
  $VALUES_37 = initValues(_3Lorg_waveprotocol_wave_client_widget_button_ButtonDisplay$ButtonState_2_classLit, {58:1, 138:1}, 100, [NORMAL_1, HOVER, DOWN_0, DISABLED]);
}

function ButtonDisplay$ButtonState_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_38(){
  $clinit_1022();
  return $VALUES_37;
}

function ButtonDisplay$ButtonState(){
}

_ = ButtonDisplay$ButtonState_0.prototype = ButtonDisplay$ButtonState.prototype = new Enum;
_.getClass$ = function getClass_672(){
  return Lorg_waveprotocol_wave_client_widget_button_ButtonDisplay$ButtonState_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 100:1};
var $VALUES_37, DISABLED, DOWN_0, HOVER, NORMAL_1;
function createIconClickButton(style, listener){
  var logic, template;
  logic = new ClickButton_0;
  logic.clickListener = listener;
  template = new IconButtonTemplate_0(style, 'Suggestion');
  template.mouseListener = logic.mouseListener;
  logic.buttonDisplay = template;
  $updateState(logic);
  return new ClickButtonWidget_0(template);
}

function createIconToggleButton(style, listener){
  var logic, template;
  logic = new ToggleButton_0;
  logic.toggleListener = listener;
  template = new IconButtonTemplate_0(style, 'Options');
  template.mouseListener = logic.mouseListener;
  logic.display_0 = template;
  $updateState_0(logic);
  return new ToggleButtonWidget_0(logic.controller, template);
}

function $setState_0(this$static, state){
  !!this$static.buttonDisplay && this$static.buttonDisplay.setState(state);
}

function $updateState(this$static){
  if (this$static.isDisabled) {
    $setState_0(this$static, ($clinit_1022() , DISABLED));
    return;
  }
  this$static.isMouseOver?$setState_0(this$static, this$static.isMouseDown?($clinit_1022() , DOWN_0):($clinit_1022() , HOVER)):$setState_0(this$static, ($clinit_1022() , NORMAL_1));
}

function ClickButton_0(){
  this.controller = new ClickButton$1_0(this);
  this.mouseListener = new ClickButton$2_0(this);
}

function ClickButton(){
}

_ = ClickButton_0.prototype = ClickButton.prototype = new Object_0;
_.getClass$ = function getClass_673(){
  return Lorg_waveprotocol_wave_client_widget_button_ClickButton_2_classLit;
}
;
_.castableTypeMap$ = {158:1};
_.buttonDisplay = null;
_.clickListener = null;
_.isDisabled = false;
_.isMouseDown = false;
_.isMouseOver = false;
function $setDisabled(this$static, isDisabled){
  if (this$static.this$0.isDisabled != isDisabled) {
    this$static.this$0.isDisabled = isDisabled;
    $updateState(this$static.this$0);
  }
}

function ClickButton$1_0(this$0){
  this.this$0 = this$0;
}

function ClickButton$1(){
}

_ = ClickButton$1_0.prototype = ClickButton$1.prototype = new Object_0;
_.getClass$ = function getClass_674(){
  return Lorg_waveprotocol_wave_client_widget_button_ClickButton$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $onClick_1(this$static){
  if (this$static.this$0.isDisabled) {
    return;
  }
  !!this$static.this$0.clickListener && $onClick(this$static.this$0.clickListener);
}

function $onMouseDown(this$static){
  this$static.this$0.isMouseDown = true;
  $updateState(this$static.this$0);
}

function $onMouseEnter(this$static){
  this$static.this$0.isMouseOver = true;
  $updateState(this$static.this$0);
}

function $onMouseLeave(this$static){
  this$static.this$0.isMouseOver = false;
  this$static.this$0.isMouseDown = false;
  $updateState(this$static.this$0);
}

function $onMouseUp(this$static){
  this$static.this$0.isMouseDown = false;
  $updateState(this$static.this$0);
}

function ClickButton$2_0(this$0){
  this.this$0 = this$0;
}

function ClickButton$2(){
}

_ = ClickButton$2_0.prototype = ClickButton$2.prototype = new Object_0;
_.getClass$ = function getClass_675(){
  return Lorg_waveprotocol_wave_client_widget_button_ClickButton$2_2_classLit;
}
;
_.onClick_0 = function onClick_17(){
  $onClick_1(this);
}
;
_.onMouseDown = function onMouseDown(){
  this.this$0.isMouseDown = true;
  $updateState(this.this$0);
}
;
_.onMouseEnter = function onMouseEnter(){
  this.this$0.isMouseOver = true;
  $updateState(this.this$0);
}
;
_.onMouseLeave = function onMouseLeave(){
  $onMouseLeave(this);
}
;
_.onMouseUp = function onMouseUp(){
  this.this$0.isMouseDown = false;
  $updateState(this.this$0);
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function ClickButtonWidget_0(w){
  $initWidget(this, w);
}

function ClickButtonWidget(){
}

_ = ClickButtonWidget_0.prototype = ClickButtonWidget.prototype = new Composite;
_.getClass$ = function getClass_676(){
  return Lorg_waveprotocol_wave_client_widget_button_ClickButtonWidget_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
function $setStyle(this$static, styleName){
  var e, e$iterator;
  if (!(styleName == null && this$static.currentStyle == null || styleName != null && $equals_3(styleName, this$static.currentStyle))) {
    if (this$static.currentStyle != null && $trim(this$static.currentStyle).length != 0) {
      for (e$iterator = new AbstractList$IteratorImpl_0(this$static.elements); e$iterator.i < e$iterator.this$0_0.size_0();) {
        e = dynamicCastJso($next_6(e$iterator));
        $removeClassName(e, this$static.currentStyle);
      }
    }
    if (styleName != null) {
      for (e$iterator = new AbstractList$IteratorImpl_0(this$static.elements); e$iterator.i < e$iterator.this$0_0.size_0();) {
        e = dynamicCastJso($next_6(e$iterator));
        $addClassName(e, styleName);
      }
    }
    this$static.currentStyle = styleName;
  }
}

function StyleAxis_0(elements){
  var e, e$index, e$max;
  this.elements = new ArrayList_0;
  for (e$index = 0 , e$max = elements.length; e$index < e$max; ++e$index) {
    e = elements[e$index];
    !!e && $add_9(this.elements, e);
  }
}

function StyleAxis(){
}

_ = StyleAxis_0.prototype = StyleAxis.prototype = new Object_0;
_.getClass$ = function getClass_677(){
  return Lorg_waveprotocol_wave_client_widget_button_StyleAxis_2_classLit;
}
;
_.castableTypeMap$ = {};
_.currentStyle = null;
function $setState_1(this$static, state){
  !!this$static.display_0 && $setState_2(this$static.display_0, state);
}

function $updateState_0(this$static){
  if (this$static.isOn) {
    $setState_1(this$static, ($clinit_1022() , DOWN_0));
    return;
  }
  this$static.isMouseOver?$setState_1(this$static, this$static.isMouseDown?($clinit_1022() , DOWN_0):($clinit_1022() , HOVER)):$setState_1(this$static, ($clinit_1022() , NORMAL_1));
}

function ToggleButton_0(){
  this.mouseListener = new ToggleButton$1_0(this);
  this.controller = new ToggleButton$2_0(this);
}

function ToggleButton(){
}

_ = ToggleButton_0.prototype = ToggleButton.prototype = new Object_0;
_.getClass$ = function getClass_678(){
  return Lorg_waveprotocol_wave_client_widget_button_ToggleButton_2_classLit;
}
;
_.castableTypeMap$ = {};
_.display_0 = null;
_.isMouseDown = false;
_.isMouseOver = false;
_.isOn = false;
_.toggleListener = null;
function ToggleButton$1_0(this$0){
  this.this$0 = this$0;
}

function ToggleButton$1(){
}

_ = ToggleButton$1_0.prototype = ToggleButton$1.prototype = new Object_0;
_.getClass$ = function getClass_679(){
  return Lorg_waveprotocol_wave_client_widget_button_ToggleButton$1_2_classLit;
}
;
_.onClick_0 = function onClick_18(){
  this.this$0.isOn = !this.this$0.isOn;
  this.this$0.isOn?$onOn(this.this$0.toggleListener):$onOff(this.this$0.toggleListener);
  $updateState_0(this.this$0);
}
;
_.onMouseDown = function onMouseDown_0(){
  currentEvent.stopPropagation();
  currentEvent.preventDefault();
  this.this$0.isMouseDown = true;
  $updateState_0(this.this$0);
}
;
_.onMouseEnter = function onMouseEnter_0(){
  this.this$0.isMouseOver = true;
  $updateState_0(this.this$0);
}
;
_.onMouseLeave = function onMouseLeave_0(){
  this.this$0.isMouseDown = false;
  this.this$0.isMouseOver = false;
  $updateState_0(this.this$0);
}
;
_.onMouseUp = function onMouseUp_0(){
  this.this$0.isMouseDown = false;
  $updateState_0(this.this$0);
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $setOn(this$static, isOn){
  this$static.this$0.isOn = isOn;
  $updateState_0(this$static.this$0);
}

function ToggleButton$2_0(this$0){
  this.this$0 = this$0;
}

function ToggleButton$2(){
}

_ = ToggleButton$2_0.prototype = ToggleButton$2.prototype = new Object_0;
_.getClass$ = function getClass_680(){
  return Lorg_waveprotocol_wave_client_widget_button_ToggleButton$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function ToggleButtonWidget_0(controller, w){
  $initWidget(this, w);
  this.controller = controller;
}

function ToggleButtonWidget(){
}

_ = ToggleButtonWidget_0.prototype = ToggleButtonWidget.prototype = new Composite;
_.getClass$ = function getClass_681(){
  return Lorg_waveprotocol_wave_client_widget_button_ToggleButtonWidget_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
_.controller = null;
--></script>
<script><!--
function $clinit_1040(){
  $clinit_1040 = nullMethod;
  $clinit_1043();
  $clinit_1042();
  $clinit_81();
  $push_0(toInject, ($clinit_176() , '.GMQ4-KSBPJ{height:' + panelMinimize.height_0 + 'px;width:' + panelMinimize.width_0 + 'px;overflow:hidden;background:url("' + panelMinimize.url + '") -' + panelMinimize.left_0 + 'px -' + panelMinimize.top_0 + 'px  no-repeat;}.GMQ4-KSBPJ.GMQ4-KSBIJ{height:' + panelMinimizeDown.height_0 + 'px;width:' + panelMinimizeDown.width_0 + 'px;overflow:hidden;background:url("' + panelMinimizeDown.url + '") -' + panelMinimizeDown.left_0 + 'px -' + panelMinimizeDown.top_0 + 'px  no-repeat;}.GMQ4-KSBPJ.GMQ4-KSBJJ{height:' + panelMinimizeHover.height_0 + 'px;width:' + panelMinimizeHover.width_0 + 'px;overflow:hidden;background:url("' + panelMinimizeHover.url + '") -' + panelMinimizeHover.left_0 + 'px -' + panelMinimizeHover.top_0 + 'px  no-repeat;}.GMQ4-KSBOJ{height:' + panelMaximize.height_0 + 'px;width:' + panelMaximize.width_0 + 'px;overflow:hidden;background:url("' + panelMaximize.url + '") -' + panelMaximize.left_0 + 'px -' + panelMaximize.top_0 + 'px  no-repeat;}.GMQ4-KSBOJ.GMQ4-KSBIJ{height:' + panelMaximizeDown.height_0 + 'px;width:' + panelMaximizeDown.width_0 + 'px;overflow:hidden;background:url("' + panelMaximizeDown.url + '") -' + panelMaximizeDown.left_0 + 'px -' + panelMaximizeDown.top_0 + 'px  no-repeat;}.GMQ4-KSBOJ.GMQ4-KSBJJ{height:' + panelMaximizeHover.height_0 + 'px;width:' + panelMaximizeHover.width_0 + 'px;overflow:hidden;background:url("' + panelMaximizeHover.url + '") -' + panelMaximizeHover.left_0 + 'px -' + panelMaximizeHover.top_0 + 'px  no-repeat;}.GMQ4-KSBAK{height:' + panelRestore.height_0 + 'px;width:' + panelRestore.width_0 + 'px;overflow:hidden;background:url("' + panelRestore.url + '") -' + panelRestore.left_0 + 'px -' + panelRestore.top_0 + 'px  no-repeat;}.GMQ4-KSBAK.GMQ4-KSBIJ{height:' + panelRestoreDown.height_0 + 'px;width:' + panelRestoreDown.width_0 + 'px;overflow:hidden;background:url("' + panelRestoreDown.url + '") -' + panelRestoreDown.left_0 + 'px -' + panelRestoreDown.top_0 + 'px  no-repeat;}.GMQ4-KSBAK.GMQ4-KSBJJ{height:' + panelRestoreHover.height_0 + 'px;width:' + panelRestoreHover.width_0 + 'px;overflow:hidden;background:url("' + panelRestoreHover.url + '") -' + panelRestoreHover.left_0 + 'px -' + panelRestoreHover.top_0 + 'px  no-repeat;height:' + panelRestoreHover.height_0 + 'px;width:' + panelRestoreHover.width_0 + 'px;overflow:hidden;background:url("' + panelRestoreHover.url + '") -' + panelRestoreHover.left_0 + 'px -' + panelRestoreHover.top_0 + 'px  no-repeat;}.GMQ4-KSBNJ{height:' + panelClose.height_0 + 'px;width:' + panelClose.width_0 + 'px;overflow:hidden;background:url("' + panelClose.url + '") -' + panelClose.left_0 + 'px -' + panelClose.top_0 + 'px  no-repeat;}.GMQ4-KSBNJ.GMQ4-KSBIJ{height:' + panelCloseDown.height_0 + 'px;width:' + panelCloseDown.width_0 + 'px;overflow:hidden;background:url("' + panelCloseDown.url + '") -' + panelCloseDown.left_0 + 'px -' + panelCloseDown.top_0 + 'px  no-repeat;}.GMQ4-KSBNJ.GMQ4-KSBJJ{height:' + panelCloseHover.height_0 + 'px;width:' + panelCloseHover.width_0 + 'px;overflow:hidden;background:url("' + panelCloseHover.url + '") -' + panelCloseHover.left_0 + 'px -' + panelCloseHover.top_0 + 'px  no-repeat;}.GMQ4-KSBHJ{opacity:0.35;}'));
  flush();
  $push_0(toInject, '.GMQ4-KSBFK{height:' + bluePlus.height_0 + 'px;width:' + bluePlus.width_0 + 'px;overflow:hidden;background:url("' + bluePlus.url + '") -' + bluePlus.left_0 + 'px -' + bluePlus.top_0 + 'px  no-repeat;}.GMQ4-KSBKK{height:' + folderClosed.height_0 + 'px;width:' + folderClosed.width_0 + 'px;overflow:hidden;background:url("' + folderClosed.url + '") -' + folderClosed.left_0 + 'px -' + folderClosed.top_0 + 'px  no-repeat;}.GMQ4-KSBKK.GMQ4-KSBIJ{height:' + folderOpen.height_0 + 'px;width:' + folderOpen.width_0 + 'px;overflow:hidden;background:url("' + folderOpen.url + '") -' + folderOpen.left_0 + 'px -' + folderOpen.top_0 + 'px  no-repeat;}.GMQ4-KSBEK{height:' + alertClose.height_0 + 'px;width:' + alertClose.width_0 + 'px;overflow:hidden;background:url("' + alertClose.url + '") -' + alertClose.left_0 + 'px -' + alertClose.top_0 + 'px  no-repeat;}.GMQ4-KSBEK.GMQ4-KSBIJ{height:' + alertCloseDown.height_0 + 'px;width:' + alertCloseDown.width_0 + 'px;overflow:hidden;background:url("' + alertCloseDown.url + '") -' + alertCloseDown.left_0 + 'px -' + alertCloseDown.top_0 + 'px  no-repeat;}.GMQ4-KSBEK.GMQ4-KSBJJ{height:' + alertCloseHover.height_0 + 'px;width:' + alertCloseHover.width_0 + 'px;overflow:hidden;background:url("' + alertCloseHover.url + '") -' + alertCloseHover.left_0 + 'px -' + alertCloseHover.top_0 + 'px  no-repeat;}.GMQ4-KSBOK{height:' + popupButtonImage.height_0 + 'px;width:' + popupButtonImage.width_0 + 'px;overflow:hidden;background:url("' + popupButtonImage.url + '") -' + popupButtonImage.left_0 + 'px -' + popupButtonImage.top_0 + 'px  no-repeat;}.GMQ4-KSBEL{height:' + viewSwitcherFeed.height_0 + 'px;width:' + viewSwitcherFeed.width_0 + 'px;overflow:hidden;background:url("' + viewSwitcherFeed.url + '") -' + viewSwitcherFeed.left_0 + 'px -' + viewSwitcherFeed.top_0 + 'px  no-repeat;}.GMQ4-KSBEL.GMQ4-KSBIJ{height:' + viewSwitcherFeedDown.height_0 + 'px;width:' + viewSwitcherFeedDown.width_0 + 'px;overflow:hidden;background:url("' + viewSwitcherFeedDown.url + '") -' + viewSwitcherFeedDown.left_0 + 'px -' + viewSwitcherFeedDown.top_0 + 'px  no-repeat;}.GMQ4-KSBFL{height:' + viewSwitcherSingle.height_0 + 'px;width:' + viewSwitcherSingle.width_0 + 'px;overflow:hidden;background:url("' + viewSwitcherSingle.url + '") -' + viewSwitcherSingle.left_0 + 'px -' + viewSwitcherSingle.top_0 + 'px  no-repeat;}.GMQ4-KSBFL.GMQ4-KSBIJ{height:' + viewSwitcherSingleDown.height_0 + 'px;width:' + viewSwitcherSingleDown.width_0 + 'px;overflow:hidden;background:url("' + viewSwitcherSingleDown.url + '") -' + viewSwitcherSingleDown.left_0 + 'px -' + viewSwitcherSingleDown.top_0 + 'px  no-repeat;}.GMQ4-KSBDL{height:' + viewSwitcherAvatar.height_0 + 'px;width:' + viewSwitcherAvatar.width_0 + 'px;overflow:hidden;background:url("' + viewSwitcherAvatar.url + '") -' + viewSwitcherAvatar.left_0 + 'px -' + viewSwitcherAvatar.top_0 + 'px  no-repeat;}.GMQ4-KSBDL.GMQ4-KSBIJ{height:' + viewSwitcherAvatarDown.height_0 + 'px;width:' + viewSwitcherAvatarDown.width_0 + 'px;overflow:hidden;background:url("' + viewSwitcherAvatarDown.url + '") -' + viewSwitcherAvatarDown.left_0 + 'px -' + viewSwitcherAvatarDown.top_0 + 'px  no-repeat;}.GMQ4-KSBBL{height:' + spellyDropdown.height_0 + 'px;width:' + spellyDropdown.width_0 + 'px;overflow:hidden;background:url("' + spellyDropdown.url + '") -' + spellyDropdown.left_0 + 'px -' + spellyDropdown.top_0 + 'px  no-repeat;}.GMQ4-KSBNK{height:' + nextDigestPage.height_0 + 'px;width:' + nextDigestPage.width_0 + 'px;overflow:hidden;background:url("' + nextDigestPage.url + '") -' + nextDigestPage.left_0 + 'px -' + nextDigestPage.top_0 + 'px  no-repeat;}.GMQ4-KSBNK.GMQ4-KSBIJ{height:' + nextDigestPageDown.height_0 + 'px;width:' + nextDigestPageDown.width_0 + 'px;overflow:hidden;background:url("' + nextDigestPageDown.url + '") -' + nextDigestPageDown.left_0 + 'px -' + nextDigestPageDown.top_0 + 'px  no-repeat;}.GMQ4-KSBPK{height:' + previousDigestPage.height_0 + 'px;width:' + previousDigestPage.width_0 + 'px;overflow:hidden;background:url("' + previousDigestPage.url + '") -' + previousDigestPage.left_0 + 'px -' + previousDigestPage.top_0 + 'px  no-repeat;}.GMQ4-KSBPK.GMQ4-KSBIJ{height:' + previousDigestPageDown.height_0 + 'px;width:' + previousDigestPageDown.width_0 + 'px;overflow:hidden;background:url("' + previousDigestPageDown.url + '") -' + previousDigestPageDown.left_0 + 'px -' + previousDigestPageDown.top_0 + 'px  no-repeat;}.GMQ4-KSBMK{height:' + lightbulb.height_0 + 'px;width:' + lightbulb.width_0 + 'px;overflow:hidden;background:url("' + lightbulb.url + '") -' + lightbulb.left_0 + 'px -' + lightbulb.top_0 + 'px  no-repeat;}.GMQ4-KSBBK{height:' + add_15.height_0 + 'px;width:' + add_15.width_0 + 'px;overflow:hidden;background:url("' + add_15.url + '") -' + add_15.left_0 + 'px -' + add_15.top_0 + 'px  no-repeat;}.GMQ4-KSBBK.GMQ4-KSBIJ{height:' + addDown.height_0 + 'px;width:' + addDown.width_0 + 'px;overflow:hidden;background:url("' + addDown.url + '") -' + addDown.left_0 + 'px -' + addDown.top_0 + 'px  no-repeat;}.GMQ4-KSBCK{height:' + addBig.height_0 + 'px;width:' + addBig.width_0 + 'px;overflow:hidden;background:url("' + addBig.url + '") -' + addBig.left_0 + 'px -' + addBig.top_0 + 'px  no-repeat;}.GMQ4-KSBCK.GMQ4-KSBIJ{height:' + addBigDown.height_0 + 'px;width:' + addBigDown.width_0 + 'px;overflow:hidden;background:url("' + addBigDown.url + '") -' + addBigDown.left_0 + 'px -' + addBigDown.top_0 + 'px  no-repeat;}.GMQ4-KSBDK{height:' + addSmall.height_0 + 'px;width:' + addSmall.width_0 + 'px;overflow:hidden;background:url("' + addSmall.url + '") -' + addSmall.left_0 + 'px -' + addSmall.top_0 + 'px  no-repeat;}.GMQ4-KSBDK.GMQ4-KSBIJ{height:' + addSmallDown.height_0 + 'px;width:' + addSmallDown.width_0 + 'px;overflow:hidden;background:url("' + addSmallDown.url + '") -' + addSmallDown.left_0 + 'px -' + addSmallDown.top_0 + 'px  no-repeat;}.GMQ4-KSBAL{height:' + removeTag.height_0 + 'px;width:' + removeTag.width_0 + 'px;overflow:hidden;background:url("' + removeTag.url + '") -' + removeTag.left_0 + 'px -' + removeTag.top_0 + 'px  no-repeat;}.GMQ4-KSBAL.GMQ4-KSBIJ,.GMQ4-KSBAL.GMQ4-KSBJJ{height:' + removeTagHover.height_0 + 'px;width:' + removeTagHover.width_0 + 'px;overflow:hidden;background:url("' + removeTagHover.url + '") -' + removeTagHover.left_0 + 'px -' + removeTagHover.top_0 + 'px  no-repeat;}.GMQ4-KSBCL{height:' + splitButtonDropdown.height_0 + 'px;width:' + splitButtonDropdown.width_0 + 'px;overflow:hidden;background:url("' + splitButtonDropdown.url + '") -' + splitButtonDropdown.left_0 + 'px -' + splitButtonDropdown.top_0 + 'px  no-repeat;}.GMQ4-KSBCL.GMQ4-KSBIJ{height:' + splitButtonDropdownDown.height_0 + 'px;width:' + splitButtonDropdownDown.width_0 + 'px;overflow:hidden;background:url("' + splitButtonDropdownDown.url + '") -' + splitButtonDropdownDown.left_0 + 'px -' + splitButtonDropdownDown.top_0 + 'px  no-repeat;}.GMQ4-KSBHJ{opacity:0.35;}.GMQ4-KSBHK{cursor:pointer;}.GMQ4-KSBGK{cursor:default;}');
  flush();
}

function $setState_2(this$static, state){
  var styleName;
  styleName = null;
  switch (state.ordinal) {
    case 3:
      styleName = 'GMQ4-KSBHJ';
      $setStyle(this$static.cursorStyleClassName, 'GMQ4-KSBGK');
      break;
    case 2:
      styleName = 'GMQ4-KSBIJ';
      break;
    case 1:
      styleName = 'GMQ4-KSBJJ';
      break;
    case 0:
      styleName = null;
  }
  checkNotNull_0(this$static.element_0, 'replaceDebugClass: Element must not be null');
  $setStyle(this$static.buttonStateClassName, styleName);
}

function $setStyle_0(this$static, style){
  var styleName;
  styleName = null;
  switch (style.ordinal) {
    case 4:
      styleName = 'GMQ4-KSBNJ';
      checkNotNull_0(this$static, 'uiObject cannot be null');
      checkNotNull_0(this$static.element_0, 'addDebugClass: Element must not be null');
      break;
    case 3:
      styleName = 'GMQ4-KSBOJ';
      checkNotNull_0(this$static, 'uiObject cannot be null');
      checkNotNull_0(this$static.element_0, 'addDebugClass: Element must not be null');
      break;
    case 1:
      styleName = 'GMQ4-KSBPJ';
      checkNotNull_0(this$static, 'uiObject cannot be null');
      checkNotNull_0(this$static.element_0, 'addDebugClass: Element must not be null');
      break;
    case 2:
      styleName = 'GMQ4-KSBAK';
      checkNotNull_0(this$static, 'uiObject cannot be null');
      checkNotNull_0(this$static.element_0, 'addDebugClass: Element must not be null');
      break;
    case 5:
      styleName = 'GMQ4-KSBKK';
      break;
    case 6:
      styleName = 'GMQ4-KSBOK';
      break;
    case 7:
      styleName = 'GMQ4-KSBEK';
      break;
    case 0:
      styleName = 'GMQ4-KSBFK';
      break;
    case 8:
      styleName = 'GMQ4-KSBDL';
      break;
    case 9:
      styleName = 'GMQ4-KSBEL';
      break;
    case 10:
      styleName = 'GMQ4-KSBFL';
      break;
    case 13:
      styleName = 'GMQ4-KSBBL';
      break;
    case 11:
      styleName = 'GMQ4-KSBNK';
      break;
    case 12:
      styleName = 'GMQ4-KSBPK';
      break;
    case 14:
      styleName = 'GMQ4-KSBMK';
      break;
    case 18:
      styleName = 'GMQ4-KSBAL';
      break;
    case 19:
      styleName = 'GMQ4-KSBCL';
      break;
    case 15:
      styleName = 'GMQ4-KSBBK';
      break;
    case 16:
      styleName = 'GMQ4-KSBCK';
      break;
    case 17:
      styleName = 'GMQ4-KSBDK';
  }
  $setStyle(this$static.iconStyleClassName, styleName);
}

function IconButtonTemplate_0(style, tooltip){
  var label;
  $clinit_1040();
  label = new Label_0;
  $initWidget(this, label);
  $addDomHandler(label, this, ($clinit_94() , $clinit_94() , TYPE_1));
  $addDomHandler(label, this, ($clinit_135() , $clinit_135() , TYPE_9));
  $addDomHandler(label, this, ($clinit_133() , $clinit_133() , TYPE_8));
  $addDomHandler(label, this, ($clinit_137() , $clinit_137() , TYPE_10));
  $addDomHandler(label, this, ($clinit_131() , $clinit_131() , TYPE_7));
  this.buttonStateClassName = new StyleAxis_0(initValues(_3Lcom_google_gwt_core_client_JavaScriptObject_2_classLit, {58:1, 138:1}, -1, [this.element_0]));
  this.iconStyleClassName = new StyleAxis_0(initValues(_3Lcom_google_gwt_core_client_JavaScriptObject_2_classLit, {58:1, 138:1}, -1, [this.element_0]));
  this.cursorStyleClassName = new StyleAxis_0(initValues(_3Lcom_google_gwt_core_client_JavaScriptObject_2_classLit, {58:1, 138:1}, -1, [this.element_0]));
  $setStyle(this.cursorStyleClassName, 'GMQ4-KSBHK');
  $setStyle_0(this, style);
  tooltip == null || tooltip.length == 0?(this.element_0.removeAttribute('title') , undefined):(this.element_0.setAttribute('title', tooltip) , undefined);
}

function IconButtonTemplate(){
}

_ = IconButtonTemplate_0.prototype = IconButtonTemplate.prototype = new Composite;
_.getClass$ = function getClass_682(){
  return Lorg_waveprotocol_wave_client_widget_button_icon_IconButtonTemplate_2_classLit;
}
;
_.onClick = function onClick_19(event_0){
  this.mouseListener.onClick_0();
  event_0.nativeEvent.stopPropagation();
}
;
_.onDetach = function onDetach_3(){
  this.widget.onDetach();
  !!this.mouseListener && this.mouseListener.onMouseLeave();
}
;
_.onMouseOut = function onMouseOut_0(event_0){
  this.mouseListener.onMouseLeave();
}
;
_.onMouseOver = function onMouseOver_0(event_0){
  this.mouseListener.onMouseEnter();
}
;
_.setState = function setState(state){
  $setState_2(this, state);
}
;
_.castableTypeMap$ = {8:1, 15:1, 16:1, 17:1, 18:1, 19:1, 25:1, 35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
_.buttonStateClassName = null;
_.cursorStyleClassName = null;
_.iconStyleClassName = null;
_.mouseListener = null;
function $clinit_1041(){
  $clinit_1041 = nullMethod;
  BLUE_PLUS = new IconButtonTemplate$IconButtonStyle_0('BLUE_PLUS', 0);
  PANEL_MINIMIZE = new IconButtonTemplate$IconButtonStyle_0('PANEL_MINIMIZE', 1);
  PANEL_RESTORE = new IconButtonTemplate$IconButtonStyle_0('PANEL_RESTORE', 2);
  PANEL_MAXIMIZE = new IconButtonTemplate$IconButtonStyle_0('PANEL_MAXIMIZE', 3);
  PANEL_CLOSE = new IconButtonTemplate$IconButtonStyle_0('PANEL_CLOSE', 4);
  PLUS_MINUS = new IconButtonTemplate$IconButtonStyle_0('PLUS_MINUS', 5);
  POPUP_MENU = new IconButtonTemplate$IconButtonStyle_0('POPUP_MENU', 6);
  ALERT_CLOSE = new IconButtonTemplate$IconButtonStyle_0('ALERT_CLOSE', 7);
  VIEW_SWITCHER_AVATAR = new IconButtonTemplate$IconButtonStyle_0('VIEW_SWITCHER_AVATAR', 8);
  VIEW_SWITCHER_FEED = new IconButtonTemplate$IconButtonStyle_0('VIEW_SWITCHER_FEED', 9);
  VIEW_SWITCHER_SINGLE = new IconButtonTemplate$IconButtonStyle_0('VIEW_SWITCHER_SINGLE', 10);
  NEXT_DIGEST_PAGE = new IconButtonTemplate$IconButtonStyle_0('NEXT_DIGEST_PAGE', 11);
  PREVIOUS_DIGEST_PAGE = new IconButtonTemplate$IconButtonStyle_0('PREVIOUS_DIGEST_PAGE', 12);
  SPELLY_DROPDOWN = new IconButtonTemplate$IconButtonStyle_0('SPELLY_DROPDOWN', 13);
  LIGHTBULB = new IconButtonTemplate$IconButtonStyle_0('LIGHTBULB', 14);
  ADD = new IconButtonTemplate$IconButtonStyle_0('ADD', 15);
  ADD_BIG = new IconButtonTemplate$IconButtonStyle_0('ADD_BIG', 16);
  ADD_SMALL = new IconButtonTemplate$IconButtonStyle_0('ADD_SMALL', 17);
  REMOVE_TAG = new IconButtonTemplate$IconButtonStyle_0('REMOVE_TAG', 18);
  SPLIT_BUTTON_DROPDOWN = new IconButtonTemplate$IconButtonStyle_0('SPLIT_BUTTON_DROPDOWN', 19);
  $VALUES_38 = initValues(_3Lorg_waveprotocol_wave_client_widget_button_icon_IconButtonTemplate$IconButtonStyle_2_classLit, {58:1, 138:1}, 101, [BLUE_PLUS, PANEL_MINIMIZE, PANEL_RESTORE, PANEL_MAXIMIZE, PANEL_CLOSE, PLUS_MINUS, POPUP_MENU, ALERT_CLOSE, VIEW_SWITCHER_AVATAR, VIEW_SWITCHER_FEED, VIEW_SWITCHER_SINGLE, NEXT_DIGEST_PAGE, PREVIOUS_DIGEST_PAGE, SPELLY_DROPDOWN, LIGHTBULB, ADD, ADD_BIG, ADD_SMALL, REMOVE_TAG, SPLIT_BUTTON_DROPDOWN]);
}

function IconButtonTemplate$IconButtonStyle_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_39(){
  $clinit_1041();
  return $VALUES_38;
}

function IconButtonTemplate$IconButtonStyle(){
}

_ = IconButtonTemplate$IconButtonStyle_0.prototype = IconButtonTemplate$IconButtonStyle.prototype = new Enum;
_.getClass$ = function getClass_683(){
  return Lorg_waveprotocol_wave_client_widget_button_icon_IconButtonTemplate$IconButtonStyle_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 101:1};
var $VALUES_38, ADD, ADD_BIG, ADD_SMALL, ALERT_CLOSE, BLUE_PLUS, LIGHTBULB, NEXT_DIGEST_PAGE, PANEL_CLOSE, PANEL_MAXIMIZE, PANEL_MINIMIZE, PANEL_RESTORE, PLUS_MINUS, POPUP_MENU, PREVIOUS_DIGEST_PAGE, REMOVE_TAG, SPELLY_DROPDOWN, SPLIT_BUTTON_DROPDOWN, VIEW_SWITCHER_AVATAR, VIEW_SWITCHER_FEED, VIEW_SWITCHER_SINGLE;
--></script>
<script><!--
function $clinit_1042(){
  $clinit_1042 = nullMethod;
  add_15 = new ImageResourcePrototype_0(($clinit_176() , 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAASCAYAAABB7B6eAAACcklEQVR42pWVaa4SQRDHuYE3UE/gAYzn4aOexHcC/W4gARL2fQ2EZQBZxSBr2Pewr239KwGfwwxPO/llQld1VXUtjUYjW6VS6U08Hjf6fL6u0Wi86HQ6oQbk0Esmk19wTvPSikajfpPJdHE4HKJYLIrZbCYOh4NQWtifTCasB32ci8ViYVXjiMTtdot+vy8ulwtzPp/F6XQSx+NRFchBt9tlRxTk5M54KBSSXC6XWK/XbBjR7ff7/2Y+nwur1SooZeOb8VQq9YGuJ6bTKUe82+3Edru9A/J8Ps9fJfmVwWCA2kDvGzsIBoMS5Y4jhwJuoUQulxNarZadqOlc8fv9IpvNnqhUbzU2m21Tq9U4LcvlUhU6wA6oW9jII10UnmqK7vis0ev1nLvNZiMWi8VfoODpdJqxWCzsALWCM+xBLj8DOp2OgF1aXnaAAkGAtnyOJElsVI1MJsPByc8Nh8OrgxM7wLVQPPT1cxAJIi0UCsLpdLJRfPEbwDiQn2u1Wn8cUFtt2u02OxiNRneMx2OWUbexAxjGbbEHIJefQQqptlt24PV6JRoOjgQtpgY9H7cuQpSPdD0ejwiHwwNyIOF5eG8wGLhgvV5PlXq9LhKJxO2manrVapXngHQy5OArzwL1bcFut4tGo8F5VwPPASLEV0nebDa522i2ymR8TLy7TXQgEFhhzNHDKBLq8q9AH+dgnNhSV1bI+NPdm0QdM8SzYTabBb1PnG8MISKTg9uWy2URiURYH11Dkf8kw9+JNPFK8VVdrVZPlUplT0U6IZeP/g8ApXZB8/CDWv0XGT0qRi5f8E58IgzEhDi/gI/4SLyW2/oNg1dNa8OdiAwAAAAASUVORK5CYII='), 24, 18);
  addBig = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAYCAYAAAB0kZQKAAAC8UlEQVR42rVW205aURA9f9B+Qf0E3+0P9Aeavpk++di+9TP61JeGth8A4SLeADFAMCoqFyOCgAQwcqkIckc5cHZnTTwEG+WwE9jJihidPYu1Z9aMorxyEonE0vHxsSkQCGTcbnfPYrEIGSAGsScnJ78U2YPkBwcHPofDoblcLhEOh0W5XBYPDw9C0zQxy+n1eqJQKIjDw0PhdDoF7sKd8Xj8nSGBWCz2aXNzU6VvIGq1mpjHAfHb21uxu7sLdQZE5PNUAmB8dXU1Dh6NRnMDlDw/P2dlKMe3F5/Abrdr9JMJIGg4HC4EZ2dnYnt7G0p/eEbC7/eng8EgE8A/DgaDhQH1sre3J0Kh0IDSvWEC0Wj0Pakg6vX6WLZFo1gscgfRZwuToKq1er1eroF+v89MZ8Xa2hpDJkbH1taWSKfTaLe3ChEoUsXyM3Q6HSnoJFRVlY4lDxL7+/tDIvFV2djYUKvVKsvUarWkoJPAW8vGogvJDkZEwqbgbSAP2DWbTSlMkpCNLZVKXBd0sorZbGY5G42GuL+/nwo9qRGM7gGg/hOJEZPAU6A74JLTMCuJx8dHw7swCsYkyMHUu7s7/gPYGWGy1fSkL7Wh0T2pVAruqTIJj8dTglNCIni8DCZJyMYeHR3BtGpcEzSsrBgu7XZbVCoVKegk4C+ysfAJmleX3B1kVitWq5WfAxUrg0mzkonLZDJcD9SqWSLxhV2TDCuH2Q+GNzc3Uuh2uwyZGOwp9BQFIoCaWNKtewVjHLWBZeT6+nphOD09FTabTSOviBKBP88mKRXKD0hEA42JzBv5fF5gUoMA/f6TCNTGKvy3V5jW19d5C8ICksvl5gLchUIEAfIHJyWvEpZf3bCoQD9GIhEVqtBcET6fjyXEU8Hvs9nsVKDoLi4ueEBhb8CXQnLaWS6plSNPCiwb7ppYNqjYTCShhuVjZ2dHld22aTj1KXElmUymyEHzdOdfwvfxIjPrQQBhlfCbEMbiJYnwU+zqtOT/AElv7ybxDkF2AAAAAElFTkSuQmCC', 33, 24);
  addBigDown = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAYCAYAAAB0kZQKAAAClklEQVR42r2WSW4aQRSGuUFygvgI3jsXyAWi7KysWCa7HCOrbCKS7JnnUcwzEoNAIBlDQwIiAsIkkAwCuyv/K9HILHBTFrikT4KmX72fv+q9Ko3mwDCbzRd6vV5nMBga4A4wQe62sT80ooOSIzAC5GckPoS8nfONqgC89AFsTph8D5PJtHY4HB/VBMh4kcGNs2A0GjnRaPTLoSWQ6UWbzXZWKAf90Waz+W5PBB7e0o9Op/NFIBFer3fNGHvFBdjt9rdkkcvlYh6P50UgIbRH5vO5kYuwWq1mi8XC/H6/MFqtlvOcWHIjm83KcOM1ieiRC6FQSBhFRL/fF45FlZAr9xDxmTblJhgM0o4VRhExGAyEY8kN5H6ACAuVJovFYiyRSAijiBgOh8KxkUiE7wsMiYtIpVIsnU6roiRV45i5ksmkIuKBi6CHuVxOlWNFjEYj1bko504EKmNDqvL5/FGMx+MdStLHzxTU5qElodxcBGr2bzgcZqVSSRhFxGQyEY6lYnC73WO+JwKBgJmaR6VSEUYRMZ1OhWPRJGlJbnh1oGavqHEUi0VWq9WEUETMZjOhuEKhwA8yOChBxCfeNVGzbTjC6vW6MGi9HJEYat3I+QcCaE9ccBHoE1fYJHImk2GNRoNOuLOBVk1NSoYLJQj4tXeSYn2+kUVUOu12++S0Wi0Wj8epImR8/g4B450Lj0e1WtXhLGE+n4+vXafTOQk0Fy0BCcB3B5L/A5cHb1io8fewbEOuUNWQ+nK5zCRJYt1ul/V6vSehd8h2KkM6I+igwh+T8flmtVoVtw5cqt416bKxWCx02EQymsoa9bxRrmbHgpN5ifOhD3fry+XyN+YcgK+7i8yxgwLANfgJCuBekMI29vqp5P8BrBz1w2SzlQAAAAAASUVORK5CYII=', 33, 24);
  addDown = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAASCAYAAABB7B6eAAACMklEQVR42p2U2YoTQRSG8wa+gfoEPoD4PLnUJ3HuAw7kIhch+77vC1lIJzGEaPaQRaLMQAwygzrO8f+LMUK60xmm4KPpqlP/f6rqVFksR83r9b5wuVx+8AXcAzHh/iHuA+dZzjUE5h8hetIMJmUzcWYiHo/nSbjdbmUUCoWudeII0Bjg9/slEAg8Gc6nTjwevzqI+3y+N+yEs0QikZNwst1uV1+zOOpQb71eO5UBJmh0TyaTpjgcDrFarYJ9lkwmYxqLpCWXy92JyEtWzU0sFpNsNmuK0+lUBrVaTer1umlsNBqVcDj8Cwbvebh0k2KxqCOdTh+qxGazKQOultvAPo4bzaMJx9GyyqBcLku1WtXBpVL0FMyUKzqeR70HgztlwM5Go6GDgagIaTabKmuK8st/goOUXq+nm1epVP4bYMk3pVJJ2u22Id1uVwaDgaRSKWXQarVkMpmoPsLx4zn5fF6CweCtMsABa4lEQmViBldCA03TZDgcmsZy65DQVxhoFhzIa95EOv/LyohOp6My2263Mp1OT8ZRh6W82Ww6MLhUdwFufSxJuY9Go5OMx2NZLBbqazROA54Rkv4E8Svw6nCjUXI/aMI9nc1mMp/PHw3jmRxvMur/Fm0I8Qvdm4QK+MbSZBasoH6/rzJerVY6lsulOgtWIIX5PBQKhRGEP4I2eGb4qu73+wtk85NXnWbnnmkc/ndU1ufdbjeF6G/DzI8b3cE74APX4M8ZcuAteH6s9ReI7tFLsgYxJQAAAABJRU5ErkJggg==', 24, 18);
  addSmall = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAQCAYAAAAS7Y8mAAACHklEQVR42pWUyaoaQRSG+0XCzZvkTbJ0nTe4y2ySLLNIyAuo7YAiKkYFQUWcFQVxRkSc7Ws7tn1y/gPXoHZnKPgouurUX3WmVpS7kcvlvicSibHP5zNdLhfZwfuUSqX0RqORIqK3it0oFAofgsHgmaFqtUrz+ZwMwyCrcblcaL1ei10kEqFQKETdbtelWLzyo9vtpl6vR6ZpXg9D+Hw+/5Hj8UjtdptUVYV47SpaLBaf4DYviuDpdKLD4fDfdDodCY+u619FOJ1Oq7FYTF6K23e73QNw2eFwyGy1/0o4HKZWq2VIzDlGS/4Qt7fbrSWVSkWEOVEiYGdXq9UoHo+fWfizggwjEfv9njabzQ0cJgEJhXA0GqVyuSxr97ZgNBpJxfD4qTidTkkUNlar1Q0Qs0PTtAf76XT6KmyIMNxYLpe0WCxuyOfzVK/XpaQghhnfAPm4t+/3+7+FOeArxBjCs9nsAazjAghDEJ5hzcqeyxaXayKcTCY9eAkOTCYTS7LZrAgjOWgcK5vxeCyNwjnoSoz5ljder9dEc2DTDsQPFYHZah8J9Xg8qOkyC3+RWs5kMp9Q3Mj4YDCQ7P4rw+GQ+Dyhc7nOYyy6ZZ6uHdhsNr/BlUAgQBweaQZ0Ew7eA+8QFtjhlX6/HzUeZMEX5vnhn8GL71hM47+WweEhVIwdEOS61kulUoObK8lnN5aidxe8Z1Rmjgz/hTbz48Z9Hr8AuvdfxM9YtLQAAAAASUVORK5CYII=', 22, 16);
  addSmallDown = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAQCAYAAAAS7Y8mAAAB5klEQVR42p2Uy4oaURCGfZEw8yZ5kyxdzxtkmU2SZcAJsxIUL+0dVLzjDe9BJYpXcBE3MoMTZ9Vi5f+LRIjdPTPJgY9Dn1P1d9V/TrfLdTECgcDXYDD4A5yAvMATqPr9/muX0wiFQjcIMl8hZkssFgtZRMPh8AduYhbDMP4Z5jG/UCiMzqLYuEK1p2g0KolE4r9hPnRku91+UWEsGHxrOp12xOv1itvt1vm5OFZerVaPInLNiu9TqZTkcjlHfD6fCjebTWk0Go5xyWSS1ZsQ/uT67Y2Uy2ULuCGKx+NRYRyQxONxXbOLz+fz6jVGQYVrtZrU63ULFHOi3+9b4mHDH+GjCrO9drttgdV1Oh09HIpx5jPZ7XaWeBZ4FkbwQ6lUksFgYMtkMlH/KNztdmWxWOgauYylFfD5UYWz2WyElQyHQxmNRrZkMhkV7vV6MpvNbGOYTx10v1KPK5XKG9yMU6vVkul06shqtZL9fq+z3T495rU9HA7fIPxZ7zJM/8hFes2Klsvlq5nP5+otPw54n4foAVydv8DxeHzLVnhgvDpsjYmbzcbCer3W9hkXiUQ0B/EpCP4E7y3/DCy+xaE8FovFIxOe++lwH4f6BN+/m6ZZRu7eVvTiBe+AAXY84RdYgLu/2sf4BYod+++9LB/2AAAAAElFTkSuQmCC', 22, 16);
  alertClose = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAANCAYAAABy6+R8AAAAL0lEQVR42mNgGFLAF4j10MT0oOI4gR6aRj0cBuHVSJQGBlJtINsmsvxEVugNMgAAER4HgkJSY9MAAAAASUVORK5CYII=', 13, 13);
  alertCloseDown = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAANCAYAAABy6+R8AAABJklEQVR42oWSS0uFUBSFTxMFJ4JPSAUfoE0uXHAgNAiCkFDycQWhkQg+fkRQEBH0K6KIon/ZXoIXC7t38LHPOmets9UtY4ydGIaxpXp7CI7jKtu2z+BnjuMEkiTVVVXVfd//S1EUtSiKtWmaG8bz/E1ZlrtxHI+SZdmOOgGW08aEruvfQRC8zBpAYx/rtm1z+BFKh2GY8H3/WVXVL9Q1DeBH6Jpu2UM3P2ma9rmsy3P4EbqiF/2F53mPFPhA/XsGP0KX1HaP67oPiqK8L+vyHH6ELqjtBBnuZVl+Q13TAH6EzqntBM3rleZ2N2sAjf1Zw49QlOd5RK2PkiRJJAhCyGjCBj17GMdx2HXdKk3ThGmahghQZx2dGH0ljf6tDS23h7As6xT+H+Yppgs3yXdHAAAAAElFTkSuQmCC', 13, 13);
  alertCloseHover = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAANCAYAAABy6+R8AAAAL0lEQVR42mNgGFKgGYhD0MRCoOI4QQiaxhAcBuHVSJQGBlJtINsmsvxEVugNMgAAuGENOKhqmqUAAAAASUVORK5CYII=', 13, 13);
  bluePlus = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAABSUlEQVR42nWSsU4CQRCG96HuCQQTKMACKrSB5rCCiliAOYnxOA/jJWjEgkILKdBAgkKg2ue4d9ju+t+Zvd1wEJjky//PzD/VrhCZCrZwgg28xw0koQySZ7wTxyrcwqVQTOAEMWf2jh7WcP01En8FkNf4rKsU9n7qk8HaHN//wekvEfd/Ac0y5c7qwZyzfCNu5/C6C6A7J0h7DHlbPbPrLXae8ETnB7IzA/b43h2y12R2NzNI0Z5Ctb+A1hQgf7JamQypEs0PqOtPwHKqeNfcoUR9AtmYAKRoGNjbsn19PyPF1Ru82hi4fAe0jlO1xXM7s5ka3YjKCE71FXH1BbBUWEdGM72Gsnyj37IUwS0/IyFQjgjSklHdR6aPkFxEB7+n8AS3OERcCIHCMEOYUgz1zj36X88DOPkAHiFzA6hcAHXmQ+Z9eLzLZv8BphAL4sYAflMAAAAASUVORK5CYII=', 14, 14);
  folderClosed = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAYUlEQVR42mNgAIKZM2c+nDVrVmp9fT0TAzYAVPAfig8DFbpgKERSAMOL58yZowJXiEUBCH8E4iZ8Cj7MmDGjEasCoDsWTps2Ten///+M6AoOzp492wkugeTIB0CcgiEBBADON3CSqiQjrwAAAABJRU5ErkJggg==', 8, 8);
  folderOpen = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAV0lEQVR42mNgIARmzpz5EIj/48APGWbMmJGGSwFIjqG+vp4JyDmMRcFhkBzYmlmzZrmgKwCJwd0BNWUxkoLFcN0wMGfOHBWgxEcQBrExfAM1pQmEkXUDACYqbCmIO5yKAAAAAElFTkSuQmCC', 8, 8);
  lightbulb = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAOCAYAAAD9lDaoAAAA/0lEQVR42q2QzUrDQBSFPx/EJ9HXUJ8tuFBrFaNGC2JEF6KuXMSWmIo0TVv/CNaFWH8qGMlxxhAsFXceOFy4351zZwaMej5zrS3SxiKqLxS+dEm7m8xazvUe02GV/O4YZbcov0evTdTbQWGFPPGYIvaIO7sG9pEeCn9eoWGIWusmcZWYaIVs0DCwHDL1I0FvdZT66LxCht3/fFYAm2Dre4ReTlHfL+7HRZVhp1actCtstQNPhyh2UbTMkPYGM+ESuY0enBh4hB4P0M22ubjpdw3/fmG8htesGrj/Y5Ogtss8pZIak+X/jNr2GZXjOBo34wqCQOP+NfR/SZIm/kr5AkPyBjTOx+E2AAAAAElFTkSuQmCC', 9, 14);
  nextDigestPage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAABkklEQVR42r2W3U7CMBiGdwXEO9RjvQi9Ag49MfFAlvgbIUSRECJTFCVoNKAHgsbI+JcfQWCDrv1slwi4Qnewxi95krZ7+z1ZD9YpCq1Y8mF/7ySJ1JAGMshkC2AY5hYALCnRi/toMHYz0qtNGCMLvJRlYajU23B0dg13VIIx3lQCwQS0Oj07QIgcylRycHrFxiYTENYc05ksRgjZR8VqKsBEKpzAoosy4QTIIkJW1jYmEEJc8/8vGCMsxClwy3OCEV0U4RS45XnBGAvhBC55TmDSRRFOgVt+RqBhNmh0TCFOgVueE9TaxlxmGzthn4VF+zhBpTmcS6kx4Bovr67bb7FoD4MTlD6HC9FnJL/NRXkGJ9DrAyHFWn9y/m5ZBif4oA1kwgneq32p/BHQgrfytzQKehfYRWYLdoJaq978glf2oCSHzHN5Kggcn/vD8TTJ5qvwUuxCXu95Ip3T4TCSgnjqyb6FFTUS8Wm3uUc1lACVWgMe2Q1f0uY5ZJioR49eZX8tCjX5KH52c3qAzNCmbLO+PyvEJ5GcpYudAAAAAElFTkSuQmCC', 24, 24);
  nextDigestPageDown = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAABjUlEQVR42q2WW07CQBSGuwQX4ALclT7rInQLovFFMYrRkiBUgheMSoFCARFoixBSRcLFGPASeTHxAseZGoEpqceEOcmX9OE//5fOpEkFgYxbirddXhmWRT5sBxNw33kWAWBK2NiPdVdJ+aZfBo8kw84E0H3as0L6do9S0Ov13AI1eqQY7AX5sRWIWhIyX5bAe5jgihhKWEdFxxL4TlTuMILAaYY7jODgPIsyt7A0oN/vo3lGEIrkUewCLM8IjmMail2A5RlBWCmi2AVYnhGcqSUUuwDLM4JIuoJiF2B516ggmjVR7AIszwiUXNWR0WI7xOO4xwhUreZIsnA3Vjw7v2i9RUp33mMEGaPxJ2m9PlaO7bi8I4JsqYVyed0cnP9/8owgX3ngDiPQzTZ3BgJ6GfrNIxRvn7ihmZ3hJa/54qAaTSjXXrihFOpDgRi+aruDKUgaLSjXX6HS6E6EojVgXVJBkvUfQUg2ZvwX2hs1TsLvHwU9ESmqw/vHJ/kMoUr/WgTyME3IAb+h5Sbt/QaNtV9pQDJYUAAAAABJRU5ErkJggg==', 24, 24);
  popupButtonImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAMCAYAAAC5tzfZAAAAnUlEQVR42p3S7Q3CIBCA4S7uDP5wBidwDbcwNsXQxAqU8tXzAHulpiatJE8gHO8/qgrX8XyFraop2LNS+HcUwpj4Qvg25p0i4zxY6+FwuvxkcB5RpLSDXlvkVoM4U2lu56iTBg3Qicgsgnw35De4U8SfPbREpz0G07mcUcRa9SGh4RJYRHcFrubo/hBJzQSd19SIolvz2mzxK/Z8ozf1KBWRB/6kPQAAAABJRU5ErkJggg==', 13, 12);
  previousDigestPage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAABq0lEQVR42q2Wy07CQBSG+wTEJ1RZKj6D8gQs3Zi4kCZeI4QoEkIERVGCRgO6EDRGy1W5CCK0TDvHOTUIdKANoSf5ks70n/M1bdOpILAKx+92d47iRPTHwA5S6Rx0u/IGAMwJobPbkC98pUilKvSICrOUqmpQrNTh4OQSbphE07R1weuLQq3R0gOU2kOBSfaOL/BYRgHF5hob2YVCiH6rsAYCjdoKJ1DZpJ1wAqJSU3pEg4Vlt2Wuz1QCbL7ocuvML63i2zG9AJuMQ1bIf/NhyaR8H06gsMlxYEPnyqjgb7w2cY0yVtDTxtKvvgSfA6X6kolrEE4gs0kzhgX4GlrlhwQx/TI/GrIpRoFVnhOU611TjAKrPCcoVjumGAVWeU6Q/+yY4nSNCqzynECq/JhiFFjlOcFbuW2KsazynOC11LaVEQF+W14K37aRk5qAG5ku2PLFapXqFzzjibw9pB4LA4H38NQTiCRpOluCp/cmZKXWTCQzEuwHExBJPOi7sCAGg47YdeZe9EdBZFbvjGwHzlnzDOnKpMVuvYh/LQIzORge3DlngA5RZ2xi318ghygO7mcD5QAAAABJRU5ErkJggg==', 24, 24);
  previousDigestPageDown = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAABn0lEQVR42q2W7UrCUBjHdwldQBfQVfXysZdrKG8hi76UUUZNMF1mlmG66WxWpm4TRVYimhHaC/kl6GV72lmoOwN3As8DPxjj//x/cA6MMYw5Pi7T8QZ4WGXpsBvJwmP3lQWACWbrMN1bN8u3Qzz4OR72xgDto541s28/lgNd130MMvq5NBxE6LETFiyJOT+WIHCSpQobzVpHhcYSBM8k6mCC8Pk1dTDB0UWeCJe4gZkFz7+yCEwQTRVdOU4WYHbRYzE9v0zMIzDBaVoeSUwoDcrtErcdBCaIi+WROMsRc0se87hWXPcwQUKqjKQ//XJ0D4ZhWO/c9jBB6qpGxC7QdYOY99oFQl4j4hSQ8phALNSJOAWkPCaQ5AYRp4CUxwTXaouIU0DKewM2Qb7SJuIUkPKYoFh7IuIcUh4TKFqHOgMBugzl7hnK9y/UkLXu8JI3ghmQ1AeoNt6oIZaaQwEbv+34Ijm4VNtQbb5DrdUbC1FuwSYnAccrf4Ior06FkvIHMo5D/48CnQgnKPD59Y0+WHX018KYD5MmBaA3qFxDvb+miWBZWqnxQAAAAABJRU5ErkJggg==', 24, 24);
  removeTag = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALCAYAAACprHcmAAAAoElEQVR42pWRQQ7CIBBFuZsn8BJezAN4BI/goqx0p4lpIwtNaVIowy8zIKmr1kl+/v/DYzVKpTmezliT+oJbRj78DXuKmELEbn/AJBnwpfvSK2xdRO8AO0IA7uz9WPZuARsbYYaIVxGDZqDa+a3C9zdlfTLIOXvEI2VWhW+GRAzkHGq/ll5h3QboLqklNCk3HUnW7LJfwJdnWNXPYbZccAaPd5VkvusvLAAAAABJRU5ErkJggg==', 11, 11);
  removeTagHover = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALCAYAAACprHcmAAAAbklEQVR42pWRMQ6AIAxFuf8ZYMCJzc0JJx0cvJP8Nm3TEAza5LV9zWciBNTzoYIGb4wZ/IDaBZlh4QNyyoF2xbuFK2QXqPwkqg9vEM/bjfsKUdRHd+4FUuSge+8WXiBEltmTfThC0oAoJA3/+cEGG+0uClDDsGAAAAAASUVORK5CYII=', 11, 11);
  spellyDropdown = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAOCAYAAAD0f5bSAAAAkUlEQVR42pXSYQrCMAyG4Z3C83iRXcfr9Z+wgcJwumKtlMbhcJVICh1+oJAVXihJn3+tUkq83bG6GCNXcllz5P2C9u1JFaDmeFEF6NBZVYC63vGmbv4mewnQ2XruB/8TyK4EyLqQG64BQJmXAN3utOQ8ZfA9KwEKcVQF6DE+VQGappcqQHN6q8qIiFZ9WGMMfwBPKGzBY0E7rAAAAABJRU5ErkJggg==', 13, 14);
  splitButtonDropdown = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAABAklEQVR42q3VvWqEQBSGYa8g5Cq9pKRLl0ZBLC31CsRWUMQ/xB8UURRRT2YmbHE26xb7ZeAtHA4POMWMZpomIRmGQb7v07Isn0T0rsmNV9dxHNS2LTmOo1Dx/aHAfd+h8jwn27bpPM9Vgdu2Qa3rqn5fLgXKDTQGigOFY+A8z3AMnKYJjoHjOMIxcBgGOAb2ff8nXdcvk+t+noFd1z3sCns0y8CmaS67x67mGFjX9dNu2LMZBlZVBXe7ZBRYliUcA4uigGNglmVwDEzTFI6BSZLAMTCOY6ggCDgYRdFLhWGo3hJ5/Xue9wuir55lWeS67iYu2Vk8Ut+aQPd/qBV9id5+AImdw32/et7wAAAAAElFTkSuQmCC', 20, 24);
  splitButtonDropdownDown = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAA40lEQVR42q3RMQqDQBCFYW+QnCDH8zo5QnpFUQTBQlAEQZAIooUgCIKQTtJaONkVUzzjWmQc+LvHx8JqhmHQCT1FN03eSSA5jlMR0fU0UDQL8L6AlmWxk464UVufy24FaQE9z2MHoO/77AAMgoAdgGEYsgMwiiJ2ACZJ8pOu68rkbfcApmm6mwrb2wKYZZmyLabaAZjn+WFf7GgDYFEU7AAsy5IdgHVdswOwaRp2ALZtyw7AruvYAdj3PauqqhAchuGvJCY/xHVdiuP4tYCmaRIn27ZniU3T9BbeQ6NzbpSY6PIBfccjtjvT4YkAAAAASUVORK5CYII=', 20, 24);
  viewSwitcherAvatar = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAYCAYAAAAGXva8AAAA1ElEQVR42r3PTQ6CMBCGYY7q3kt4F93rDfQcGmMMqPgTTQQBgRZbFx9dzCzQ5CN5Fp0085Zotlh1bFFH/hC1lgdR404sfdRYGkRbd2BBtGmtaDSegDTTaPu8n6L/QrRujCiMSjONts9D9O0OLH20NqLw9dJMo+3zEK3cQRIu0u4MhejlUYnCqDTTaPs8RNN7SYPo8VaIwtdLM422z0M0uRaicJF2ZyhE4/NLFEalmUbb5yG6T3MaRHennAbR7SGjQXSTZDSIruMnzTc6nS87Nv+nhu0DxZnD0NbL2qYAAAAASUVORK5CYII=', 29, 24);
  viewSwitcherAvatarDown = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAYCAYAAAAGXva8AAAA6klEQVR42sXWSwcCYRTG8fmo7fsSfZeSiC5KF6Uak9EYpYsyUiKRSLSPJ55F3sV7DrM5LX6b4/X8ZzlBpTWDtaDcnMISo9V2CEuM1rpzWGK03o9hidHGMIElRlvjFJJCsfTju0m0TUY7kxUk7pD2Lg9Ge+EaEjfqu0m0TUYH0Q6WGB3Fe0jcr/fdJNomo5NFBok7pL3Lg9FZeoTEjfpuEm2T0Wh5hiVG4/UFEvfrfTeJtslosr1C4g5p7/JgNN3fIHGjvptE22R0ld1hidHN8QFLjO5OT1hi9HB5wRKj2fUNS4z+5W8QwMfaF5ATyMzQshCLAAAAAElFTkSuQmCC', 29, 24);
  viewSwitcherFeed = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAYCAYAAADtaU2/AAABMElEQVR42s3WzUrDQBDA8TyB+Ii9+xI+hZeCFwVBhIogUjwoovRQQfDjYKuU0qjRSqpN26xpZsfZCNqBZJlLBwM/CAOz/7SHkGB7/xS1tK+7mKamjoirASpceQ4YDUfYaLbwkuIAsFGErdURfyS4e3ju7k0RBrrT4v5yd/2Ewaph4ZwGWlh4nttStbX1X2WzKlXnOf8jnM2h1OJhZbMqVec5LPxFAylJ2LfPwxmIicKefRY2NJCShH37LPw2MmKSsG+fhaM4FZOEffss/Pw+E5OEffssHA5nYpKwb5+FB69TMUnYt8/C/WiihoV7LxM1LPz4lKh4CMe41Tj5C3fDRMXVfcTDncF46dp3Ie4dtfD44rb42grcE2jYOTij6E02Ndkn0JvT/WJYMrsgJptk5RtPU/UQZDR6nwAAAABJRU5ErkJggg==', 30, 24);
  viewSwitcherFeedDown = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAYCAYAAADtaU2/AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQ5JREFUeNpiXLLhwH8GOgFebs4Hfi5mjoyMjA9Y/v+nm70Mn79+V9i6/8ydv//+mbAwMzHRzWKQFz98+soMZGxlYWJmZqAn+PPnDwMwqKVYmJmZ6GwxA9BiBgZgUNPXxzAADGrcPt6wfiucHRDojSGGC8DU4rWYWB+TEjLEqCU6jklJC8SoZWHC47qIiGCy4o+Jmj4mBRDlY1qkaqLimIkGPmYa1D4ejWP6xTGJtVNebjp1ymp61scgwEhMyUVt8O/fP0idSKtUjQt8/faNARbCdGmBgHz69es3hoePHzOIi4kwAJt5X1nOnr9ANx/LSIr/MtdTArZ8GLIYga3MP3Sy9yAQg3w5CWjzQ4AAAwDMZkO0gpfjLgAAAABJRU5ErkJggg==', 30, 24);
  viewSwitcherSingle = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAYCAYAAADtaU2/AAABJElEQVR42r3WzWrCQBDA8TyBz+jdl+gT+BCaQwvF9CAqHmxEil6kRS/FVkSixlo/it/dZHe7E6swsAuy4AR+lz3Mn4EcxnHUV228PtwXG5H75EsqTqXerjyWX1gQziVjkaT4knDee5bhbJk8CEHjHBanqJCcCApzLsigcKweqKBwFAutdObOimkeuCp8CyjMIq5lu7FpHkDhX/VABYcZ17Ld2DQPoPBRPVD5D/scwrPVUct2Y9M8gMLT5YEMCk/mey3bjU3zAAqPvvdkUDj42mnZbmyaB1B4ON2SQeFBuCVzCccxl/3xhkwSznn+As6eT/XwMaJx2rhQy3rVpuj0JvJ9+CN7wfrmkrBbKqX8VvcNbi9XyROB69ZR/1ZKycLpBVcQhT9oUv0QLAhK7gAAAABJRU5ErkJggg==', 30, 24);
  viewSwitcherSingleDown = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAYCAYAAADtaU2/AAABCUlEQVR42r3Wy2rCQBSA4byI+Grd+xJ9AZ9CewFBYyONpSUxpEZtGhsbcyGkWKReCqXSvXCcTODQzcxiwDPwDVmdn5NNomnstPXRmAFK2s2duy8fWj2bDA+X13XfIYXh28EzKQx3TI8UhrsPM1IY1p98oYvGpRLZTAwb1pwUhu+dUEh1Y9lMDA/diBSGH71YSHVj2UwMW9OMFIZHfi6kurFsJobd4IMUhr1wJaS6sWwmhmfva1IY9uMvIdWNZTMxPM92pHj4il2L/JtUFWYf5qj4IVX9+hguBOkWktUvGR427DDtmBN4TTaQfB4gW/+dHQ87L0VtYL8ty1dOhYf/HwCoM00mYI7ndAJW3v6ZWtMUFQAAAABJRU5ErkJggg==', 30, 24);
}

var add_15 = null, addBig = null, addBigDown = null, addDown = null, addSmall = null, addSmallDown = null, alertClose = null, alertCloseDown = null, alertCloseHover = null, bluePlus = null, folderClosed = null, folderOpen = null, lightbulb = null, nextDigestPage = null, nextDigestPageDown = null, popupButtonImage = null, previousDigestPage = null, previousDigestPageDown = null, removeTag = null, removeTagHover = null, spellyDropdown = null, splitButtonDropdown = null, splitButtonDropdownDown = null, viewSwitcherAvatar = null, viewSwitcherAvatarDown = null, viewSwitcherFeed = null, viewSwitcherFeedDown = null, viewSwitcherSingle = null, viewSwitcherSingleDown = null;
function $clinit_1043(){
  $clinit_1043 = nullMethod;
  panelClose = new ImageResourcePrototype_0(($clinit_176() , 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAMUlEQVR42mNgGAUM/yFgJprYTJAgMZpnIhuAzifJAJI04nIBWRrJdjLJLqAotEcAAADY0XuFLdX2NQAAAABJRU5ErkJggg=='), 15, 15);
  panelCloseDown = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAYklEQVR42mNgYGDgAOIAIG4gEldA1YP0kaQRGYP0gU1qIBOTrRFT89mzZ69Onjx5M7IYiA8SJ6gZphBmADqfoLORNeDRiNvPRGikss0U+Zmi0KZXIqmgOG2DcocHiWkcnKsAiUO29Vnz/4UAAAAASUVORK5CYII=', 15, 15);
  panelCloseHover = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAYUlEQVR42mNgYGBgAWINIHYgEttA1YP0kaQRGYP0gU1yIBOTrRFT838guHXr1mZkMRAfJE5QM0whzAB0PkFnI2vAoxG3n4nQSGWbKfIzRaFNr0RiQ3HaBuUOFRLTODhXAQBYrqMdG7TQaQAAAABJRU5ErkJggg==', 15, 15);
  panelMaximize = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAHElEQVR42mNgGAUM//EA2msmRXy4aCY7wEYAAAANZXONzd+/WAAAAABJRU5ErkJggg==', 15, 15);
  panelMaximizeDown = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAASUlEQVR42mNgYGDgAOIAIG4gEldA1YP0kaQRGYP0gU1qIBOTrRFT89mzZ6/iwrTXjM2Jw10z2QFGr0RSQXHaBuUODxLTODhXAQCMo7xFotNFkgAAAABJRU5ErkJggg==', 15, 15);
  panelMaximizeHover = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAARUlEQVR42mNgYGBgAWINIHYgEttA1YP0kaQRGYP0gU1yIBOTrRFT8388gPaasTlxuGsmO8DolUhsKE7boNyhQmIaB+cqAKLuoslOHpzYAAAAAElFTkSuQmCC', 15, 15);
  panelMinimize = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAF0lEQVR42mNgGAUM//EA2moeBaMAHQAA9d83yRzP5kIAAAAASUVORK5CYII=', 15, 15);
  panelMinimizeDown = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAARElEQVR42mNgYGDgAOIAIG4gEldA1YP0kaQRGYP0gU1qIBOTrRFT89mzZ6/iwrTVPHB+HtVMMI1TlrZBucODxDQOzlUAfAaTQe16oegAAAAASUVORK5CYII=', 15, 15);
  panelMinimizeHover = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAQUlEQVR42mNgYGBgAWINIHYgEttA1YP0kaQRGYP0gU1yIBOTrRFT8388gLaaB87Po5oJpnHK0jYod6iQmMbBuQoAvIJqxQ9xFh4AAAAASUVORK5CYII=', 15, 15);
  panelRestore = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAIElEQVR42mNgGD7gPx5AkaFk20hbzfjEh6hm+sfv4AMAajGnWSVraboAAAAASUVORK5CYII=', 15, 15);
  panelRestoreDown = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAU0lEQVR42mNgYGDgAOIAIG4gEldA1YP0kaQRGYP0gU1qIBNjCp49e/YqLkxQMy6MVzMhG2mrGZ9zh6hmvPFMQvySHs9Y0jhlaRuUOzxITOPgXAUAWADf0epRj7gAAAAASUVORK5CYII=', 15, 15);
  panelRestoreHover = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAT0lEQVR42mNgYGBgAWINIHYgEttA1YP0kaQRGYP0gU1yIBNjCv7HAwhqxoXxaiZkI20143PuENWMN55JiF/S4xlLGqcsbYNyhwqJaRycqwAY79NVqPcCHgAAAABJRU5ErkJggg==', 15, 15);
}

var panelClose = null, panelCloseDown = null, panelCloseHover = null, panelMaximize = null, panelMaximizeDown = null, panelMaximizeHover = null, panelMinimize = null, panelMinimizeDown = null, panelMinimizeHover = null, panelRestore = null, panelRestoreDown = null, panelRestoreHover = null;
function $clinit_1044(){
  $clinit_1044 = nullMethod;
  $clinit_1047();
  $clinit_81();
  $push_0(toInject, ($clinit_176() , '.GMQ4-KSBCM .GMQ4-KSBOL{height:' + regularLeftImage.height_0 + 'px;width:' + regularLeftImage.width_0 + 'px;overflow:hidden;background:url("' + regularLeftImage.url + '") -' + regularLeftImage.left_0 + 'px -' + regularLeftImage.top_0 + 'px  no-repeat;}.GMQ4-KSBCM .GMQ4-KSBPL{height:' + regularMiddleImage.height_0 + 'px;overflow:hidden;background:url("' + regularMiddleImage.url + '") -' + regularMiddleImage.left_0 + 'px -' + regularMiddleImage.top_0 + 'px  repeat-x;font-size:8.5pt;line-height:' + regularMiddleImage.height_0 + 'px;white-space:nowrap;padding:0 3px;}.GMQ4-KSBCM .GMQ4-KSBDM{height:' + regularRightImage.height_0 + 'px;width:' + regularRightImage.width_0 + 'px;overflow:hidden;background:url("' + regularRightImage.url + '") -' + regularRightImage.left_0 + 'px -' + regularRightImage.top_0 + 'px  no-repeat;}.GMQ4-KSBCM.GMQ4-KSBKL .GMQ4-KSBOL{height:' + regularLeftDownImage.height_0 + 'px;width:' + regularLeftDownImage.width_0 + 'px;overflow:hidden;background:url("' + regularLeftDownImage.url + '") -' + regularLeftDownImage.left_0 + 'px -' + regularLeftDownImage.top_0 + 'px  no-repeat;}.GMQ4-KSBCM.GMQ4-KSBKL .GMQ4-KSBPL{height:' + regularMiddleDownImage.height_0 + 'px;overflow:hidden;background:url("' + regularMiddleDownImage.url + '") -' + regularMiddleDownImage.left_0 + 'px -' + regularMiddleDownImage.top_0 + 'px  repeat-x;line-height:' + regularMiddleDownImage.height_0 + 'px;}.GMQ4-KSBCM.GMQ4-KSBKL .GMQ4-KSBDM{height:' + regularRightDownImage.height_0 + 'px;width:' + regularRightDownImage.width_0 + 'px;overflow:hidden;background:url("' + regularRightDownImage.url + '") -' + regularRightDownImage.left_0 + 'px -' + regularRightDownImage.top_0 + 'px  no-repeat;}.GMQ4-KSBBM .GMQ4-KSBOL{height:' + primaryLeftImage.height_0 + 'px;width:' + primaryLeftImage.width_0 + 'px;overflow:hidden;background:url("' + primaryLeftImage.url + '") -' + primaryLeftImage.left_0 + 'px -' + primaryLeftImage.top_0 + 'px  no-repeat;}.GMQ4-KSBBM .GMQ4-KSBPL{height:' + primaryMiddleImage.height_0 + 'px;overflow:hidden;background:url("' + primaryMiddleImage.url + '") -' + primaryMiddleImage.left_0 + 'px -' + primaryMiddleImage.top_0 + 'px  repeat-x;font-size:8.5pt;line-height:' + primaryMiddleImage.height_0 + 'px;white-space:nowrap;padding:0 3px;}.GMQ4-KSBBM .GMQ4-KSBDM{height:' + primaryRightImage.height_0 + 'px;width:' + primaryRightImage.width_0 + 'px;overflow:hidden;background:url("' + primaryRightImage.url + '") -' + primaryRightImage.left_0 + 'px -' + primaryRightImage.top_0 + 'px  no-repeat;}.GMQ4-KSBBM.GMQ4-KSBKL .GMQ4-KSBOL{height:' + primaryLeftDownImage.height_0 + 'px;width:' + primaryLeftDownImage.width_0 + 'px;overflow:hidden;background:url("' + primaryLeftDownImage.url + '") -' + primaryLeftDownImage.left_0 + 'px -' + primaryLeftDownImage.top_0 + 'px  no-repeat;}.GMQ4-KSBBM.GMQ4-KSBKL .GMQ4-KSBPL{height:' + primaryMiddleDownImage.height_0 + 'px;overflow:hidden;background:url("' + primaryMiddleDownImage.url + '") -' + primaryMiddleDownImage.left_0 + 'px -' + primaryMiddleDownImage.top_0 + 'px  repeat-x;line-height:' + primaryMiddleDownImage.height_0 + 'px;}.GMQ4-KSBBM.GMQ4-KSBKL .GMQ4-KSBDM{height:' + primaryRightDownImage.height_0 + 'px;width:' + primaryRightDownImage.width_0 + 'px;overflow:hidden;background:url("' + primaryRightDownImage.url + '") -' + primaryRightDownImage.left_0 + 'px -' + primaryRightDownImage.top_0 + 'px  no-repeat;}.GMQ4-KSBBM{color:#fff;}.GMQ4-KSBGL .GMQ4-KSBOL{height:' + addButtonLeftImage.height_0 + 'px;width:' + addButtonLeftImage.width_0 + 'px;overflow:hidden;background:url("' + addButtonLeftImage.url + '") -' + addButtonLeftImage.left_0 + 'px -' + addButtonLeftImage.top_0 + 'px  no-repeat;}.GMQ4-KSBGL .GMQ4-KSBPL{height:' + addButtonMiddleImage.height_0 + 'px;overflow:hidden;background:url("' + addButtonMiddleImage.url + '") -' + addButtonMiddleImage.left_0 + 'px -' + addButtonMiddleImage.top_0 + 'px  repeat-x;font-size:8pt;line-height:' + addButtonMiddleImage.height_0 + 'px;padding:0 2px;color:#697f9f;}.GMQ4-KSBGL .GMQ4-KSBDM{height:' + addButtonRightImage.height_0 + 'px;width:' + addButtonRightImage.width_0 + 'px;overflow:hidden;background:url("' + addButtonRightImage.url + '") -' + addButtonRightImage.left_0 + 'px -' + addButtonRightImage.top_0 + 'px  no-repeat;}.GMQ4-KSBEM .GMQ4-KSBOL{height:' + systemButtonLeftImage.height_0 + 'px;width:' + systemButtonLeftImage.width_0 + 'px;overflow:hidden;background:url("' + systemButtonLeftImage.url + '") -' + systemButtonLeftImage.left_0 + 'px -' + systemButtonLeftImage.top_0 + 'px  no-repeat;}.GMQ4-KSBEM .GMQ4-KSBPL{height:' + systemButtonMiddleImage.height_0 + 'px;overflow:hidden;background:url("' + systemButtonMiddleImage.url + '") -' + systemButtonMiddleImage.left_0 + 'px -' + systemButtonMiddleImage.top_0 + 'px  repeat-x;font-size:8pt;line-height:' + systemButtonMiddleImage.height_0 + 'px;padding:0 2px;white-space:nowrap;color:#59573c;}.GMQ4-KSBEM .GMQ4-KSBDM{height:' + systemButtonRightImage.height_0 + 'px;width:' + systemButtonRightImage.width_0 + 'px;overflow:hidden;background:url("' + systemButtonRightImage.url + '") -' + systemButtonRightImage.left_0 + 'px -' + systemButtonRightImage.top_0 + 'px  no-repeat;}.GMQ4-KSBEM.GMQ4-KSBKL .GMQ4-KSBOL{height:' + systemLeftDownImage.height_0 + 'px;width:' + systemLeftDownImage.width_0 + 'px;overflow:hidden;background:url("' + systemLeftDownImage.url + '") -' + systemLeftDownImage.left_0 + 'px -' + systemLeftDownImage.top_0 + 'px  no-repeat;}.GMQ4-KSBEM.GMQ4-KSBKL .GMQ4-KSBPL{height:' + systemMiddleDownImage.height_0 + 'px;overflow:hidden;background:url("' + systemMiddleDownImage.url + '") -' + systemMiddleDownImage.left_0 + 'px -' + systemMiddleDownImage.top_0 + 'px  repeat-x;line-height:' + systemMiddleDownImage.height_0 + 'px;}.GMQ4-KSBEM.GMQ4-KSBKL .GMQ4-KSBDM{height:' + systemRightDownImage.height_0 + 'px;width:' + systemRightDownImage.width_0 + 'px;overflow:hidden;background:url("' + systemRightDownImage.url + '") -' + systemRightDownImage.left_0 + 'px -' + systemRightDownImage.top_0 + 'px  no-repeat;}.GMQ4-KSBEM{float:right;padding:2px;}.GMQ4-KSBIL{cursor:pointer;-webkit-user-select:none;-moz-user-select:none;}.GMQ4-KSBJL{opacity:0.35;cursor:default;}.GMQ4-KSBHL{font-weight:bold;}.GMQ4-KSBML .GMQ4-KSBLL,.GMQ4-KSBML .GMQ4-KSBAM{width:100%;}'));
  schedule();
}

function $setUiListener_0(this$static, mouseListener){
  this$static.eventsToSink == -1?sinkEvents(this$static.element_0, 124 | (this$static.element_0.__eventBits || 0)):(this$static.eventsToSink |= 124);
  this$static.eventsToSink == -1?sinkEvents(this$static.element_0, 1 | (this$static.element_0.__eventBits || 0)):(this$static.eventsToSink |= 1);
  this$static.mouseListener = mouseListener;
}

function TextButton_0(style){
  var attachRecord0, domId0, domId1, f_HTMLPanel1, full, middle;
  $clinit_1044();
  $initWidget(this, (domId0 = $createUniqueId($doc) , domId1 = $createUniqueId($doc) , f_HTMLPanel1 = new HTMLPanel_0("<table cellpadding='0' cellspacing='0' class='GMQ4-KSBLL' id='" + domId0 + "'> <tbody> <tr> <td> <div class='GMQ4-KSBOL'><\/div> <\/td> <td class='GMQ4-KSBAM'> <div class='GMQ4-KSBPL' id='" + domId1 + "'><\/div> <\/td> <td> <div class='GMQ4-KSBDM'><\/div> <\/td> <\/tr> <\/tbody> <\/table>") , attachRecord0 = attachToDom(f_HTMLPanel1.element_0) , full = $doc.getElementById(domId0) , full.removeAttribute('id') , middle = $doc.getElementById(domId1) , middle.removeAttribute('id') , attachRecord0.origParent?attachRecord0.origParent.insertBefore(attachRecord0.element, attachRecord0.origSibling):orphan(attachRecord0.element) , this.middle = middle , f_HTMLPanel1));
  $addStyleName(this, style.style_0);
  this.middle.textContent = '';
  this.element_0.removeAttribute('title');
  new StyleAxis_0(initValues(_3Lcom_google_gwt_core_client_JavaScriptObject_2_classLit, {58:1, 138:1}, -1, [this.element_0]));
  this.cursorStyle = new StyleAxis_0(initValues(_3Lcom_google_gwt_core_client_JavaScriptObject_2_classLit, {58:1, 138:1}, -1, [this.element_0]));
  new StyleAxis_0(initValues(_3Lcom_google_gwt_core_client_JavaScriptObject_2_classLit, {58:1, 138:1}, -1, [this.element_0]));
  $setStyle(this.cursorStyle, 'GMQ4-KSBIL');
}

function TextButton(){
}

_ = TextButton_0.prototype = TextButton.prototype = new Composite;
_.getClass$ = function getClass_684(){
  return Lorg_waveprotocol_wave_client_widget_button_text_TextButton_2_classLit;
}
;
_.onBrowserEvent = function onBrowserEvent_6(event_0){
  if (!this.mouseListener) {
    $onBrowserEvent(this, event_0);
    this.widget.onBrowserEvent(event_0);
    return;
  }
  switch ($eventGetTypeInt(event_0.type)) {
    case 4:
      $onMouseDown(this.mouseListener);
      break;
    case 32:
      $onMouseLeave(this.mouseListener);
      break;
    case 16:
      $onMouseEnter(this.mouseListener);
      break;
    case 8:
      $onMouseUp(this.mouseListener);
      break;
    case 1:
      $onClick_1(this.mouseListener);
  }
  $onBrowserEvent(this, event_0);
  this.widget.onBrowserEvent(event_0);
}
;
--></script>
<script><!--
_.onDetach = function onDetach_4(){
  this.widget.onDetach();
  !!this.mouseListener && $onMouseLeave(this.mouseListener);
}
;
_.setState = function setState_0(state){
  this.stateStyleName != null && (setStyleName_0(this.element_0, this.stateStyleName, false) , undefined);
  switch (state.ordinal) {
    case 3:
      $addStyleName(this, this.stateStyleName = 'GMQ4-KSBJL');
      break;
    case 2:
      $addStyleName(this, this.stateStyleName = 'GMQ4-KSBKL');
      break;
    case 1:
      $addStyleName(this, this.stateStyleName = 'GMQ4-KSBNL');
      break;
    case 0:
      this.stateStyleName = null;
  }
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1, 157:1};
_.cursorStyle = null;
_.middle = null;
_.mouseListener = null;
_.stateStyleName = null;
function $clinit_1045(){
  $clinit_1045 = nullMethod;
  REGULAR_BUTTON = new TextButton$TextButtonStyle_0('REGULAR_BUTTON', 0, ($clinit_1044() , 'GMQ4-KSBCM'));
  PRIMARY_BUTTON = new TextButton$TextButtonStyle_0('PRIMARY_BUTTON', 1, 'GMQ4-KSBBM');
  ADD_BUTTON = new TextButton$TextButtonStyle_0('ADD_BUTTON', 2, 'GMQ4-KSBGL');
  SYSTEM_BUTTON = new TextButton$TextButtonStyle_0('SYSTEM_BUTTON', 3, 'GMQ4-KSBEM');
  $VALUES_39 = initValues(_3Lorg_waveprotocol_wave_client_widget_button_text_TextButton$TextButtonStyle_2_classLit, {58:1, 138:1}, 102, [REGULAR_BUTTON, PRIMARY_BUTTON, ADD_BUTTON, SYSTEM_BUTTON]);
}

function TextButton$TextButtonStyle_0(enum$name, enum$ordinal, style){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
  this.style_0 = style;
}

function values_40(){
  $clinit_1045();
  return $VALUES_39;
}

function TextButton$TextButtonStyle(){
}

_ = TextButton$TextButtonStyle_0.prototype = TextButton$TextButtonStyle.prototype = new Enum;
_.getClass$ = function getClass_685(){
  return Lorg_waveprotocol_wave_client_widget_button_text_TextButton$TextButtonStyle_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 102:1};
_.style_0 = null;
var $VALUES_39, ADD_BUTTON, PRIMARY_BUTTON, REGULAR_BUTTON, SYSTEM_BUTTON;
function $clinit_1047(){
  $clinit_1047 = nullMethod;
  addButtonLeftImage = new ImageResourcePrototype_0(($clinit_176() , 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAPCAYAAAA2yOUNAAAAh0lEQVR42oXRsQqDMBSF4by+S4cOHczgoEOGIBlaMGDBQqUUB7FDB8GhT5J6zhAyyM2Bb7jhHwSV2le2S5Aw8O+fiNFt3ESM3GMVMbL3r4iR6T4Rlt7AqL7OEZbewKhyUzga3oGRtq8IS29gdDHPCEtvYHRuBhGjU9WLGBXaixS+IfuDsZDZH7kOrjez7B9pAAAAAElFTkSuQmCC'), 9, 15);
  addButtonMiddleImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAAPCAYAAABeMvJZAAAAeElEQVR42u3b2Q2CUBBA0em/BIuwF3swLnFBEMhTxLEJfyY5Nzll3NhsdwlQQaQkFSnW9ZsAFcR7+SRABdHakgAVxDS/EqCCeI4tASqIRz8nQAVx76YEqCCutzEBKojzZUiACuJ46hOggtgfugSoIAyVgPlZkv7cD4bcHuuN+paEAAAAAElFTkSuQmCC', 300, 15);
  addButtonRightImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAPCAYAAAAlH6X5AAAAFklEQVR42mNgAIFZ6y7+J5f4DwRgQwDjjCkdHruvUwAAAABJRU5ErkJggg==', 1, 15);
  primaryLeftDownImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAYCAYAAADd5VyeAAAAoUlEQVR42m3QyxGCQAyA4b1BrEF7EhQF1ItdiCiC+IA+rMMK6MFKWPNwkouZ+WZ2/5lc4hzO/BC+0Yi8i4pgoEdUhD4+YqAPPeJScFiURsLJcFiejYTKcEguRkJtOKxqI6ExHNZXUBJaUBzSG6j/IbuDkvAAxSF/guKw6UBJ6EHhCcMxx91tL1xSBQOdLvtFl7Yw23fTD63y1Wm89xO0Q68vYCqxvd0FiZEAAAAASUVORK5CYII=', 4, 24);
  primaryLeftImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAYCAYAAADd5VyeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAANpJREFUeNpcj00KwjAQhSdtF2ILKnahVBDBheBC7AVc6lLwHC68iuB5PIF4BkGhpdAW/GutmTFtsLQJPJK8vG8yY4BYu4NzvPnR4pMhY9t97xSEd3c2acPQMUG7erHrTrsw6FvwTEIwcsTuNOCRBJBmkTSAafBK4/wgDU5CWDxJgzgDFCqNr0h8awlxwarBea4KgmpRjqyQgkAVUROo1EAV4SqCNYRkU2VjlM8ixi0Tuq7T85Wwfw3NMltnz/cgS+Vv2ny8XPft0eV9J3hEBEWOiJpi2witfgIMAPG+dHdbWrP4AAAAAElFTkSuQmCC', 4, 24);
  primaryMiddleDownImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAYCAIAAADF1mwTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAFZJREFUeNrslrENACAMwxrEwHm8w9NM7OWIDijIvaCW1TSaa4Tz9NbCGyBkDmC+/w8GhAEMkEIYeHsDwgApVBjzKscfwAAAVAkMVAHOTmsAZXoDXAEGAObOByd02IY9AAAAAElFTkSuQmCC', 64, 24);
  primaryMiddleImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAYCAIAAADF1mwTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAGRJREFUeNpiDKziYBjKgCXUU25oe+Dt59tD2wN//zEMdQ8wjsbAgHrg398hHgN/hnwMDPlM/Hc0E48WoxQmodEYGM0Do0loNAmNVmSjFdloY27gPPDl3f8h7QHG//+HtgcAAgwAS/IwKZoVb9AAAAAASUVORK5CYII=', 64, 24);
  primaryRightDownImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAYCAYAAAAyJzegAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpiDKjk+M8AAecZGRkC1rV+f8TExMTAAMJAYMjHLXIISHOxMDBClDECJT59fSsPZAYzgcRAGMT4/x9skh1cJRLgYmHEFGTAppKBFJUMxJuJLPqfRNuZGBgocydF3oQH8r8/SCr/QwV+fP3PICIk8Rks+PX9f2D8MDIIC0h8bkjYsRcodogRGC9Lobq+AfEZIF4MEGAApHIlce3nptUAAAAASUVORK5CYII=', 5, 24);
  primaryRightImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAYCAYAAAAyJzegAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAALtJREFUeNpiDKzi+P//PwODnKTAeR1Fz4A03/mPmILcZBlsTUUZ3n38YvjgxalDQBVcLB++3WFg42BgUFZkYrh26648AwNDMMvffwxgwM/3j+HPbzDTDijIyAAD/yEUF1wlMmD595cRU/APVpXYBP9i047VImQnIWknWiV22ynUTqrjIQH8H2H7vz8MDD++/mcQEZL4DBb8+v4/AyMTI4OwgMTnhoQde4FihxiBsbcUatQ3ID4DxIsBAgwAZFZZRvJAewsAAAAASUVORK5CYII=', 5, 24);
  regularLeftDownImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAYCAYAAADd5VyeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAG5JREFUeNpiZACCVatW7QdS9kDMyALknAUyjBiggAmZAwIsIIKZmZn6AiwsLHSwBb8AIyMjpQ5jAnL+//z5EywIwkx8fHznb926xfD161cGkAUsXFxcAUxMTJuvXLmiD9f3//9/fiDuB+L/AAEGAAKjH/aC6pVvAAAAAElFTkSuQmCC', 4, 24);
  regularLeftImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAYCAYAAADd5VyeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAIxJREFUeNpiZACCVatW1TMzM1f8/fuXA8Tp27Rp05unT5/+BwGQwJ+3b9/+//fv33+giv8sIC0CAgIMQA4DSAETSICJiQksAFTFAFYBAiBZEIALgGRRBAirGLRacKoAhcdHIAALgDBIYOGxY8f+//jxAxxIIC2NfHx8TlevXtVnQDKQH4j7gPgPQIABAG/sfLduedBMAAAAAElFTkSuQmCC', 4, 24);
  regularMiddleDownImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAYCAIAAADF1mwTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAEdJREFUeNrs1VENADAIA1EY8y8EIdgqc7E0uXPw0o9md4dzJ8yzB9yqAgAAgDPgxQIAAAAAAIAjYwEAAD4BZsYakJKsASvAAByeCFXzdoMOAAAAAElFTkSuQmCC', 64, 24);
  regularMiddleImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAYCAYAAABKtPtEAAAAeklEQVR42u3YAQpFEQBE0dn/VqyJ5PUkEr2IpOYvZP6ts4kLYwyVgeLh3ktlOOdQGfbeVIa1FpVhzkllGGNQGb7vozL03qkMrTUqQ62VylBKoTLknKkMKSUqQ4yRyvC+L5XheR4qQwiByuC9pzI456gM1loqw/8Ki/cDaJtRS5zeSF8AAAAASUVORK5CYII=', 64, 24);
  regularRightDownImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAYCAYAAAAyJzegAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAIhJREFUeNpiXLVq1X8GCDgPxAGhoaGPmBgQwJCNjW0bkBZAFmT49euXFpCqZ2FmZoYL/v37lxFIJaALgigBFEEYIEEQCCjRPrCClDmeCSQIwl+/fkUIgojPnz8z3L17l0FcXPwliM+4evXq/0CV/4WFhV9ZWlpysrKyrmP4jwDvgXg+EPMDBBgAAQA0odlX2ZQAAAAASUVORK5CYII=', 5, 24);
  regularRightImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAYCAYAAAAyJzegAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAKFJREFUeNpiXL169X8gYFBVVWXQ0NCYwcHBUcn49+/f/+/fv2c4c+YMg7i4OIOent50hj9//vwH4SdPnvzfsGHD/3///v1gARIMICAiIsLw+/dvBkZGRna4IDJgAVmCIUihygHRDlNAf29+/vwZIQiMCoavX78yPHz4EBxHYMGLFy8yMDMzMwgJCf02MzP7DbRjA8jBf6D4DRDPA2I+gAADADHFiGWTyABuAAAAAElFTkSuQmCC', 5, 24);
  systemButtonLeftImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAARCAYAAAD66g1WAAAAqklEQVR42kXPOw6CQBSF4dmIrpLSXZhgZeMjGlegYLRCGxoTtbAQnyAYQJBRgsEj3JjLSb5i/uQWI9amXtfGTbvfVVAS+kR157M2kiQA8IXodRRIGdKjHIVyef5Blr2qkL7jQlQFKX3C4RnfCIdHeCYcAt8iHO7ejnBwnQ3hYF9XhMPlZBIxGjYQRR6O1pKIhTHAVGvBsbc47A2INE0sXVPB3y/Oa4UY//0AL7Hrah6M1lMAAAAASUVORK5CYII=', 4, 17);
  systemButtonMiddleImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAARCAYAAAAcw8YSAAAAUUlEQVR42j3MNwqAQAAF0Tm0NxJPYmFjY2EjyGJOrBEDNl9BcIpXDp7rCL193PchrnMR+27FtrZingoxWiOGPhFdE4u6ikSZhyIzgTCpL/7VA1/HPdEqXmMtAAAAAElFTkSuQmCC', 1, 17);
  systemButtonRightImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAARCAYAAAD66g1WAAAAu0lEQVR42j3PywqCUBSF4fMi9ZLZtGeIIJoEQdmg5oUlFY1q0CSwSSGWXdTuJZJ5YeU+wd7wTz6OwhJqU0G7pUDrlR+GoecFsvP9K/RBFeNR3ZJA5zobdDsliCj6IE0TJEmcfVqECD8vfMO3fCUhCG6gGPy3C4rh+diDYrjfLFAMl/MaFIPnrEAxnI5LUAwHewEqjr9yk9hZMwmea/7B3s6zn5rQ+hVMJw0Imq82C9CHNYRh4PHa7GhQ7geq2usqcnGsvgAAAABJRU5ErkJggg==', 4, 17);
  systemLeftDownImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAARCAYAAAD66g1WAAAAp0lEQVR42j3PQQqCYBCG4blBN+iStWgpLSK6QLuIENHfwlSksN9ERETEEhGrC9SqpcuYdJAZeDYvfIsBx1mOhaG81d0Ee2Aaymcv5ij9DYaBitDXq9xiFGqEQhzpjEISC0YhTUxGIUsPjEKeWYxCkduMwr1wGYWq9BiFujoxCk19ZqBrMyxvFj4bn0Ag1z/nuOj2Nr4eF4S2/QrPXXWvTwkg4qgT4nB/AzvToXfhHV0AAAAASUVORK5CYII=', 4, 17);
  systemMiddleDownImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAARCAIAAACToVFFAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACVJREFUeNpiWrKomEla2pAJFTAyoQNmZgw5ZnMzMYb///8DBBgAo0sGEHNRN7AAAAAASUVORK5CYII=', 1, 17);
  systemRightDownImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAARCAYAAAD66g1WAAAAtUlEQVR42kXPywqCQBTG8XmD3qCXLGgVQW2iXcsWbcrES1dFvFSYiYiIFCIiQa9QK9dfzsihgd/mfzgHhkmrHjhVGX4NY9pl/lXC2V1CV0fYauM3C3wZnOcsIEsDsDBQwN1vcrPaB4tCDUSEONJBREjiHYgIaXIAESFLTyAiPDITZLNuQv60QEQochtEhLJwwBW51d6oSg9cmqhteFWXZmriuJ/Atedg9H3LnKGuPw7D//mNzg9T79N74ndBYQAAAABJRU5ErkJggg==', 4, 17);
}

var addButtonLeftImage = null, addButtonMiddleImage = null, addButtonRightImage = null, primaryLeftDownImage = null, primaryLeftImage = null, primaryMiddleDownImage = null, primaryMiddleImage = null, primaryRightDownImage = null, primaryRightImage = null, regularLeftDownImage = null, regularLeftImage = null, regularMiddleDownImage = null, regularMiddleImage = null, regularRightDownImage = null, regularRightImage = null, systemButtonLeftImage = null, systemButtonMiddleImage = null, systemButtonRightImage = null, systemLeftDownImage = null, systemMiddleDownImage = null, systemRightDownImage = null;
function $hide_0(this$static){
  var l_0, l$iterator;
  $hide(this$static.popupPanel, false);
  this$static.showing = false;
  for (l$iterator = new AbstractList$IteratorImpl_0(this$static.listeners); l$iterator.i < l$iterator.this$0_0.size_0();) {
    l_0 = dynamicCast($next_6(l$iterator), 212);
    l_0.onHide(this$static);
  }
}

function $move_0(this$static){
  this$static.positioner.setPopupPositionAndMakeVisible(this$static.reference, this$static.popupPanel.element_0);
}

function $show_0(this$static){
  var l_0, l$iterator;
  $show(this$static.popupPanel);
  this$static.showing = true;
  this$static.positioner.setPopupPositionAndMakeVisible(this$static.reference, this$static.popupPanel.element_0);
  for (l$iterator = new AbstractList$IteratorImpl_0(this$static.listeners); l$iterator.i < l$iterator.this$0_0.size_0();) {
    l_0 = dynamicCast($next_6(l$iterator), 212);
    l_0.onShow(this$static);
  }
}

function Popup_0(positioner){
  this.popupPanel = new PopupPanel_1;
  this.listeners = new ArrayList_0;
  this.reference = null;
  this.positioner = positioner;
  setStyleName_0(this.popupPanel.getStyleElement(), 'editor-popup', true);
  this.popupPanel.isAnimationEnabled = true;
  $addHandler_1(this.popupPanel, new Popup$2_0(this), TYPE_11?TYPE_11:(TYPE_11 = new GwtEvent$Type_0));
}

function Popup(){
}

_ = Popup_0.prototype = Popup.prototype = new Object_0;
_.getClass$ = function getClass_686(){
  return Lorg_waveprotocol_wave_client_widget_popup_simple_Popup_2_classLit;
}
;
_.castableTypeMap$ = {};
_.positioner = null;
_.reference = null;
_.showing = false;
function Popup$2_0(this$0){
  this.this$0 = this$0;
}

function Popup$2(){
}

_ = Popup$2_0.prototype = Popup$2.prototype = new Object_0;
_.getClass$ = function getClass_687(){
  return Lorg_waveprotocol_wave_client_widget_popup_simple_Popup$2_2_classLit;
}
;
_.onClose = function onClose_2(event_0){
  $hide_0(this.this$0);
}
;
_.castableTypeMap$ = {20:1, 25:1};
_.this$0 = null;
function $clinit_1054(){
  $clinit_1054 = nullMethod;
  $clinit_1056();
}

function $setValue_4(this$static){
  this$static.currentProgress = 0;
  this$static.bar.style['width'] = this$static.currentProgress * 100 + ($clinit_68() , '%');
  this$static.groove.style['width'] = (1 - this$static.currentProgress) * 100 + '%';
}

function ProgressWidget_0(){
  $clinit_1054();
  this.element = $doc.createElement('div');
  this.bar = $doc.createElement('div');
  this.groove = $doc.createElement('div');
  $ensureInjected(($clinit_1056() , css_12));
  this.bar.className = 'GMQ4-KSBCO';
  this.groove.className = 'GMQ4-KSBDO';
  this.element.appendChild(this.bar);
  this.element.appendChild(this.groove);
  this.element_0 = this.element;
  $setValue_4(this);
}

function ProgressWidget(){
}

_ = ProgressWidget_0.prototype = ProgressWidget.prototype = new Widget;
_.getClass$ = function getClass_688(){
  return Lorg_waveprotocol_wave_client_widget_progress_ProgressWidget_2_classLit;
}
;
_.castableTypeMap$ = {35:1, 36:1, 38:1, 50:1, 51:1, 55:1};
_.currentProgress = 0;
function $clinit_1056(){
  $clinit_1056 = nullMethod;
  css_12 = new ProgressWidget_ProgressResources_en_InlineClientBundleGenerator$3_0;
}

var css_12 = null;
function $ensureInjected(this$static){
  if (!this$static.injected) {
    this$static.injected = true;
    $clinit_81();
    $push_0(toInject, ($clinit_176() , ".GMQ4-KSBDO{position:absolute;right:0;height:5px;bottom:0;background:url('data:image/gif;base64,R0lGODlhAQAFAKIAALu7u8LCwtbW1t3d3czMzAAAAAAAAAAAACH5BAAAAAAALAAAAAABAAUAAAMECEEyCQA7') repeat-x;}.GMQ4-KSBCO{position:absolute;left:0;height:5px;bottom:0;background:url('data:image/gif;base64,R0lGODlhAQAFAKIAAHSxDGqhC2+pC2WZCnm5DQAAAAAAAAAAACH5BAAAAAAALAAAAAABAAUAAAMESCAxCQA7') repeat-x;}"));
    schedule();
    return true;
  }
  return false;
}

function ProgressWidget_ProgressResources_en_InlineClientBundleGenerator$3_0(){
}

function ProgressWidget_ProgressResources_en_InlineClientBundleGenerator$3(){
}

_ = ProgressWidget_ProgressResources_en_InlineClientBundleGenerator$3_0.prototype = ProgressWidget_ProgressResources_en_InlineClientBundleGenerator$3.prototype = new Object_0;
_.getClass$ = function getClass_689(){
  return Lorg_waveprotocol_wave_client_widget_progress_ProgressWidget_1ProgressResources_1en_1InlineClientBundleGenerator$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.injected = false;
function $clinit_1058(){
  $clinit_1058 = nullMethod;
  FATAL = new AbstractLogger$Level_0('FATAL', 0, 'fatal', 0);
  ERROR = new AbstractLogger$Level_0('ERROR', 1, 'error', 1);
  TRACE = new AbstractLogger$Level_0('TRACE', 2, 'trace', 2);
  $VALUES_40 = initValues(_3Lorg_waveprotocol_wave_common_logging_AbstractLogger$Level_2_classLit, {58:1, 138:1}, 103, [FATAL, ERROR, TRACE]);
}

function AbstractLogger$Level_0(enum$name, enum$ordinal, string, value){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
  this.string = string;
  this.value_0 = value;
}

function values_41(){
  $clinit_1058();
  return $VALUES_40;
}

function AbstractLogger$Level(){
}

_ = AbstractLogger$Level_0.prototype = AbstractLogger$Level.prototype = new Enum;
_.getClass$ = function getClass_690(){
  return Lorg_waveprotocol_wave_common_logging_AbstractLogger$Level_2_classLit;
}
;
_.toString$ = function toString_54(){
  return this.string;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 103:1};
_.string = null;
_.value_0 = 0;
var $VALUES_40, ERROR, FATAL, TRACE;
function $log_0(this$static, msg){
  this$static.this$0.handleClientErrors(this$static.level, null, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, [msg]));
  this$static.this$0.shouldLog(this$static.level) && (this$static.this$0.sink.lazyLog(this$static.level, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, [msg])) , undefined);
}

function $log_1(this$static, messages){
  this$static.this$0.handleClientErrors(this$static.level, null, messages);
  this$static.this$0.shouldLog(this$static.level) && (this$static.this$0.sink.lazyLog(this$static.level, messages) , undefined);
}

function $log_2(this$static, label, o){
  this$static.this$0.handleClientErrors(this$static.level, null, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, [label, o]));
  this$static.this$0.shouldLog(this$static.level) && (this$static.this$0.sink.lazyLog(this$static.level, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, [label.length > 0?label + ': ':'', "<span class='object'>" + $replaceAll($replaceAll($replaceAll($replaceAll($replaceAll('' + o, '&', '&amp;'), '<', '&lt;'), '>', '&gt;'), '"', '&quot;'), "'", '&#39;') + '<\/span>'])) , undefined);
}

function $log_3(this$static, t){
  this$static.this$0.handleClientErrors(this$static.level, t, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, [t.getMessage()]));
  this$static.this$0.shouldLog(this$static.level) && this$static.this$0.sink.lazyLog(this$static.level, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, [t.toString$(), ': ', new LogSink$1_0(t)]));
}

function $log_4(this$static, label, t){
  this$static.this$0.handleClientErrors(this$static.level, t, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, [label]));
  this$static.this$0.shouldLog(this$static.level) && this$static.this$0.sink.lazyLog(this$static.level, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, [label, ': ', new LogSink$1_0(t)]));
}

function $logLazyObjects(this$static, objects){
  this$static.this$0.handleClientErrors(this$static.level, null, objects);
  this$static.this$0.shouldLog(this$static.level) && (this$static.this$0.sink.lazyLog(this$static.level, objects) , undefined);
}

function $logPlainText(this$static, msg){
  this$static.this$0.handleClientErrors(this$static.level, null, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, [msg]));
  this$static.this$0.shouldLog(this$static.level) && this$static.this$0.logPlainTextInner(this$static.level, msg);
}

function $logPlainText_0(this$static, msg, t){
  this$static.this$0.handleClientErrors(this$static.level, t, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, [msg]));
  this$static.this$0.shouldLog(this$static.level) && this$static.this$0.logPlainTextInner(this$static.level, msg + t.toString$());
}

function $logXml(this$static, xml){
  this$static.this$0.handleClientErrors(this$static.level, null, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, [xml]));
  this$static.this$0.shouldLog(this$static.level) && (this$static.this$0.sink.lazyLog(this$static.level, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, [$replaceAll($replaceAll($replaceAll($replaceAll($replaceAll(xml, '&', '&amp;'), '<', '&lt;'), '>', '&gt;'), '"', '&quot;'), "'", '&#39;')])) , undefined);
}

function $shouldLog_0(this$static){
  return this$static.this$0.shouldLog(this$static.level);
}

function AbstractLogger$LevelLogger_0(this$0, level){
  this.this$0 = this$0;
  this.level = level;
}

function AbstractLogger$LevelLogger(){
}

_ = AbstractLogger$LevelLogger_0.prototype = AbstractLogger$LevelLogger.prototype = new Object_0;
_.getClass$ = function getClass_691(){
  return Lorg_waveprotocol_wave_common_logging_AbstractLogger$LevelLogger_2_classLit;
}
;
_.castableTypeMap$ = {};
_.level = null;
_.this$0 = null;
function $add_17(this$static, e){
  $addLast(this$static.data_0, e);
  this$static.data_0.size > this$static.maxSize && $removeFirst(this$static.data_0);
}

function CircularBuffer_0(){
  this.data_0 = new LinkedList_0;
  this.maxSize = 2000;
}

function CircularBuffer(){
}

_ = CircularBuffer_0.prototype = CircularBuffer.prototype = new Object_0;
_.getClass$ = function getClass_692(){
  return Lorg_waveprotocol_wave_common_logging_CircularBuffer_2_classLit;
}
;
_.iterator_0 = function iterator_18(){
  return $listIterator_2(this.data_0, 0);
}
;
_.castableTypeMap$ = {};
_.data_0 = null;
_.maxSize = 0;
function $lazyLog_1(this$static, level, messages){
  var s, s$iterator, outerIter, entry;
  $add_17(this$static.buffer, messages);
  if (this$static.sinks.map.size_0() != 0) {
    for (s$iterator = (outerIter = $keySet(this$static.sinks.map).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter)); s$iterator.val$outerIter.hasNext();) {
      s = dynamicCast((entry = dynamicCast(s$iterator.val$outerIter.next_0(), 66) , entry.getKey()), 213);
      s.lazyLog(level, messages);
    }
  }
}

function $showAll(this$static){
  var o, o$iterator, ret;
  ret = new ArrayList_2(this$static.buffer.data_0.size);
  for (o$iterator = $listIterator_2(this$static.buffer.data_0, 0); o$iterator.currentNode != o$iterator.this$0.header;) {
    o = $next_9(o$iterator);
    $add_9(ret, stringifyLogObject(o));
  }
  return ret;
}

function InMemoryLogSink_0(){
  this.buffer = new CircularBuffer_0;
  this.sinks = new HashSet_0;
}

function InMemoryLogSink(){
}

_ = InMemoryLogSink_0.prototype = InMemoryLogSink.prototype = new LogSink;
_.getClass$ = function getClass_693(){
  return Lorg_waveprotocol_wave_common_logging_InMemoryLogSink_2_classLit;
}
;
_.lazyLog = function lazyLog_2(level, messages){
  $lazyLog_1(this, level, messages);
}
;
_.castableTypeMap$ = {213:1};
function LogSink$1_0(val$t){
  this.val$t = val$t;
}

function LogSink$1(){
}

_ = LogSink$1_0.prototype = LogSink$1.prototype = new Object_0;
_.getClass$ = function getClass_694(){
  return Lorg_waveprotocol_wave_common_logging_LogSink$1_2_classLit;
}
;
_.toString$ = function toString_55(){
  return $replaceAll($replaceAll($replaceAll($replaceAll($replaceAll(this.val$t.toString$(), '&', '&amp;'), '<', '&lt;'), '>', '&gt;'), '"', '&quot;'), "'", '&#39;') + '<br/>' + printStackTraceAsHtml(this.val$t);
}
;
_.castableTypeMap$ = {};
_.val$t = null;
function printStackTraceAsHtml(t){
  var i, sb, stes;
  stes = $getStackTrace(t);
  sb = new StringBuilder_0;
  for (i = 0; i < stes.length && i <= 12; ++i) {
    $append_8($append_8($append_8($append_6($append_8($append_8((sb.impl.string += '&nbsp;&nbsp;&nbsp;&nbsp;' , sb), stes[i].className_0), ':'), stes[i].lineNumber), ': '), stes[i].methodName), '<br/>');
  }
  12 < stes.length - 1 && (sb.impl.string += '&nbsp;&nbsp;&nbsp;&nbsp;...<br/>' , sb);
  return sb.impl.string;
}

function stringifyLogObject(o){
  var builder, object, object$index, object$max, objects;
  if (o != null && o.castableTypeMap$ && !!o.castableTypeMap$[138]) {
    builder = new StringBuilder_0;
    objects = dynamicCast(o, 138);
    for (object$index = 0 , object$max = objects.length; object$index < object$max; ++object$index) {
      object = objects[object$index];
      $append_8(builder, toString__devirtual$(object));
    }
    return builder.impl.string;
  }
   else {
    return toString__devirtual$(o);
  }
}

function $clinit_1070(){
  $clinit_1070 = nullMethod;
  new AnnotationBehaviour$1_0(($clinit_1072() , META_0));
}

function AnnotationBehaviour$1_0($anonymous0){
  this.family = $anonymous0;
}

function AnnotationBehaviour$1(){
}

_ = AnnotationBehaviour$1_0.prototype = AnnotationBehaviour$1.prototype = new AnnotationBehaviour$DefaultAnnotationBehaviour;
_.getClass$ = function getClass_695(){
  return Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$1_2_classLit;
}
;
_.replace_0 = function replace_1(inside, outside, type){
  return $clinit_1076() , NEITHER_0;
}
;
_.castableTypeMap$ = {247:1};
function $clinit_1072(){
  $clinit_1072 = nullMethod;
  CONTENT = new AnnotationBehaviour$AnnotationFamily_0('CONTENT', 0);
  META_0 = new AnnotationBehaviour$AnnotationFamily_0('META', 1);
  $VALUES_41 = initValues(_3Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$AnnotationFamily_2_classLit, {58:1, 138:1}, 104, [CONTENT, META_0]);
}

function AnnotationBehaviour$AnnotationFamily_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_42(){
  $clinit_1072();
  return $VALUES_41;
}

function AnnotationBehaviour$AnnotationFamily(){
}

_ = AnnotationBehaviour$AnnotationFamily_0.prototype = AnnotationBehaviour$AnnotationFamily.prototype = new Enum;
_.getClass$ = function getClass_696(){
  return Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$AnnotationFamily_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 104:1};
var $VALUES_41, CONTENT, META_0;
function $clinit_1073(){
  $clinit_1073 = nullMethod;
  LEFT_3 = new AnnotationBehaviour$BiasDirection_0('LEFT', 0);
  RIGHT_3 = new AnnotationBehaviour$BiasDirection_0('RIGHT', 1);
  NEITHER = new AnnotationBehaviour$BiasDirection_0('NEITHER', 2);
  $VALUES_42 = initValues(_3Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$BiasDirection_2_classLit, {58:1, 138:1}, 105, [LEFT_3, RIGHT_3, NEITHER]);
}

function AnnotationBehaviour$BiasDirection_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_43(){
  $clinit_1073();
  return $VALUES_42;
}

function AnnotationBehaviour$BiasDirection(){
}

_ = AnnotationBehaviour$BiasDirection_0.prototype = AnnotationBehaviour$BiasDirection.prototype = new Enum;
_.getClass$ = function getClass_697(){
  return Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$BiasDirection_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 105:1};
var $VALUES_42, LEFT_3, NEITHER, RIGHT_3;
function $clinit_1074(){
  $clinit_1074 = nullMethod;
  PLAIN_TEXT = new AnnotationBehaviour$ContentType_0('PLAIN_TEXT', 0);
  RICH_TEXT = new AnnotationBehaviour$ContentType_0('RICH_TEXT', 1);
  $VALUES_43 = initValues(_3Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$ContentType_2_classLit, {58:1, 138:1}, 106, [PLAIN_TEXT, RICH_TEXT]);
}

function AnnotationBehaviour$ContentType_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_44(){
  $clinit_1074();
  return $VALUES_43;
}

function AnnotationBehaviour$ContentType(){
}

_ = AnnotationBehaviour$ContentType_0.prototype = AnnotationBehaviour$ContentType.prototype = new Enum;
_.getClass$ = function getClass_698(){
  return Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$ContentType_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 106:1};
var $VALUES_43, PLAIN_TEXT, RICH_TEXT;
function $clinit_1075(){
  $clinit_1075 = nullMethod;
  FROM_LEFT = new AnnotationBehaviour$CursorDirection_0('FROM_LEFT', 0);
  FROM_RIGHT = new AnnotationBehaviour$CursorDirection_0('FROM_RIGHT', 1);
  NEUTRAL_0 = new AnnotationBehaviour$CursorDirection_0('NEUTRAL', 2);
  $VALUES_44 = initValues(_3Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$CursorDirection_2_classLit, {58:1, 138:1}, 107, [FROM_LEFT, FROM_RIGHT, NEUTRAL_0]);
}

function AnnotationBehaviour$CursorDirection_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function toBiasDirection(cursor){
  $clinit_1075();
  switch (cursor.ordinal) {
    case 0:
      return $clinit_1073() , LEFT_3;
    case 1:
      return $clinit_1073() , RIGHT_3;
  }
  return $clinit_1073() , NEITHER;
}

function values_45(){
  $clinit_1075();
  return $VALUES_44;
}

function AnnotationBehaviour$CursorDirection(){
}

_ = AnnotationBehaviour$CursorDirection_0.prototype = AnnotationBehaviour$CursorDirection.prototype = new Enum;
_.getClass$ = function getClass_699(){
  return Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$CursorDirection_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 107:1};
var $VALUES_44, FROM_LEFT, FROM_RIGHT, NEUTRAL_0;
function $clinit_1076(){
  $clinit_1076 = nullMethod;
  INSIDE = new AnnotationBehaviour$InheritDirection_0('INSIDE', 0);
  OUTSIDE = new AnnotationBehaviour$InheritDirection_0('OUTSIDE', 1);
  NEITHER_0 = new AnnotationBehaviour$InheritDirection_0('NEITHER', 2);
  $VALUES_45 = initValues(_3Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$InheritDirection_2_classLit, {58:1, 138:1}, 108, [INSIDE, OUTSIDE, NEITHER_0]);
}

function AnnotationBehaviour$InheritDirection_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_46(){
  $clinit_1076();
  return $VALUES_45;
}

function AnnotationBehaviour$InheritDirection(){
}

_ = AnnotationBehaviour$InheritDirection_0.prototype = AnnotationBehaviour$InheritDirection.prototype = new Enum;
_.getClass$ = function getClass_700(){
  return Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$InheritDirection_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 108:1};
var $VALUES_45, INSIDE, NEITHER_0, OUTSIDE;
function $apply_9(openAnnotation){
  throw new IllegalStateException_1('finish() called while annotations are still open: ' + openAnnotation);
}

function AnnotationTree$1_0(){
}

function AnnotationTree$1(){
}

_ = AnnotationTree$1_0.prototype = AnnotationTree$1.prototype = new Object_0;
_.apply_0 = function apply_28(key, openAnnotation){
  $apply_9(dynamicCast(openAnnotation, 215));
}
;
_.getClass$ = function getClass_701(){
  return Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function AnnotationTree$2_0(this$0, val$start, val$end){
  this.this$0 = this$0;
  this.val$start = val$start;
  this.val$end = val$end;
}

function AnnotationTree$2(){
}

_ = AnnotationTree$2_0.prototype = AnnotationTree$2.prototype = new Object_0;
_.apply_0 = function apply_29(key, value){
  $containsKey_5(this.this$0.openAnnotations, key) || $setAnnotation_2(this.this$0.tree, this.val$start, this.val$end, key, value);
}
;
_.getClass$ = function getClass_702(){
  return Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$end = 0;
_.val$start = 0;
--></script>
<script><!--
function AnnotationTree$3_0(this$0, val$start, val$end){
  this.this$0 = this$0;
  this.val$start = val$start;
  this.val$end = val$end;
}

function AnnotationTree$3(){
}

_ = AnnotationTree$3_0.prototype = AnnotationTree$3.prototype = new Object_0;
_.apply_3 = function apply_30(key){
  !$containsKey_5(this.this$0.inheritedAnnotationsForInsertion, key) && !$containsKey_5(this.this$0.openAnnotations, key) && $setAnnotation_2(this.this$0.tree, this.val$start, this.val$end, key, null);
}
;
_.getClass$ = function getClass_703(){
  return Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$end = 0;
_.val$start = 0;
function AnnotationTree$Notification_0(this$0, start, end, key, value){
  this.this$0 = this$0;
  this.start = start;
  this.end = end;
  this.key = key;
  this.value_0 = value;
}

function AnnotationTree$Notification(){
}

_ = AnnotationTree$Notification_0.prototype = AnnotationTree$Notification.prototype = new Object_0;
_.getClass$ = function getClass_704(){
  return Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree$Notification_2_classLit;
}
;
_.toString$ = function toString_56(){
  return 'Notification(' + this.start + '-' + this.end + ' ' + this.key + '=' + this.value_0 + ')';
}
;
_.castableTypeMap$ = {214:1};
_.end = 0;
_.key = null;
_.start = 0;
_.this$0 = null;
_.value_0 = null;
function AnnotationTree$OpenAnnotation_0(start, key, value){
  this.start = start;
  this.key = key;
  this.value_0 = value;
}

function AnnotationTree$OpenAnnotation(){
}

_ = AnnotationTree$OpenAnnotation_0.prototype = AnnotationTree$OpenAnnotation.prototype = new Object_0;
_.getClass$ = function getClass_705(){
  return Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree$OpenAnnotation_2_classLit;
}
;
_.toString$ = function toString_57(){
  return 'PendingAnnotation(' + this.start + ', ' + this.key + ', ' + this.value_0 + ')';
}
;
_.castableTypeMap$ = {215:1};
_.key = null;
_.start = 0;
_.value_0 = null;
function $cleanupKnownKeys(this$static){
  $filter(this$static.knownKeys, new BasicAnnotationTree$3_0(this$static));
}

function $cleanupLeavesThatHaveBecomeEmpty(this$static){
  var leaf, leaf$iterator, mine, originalParent;
  while (this$static.leavesThatHaveBecomeEmpty.size != 0) {
    mine = this$static.leavesThatHaveBecomeEmpty;
    this$static.leavesThatHaveBecomeEmpty = new ArrayList_0;
    for (leaf$iterator = new AbstractList$IteratorImpl_0(mine); leaf$iterator.i < leaf$iterator.this$0_0.size_0();) {
      leaf = dynamicCast($next_6(leaf$iterator), 216);
      $tryToPropagateFromDyingSubtree(leaf);
      originalParent = leaf.parent_0;
      $tryToCollapse(originalParent);
    }
  }
}

function $collectAllAnnotationsAtRaw(this$static, index, accu){
  var leftLength, node, nodeStart;
  node = this$static.sentinel.left_0;
  nodeStart = 0;
  while (true) {
    accu.backend.putAll(dynamicCast(node.localMap, 265).backend);
    if (node.type_0 == ($clinit_1104() , LEAF_BLACK)) {
      break;
    }
    leftLength = node.left_0.subtreeLength;
    if (index < nodeStart + leftLength) {
      node = node.left_0;
    }
     else {
      node = node.right;
      nodeStart += leftLength;
    }
  }
}

function $delete(this$static, start, end){
  if (start >= end) {
    return;
  }
  $deleteRaw(this$static, start + 1, end + 1);
  $cleanupLeavesThatHaveBecomeEmpty(this$static);
}

function $deleteRaw(this$static, start, end){
  var deletionEnd, deletionLength, deletionStart, node, nodeEnd, nodeStart;
  node = this$static.sentinel.left_0;
  nodeStart = 0;
  outer: while (true) {
    if (end <= nodeStart) {
      return;
    }
    nodeEnd = nodeStart + node.subtreeLength;
    deletionStart = nodeStart > start?nodeStart:start;
    deletionEnd = nodeEnd < end?nodeEnd:end;
    deletionLength = deletionEnd - deletionStart;
    node.subtreeLength -= deletionLength;
    if (node.type_0 == ($clinit_1104() , LEAF_BLACK)) {
      end -= deletionLength;
      node.subtreeLength == 0 && $add_9(this$static.leavesThatHaveBecomeEmpty, node);
    }
     else {
      if (start < nodeStart + node.left_0.subtreeLength) {
        node = node.left_0;
      }
       else {
        nodeStart += node.left_0.subtreeLength;
        node = node.right;
      }
      continue outer;
    }
    while (true) {
      if (node.parent_0.left_0 == node) {
        nodeStart += node.subtreeLength;
        node = node.parent_0.right;
        continue outer;
      }
      nodeStart -= node.parent_0.left_0.subtreeLength;
      node = node.parent_0;
      if (node.parent_0 == node.this$0.sentinel) {
        return;
      }
    }
  }
}

function $differentValue(this$static, notThis, notThat){
  if (!equals__devirtual$(this$static.oneValue, notThis) && !equals__devirtual$(this$static.oneValue, notThat)) {
    return this$static.oneValue;
  }
  if (!equals__devirtual$(this$static.anotherValue, notThis) && !equals__devirtual$(this$static.anotherValue, notThat)) {
    return this$static.anotherValue;
  }
  return null;
}

function $firstAnnotationChange_4(this$static, start, end, key, fromValue){
  var pos;
  if (start >= end) {
    return -1;
  }
  if (!$contains_7(this$static.knownKeys, key)) {
    return fromValue == null?-1:start;
  }
  pos = $firstAnnotationChangeRaw(this$static, start + 1, end + 1, key, fromValue);
  if (pos == -1) {
    return -1;
  }
  return pos - 1;
}

function $firstAnnotationChangeRaw(this$static, start, end, key, fromValue){
  var leftNode, node, nodeStart, valueHere, out;
  node = this$static.sentinel.left_0;
  nodeStart = 0;
  outer: while (true) {
    if (nodeStart >= end) {
      return -1;
    }
    if (node.localMap.containsKey_0(key)) {
      valueHere = node.localMap.getExisting(key);
      if (!(valueHere == null?fromValue == null:equals__devirtual$(valueHere, fromValue))) {
        return nodeStart > start?nodeStart:start;
      }
      if (node.parent_0 == node.this$0.sentinel) {
        return -1;
      }
      while (true) {
        if (node.parent_0.left_0 == node) {
          nodeStart += node.subtreeLength;
          node = node.parent_0.right;
          continue outer;
        }
        nodeStart -= node.parent_0.left_0.subtreeLength;
        node = node.parent_0;
        if (node.parent_0 == node.this$0.sentinel) {
          return -1;
        }
      }
    }
    leftNode = node.left_0;
    if (!leftNode) {
      throw new NullPointerException_1('Unexpected null leftNode:\n' + (out = new StringBuilder_0 , $append_8(out, 'AnnotationTree, length ' + (this$static.sentinel.left_0.subtreeLength - 1) + ', sentinel=' + this$static.sentinel + ':\n') , $printForDebugging(this$static.sentinel.left_0, out) , $charAt_0(out, out.impl.string.length - 1) == 10 && $setLength_0(out, out.impl.string.length - 1) , out.impl.string));
    }
    if (start >= nodeStart + leftNode.subtreeLength) {
      nodeStart += leftNode.subtreeLength;
      node = node.right;
    }
     else {
      node = node.left_0;
    }
  }
}

function $fixupMapsAfterSingleRotation(a_0, b, c, d, e){
  var a0, a1, b0, c0, d0, e0;
  a0 = a_0.localMap;
  b0 = b.localMap;
  c0 = c.localMap;
  d0 = d.localMap;
  e0 = e.localMap;
  a1 = ($clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  d0.filter_0(new BasicAnnotationTree$1_0(b0, a1));
  c0.each(new BasicAnnotationTree$2_0(b0, a1, d0, e0));
  a_0.localMap = a1;
  c.localMap = a0;
}

function $forEachAnnotationAtRaw(this$static, index, callback){
  var leftLength, node, nodeStart;
  node = this$static.sentinel.left_0;
  nodeStart = 0;
  while (true) {
    node.localMap.each(callback);
    if (node.type_0 == ($clinit_1104() , LEAF_BLACK)) {
      break;
    }
    leftLength = node.left_0.subtreeLength;
    if (index < nodeStart + leftLength) {
      node = node.left_0;
    }
     else {
      node = node.right;
      nodeStart += leftLength;
    }
  }
}

function $getAnnotation_5(this$static, index, key){
  if (!$contains_7(this$static.knownKeys, key)) {
    return null;
  }
  return $getAnnotationRaw(this$static, index + 1, key);
}

function $getAnnotationRaw(this$static, index, key){
  var leftLength, node;
  node = this$static.sentinel.left_0;
  while (true) {
    if (node.localMap.containsKey_0(key)) {
      return node.localMap.getExisting(key);
    }
    leftLength = node.left_0.subtreeLength;
    if (index < leftLength) {
      node = node.left_0;
    }
     else {
      index -= leftLength;
      node = node.right;
    }
  }
}

function $insertRaw(this$static, firstShiftedIndex, length_0){
  var node, nodeStart;
  node = this$static.sentinel.left_0;
  nodeStart = 0;
  while (true) {
    node.subtreeLength += length_0;
    if (node.type_0 == ($clinit_1104() , LEAF_BLACK)) {
      return;
    }
    if (firstShiftedIndex <= nodeStart + node.left_0.subtreeLength) {
      node = node.left_0;
    }
     else {
      nodeStart += node.left_0.subtreeLength;
      node = node.right;
    }
  }
}

function $lastAnnotationChange_4(this$static, start, end, key, fromValue){
  var pos;
  if (start >= end) {
    return -1;
  }
  if (!$contains_7(this$static.knownKeys, key)) {
    return fromValue == null?-1:end;
  }
  pos = $lastAnnotationChangeRaw(this$static, start + 1, end + 1, key, fromValue);
  if (pos == -1) {
    return -1;
  }
  return pos - 1;
}

function $lastAnnotationChangeRaw(this$static, start, end, key, fromValue){
  var node, nodeEnd, rightNode, valueHere;
  node = this$static.sentinel.left_0;
  nodeEnd = node.subtreeLength;
  outer: while (true) {
    if (nodeEnd <= start) {
      return -1;
    }
    if (node.localMap.containsKey_0(key)) {
      valueHere = node.localMap.getExisting(key);
      if (!(valueHere == null?fromValue == null:equals__devirtual$(valueHere, fromValue))) {
        return nodeEnd < end?nodeEnd:end;
      }
      if (node.parent_0 == node.this$0.sentinel) {
        return -1;
      }
      while (true) {
        if (node.parent_0.left_0 != node) {
          nodeEnd -= node.subtreeLength;
          node = node.parent_0.left_0;
          continue outer;
        }
        nodeEnd += node.parent_0.right.subtreeLength;
        node = node.parent_0;
        if (node.parent_0 == node.this$0.sentinel) {
          return -1;
        }
      }
    }
    rightNode = node.right;
    if (end <= nodeEnd - rightNode.subtreeLength) {
      nodeEnd -= rightNode.subtreeLength;
      node = node.left_0;
    }
     else {
      node = node.right;
    }
  }
}

function $mapToString(map){
  var buf, first;
  buf = new StringBuilder_2('{');
  first = initValues(_3Z_classLit, {58:1}, -1, [true]);
  map.each(new BasicAnnotationTree$6_0(first, buf));
  buf.impl.string += '}';
  return buf.impl.string;
}

function $setAnnotation_2(this$static, start, end, key, value){
  var currentStart, end1;
  if (start >= end) {
    return;
  }
  if (!$contains_7(this$static.knownKeys, key)) {
    this$static.sentinel.left_0.localMap.put_0(key, null);
    $add_20(this$static.knownKeys, key);
  }
  currentStart = start + 1;
  end1 = end + 1;
  do {
    currentStart = $setAnnotationRaw(this$static, currentStart, end1, key, value);
  }
   while (currentStart != -1);
  $cleanupLeavesThatHaveBecomeEmpty(this$static);
}

function $setAnnotationRaw(this$static, start, end, key, value){
  var leafResult, node, nodeEnd, nodeStart;
  node = this$static.sentinel.left_0;
  nodeStart = 0;
  outer: while (true) {
    if (end <= nodeStart) {
      return -1;
    }
    if (!(node.localMap.containsKey_0(key) && equal_0(node.localMap.getExisting(key), value))) {
      nodeEnd = nodeStart + node.subtreeLength;
      if (start <= nodeStart && end >= nodeEnd) {
        $eraseAnnotations(node, nodeStart, key);
        node.localMap.put_0(key, value);
        if ($tryToPropagateFromChildren(node.parent_0, key)) {
          return nodeStart + node.subtreeLength;
        }
      }
       else {
        if (node.type_0 == ($clinit_1104() , LEAF_BLACK)) {
          leafResult = $setAnnotationForLeaf(node, nodeStart, start - nodeStart, end - nodeStart, key, value);
          if (leafResult == -1)
          ;
          else {
            return leafResult;
          }
        }
         else {
          node.localMap.containsKey_0(key) && $pushKeyIntoChildren(node, key);
          if (start < nodeStart + node.left_0.subtreeLength) {
            node = node.left_0;
          }
           else {
            nodeStart += node.left_0.subtreeLength;
            node = node.right;
          }
          continue outer;
        }
      }
    }
    while (true) {
      if (node.parent_0.left_0 == node) {
        nodeStart += node.subtreeLength;
        node = node.parent_0.right;
        continue outer;
      }
      nodeStart -= node.parent_0.left_0.subtreeLength;
      node = node.parent_0;
      if (node.parent_0 == node.this$0.sentinel) {
        return -1;
      }
    }
  }
}

function $tryToPropagateFromDyingSubtree(child){
  var entries, parent_0, sibling;
  parent_0 = child.parent_0;
  while (parent_0.subtreeLength == 0) {
    child = parent_0;
    parent_0 = parent_0.parent_0;
  }
  sibling = child.parent_0.left_0 == child?child.parent_0.right:child.parent_0.left_0;
  entries = sibling.localMap;
  parent_0.localMap.putAll_0(entries);
  $tryToPropagateFromChildren_0(parent_0.parent_0, entries);
  sibling.localMap.clear();
}

function BasicAnnotationTree_0(oneValue, anotherValue){
  var root;
  $clinit_1445();
  this.leavesThatHaveBecomeEmpty = new ArrayList_0;
  this.knownKeys = new CollectionUtils$StringSetAdapter_0(new HashSet_0);
  this.oneValue = oneValue;
  this.anotherValue = anotherValue;
  root = new BasicAnnotationTree$Node_0(this, ($clinit_1104() , LEAF_BLACK), 1, new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  this.sentinel = new BasicAnnotationTree$Node_0(this, INTERNAL_BLACK, -1, new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  this.sentinel.left_0 = root;
  root.parent_0 = this.sentinel;
  this.sentinel.right = new BasicAnnotationTree$Node_0(this, LEAF_BLACK, 0, new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  this.sentinel.right.parent_0 = this.sentinel;
  this.knownKeys.backend.clear();
}

function BasicAnnotationTree(){
}

_ = BasicAnnotationTree_0.prototype = BasicAnnotationTree.prototype = new Object_0;
_.getClass$ = function getClass_706(){
  return Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree_2_classLit;
}
;
_.castableTypeMap$ = {};
_.anotherValue = null;
_.knownKeys = null;
_.nextId = 0;
_.oneValue = null;
_.sentinel = null;
function $apply_10(this$static, key, value){
  if (this$static.val$b0.containsKey_0(key) && equal_0(this$static.val$b0.getExisting(key), value)) {
    $put_5(this$static.val$a1, key, value);
    this$static.val$b0.remove_4(key);
    return false;
  }
  return true;
}

function BasicAnnotationTree$1_0(val$b0, val$a1){
  this.val$b0 = val$b0;
  this.val$a1 = val$a1;
}

function BasicAnnotationTree$1(){
}

_ = BasicAnnotationTree$1_0.prototype = BasicAnnotationTree$1.prototype = new Object_0;
_.getClass$ = function getClass_707(){
  return Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$a1 = null;
_.val$b0 = null;
function BasicAnnotationTree$2_0(val$b0, val$a1, val$d0, val$e0){
  this.val$b0 = val$b0;
  this.val$a1 = val$a1;
  this.val$d0 = val$d0;
  this.val$e0 = val$e0;
}

function BasicAnnotationTree$2(){
}

_ = BasicAnnotationTree$2_0.prototype = BasicAnnotationTree$2.prototype = new Object_0;
_.apply_0 = function apply_31(key, value){
  if (this.val$b0.containsKey_0(key) && equal_0(this.val$b0.getExisting(key), value)) {
    this.val$b0.remove_4(key);
    $put_5(this.val$a1, key, value);
  }
   else {
    this.val$d0.put_0(key, value);
  }
  this.val$e0.put_0(key, value);
}
;
_.getClass$ = function getClass_708(){
  return Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$a1 = null;
_.val$b0 = null;
_.val$d0 = null;
_.val$e0 = null;
function $apply_11(this$static, key){
  if (this$static.this$0.sentinel.left_0.localMap.containsKey_0(key) && this$static.this$0.sentinel.left_0.localMap.getExisting(key) == null) {
    this$static.this$0.sentinel.left_0.localMap.remove_4(key);
    return false;
  }
   else {
    return true;
  }
}

function BasicAnnotationTree$3_0(this$0){
  this.this$0 = this$0;
}

function BasicAnnotationTree$3(){
}

_ = BasicAnnotationTree$3_0.prototype = BasicAnnotationTree$3.prototype = new Object_0;
_.getClass$ = function getClass_709(){
  return Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function BasicAnnotationTree$6_0(val$first, val$buf){
  this.val$first = val$first;
  this.val$buf = val$buf;
}

function BasicAnnotationTree$6(){
}

_ = BasicAnnotationTree$6_0.prototype = BasicAnnotationTree$6.prototype = new Object_0;
_.apply_0 = function apply_32(key, value){
  this.val$first[0]?(this.val$first[0] = false):$append_8(this.val$buf, ', ');
  $append_8(this.val$buf, key + '=' + value);
}
;
_.getClass$ = function getClass_710(){
  return Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$6_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$buf = null;
_.val$first = null;
function $absoluteFromRelative(this$static, relativeIndex){
  if (this$static == this$static.this$0.sentinel) {
    return relativeIndex;
  }
  return this$static.parent_0.left_0 == this$static?$absoluteFromRelative(this$static.parent_0, relativeIndex):$absoluteFromRelative(this$static.parent_0, relativeIndex + this$static.parent_0.left_0.subtreeLength);
}

function $eraseAnnotations(this$static, nodeStart, key){
  if (this$static.localMap.containsKey_0(key)) {
    this$static.localMap.remove_4(key);
    return;
  }
  $eraseAnnotations(this$static.left_0, nodeStart, key);
  $eraseAnnotations(this$static.right, nodeStart + this$static.left_0.subtreeLength, key);
  $tryToMergeChildren(this$static);
}

function $isLeftChild(this$static){
  return this$static.parent_0.left_0 == this$static;
}

function $pathString(this$static){
  if (this$static.parent_0 == this$static.this$0.sentinel) {
    return '#';
  }
  if (this$static.this$0.sentinel == this$static) {
    return 'S';
  }
  if (!this$static.parent_0) {
    return 'O';
  }
  if (this$static == this$static.parent_0.left_0) {
    return $pathString(this$static.parent_0) + 'l';
  }
  if (this$static == this$static.parent_0.right) {
    return $pathString(this$static.parent_0) + 'r';
  }
  return '<not a child of parent>';
}

function $printForDebugging(this$static, out){
  if (this$static.type_0 == ($clinit_1104() , LEAF_BLACK)) {
    $append_8(out, $toString_13(this$static) + '\n');
  }
   else {
    !this$static.right?(out.impl.string += 'null right?!\n' , out):$printForDebugging(this$static.right, out);
    $append_8(out, $toString_13(this$static) + '\n');
    !this$static.left_0?(out.impl.string += 'null left?!\n' , out):$printForDebugging(this$static.left_0, out);
  }
}

function $pushKeyIntoChildren(this$static, key){
  var value;
  value = this$static.localMap.getExisting(key);
  this$static.left_0.localMap.put_0(key, value);
  this$static.right.localMap.put_0(key, value);
  this$static.localMap.remove_4(key);
}

function $rebalanceAfterInsertion(this$static){
  var g, u;
  if (this$static.parent_0 == this$static.this$0.sentinel) {
    $setRed(this$static, false);
    return;
  }
  if (this$static.parent_0.type_0 != ($clinit_1104() , INTERNAL_RED)) {
    return;
  }
  if (this$static.parent_0.parent_0 == this$static.this$0.sentinel) {
    $setRed(this$static.parent_0, false);
    return;
  }
  g = this$static.parent_0.parent_0;
  u = $sibling(this$static.parent_0);
  if (g != this$static.this$0.sentinel && u.type_0 == INTERNAL_RED) {
    $setRed(this$static.parent_0, false);
    $setRed(u, false);
    $setRed(g, true);
    $rebalanceAfterInsertion(g);
    return;
  }
  if (this$static.parent_0.left_0 != this$static && $isLeftChild(this$static.parent_0)) {
    $rotateL(this$static.parent_0);
    g = this$static.parent_0;
    $setRed(this$static, false);
    $setRed(g, true);
    $rotateR(g);
    return;
  }
   else if (this$static.parent_0.left_0 == this$static && !$isLeftChild(this$static.parent_0)) {
    $rotateR(this$static.parent_0);
    g = this$static.parent_0;
    $setRed(this$static, false);
    $setRed(g, true);
    $rotateL(g);
    return;
  }
  $setRed(this$static.parent_0, false);
  $setRed(g, true);
  if (this$static.parent_0.left_0 == this$static && $isLeftChild(this$static.parent_0)) {
    $rotateR(g);
    return;
  }
   else {
    $rotateL(g);
    return;
  }
}

function $rebalanceAfterRemoval(this$static){
  var s;
  if (this$static.parent_0 == this$static.this$0.sentinel) {
    return;
  }
  s = this$static.parent_0.left_0 == this$static?this$static.parent_0.right:this$static.parent_0.left_0;
  if (s.type_0 == ($clinit_1104() , INTERNAL_RED)) {
    $setRed(this$static.parent_0, true);
    $setRed(s, false);
    this$static.parent_0.left_0 == this$static?$rotateL(this$static.parent_0):$rotateR(this$static.parent_0);
  }
  s = this$static.parent_0.left_0 == this$static?this$static.parent_0.right:this$static.parent_0.left_0;
  if (this$static.parent_0.type_0 != INTERNAL_RED && s.type_0 != INTERNAL_RED && s.left_0.type_0 != INTERNAL_RED && s.right.type_0 != INTERNAL_RED) {
    $setRed(s, true);
    $rebalanceAfterRemoval(this$static.parent_0);
    return;
  }
  if (this$static.parent_0.type_0 == INTERNAL_RED && s.type_0 != INTERNAL_RED && s.left_0.type_0 != INTERNAL_RED && s.right.type_0 != INTERNAL_RED) {
    $setRed(s, true);
    $setRed(this$static.parent_0, false);
    return;
  }
  if (this$static.parent_0.left_0 == this$static) {
    if (s.type_0 != INTERNAL_RED && s.left_0.type_0 == INTERNAL_RED && s.right.type_0 != INTERNAL_RED) {
      $setRed(s, true);
      $setRed(s.left_0, false);
      $rotateR(s);
      s = this$static.parent_0.left_0 == this$static?this$static.parent_0.right:this$static.parent_0.left_0;
    }
    $setRed(s, this$static.parent_0.type_0 == INTERNAL_RED);
    $setRed(this$static.parent_0, false);
    $setRed(s.right, false);
    $rotateL(this$static.parent_0);
  }
   else {
    if (s.type_0 != INTERNAL_RED && s.left_0.type_0 != INTERNAL_RED && s.right.type_0 == INTERNAL_RED) {
      $setRed(s, true);
      $setRed(s.right, false);
      $rotateL(s);
      s = this$static.parent_0.left_0 == this$static?this$static.parent_0.right:this$static.parent_0.left_0;
    }
    $setRed(s, this$static.parent_0.type_0 == INTERNAL_RED);
    $setRed(this$static.parent_0, false);
    $setRed(s.left_0, false);
    $rotateR(this$static.parent_0);
  }
}

function $replaceNodeWithSoleChild(this$static, child){
  child.parent_0.left_0 == child?(this$static.right.parent_0 = null):(this$static.left_0.parent_0 = null);
  child.parent_0 = null;
  $replaceThisNodeWith(this$static, child);
  $tryToMergeChildren(child.parent_0);
  if (this$static.type_0 == ($clinit_1104() , INTERNAL_RED)) {
    return;
  }
  if (child.type_0 == INTERNAL_RED) {
    $setRed(child, false);
    return;
  }
  $rebalanceAfterRemoval(child);
  $tryToMergeChildren(child.parent_0);
}

function $replaceThisNodeWith(this$static, other){
  other.parent_0 = this$static.parent_0;
  this$static.parent_0.left_0 == this$static?(this$static.parent_0.left_0 = other):(this$static.parent_0.right = other);
  this$static.parent_0 = null;
}

function $rotateL(this$static){
  var b, c, d, e, p;
  p = this$static.parent_0;
  b = this$static.left_0;
  c = this$static.right;
  d = c.left_0;
  e = c.right;
  c.parent_0 = null;
  $replaceThisNodeWith(this$static, c);
  this$static.right = d;
  c.left_0 = this$static;
  this$static.parent_0 = c;
  c.parent_0 = p;
  d.parent_0 = this$static;
  this$static.subtreeLength -= e.subtreeLength;
  c.subtreeLength += b.subtreeLength;
  $fixupMapsAfterSingleRotation(this$static, b, c, d, e);
  $tryToMergeChildren(this$static);
}

function $rotateR(this$static){
  var b, c, d, e, p;
  p = this$static.parent_0;
  b = this$static.right;
  c = this$static.left_0;
  d = c.right;
  e = c.left_0;
  c.parent_0 = null;
  $replaceThisNodeWith(this$static, c);
  this$static.left_0 = d;
  c.right = this$static;
  this$static.parent_0 = c;
  c.parent_0 = p;
  d.parent_0 = this$static;
  this$static.subtreeLength -= e.subtreeLength;
  c.subtreeLength += b.subtreeLength;
  $fixupMapsAfterSingleRotation(this$static, b, c, d, e);
  $tryToMergeChildren(this$static);
}

function $setAnnotationForLeaf(this$static, absoluteNodeStart, start, end, key, value){
  var indexOnRight, newMiddle, newParent, newParent1, newParent2, previousValue, temporaryRight, valueOnRight;
  start = start > 0?start:0;
  end = min_0(end, this$static.subtreeLength);
  if (start >= end) {
    return -1;
  }
  if (equal_0(this$static.localMap.getExisting(key), value)) {
    return -1;
  }
  if (start == 0 && end == this$static.subtreeLength) {
    $eraseAnnotations(this$static, absoluteNodeStart, key);
    this$static.localMap.put_0(key, value);
    return $tryToPropagateFromChildren(this$static.parent_0, key)?absoluteNodeStart + end:-1;
  }
  if (start == 0) {
    newParent = $splitNode(this$static, end);
    $pushKeyIntoChildren(newParent, key);
    $setAnnotationForLeaf(newParent.left_0, absoluteNodeStart, 0, end, key, value);
    $tryToPropagateFromChildren(newParent, key);
    $rebalanceAfterInsertion(newParent);
    return absoluteNodeStart + end;
  }
  if (end == this$static.subtreeLength) {
    newParent = $splitNode(this$static, start);
    $pushKeyIntoChildren(newParent, key);
    $setAnnotationForLeaf(newParent.right, absoluteNodeStart + start, start - start, end - start, key, value);
    $tryToPropagateFromChildren(newParent, key);
    $rebalanceAfterInsertion(newParent);
    return absoluteNodeStart + end;
  }
  previousValue = this$static.localMap.getExisting(key);
  indexOnRight = absoluteNodeStart + this$static.subtreeLength;
  valueOnRight = indexOnRight == this$static.this$0.sentinel.left_0.subtreeLength?null:$getAnnotationRaw(this$static.this$0, indexOnRight, key);
  newParent1 = $splitNode(this$static, start);
  $pushKeyIntoChildren(newParent1, key);
  temporaryRight = newParent1.right;
  temporaryRight.localMap.put_0(key, $differentValue(this$static.this$0, previousValue, valueOnRight));
  $rebalanceAfterInsertion(newParent1);
  temporaryRight.localMap.put_0(key, previousValue);
  newParent2 = $splitNode(temporaryRight, end - start);
  $pushKeyIntoChildren(newParent2, key);
  newMiddle = newParent2.left_0;
  $setAnnotationForLeaf(newMiddle, absoluteNodeStart + start, start - start, end - start, key, value);
  $tryToPropagateFromChildren(newParent2, key);
  $rebalanceAfterInsertion(newParent2);
  return absoluteNodeStart + end;
}

function $setRed(this$static, flag){
  if (this$static.type_0 == ($clinit_1104() , LEAF_BLACK))
  ;
  else {
    this$static.type_0 = flag?INTERNAL_RED:INTERNAL_BLACK;
  }
}

function $sibling(this$static){
  return this$static.parent_0.left_0 == this$static?this$static.parent_0.right:this$static.parent_0.left_0;
}

function $splitNode(this$static, splitIndex){
  var newLeft, newParent, newRight;
  newLeft = new BasicAnnotationTree$Node_0(this$static.this$0, ($clinit_1104() , LEAF_BLACK), splitIndex, ($clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0)));
  newRight = new BasicAnnotationTree$Node_0(this$static.this$0, LEAF_BLACK, this$static.subtreeLength - splitIndex, new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  newParent = new BasicAnnotationTree$Node_0(this$static.this$0, INTERNAL_BLACK, this$static.subtreeLength, this$static.localMap);
  newLeft.parent_0 = newParent;
  newRight.parent_0 = newParent;
  newParent.left_0 = newLeft;
  newParent.right = newRight;
  $setRed(newParent, true);
  $replaceThisNodeWith(this$static, newParent);
  return newParent;
}

function $toString_13(this$static){
  var $e0, rangeString, typeString;
  try {
    rangeString = '' + $absoluteFromRelative(this$static, 0) + '+' + this$static.subtreeLength + '=' + $absoluteFromRelative(this$static, this$static.subtreeLength);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 4)) {
      rangeString = '<RuntimeException computing range; length=' + this$static.subtreeLength + '>';
    }
     else 
      throw $e0;
  }
  switch (this$static.type_0.ordinal) {
    case 2:
      typeString = 'internal, black';
      break;
    case 1:
      typeString = 'internal, red';
      break;
    case 0:
      typeString = 'leaf, black';
      break;
    default:typeString = '<error: invalid node type ' + this$static.type_0 + '>';
  }
  return $pathString(this$static) + ' Node (' + this$static.id_0 + ':' + toPowerOfTwoString(!this$static?0:this$static.$H || (this$static.$H = ++sNextHashId)) + ') ' + rangeString + ' ' + typeString + (this$static == this$static.this$0.sentinel?' (sentinel)':this$static == this$static.this$0.sentinel.left_0?' (root)':'') + ' ' + $mapToString(this$static.localMap);
}

function $tryToCollapse(this$static){
  if (this$static.subtreeLength == 0) {
    $replaceNodeWithSoleChild(this$static, this$static.right);
    return;
  }
  if (this$static.left_0.subtreeLength == 0) {
    this$static.right.localMap.putAll_0(this$static.localMap);
    $replaceNodeWithSoleChild(this$static, this$static.right);
    return;
  }
  if (this$static.right.subtreeLength == 0) {
    this$static.left_0.localMap.putAll_0(this$static.localMap);
    $replaceNodeWithSoleChild(this$static, this$static.left_0);
    return;
  }
}

--></script>
<script><!--
function $tryToMergeChildren(this$static){
  var rightLength;
  if (this$static.left_0.localMap.isEmpty() && this$static.right.localMap.isEmpty() && this$static.left_0.type_0 == ($clinit_1104() , LEAF_BLACK) && this$static.right.type_0 == ($clinit_1104() , LEAF_BLACK)) {
    rightLength = this$static.right.subtreeLength;
    if (rightLength == 0) {
      return;
    }
    if (this$static.left_0.subtreeLength == 0) {
      return;
    }
    this$static.left_0.subtreeLength += rightLength;
    this$static.right.subtreeLength = 0;
    $add_9(this$static.this$0.leavesThatHaveBecomeEmpty, this$static.right);
  }
}

function $tryToPropagateFromChildren(this$static, key){
  var valueLeft;
  if (this$static.left_0.localMap.containsKey_0(key) && this$static.right.localMap.containsKey_0(key)) {
    valueLeft = this$static.left_0.localMap.getExisting(key);
    if (equal_0(valueLeft, this$static.right.localMap.getExisting(key))) {
      this$static.localMap.put_0(key, valueLeft);
      this$static.left_0.localMap.remove_4(key);
      this$static.right.localMap.remove_4(key);
      $tryToMergeChildren(this$static);
      $tryToPropagateFromChildren(this$static.parent_0, key);
      return true;
    }
  }
  return false;
}

function $tryToPropagateFromChildren_0(this$static, entries){
  entries.each(new BasicAnnotationTree$Node$3_0(this$static));
}

function BasicAnnotationTree$Node_0(this$0, type, subtreeLength, localMap){
  this.this$0 = this$0;
  this.subtreeLength = subtreeLength;
  this.localMap = localMap;
  this.type_0 = type;
  this.id_0 = this$0.nextId++;
}

function BasicAnnotationTree$Node(){
}

_ = BasicAnnotationTree$Node_0.prototype = BasicAnnotationTree$Node.prototype = new Object_0;
_.getClass$ = function getClass_711(){
  return Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$Node_2_classLit;
}
;
_.toString$ = function toString_58(){
  return $toString_13(this);
}
;
_.castableTypeMap$ = {216:1};
_.id_0 = 0;
_.left_0 = null;
_.localMap = null;
_.parent_0 = null;
_.right = null;
_.subtreeLength = 0;
_.this$0 = null;
_.type_0 = null;
function BasicAnnotationTree$Node$3_0(this$1){
  this.this$1 = this$1;
}

function BasicAnnotationTree$Node$3(){
}

_ = BasicAnnotationTree$Node$3_0.prototype = BasicAnnotationTree$Node$3.prototype = new Object_0;
_.apply_0 = function apply_33(key, value){
  $tryToPropagateFromChildren(this.this$1, key);
}
;
_.getClass$ = function getClass_712(){
  return Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$Node$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
function $clinit_1104(){
  $clinit_1104 = nullMethod;
  LEAF_BLACK = new BasicAnnotationTree$NodeType_0('LEAF_BLACK', 0);
  INTERNAL_RED = new BasicAnnotationTree$NodeType_0('INTERNAL_RED', 1);
  INTERNAL_BLACK = new BasicAnnotationTree$NodeType_0('INTERNAL_BLACK', 2);
  $VALUES_46 = initValues(_3Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$NodeType_2_classLit, {58:1, 138:1}, 110, [LEAF_BLACK, INTERNAL_RED, INTERNAL_BLACK]);
}

function BasicAnnotationTree$NodeType_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_47(){
  $clinit_1104();
  return $VALUES_46;
}

function BasicAnnotationTree$NodeType(){
}

_ = BasicAnnotationTree$NodeType_0.prototype = BasicAnnotationTree$NodeType.prototype = new Enum;
_.getClass$ = function getClass_713(){
  return Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$NodeType_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 110:1};
var $VALUES_46, INTERNAL_BLACK, INTERNAL_RED, LEAF_BLACK;
function $clinit_1105(){
  $clinit_1105 = nullMethod;
  ONE_OBJECT_0 = new Object_1;
  ANOTHER_OBJECT_0 = new Object_1;
}

function $build(operation, schema){
  var $e0, annotations, doc, e;
  annotations = new AnnotationTree_0(ONE_OBJECT_0, ANOTHER_OBJECT_0, null);
  doc = new IndexedDocumentImpl_0(new RawDocumentImpl_0('doc', ($clinit_1145() , EMPTY_MAP_0)), annotations, schema);
  try {
    $consume_8(doc, operation, true);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 189)) {
      e = $e0;
      throw new OperationRuntimeException_0('Invalid initialization', e);
    }
     else 
      throw $e0;
  }
  return doc;
}

function $parse(text){
  var $e0, docInitialization, e;
  try {
    docInitialization = docInitializationFromXml(text);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 203)) {
      e = $e0;
      throw new IllegalArgumentException_3(e);
    }
     else 
      throw $e0;
  }
  return $build(docInitialization, ($clinit_1269() , NO_SCHEMA_CONSTRAINTS));
}

var ANOTHER_OBJECT_0, ONE_OBJECT_0;
function $maybeTextNodeEnd(this$static, node){
  var textNode;
  textNode = this$static.this$0.substrate.asText_0(node);
  return textNode == null?null:new Point$Tx_0(textNode, this$static.this$0.substrate.getLength(textNode));
}

function $performAction(this$static, container, offset){
  var domNode, element, maybeAdjust;
  domNode = container.value_0;
  if (domNode == null) {
    if (container == this$static.this$0.offsetList.root) {
      return new Point$El_0(this$static.this$0.substrate.getDocumentElement(), null);
    }
    element = $getParentOf(this$static.this$0, container);
    maybeAdjust = $maybeTextNodeEnd(this$static, this$static.this$0.substrate.getLastChild_0(element));
    return maybeAdjust?maybeAdjust:new Point$El_0(element, null);
  }
   else if (this$static.this$0.substrate.asElement_0(domNode) != null) {
    maybeAdjust = $maybeTextNodeEnd(this$static, this$static.this$0.substrate.getPreviousSibling(domNode));
    return maybeAdjust?maybeAdjust:before_0(this$static.this$0.substrate, domNode);
  }
   else {
    if (offset == 0) {
      maybeAdjust = $maybeTextNodeEnd(this$static, this$static.this$0.substrate.getPreviousSibling(domNode));
      return maybeAdjust?maybeAdjust:new Point$Tx_0(domNode, 0);
    }
     else {
      return new Point$Tx_0(domNode, offset);
    }
  }
}

function IndexedDocumentImpl$1_0(this$0){
  this.this$0 = this$0;
}

function IndexedDocumentImpl$1(){
}

_ = IndexedDocumentImpl$1_0.prototype = IndexedDocumentImpl$1.prototype = new Object_0;
_.getClass$ = function getClass_714(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$1_2_classLit;
}
;
_.performAction = function performAction(container, offset){
  return $performAction(this, container, offset);
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function IndexedDocumentImpl$2_0(this$0){
  this.this$0 = this$0;
}

function IndexedDocumentImpl$2(){
}

_ = IndexedDocumentImpl$2_0.prototype = IndexedDocumentImpl$2.prototype = new Object_0;
_.getClass$ = function getClass_715(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$2_2_classLit;
}
;
_.performAction = function performAction_0(container, offset){
  return this.this$0.currentContainer = container , this.this$0.currentOffset = offset , this.this$0.currentParent = $getParentOf(this.this$0, container) , null;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function IndexedDocumentImpl$3_0(){
}

function IndexedDocumentImpl$3(){
}

_ = IndexedDocumentImpl$3_0.prototype = IndexedDocumentImpl$3.prototype = new Object_0;
_.apply_3 = function apply_34(key){
  checkPersistentKey(key);
}
;
_.getClass$ = function getClass_716(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$3_2_classLit;
}
;
_.castableTypeMap$ = {};
function IndexedDocumentImpl$4_0(val$b){
  this.val$b = val$b;
}

function IndexedDocumentImpl$4(){
}

_ = IndexedDocumentImpl$4_0.prototype = IndexedDocumentImpl$4.prototype = new Object_0;
_.apply_0 = function apply_35(key, value){
  value != null?($put_0(this.val$b.annotationChanges, key, new AnnotationsNormalizer$AnnotationChangeValues_0(null, dynamicCast(value, 1))) , undefined):($put_0(this.val$b.annotationChanges, key, null) , undefined);
}
;
_.getClass$ = function getClass_717(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$4_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$b = null;
function IndexedDocumentImpl$5_0(val$b){
  this.val$b = val$b;
}

function IndexedDocumentImpl$5(){
}

_ = IndexedDocumentImpl$5_0.prototype = IndexedDocumentImpl$5.prototype = new Object_0;
_.apply_0 = function apply_36(key, value){
  $put_0(this.val$b.annotationChanges, key, null);
}
;
_.getClass$ = function getClass_718(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$5_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$b = null;
function IndexedDocumentImpl$6_0(val$knownKeys){
  this.val$knownKeys = val$knownKeys;
}

function IndexedDocumentImpl$6(){
}

_ = IndexedDocumentImpl$6_0.prototype = IndexedDocumentImpl$6.prototype = new Object_0;
_.apply_3 = function apply_37(key){
  key.charCodeAt(0) == 64 || $add_20(this.val$knownKeys, key);
}
;
_.getClass$ = function getClass_719(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$6_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$knownKeys = null;
function IndexedDocumentImpl$7_0(val$callback){
  this.val$callback = val$callback;
}

function IndexedDocumentImpl$7(){
}

_ = IndexedDocumentImpl$7_0.prototype = IndexedDocumentImpl$7.prototype = new Object_0;
_.apply_0 = function apply_38(key, value){
  key.charCodeAt(0) == 64 || this.val$callback.apply_0(key, dynamicCast(value, 1));
}
;
_.getClass$ = function getClass_720(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$7_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$callback = null;
function IndexedDocumentImpl$8_0(val$iterable){
  this.val$iterable = val$iterable;
}

function IndexedDocumentImpl$8(){
}

_ = IndexedDocumentImpl$8_0.prototype = IndexedDocumentImpl$8.prototype = new Object_0;
_.getClass$ = function getClass_721(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$8_2_classLit;
}
;
_.iterator_0 = function iterator_19(){
  var iterator;
  return iterator = this.val$iterable.iterator_0() , new IndexedDocumentImpl$8$1_0(iterator);
}
;
_.castableTypeMap$ = {};
_.val$iterable = null;
function $next_11(this$static){
  var annotations, diffFromLeft, end, rawInterval, start;
  rawInterval = dynamicCast(this$static.val$iterator.next_0(), 219);
  start = rawInterval.start;
  end = rawInterval.end;
  annotations = rawInterval.annotations;
  diffFromLeft = rawInterval.diffFromLeft;
  return new AnnotationIntervalImpl_0(start, end, annotations, diffFromLeft);
}

function IndexedDocumentImpl$8$1_0(val$iterator){
  this.val$iterator = val$iterator;
}

function IndexedDocumentImpl$8$1(){
}

_ = IndexedDocumentImpl$8$1_0.prototype = IndexedDocumentImpl$8$1.prototype = new Object_0;
_.getClass$ = function getClass_722(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$8$1_2_classLit;
}
;
_.hasNext = function hasNext_12(){
  return this.val$iterator.hasNext();
}
;
_.next_0 = function next_16(){
  return $next_11(this);
}
;
_.remove = function remove_36(){
  this.val$iterator.remove();
}
;
_.castableTypeMap$ = {};
_.val$iterator = null;
function IndexedDocumentImpl$9_0(val$iterable){
  this.val$iterable = val$iterable;
}

function IndexedDocumentImpl$9(){
}

_ = IndexedDocumentImpl$9_0.prototype = IndexedDocumentImpl$9.prototype = new Object_0;
_.getClass$ = function getClass_723(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$9_2_classLit;
}
;
_.iterator_0 = function iterator_20(){
  var iterator;
  return iterator = this.val$iterable.iterator_0() , new IndexedDocumentImpl$9$1_0(iterator);
}
;
_.castableTypeMap$ = {};
_.val$iterable = null;
function $next_13(this$static){
  var end, key, rawRange, start, value;
  rawRange = dynamicCast(this$static.val$iterator.next_0(), 142);
  key = rawRange.key;
  value = dynamicCast(rawRange.value_0, 1);
  start = rawRange.start;
  end = rawRange.end;
  return new RangedAnnotationImpl_0(key, value, start, end);
}

function IndexedDocumentImpl$9$1_0(val$iterator){
  this.val$iterator = val$iterator;
}

function IndexedDocumentImpl$9$1(){
}

_ = IndexedDocumentImpl$9$1_0.prototype = IndexedDocumentImpl$9$1.prototype = new Object_0;
_.getClass$ = function getClass_724(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$9$1_2_classLit;
}
;
_.hasNext = function hasNext_13(){
  return this.val$iterator.hasNext();
}
;
_.next_0 = function next_17(){
  return $next_13(this);
}
;
_.remove = function remove_37(){
  this.val$iterator.remove();
}
;
_.castableTypeMap$ = {};
_.val$iterator = null;
function IndexedDocumentImpl$InvertibleCursor_0(this$0){
  this.this$0 = this$0;
}

function IndexedDocumentImpl$InvertibleCursor(){
}

_ = IndexedDocumentImpl$InvertibleCursor_0.prototype = IndexedDocumentImpl$InvertibleCursor.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_0(map){
  var i;
  for (i = 0; i < map.endSize(); ++i) {
    $doEndAnnotation(this.this$0, map.getEndKey_0(i));
  }
  for (i = 0; i < map.changeSize(); ++i) {
    $doStartAnnotation(this.this$0, map.getChangeKey_0(i), map.getNewValue(i));
  }
}
;
_.characters_0 = function characters_1(characters){
  $doCharacters(this.this$0, characters);
}
;
_.deleteCharacters = function deleteCharacters_0(chars){
  this.this$0.annotations.delete_$(chars.length);
  $doDeleteCharacters(this.this$0, chars.length);
}
;
_.deleteElementEnd = function deleteElementEnd_0(){
  this.this$0.annotations.delete_$(1);
  $deleteCurrentContainer(this.this$0);
  --this.this$0.deletionDepth;
}
;
_.deleteElementStart = function deleteElementStart_0(type, attrs){
  var nodeToDelete;
  nodeToDelete = this.this$0.substrate.asElement_0(this.this$0.currentContainer.value_0);
  if (nodeToDelete == null) {
    throw new OpCursorException_0('No element to delete at the current location.');
  }
  this.this$0.deletionDepth == 0 && this.this$0.substrate.removeChild_0(this.this$0.currentParent, nodeToDelete);
  this.this$0.annotations.delete_$(1);
  $deleteCurrentContainer(this.this$0);
  ++this.this$0.deletionDepth;
}
;
_.elementEnd = function elementEnd_0(){
  $doElementEnd(this.this$0);
}
;
_.elementStart = function elementStart_0(tagName, attributes){
  $doElementStart(this.this$0, tagName, attributes);
}
;
_.getClass$ = function getClass_725(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$InvertibleCursor_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_0(oldAttrs, newAttrs){
  var attribute, attribute$iterator, key, node;
  this.this$0.annotations.skip(1);
  node = this.this$0.substrate.asElement_0(this.this$0.currentContainer.value_0);
  for (attribute$iterator = new ImmutableStateMap$1$1_0(oldAttrs.entrySet); attribute$iterator.iterator.hasNext();) {
    attribute = dynamicCast(attribute$iterator.iterator.next_0(), 221);
    key = attribute.name_0;
    !!$implFindEntry(newAttrs, key, false) || this.this$0.substrate.removeAttribute_0(node, key);
  }
  for (attribute$iterator = new ImmutableStateMap$1$1_0(newAttrs.entrySet); attribute$iterator.iterator.hasNext();) {
    attribute = dynamicCast(attribute$iterator.iterator.next_0(), 221);
    if (attribute.value_0 == null) {
      throw new OpCursorException_0('Null attribute value in setAttributes');
    }
    this.this$0.substrate.setAttribute_0(node, attribute.name_0, attribute.value_0);
  }
  ++this.this$0.currentLocation;
  this.this$0.currentContainer = this.this$0.currentContainer.nextContainer;
  this.this$0.currentParent = node;
}
;
_.retain = function retain_0(itemCount){
  $checkRetain(this.this$0, itemCount);
  this.this$0.annotations.skip(itemCount);
  this.this$0.currentLocation += itemCount;
  $moveToCurrentLocation(this.this$0);
}
;
_.updateAttributes = function updateAttributes_0(attrUpdate){
  var i, name_0, newValue, node;
  this.this$0.annotations.skip(1);
  node = this.this$0.substrate.asElement_0(this.this$0.currentContainer.value_0);
  for (i = 0; i < attrUpdate.updates.size_0(); ++i) {
    name_0 = dynamicCast(attrUpdate.updates.get_0(i), 220).name_0;
    newValue = dynamicCast(attrUpdate.updates.get_0(i), 220).newValue;
    newValue != null?this.this$0.substrate.setAttribute_0(node, name_0, newValue):this.this$0.substrate.removeAttribute_0(node, name_0);
  }
  ++this.this$0.currentLocation;
  this.this$0.currentContainer = this.this$0.currentContainer.nextContainer;
  this.this$0.currentParent = node;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $begin2(this$static){
  $beginChange(this$static.this$0);
  this$static.builder = new AnnotationsNormalizer_0(new DocOpBuffer_0);
  this$static.sizeDiffSoFar = 0;
  this$static.deletionValues.backend.clear();
}

function $beginInsert(this$static){
  $each_2(this$static.newValues, new IndexedDocumentImpl$NonInvertibleCursor$3_0(this$static));
  this$static.newValues.backend.clear();
  this$static.deletionValues.backend.clear();
  this$static.deletionValues.backend.putAll(dynamicCast(this$static.requestedValues, 265).backend);
  $each_3(this$static.endKeys, new IndexedDocumentImpl$NonInvertibleCursor$5_0(this$static));
  this$static.endKeys.backend.clear();
}

function $beginUpdate(this$static){
  $each_2(this$static.requestedValues, new IndexedDocumentImpl$NonInvertibleCursor$4_0(this$static));
  this$static.newValues.backend.clear();
  this$static.deletionValues.backend.clear();
  this$static.deletionValues.backend.putAll(dynamicCast(this$static.requestedValues, 265).backend);
  $each_3(this$static.endKeys, new IndexedDocumentImpl$NonInvertibleCursor$5_0(this$static));
  this$static.endKeys.backend.clear();
}

function $deleteAnnotations(this$static, size){
  var deletionInherit, end, events, i, i$iterator, open_0, realStart, start, iterator;
  events = new ArrayList_0;
  open_0 = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringSetAdapter_0(new HashSet_0));
  deletionInherit = new CollectionUtils$StringMapAdapter_0(new HashMap_0);
  $each_2(this$static.deletionValues, new IndexedDocumentImpl$NonInvertibleCursor$6_0(deletionInherit));
  start = this$static.this$0.currentLocation;
  end = this$static.this$0.currentLocation + size;
  for (i$iterator = (iterator = $annotationIntervals_0(this$static.this$0, start, end, null).val$iterable.iterator_0() , new IndexedDocumentImpl$8$1_0(iterator)); i$iterator.val$iterator.hasNext();) {
    i = $next_11(i$iterator);
    realStart = max(start, i.start);
    $each_2(deletionInherit, new IndexedDocumentImpl$NonInvertibleCursor$7_0(this$static, events, realStart, open_0));
    i.annotations.each(new IndexedDocumentImpl$NonInvertibleCursor$8_0(deletionInherit, events, realStart, open_0));
  }
  $each_3(open_0, new IndexedDocumentImpl$NonInvertibleCursor$9_0(events, end));
  this$static.this$0.annotations.delete_$(size);
  return events;
}

function $doSingleDelete(this$static, tagName, attrs){
  var changeKey, check, ev, ev$iterator, eventLocation, events, moved;
  events = $deleteAnnotations(this$static, 1);
  moved = false;
  check = 0;
  for (ev$iterator = new AbstractList$IteratorImpl_0(events); ev$iterator.i < ev$iterator.this$0_0.size_0();) {
    ev = dynamicCast($next_6(ev$iterator), 222);
    eventLocation = ev.index_0;
    if (eventLocation > this$static.this$0.currentLocation && !moved) {
      moved = true;
      tagName != null?$deleteElementStart_0(this$static.builder, tagName, attrs):$deleteElementEnd_0(this$static.builder);
    }
    if (ev.getEndKey() != null) {
      $maybeRenewAnnotation(this$static, ev.getEndKey());
      $put_0(this$static.builder.annotationChanges, ev.getEndKey(), null);
      --check;
    }
     else {
      changeKey = ev.getChangeKey();
      $put_0(this$static.builder.annotationChanges, changeKey, new AnnotationsNormalizer$AnnotationChangeValues_0(ev.getChangeOldValue(), $getLeftNeighbourAnnotation(this$static, changeKey)));
      ++check;
    }
  }
  moved || (tagName != null?$deleteElementStart_0(this$static.builder, tagName, attrs):$deleteElementEnd_0(this$static.builder));
}

function $finish2(this$static){
  $endChange(this$static.this$0);
  return dynamicCast($finish_1(this$static.builder), 173);
}

function $getLeftNeighbourAnnotation(this$static, key){
  if ($containsKey_5(this$static.deletionValues, key)) {
    return dynamicCast($get_12(this$static.deletionValues, key), 1);
  }
  return this$static.this$0.currentLocation != 0?dynamicCast(this$static.this$0.annotations.getAnnotation(this$static.this$0.currentLocation - 1, key), 1):null;
}

function $maybeRenewAnnotation(this$static, key){
  !$containsKey_5(this$static.newValues, key) && $containsKey_5(this$static.requestedValues, key) && $put_5(this$static.newValues, key, dynamicCast($get_12(this$static.requestedValues, key), 1));
}

function $moveAndUpdateAnnotations(this$static, itemCount){
  var annotations, changeKey, currentLocationBackup, ev, ev$iterator, eventLocation, events, finalLocation, i, i$iterator, open_0, iterator;
  $beginUpdate(this$static);
  this$static.this$0.annotations.skip(itemCount);
  finalLocation = this$static.this$0.currentLocation + itemCount;
  if (!this$static.requestedValues.backend.isEmpty()) {
    events = new ArrayList_0;
    annotations = new Box_0;
    currentLocationBackup = this$static.this$0.currentLocation;
    open_0 = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringSetAdapter_0(new HashSet_0));
    for (i$iterator = (iterator = $annotationIntervals_0(this$static.this$0, this$static.this$0.currentLocation, finalLocation, this$static.requestedKeys).val$iterable.iterator_0() , new IndexedDocumentImpl$8$1_0(iterator)); i$iterator.val$iterator.hasNext();) {
      i = $next_11(i$iterator);
      this$static.this$0.currentLocation = i.start;
      annotations.boxed = i.annotations;
      $each_2(this$static.requestedValues, new IndexedDocumentImpl$NonInvertibleCursor$1_0(this$static, annotations, events, open_0));
    }
    $each_3(open_0, new IndexedDocumentImpl$NonInvertibleCursor$2_0(events, finalLocation));
    this$static.this$0.currentLocation = currentLocationBackup;
    for (ev$iterator = new AbstractList$IteratorImpl_0(events); ev$iterator.i < ev$iterator.this$0_0.size_0();) {
      ev = dynamicCast($next_6(ev$iterator), 222);
      eventLocation = ev.index_0;
      if (eventLocation > this$static.this$0.currentLocation) {
        $retain_0(this$static.builder, eventLocation - this$static.this$0.currentLocation);
        this$static.this$0.currentLocation = eventLocation;
      }
      if (ev.getEndKey() != null) {
        $maybeRenewAnnotation(this$static, ev.getEndKey());
        $put_0(this$static.builder.annotationChanges, ev.getEndKey(), null);
      }
       else {
        changeKey = ev.getChangeKey();
        $put_0(this$static.builder.annotationChanges, changeKey, new AnnotationsNormalizer$AnnotationChangeValues_0(ev.getChangeOldValue(), dynamicCast($get_13(this$static.requestedValues, changeKey, null), 1)));
      }
    }
  }
  if (this$static.this$0.currentLocation < finalLocation) {
    $retain_0(this$static.builder, finalLocation - this$static.this$0.currentLocation);
    this$static.this$0.currentLocation = finalLocation;
  }
}

function IndexedDocumentImpl$NonInvertibleCursor_0(this$0){
  this.this$0 = this$0;
  this.requestedValues = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  this.requestedKeys = new CollectionUtils$StringSetAdapter_0(new HashSet_0);
  this.newValues = new CollectionUtils$StringMapAdapter_0(new HashMap_0);
  this.endKeys = new CollectionUtils$StringSetAdapter_0(new HashSet_0);
  this.deletionValues = new CollectionUtils$StringMapAdapter_0(new HashMap_0);
}

function IndexedDocumentImpl$NonInvertibleCursor(){
}

_ = IndexedDocumentImpl$NonInvertibleCursor_0.prototype = IndexedDocumentImpl$NonInvertibleCursor.prototype = new Object_0;
_.begin = function begin_5(){
}
;
_.characters_0 = function characters_2(characters){
  $beginInsert(this);
  $doCharacters(this.this$0, characters);
  $characters_0(this.builder, characters);
  this.sizeDiffSoFar += characters.length;
}
;
_.deleteCharacters_0 = function deleteCharacters_1(deletionSize){
  var changeKey, check, ev, ev$iterator, eventLocation, events, index, newIndex, oldChars;
  events = $deleteAnnotations(this, deletionSize);
  oldChars = $doDeleteCharacters(this.this$0, deletionSize);
  index = 0;
  check = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  for (ev$iterator = new AbstractList$IteratorImpl_0(events); ev$iterator.i < ev$iterator.this$0_0.size_0();) {
    ev = dynamicCast($next_6(ev$iterator), 222);
    eventLocation = ev.index_0;
    newIndex = eventLocation - this.this$0.currentLocation;
    if (newIndex > index) {
      $deleteCharacters_0(this.builder, oldChars.substr(index, newIndex - index));
      index = newIndex;
    }
    if (ev.getEndKey() != null) {
      $maybeRenewAnnotation(this, ev.getEndKey());
      $put_0(this.builder.annotationChanges, ev.getEndKey(), null);
      $remove_25(check, ev.getEndKey());
    }
     else {
      changeKey = ev.getChangeKey();
      $put_0(this.builder.annotationChanges, changeKey, new AnnotationsNormalizer$AnnotationChangeValues_0(ev.getChangeOldValue(), $getLeftNeighbourAnnotation(this, changeKey)));
      $put_5(check, ev.getChangeKey(), ev.getChangeOldValue());
    }
  }
  index < deletionSize && $deleteCharacters_0(this.builder, oldChars.substr(index, deletionSize - index));
  this.sizeDiffSoFar -= deletionSize;
}
;
_.deleteElementEnd = function deleteElementEnd_1(){
  $doSingleDelete(this, null, null);
  $deleteCurrentContainer(this.this$0);
  --this.this$0.deletionDepth;
  --this.sizeDiffSoFar;
}
;
_.deleteElementStart_0 = function deleteElementStart_1(){
  var attributes, nodeToDelete, tagName;
  nodeToDelete = this.this$0.substrate.asElement_0(this.this$0.currentContainer.value_0);
  if (nodeToDelete == null) {
    throw new OpCursorException_0('No element to delete at the current location.');
  }
  tagName = this.this$0.substrate.getTagName(nodeToDelete);
  attributes = new AttributesImpl_1(this.this$0.substrate.getAttributes(nodeToDelete));
  this.this$0.deletionDepth == 0 && this.this$0.substrate.removeChild_0(this.this$0.currentParent, nodeToDelete);
  $doSingleDelete(this, tagName, attributes);
  $deleteCurrentContainer(this.this$0);
  ++this.this$0.deletionDepth;
  --this.sizeDiffSoFar;
}
;
_.elementEnd = function elementEnd_1(){
  $beginInsert(this);
  $doElementEnd(this.this$0);
  $elementEnd_0(this.builder);
  ++this.sizeDiffSoFar;
}
;
_.elementStart = function elementStart_1(tagName, attributes){
  $beginInsert(this);
  $doElementStart(this.this$0, tagName, attributes);
  $elementStart_0(this.builder, tagName, attributes);
  ++this.sizeDiffSoFar;
}
;
_.endAnnotation = function endAnnotation_0(key){
  $remove_25(this.requestedValues, key);
  $remove_26(this.requestedKeys, key);
  $remove_25(this.newValues, key);
  $containsKey_5(this.deletionValues, key) && $add_20(this.endKeys, key);
  $doEndAnnotation(this.this$0, key);
}
;
_.finish = function finish_0(){
  var remaining;
  remaining = $size_10(this.this$0) - this.this$0.currentLocation;
  $each_3(this.endKeys, new IndexedDocumentImpl$NonInvertibleCursor$5_0(this));
  this.endKeys.backend.clear();
  remaining > 0 && $retain_0(this.builder, remaining);
  this.this$0.currentLocation = $size_10(this.this$0);
}
;
_.getClass$ = function getClass_726(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor_2_classLit;
}
;
_.replaceAttributes_0 = function replaceAttributes_1(newAttrs){
  var attribute, attribute$iterator, key, node, oldAttributes;
  $beginUpdate(this);
  node = this.this$0.substrate.asElement_0(this.this$0.currentContainer.value_0);
  oldAttributes = new AttributesImpl_1(this.this$0.substrate.getAttributes(node));
  for (attribute$iterator = new ImmutableStateMap$1$1_0(oldAttributes.entrySet); attribute$iterator.iterator.hasNext();) {
    attribute = dynamicCast(attribute$iterator.iterator.next_0(), 221);
    key = attribute.name_0;
    !!$implFindEntry(newAttrs, key, false) || this.this$0.substrate.removeAttribute_0(node, attribute.name_0);
  }
  for (attribute$iterator = new ImmutableStateMap$1$1_0(newAttrs.entrySet); attribute$iterator.iterator.hasNext();) {
    attribute = dynamicCast(attribute$iterator.iterator.next_0(), 221);
    if (attribute.value_0 == null) {
      throw new OpCursorException_0('Null attribute value in setAttributes');
    }
    this.this$0.substrate.setAttribute_0(node, attribute.name_0, attribute.value_0);
  }
  ++this.this$0.currentLocation;
  this.this$0.currentContainer = this.this$0.currentContainer.nextContainer;
  this.this$0.currentParent = node;
  this.this$0.annotations.skip(1);
  $replaceAttributes_0(this.builder, oldAttributes, newAttrs);
}
;
_.skip = function skip_0(itemCount){
  $checkRetain(this.this$0, itemCount);
  $moveAndUpdateAnnotations(this, itemCount);
  $moveToCurrentLocation(this.this$0);
}
;
_.startAnnotation_0 = function startAnnotation_0(key, value){
  $contains_7(this.endKeys, key) && $remove_26(this.endKeys, key);
  $doStartAnnotation(this.this$0, key, value);
  $put_5(this.requestedValues, key, value);
  $add_20(this.requestedKeys, key);
  $put_5(this.newValues, key, value);
}
;
--></script>
<script><!--
_.updateAttributes_0 = function updateAttributes_1(attributes){
  var attrUpdate, attribute, attribute$iterator, i, name_0, newValue, node, oldAttributes, triples;
  $beginUpdate(this);
  triples = initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, attributes.size_0() * 3, 0);
  node = this.this$0.substrate.asElement_0(this.this$0.currentContainer.value_0);
  oldAttributes = this.this$0.substrate.getAttributes(node);
  i = 0;
  for (attribute$iterator = attributes.entrySet_0().iterator_0(); attribute$iterator.hasNext();) {
    attribute = dynamicCast(attribute$iterator.next_0(), 66);
    name_0 = dynamicCast(attribute.getKey(), 1);
    newValue = dynamicCast(attribute.getValue(), 1);
    triples[i] = name_0;
    triples[i + 1] = dynamicCast(oldAttributes.get(name_0), 1);
    triples[i + 2] = newValue;
    newValue != null?this.this$0.substrate.setAttribute_0(node, name_0, newValue):this.this$0.substrate.removeAttribute_0(node, name_0);
    i += 3;
  }
  ++this.this$0.currentLocation;
  this.this$0.currentContainer = this.this$0.currentContainer.nextContainer;
  this.this$0.currentParent = node;
  this.this$0.annotations.skip(1);
  attrUpdate = new AttributesUpdateImpl_1(triples);
  $updateAttributes_0(this.builder, attrUpdate);
}
;
_.castableTypeMap$ = {};
_.builder = null;
_.sizeDiffSoFar = 0;
_.this$0 = null;
function $apply_12(this$static, key, value){
  var oldVal;
  oldVal = dynamicCast(dynamicCast(this$static.val$annotations.boxed, 223).get_2(key, null), 1);
  if (value == null?oldVal != null:!$equals_3(value, oldVal)) {
    $add_9(this$static.val$events, new RawAnnotationSet$AnnotationStartEvent_0(this$static.this$1.this$0.currentLocation, key, oldVal));
    $add_20(this$static.val$open, key);
  }
   else if ($contains_7(this$static.val$open, key)) {
    $add_9(this$static.val$events, new RawAnnotationSet$AnnotationEndEvent_0(this$static.this$1.this$0.currentLocation, key));
    $remove_26(this$static.val$open, key);
  }
}

function IndexedDocumentImpl$NonInvertibleCursor$1_0(this$1, val$annotations, val$events, val$open){
  this.this$1 = this$1;
  this.val$annotations = val$annotations;
  this.val$events = val$events;
  this.val$open = val$open;
}

function IndexedDocumentImpl$NonInvertibleCursor$1(){
}

_ = IndexedDocumentImpl$NonInvertibleCursor$1_0.prototype = IndexedDocumentImpl$NonInvertibleCursor$1.prototype = new Object_0;
_.apply_0 = function apply_39(key, value){
  $apply_12(this, key, dynamicCast(value, 1));
}
;
_.getClass$ = function getClass_727(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
_.val$annotations = null;
_.val$events = null;
_.val$open = null;
function IndexedDocumentImpl$NonInvertibleCursor$2_0(val$events, val$finalLocation){
  this.val$events = val$events;
  this.val$finalLocation = val$finalLocation;
}

function IndexedDocumentImpl$NonInvertibleCursor$2(){
}

_ = IndexedDocumentImpl$NonInvertibleCursor$2_0.prototype = IndexedDocumentImpl$NonInvertibleCursor$2.prototype = new Object_0;
_.apply_3 = function apply_40(key){
  $add_9(this.val$events, new RawAnnotationSet$AnnotationEndEvent_0(this.val$finalLocation, key));
}
;
_.getClass$ = function getClass_728(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$events = null;
_.val$finalLocation = 0;
function $apply_13(this$static, key, value){
  $put_0(this$static.this$1.builder.annotationChanges, key, new AnnotationsNormalizer$AnnotationChangeValues_0(this$static.this$1.this$0.annotations.getInherited(key), value));
}

function IndexedDocumentImpl$NonInvertibleCursor$3_0(this$1){
  this.this$1 = this$1;
}

function IndexedDocumentImpl$NonInvertibleCursor$3(){
}

_ = IndexedDocumentImpl$NonInvertibleCursor$3_0.prototype = IndexedDocumentImpl$NonInvertibleCursor$3.prototype = new Object_0;
_.apply_0 = function apply_41(key, value){
  $apply_13(this, key, dynamicCast(value, 1));
}
;
_.getClass$ = function getClass_729(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
function $apply_14(this$static, key, value){
  var current;
  current = dynamicCast(this$static.this$1.this$0.annotations.getAnnotation(this$static.this$1.this$0.currentLocation, key), 1);
  $put_0(this$static.this$1.builder.annotationChanges, key, new AnnotationsNormalizer$AnnotationChangeValues_0(current, value));
}

function IndexedDocumentImpl$NonInvertibleCursor$4_0(this$1){
  this.this$1 = this$1;
}

function IndexedDocumentImpl$NonInvertibleCursor$4(){
}

_ = IndexedDocumentImpl$NonInvertibleCursor$4_0.prototype = IndexedDocumentImpl$NonInvertibleCursor$4.prototype = new Object_0;
_.apply_0 = function apply_42(key, value){
  $apply_14(this, key, dynamicCast(value, 1));
}
;
_.getClass$ = function getClass_730(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$4_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
function IndexedDocumentImpl$NonInvertibleCursor$5_0(this$1){
  this.this$1 = this$1;
}

function IndexedDocumentImpl$NonInvertibleCursor$5(){
}

_ = IndexedDocumentImpl$NonInvertibleCursor$5_0.prototype = IndexedDocumentImpl$NonInvertibleCursor$5.prototype = new Object_0;
_.apply_3 = function apply_43(key){
  $put_0(this.this$1.builder.annotationChanges, key, null);
}
;
_.getClass$ = function getClass_731(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$5_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
function IndexedDocumentImpl$NonInvertibleCursor$6_0(val$deletionInherit){
  this.val$deletionInherit = val$deletionInherit;
}

function IndexedDocumentImpl$NonInvertibleCursor$6(){
}

_ = IndexedDocumentImpl$NonInvertibleCursor$6_0.prototype = IndexedDocumentImpl$NonInvertibleCursor$6.prototype = new Object_0;
_.apply_0 = function apply_44(key, value){
  $put_5(this.val$deletionInherit, key, dynamicCast(value, 1));
}
;
_.getClass$ = function getClass_732(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$6_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$deletionInherit = null;
function $apply_16(this$static, key){
  $add_9(this$static.val$events, new RawAnnotationSet$AnnotationStartEvent_0(this$static.val$realStart, key, $getAnnotation_2(this$static.this$1.this$0, this$static.val$realStart, key)));
  $add_20(this$static.val$open, key);
}

function IndexedDocumentImpl$NonInvertibleCursor$7_0(this$1, val$events, val$realStart, val$open){
  this.this$1 = this$1;
  this.val$events = val$events;
  this.val$realStart = val$realStart;
  this.val$open = val$open;
}

function IndexedDocumentImpl$NonInvertibleCursor$7(){
}

_ = IndexedDocumentImpl$NonInvertibleCursor$7_0.prototype = IndexedDocumentImpl$NonInvertibleCursor$7.prototype = new Object_0;
_.apply_0 = function apply_45(key, value){
  $apply_16(this, key, dynamicCast(value, 1));
}
;
_.getClass$ = function getClass_733(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$7_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
_.val$events = null;
_.val$open = null;
_.val$realStart = 0;
function $apply_17(this$static, key, value){
  if (!$containsKey_5(this$static.val$deletionInherit, key)) {
    $add_9(this$static.val$events, new RawAnnotationSet$AnnotationStartEvent_0(this$static.val$realStart, key, value));
    $add_20(this$static.val$open, key);
  }
}

function IndexedDocumentImpl$NonInvertibleCursor$8_0(val$deletionInherit, val$events, val$realStart, val$open){
  this.val$deletionInherit = val$deletionInherit;
  this.val$events = val$events;
  this.val$realStart = val$realStart;
  this.val$open = val$open;
}

function IndexedDocumentImpl$NonInvertibleCursor$8(){
}

_ = IndexedDocumentImpl$NonInvertibleCursor$8_0.prototype = IndexedDocumentImpl$NonInvertibleCursor$8.prototype = new Object_0;
_.apply_0 = function apply_46(key, value){
  $apply_17(this, key, dynamicCast(value, 1));
}
;
_.getClass$ = function getClass_734(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$8_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$deletionInherit = null;
_.val$events = null;
_.val$open = null;
_.val$realStart = 0;
function IndexedDocumentImpl$NonInvertibleCursor$9_0(val$events, val$end){
  this.val$events = val$events;
  this.val$end = val$end;
}

function IndexedDocumentImpl$NonInvertibleCursor$9(){
}

_ = IndexedDocumentImpl$NonInvertibleCursor$9_0.prototype = IndexedDocumentImpl$NonInvertibleCursor$9.prototype = new Object_0;
_.apply_3 = function apply_47(key){
  $add_9(this.val$events, new RawAnnotationSet$AnnotationEndEvent_0(this.val$end, key));
}
;
_.getClass$ = function getClass_735(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$9_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$end = 0;
_.val$events = null;
function after_0(doc, node){
  return $getLocation_4(doc, new Point$El_0(doc.substrate.getParentElement(node), doc.substrate.getNextSibling(node)));
}

function start_4(doc, element){
  return $getLocation_4(doc, new Point$El_0(element, doc.substrate.getFirstChild_0(element)));
}

function RawAnnotationSet$AnnotationEvent(){
}

_ = RawAnnotationSet$AnnotationEvent.prototype = new Object_0;
_.getClass$ = function getClass_736(){
  return Lorg_waveprotocol_wave_model_document_indexed_RawAnnotationSet$AnnotationEvent_2_classLit;
}
;
_.castableTypeMap$ = {222:1};
_.index_0 = 0;
_.key = null;
function RawAnnotationSet$AnnotationEndEvent_0(index, key){
  this.index_0 = index;
  this.key = key;
}

function RawAnnotationSet$AnnotationEndEvent(){
}

_ = RawAnnotationSet$AnnotationEndEvent_0.prototype = RawAnnotationSet$AnnotationEndEvent.prototype = new RawAnnotationSet$AnnotationEvent;
_.getChangeKey = function getChangeKey(){
  return null;
}
;
_.getChangeOldValue = function getChangeOldValue(){
  return null;
}
;
_.getClass$ = function getClass_737(){
  return Lorg_waveprotocol_wave_model_document_indexed_RawAnnotationSet$AnnotationEndEvent_2_classLit;
}
;
_.getEndKey = function getEndKey(){
  return this.key;
}
;
_.toString$ = function toString_59(){
  return 'AnnotationEndEvent ' + this.key + ' @' + this.index_0;
}
;
_.castableTypeMap$ = {222:1};
function RawAnnotationSet$AnnotationStartEvent_0(index, key, value){
  this.index_0 = index;
  this.key = key;
  this.value_0 = value;
}

function RawAnnotationSet$AnnotationStartEvent(){
}

_ = RawAnnotationSet$AnnotationStartEvent_0.prototype = RawAnnotationSet$AnnotationStartEvent.prototype = new RawAnnotationSet$AnnotationEvent;
_.getChangeKey = function getChangeKey_0(){
  return this.key;
}
;
_.getChangeOldValue = function getChangeOldValue_0(){
  return this.value_0;
}
;
_.getClass$ = function getClass_738(){
  return Lorg_waveprotocol_wave_model_document_indexed_RawAnnotationSet$AnnotationStartEvent_2_classLit;
}
;
_.getEndKey = function getEndKey_0(){
  return null;
}
;
_.toString$ = function toString_60(){
  return 'AnnotationStart ' + this.key + '=' + this.value_0 + ' @' + this.index_0;
}
;
_.castableTypeMap$ = {222:1};
_.value_0 = null;
function StubModifiableAnnotations_0(){
}

function StubModifiableAnnotations(){
}

_ = StubModifiableAnnotations_0.prototype = StubModifiableAnnotations.prototype = new Object_0;
_.annotationIntervals = function annotationIntervals_3(start, end, keys){
  !keys && (keys = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringSetAdapter_0(new HashSet_0)));
  return new GenericAnnotationIntervalIterable_0(this, start, end, keys);
}
;
_.begin = function begin_6(){
}
;
_.delete_$ = function delete_$_0(deleteSize){
  this.size -= deleteSize;
}
;
_.endAnnotation = function endAnnotation_1(key){
}
;
_.finish = function finish_1(){
}
;
_.firstAnnotationChange = function firstAnnotationChange_3(start, end, key, fromValue){
  return -1;
}
;
_.forEachAnnotationAt = function forEachAnnotationAt_3(location_0, callback){
}
;
_.getAnnotation = function getAnnotation_3(start, key){
  return null;
}
;
_.getClass$ = function getClass_739(){
  return Lorg_waveprotocol_wave_model_document_indexed_StubModifiableAnnotations_2_classLit;
}
;
_.getInherited = function getInherited_0(key){
  return null;
}
;
_.insert = function insert_0(insertSize){
  this.size += insertSize;
}
;
_.knownKeysLive = function knownKeysLive_0(){
  return $clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringSetAdapter_0(new HashSet_0);
}
;
_.lastAnnotationChange = function lastAnnotationChange_3(start, end, key, fromValue){
  return -1;
}
;
_.rangedAnnotations = function rangedAnnotations_4(start, end, keys){
  !keys && (keys = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringSetAdapter_0(new HashSet_0)));
  return new GenericRangedAnnotationIterable_0(this, start, end, keys);
}
;
_.size_0 = function size_31(){
  return this.size;
}
;
_.skip = function skip_1(skipSize){
}
;
_.startAnnotation = function startAnnotation_1(key, value){
}
;
_.castableTypeMap$ = {};
_.size = 0;
function $clinit_1139(){
  $clinit_1139 = nullMethod;
  TRIPLET_COMPARATOR = new AnnotationBoundaryMapBuilder$1_0;
}

function AnnotationBoundaryMapBuilder_0(){
  $clinit_1139();
  this.endKeys = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringSetAdapter_0(new HashSet_0));
  this.changes = new CollectionUtils$StringMapAdapter_0(new HashMap_0);
}

function AnnotationBoundaryMapBuilder(){
}

_ = AnnotationBoundaryMapBuilder_0.prototype = AnnotationBoundaryMapBuilder.prototype = new Object_0;
_.getClass$ = function getClass_740(){
  return Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder_2_classLit;
}
;
_.castableTypeMap$ = {};
var TRIPLET_COMPARATOR;
function AnnotationBoundaryMapBuilder$1_0(){
}

function AnnotationBoundaryMapBuilder$1(){
}

_ = AnnotationBoundaryMapBuilder$1_0.prototype = AnnotationBoundaryMapBuilder$1.prototype = new Object_0;
_.compare = function compare_4(a_0, b){
  return compareTo_5(dynamicCast(a_0, 111).key, dynamicCast(b, 111).key);
}
;
_.getClass$ = function getClass_741(){
  return Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function AnnotationBoundaryMapBuilder$2_0(val$ends){
  this.val$ends = val$ends;
}

function AnnotationBoundaryMapBuilder$2(){
}

_ = AnnotationBoundaryMapBuilder$2_0.prototype = AnnotationBoundaryMapBuilder$2.prototype = new Object_0;
_.apply_3 = function apply_48(key){
  this.val$ends[this.i] = key;
  ++this.i;
}
;
_.getClass$ = function getClass_742(){
  return Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.i = 0;
_.val$ends = null;
function $apply_18(this$static, key, value){
  this$static.val$changes[this$static.i] = new AnnotationBoundaryMapBuilder$Triplet_0(key, dynamicCast(value.first, 1), dynamicCast(value.second, 1));
  ++this$static.i;
}

function AnnotationBoundaryMapBuilder$3_0(val$changes){
  this.val$changes = val$changes;
}

function AnnotationBoundaryMapBuilder$3(){
}

_ = AnnotationBoundaryMapBuilder$3_0.prototype = AnnotationBoundaryMapBuilder$3.prototype = new Object_0;
_.apply_0 = function apply_49(key, value){
  $apply_18(this, key, dynamicCast(value, 224));
}
;
_.getClass$ = function getClass_743(){
  return Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.i = 0;
_.val$changes = null;
function AnnotationBoundaryMapBuilder$AnnotationBoundaryMapImpl_0(ends, changes){
  this.ends = ends;
  this.changes = changes;
}

function AnnotationBoundaryMapBuilder$AnnotationBoundaryMapImpl(){
}

_ = AnnotationBoundaryMapBuilder$AnnotationBoundaryMapImpl_0.prototype = AnnotationBoundaryMapBuilder$AnnotationBoundaryMapImpl.prototype = new Object_0;
_.changeSize = function changeSize_0(){
  return this.changes.length;
}
;
_.endSize = function endSize_0(){
  return this.ends.length;
}
;
_.getChangeKey_0 = function getChangeKey_1(i){
  return this.changes[i].key;
}
;
_.getClass$ = function getClass_744(){
  return Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$AnnotationBoundaryMapImpl_2_classLit;
}
;
_.getEndKey_0 = function getEndKey_1(i){
  return this.ends[i];
}
;
_.getNewValue = function getNewValue(i){
  return this.changes[i].newValue;
}
;
_.getOldValue = function getOldValue(i){
  return this.changes[i].oldValue;
}
;
_.castableTypeMap$ = {235:1};
_.changes = null;
_.ends = null;
function AnnotationBoundaryMapBuilder$Triplet_0(key, oldValue, newValue){
  this.key = key;
  this.oldValue = oldValue;
  this.newValue = newValue;
}

function AnnotationBoundaryMapBuilder$Triplet(){
}

_ = AnnotationBoundaryMapBuilder$Triplet_0.prototype = AnnotationBoundaryMapBuilder$Triplet.prototype = new Object_0;
_.getClass$ = function getClass_745(){
  return Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$Triplet_2_classLit;
}
;
_.castableTypeMap$ = {111:1};
_.key = null;
_.newValue = null;
_.oldValue = null;
function $clinit_1145(){
  $clinit_1145 = nullMethod;
  EMPTY_MAP_0 = new AttributesImpl_0;
}

var EMPTY_MAP_0;
function Automatons$1_0(val$doc){
  this.val$doc = val$doc;
}

function Automatons$1(){
}

_ = Automatons$1_0.prototype = Automatons$1.prototype = new Object_0;
_.annotationsAt = function annotationsAt(pos){
  var annotations;
  checkElementIndex(pos, $size_10(this.val$doc));
  annotations = new Automatons$1$1AnnoMap_0;
  $each_3($knownKeys(this.val$doc), new Automatons$1$1_0(this.val$doc, pos, annotations));
  return annotations;
}
;
_.attributesAt = function attributesAt(pos){
  var el;
  el = elementAfter(this.val$doc, $locate_0(this.val$doc, pos));
  return el != null && (el == null?null:el) !== maskUndefined(this.val$doc.substrate.getDocumentElement())?new AttributesImpl_1(this.val$doc.substrate.getAttributes(el)):null;
}
;
_.charAt_0 = function charAt(pos){
  var str;
  str = getText(this.val$doc, pos, pos + 1);
  return str.length > 0?str.charCodeAt(0):-1;
}
;
_.elementEndingAt = function elementEndingAt(pos){
  var el;
  el = elementEndingAt_1(this.val$doc, $locate_0(this.val$doc, pos));
  return el != null && (el == null?null:el) !== maskUndefined(this.val$doc.substrate.getDocumentElement())?this.val$doc.substrate.getTagName(el):null;
}
;
_.elementStartingAt = function elementStartingAt(pos){
  var el;
  el = elementAfter(this.val$doc, $locate_0(this.val$doc, pos));
  return el != null && (el == null?null:el) !== maskUndefined(this.val$doc.substrate.getDocumentElement())?this.val$doc.substrate.getTagName(el):null;
}
;
_.firstAnnotationChange_0 = function firstAnnotationChange_4(start, end, key, fromValue){
  return $firstAnnotationChange_1(this.val$doc, start, end, key, fromValue);
}
;
_.getAnnotation_0 = function getAnnotation_4(pos, key){
  return $getAnnotation_2(this.val$doc, pos, key);
}
;
_.getClass$ = function getClass_746(){
  return Lorg_waveprotocol_wave_model_document_operation_Automatons$1_2_classLit;
}
;
_.length_1 = function length_1(){
  return $size_10(this.val$doc);
}
;
_.nthEnclosingElementTag = function nthEnclosingElementTag(insertionPoint, depth){
  var el;
  el = enclosingElement(this.val$doc, $locate_0(this.val$doc, insertionPoint).container);
  while (depth > 0 && el != null && (el == null?null:el) !== maskUndefined(this.val$doc.substrate.getDocumentElement())) {
    el = this.val$doc.substrate.getParentElement(el);
  }
  return el != null && (el == null?null:el) !== maskUndefined(this.val$doc.substrate.getDocumentElement())?this.val$doc.substrate.getTagName(el):null;
}
;
_.toString$ = function toString_61(){
  return 'Automatons.fromReadable(): ' + this.val$doc;
}
;
_.castableTypeMap$ = {};
_.val$doc = null;
function Automatons$1$1_0(val$doc, val$pos, val$annotations){
  this.val$doc = val$doc;
  this.val$pos = val$pos;
  this.val$annotations = val$annotations;
}

function Automatons$1$1(){
}

_ = Automatons$1$1_0.prototype = Automatons$1$1.prototype = new Object_0;
_.apply_3 = function apply_50(key){
  var value;
  value = $getAnnotation_2(this.val$doc, this.val$pos, key);
  value != null && $put(this.val$annotations, key, value);
}
;
_.getClass$ = function getClass_747(){
  return Lorg_waveprotocol_wave_model_document_operation_Automatons$1$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$annotations = null;
_.val$doc = null;
_.val$pos = 0;
function Automatons$1$1AnnoMap_0(){
  $clearImpl(this);
}

function Automatons$1$1AnnoMap(){
}

_ = Automatons$1$1AnnoMap_0.prototype = Automatons$1$1AnnoMap.prototype = new HashMap;
_.getClass$ = function getClass_748(){
  return Lorg_waveprotocol_wave_model_document_operation_Automatons$1$1AnnoMap_2_classLit;
}
;
_.updateWithNoCompatibilityCheck = function updateWithNoCompatibilityCheck(mutation){
  return dynamicCast($updateWith(new AnnotationMapImpl_1(this), mutation, false), 225);
}
;
_.castableTypeMap$ = {26:1, 58:1};
function $delete_0(this$static, size){
  this$static.scanPoint <= this$static.mutatingLocation && (this$static.mutatingLocation = max(this$static.scanPoint, this$static.mutatingLocation - size));
}

function $insert_2(this$static, size){
  if (this$static.scanPoint < this$static.mutatingLocation) {
    this$static.mutatingLocation += size;
    this$static.scanPoint += size;
  }
}

function LocationModifier_0(location_0){
  this.mutatingLocation = location_0;
}

function transformLocation(op, location_0){
  var modifier;
  modifier = new LocationModifier_0(location_0);
  op.apply_5(modifier);
  return modifier.mutatingLocation;
}

function LocationModifier(){
}

_ = LocationModifier_0.prototype = LocationModifier.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_1(m_0){
}
;
_.characters_0 = function characters_3(characters){
  $insert_2(this, characters.length);
}
;
_.deleteCharacters = function deleteCharacters_2(chars){
  $delete_0(this, chars.length);
}
;
_.deleteElementEnd = function deleteElementEnd_2(){
  this.scanPoint <= this.mutatingLocation && (this.mutatingLocation = max(this.scanPoint, this.mutatingLocation - 1));
}
;
_.deleteElementStart = function deleteElementStart_2(type, attributes){
  this.scanPoint <= this.mutatingLocation && (this.mutatingLocation = max(this.scanPoint, this.mutatingLocation - 1));
}
;
_.elementEnd = function elementEnd_2(){
  $insert_2(this, 1);
}
;
_.elementStart = function elementStart_2(type, attributes){
  $insert_2(this, 1);
}
;
_.getClass$ = function getClass_749(){
  return Lorg_waveprotocol_wave_model_document_operation_LocationModifier_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_2(oldAttributes, newAttributes){
  this.scanPoint += 1;
}
;
_.retain = function retain_1(itemCount){
  this.scanPoint += itemCount;
}
;
_.updateAttributes = function updateAttributes_2(attributesUpdate){
  this.scanPoint += 1;
}
;
_.castableTypeMap$ = {};
_.mutatingLocation = 0;
_.scanPoint = 0;
function $apply_19(this$static, document_0){
  var i, mutationComponent, mutationComponent$iterator;
  document_0.begin();
  if (!printing) {
    printing = true;
    printing = false;
  }
  i = 0;
  for (mutationComponent$iterator = new AbstractList$IteratorImpl_0(this$static.mutationList); mutationComponent$iterator.i < mutationComponent$iterator.this$0_0.size_0();) {
    mutationComponent = dynamicCast($next_6(mutationComponent$iterator), 226);
    ++i;
    mutationComponent.apply_7(document_0);
  }
  document_0.finish();
}

function Nindo_0(mutationList){
  this.mutationList = new ArrayList_1(mutationList);
}

function setAnnotation(start, end, key, value){
  var mutationList;
  mutationList = new ArrayList_2(0);
  if (start != end) {
    checkPositionIndexesInRange(start, end, 2147483647);
    start > 0 && $add_9(mutationList, new Nindo$Skip_0(start));
    $add_9(mutationList, new Nindo$StartAnnotation_0(key, value));
    $add_9(mutationList, new Nindo$Skip_0(end - start));
    $add_9(mutationList, new Nindo$EndAnnotation_0(key));
  }
  return new Nindo_0(mutationList);
}

function Nindo(){
}

_ = Nindo_0.prototype = Nindo.prototype = new Object_0;
_.getClass$ = function getClass_750(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo_2_classLit;
}
;
_.toString$ = function toString_62(){
  var builder;
  builder = new StringBuilder_0;
  $apply_19(this, new Nindo$1_0(builder));
  return builder.impl.string;
}
;
_.castableTypeMap$ = {};
_.mutationList = null;
var printing = false;
function Nindo$1_0(val$builder){
  this.val$builder = val$builder;
}

function Nindo$1(){
}

_ = Nindo$1_0.prototype = Nindo$1.prototype = new Object_0;
_.begin = function begin_7(){
  $append_8(this.val$builder, '{');
}
;
_.characters_0 = function characters_4(characters){
  var regex, replacement;
  $append_8(this.val$builder, '++"' + $replace_2((regex = $replaceAll('\\', '([/\\\\\\.\\*\\+\\?\\|\\(\\)\\[\\]\\{\\}$^])', '\\\\$1') , replacement = $replaceAll($replaceAll('\\\\', '\\\\', '\\\\\\\\'), '\\$', '\\\\$') , $replaceAll(characters, regex, replacement)), '"', '\\"') + '"; ');
}
;
_.deleteCharacters_0 = function deleteCharacters_3(deletionSize){
  $append_8(this.val$builder, '-- ' + deletionSize + '; ');
}
;
_.deleteElementEnd = function deleteElementEnd_3(){
  $append_8(this.val$builder, 'x>; ');
}
;
_.deleteElementStart_0 = function deleteElementStart_3(){
  $append_8(this.val$builder, 'x<; ');
}
;
_.elementEnd = function elementEnd_3(){
  $append_8(this.val$builder, '>>; ');
}
;
_.elementStart = function elementStart_3(tagName, attributes){
  $append_8(this.val$builder, '<< ' + tagName + ' ' + attributes + '; ');
}
;
_.endAnnotation = function endAnnotation_2(key){
  $append_8(this.val$builder, ')) ' + key + '; ');
}
;
_.finish = function finish_2(){
  $append_8(this.val$builder, '}');
}
;
_.getClass$ = function getClass_751(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$1_2_classLit;
}
;
_.replaceAttributes_0 = function replaceAttributes_3(attributes){
  $append_8(this.val$builder, 's@ ' + attributes + '; ');
}
;
_.skip = function skip_2(skipSize){
  $append_8(this.val$builder, '__' + skipSize + '; ');
}
;
_.startAnnotation_0 = function startAnnotation_2(key, value){
  var regex, replacement;
  $append_8(this.val$builder, '(( ' + key + '=' + (value == null?'null':'"' + $replace_2((regex = $replaceAll('\\', '([/\\\\\\.\\*\\+\\?\\|\\(\\)\\[\\]\\{\\}$^])', '\\\\$1') , replacement = $replaceAll($replaceAll('\\\\', '\\\\', '\\\\\\\\'), '\\$', '\\\\$') , $replaceAll(value, regex, replacement)), '"', '\\"') + '"') + '; ');
}
;
_.toString$ = function toString_63(){
  return this.val$builder.impl.string;
}
;
_.updateAttributes_0 = function updateAttributes_3(attributes){
  $append_8(this.val$builder, 'u@ ' + attributes + '; ');
}
;
_.castableTypeMap$ = {};
_.val$builder = null;
function Nindo$2_0(val$b){
  this.val$b = val$b;
}

function Nindo$2(){
}

_ = Nindo$2_0.prototype = Nindo$2.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_2(map){
  var i;
  for (i = 0; i < map.endSize(); ++i) {
    $add_9(this.val$b.mutationList, new Nindo$EndAnnotation_0(map.getEndKey_0(i)));
  }
  for (i = 0; i < map.changeSize(); ++i) {
    $add_9(this.val$b.mutationList, new Nindo$StartAnnotation_0(map.getChangeKey_0(i), map.getNewValue(i)));
  }
}
;
_.characters_0 = function characters_5(chars){
  $characters(this.val$b, chars);
}
;
_.deleteCharacters = function deleteCharacters_4(chars){
  $add_9(this.val$b.mutationList, new Nindo$DeleteCharacters_0(chars.length));
}
;
_.deleteElementEnd = function deleteElementEnd_4(){
  $add_9(this.val$b.mutationList, ($clinit_1165() , INSTANCE_11));
}
;
_.deleteElementStart = function deleteElementStart_4(type, attrs){
  $add_9(this.val$b.mutationList, ($clinit_1166() , INSTANCE_12));
}
;
_.elementEnd = function elementEnd_4(){
  $add_9(this.val$b.mutationList, ($clinit_1167() , INSTANCE_13));
}
;
_.elementStart = function elementStart_4(type, attrs){
  $add_9(this.val$b.mutationList, new Nindo$ElementStart_0(type, attrs));
}
;
_.getClass$ = function getClass_752(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$2_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_4(oldAttrs, newAttrs){
  $add_9(this.val$b.mutationList, new Nindo$ReplaceAttributes_0(newAttrs));
}
;
_.retain = function retain_2(itemCount){
  $add_9(this.val$b.mutationList, new Nindo$Skip_0(itemCount));
}
;
_.updateAttributes = function updateAttributes_4(attrUpdate){
  var i, updates;
  updates = new HashMap_0;
  for (i = 0; i < attrUpdate.updates.size_0(); ++i) {
    updates.put(dynamicCast(attrUpdate.updates.get_0(i), 220).name_0, dynamicCast(attrUpdate.updates.get_0(i), 220).newValue);
  }
  $add_9(this.val$b.mutationList, new Nindo$UpdateAttributes_0(updates));
}
;
_.castableTypeMap$ = {};
_.val$b = null;
function $buildWithoutTrailingSkip(this$static){
  var size;
  size = this$static.mutationList.size;
  size > 0 && instanceOf($get_3(this$static.mutationList, size - 1), 227) && $remove_10(this$static.mutationList, size - 1);
  return new Nindo_0(this$static.mutationList);
}

function $characters(this$static, characters){
  !characters.length || $add_9(this$static.mutationList, new Nindo$Characters_0(characters));
}

function Nindo$Builder_0(){
  this.mutationList = new ArrayList_0;
}

function Nindo$Builder(){
}

_ = Nindo$Builder_0.prototype = Nindo$Builder.prototype = new Object_0;
_.begin = function begin_8(){
  checkState(!this.hasBeenUsed, 'Cannot reuse a builder');
  this.hasBeenUsed = true;
}
;
_.characters_0 = function characters_6(characters){
  !characters.length || $add_9(this.mutationList, new Nindo$Characters_0(characters));
}
;
--></script>
<script><!--
_.deleteCharacters_0 = function deleteCharacters_5(deletionSize){
  $add_9(this.mutationList, new Nindo$DeleteCharacters_0(deletionSize));
}
;
_.deleteElementEnd = function deleteElementEnd_5(){
  $add_9(this.mutationList, ($clinit_1165() , INSTANCE_11));
}
;
_.deleteElementStart_0 = function deleteElementStart_5(){
  $add_9(this.mutationList, ($clinit_1166() , INSTANCE_12));
}
;
_.elementEnd = function elementEnd_5(){
  $add_9(this.mutationList, ($clinit_1167() , INSTANCE_13));
}
;
_.elementStart = function elementStart_5(tagName, attributes){
  $add_9(this.mutationList, new Nindo$ElementStart_0(tagName, attributes));
}
;
_.endAnnotation = function endAnnotation_3(key){
  $add_9(this.mutationList, new Nindo$EndAnnotation_0(key));
}
;
_.finish = function finish_3(){
}
;
_.getClass$ = function getClass_753(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$Builder_2_classLit;
}
;
_.replaceAttributes_0 = function replaceAttributes_5(attributes){
  $add_9(this.mutationList, new Nindo$ReplaceAttributes_0(attributes));
}
;
_.skip = function skip_3(skipSize){
  $add_9(this.mutationList, new Nindo$Skip_0(skipSize));
}
;
_.startAnnotation_0 = function startAnnotation_3(key, value){
  $add_9(this.mutationList, new Nindo$StartAnnotation_0(key, value));
}
;
_.updateAttributes_0 = function updateAttributes_5(attributes){
  $add_9(this.mutationList, new Nindo$UpdateAttributes_0(attributes));
}
;
_.castableTypeMap$ = {};
_.hasBeenUsed = false;
function Nindo$MutationComponent(){
}

_ = Nindo$MutationComponent.prototype = new Object_0;
_.getClass$ = function getClass_754(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$MutationComponent_2_classLit;
}
;
_.castableTypeMap$ = {226:1};
function Nindo$Characters_0(characters){
  this.characters = characters;
}

function Nindo$Characters(){
}

_ = Nindo$Characters_0.prototype = Nindo$Characters.prototype = new Nindo$MutationComponent;
_.apply_7 = function apply_51(document_0){
  document_0.characters_0(this.characters);
}
;
_.getClass$ = function getClass_755(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$Characters_2_classLit;
}
;
_.castableTypeMap$ = {226:1};
_.characters = null;
function Nindo$DeleteCharacters_0(deletionSize){
  this.deletionSize = deletionSize;
}

function Nindo$DeleteCharacters(){
}

_ = Nindo$DeleteCharacters_0.prototype = Nindo$DeleteCharacters.prototype = new Nindo$MutationComponent;
_.apply_7 = function apply_52(document_0){
  document_0.deleteCharacters_0(this.deletionSize);
}
;
_.getClass$ = function getClass_756(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$DeleteCharacters_2_classLit;
}
;
_.castableTypeMap$ = {226:1};
_.deletionSize = 0;
function $clinit_1165(){
  $clinit_1165 = nullMethod;
  INSTANCE_11 = new Nindo$DeleteElementEnd_0;
}

function Nindo$DeleteElementEnd_0(){
}

function Nindo$DeleteElementEnd(){
}

_ = Nindo$DeleteElementEnd_0.prototype = Nindo$DeleteElementEnd.prototype = new Nindo$MutationComponent;
_.apply_7 = function apply_53(document_0){
  document_0.deleteElementEnd();
}
;
_.getClass$ = function getClass_757(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$DeleteElementEnd_2_classLit;
}
;
_.castableTypeMap$ = {226:1};
var INSTANCE_11;
function $clinit_1166(){
  $clinit_1166 = nullMethod;
  INSTANCE_12 = new Nindo$DeleteElementStart_0;
}

function Nindo$DeleteElementStart_0(){
}

function Nindo$DeleteElementStart(){
}

_ = Nindo$DeleteElementStart_0.prototype = Nindo$DeleteElementStart.prototype = new Nindo$MutationComponent;
_.apply_7 = function apply_54(document_0){
  document_0.deleteElementStart_0();
}
;
_.getClass$ = function getClass_758(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$DeleteElementStart_2_classLit;
}
;
_.castableTypeMap$ = {226:1};
var INSTANCE_12;
function $clinit_1167(){
  $clinit_1167 = nullMethod;
  INSTANCE_13 = new Nindo$ElementEnd_0;
}

function Nindo$ElementEnd_0(){
}

function Nindo$ElementEnd(){
}

_ = Nindo$ElementEnd_0.prototype = Nindo$ElementEnd.prototype = new Nindo$MutationComponent;
_.apply_7 = function apply_55(document_0){
  document_0.elementEnd();
}
;
_.getClass$ = function getClass_759(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$ElementEnd_2_classLit;
}
;
_.castableTypeMap$ = {226:1};
var INSTANCE_13;
function Nindo$ElementStart_0(tagName, attributes){
  this.tagName_0 = tagName;
  this.attributes = attributes;
}

function Nindo$ElementStart(){
}

_ = Nindo$ElementStart_0.prototype = Nindo$ElementStart.prototype = new Nindo$MutationComponent;
_.apply_7 = function apply_56(document_0){
  document_0.elementStart(this.tagName_0, this.attributes);
}
;
_.getClass$ = function getClass_760(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$ElementStart_2_classLit;
}
;
_.castableTypeMap$ = {226:1};
_.attributes = null;
_.tagName_0 = null;
function Nindo$EndAnnotation_0(key){
  checkNotNull_1(key, 'Null annotation key');
  this.key = key;
}

function Nindo$EndAnnotation(){
}

_ = Nindo$EndAnnotation_0.prototype = Nindo$EndAnnotation.prototype = new Nindo$MutationComponent;
_.apply_7 = function apply_57(document_0){
  document_0.endAnnotation(this.key);
}
;
_.getClass$ = function getClass_761(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$EndAnnotation_2_classLit;
}
;
_.castableTypeMap$ = {226:1};
_.key = null;
function Nindo$ReplaceAttributes_0(attributes){
  this.attributes = attributes;
}

function Nindo$ReplaceAttributes(){
}

_ = Nindo$ReplaceAttributes_0.prototype = Nindo$ReplaceAttributes.prototype = new Nindo$MutationComponent;
_.apply_7 = function apply_58(document_0){
  document_0.replaceAttributes_0(this.attributes);
}
;
_.getClass$ = function getClass_762(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$ReplaceAttributes_2_classLit;
}
;
_.castableTypeMap$ = {226:1};
_.attributes = null;
function Nindo$Skip_0(skipSize){
  this.skipSize = skipSize;
}

function Nindo$Skip(){
}

_ = Nindo$Skip_0.prototype = Nindo$Skip.prototype = new Nindo$MutationComponent;
_.apply_7 = function apply_59(document_0){
  document_0.skip(this.skipSize);
}
;
_.getClass$ = function getClass_763(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$Skip_2_classLit;
}
;
_.castableTypeMap$ = {226:1, 227:1};
_.skipSize = 0;
function Nindo$StartAnnotation_0(key, value){
  checkNotNull_1(key, 'Null annotation key');
  this.key = key;
  this.value_0 = value;
}

function Nindo$StartAnnotation(){
}

_ = Nindo$StartAnnotation_0.prototype = Nindo$StartAnnotation.prototype = new Nindo$MutationComponent;
_.apply_7 = function apply_60(document_0){
  document_0.startAnnotation_0(this.key, this.value_0);
}
;
_.getClass$ = function getClass_764(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$StartAnnotation_2_classLit;
}
;
_.castableTypeMap$ = {226:1};
_.key = null;
_.value_0 = null;
function Nindo$UpdateAttributes_0(update){
  this.attributesUpdate = update;
}

function Nindo$UpdateAttributes(){
}

_ = Nindo$UpdateAttributes_0.prototype = Nindo$UpdateAttributes.prototype = new Nindo$MutationComponent;
_.apply_7 = function apply_61(document_0){
  document_0.updateAttributes_0(this.attributesUpdate);
}
;
_.getClass$ = function getClass_765(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$UpdateAttributes_2_classLit;
}
;
_.castableTypeMap$ = {226:1};
_.attributesUpdate = null;
function $addViolation(a_0, v){
  !!a_0 && $add_9(a_0.operationIllFormed, v);
  return $clinit_1267() , ILL_FORMED;
}

function $addViolation_0(a_0, v){
  !!a_0 && $add_9(a_0.operationInvalid, v);
  return $clinit_1267() , INVALID_DOCUMENT;
}

function $addViolation_1(a_0, v){
  !!a_0 && $add_9(a_0.schemaViolations, v);
  return $clinit_1267() , INVALID_SCHEMA;
}

function $canIncreaseLength(this$static, delta){
  return delta <= 429496729 - this$static.resultingLength;
}

function $checkChangeAttributes(this$static, attr, v, allowNullValues){
  var actualTag;
  if (this$static.stack_0.size != 0) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('attribute change inside insert or delete', this$static.effectivePos, this$static.resultingPos));
  }
  if ($effectiveDocSymbol(this$static) != ($clinit_1178() , OPEN)) {
    return $addViolation_0(v, new DocOpAutomaton$OperationInvalid_0('no element start to change attributes here', this$static.effectivePos, this$static.resultingPos));
  }
  actualTag = $effectiveDocSymbolTag(this$static);
  return $validateAttributes(this$static, actualTag, attr, v, allowNullValues);
}

function $checkCharacters(this$static, characters, v){
  var enclosingTag;
  if (characters == null) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('characters is null', this$static.effectivePos, this$static.resultingPos));
  }
  if (characters.length == 0) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('characters is empty', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.stack_0.size != 0 && !!dynamicCast($get_3(this$static.stack_0, this$static.stack_0.size - 1), 228).asDeleteElement()) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('insertion inside deletion', this$static.effectivePos, this$static.resultingPos));
  }
  enclosingTag = $effectiveEnclosingElementTag(this$static);
  if (!$tagAllowsText(this$static, enclosingTag)) {
    return $addViolation_1(v, new DocOpAutomaton$SchemaViolation_0('element type ' + enclosingTag + ' does not allow text content', this$static.effectivePos, this$static.resultingPos));
  }
  if (!$canIncreaseLength(this$static, characters.length)) {
    return $addViolation_0(v, new DocOpAutomaton$OperationInvalid_0('intermediate or final document too long', this$static.effectivePos, this$static.resultingPos));
  }
  return $clinit_1267() , VALID;
}

function $checkDeleteCharacters(this$static, count, v){
  var available;
  if (count <= 0) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('delete length not positive', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.stack_0.size != 0 && !!dynamicCast($get_3(this$static.stack_0, this$static.stack_0.size - 1), 228).asInsertElement()) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('deletion inside insertion', this$static.effectivePos, this$static.resultingPos));
  }
  available = remainingCharactersInElement(this$static.doc, this$static.effectivePos);
  if (count > available) {
    return $addViolation_0(v, new DocOpAutomaton$OperationInvalid_0('cannot delete ' + count + ' characters, only ' + available + ' available', this$static.effectivePos, this$static.resultingPos));
  }
  return $clinit_1267() , VALID;
}

function $checkDeleteElementEnd(this$static, v){
  if (!(this$static.stack_0.size != 0 && !!dynamicCast($get_3(this$static.stack_0, this$static.stack_0.size - 1), 228).asDeleteElement())) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('deleteElementEnd with no deleteElementStart', this$static.effectivePos, this$static.resultingPos));
  }
  if ($effectiveDocSymbol(this$static) != ($clinit_1178() , CLOSE)) {
    return $addViolation_0(v, new DocOpAutomaton$OperationInvalid_0('no element end to delete here', this$static.effectivePos, this$static.resultingPos));
  }
  return $clinit_1267() , VALID;
}

function $checkDeleteElementStart(this$static, v){
  if (this$static.stack_0.size != 0 && !!dynamicCast($get_3(this$static.stack_0, this$static.stack_0.size - 1), 228).asInsertElement()) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('deletion inside insertion', this$static.effectivePos, this$static.resultingPos));
  }
  if ($effectiveDocSymbol(this$static) != ($clinit_1178() , OPEN)) {
    return $addViolation_0(v, new DocOpAutomaton$OperationInvalid_0('no element start to delete here', this$static.effectivePos, this$static.resultingPos));
  }
  return $clinit_1267() , VALID;
}

function $checkElementEnd(this$static, v){
  if (!(this$static.stack_0.size != 0 && !!dynamicCast($get_3(this$static.stack_0, this$static.stack_0.size - 1), 228).asInsertElement())) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('elementEnd with no elementStart', this$static.effectivePos, this$static.resultingPos));
  }
  return $clinit_1267() , VALID;
}

function $checkElementStart(this$static, tag, attr, v){
  var attrViolation, parentTag;
  if (tag == null) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('element type is null', this$static.effectivePos, this$static.resultingPos));
  }
  if (!isXmlName(tag)) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('element type is not an XML name: "' + tag + '"', this$static.effectivePos, this$static.resultingPos));
  }
  attrViolation = $validateAttributes(this$static, tag, attr, v, false);
  if (attrViolation != ($clinit_1267() , VALID)) {
    return attrViolation;
  }
  if (this$static.stack_0.size != 0 && !!dynamicCast($get_3(this$static.stack_0, this$static.stack_0.size - 1), 228).asDeleteElement()) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('insertion inside deletion', this$static.effectivePos, this$static.resultingPos));
  }
  if (2 > 429496729 - this$static.resultingLength) {
    return $addViolation_0(v, new DocOpAutomaton$OperationInvalid_0('intermediate or final document too long', this$static.effectivePos, this$static.resultingPos));
  }
  if ($effectiveDocSymbol(this$static) == ($clinit_1178() , END_0) && $effectiveEnclosingElementTag(this$static) == null && this$static.stack_0.size == 0 && this$static.resultingLength == 0) {
    return this$static.schemaConstraints.permitsChild(null, tag)?VALID:$addViolation_1(v, new DocOpAutomaton$SchemaViolation_0('type not permitted as root element', this$static.effectivePos, this$static.resultingPos));
  }
  parentTag = $effectiveEnclosingElementTag(this$static);
  if (parentTag == null) {
    if (!this$static.schemaConstraints.permitsChild(null, tag)) {
      return $addViolation_1(v, new DocOpAutomaton$SchemaViolation_0('type not permitted as root element', this$static.effectivePos, this$static.resultingPos));
    }
  }
   else {
    if (!this$static.schemaConstraints.permitsChild(parentTag, tag)) {
      return $addViolation_1(v, new DocOpAutomaton$SchemaViolation_0('element type ' + parentTag + ' does not permit subelement type ' + tag, this$static.effectivePos, this$static.resultingPos));
    }
  }
  return VALID;
}

function $checkEndAnnotation(this$static, key, v){
  var r;
  r = $validateAnnotationKey(this$static, key, v);
  if (r != ($clinit_1267() , VALID)) {
    return r;
  }
  if (!this$static.openAnnotationKeys.map.containsKey(key)) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('endAnnotation of key ' + key + ' with no startAnnotation', this$static.effectivePos, this$static.resultingPos));
  }
  return VALID;
}

function $checkFinish(this$static, v){
  var e, e$iterator, key, key$iterator, outerIter, entry;
  for (e$iterator = new AbstractList$IteratorImpl_0(this$static.stack_0); e$iterator.i < e$iterator.this$0_0.size_0();) {
    e = dynamicCast($next_6(e$iterator), 228);
    return e.notClosed(this$static, v);
  }
  for (key$iterator = (outerIter = $keySet(this$static.openAnnotationKeys.map).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter)); key$iterator.val$outerIter.hasNext();) {
    key = dynamicCast((entry = dynamicCast(key$iterator.val$outerIter.next_0(), 66) , entry.getKey()), 1);
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('startAnnotation of key ' + key + ' with no endAnnotation', this$static.effectivePos, this$static.resultingPos));
  }
  return $clinit_1267() , VALID;
}

function $checkSkip(this$static, distance, v){
  if (distance <= 0) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('skip distance not positive', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.stack_0.size != 0) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('skip inside insert or delete', this$static.effectivePos, this$static.resultingPos));
  }
  if (distance > (this$static.effectivePos >= $size_10(this$static.doc)?0:$size_10(this$static.doc) - this$static.effectivePos)) {
    return $addViolation_0(v, new DocOpAutomaton$OperationInvalid_0('skip past end of document', this$static.effectivePos, this$static.resultingPos));
  }
  return $clinit_1267() , VALID;
}

function $checkStartAnnotation(this$static, key, v){
  var r;
  r = $validateAnnotationKey(this$static, key, v);
  if (r != ($clinit_1267() , VALID)) {
    return r;
  }
  return VALID;
}

function $doCharacters_0(this$static, characters){
  this$static.resultingLength += characters.length;
  this$static.resultingPos += characters.length;
}

function $doDeleteCharacters_0(this$static, count){
  this$static.effectivePos += count;
  this$static.resultingLength -= count;
}

function $doDeleteElementEnd(this$static){
  $remove_10(this$static.stack_0, this$static.stack_0.size - 1);
  this$static.resultingLength -= 2;
  this$static.effectivePos += 1;
}

function $doDeleteElementStart(this$static){
  $add_9(this$static.stack_0, ($clinit_1177() , $clinit_1177() , instance_7));
  this$static.effectivePos += 1;
}

function $doElementEnd_0(this$static){
  $remove_10(this$static.stack_0, this$static.stack_0.size - 1);
  this$static.resultingPos += 1;
}

function $doElementStart_0(this$static, tag){
  $add_9(this$static.stack_0, new NindoAutomaton$InsertElement_0(tag));
  this$static.resultingLength += 2;
  this$static.resultingPos += 1;
}

function $doSetAttributes(this$static){
  this$static.effectivePos += 1;
  this$static.resultingPos += 1;
}

function $doSkip(this$static, distance){
  this$static.effectivePos += distance;
  this$static.resultingPos += distance;
}

function $doUpdateAttributes(this$static){
  this$static.effectivePos += 1;
  this$static.resultingPos += 1;
}

function $effectiveDocSymbol(this$static){
  var e;
  if (this$static.effectivePos >= $size_10(this$static.doc)) {
    return $clinit_1178() , END_0;
  }
  e = $elementStartingHere(this$static);
  if (e != null) {
    return $clinit_1178() , OPEN;
  }
  e = $elementEndingNext(this$static);
  if (e != null) {
    return $clinit_1178() , CLOSE;
  }
  return $clinit_1178() , CHARACTER_1;
}

function $effectiveDocSymbolTag(this$static){
  var tag;
  switch ($effectiveDocSymbol(this$static).ordinal) {
    case 1:
      {
        tag = this$static.doc.substrate.getTagName($elementStartingHere(this$static));
        return tag;
      }

    case 2:
      {
        tag = this$static.doc.substrate.getTagName($elementEndingNext(this$static));
        return tag;
      }

    default:throw new IllegalStateException_1('not at tag');
  }
}

function $effectiveEnclosingElement(this$static){
  var e, e$iterator;
  if (this$static.effectivePos == 0 || this$static.effectivePos >= $size_10(this$static.doc)) {
    return null;
  }
  if (this$static.stack_0.size == 0) {
    return nthEnclosingElement(this$static.doc, this$static.effectivePos);
  }
   else {
    !!dynamicCast($get_3(this$static.stack_0, this$static.stack_0.size - 1), 228).asInsertElement();
    if (dynamicCast($get_3(this$static.stack_0, this$static.stack_0.size - 1), 228).asDeleteElement()) {
      for (e$iterator = new AbstractList$IteratorImpl_0(this$static.stack_0); e$iterator.i < e$iterator.this$0_0.size_0();) {
        e = dynamicCast($next_6(e$iterator), 228);
        !!e.asDeleteElement();
      }
      e = nthEnclosingElement(this$static.doc, this$static.effectivePos);
      return e;
    }
    throw new RuntimeException_1('unexpected top of stack: ' + dynamicCast($get_3(this$static.stack_0, this$static.stack_0.size - 1), 228));
  }
}

function $effectiveEnclosingElementTag(this$static){
  var e;
  if (this$static.stack_0.size != 0 && !!dynamicCast($get_3(this$static.stack_0, this$static.stack_0.size - 1), 228).asInsertElement()) {
    return dynamicCast($get_3(this$static.stack_0, this$static.stack_0.size - 1), 228).asInsertElement().tag;
  }
   else {
    e = $effectiveEnclosingElement(this$static);
    return e == null?null:this$static.doc.substrate.getTagName(e);
  }
}

function $elementEndingNext(this$static){
  var elementHere, elementNext, root;
  checkPositionIndex(this$static.effectivePos, $size_10(this$static.doc));
  if (this$static.effectivePos == 0) {
    return null;
  }
  if (this$static.effectivePos == $size_10(this$static.doc)) {
    return null;
  }
  if (this$static.effectivePos == $size_10(this$static.doc) - 1) {
    root = this$static.doc.substrate.getDocumentElement();
    return root;
  }
  $locate_0(this$static.doc, this$static.effectivePos);
  elementHere = enclosingElement(this$static.doc, $locate_0(this$static.doc, this$static.effectivePos).container);
  elementNext = enclosingElement(this$static.doc, $locate_0(this$static.doc, this$static.effectivePos + 1).container);
  if (elementHere == null) {
    return null;
  }
  return maskUndefined(this$static.doc.substrate.getParentElement(elementHere)) !== (elementNext == null?null:elementNext)?null:elementHere;
}

function $elementStartingHere(this$static){
  var elementHere, elementNext;
  checkPositionIndex(this$static.effectivePos, $size_10(this$static.doc));
  if (this$static.effectivePos + 1 >= $size_10(this$static.doc)) {
    return null;
  }
  elementHere = this$static.effectivePos == 0?this$static.doc.substrate.getDocumentElement():enclosingElement(this$static.doc, $locate_0(this$static.doc, this$static.effectivePos).container);
  elementNext = enclosingElement(this$static.doc, $locate_0(this$static.doc, this$static.effectivePos + 1).container);
  if (elementNext == null) {
    return null;
  }
  return (elementHere == null?null:elementHere) !== maskUndefined(this$static.doc.substrate.getParentElement(elementNext))?null:elementNext;
}

function $tagAllowsText(this$static, tag){
  switch (this$static.schemaConstraints.permittedCharacters(tag).ordinal) {
    case 2:
      return true;
    case 1:
      return true;
    case 0:
      return false;
    default:throw new AssertionError_0('unexpected return value from permittedCharacters');
  }
}

function $validateAnnotationKey(this$static, key, v){
  if (key == null) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('annotation key is null', this$static.effectivePos, this$static.resultingPos));
  }
  return $clinit_1267() , VALID;
}

function $validateAttributes(this$static, tag, attr, v, allowRemovals){
  var e, e$iterator, key, value;
  if (!attr) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('attributes is null', this$static.effectivePos, this$static.resultingPos));
  }
  for (e$iterator = attr.entrySet_0().iterator_0(); e$iterator.hasNext();) {
    e = dynamicCast(e$iterator.next_0(), 66);
    key = dynamicCast(e.getKey(), 1);
    value = dynamicCast(e.getValue(), 1);
    if (key == null) {
      return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('attribute key is null', this$static.effectivePos, this$static.resultingPos));
    }
    if (!isXmlName(key)) {
      return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('attribute key is not an XML name: "' + key + '"', this$static.effectivePos, this$static.resultingPos));
    }
    if (value == null) {
      if (!allowRemovals) {
        return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('attribute value is null', this$static.effectivePos, this$static.resultingPos));
      }
      if (!this$static.schemaConstraints.permitsAttribute(tag, key)) {
        return $addViolation_1(v, new DocOpAutomaton$SchemaViolation_0('type ' + tag + ' does not permit attribute ' + key, this$static.effectivePos, this$static.resultingPos));
      }
    }
     else {
      if (!this$static.schemaConstraints.permitsAttribute_0(tag, key, value)) {
        return $addViolation_1(v, new DocOpAutomaton$SchemaViolation_0('type ' + tag + ' does not permit attribute ' + key + ' with value ' + value, this$static.effectivePos, this$static.resultingPos));
      }
    }
  }
  return $clinit_1267() , VALID;
}

function NindoAutomaton_0(schemaConstraints, doc){
  this.stack_0 = new ArrayList_0;
  this.openAnnotationKeys = new HashSet_0;
  this.schemaConstraints = schemaConstraints;
  this.doc = doc;
  this.resultingLength = ($checkSizeConsistency(doc, 'size') , doc.offsetList.root.offset);
}

function isXmlName(s){
  var i;
  if (s.length == 0) {
    return false;
  }
  if (!isXmlNameStartChar(s.charCodeAt(0))) {
    return false;
  }
  for (i = 1; i < s.length; ++i) {
    if (!isXmlNameChar(s.charCodeAt(i))) {
      return false;
    }
  }
  return true;
}

function isXmlNameChar(c){
  return c == 58 || 65 <= c && c <= 90 || c == 95 | (97 <= c && c <= 122) || 192 <= c && c <= 214 || 216 <= c && c <= 246 || 248 <= c && c <= 767 || 880 <= c && c <= 893 || 895 <= c && c <= 8191 || 8204 <= c && c <= 8205 || 8304 <= c && c <= 8591 || 11264 <= c && c <= 12271 || 12289 <= c && c <= 55295 || 63744 <= c && c <= 64975 || 65008 <= c && c <= 65533 || 65536 <= c && c <= 983039 || c == 45 || c == 46 || 48 <= c && c <= 57 || c == 183 || 768 <= c && c <= 879 || 8255 <= c && c <= 8256;
}

function isXmlNameStartChar(c){
  return c == 58 || 65 <= c && c <= 90 || c == 95 | (97 <= c && c <= 122) || 192 <= c && c <= 214 || 216 <= c && c <= 246 || 248 <= c && c <= 767 || 880 <= c && c <= 893 || 895 <= c && c <= 8191 || 8204 <= c && c <= 8205 || 8304 <= c && c <= 8591 || 11264 <= c && c <= 12271 || 12289 <= c && c <= 55295 || 63744 <= c && c <= 64975 || 65008 <= c && c <= 65533 || 65536 <= c && c <= 983039;
}

function nthEnclosingElement(doc, pos){
  var e;
  e = enclosingElement(doc, (checkPositionIndex(pos, doc.offsetList.root.offset) , $performActionAt(doc.offsetList, pos, doc.pointFinder)).container);
  return e;
}

function remainingCharactersInElement(doc, pos){
  var container, deletionPoint, next, nodeLength, offsetWithinNode, remainingChars;
  if (pos >= ($checkSizeConsistency(doc, 'size') , doc.offsetList.root.offset)) {
    return 0;
  }
  deletionPoint = (checkPositionIndex(pos, doc.offsetList.root.offset) , $performActionAt(doc.offsetList, pos, doc.pointFinder));
  if (deletionPoint.offset < 0) {
    return 0;
  }
  offsetWithinNode = $getTextOffset(deletionPoint);
  container = deletionPoint.container;
  nodeLength = getItemSize(doc, container);
  remainingChars = nodeLength - offsetWithinNode;
  while (true) {
    next = doc.substrate.getNextSibling(container);
    if (next == null || doc.substrate.getNodeType_0(next) != 3) {
      break;
    }
    remainingChars += getItemSize(doc, next);
    container = next;
  }
  return remainingChars;
}

function NindoAutomaton(){
}

_ = NindoAutomaton_0.prototype = NindoAutomaton.prototype = new Object_0;
_.getClass$ = function getClass_766(){
  return Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton_2_classLit;
}
;
_.castableTypeMap$ = {};
_.doc = null;
_.effectivePos = 0;
_.resultingLength = 0;
_.resultingPos = 0;
_.schemaConstraints = null;
function NindoAutomaton$StackEntry(){
}

_ = NindoAutomaton$StackEntry.prototype = new Object_0;
_.asDeleteElement = function asDeleteElement(){
  return null;
}
;
_.asInsertElement = function asInsertElement(){
  return null;
}
;
_.getClass$ = function getClass_767(){
  return Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton$StackEntry_2_classLit;
}
;
_.castableTypeMap$ = {228:1};
function $clinit_1177(){
  $clinit_1177 = nullMethod;
  instance_7 = new NindoAutomaton$DeleteElement_0;
}

function NindoAutomaton$DeleteElement_0(){
}

function NindoAutomaton$DeleteElement(){
}

_ = NindoAutomaton$DeleteElement_0.prototype = NindoAutomaton$DeleteElement.prototype = new NindoAutomaton$StackEntry;
_.asDeleteElement = function asDeleteElement_0(){
  return this;
}
;
_.getClass$ = function getClass_768(){
  return Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton$DeleteElement_2_classLit;
}
;
_.notClosed = function notClosed(a_0, v){
  return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('deleteElementStart with no deleteElementEnd', a_0.effectivePos, a_0.resultingPos));
}
;
_.castableTypeMap$ = {228:1};
var instance_7;
function $clinit_1178(){
  $clinit_1178 = nullMethod;
  CHARACTER_1 = new NindoAutomaton$DocSymbol_0('CHARACTER', 0);
  OPEN = new NindoAutomaton$DocSymbol_0('OPEN', 1);
  CLOSE = new NindoAutomaton$DocSymbol_0('CLOSE', 2);
  END_0 = new NindoAutomaton$DocSymbol_0('END', 3);
  $VALUES_47 = initValues(_3Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton$DocSymbol_2_classLit, {58:1, 138:1}, 112, [CHARACTER_1, OPEN, CLOSE, END_0]);
}

function NindoAutomaton$DocSymbol_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_48(){
  $clinit_1178();
  return $VALUES_47;
}

function NindoAutomaton$DocSymbol(){
}

_ = NindoAutomaton$DocSymbol_0.prototype = NindoAutomaton$DocSymbol.prototype = new Enum;
_.getClass$ = function getClass_769(){
  return Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton$DocSymbol_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 112:1};
var $VALUES_47, CHARACTER_1, CLOSE, END_0, OPEN;
function NindoAutomaton$InsertElement_0(tag){
  this.tag = tag;
}

function NindoAutomaton$InsertElement(){
}

_ = NindoAutomaton$InsertElement_0.prototype = NindoAutomaton$InsertElement.prototype = new NindoAutomaton$StackEntry;
_.asInsertElement = function asInsertElement_0(){
  return this;
}
;
_.getClass$ = function getClass_770(){
  return Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton$InsertElement_2_classLit;
}
;
_.notClosed = function notClosed_0(a_0, v){
  return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('elementStart with no elementEnd', a_0.effectivePos, a_0.resultingPos));
}
;
--></script>
<script><!--
_.castableTypeMap$ = {228:1};
_.tag = null;
function validate_0(doc, m_0, schema){
  var $e0, a_0, v;
  checkNotNull_1(schema, 'Schema constraints required, if not, use DocumentSchema.NO_SCHEMA_CONSTRAINTS');
  a_0 = new NindoAutomaton_0(schema, doc);
  v = new DocOpAutomaton$ViolationCollector_0;
  try {
    $apply_19(m_0, new NindoValidator$1_0(a_0, v));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 229)) {
      return v;
    }
     else 
      throw $e0;
  }
  if ($checkFinish(a_0, v) == ($clinit_1267() , ILL_FORMED)) {
    return v;
  }
  return v;
}

function NindoValidator$1_0(val$a, val$v){
  this.val$a = val$a;
  this.val$v = val$v;
}

function NindoValidator$1(){
}

_ = NindoValidator$1_0.prototype = NindoValidator$1.prototype = new Object_0;
_.begin = function begin_9(){
}
;
_.characters_0 = function characters_7(s){
  if ($checkCharacters(this.val$a, s, this.val$v) == ($clinit_1267() , ILL_FORMED)) {
    throw new NindoValidator$IllFormed_0;
  }
  $doCharacters_0(this.val$a, s);
}
;
_.deleteCharacters_0 = function deleteCharacters_6(n){
  if ($checkDeleteCharacters(this.val$a, n, this.val$v) == ($clinit_1267() , ILL_FORMED)) {
    throw new NindoValidator$IllFormed_0;
  }
  $doDeleteCharacters_0(this.val$a, n);
}
;
_.deleteElementEnd = function deleteElementEnd_6(){
  if ($checkDeleteElementEnd(this.val$a, this.val$v) == ($clinit_1267() , ILL_FORMED)) {
    throw new NindoValidator$IllFormed_0;
  }
  $doDeleteElementEnd(this.val$a);
}
;
_.deleteElementStart_0 = function deleteElementStart_6(){
  if ($checkDeleteElementStart(this.val$a, this.val$v) == ($clinit_1267() , ILL_FORMED)) {
    throw new NindoValidator$IllFormed_0;
  }
  $doDeleteElementStart(this.val$a);
}
;
_.elementEnd = function elementEnd_6(){
  if ($checkElementEnd(this.val$a, this.val$v) == ($clinit_1267() , ILL_FORMED)) {
    throw new NindoValidator$IllFormed_0;
  }
  $doElementEnd_0(this.val$a);
}
;
_.elementStart = function elementStart_6(tagName, attributes){
  if ($checkElementStart(this.val$a, tagName, attributes, this.val$v) == ($clinit_1267() , ILL_FORMED)) {
    throw new NindoValidator$IllFormed_0;
  }
  $doElementStart_0(this.val$a, tagName);
}
;
_.endAnnotation = function endAnnotation_4(key){
  if ($checkEndAnnotation(this.val$a, key, this.val$v) == ($clinit_1267() , ILL_FORMED)) {
    throw new NindoValidator$IllFormed_0;
  }
  this.val$a.openAnnotationKeys.map.remove_2(key) != null;
}
;
_.finish = function finish_4(){
}
;
_.getClass$ = function getClass_771(){
  return Lorg_waveprotocol_wave_model_document_operation_NindoValidator$1_2_classLit;
}
;
_.replaceAttributes_0 = function replaceAttributes_6(attributes){
  if ($checkChangeAttributes(this.val$a, attributes, this.val$v, false) == ($clinit_1267() , ILL_FORMED)) {
    throw new NindoValidator$IllFormed_0;
  }
  $doSetAttributes(this.val$a);
}
;
_.skip = function skip_4(n){
  if ($checkSkip(this.val$a, n, this.val$v) == ($clinit_1267() , ILL_FORMED)) {
    throw new NindoValidator$IllFormed_0;
  }
  $doSkip(this.val$a, n);
}
;
_.startAnnotation_0 = function startAnnotation_4(key, value){
  if ($checkStartAnnotation(this.val$a, key, this.val$v) == ($clinit_1267() , ILL_FORMED)) {
    throw new NindoValidator$IllFormed_0;
  }
  $add_11(this.val$a.openAnnotationKeys, key);
}
;
_.updateAttributes_0 = function updateAttributes_6(attributes){
  if ($checkChangeAttributes(this.val$a, attributes, this.val$v, true) == ($clinit_1267() , ILL_FORMED)) {
    throw new NindoValidator$IllFormed_0;
  }
  $doUpdateAttributes(this.val$a);
}
;
_.castableTypeMap$ = {};
_.val$a = null;
_.val$v = null;
function NindoValidator$IllFormed_0(){
  this.fillInStackTrace();
}

function NindoValidator$IllFormed(){
}

_ = NindoValidator$IllFormed_0.prototype = NindoValidator$IllFormed.prototype = new RuntimeException;
_.getClass$ = function getClass_772(){
  return Lorg_waveprotocol_wave_model_document_operation_NindoValidator$IllFormed_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1, 229:1};
function $annotationBoundary(this$static, map){
  var changeSize, endSize, i;
  changeSize = map.changeSize();
  for (i = 0; i < changeSize; ++i) {
    $put_0(this$static.annotationChanges, map.getChangeKey_0(i), new AnnotationsNormalizer$AnnotationChangeValues_0(map.getOldValue(i), map.getNewValue(i)));
  }
  endSize = map.endSize();
  for (i = 0; i < endSize; ++i) {
    $put_0(this$static.annotationChanges, map.getEndKey_0(i), null);
  }
}

function $characters_0(this$static, chars){
  if (chars.length) {
    $flushAnnotations(this$static);
    this$static.target_0.characters_0(chars);
  }
}

function $deleteCharacters_0(this$static, chars){
  if (chars.length) {
    $flushAnnotations(this$static);
    this$static.target_0.deleteCharacters(chars);
  }
}

function $deleteElementEnd_0(this$static){
  $flushAnnotations(this$static);
  this$static.target_0.deleteElementEnd();
}

function $deleteElementStart_0(this$static, type, attrs){
  $flushAnnotations(this$static);
  this$static.target_0.deleteElementStart(type, attrs);
}

function $elementEnd_0(this$static){
  $flushAnnotations(this$static);
  this$static.target_0.elementEnd();
}

function $elementStart_0(this$static, type, attrs){
  $flushAnnotations(this$static);
  this$static.target_0.elementStart(type, attrs);
}

function $finish_1(this$static){
  $flushAnnotations(this$static);
  return this$static.target_0.finish_0();
}

function $flushAnnotations(this$static){
  var change, change$iterator, changes, ends, key, previousValues, values, entry;
  changes = new ArrayList_0;
  ends = new ArrayList_0;
  for (change$iterator = new TreeMap$EntryIterator_0((new TreeMap$EntrySet_0(this$static.annotationChanges)).this$0); $hasNext_3(change$iterator.iter);) {
    change = change$iterator.last = dynamicCast($next_6(change$iterator.iter), 66);
    key = dynamicCast(change.getKey(), 1);
    values = dynamicCast(change.getValue(), 230);
    previousValues = dynamicCast((entry = $getEntry(this$static.annotationTracker, key) , entry?entry.value_0:null), 230);
    if (!values) {
      if (previousValues) {
        $remove_17(this$static.annotationTracker, key);
        setCheck(ends.array, ends.size++, key);
      }
    }
     else {
      if (!previousValues || !equal_0(values.oldValue, previousValues.oldValue) || !equal_0(values.newValue, previousValues.newValue)) {
        $put_0(this$static.annotationTracker, key, values);
        $add_9(changes, new AnnotationsNormalizer$AnnotationChange_0(key, values.oldValue, values.newValue));
      }
    }
  }
  (changes.size != 0 || ends.size != 0) && this$static.target_0.annotationBoundary(new AnnotationsNormalizer$1_0(changes, ends));
  $clear_7(this$static.annotationChanges);
}

function $replaceAttributes_0(this$static, oldAttrs, newAttrs){
  $flushAnnotations(this$static);
  this$static.target_0.replaceAttributes(oldAttrs, newAttrs);
}

function $retain_0(this$static, itemCount){
  if (itemCount > 0) {
    $flushAnnotations(this$static);
    this$static.target_0.retain(itemCount);
  }
}

function $updateAttributes_0(this$static, attrUpdate){
  $flushAnnotations(this$static);
  this$static.target_0.updateAttributes(attrUpdate);
}

function AnnotationsNormalizer_0(target){
  this.annotationTracker = new TreeMap_0;
  this.annotationChanges = new TreeMap_0;
  this.target_0 = target;
}

function AnnotationsNormalizer(){
}

_ = AnnotationsNormalizer_0.prototype = AnnotationsNormalizer.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_3(map){
  $annotationBoundary(this, map);
}
;
_.characters_0 = function characters_8(chars){
  $characters_0(this, chars);
}
;
_.deleteCharacters = function deleteCharacters_7(chars){
  $deleteCharacters_0(this, chars);
}
;
_.deleteElementEnd = function deleteElementEnd_7(){
  $flushAnnotations(this);
  this.target_0.deleteElementEnd();
}
;
_.deleteElementStart = function deleteElementStart_7(type, attrs){
  $flushAnnotations(this);
  this.target_0.deleteElementStart(type, attrs);
}
;
_.elementEnd = function elementEnd_7(){
  $flushAnnotations(this);
  this.target_0.elementEnd();
}
;
_.elementStart = function elementStart_7(type, attrs){
  $flushAnnotations(this);
  this.target_0.elementStart(type, attrs);
}
;
_.finish_0 = function finish_5(){
  return $flushAnnotations(this) , this.target_0.finish_0();
}
;
_.getClass$ = function getClass_773(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_AnnotationsNormalizer_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_7(oldAttrs, newAttrs){
  $flushAnnotations(this);
  this.target_0.replaceAttributes(oldAttrs, newAttrs);
}
;
_.retain = function retain_3(itemCount){
  $retain_0(this, itemCount);
}
;
_.updateAttributes = function updateAttributes_7(attrUpdate){
  $flushAnnotations(this);
  this.target_0.updateAttributes(attrUpdate);
}
;
_.castableTypeMap$ = {};
_.target_0 = null;
function AnnotationsNormalizer$1_0(val$changes, val$ends){
  this.val$changes = val$changes;
  this.val$ends = val$ends;
}

function AnnotationsNormalizer$1(){
}

_ = AnnotationsNormalizer$1_0.prototype = AnnotationsNormalizer$1.prototype = new Object_0;
_.changeSize = function changeSize_1(){
  return this.val$changes.size;
}
;
_.endSize = function endSize_1(){
  return this.val$ends.size;
}
;
_.getChangeKey_0 = function getChangeKey_2(changeIndex){
  return dynamicCast($get_3(this.val$changes, changeIndex), 231).key;
}
;
_.getClass$ = function getClass_774(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_AnnotationsNormalizer$1_2_classLit;
}
;
_.getEndKey_0 = function getEndKey_2(endIndex){
  return dynamicCast($get_3(this.val$ends, endIndex), 1);
}
;
_.getNewValue = function getNewValue_0(changeIndex){
  return dynamicCast($get_3(this.val$changes, changeIndex), 231).newValue;
}
;
_.getOldValue = function getOldValue_0(changeIndex){
  return dynamicCast($get_3(this.val$changes, changeIndex), 231).oldValue;
}
;
_.castableTypeMap$ = {235:1};
_.val$changes = null;
_.val$ends = null;
function AnnotationsNormalizer$AnnotationChange_0(key, oldValue, newValue){
  this.key = key;
  this.oldValue = oldValue;
  this.newValue = newValue;
}

function AnnotationsNormalizer$AnnotationChange(){
}

_ = AnnotationsNormalizer$AnnotationChange_0.prototype = AnnotationsNormalizer$AnnotationChange.prototype = new Object_0;
_.getClass$ = function getClass_775(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_AnnotationsNormalizer$AnnotationChange_2_classLit;
}
;
_.castableTypeMap$ = {231:1};
_.key = null;
_.newValue = null;
_.oldValue = null;
function AnnotationsNormalizer$AnnotationChangeValues_0(oldValue, newValue){
  this.oldValue = oldValue;
  this.newValue = newValue;
}

function AnnotationsNormalizer$AnnotationChangeValues(){
}

_ = AnnotationsNormalizer$AnnotationChangeValues_0.prototype = AnnotationsNormalizer$AnnotationChangeValues.prototype = new Object_0;
_.getClass$ = function getClass_776(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_AnnotationsNormalizer$AnnotationChangeValues_2_classLit;
}
;
_.castableTypeMap$ = {230:1};
_.newValue = null;
_.oldValue = null;
function $composeOperations(this$static, op1, op2){
  var op1Index, op2Index, size, size_0;
  this$static.target_0 = this$static.defaultTarget;
  op1Index = 0;
  op2Index = 0;
  while (op1Index < op1.size_0()) {
    op1.applyComponent(op1Index++, this$static.target_0);
    while (this$static.target_0.isPostTarget()) {
      if (op2Index >= op2.size_0()) {
        throw new OperationException_0('Document size mismatch: op1 resulting length=' + (size = initValues(_3I_classLit, {58:1}, -1, [0]) , op1.apply_5(new DocOpUtil$5_0(size)) , size[0]) + ', op2 initial length=' + (size_0 = initValues(_3I_classLit, {58:1}, -1, [0]) , op2.apply_5(new DocOpUtil$4_0(size_0)) , size_0[0]));
      }
      op2.applyComponent(op2Index++, this$static.target_0);
    }
  }
  if (op2Index < op2.size_0()) {
    this$static.target_0 = new Composer$FinisherPostTarget_0(this$static);
    while (op2Index < op2.size_0()) {
      op2.applyComponent(op2Index++, this$static.target_0);
    }
  }
  $flush_6(this$static.preAnnotationQueue);
  $flush_6(this$static.postAnnotationQueue);
  return dynamicCast($finish_1(this$static.normalizer), 173);
}

function $flushAnnotations_0(this$static){
  $flush_6(this$static.preAnnotationQueue);
  $flush_6(this$static.postAnnotationQueue);
}

function Composer_0(cursor){
  this.preAnnotations = new HashMap_0;
  this.postAnnotations = new HashMap_0;
  this.preAnnotationQueue = new Composer$1_0(this);
  this.postAnnotationQueue = new Composer$2_0(this);
  this.defaultTarget = new Composer$DefaultPreTarget_0(this);
  this.normalizer = new AnnotationsNormalizer_0(new RangeNormalizer_0(cursor));
}

function compose(op1, op2){
  var $e0, e;
  try {
    return $composeOperations(new Composer_0(new DocOpBuffer_0), op1, op2);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 232)) {
      e = $e0;
      throw new OperationException_0(e.detailMessage);
    }
     else 
      throw $e0;
  }
}

function compose_0(operations){
  var collector, operation, operation$iterator;
  collector = new DocOpCollector_0;
  for (operation$iterator = new AbstractList$IteratorImpl_0(operations); operation$iterator.i < operation$iterator.this$0_0.size_0();) {
    operation = dynamicCast($next_6(operation$iterator), 173);
    $add_18(collector, operation);
  }
  return $composeAll(collector);
}

function invertUpdate(attrUpdate){
  var i, inverseUpdate;
  inverseUpdate = new AttributesUpdateImpl_0;
  for (i = 0; i < attrUpdate.updates.size_0(); ++i) {
    inverseUpdate = $composeWith(inverseUpdate, new AttributesUpdateImpl_1(initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, [dynamicCast(attrUpdate.updates.get_0(i), 220).name_0, dynamicCast(attrUpdate.updates.get_0(i), 220).newValue, dynamicCast(attrUpdate.updates.get_0(i), 220).oldValue])));
  }
  return inverseUpdate;
}

function Composer(){
}

_ = Composer_0.prototype = Composer.prototype = new Object_0;
_.getClass$ = function getClass_777(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer_2_classLit;
}
;
_.castableTypeMap$ = {};
_.normalizer = null;
_.target_0 = null;
function $flush_6(this$static){
  var map, map$iterator;
  for (map$iterator = new AbstractList$IteratorImpl_0(this$static.events); map$iterator.i < map$iterator.this$0_0.size_0();) {
    map = dynamicCast($next_6(map$iterator), 235);
    this$static.unqueue(map);
  }
  $clear_2(this$static.events);
}

function Composer$AnnotationQueue(){
}

_ = Composer$AnnotationQueue.prototype = new Object_0;
_.getClass$ = function getClass_778(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$AnnotationQueue_2_classLit;
}
;
_.castableTypeMap$ = {};
function Composer$1_0(this$0){
  this.this$0 = this$0;
  this.events = new ArrayList_0;
}

function Composer$1(){
}

_ = Composer$1_0.prototype = Composer$1.prototype = new Composer$AnnotationQueue;
_.getClass$ = function getClass_779(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$1_2_classLit;
}
;
_.unqueue = function unqueue(map){
  var changeKeys, changeNewValues, changeOldValues, endKeys, i, key, newValue, oldValue, postValues;
  endKeys = new ArrayList_0;
  changeKeys = new ArrayList_0;
  changeOldValues = new ArrayList_0;
  changeNewValues = new ArrayList_0;
  for (i = 0; i < map.endSize(); ++i) {
    key = map.getEndKey_0(i);
    postValues = dynamicCast(this.this$0.postAnnotations.get(key), 233);
    if (postValues) {
      setCheck(changeKeys.array, changeKeys.size++, key);
      $add_9(changeOldValues, postValues.oldValue);
      $add_9(changeNewValues, postValues.newValue);
    }
     else {
      setCheck(endKeys.array, endKeys.size++, key);
    }
    this.this$0.preAnnotations.remove_2(key);
  }
  for (i = 0; i < map.changeSize(); ++i) {
    key = map.getChangeKey_0(i);
    oldValue = map.getOldValue(i);
    newValue = map.getNewValue(i);
    postValues = dynamicCast(this.this$0.postAnnotations.get(key), 233);
    setCheck(changeKeys.array, changeKeys.size++, key);
    setCheck(changeOldValues.array, changeOldValues.size++, oldValue);
    postValues?$add_9(changeNewValues, postValues.newValue):(setCheck(changeNewValues.array, changeNewValues.size++, newValue) , true);
    this.this$0.preAnnotations.put(key, new ValueUpdate_0(oldValue, newValue));
  }
  $annotationBoundary(this.this$0.normalizer, new AnnotationBoundaryMapImpl_0(dynamicCast($toArray_1(endKeys, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234), dynamicCast($toArray_1(changeKeys, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234), dynamicCast($toArray_1(changeOldValues, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234), dynamicCast($toArray_1(changeNewValues, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234)));
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function Composer$2_0(this$0){
  this.this$0 = this$0;
  this.events = new ArrayList_0;
}

function Composer$2(){
}

_ = Composer$2_0.prototype = Composer$2.prototype = new Composer$AnnotationQueue;
_.getClass$ = function getClass_780(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$2_2_classLit;
}
;
_.unqueue = function unqueue_0(map){
  var changeKeys, changeNewValues, changeOldValues, endKeys, i, key, newValue, oldValue, preValues;
  endKeys = new ArrayList_0;
  changeKeys = new ArrayList_0;
  changeOldValues = new ArrayList_0;
  changeNewValues = new ArrayList_0;
  for (i = 0; i < map.endSize(); ++i) {
    key = map.getEndKey_0(i);
    preValues = dynamicCast(this.this$0.preAnnotations.get(key), 233);
    if (preValues) {
      setCheck(changeKeys.array, changeKeys.size++, key);
      $add_9(changeOldValues, preValues.oldValue);
      $add_9(changeNewValues, preValues.newValue);
    }
     else {
      setCheck(endKeys.array, endKeys.size++, key);
    }
    this.this$0.postAnnotations.remove_2(key);
  }
  for (i = 0; i < map.changeSize(); ++i) {
    key = map.getChangeKey_0(i);
    oldValue = map.getOldValue(i);
    newValue = map.getNewValue(i);
    preValues = dynamicCast(this.this$0.preAnnotations.get(key), 233);
    setCheck(changeKeys.array, changeKeys.size++, key);
    setCheck(changeNewValues.array, changeNewValues.size++, newValue);
    preValues?$add_9(changeOldValues, preValues.oldValue):(setCheck(changeOldValues.array, changeOldValues.size++, oldValue) , true);
    this.this$0.postAnnotations.put(key, new ValueUpdate_0(oldValue, newValue));
  }
  $annotationBoundary(this.this$0.normalizer, new AnnotationBoundaryMapImpl_0(dynamicCast($toArray_1(endKeys, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234), dynamicCast($toArray_1(changeKeys, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234), dynamicCast($toArray_1(changeOldValues, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234), dynamicCast($toArray_1(changeNewValues, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234)));
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function Composer$Target(){
}

_ = Composer$Target.prototype = new Object_0;
_.getClass$ = function getClass_781(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$Target_2_classLit;
}
;
_.castableTypeMap$ = {};
function Composer$PostTarget(){
}

_ = Composer$PostTarget.prototype = new Composer$Target;
_.annotationBoundary = function annotationBoundary_4(map){
  $add_9(this.this$0_0.postAnnotationQueue.events, map);
}
;
_.characters_0 = function characters_9(chars){
  $flush_6(this.this$0_0.postAnnotationQueue);
  $characters_0(this.this$0_0.normalizer, chars);
}
;
_.elementEnd = function elementEnd_8(){
  $flush_6(this.this$0_0.postAnnotationQueue);
  $elementEnd_0(this.this$0_0.normalizer);
}
;
_.elementStart = function elementStart_8(type, attrs){
  $flush_6(this.this$0_0.postAnnotationQueue);
  $elementStart_0(this.this$0_0.normalizer, type, attrs);
}
;
_.getClass$ = function getClass_782(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$PostTarget_2_classLit;
}
;
_.isPostTarget = function isPostTarget(){
  return true;
}
;
_.castableTypeMap$ = {};
_.this$0_0 = null;
function $cancelCharacters(this$static, size){
  size < this$static.chars.length?(this$static.chars = $substring(this$static.chars, size)):(this$static.this$0.target_0 = this$static.this$0.defaultTarget);
}

function Composer$CharactersPostTarget_0(this$0, chars){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
  this.chars = chars;
}

function Composer$CharactersPostTarget(){
}

_ = Composer$CharactersPostTarget_0.prototype = Composer$CharactersPostTarget.prototype = new Composer$PostTarget;
_.deleteCharacters = function deleteCharacters_8(chars){
  $flushAnnotations_0(this.this$0);
  chars.length <= this.chars.length?$cancelCharacters(this, chars.length):(this.this$0.target_0 = new Composer$DeleteCharactersPreTarget_0(this.this$0, $substring(chars, this.chars.length)));
}
;
_.deleteElementEnd = function deleteElementEnd_8(){
  throw new Composer$ComposeException_0;
}
;
_.deleteElementStart = function deleteElementStart_8(type, attrs){
  throw new Composer$ComposeException_0;
}
;
_.getClass$ = function getClass_783(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$CharactersPostTarget_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_8(oldAttrs, newAttrs){
  throw new Composer$ComposeException_0;
}
;
_.retain = function retain_4(itemCount){
  $flushAnnotations_0(this.this$0);
  if (itemCount <= this.chars.length) {
    $characters_0(this.this$0.normalizer, this.chars.substr(0, itemCount - 0));
    itemCount < this.chars.length?(this.chars = $substring(this.chars, itemCount)):(this.this$0.target_0 = this.this$0.defaultTarget);
  }
   else {
    $characters_0(this.this$0.normalizer, this.chars);
    this.this$0.target_0 = new Composer$RetainPreTarget_0(this.this$0, itemCount - this.chars.length);
  }
}
;
_.updateAttributes = function updateAttributes_8(attrUpdate){
  throw new Composer$ComposeException_0;
}
;
_.castableTypeMap$ = {};
_.chars = null;
_.this$0 = null;
function Composer$ComposeException_0(){
  this.fillInStackTrace();
  this.detailMessage = 'Illegal composition';
}

function Composer$ComposeException(){
}

_ = Composer$ComposeException_0.prototype = Composer$ComposeException.prototype = new RuntimeException;
_.getClass$ = function getClass_784(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$ComposeException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1, 232:1};
function Composer$PreTarget(){
}

_ = Composer$PreTarget.prototype = new Composer$Target;
_.annotationBoundary = function annotationBoundary_5(map){
  $add_9(this.this$0_0.preAnnotationQueue.events, map);
}
;
_.deleteCharacters = function deleteCharacters_9(chars){
  $flush_6(this.this$0_0.preAnnotationQueue);
  $deleteCharacters_0(this.this$0_0.normalizer, chars);
}
;
_.deleteElementEnd = function deleteElementEnd_9(){
  $flush_6(this.this$0_0.preAnnotationQueue);
  $deleteElementEnd_0(this.this$0_0.normalizer);
}
;
_.deleteElementStart = function deleteElementStart_9(type, attrs){
  $flush_6(this.this$0_0.preAnnotationQueue);
  $deleteElementStart_0(this.this$0_0.normalizer, type, attrs);
}
;
_.getClass$ = function getClass_785(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$PreTarget_2_classLit;
}
;
_.isPostTarget = function isPostTarget_0(){
  return false;
}
;
_.castableTypeMap$ = {};
_.this$0_0 = null;
function Composer$DefaultPreTarget_0(this$0){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
}

function Composer$DefaultPreTarget(){
}

_ = Composer$DefaultPreTarget_0.prototype = Composer$DefaultPreTarget.prototype = new Composer$PreTarget;
_.characters_0 = function characters_10(chars){
  this.this$0.target_0 = new Composer$CharactersPostTarget_0(this.this$0, chars);
}
;
_.elementEnd = function elementEnd_9(){
  this.this$0.target_0 = new Composer$ElementEndPostTarget_0(this.this$0);
}
;
_.elementStart = function elementStart_9(type, attrs){
  this.this$0.target_0 = new Composer$ElementStartPostTarget_0(this.this$0, type, attrs);
}
;
_.getClass$ = function getClass_786(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$DefaultPreTarget_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_9(oldAttrs, newAttrs){
  this.this$0.target_0 = new Composer$ReplaceAttributesPostTarget_0(this.this$0, oldAttrs, newAttrs);
}
;
_.retain = function retain_5(itemCount){
  this.this$0.target_0 = new Composer$RetainPostTarget_0(this.this$0, itemCount);
}
;
_.updateAttributes = function updateAttributes_9(attrUpdate){
  this.this$0.target_0 = new Composer$UpdateAttributesPostTarget_0(this.this$0, attrUpdate);
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $cancelDeleteCharacters(this$static, size){
  size < this$static.chars.length?(this$static.chars = $substring(this$static.chars, size)):(this$static.this$0.target_0 = this$static.this$0.defaultTarget);
}

function Composer$DeleteCharactersPreTarget_0(this$0, chars){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
  this.chars = chars;
}

function Composer$DeleteCharactersPreTarget(){
}

_ = Composer$DeleteCharactersPreTarget_0.prototype = Composer$DeleteCharactersPreTarget.prototype = new Composer$PreTarget;
_.characters_0 = function characters_11(chars){
  $flushAnnotations_0(this.this$0);
  chars.length <= this.chars.length?$cancelDeleteCharacters(this, chars.length):(this.this$0.target_0 = new Composer$CharactersPostTarget_0(this.this$0, $substring(chars, this.chars.length)));
}
;
_.elementEnd = function elementEnd_10(){
  throw new Composer$ComposeException_0;
}
;
_.elementStart = function elementStart_10(type, attrs){
  throw new Composer$ComposeException_0;
}
;
_.getClass$ = function getClass_787(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$DeleteCharactersPreTarget_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_10(oldAttrs, newAttrs){
  throw new Composer$ComposeException_0;
}
;
_.retain = function retain_6(itemCount){
  $flushAnnotations_0(this.this$0);
  if (itemCount <= this.chars.length) {
    $deleteCharacters_0(this.this$0.normalizer, this.chars.substr(0, itemCount - 0));
    itemCount < this.chars.length?(this.chars = $substring(this.chars, itemCount)):(this.this$0.target_0 = this.this$0.defaultTarget);
  }
   else {
    $deleteCharacters_0(this.this$0.normalizer, this.chars);
    this.this$0.target_0 = new Composer$RetainPostTarget_0(this.this$0, itemCount - this.chars.length);
  }
}
;
_.updateAttributes = function updateAttributes_10(attrUpdate){
  throw new Composer$ComposeException_0;
}
;
_.castableTypeMap$ = {};
_.chars = null;
_.this$0 = null;
function Composer$ElementEndPostTarget_0(this$0){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
}

function Composer$ElementEndPostTarget(){
}

_ = Composer$ElementEndPostTarget_0.prototype = Composer$ElementEndPostTarget.prototype = new Composer$PostTarget;
_.deleteCharacters = function deleteCharacters_10(chars){
  throw new Composer$ComposeException_0;
}
;
_.deleteElementEnd = function deleteElementEnd_10(){
  $flushAnnotations_0(this.this$0);
  this.this$0.target_0 = this.this$0.defaultTarget;
}
;
_.deleteElementStart = function deleteElementStart_10(type, attrs){
  throw new Composer$ComposeException_0;
}
;
_.getClass$ = function getClass_788(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$ElementEndPostTarget_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_11(oldAttrs, newAttrs){
  throw new Composer$ComposeException_0;
}
;
_.retain = function retain_7(itemCount){
  $flushAnnotations_0(this.this$0);
  $elementEnd_0(this.this$0.normalizer);
  itemCount > 1?(this.this$0.target_0 = new Composer$RetainPreTarget_0(this.this$0, itemCount - 1)):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.updateAttributes = function updateAttributes_11(attrUpdate){
  throw new Composer$ComposeException_0;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function Composer$ElementStartPostTarget_0(this$0, type, attrs){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
  this.type_0 = type;
  this.attrs = attrs;
}

function Composer$ElementStartPostTarget(){
}

_ = Composer$ElementStartPostTarget_0.prototype = Composer$ElementStartPostTarget.prototype = new Composer$PostTarget;
_.deleteCharacters = function deleteCharacters_11(chars){
  throw new Composer$ComposeException_0;
}
;
_.deleteElementEnd = function deleteElementEnd_11(){
  throw new Composer$ComposeException_0;
}
;
_.deleteElementStart = function deleteElementStart_11(type, attrs){
  $flushAnnotations_0(this.this$0);
  this.this$0.target_0 = this.this$0.defaultTarget;
}
;
_.getClass$ = function getClass_789(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$ElementStartPostTarget_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_12(oldAttrs, newAttrs){
  $flushAnnotations_0(this.this$0);
  $elementStart_0(this.this$0.normalizer, this.type_0, newAttrs);
  this.this$0.target_0 = this.this$0.defaultTarget;
}
;
_.retain = function retain_8(itemCount){
  $flushAnnotations_0(this.this$0);
  $elementStart_0(this.this$0.normalizer, this.type_0, this.attrs);
  itemCount > 1?(this.this$0.target_0 = new Composer$RetainPreTarget_0(this.this$0, itemCount - 1)):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.updateAttributes = function updateAttributes_12(attrUpdate){
  $flushAnnotations_0(this.this$0);
  $elementStart_0(this.this$0.normalizer, this.type_0, dynamicCast($updateWith(this.attrs, attrUpdate, true), 236));
  this.this$0.target_0 = this.this$0.defaultTarget;
}
;
--></script>
<script><!--
_.castableTypeMap$ = {};
_.attrs = null;
_.this$0 = null;
_.type_0 = null;
function Composer$FinisherPostTarget_0(this$0){
  this.this$0_0 = this$0;
}

function Composer$FinisherPostTarget(){
}

_ = Composer$FinisherPostTarget_0.prototype = Composer$FinisherPostTarget.prototype = new Composer$PostTarget;
_.deleteCharacters = function deleteCharacters_12(chars){
  throw new Composer$ComposeException_0;
}
;
_.deleteElementEnd = function deleteElementEnd_12(){
  throw new Composer$ComposeException_0;
}
;
_.deleteElementStart = function deleteElementStart_12(type, attrs){
  throw new Composer$ComposeException_0;
}
;
_.getClass$ = function getClass_790(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$FinisherPostTarget_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_13(oldAttrs, newAttrs){
  throw new Composer$ComposeException_0;
}
;
_.retain = function retain_9(itemCount){
  throw new Composer$ComposeException_0;
}
;
_.updateAttributes = function updateAttributes_13(attrUpdate){
  throw new Composer$ComposeException_0;
}
;
_.castableTypeMap$ = {};
function Composer$ReplaceAttributesPostTarget_0(this$0, oldAttrs, newAttrs){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
  this.oldAttrs = oldAttrs;
  this.newAttrs = newAttrs;
}

function Composer$ReplaceAttributesPostTarget(){
}

_ = Composer$ReplaceAttributesPostTarget_0.prototype = Composer$ReplaceAttributesPostTarget.prototype = new Composer$PostTarget;
_.deleteCharacters = function deleteCharacters_13(chars){
  throw new Composer$ComposeException_0;
}
;
_.deleteElementEnd = function deleteElementEnd_13(){
  throw new Composer$ComposeException_0;
}
;
_.deleteElementStart = function deleteElementStart_13(type, attrs){
  $flushAnnotations_0(this.this$0);
  $deleteElementStart_0(this.this$0.normalizer, type, this.oldAttrs);
  this.this$0.target_0 = this.this$0.defaultTarget;
}
;
_.getClass$ = function getClass_791(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$ReplaceAttributesPostTarget_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_14(oldAttrs, newAttrs){
  $flushAnnotations_0(this.this$0);
  $replaceAttributes_0(this.this$0.normalizer, this.oldAttrs, newAttrs);
  this.this$0.target_0 = this.this$0.defaultTarget;
}
;
_.retain = function retain_10(itemCount){
  $flushAnnotations_0(this.this$0);
  $replaceAttributes_0(this.this$0.normalizer, this.oldAttrs, this.newAttrs);
  itemCount > 1?(this.this$0.target_0 = new Composer$RetainPreTarget_0(this.this$0, itemCount - 1)):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.updateAttributes = function updateAttributes_14(attrUpdate){
  $flushAnnotations_0(this.this$0);
  $replaceAttributes_0(this.this$0.normalizer, this.oldAttrs, dynamicCast($updateWith(this.newAttrs, attrUpdate, true), 236));
  this.this$0.target_0 = this.this$0.defaultTarget;
}
;
_.castableTypeMap$ = {};
_.newAttrs = null;
_.oldAttrs = null;
_.this$0 = null;
function $cancelRetain(this$static, size){
  size < this$static.itemCount?(this$static.itemCount -= size):(this$static.this$0.target_0 = this$static.this$0.defaultTarget);
}

function Composer$RetainPostTarget_0(this$0, itemCount){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
  this.itemCount = itemCount;
}

function Composer$RetainPostTarget(){
}

_ = Composer$RetainPostTarget_0.prototype = Composer$RetainPostTarget.prototype = new Composer$PostTarget;
_.deleteCharacters = function deleteCharacters_14(chars){
  $flushAnnotations_0(this.this$0);
  if (chars.length <= this.itemCount) {
    $deleteCharacters_0(this.this$0.normalizer, chars);
    $cancelRetain(this, chars.length);
  }
   else {
    $deleteCharacters_0(this.this$0.normalizer, chars.substr(0, this.itemCount - 0));
    this.this$0.target_0 = new Composer$DeleteCharactersPreTarget_0(this.this$0, $substring(chars, this.itemCount));
  }
}
;
_.deleteElementEnd = function deleteElementEnd_14(){
  $flushAnnotations_0(this.this$0);
  $deleteElementEnd_0(this.this$0.normalizer);
  1 < this.itemCount?(this.itemCount -= 1):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.deleteElementStart = function deleteElementStart_14(type, attrs){
  $flushAnnotations_0(this.this$0);
  $deleteElementStart_0(this.this$0.normalizer, type, attrs);
  1 < this.itemCount?(this.itemCount -= 1):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.getClass$ = function getClass_792(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$RetainPostTarget_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_15(oldAttrs, newAttrs){
  $flushAnnotations_0(this.this$0);
  $replaceAttributes_0(this.this$0.normalizer, oldAttrs, newAttrs);
  1 < this.itemCount?(this.itemCount -= 1):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.retain = function retain_11(itemCount){
  $flushAnnotations_0(this.this$0);
  if (itemCount <= this.itemCount) {
    $retain_0(this.this$0.normalizer, itemCount);
    itemCount < this.itemCount?(this.itemCount -= itemCount):(this.this$0.target_0 = this.this$0.defaultTarget);
  }
   else {
    $retain_0(this.this$0.normalizer, this.itemCount);
    this.this$0.target_0 = new Composer$RetainPreTarget_0(this.this$0, itemCount - this.itemCount);
  }
}
;
_.updateAttributes = function updateAttributes_15(attrUpdate){
  $flushAnnotations_0(this.this$0);
  $updateAttributes_0(this.this$0.normalizer, attrUpdate);
  1 < this.itemCount?(this.itemCount -= 1):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.castableTypeMap$ = {};
_.itemCount = 0;
_.this$0 = null;
function $cancelRetain_0(this$static, size){
  size < this$static.itemCount?(this$static.itemCount -= size):(this$static.this$0.target_0 = this$static.this$0.defaultTarget);
}

function Composer$RetainPreTarget_0(this$0, itemCount){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
  this.itemCount = itemCount;
}

function Composer$RetainPreTarget(){
}

_ = Composer$RetainPreTarget_0.prototype = Composer$RetainPreTarget.prototype = new Composer$PreTarget;
_.characters_0 = function characters_12(chars){
  $flushAnnotations_0(this.this$0);
  if (chars.length <= this.itemCount) {
    $characters_0(this.this$0.normalizer, chars);
    $cancelRetain_0(this, chars.length);
  }
   else {
    $characters_0(this.this$0.normalizer, chars.substr(0, this.itemCount - 0));
    this.this$0.target_0 = new Composer$CharactersPostTarget_0(this.this$0, $substring(chars, this.itemCount));
  }
}
;
_.elementEnd = function elementEnd_11(){
  $flushAnnotations_0(this.this$0);
  $elementEnd_0(this.this$0.normalizer);
  1 < this.itemCount?(this.itemCount -= 1):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.elementStart = function elementStart_11(type, attrs){
  $flushAnnotations_0(this.this$0);
  $elementStart_0(this.this$0.normalizer, type, attrs);
  1 < this.itemCount?(this.itemCount -= 1):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.getClass$ = function getClass_793(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$RetainPreTarget_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_16(oldAttrs, newAttrs){
  $flushAnnotations_0(this.this$0);
  $replaceAttributes_0(this.this$0.normalizer, oldAttrs, newAttrs);
  1 < this.itemCount?(this.itemCount -= 1):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.retain = function retain_12(itemCount){
  $flushAnnotations_0(this.this$0);
  if (itemCount <= this.itemCount) {
    $retain_0(this.this$0.normalizer, itemCount);
    itemCount < this.itemCount?(this.itemCount -= itemCount):(this.this$0.target_0 = this.this$0.defaultTarget);
  }
   else {
    $retain_0(this.this$0.normalizer, this.itemCount);
    this.this$0.target_0 = new Composer$RetainPostTarget_0(this.this$0, itemCount - this.itemCount);
  }
}
;
_.updateAttributes = function updateAttributes_16(attrsUpdate){
  $flushAnnotations_0(this.this$0);
  $updateAttributes_0(this.this$0.normalizer, attrsUpdate);
  1 < this.itemCount?(this.itemCount -= 1):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.castableTypeMap$ = {};
_.itemCount = 0;
_.this$0 = null;
function Composer$UpdateAttributesPostTarget_0(this$0, attrUpdate){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
  this.attrUpdate = attrUpdate;
}

function Composer$UpdateAttributesPostTarget(){
}

_ = Composer$UpdateAttributesPostTarget_0.prototype = Composer$UpdateAttributesPostTarget.prototype = new Composer$PostTarget;
_.deleteCharacters = function deleteCharacters_15(chars){
  throw new Composer$ComposeException_0;
}
;
_.deleteElementEnd = function deleteElementEnd_15(){
  throw new Composer$ComposeException_0;
}
;
_.deleteElementStart = function deleteElementStart_15(type, attrs){
  $flushAnnotations_0(this.this$0);
  $deleteElementStart_0(this.this$0.normalizer, type, dynamicCast($updateWith(attrs, invertUpdate(this.attrUpdate), true), 236));
  this.this$0.target_0 = this.this$0.defaultTarget;
}
;
_.getClass$ = function getClass_794(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$UpdateAttributesPostTarget_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_17(oldAttrs, newAttrs){
  $flushAnnotations_0(this.this$0);
  $replaceAttributes_0(this.this$0.normalizer, dynamicCast($updateWith(oldAttrs, invertUpdate(this.attrUpdate), true), 236), newAttrs);
  this.this$0.target_0 = this.this$0.defaultTarget;
}
;
_.retain = function retain_13(itemCount){
  $flushAnnotations_0(this.this$0);
  $updateAttributes_0(this.this$0.normalizer, this.attrUpdate);
  itemCount > 1?(this.this$0.target_0 = new Composer$RetainPreTarget_0(this.this$0, itemCount - 1)):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.updateAttributes = function updateAttributes_17(attrUpdate){
  $flushAnnotations_0(this.this$0);
  $updateAttributes_0(this.this$0.normalizer, $composeWith(this.attrUpdate, attrUpdate));
  this.this$0.target_0 = this.this$0.defaultTarget;
}
;
_.castableTypeMap$ = {};
_.attrUpdate = null;
_.this$0 = null;
function decompose(op){
  var target;
  target = new Decomposer$Target_0;
  op.apply_5(target);
  return new Pair_0(dynamicCast($finish_1(target.insertionOp), 173), dynamicCast($finish_1(target.noninsertionOp), 173));
}

function Decomposer$Target_0(){
  this.insertionOp = new AnnotationsNormalizer_0(new RangeNormalizer_0(new DocOpBuffer_0));
  this.noninsertionOp = new AnnotationsNormalizer_0(new RangeNormalizer_0(new DocOpBuffer_0));
}

function Decomposer$Target(){
}

_ = Decomposer$Target_0.prototype = Decomposer$Target.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_6(map){
  $annotationBoundary(this.noninsertionOp, map);
}
;
_.characters_0 = function characters_13(chars){
  $characters_0(this.insertionOp, chars);
  $retain_0(this.noninsertionOp, chars.length);
}
;
_.deleteCharacters = function deleteCharacters_16(chars){
  $retain_0(this.insertionOp, chars.length);
  $deleteCharacters_0(this.noninsertionOp, chars);
}
;
_.deleteElementEnd = function deleteElementEnd_16(){
  $retain_0(this.insertionOp, 1);
  $deleteElementEnd_0(this.noninsertionOp);
}
;
_.deleteElementStart = function deleteElementStart_16(type, attrs){
  $retain_0(this.insertionOp, 1);
  $deleteElementStart_0(this.noninsertionOp, type, attrs);
}
;
_.elementEnd = function elementEnd_12(){
  $elementEnd_0(this.insertionOp);
  $retain_0(this.noninsertionOp, 1);
}
;
_.elementStart = function elementStart_12(type, attrs){
  $elementStart_0(this.insertionOp, type, attrs);
  $retain_0(this.noninsertionOp, 1);
}
;
_.finish_0 = function finish_6(){
  return new Pair_0(dynamicCast($finish_1(this.insertionOp), 173), dynamicCast($finish_1(this.noninsertionOp), 173));
}
;
_.getClass$ = function getClass_795(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Decomposer$Target_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_18(oldAttrs, newAttrs){
  $retain_0(this.insertionOp, 1);
  $replaceAttributes_0(this.noninsertionOp, oldAttrs, newAttrs);
}
;
_.retain = function retain_14(itemCount){
  $retain_0(this.insertionOp, itemCount);
  $retain_0(this.noninsertionOp, itemCount);
}
;
_.updateAttributes = function updateAttributes_18(attrUpdate){
  $retain_0(this.insertionOp, 1);
  $updateAttributes_0(this.noninsertionOp, attrUpdate);
}
;
_.castableTypeMap$ = {};
function $add_18(this$static, operation){
  var iterator, nextOperation;
  iterator = new AbstractList$ListIteratorImpl_0(this$static.operations, 0);
  while (iterator.i < iterator.this$0_0.size_0()) {
    nextOperation = dynamicCast($next_6(iterator), 173);
    if (!nextOperation) {
      $set_0(iterator, operation);
      return;
    }
    $set_0(iterator, null);
    operation = $compose(nextOperation, operation);
  }
  $add_9(this$static.operations, operation);
}

function $compose(op1, op2){
  var $e0, e;
  try {
    return compose(op1, op2);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 189)) {
      e = $e0;
      throw new IllegalArgumentException_3(e);
    }
     else 
      throw $e0;
  }
}

function $composeAll(this$static){
  var operation, operation$iterator, result;
  result = null;
  for (operation$iterator = new AbstractList$IteratorImpl_0(this$static.operations); operation$iterator.i < operation$iterator.this$0_0.size_0();) {
    operation = dynamicCast($next_6(operation$iterator), 173);
    !!operation && (result = result?$compose(operation, result):operation);
  }
  $clear_2(this$static.operations);
  return result;
}

function DocOpCollector_0(){
  this.operations = new ArrayList_0;
}

function DocOpCollector(){
}

_ = DocOpCollector_0.prototype = DocOpCollector.prototype = new Object_0;
_.getClass$ = function getClass_796(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_DocOpCollector_2_classLit;
}
;
_.castableTypeMap$ = {};
function DocOpInverter_0(target){
  this.target_0 = target;
}

function invert(input){
  var inverter;
  inverter = new DocOpInverter_0(new DocOpBuffer_0);
  input.apply_5(inverter);
  return inverter.target_0.finish_1();
}

function DocOpInverter(){
}

_ = DocOpInverter_0.prototype = DocOpInverter.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_7(map){
  $add_9(this.target_0.accu, new OperationComponents$AnnotationBoundary_0(new DocOpInverter$1_0(map)));
}
;
_.characters_0 = function characters_14(chars){
  $add_9(this.target_0.accu, new OperationComponents$DeleteCharacters_0(chars));
}
;
_.deleteCharacters = function deleteCharacters_17(chars){
  $add_9(this.target_0.accu, new OperationComponents$Characters_0(chars));
}
;
_.deleteElementEnd = function deleteElementEnd_17(){
  $add_9(this.target_0.accu, ($clinit_1312() , INSTANCE_15));
}
;
_.deleteElementStart = function deleteElementStart_17(type, attrs){
  $add_9(this.target_0.accu, new OperationComponents$ElementStart_0(type, attrs));
}
;
_.elementEnd = function elementEnd_13(){
  $add_9(this.target_0.accu, ($clinit_1310() , INSTANCE_14));
}
;
_.elementStart = function elementStart_13(type, attrs){
  $add_9(this.target_0.accu, new OperationComponents$DeleteElementStart_0(type, attrs));
}
;
_.finish_0 = function finish_7(){
  return this.target_0.finish_1();
}
;
_.getClass$ = function getClass_797(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_DocOpInverter_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_19(oldAttrs, newAttrs){
  $add_9(this.target_0.accu, new OperationComponents$ReplaceAttributes_0(newAttrs, oldAttrs));
}
;
_.retain = function retain_15(itemCount){
  $add_9(this.target_0.accu, new OperationComponents$Retain_0(itemCount));
}
;
_.updateAttributes = function updateAttributes_19(attrUpdate){
  var i, update;
  update = new AttributesUpdateImpl_0;
  for (i = 0; i < attrUpdate.updates.size_0(); ++i) {
    update = $composeWith(update, new AttributesUpdateImpl_1(initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, [dynamicCast(attrUpdate.updates.get_0(i), 220).name_0, dynamicCast(attrUpdate.updates.get_0(i), 220).newValue, dynamicCast(attrUpdate.updates.get_0(i), 220).oldValue])));
  }
  $add_9(this.target_0.accu, new OperationComponents$UpdateAttributes_0(update));
}
;
_.castableTypeMap$ = {};
_.target_0 = null;
function DocOpInverter$1_0(val$map){
  this.val$map = val$map;
}

function DocOpInverter$1(){
}

_ = DocOpInverter$1_0.prototype = DocOpInverter$1.prototype = new Object_0;
_.changeSize = function changeSize_2(){
  return this.val$map.changeSize();
}
;
_.endSize = function endSize_2(){
  return this.val$map.endSize();
}
;
_.getChangeKey_0 = function getChangeKey_3(changeIndex){
  return this.val$map.getChangeKey_0(changeIndex);
}
;
_.getClass$ = function getClass_798(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_DocOpInverter$1_2_classLit;
}
;
_.getEndKey_0 = function getEndKey_3(endIndex){
  return this.val$map.getEndKey_0(endIndex);
}
;
_.getNewValue = function getNewValue_1(changeIndex){
  return this.val$map.getOldValue(changeIndex);
}
;
_.getOldValue = function getOldValue_1(changeIndex){
  return this.val$map.getNewValue(changeIndex);
}
;
_.castableTypeMap$ = {235:1};
_.val$map = null;
function $transformOperations(insertionOp, noninsertionOp){
  var insertionIndex, insertionPosition, insertionTarget, noninsertionIndex, noninsertionPosition, noninsertionTarget, positionTracker;
  positionTracker = new PositionTracker_0;
  insertionPosition = new PositionTracker$1_0(positionTracker);
  noninsertionPosition = new PositionTracker$2_0(positionTracker);
  insertionTarget = new InsertionNoninsertionTransformer$InsertionTarget_0(insertionPosition);
  noninsertionTarget = new InsertionNoninsertionTransformer$NoninsertionTarget_0(noninsertionPosition);
  insertionTarget.otherTarget = noninsertionTarget;
  noninsertionTarget.otherTarget = insertionTarget;
  insertionIndex = 0;
  noninsertionIndex = 0;
  while (insertionIndex < insertionOp.size_0()) {
    insertionOp.applyComponent(insertionIndex++, insertionTarget);
    while (insertionPosition.this$0.position_0 > 0) {
      if (noninsertionIndex >= noninsertionOp.size_0()) {
        throw new TransformException_0('Ran out of ' + noninsertionOp.size_0() + ' noninsertion op components after ' + insertionIndex + ' of ' + insertionOp.size_0() + ' insertion op components, with ' + insertionPosition.this$0.position_0 + ' spare positions');
      }
      noninsertionOp.applyComponent(noninsertionIndex++, noninsertionTarget);
    }
  }
  while (noninsertionIndex < noninsertionOp.size_0()) {
    noninsertionOp.applyComponent(noninsertionIndex++, noninsertionTarget);
  }
  insertionOp = dynamicCast(insertionTarget.targetDocument.finish_0(), 173);
  noninsertionOp = dynamicCast(noninsertionTarget.targetDocument.finish_0(), 173);
  return new OperationPair_0(insertionOp, noninsertionOp);
}

function InsertionNoninsertionTransformer$Target(){
}

_ = InsertionNoninsertionTransformer$Target.prototype = new Object_0;
_.finish_0 = function finish_8(){
  return dynamicCast(this.targetDocument.finish_0(), 173);
}
;
_.getClass$ = function getClass_799(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_InsertionNoninsertionTransformer$Target_2_classLit;
}
;
_.castableTypeMap$ = {};
_.relativePosition = null;
_.targetDocument = null;
function InsertionNoninsertionTransformer$InsertionTarget_0(relativePosition){
  this.targetDocument = new RangeNormalizer_0(new DocOpBuffer_0);
  this.relativePosition = relativePosition;
}

function InsertionNoninsertionTransformer$InsertionTarget(){
}

_ = InsertionNoninsertionTransformer$InsertionTarget_0.prototype = InsertionNoninsertionTransformer$InsertionTarget.prototype = new InsertionNoninsertionTransformer$Target;
_.annotationBoundary = function annotationBoundary_8(map){
  throw new UnsupportedOperationException_1('This method should never be called.');
}
;
_.characters_0 = function characters_15(chars){
  if (this.otherTarget.depth > 0) {
    this.otherTarget.targetDocument.deleteCharacters(chars);
  }
   else {
    this.targetDocument.characters_0(chars);
    this.otherTarget.targetDocument.retain(chars.length);
  }
}
;
_.deleteCharacters = function deleteCharacters_18(chars){
  throw new UnsupportedOperationException_1('This method should never be called.');
}
;
_.deleteElementEnd = function deleteElementEnd_18(){
  throw new UnsupportedOperationException_1('This method should never be called.');
}
;
_.deleteElementStart = function deleteElementStart_18(tag, attrs){
  throw new UnsupportedOperationException_1('This method should never be called.');
}
;
_.elementEnd = function elementEnd_14(){
  if (this.otherTarget.depth > 0) {
    this.otherTarget.targetDocument.deleteElementEnd();
  }
   else {
    this.targetDocument.elementEnd();
    this.otherTarget.targetDocument.retain(1);
  }
}
;
_.elementStart = function elementStart_14(tag, attrs){
  if (this.otherTarget.depth > 0) {
    this.otherTarget.targetDocument.deleteElementStart(tag, attrs);
  }
   else {
    this.targetDocument.elementStart(tag, attrs);
    this.otherTarget.targetDocument.retain(1);
  }
}
;
_.getClass$ = function getClass_800(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_InsertionNoninsertionTransformer$InsertionTarget_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_20(oldAttrs, newAttrs){
  throw new UnsupportedOperationException_1('This method should never be called.');
}
;
_.retain = function retain_16(itemCount){
  var oldPosition;
  oldPosition = this.relativePosition.get_1();
  this.relativePosition.increase(itemCount);
  this.relativePosition.get_1() < 0?this.otherTarget.rangeCache.resolve(itemCount):oldPosition < 0 && this.otherTarget.rangeCache.resolve(-oldPosition);
}
;
_.updateAttributes = function updateAttributes_20(attrUpdate){
  throw new UnsupportedOperationException_1('This method should never be called.');
}
;
_.castableTypeMap$ = {};
_.otherTarget = null;
function $resolveRange(this$static, size, cache){
  var oldPosition;
  oldPosition = this$static.relativePosition.get_1();
  this$static.relativePosition.increase(size);
  if (this$static.relativePosition.get_1() > 0) {
    oldPosition < 0 && cache.resolve(-oldPosition);
    return -oldPosition;
  }
   else {
    cache.resolve(size);
    return -1;
  }
}

function InsertionNoninsertionTransformer$NoninsertionTarget_0(relativePosition){
  this.targetDocument = new AnnotationsNormalizer_0(new RangeNormalizer_0(new DocOpBuffer_0));
  this.relativePosition = relativePosition;
  this.retainCache = new InsertionNoninsertionTransformer$NoninsertionTarget$1_0(this);
  this.deleteElementEndCache = new InsertionNoninsertionTransformer$NoninsertionTarget$2_0(this);
  this.rangeCache = this.retainCache;
}

function InsertionNoninsertionTransformer$NoninsertionTarget(){
}

_ = InsertionNoninsertionTransformer$NoninsertionTarget_0.prototype = InsertionNoninsertionTransformer$NoninsertionTarget.prototype = new InsertionNoninsertionTransformer$Target;
_.annotationBoundary = function annotationBoundary_9(map){
  this.targetDocument.annotationBoundary(map);
}
;
_.characters_0 = function characters_16(chars){
  throw new UnsupportedOperationException_1('This method should never be called.');
}
;
_.deleteCharacters = function deleteCharacters_19(chars){
  var cache, resolutionSize;
  cache = new InsertionNoninsertionTransformer$NoninsertionTarget$DeleteCharactersCache_0(this, chars);
  resolutionSize = $resolveRange(this, chars.length, cache);
  resolutionSize >= 0 && (this.rangeCache = cache);
}
;
_.deleteElementEnd = function deleteElementEnd_19(){
  $resolveRange(this, 1, this.deleteElementEndCache) == 0 && (this.rangeCache = this.deleteElementEndCache);
}
;
_.deleteElementStart = function deleteElementStart_19(tag, attrs){
  var cache;
  cache = new InsertionNoninsertionTransformer$NoninsertionTarget$DeleteElementStartCache_0(this, tag, attrs);
  $resolveRange(this, 1, cache) == 0 && (this.rangeCache = cache);
}
;
_.elementEnd = function elementEnd_15(){
  throw new UnsupportedOperationException_1('This method should never be called.');
}
;
_.elementStart = function elementStart_15(tag, attrs){
  throw new UnsupportedOperationException_1('This method should never be called.');
}
;
_.getClass$ = function getClass_801(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_InsertionNoninsertionTransformer$NoninsertionTarget_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_21(oldAttrs, newAttrs){
  var cache;
  cache = new InsertionNoninsertionTransformer$NoninsertionTarget$ReplaceAttributesCache_0(this, oldAttrs, newAttrs);
  $resolveRange(this, 1, cache) == 0 && (this.rangeCache = cache);
}
;
_.retain = function retain_17(itemCount){
  $resolveRange(this, itemCount, this.retainCache);
  this.rangeCache = this.retainCache;
}
;
_.updateAttributes = function updateAttributes_21(attrUpdate){
  var cache;
  cache = new InsertionNoninsertionTransformer$NoninsertionTarget$UpdateAttributesCache_0(this, attrUpdate);
  $resolveRange(this, 1, cache) == 0 && (this.rangeCache = new InsertionNoninsertionTransformer$NoninsertionTarget$UpdateAttributesCache_0(this, attrUpdate));
}
;
_.castableTypeMap$ = {};
_.depth = 0;
_.otherTarget = null;
function InsertionNoninsertionTransformer$RangeCache(){
}

_ = InsertionNoninsertionTransformer$RangeCache.prototype = new Object_0;
_.getClass$ = function getClass_802(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_InsertionNoninsertionTransformer$RangeCache_2_classLit;
}
;
_.castableTypeMap$ = {};
function InsertionNoninsertionTransformer$NoninsertionTarget$1_0(this$1){
  this.this$1 = this$1;
}

function InsertionNoninsertionTransformer$NoninsertionTarget$1(){
}

_ = InsertionNoninsertionTransformer$NoninsertionTarget$1_0.prototype = InsertionNoninsertionTransformer$NoninsertionTarget$1.prototype = new InsertionNoninsertionTransformer$RangeCache;
_.getClass$ = function getClass_803(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_InsertionNoninsertionTransformer$NoninsertionTarget$1_2_classLit;
}
;
_.resolve = function resolve(itemCount){
  this.this$1.targetDocument.retain(itemCount);
  this.this$1.otherTarget.targetDocument.retain(itemCount);
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
function InsertionNoninsertionTransformer$NoninsertionTarget$2_0(this$1){
  this.this$1 = this$1;
}

function InsertionNoninsertionTransformer$NoninsertionTarget$2(){
}

_ = InsertionNoninsertionTransformer$NoninsertionTarget$2_0.prototype = InsertionNoninsertionTransformer$NoninsertionTarget$2.prototype = new InsertionNoninsertionTransformer$RangeCache;
_.getClass$ = function getClass_804(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_InsertionNoninsertionTransformer$NoninsertionTarget$2_2_classLit;
}
;
_.resolve = function resolve_0(itemCount){
  this.this$1.targetDocument.deleteElementEnd();
  --this.this$1.depth;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
function InsertionNoninsertionTransformer$NoninsertionTarget$DeleteCharactersCache_0(this$1, characters){
  this.this$1 = this$1;
  this.characters = characters;
}

function InsertionNoninsertionTransformer$NoninsertionTarget$DeleteCharactersCache(){
}

_ = InsertionNoninsertionTransformer$NoninsertionTarget$DeleteCharactersCache_0.prototype = InsertionNoninsertionTransformer$NoninsertionTarget$DeleteCharactersCache.prototype = new InsertionNoninsertionTransformer$RangeCache;
_.getClass$ = function getClass_805(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_InsertionNoninsertionTransformer$NoninsertionTarget$DeleteCharactersCache_2_classLit;
}
;
_.resolve = function resolve_1(itemCount){
  this.this$1.targetDocument.deleteCharacters(this.characters.substr(0, itemCount - 0));
  this.characters = $substring(this.characters, itemCount);
}
;
_.castableTypeMap$ = {};
_.characters = null;
_.this$1 = null;
function InsertionNoninsertionTransformer$NoninsertionTarget$DeleteElementStartCache_0(this$1, type, attributes){
  this.this$1 = this$1;
  this.type_0 = type;
  this.attributes = attributes;
}

function InsertionNoninsertionTransformer$NoninsertionTarget$DeleteElementStartCache(){
}

_ = InsertionNoninsertionTransformer$NoninsertionTarget$DeleteElementStartCache_0.prototype = InsertionNoninsertionTransformer$NoninsertionTarget$DeleteElementStartCache.prototype = new InsertionNoninsertionTransformer$RangeCache;
_.getClass$ = function getClass_806(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_InsertionNoninsertionTransformer$NoninsertionTarget$DeleteElementStartCache_2_classLit;
}
;
_.resolve = function resolve_2(itemCount){
  this.this$1.targetDocument.deleteElementStart(this.type_0, this.attributes);
  ++this.this$1.depth;
}
;
_.castableTypeMap$ = {};
_.attributes = null;
_.this$1 = null;
_.type_0 = null;
function InsertionNoninsertionTransformer$NoninsertionTarget$ReplaceAttributesCache_0(this$1, oldAttributes, newAttributes){
  this.this$1 = this$1;
  this.oldAttributes = oldAttributes;
  this.newAttributes = newAttributes;
}

function InsertionNoninsertionTransformer$NoninsertionTarget$ReplaceAttributesCache(){
}

_ = InsertionNoninsertionTransformer$NoninsertionTarget$ReplaceAttributesCache_0.prototype = InsertionNoninsertionTransformer$NoninsertionTarget$ReplaceAttributesCache.prototype = new InsertionNoninsertionTransformer$RangeCache;
_.getClass$ = function getClass_807(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_InsertionNoninsertionTransformer$NoninsertionTarget$ReplaceAttributesCache_2_classLit;
}
;
_.resolve = function resolve_3(itemCount){
  this.this$1.targetDocument.replaceAttributes(this.oldAttributes, this.newAttributes);
  this.this$1.otherTarget.targetDocument.retain(1);
}
;
_.castableTypeMap$ = {};
_.newAttributes = null;
_.oldAttributes = null;
_.this$1 = null;
--></script>
<script><!--
function InsertionNoninsertionTransformer$NoninsertionTarget$UpdateAttributesCache_0(this$1, update){
  this.this$1 = this$1;
  this.update = update;
}

function InsertionNoninsertionTransformer$NoninsertionTarget$UpdateAttributesCache(){
}

_ = InsertionNoninsertionTransformer$NoninsertionTarget$UpdateAttributesCache_0.prototype = InsertionNoninsertionTransformer$NoninsertionTarget$UpdateAttributesCache.prototype = new InsertionNoninsertionTransformer$RangeCache;
_.getClass$ = function getClass_808(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_InsertionNoninsertionTransformer$NoninsertionTarget$UpdateAttributesCache_2_classLit;
}
;
_.resolve = function resolve_4(itemCount){
  this.this$1.targetDocument.updateAttributes(this.update);
  this.this$1.otherTarget.targetDocument.retain(1);
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
_.update = null;
function $transformOperations_0(clientOp, serverOp){
  var clientIndex, clientPosition, clientTarget, positionTracker, serverIndex, serverPosition, serverTarget;
  positionTracker = new PositionTracker_0;
  clientPosition = new PositionTracker$1_0(positionTracker);
  serverPosition = new PositionTracker$2_0(positionTracker);
  clientTarget = new InsertionTransformer$Target_0(clientPosition);
  serverTarget = new InsertionTransformer$Target_0(serverPosition);
  clientTarget.otherTarget = serverTarget;
  serverTarget.otherTarget = clientTarget;
  clientIndex = 0;
  serverIndex = 0;
  while (clientIndex < clientOp.size_0()) {
    clientOp.applyComponent(clientIndex++, clientTarget);
    while (clientPosition.this$0.position_0 > 0) {
      if (serverIndex >= serverOp.size_0()) {
        throw new TransformException_0('Ran out of ' + serverOp.size_0() + ' server op components after ' + clientIndex + ' of ' + clientOp.size_0() + ' client op components, with ' + clientPosition.this$0.position_0 + ' spare positions');
      }
      serverOp.applyComponent(serverIndex++, serverTarget);
    }
  }
  while (serverIndex < serverOp.size_0()) {
    serverOp.applyComponent(serverIndex++, serverTarget);
  }
  clientOp = $finish_3(clientTarget.targetDocument);
  serverOp = $finish_3(serverTarget.targetDocument);
  return new OperationPair_0(clientOp, serverOp);
}

function InsertionTransformer$Target_0(relativePosition){
  this.targetDocument = new RangeNormalizer_0(new DocOpBuffer_0);
  this.relativePosition = relativePosition;
}

function InsertionTransformer$Target(){
}

_ = InsertionTransformer$Target_0.prototype = InsertionTransformer$Target.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_10(map){
  throw new UnsupportedOperationException_1('This method should never be called.');
}
;
_.characters_0 = function characters_17(chars){
  $characters_1(this.targetDocument, chars);
  $retain_1(this.otherTarget.targetDocument, chars.length);
}
;
_.deleteCharacters = function deleteCharacters_20(chars){
  throw new UnsupportedOperationException_1('This method should never be called.');
}
;
_.deleteElementEnd = function deleteElementEnd_20(){
  throw new UnsupportedOperationException_1('This method should never be called.');
}
;
_.deleteElementStart = function deleteElementStart_20(tag, attrs){
  throw new UnsupportedOperationException_1('This method should never be called.');
}
;
_.elementEnd = function elementEnd_16(){
  $elementEnd_1(this.targetDocument);
  $retain_1(this.otherTarget.targetDocument, 1);
}
;
_.elementStart = function elementStart_16(tag, attrs){
  $elementStart_1(this.targetDocument, tag, attrs);
  $retain_1(this.otherTarget.targetDocument, 1);
}
;
_.finish_0 = function finish_9(){
  return $finish_3(this.targetDocument);
}
;
_.getClass$ = function getClass_809(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_InsertionTransformer$Target_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_22(oldAttrs, newAttrs){
  throw new UnsupportedOperationException_1('This method should never be called.');
}
;
_.retain = function retain_18(itemCount){
  var oldPosition;
  oldPosition = this.relativePosition.get_1();
  this.relativePosition.increase(itemCount);
  if (this.relativePosition.get_1() < 0) {
    $retain_1(this.targetDocument, itemCount);
    $retain_1(this.otherTarget.targetDocument, itemCount);
  }
   else if (oldPosition < 0) {
    $retain_1(this.targetDocument, -oldPosition);
    $retain_1(this.otherTarget.targetDocument, -oldPosition);
  }
}
;
_.updateAttributes = function updateAttributes_22(attrUpdate){
  throw new UnsupportedOperationException_1('This method should never be called.');
}
;
_.castableTypeMap$ = {};
_.otherTarget = null;
_.relativePosition = null;
function $clinit_1226(){
  $clinit_1226 = nullMethod;
  retainResolver = new NoninsertionTransformer$1_0;
  deleteElementEndResolver = new NoninsertionTransformer$2_0;
}

function $transformOperations_1(this$static, clientOp, serverOp){
  var $e0, clientIndex, clientPosition, clientTarget, e, positionTracker, serverIndex, serverPosition, serverTarget;
  try {
    positionTracker = new PositionTracker_0;
    clientPosition = new PositionTracker$1_0(positionTracker);
    serverPosition = new PositionTracker$2_0(positionTracker);
    clientTarget = new NoninsertionTransformer$Target_0(this$static.clientOperation, clientPosition, this$static.clientAnnotationTracker);
    serverTarget = new NoninsertionTransformer$Target_0(this$static.serverOperation, serverPosition, this$static.serverAnnotationTracker);
    clientTarget.otherTarget = serverTarget;
    serverTarget.otherTarget = clientTarget;
    clientIndex = 0;
    serverIndex = 0;
    while (clientIndex < clientOp.size_0()) {
      clientOp.applyComponent(clientIndex++, clientTarget);
      while (clientPosition.this$0.position_0 > 0) {
        if (serverIndex >= serverOp.size_0()) {
          throw new TransformException_0('Ran out of ' + serverOp.size_0() + ' server op components after ' + clientIndex + ' of ' + clientOp.size_0() + ' client op components, with ' + clientPosition.this$0.position_0 + ' spare positions');
        }
        serverOp.applyComponent(serverIndex++, serverTarget);
      }
    }
    while (serverIndex < serverOp.size_0()) {
      serverOp.applyComponent(serverIndex++, serverTarget);
    }
    clientOp = dynamicCast($finish_1(clientTarget.targetDocument), 173);
    serverOp = dynamicCast($finish_1(serverTarget.targetDocument), 173);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 237)) {
      e = $e0;
      throw new TransformException_0(e.detailMessage);
    }
     else 
      throw $e0;
  }
  return new OperationPair_0(clientOp, serverOp);
}

function NoninsertionTransformer_0(){
  $clinit_1226();
  this.clientOperation = new AnnotationsNormalizer_0(new RangeNormalizer_0(new DocOpBuffer_0));
  this.serverOperation = new AnnotationsNormalizer_0(new RangeNormalizer_0(new DocOpBuffer_0));
  this.clientAnnotationTracker = new NoninsertionTransformer$3_0(this, this.clientOperation);
  this.serverAnnotationTracker = new NoninsertionTransformer$4_0(this, this.serverOperation);
}

function NoninsertionTransformer(){
}

_ = NoninsertionTransformer_0.prototype = NoninsertionTransformer.prototype = new Object_0;
_.getClass$ = function getClass_810(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer_2_classLit;
}
;
_.castableTypeMap$ = {};
var deleteElementEndResolver, retainResolver;
function NoninsertionTransformer$1_0(){
}

function NoninsertionTransformer$1(){
}

_ = NoninsertionTransformer$1_0.prototype = NoninsertionTransformer$1.prototype = new Object_0;
_.getClass$ = function getClass_811(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$1_2_classLit;
}
;
_.resolve_0 = function resolve_5(size, range){
  range.resolveRetain(size);
}
;
_.castableTypeMap$ = {};
function NoninsertionTransformer$2_0(){
}

function NoninsertionTransformer$2(){
}

_ = NoninsertionTransformer$2_0.prototype = NoninsertionTransformer$2.prototype = new Object_0;
_.getClass$ = function getClass_812(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$2_2_classLit;
}
;
_.resolve_0 = function resolve_6(size, range){
  range.resolveDeleteElementEnd();
}
;
_.castableTypeMap$ = {};
function $commenceDeletion(this$static){
  var changeKeys, changeNewValues, changeOldValues, currentActive, entry, entry$iterator, forCombining, key, otherTracker, update;
  otherTracker = this$static.opposingTracker();
  changeKeys = new ArrayList_0;
  changeOldValues = new ArrayList_0;
  changeNewValues = new ArrayList_0;
  for (entry$iterator = otherTracker.propagating.entrySet_0().iterator_0(); entry$iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.next_0(), 66);
    key = dynamicCast(entry.getKey(), 1);
    update = dynamicCast(entry.getValue(), 233);
    forCombining = dynamicCast(this$static.active.get(key), 233);
    this$static.temporary.put(key, forCombining);
    if (update) {
      setCheck(changeKeys.array, changeKeys.size++, key);
      $add_9(changeNewValues, update.newValue);
      forCombining?$add_9(changeOldValues, forCombining.oldValue):otherTracker.active.containsKey(key)?$add_9(changeOldValues, dynamicCast(otherTracker.active.get(key), 233).newValue):$add_9(changeOldValues, update.oldValue);
    }
     else if (otherTracker.active.containsKey(key)) {
      currentActive = dynamicCast(otherTracker.active.get(key), 233);
      setCheck(changeKeys.array, changeKeys.size++, key);
      $add_9(changeOldValues, currentActive.newValue);
      forCombining?$add_9(changeNewValues, forCombining.newValue):$add_9(changeNewValues, currentActive.oldValue);
    }
  }
  $commit(this$static, new AnnotationBoundaryMapImpl_0(initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0), dynamicCast($toArray_1(changeKeys, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234), dynamicCast($toArray_1(changeOldValues, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234), dynamicCast($toArray_1(changeNewValues, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234)));
}

function $commit(this$static, map){
  var i, key, oldActive;
  for (i = 0; i < map.endKeys.length; ++i) {
    key = map.endKeys[i];
    this$static.propagating.containsKey(key) || this$static.propagating.put(key, dynamicCast(this$static.active.get(key), 233));
    this$static.active.remove_2(key);
  }
  for (i = 0; i < map.changeKeys.length; ++i) {
    key = map.changeKeys[i];
    oldActive = dynamicCast(this$static.active.get(key), 233);
    if (!oldActive || !equal_0(oldActive.oldValue, map.changeOldValues[i]) || !equal_0(oldActive.newValue, map.changeNewValues[i])) {
      this$static.propagating.containsKey(key) || this$static.propagating.put(key, dynamicCast(this$static.active.get(key), 233));
      this$static.active.put(key, new ValueUpdate_0(map.changeOldValues[i], map.changeNewValues[i]));
    }
  }
  $annotationBoundary(this$static.output, map);
}

function $concludeDeletion(this$static){
  var changeKeys, changeNewValues, changeOldValues, endKeys, entry, entry$iterator, key, update;
  this$static.opposingTracker();
  endKeys = new ArrayList_0;
  changeKeys = new ArrayList_0;
  changeOldValues = new ArrayList_0;
  changeNewValues = new ArrayList_0;
  for (entry$iterator = this$static.temporary.entrySet_0().iterator_0(); entry$iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.next_0(), 66);
    key = dynamicCast(entry.getKey(), 1);
    update = dynamicCast(entry.getValue(), 233);
    if (update) {
      setCheck(changeKeys.array, changeKeys.size++, key);
      $add_9(changeOldValues, update.oldValue);
      $add_9(changeNewValues, update.newValue);
    }
     else {
      setCheck(endKeys.array, endKeys.size++, key);
    }
  }
  this$static.propagating.clear();
  $commit(this$static, new AnnotationBoundaryMapImpl_0(dynamicCast($toArray_1(endKeys, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234), dynamicCast($toArray_1(changeKeys, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234), dynamicCast($toArray_1(changeOldValues, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234), dynamicCast($toArray_1(changeNewValues, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234)));
  this$static.temporary.clear();
}

function $register_0(this$static, map){
  var i;
  for (i = 0; i < map.endSize(); ++i) {
    this$static.tracked.remove_2(map.getEndKey_0(i));
  }
  for (i = 0; i < map.changeSize(); ++i) {
    this$static.tracked.put(map.getChangeKey_0(i), new ValueUpdate_0(map.getOldValue(i), map.getNewValue(i)));
  }
  this$static.process(map);
}

function NoninsertionTransformer$AnnotationTracker_0(output){
  this.tracked = new HashMap_0;
  this.active = new HashMap_0;
  this.temporary = new HashMap_0;
  this.propagating = new HashMap_0;
  this.output = output;
}

function NoninsertionTransformer$AnnotationTracker(){
}

_ = NoninsertionTransformer$AnnotationTracker.prototype = new Object_0;
_.getClass$ = function getClass_813(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$AnnotationTracker_2_classLit;
}
;
_.castableTypeMap$ = {};
_.output = null;
function NoninsertionTransformer$3_0(this$0, $anonymous0){
  this.this$0 = this$0;
  NoninsertionTransformer$AnnotationTracker_0.call(this, $anonymous0);
}

function NoninsertionTransformer$3(){
}

_ = NoninsertionTransformer$3_0.prototype = NoninsertionTransformer$3.prototype = new NoninsertionTransformer$AnnotationTracker;
_.getClass$ = function getClass_814(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$3_2_classLit;
}
;
_.opposingTracker = function opposingTracker(){
  return this.this$0.serverAnnotationTracker;
}
;
_.process = function process_0(map){
  var clientChangeKeys, clientChangeNewValues, clientChangeOldValues, clientEndKeys, i, key, newValue, oldValue, serverChangeKeys, serverChangeNewValues, serverChangeOldValues, serverEndKeys, serverValues;
  clientEndKeys = new ArrayList_0;
  clientChangeKeys = new ArrayList_0;
  clientChangeOldValues = new ArrayList_0;
  clientChangeNewValues = new ArrayList_0;
  serverEndKeys = new ArrayList_0;
  serverChangeKeys = new ArrayList_0;
  serverChangeOldValues = new ArrayList_0;
  serverChangeNewValues = new ArrayList_0;
  for (i = 0; i < map.endSize(); ++i) {
    key = map.getEndKey_0(i);
    serverValues = dynamicCast(this.this$0.serverAnnotationTracker.tracked.get(key), 233);
    setCheck(clientEndKeys.array, clientEndKeys.size++, key);
    if (serverValues) {
      setCheck(serverChangeKeys.array, serverChangeKeys.size++, key);
      $add_9(serverChangeOldValues, serverValues.oldValue);
      $add_9(serverChangeNewValues, serverValues.newValue);
    }
  }
  for (i = 0; i < map.changeSize(); ++i) {
    key = map.getChangeKey_0(i);
    oldValue = map.getOldValue(i);
    newValue = map.getNewValue(i);
    serverValues = dynamicCast(this.this$0.serverAnnotationTracker.tracked.get(key), 233);
    setCheck(clientChangeKeys.array, clientChangeKeys.size++, key);
    setCheck(clientChangeNewValues.array, clientChangeNewValues.size++, newValue);
    if (serverValues) {
      $add_9(clientChangeOldValues, serverValues.newValue);
      setCheck(serverEndKeys.array, serverEndKeys.size++, key);
    }
     else {
      setCheck(clientChangeOldValues.array, clientChangeOldValues.size++, oldValue);
    }
  }
  $commit(this, new AnnotationBoundaryMapImpl_0(dynamicCast($toArray_1(clientEndKeys, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234), dynamicCast($toArray_1(clientChangeKeys, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234), dynamicCast($toArray_1(clientChangeOldValues, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234), dynamicCast($toArray_1(clientChangeNewValues, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234)));
  $commit(this.this$0.serverAnnotationTracker, new AnnotationBoundaryMapImpl_0(dynamicCast($toArray_1(serverEndKeys, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234), dynamicCast($toArray_1(serverChangeKeys, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234), dynamicCast($toArray_1(serverChangeOldValues, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234), dynamicCast($toArray_1(serverChangeNewValues, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234)));
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function NoninsertionTransformer$4_0(this$0, $anonymous0){
  this.this$0 = this$0;
  NoninsertionTransformer$AnnotationTracker_0.call(this, $anonymous0);
}

function NoninsertionTransformer$4(){
}

_ = NoninsertionTransformer$4_0.prototype = NoninsertionTransformer$4.prototype = new NoninsertionTransformer$AnnotationTracker;
_.getClass$ = function getClass_815(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$4_2_classLit;
}
;
_.opposingTracker = function opposingTracker_0(){
  return this.this$0.clientAnnotationTracker;
}
;
_.process = function process_1(map){
  var clientChangeKeys, clientChangeNewValues, clientChangeOldValues, clientEndKeys, clientValues, i, key, newValue, oldValue, serverChangeKeys, serverChangeNewValues, serverChangeOldValues, serverEndKeys;
  serverEndKeys = new ArrayList_0;
  serverChangeKeys = new ArrayList_0;
  serverChangeOldValues = new ArrayList_0;
  serverChangeNewValues = new ArrayList_0;
  clientEndKeys = new ArrayList_0;
  clientChangeKeys = new ArrayList_0;
  clientChangeOldValues = new ArrayList_0;
  clientChangeNewValues = new ArrayList_0;
  for (i = 0; i < map.endSize(); ++i) {
    key = map.getEndKey_0(i);
    clientValues = dynamicCast(this.this$0.clientAnnotationTracker.tracked.get(key), 233);
    if (clientValues) {
      setCheck(clientChangeKeys.array, clientChangeKeys.size++, key);
      $add_9(clientChangeOldValues, clientValues.oldValue);
      $add_9(clientChangeNewValues, clientValues.newValue);
    }
     else {
      setCheck(serverEndKeys.array, serverEndKeys.size++, key);
    }
  }
  for (i = 0; i < map.changeSize(); ++i) {
    key = map.getChangeKey_0(i);
    oldValue = map.getOldValue(i);
    newValue = map.getNewValue(i);
    clientValues = dynamicCast(this.this$0.clientAnnotationTracker.tracked.get(key), 233);
    if (clientValues) {
      setCheck(clientChangeKeys.array, clientChangeKeys.size++, key);
      setCheck(clientChangeOldValues.array, clientChangeOldValues.size++, newValue);
      $add_9(clientChangeNewValues, clientValues.newValue);
    }
     else {
      setCheck(serverChangeKeys.array, serverChangeKeys.size++, key);
      setCheck(serverChangeOldValues.array, serverChangeOldValues.size++, oldValue);
      setCheck(serverChangeNewValues.array, serverChangeNewValues.size++, newValue);
    }
  }
  $commit(this, new AnnotationBoundaryMapImpl_0(dynamicCast($toArray_1(serverEndKeys, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234), dynamicCast($toArray_1(serverChangeKeys, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234), dynamicCast($toArray_1(serverChangeOldValues, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234), dynamicCast($toArray_1(serverChangeNewValues, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234)));
  $commit(this.this$0.clientAnnotationTracker, new AnnotationBoundaryMapImpl_0(dynamicCast($toArray_1(clientEndKeys, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234), dynamicCast($toArray_1(clientChangeKeys, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234), dynamicCast($toArray_1(clientChangeOldValues, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234), dynamicCast($toArray_1(clientChangeNewValues, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0)), 234)));
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function NoninsertionTransformer$DeleteCharactersResolver_0(characters){
  this.characters = characters;
}

function NoninsertionTransformer$DeleteCharactersResolver(){
}

_ = NoninsertionTransformer$DeleteCharactersResolver_0.prototype = NoninsertionTransformer$DeleteCharactersResolver.prototype = new Object_0;
_.getClass$ = function getClass_816(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$DeleteCharactersResolver_2_classLit;
}
;
_.resolve_0 = function resolve_7(size, range){
  range.resolveDeleteCharacters(this.characters.substr(0, size - 0));
}
;
_.castableTypeMap$ = {};
_.characters = null;
function NoninsertionTransformer$DeleteElementStartResolver_0(type, attributes){
  this.type_0 = type;
  this.attributes = attributes;
}

function NoninsertionTransformer$DeleteElementStartResolver(){
}

_ = NoninsertionTransformer$DeleteElementStartResolver_0.prototype = NoninsertionTransformer$DeleteElementStartResolver.prototype = new Object_0;
_.getClass$ = function getClass_817(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$DeleteElementStartResolver_2_classLit;
}
;
_.resolve_0 = function resolve_8(size, range){
  range.resolveDeleteElementStart(this.type_0, this.attributes);
}
;
_.castableTypeMap$ = {};
_.attributes = null;
_.type_0 = null;
function NoninsertionTransformer$InternalTransformException_0(){
  this.fillInStackTrace();
  this.detailMessage = 'Incompatible operations in transformation';
}

function NoninsertionTransformer$InternalTransformException(){
}

_ = NoninsertionTransformer$InternalTransformException_0.prototype = NoninsertionTransformer$InternalTransformException.prototype = new RuntimeException;
_.getClass$ = function getClass_818(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$InternalTransformException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1, 237:1};
function NoninsertionTransformer$RangeCache(){
}

_ = NoninsertionTransformer$RangeCache.prototype = new Object_0;
_.getClass$ = function getClass_819(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$RangeCache_2_classLit;
}
;
_.resolveDeleteCharacters = function resolveDeleteCharacters(characters){
  throw new NoninsertionTransformer$InternalTransformException_0;
}
;
_.resolveDeleteElementEnd = function resolveDeleteElementEnd(){
  throw new NoninsertionTransformer$InternalTransformException_0;
}
;
_.resolveDeleteElementStart = function resolveDeleteElementStart(type, attributes){
  throw new NoninsertionTransformer$InternalTransformException_0;
}
;
_.resolveReplaceAttributes = function resolveReplaceAttributes(oldAttributes, newAttributes){
  throw new NoninsertionTransformer$InternalTransformException_0;
}
;
_.resolveUpdateAttributes = function resolveUpdateAttributes(update){
  throw new NoninsertionTransformer$InternalTransformException_0;
}
;
_.castableTypeMap$ = {};
function NoninsertionTransformer$ReplaceAttributesResolver_0(oldAttributes, newAttributes){
  this.oldAttributes = oldAttributes;
  this.newAttributes = newAttributes;
}

function NoninsertionTransformer$ReplaceAttributesResolver(){
}

_ = NoninsertionTransformer$ReplaceAttributesResolver_0.prototype = NoninsertionTransformer$ReplaceAttributesResolver.prototype = new Object_0;
_.getClass$ = function getClass_820(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$ReplaceAttributesResolver_2_classLit;
}
;
_.resolve_0 = function resolve_9(size, range){
  range.resolveReplaceAttributes(this.oldAttributes, this.newAttributes);
}
;
_.castableTypeMap$ = {};
_.newAttributes = null;
_.oldAttributes = null;
function $doDeleteCharacters_1(this$static, chars){
  $commenceDeletion(this$static.annotationTracker);
  $deleteCharacters_0(this$static.targetDocument, chars);
  $concludeDeletion(this$static.annotationTracker);
}

function $doDeleteElementEnd_0(this$static){
  $commenceDeletion(this$static.annotationTracker);
  $deleteElementEnd_0(this$static.targetDocument);
  $concludeDeletion(this$static.annotationTracker);
}

function $doDeleteElementStart_0(this$static, type, attrs){
  $commenceDeletion(this$static.annotationTracker);
  $deleteElementStart_0(this$static.targetDocument, type, attrs);
  $concludeDeletion(this$static.annotationTracker);
}

function $resolveRange_0(this$static, size, resolver){
  var oldPosition;
  oldPosition = this$static.relativePosition.get_1();
  this$static.relativePosition.increase(size);
  if (this$static.relativePosition.get_1() > 0) {
    oldPosition < 0 && resolver.resolve_0(-oldPosition, this$static.otherTarget.rangeCache);
    return -oldPosition;
  }
   else {
    resolver.resolve_0(size, this$static.otherTarget.rangeCache);
    return -1;
  }
}

function $syncAnnotations(this$static){
  this$static.annotationTracker.propagating.clear();
  this$static.otherTarget.annotationTracker.propagating.clear();
}

function NoninsertionTransformer$Target_0(targetDocument, relativePosition, annotationTracker){
  this.retainCache = new NoninsertionTransformer$Target$1_0(this);
  this.rangeCache = this.retainCache;
  this.targetDocument = targetDocument;
  this.relativePosition = relativePosition;
  this.annotationTracker = annotationTracker;
}

function NoninsertionTransformer$Target(){
}

_ = NoninsertionTransformer$Target_0.prototype = NoninsertionTransformer$Target.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_11(map){
  $register_0(this.annotationTracker, map);
}
;
_.characters_0 = function characters_18(chars){
  throw new UnsupportedOperationException_1('This method should never be called.');
}
;
_.deleteCharacters = function deleteCharacters_21(chars){
  var resolutionSize;
  resolutionSize = $resolveRange_0(this, chars.length, new NoninsertionTransformer$DeleteCharactersResolver_0(chars));
  resolutionSize >= 0 && (this.rangeCache = new NoninsertionTransformer$Target$DeleteCharactersCache_0(this, chars.substr(resolutionSize, chars.length - resolutionSize)));
}
;
_.deleteElementEnd = function deleteElementEnd_21(){
  $resolveRange_0(this, 1, ($clinit_1226() , deleteElementEndResolver)) == 0 && (this.rangeCache = new NoninsertionTransformer$Target$DeleteElementEndCache_0(this));
}
;
_.deleteElementStart = function deleteElementStart_21(tag, attrs){
  $resolveRange_0(this, 1, new NoninsertionTransformer$DeleteElementStartResolver_0(tag, attrs)) == 0 && (this.rangeCache = new NoninsertionTransformer$Target$DeleteElementStartCache_0(this, tag, attrs));
}
;
_.elementEnd = function elementEnd_17(){
  throw new UnsupportedOperationException_1('This method should never be called.');
}
;
_.elementStart = function elementStart_17(tag, attrs){
  throw new UnsupportedOperationException_1('This method should never be called.');
}
;
_.finish_0 = function finish_10(){
  return dynamicCast($finish_1(this.targetDocument), 173);
}
;
_.getClass$ = function getClass_821(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$Target_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_23(oldAttrs, newAttrs){
  $resolveRange_0(this, 1, new NoninsertionTransformer$ReplaceAttributesResolver_0(oldAttrs, newAttrs)) == 0 && (this.rangeCache = new NoninsertionTransformer$Target$ReplaceAttributesCache_0(this, oldAttrs, newAttrs));
}
;
_.retain = function retain_19(itemCount){
  $resolveRange_0(this, itemCount, ($clinit_1226() , retainResolver));
  this.rangeCache = this.retainCache;
}
;
_.updateAttributes = function updateAttributes_23(attrUpdate){
  $resolveRange_0(this, 1, new NoninsertionTransformer$UpdateAttributesResolver_0(attrUpdate)) == 0 && (this.rangeCache = new NoninsertionTransformer$Target$UpdateAttributesCache_0(this, attrUpdate));
}
;
_.castableTypeMap$ = {};
_.annotationTracker = null;
_.depth = 0;
_.otherTarget = null;
_.relativePosition = null;
_.targetDocument = null;
function NoninsertionTransformer$Target$1_0(this$1){
  this.this$1 = this$1;
}

function NoninsertionTransformer$Target$1(){
}

_ = NoninsertionTransformer$Target$1_0.prototype = NoninsertionTransformer$Target$1.prototype = new NoninsertionTransformer$RangeCache;
_.getClass$ = function getClass_822(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$Target$1_2_classLit;
}
;
_.resolveDeleteCharacters = function resolveDeleteCharacters_0(characters){
  $doDeleteCharacters_1(this.this$1.otherTarget, characters);
}
;
_.resolveDeleteElementEnd = function resolveDeleteElementEnd_0(){
  $doDeleteElementEnd_0(this.this$1.otherTarget);
  --this.this$1.otherTarget.depth;
}
;
_.resolveDeleteElementStart = function resolveDeleteElementStart_0(type, attributes){
  $doDeleteElementStart_0(this.this$1.otherTarget, type, attributes);
  ++this.this$1.otherTarget.depth;
}
;
_.resolveReplaceAttributes = function resolveReplaceAttributes_0(oldAttributes, newAttributes){
  $syncAnnotations(this.this$1);
  $retain_0(this.this$1.targetDocument, 1);
  $replaceAttributes_0(this.this$1.otherTarget.targetDocument, oldAttributes, newAttributes);
}
;
_.resolveRetain = function resolveRetain(itemCount){
  $syncAnnotations(this.this$1);
  $retain_0(this.this$1.targetDocument, itemCount);
  $retain_0(this.this$1.otherTarget.targetDocument, itemCount);
}
;
_.resolveUpdateAttributes = function resolveUpdateAttributes_0(update){
  $syncAnnotations(this.this$1);
  $retain_0(this.this$1.targetDocument, 1);
  $updateAttributes_0(this.this$1.otherTarget.targetDocument, update);
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
--></script>
<script><!--
function NoninsertionTransformer$Target$DeleteCharactersCache_0(this$1, characters){
  this.this$1 = this$1;
  this.characters = characters;
}

function NoninsertionTransformer$Target$DeleteCharactersCache(){
}

_ = NoninsertionTransformer$Target$DeleteCharactersCache_0.prototype = NoninsertionTransformer$Target$DeleteCharactersCache.prototype = new NoninsertionTransformer$RangeCache;
_.getClass$ = function getClass_823(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$Target$DeleteCharactersCache_2_classLit;
}
;
_.resolveDeleteCharacters = function resolveDeleteCharacters_1(characters){
  this.characters = $substring(this.characters, characters.length);
}
;
_.resolveRetain = function resolveRetain_0(itemCount){
  $doDeleteCharacters_1(this.this$1, this.characters.substr(0, itemCount - 0));
  this.characters = $substring(this.characters, itemCount);
}
;
_.castableTypeMap$ = {};
_.characters = null;
_.this$1 = null;
function NoninsertionTransformer$Target$DeleteElementEndCache_0(this$1){
  this.this$1 = this$1;
}

function NoninsertionTransformer$Target$DeleteElementEndCache(){
}

_ = NoninsertionTransformer$Target$DeleteElementEndCache_0.prototype = NoninsertionTransformer$Target$DeleteElementEndCache.prototype = new NoninsertionTransformer$RangeCache;
_.getClass$ = function getClass_824(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$Target$DeleteElementEndCache_2_classLit;
}
;
_.resolveDeleteElementEnd = function resolveDeleteElementEnd_1(){
  --this.this$1.depth;
  --this.this$1.otherTarget.depth;
}
;
_.resolveRetain = function resolveRetain_1(itemCount){
  $doDeleteElementEnd_0(this.this$1);
  --this.this$1.depth;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
function NoninsertionTransformer$Target$DeleteElementStartCache_0(this$1, type, attributes){
  this.this$1 = this$1;
  this.type_0 = type;
  this.attributes = attributes;
}

function NoninsertionTransformer$Target$DeleteElementStartCache(){
}

_ = NoninsertionTransformer$Target$DeleteElementStartCache_0.prototype = NoninsertionTransformer$Target$DeleteElementStartCache.prototype = new NoninsertionTransformer$RangeCache;
_.getClass$ = function getClass_825(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$Target$DeleteElementStartCache_2_classLit;
}
;
_.resolveDeleteElementStart = function resolveDeleteElementStart_1(type, attributes){
  ++this.this$1.depth;
  ++this.this$1.otherTarget.depth;
}
;
_.resolveReplaceAttributes = function resolveReplaceAttributes_1(oldAttributes, newAttributes){
  $doDeleteElementStart_0(this.this$1, this.type_0, newAttributes);
  ++this.this$1.depth;
}
;
_.resolveRetain = function resolveRetain_2(itemCount){
  $doDeleteElementStart_0(this.this$1, this.type_0, this.attributes);
  ++this.this$1.depth;
}
;
_.resolveUpdateAttributes = function resolveUpdateAttributes_1(update){
  $doDeleteElementStart_0(this.this$1, this.type_0, dynamicCast($updateWith(this.attributes, update, true), 236));
  ++this.this$1.depth;
}
;
_.castableTypeMap$ = {};
_.attributes = null;
_.this$1 = null;
_.type_0 = null;
function NoninsertionTransformer$Target$ReplaceAttributesCache_0(this$1, oldAttributes, newAttributes){
  this.this$1 = this$1;
  this.oldAttributes = oldAttributes;
  this.newAttributes = newAttributes;
}

function NoninsertionTransformer$Target$ReplaceAttributesCache(){
}

_ = NoninsertionTransformer$Target$ReplaceAttributesCache_0.prototype = NoninsertionTransformer$Target$ReplaceAttributesCache.prototype = new NoninsertionTransformer$RangeCache;
_.getClass$ = function getClass_826(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$Target$ReplaceAttributesCache_2_classLit;
}
;
_.resolveDeleteElementStart = function resolveDeleteElementStart_2(type, attributes){
  $doDeleteElementStart_0(this.this$1.otherTarget, type, this.newAttributes);
  ++this.this$1.otherTarget.depth;
}
;
_.resolveReplaceAttributes = function resolveReplaceAttributes_2(oldAttributes, newAttributes){
  $syncAnnotations(this.this$1);
  $replaceAttributes_0(this.this$1.targetDocument, newAttributes, this.newAttributes);
  $retain_0(this.this$1.otherTarget.targetDocument, 1);
}
;
_.resolveRetain = function resolveRetain_3(itemCount){
  $syncAnnotations(this.this$1);
  $replaceAttributes_0(this.this$1.targetDocument, this.oldAttributes, this.newAttributes);
  $retain_0(this.this$1.otherTarget.targetDocument, 1);
}
;
_.resolveUpdateAttributes = function resolveUpdateAttributes_2(update){
  $syncAnnotations(this.this$1);
  $replaceAttributes_0(this.this$1.targetDocument, dynamicCast($updateWith(this.oldAttributes, update, true), 236), this.newAttributes);
  $retain_0(this.this$1.otherTarget.targetDocument, 1);
}
;
_.castableTypeMap$ = {};
_.newAttributes = null;
_.oldAttributes = null;
_.this$1 = null;
function NoninsertionTransformer$Target$UpdateAttributesCache_0(this$1, update){
  this.this$1 = this$1;
  this.update = update;
}

function NoninsertionTransformer$Target$UpdateAttributesCache(){
}

_ = NoninsertionTransformer$Target$UpdateAttributesCache_0.prototype = NoninsertionTransformer$Target$UpdateAttributesCache.prototype = new NoninsertionTransformer$RangeCache;
_.getClass$ = function getClass_827(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$Target$UpdateAttributesCache_2_classLit;
}
;
_.resolveDeleteElementStart = function resolveDeleteElementStart_3(type, attributes){
  $doDeleteElementStart_0(this.this$1.otherTarget, type, dynamicCast($updateWith(attributes, this.update, true), 236));
  ++this.this$1.otherTarget.depth;
}
;
_.resolveReplaceAttributes = function resolveReplaceAttributes_3(oldAttributes, newAttributes){
  $syncAnnotations(this.this$1);
  $retain_0(this.this$1.targetDocument, 1);
  $replaceAttributes_0(this.this$1.otherTarget.targetDocument, dynamicCast($updateWith(oldAttributes, this.update, true), 236), newAttributes);
}
;
_.resolveRetain = function resolveRetain_4(itemCount){
  $syncAnnotations(this.this$1);
  $updateAttributes_0(this.this$1.targetDocument, this.update);
  $retain_0(this.this$1.otherTarget.targetDocument, 1);
}
;
_.resolveUpdateAttributes = function resolveUpdateAttributes_3(update){
  var i, key, keySet, newOldValue, newUpdate, transformedAttributes, updated;
  $syncAnnotations(this.this$1);
  updated = new HashMap_0;
  for (i = 0; i < update.updates.size_0(); ++i) {
    updated.put(dynamicCast(update.updates.get_0(i), 220).name_0, dynamicCast(update.updates.get_0(i), 220).newValue);
  }
  newUpdate = new AttributesUpdateImpl_0;
  for (i = 0; i < this.update.updates.size_0(); ++i) {
    key = dynamicCast(this.update.updates.get_0(i), 220).name_0;
    newOldValue = updated.containsKey(key)?dynamicCast(updated.get(key), 1):dynamicCast(this.update.updates.get_0(i), 220).oldValue;
    newUpdate = $composeWith(newUpdate, new AttributesUpdateImpl_1(initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, [key, newOldValue, dynamicCast(this.update.updates.get_0(i), 220).newValue])));
  }
  $updateAttributes_0(this.this$1.targetDocument, newUpdate);
  keySet = new HashSet_0;
  for (i = 0; i < this.update.updates.size_0(); ++i) {
    $add_11(keySet, dynamicCast(this.update.updates.get_0(i), 220).name_0);
  }
  transformedAttributes = $exclude(update, keySet);
  $updateAttributes_0(this.this$1.otherTarget.targetDocument, transformedAttributes);
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
_.update = null;
function NoninsertionTransformer$UpdateAttributesResolver_0(update){
  this.update = update;
}

function NoninsertionTransformer$UpdateAttributesResolver(){
}

_ = NoninsertionTransformer$UpdateAttributesResolver_0.prototype = NoninsertionTransformer$UpdateAttributesResolver.prototype = new Object_0;
_.getClass$ = function getClass_828(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$UpdateAttributesResolver_2_classLit;
}
;
_.resolve_0 = function resolve_10(size, range){
  range.resolveUpdateAttributes(this.update);
}
;
_.castableTypeMap$ = {};
_.update = null;
function PositionTracker_0(){
}

function PositionTracker(){
}

_ = PositionTracker_0.prototype = PositionTracker.prototype = new Object_0;
_.getClass$ = function getClass_829(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_PositionTracker_2_classLit;
}
;
_.castableTypeMap$ = {};
_.position_0 = 0;
function PositionTracker$1_0(this$0){
  this.this$0 = this$0;
}

function PositionTracker$1(){
}

_ = PositionTracker$1_0.prototype = PositionTracker$1.prototype = new Object_0;
_.get_1 = function get_15(){
  return this.this$0.position_0;
}
;
_.getClass$ = function getClass_830(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_PositionTracker$1_2_classLit;
}
;
_.increase = function increase(amount){
  this.this$0.position_0 += amount;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function PositionTracker$2_0(this$0){
  this.this$0 = this$0;
}

function PositionTracker$2(){
}

_ = PositionTracker$2_0.prototype = PositionTracker$2.prototype = new Object_0;
_.get_1 = function get_16(){
  return -this.this$0.position_0;
}
;
_.getClass$ = function getClass_831(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_PositionTracker$2_2_classLit;
}
;
_.increase = function increase_0(amount){
  this.this$0.position_0 -= amount;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $characters_1(this$static, chars){
  !chars.length || this$static.cache.characters_0(chars);
}

function $elementEnd_1(this$static){
  this$static.cache.flush_0();
  $add_9(this$static.target_0.accu, ($clinit_1312() , INSTANCE_15));
}

function $elementStart_1(this$static, type, attrs){
  this$static.cache.flush_0();
  $add_9(this$static.target_0.accu, new OperationComponents$ElementStart_0(type, attrs));
}

function $finish_3(this$static){
  this$static.cache.flush_0();
  return this$static.target_0.finish_1();
}

function $retain_1(this$static, itemCount){
  itemCount > 0 && this$static.cache.skip(itemCount);
}

function RangeNormalizer_0(target){
  this.emptyCache = new RangeNormalizer$1_0(this);
  this.skipCache = new RangeNormalizer$2_0(this);
  this.charactersCache = new RangeNormalizer$3_0(this);
  this.deleteCharactersCache = new RangeNormalizer$4_0(this);
  this.cache = this.emptyCache;
  this.target_0 = target;
}

function RangeNormalizer(){
}

_ = RangeNormalizer_0.prototype = RangeNormalizer.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_12(map){
  this.cache.flush_0();
  $add_9(this.target_0.accu, new OperationComponents$AnnotationBoundary_0(map));
}
;
_.characters_0 = function characters_19(chars){
  !chars.length || this.cache.characters_0(chars);
}
;
_.deleteCharacters = function deleteCharacters_22(chars){
  !chars.length || this.cache.deleteCharacters(chars);
}
;
_.deleteElementEnd = function deleteElementEnd_22(){
  this.cache.flush_0();
  $add_9(this.target_0.accu, ($clinit_1310() , INSTANCE_14));
}
;
_.deleteElementStart = function deleteElementStart_22(type, attrs){
  this.cache.flush_0();
  $add_9(this.target_0.accu, new OperationComponents$DeleteElementStart_0(type, attrs));
}
;
_.elementEnd = function elementEnd_18(){
  this.cache.flush_0();
  $add_9(this.target_0.accu, ($clinit_1312() , INSTANCE_15));
}
;
_.elementStart = function elementStart_18(type, attrs){
  this.cache.flush_0();
  $add_9(this.target_0.accu, new OperationComponents$ElementStart_0(type, attrs));
}
;
_.finish_0 = function finish_11(){
  return this.cache.flush_0() , this.target_0.finish_1();
}
;
_.getClass$ = function getClass_832(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_24(oldAttrs, newAttrs){
  this.cache.flush_0();
  $add_9(this.target_0.accu, new OperationComponents$ReplaceAttributes_0(oldAttrs, newAttrs));
}
;
_.retain = function retain_20(itemCount){
  itemCount > 0 && this.cache.skip(itemCount);
}
;
_.updateAttributes = function updateAttributes_24(attrUpdate){
  this.cache.flush_0();
  $add_9(this.target_0.accu, new OperationComponents$UpdateAttributes_0(attrUpdate));
}
;
_.castableTypeMap$ = {};
_.target_0 = null;
function RangeNormalizer$Cache(){
}

_ = RangeNormalizer$Cache.prototype = new Object_0;
_.characters_0 = function characters_20(characters){
  this.flush_0();
  this.this$0_0.cache = this.this$0_0.charactersCache;
  this.this$0_0.cache.characters_0(characters);
}
;
_.deleteCharacters = function deleteCharacters_23(characters){
  this.flush_0();
  this.this$0_0.cache = this.this$0_0.deleteCharactersCache;
  this.this$0_0.cache.deleteCharacters(characters);
}
;
_.getClass$ = function getClass_833(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer$Cache_2_classLit;
}
;
_.skip = function skip_5(distance){
  this.flush_0();
  this.this$0_0.cache = this.this$0_0.skipCache;
  this.this$0_0.cache.skip(distance);
}
;
_.castableTypeMap$ = {};
_.this$0_0 = null;
function RangeNormalizer$1_0(this$0){
  this.this$0_0 = this$0;
}

function RangeNormalizer$1(){
}

_ = RangeNormalizer$1_0.prototype = RangeNormalizer$1.prototype = new RangeNormalizer$Cache;
_.flush_0 = function flush_0(){
}
;
_.getClass$ = function getClass_834(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function RangeNormalizer$2_0(this$0){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
}

function RangeNormalizer$2(){
}

_ = RangeNormalizer$2_0.prototype = RangeNormalizer$2.prototype = new RangeNormalizer$Cache;
_.flush_0 = function flush_1(){
  $add_9(this.this$0.target_0.accu, new OperationComponents$Retain_0(this.distance));
  this.distance = 0;
  this.this$0.cache = this.this$0.emptyCache;
}
;
_.getClass$ = function getClass_835(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer$2_2_classLit;
}
;
_.skip = function skip_6(distance){
  this.distance += distance;
}
;
_.castableTypeMap$ = {};
_.distance = 0;
_.this$0 = null;
function RangeNormalizer$3_0(this$0){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
  this.characters = new StringBuilder_0;
}

function RangeNormalizer$3(){
}

_ = RangeNormalizer$3_0.prototype = RangeNormalizer$3.prototype = new RangeNormalizer$Cache;
_.characters_0 = function characters_21(characters){
  $append_8(this.characters, characters);
}
;
_.flush_0 = function flush_2(){
  $add_9(this.this$0.target_0.accu, new OperationComponents$Characters_0(this.characters.impl.string));
  this.characters = new StringBuilder_0;
  this.this$0.cache = this.this$0.emptyCache;
}
;
_.getClass$ = function getClass_836(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function RangeNormalizer$4_0(this$0){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
  this.characters = new StringBuilder_0;
}

function RangeNormalizer$4(){
}

_ = RangeNormalizer$4_0.prototype = RangeNormalizer$4.prototype = new RangeNormalizer$Cache;
_.deleteCharacters = function deleteCharacters_24(characters){
  $append_8(this.characters, characters);
}
;
_.flush_0 = function flush_3(){
  $add_9(this.this$0.target_0.accu, new OperationComponents$DeleteCharacters_0(this.characters.impl.string));
  this.characters = new StringBuilder_0;
  this.this$0.cache = this.this$0.emptyCache;
}
;
_.getClass$ = function getClass_837(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer$4_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function transform(clientOp, serverOp){
  var $e0, c, ci0, ci1, ci2, cn0, cn1, cn2, e, r1, r2, r3, r4, s, si0, si1, si2, sn0, sn1, sn2;
  try {
    c = decompose(clientOp);
    s = decompose(serverOp);
    ci0 = dynamicCast(c.first, 173);
    cn0 = dynamicCast(c.second, 173);
    si0 = dynamicCast(s.first, 173);
    sn0 = dynamicCast(s.second, 173);
    r1 = $transformOperations_0(ci0, si0);
    ci1 = r1.clientOp;
    si1 = r1.serverOp;
    r2 = $transformOperations(ci1, sn0);
    ci2 = r2.clientOp;
    sn1 = r2.serverOp;
    r3 = $transformOperations(si1, cn0);
    si2 = r3.clientOp;
    cn1 = r3.serverOp;
    r4 = $transformOperations_1(new NoninsertionTransformer_0, cn1, sn1);
    cn2 = r4.clientOp;
    sn2 = r4.serverOp;
    return new OperationPair_0(compose(ci2, cn2), compose(si2, sn2));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 189)) {
      e = $e0;
      throw new TransformException_1(e);
    }
     else 
      throw $e0;
  }
}

function ValueUpdate_0(oldValue, newValue){
  this.oldValue = oldValue;
  this.newValue = newValue;
}

function ValueUpdate(){
}

_ = ValueUpdate_0.prototype = ValueUpdate.prototype = new Object_0;
_.equals$ = function equals_24(obj){
  var other;
  if (this === obj)
    return true;
  if (obj == null)
    return false;
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[233]))
    return false;
  other = dynamicCast(obj, 233);
  if (this.newValue == null) {
    if (other.newValue != null)
      return false;
  }
   else if (!$equals_3(this.newValue, other.newValue))
    return false;
  if (this.oldValue == null) {
    if (other.oldValue != null)
      return false;
  }
   else if (!$equals_3(this.oldValue, other.oldValue))
    return false;
  return true;
}
;
_.getClass$ = function getClass_838(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_ValueUpdate_2_classLit;
}
;
_.hashCode$ = function hashCode_24(){
  var result;
  result = 31 + (this.newValue == null?0:getHashCode_0(this.newValue));
  result = 31 * result + (this.oldValue == null?0:getHashCode_0(this.oldValue));
  return result;
}
;
_.castableTypeMap$ = {233:1};
_.newValue = null;
_.oldValue = null;
function $clinit_1259(){
  $clinit_1259 = nullMethod;
  EMPTY_DOCUMENT = new DocOpAutomaton$1_0;
  EMPTY_ANNOTATIONS = ($clinit_1283() , EMPTY_MAP_1);
}

function $addViolation_2(a_0, v){
  !!a_0 && $add_9(a_0.operationIllFormed, v);
  return $clinit_1267() , ILL_FORMED;
}

function $addViolation_3(a_0, v){
  !!a_0 && $add_9(a_0.operationInvalid, v);
  return $clinit_1267() , INVALID_DOCUMENT;
}

function $addViolation_4(a_0, v){
  !!a_0 && $add_9(a_0.schemaViolations, v);
  return $clinit_1267() , INVALID_SCHEMA;
}

function $annotationKeysNotStrictlyMonotonic(this$static, v, key1, key2){
  return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('annotation keys not strictly monotonic: ' + key1 + ' >= ' + key2, this$static.effectivePos, this$static.resultingPos));
}

function $attributeKeysNotStrictlyMonotonic(this$static, v, key1, key2){
  return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute keys not strictly monotonic: ' + key1 + ' >= ' + key2, this$static.effectivePos, this$static.resultingPos));
}

function $attributeNameNotXmlName(this$static, v, name_0){
  return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute name is not an XML Name: "' + name_0 + '"', this$static.effectivePos, this$static.resultingPos));
}

function $attributesEqual(a_0, b){
  var ae, ae$iterator, entry;
  if (a_0.entrySet_0().size_0() != b.entrySet_0().size_0()) {
    return false;
  }
  for (ae$iterator = new ImmutableStateMap$1$1_0(a_0.entrySet); ae$iterator.iterator.hasNext();) {
    ae = dynamicCast(ae$iterator.iterator.next_0(), 221);
    if (!equal(ae.value_0, (entry = $implFindEntry(b, ae.name_0, false) , !entry?null:entry.getValue()))) {
      return false;
    }
  }
  return true;
}

function $checkAnnotationBoundary(this$static, map, v){
  var endKeys, i, key, r, old;
  if (this$static.afterAnnotationBoundary) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('adjacent annotation boundaries', this$static.effectivePos, this$static.resultingPos));
  }
  endKeys = new HashSet_0;
  for (i = 0; i < map.endSize(); ++i) {
    key = map.getEndKey_0(i);
    r = $validateAnnotationKey_0(this$static, key, v);
    if (r != ($clinit_1267() , VALID)) {
      return r;
    }
    if (i > 0 && compareTo_5(map.getEndKey_0(i - 1), key) >= 0) {
      return $annotationKeysNotStrictlyMonotonic(this$static, v, map.getEndKey_0(i - 1), key);
    }
    if (!$containsKey_3(this$static.annotationsUpdate, key)) {
      return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('annotation of key ' + key + ' ends without having started', this$static.effectivePos, this$static.resultingPos));
    }
    old = endKeys.map.put(key, endKeys);
  }
  for (i = 0; i < map.changeSize(); ++i) {
    key = map.getChangeKey_0(i);
    r = $validateAnnotationKey_0(this$static, key, v);
    if (r != ($clinit_1267() , VALID)) {
      return r;
    }
    r = $validateAnnotationValue(this$static, map.getOldValue(i), v);
    if (r != VALID) {
      return r;
    }
    r = $validateAnnotationValue(this$static, map.getNewValue(i), v);
    if (r != VALID) {
      return r;
    }
    if (i > 0 && compareTo_5(map.getChangeKey_0(i - 1), key) >= 0) {
      return $annotationKeysNotStrictlyMonotonic(this$static, v, map.getChangeKey_0(i - 1), key);
    }
    if (endKeys.map.containsKey(key)) {
      return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('annotation boundary contains duplicate key ' + key, this$static.effectivePos, this$static.resultingPos));
    }
  }
  return $clinit_1267() , VALID;
}

function $checkAnnotationsForDeletion(this$static, v, itemCount){
  var annotationsHere, firstChange, i, key, key$iterator, newValue, offset, oldValue, pos, requiredValue, valueInDoc;
  if (!this$static.targetAnnotationsForDeletion) {
    return $clinit_1267() , VALID;
  }
  for (i = 0; i < this$static.annotationsUpdate.updates.size_0(); ++i) {
    key = dynamicCast(this$static.annotationsUpdate.updates.get_0(i), 220).name_0;
    oldValue = dynamicCast(this$static.annotationsUpdate.updates.get_0(i), 220).oldValue;
    firstChange = this$static.doc.firstAnnotationChange_0(this$static.effectivePos, this$static.effectivePos + itemCount, key, oldValue);
    if (firstChange != -1) {
      return $oldAnnotationsDifferFromDocument(this$static, v, key, oldValue, this$static.doc.getAnnotation_0(firstChange, key));
    }
    newValue = dynamicCast(this$static.annotationsUpdate.updates.get_0(i), 220).newValue;
    if (!equal(newValue, this$static.targetAnnotationsForDeletion.get(key))) {
      return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('new annotation value incorrect for deletion', this$static.effectivePos, this$static.resultingPos));
    }
  }
  for (offset = 0; offset < itemCount; ++offset) {
    pos = this$static.effectivePos + offset;
    annotationsHere = this$static.doc.annotationsAt(pos);
    for (key$iterator = annotationsHere.keySet_0().iterator_0(); key$iterator.hasNext();) {
      key = dynamicCast(key$iterator.next_0(), 1);
      valueInDoc = dynamicCast(annotationsHere.get(key), 1);
      requiredValue = dynamicCast(this$static.targetAnnotationsForDeletion.get(key), 1);
      if (!(valueInDoc == null?requiredValue == null:$equals_3(valueInDoc, requiredValue))) {
        if (!$containsKey_3(this$static.annotationsUpdate, key)) {
          return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('deletion does not reset value for key ' + key + ' from ' + valueInDoc + ' to ' + requiredValue, this$static.effectivePos, this$static.resultingPos));
        }
      }
    }
    for (key$iterator = this$static.targetAnnotationsForDeletion.keySet_0().iterator_0(); key$iterator.hasNext();) {
      key = dynamicCast(key$iterator.next_0(), 1);
      valueInDoc = dynamicCast(annotationsHere.get(key), 1);
      requiredValue = dynamicCast(this$static.targetAnnotationsForDeletion.get(key), 1);
      if (!(valueInDoc == null?requiredValue == null:$equals_3(valueInDoc, requiredValue))) {
        if (!$containsKey_3(this$static.annotationsUpdate, key)) {
          return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('deletion does not reset value for key ' + key + ' from ' + valueInDoc + ' to ' + requiredValue, this$static.effectivePos, this$static.resultingPos));
        }
      }
    }
  }
  return $clinit_1267() , VALID;
}

function $checkAnnotationsForInsertion(this$static, v){
  var defaultFromDocument, i, key, oldValue, posToInheritFrom;
  if (this$static.effectivePos > this$static.doc.length_1()) {
    return $clinit_1267() , VALID;
  }
  posToInheritFrom = this$static.effectivePos - 1;
  for (i = 0; i < this$static.annotationsUpdate.updates.size_0(); ++i) {
    key = dynamicCast(this$static.annotationsUpdate.updates.get_0(i), 220).name_0;
    oldValue = dynamicCast(this$static.annotationsUpdate.updates.get_0(i), 220).oldValue;
    defaultFromDocument = posToInheritFrom == -1?null:this$static.doc.getAnnotation_0(posToInheritFrom, key);
    if (!(oldValue == null?defaultFromDocument == null:$equals_3(oldValue, defaultFromDocument))) {
      return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('old annotations differ from document: purported old value for key ' + key + ' is ' + oldValue + ', actual value in document is ' + defaultFromDocument, this$static.effectivePos, this$static.resultingPos));
    }
  }
  return $clinit_1267() , VALID;
}

function $checkAnnotationsForRetain(this$static, v, itemCount){
  var firstChange, i, key, oldValue;
  for (i = 0; i < this$static.annotationsUpdate.updates.size_0(); ++i) {
    key = dynamicCast(this$static.annotationsUpdate.updates.get_0(i), 220).name_0;
    oldValue = dynamicCast(this$static.annotationsUpdate.updates.get_0(i), 220).oldValue;
    firstChange = this$static.doc.firstAnnotationChange_0(this$static.effectivePos, this$static.effectivePos + itemCount, key, oldValue);
    if (firstChange != -1) {
      return $oldAnnotationsDifferFromDocument(this$static, v, key, oldValue, this$static.doc.getAnnotation_0(firstChange, key));
    }
  }
  return $clinit_1267() , VALID;
}

function $checkAttributesUpdateWellFormed(this$static, u, v){
  var i, key, previousKey;
  if (!u) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attributes update is null', this$static.effectivePos, this$static.resultingPos));
  }
  previousKey = null;
  for (i = 0; i < u.updates.size_0(); ++i) {
    key = dynamicCast(u.updates.get_0(i), 220).name_0;
    if (key == null) {
      return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute key is null', this$static.effectivePos, this$static.resultingPos));
    }
    if (!isXmlName_0(key)) {
      return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute name is not an XML Name: "' + key + '"', this$static.effectivePos, this$static.resultingPos));
    }
    if (previousKey != null && compareTo_5(previousKey, key) >= 0) {
      return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute keys not strictly monotonic: ' + previousKey + ' >= ' + key, this$static.effectivePos, this$static.resultingPos));
    }
    if (dynamicCast(u.updates.get_0(i), 220).oldValue != null && ($clinit_1490() , !traverseUtf16String(dynamicCast(u.updates.get_0(i), 220).oldValue, VALID_UTF16).value_0)) {
      return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute value is not valid UTF-16', this$static.effectivePos, this$static.resultingPos));
    }
    if (dynamicCast(u.updates.get_0(i), 220).newValue != null && ($clinit_1490() , !traverseUtf16String(dynamicCast(u.updates.get_0(i), 220).newValue, VALID_UTF16).value_0)) {
      return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute value is not valid UTF-16', this$static.effectivePos, this$static.resultingPos));
    }
    previousKey = key;
  }
  return $clinit_1267() , VALID;
}

function $checkAttributesWellFormed(this$static, attr, v){
  var e, e$iterator, previousKey;
  if (!attr) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attributes is null', this$static.effectivePos, this$static.resultingPos));
  }
  previousKey = null;
  for (e$iterator = new ImmutableStateMap$1$1_0(attr.entrySet); e$iterator.iterator.hasNext();) {
    e = dynamicCast(e$iterator.iterator.next_0(), 221);
    if (e.name_0 == null) {
      return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute key is null', this$static.effectivePos, this$static.resultingPos));
    }
    if (!isXmlName_0(e.name_0)) {
      return $attributeNameNotXmlName(this$static, v, e.name_0);
    }
    if (e.value_0 == null) {
      return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute value is null', this$static.effectivePos, this$static.resultingPos));
    }
    $clinit_1490();
    if (!traverseUtf16String(e.value_0, VALID_UTF16).value_0) {
      return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute value is not valid UTF-16', this$static.effectivePos, this$static.resultingPos));
    }
    if (previousKey != null && compareTo_5(previousKey, e.name_0) >= 0) {
      return $attributeKeysNotStrictlyMonotonic(this$static, v, previousKey, e.name_0);
    }
    previousKey = e.name_0;
  }
  return $clinit_1267() , VALID;
}

--></script>
<script><!--
function $checkCharacters_0(this$static, chars, v){
  var enclosingTag, r;
  if (chars == null) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('characters is null', this$static.effectivePos, this$static.resultingPos));
  }
  if (!chars.length) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('characters is empty', this$static.effectivePos, this$static.resultingPos));
  }
  if (firstSurrogate(chars) != -1) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('characters component contains surrogate', this$static.effectivePos, this$static.resultingPos));
  }
  $clinit_1490();
  if (!traverseUtf16String(chars, VALID_UTF16).value_0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('characters component contains invalid unicode', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.deletionStackDepth != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('insertion inside deletion', this$static.effectivePos, this$static.resultingPos));
  }
  r = $checkAnnotationsForInsertion(this$static, v);
  if (r != ($clinit_1267() , VALID)) {
    return r;
  }
  if (this$static.nextRequiredElement != null) {
    return $childElementRequired(this$static, v, this$static.nextRequiredElement);
  }
  r = $checkForInsertionBeforeRequiredChild(this$static, v);
  if (r != VALID) {
    return r;
  }
  enclosingTag = $effectiveEnclosingElementTag_0(this$static);
  switch (this$static.constraints.permittedCharacters(enclosingTag).ordinal) {
    case 0:
      return $addViolation_4(v, new DocOpAutomaton$SchemaViolation_0('element type ' + enclosingTag + ' does not allow text content', this$static.effectivePos, this$static.resultingPos));
    case 1:
      {
        if (!traverseUtf16String(chars, GOOD_UTF16_FOR_BLIP).value_0) {
          return $addViolation_4(v, new DocOpAutomaton$SchemaViolation_0('element type ' + enclosingTag + ' only allows blip text content, not arbitrary characters', this$static.effectivePos, this$static.resultingPos));
        }
      }

      break;
    case 2:
      break;
    default:throw new AssertionError_0('unexpected return value from permittedCharacters()');
  }
  return VALID;
}

function $checkDeleteCharacters_0(this$static, chars, v){
  var charHere, charHereIfAny, docLength, offset, attempted, attempted_0;
  if (chars == null) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('characters is null', this$static.effectivePos, this$static.resultingPos));
  }
  if (!chars.length) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('characters is empty', this$static.effectivePos, this$static.resultingPos));
  }
  if (firstSurrogate(chars) != -1) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('delete characters component contains surrogate', this$static.effectivePos, this$static.resultingPos));
  }
  $clinit_1490();
  if (!traverseUtf16String(chars, VALID_UTF16).value_0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('delete characters component contains invalid unicode', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.insertionStack.size != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('deletion inside insertion', this$static.effectivePos, this$static.resultingPos));
  }
  docLength = this$static.doc.length_1();
  for (offset = 0; offset < chars.length; ++offset) {
    if (this$static.effectivePos + offset >= docLength) {
      return attempted = chars.length , $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('cannot delete ' + attempted + ' characters, only ' + offset + ' available', this$static.effectivePos, this$static.resultingPos));
    }
    charHereIfAny = this$static.doc.charAt_0(this$static.effectivePos + offset);
    if (charHereIfAny == -1) {
      return attempted_0 = chars.length , $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('cannot delete ' + attempted_0 + ' characters, only ' + offset + ' available', this$static.effectivePos, this$static.resultingPos));
    }
    charHere = charHereIfAny & 65535;
    if (charHere != chars.charCodeAt(offset)) {
      return $oldCharacterDiffersFromDocument(this$static, v, charHere, chars.charCodeAt(offset));
    }
  }
  return $checkAnnotationsForDeletion(this$static, v, chars.length);
}

function $checkDeleteElementEnd_0(this$static, v){
  var r;
  if (this$static.insertionStack.size != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('deletion inside insertion', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.deletionStackDepth == 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('deleteElementEnd with no matching deleteElementStart', this$static.effectivePos, this$static.resultingPos));
  }
  if ($effectiveDocSymbol_0(this$static) != ($clinit_1261() , CLOSE_0)) {
    return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('no element end to delete here', this$static.effectivePos, this$static.resultingPos));
  }
  r = $checkAnnotationsForDeletion(this$static, v, 1);
  if (r != ($clinit_1267() , VALID)) {
    return r;
  }
  return VALID;
}

function $checkDeleteElementStart_0(this$static, type, attr, v){
  var isFirstChild, parentType, r, requiredFirstChild;
  if (type == null) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('element type is null', this$static.effectivePos, this$static.resultingPos));
  }
  if (!isXmlName_0(type)) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('element type is not an XML Name: "' + type + '"', this$static.effectivePos, this$static.resultingPos));
  }
  r = $checkAttributesWellFormed(this$static, attr, v);
  if (r != ($clinit_1267() , VALID)) {
    return r;
  }
  if (this$static.insertionStack.size != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('deletion inside insertion', this$static.effectivePos, this$static.resultingPos));
  }
  if ($effectiveDocSymbol_0(this$static) != ($clinit_1261() , OPEN_0)) {
    return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('no element start to delete here', this$static.effectivePos, this$static.resultingPos));
  }
  if (!$equals_3($effectiveDocSymbolTag_0(this$static), type)) {
    return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('old element type differs from document', this$static.effectivePos, this$static.resultingPos));
  }
  if (!$attributesEqual(attr, $effectiveDocSymbolAttributes(this$static))) {
    return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('old attributes differ from document', this$static.effectivePos, this$static.resultingPos));
  }
  r = $checkAnnotationsForDeletion(this$static, v, 1);
  if (r != VALID) {
    return r;
  }
  if (this$static.deletionStackDepth == 0) {
    if (this$static.effectivePos < this$static.doc.length_1()) {
      parentType = this$static.doc.nthEnclosingElementTag(this$static.effectivePos, 0);
      requiredFirstChild = $requiredFirstChild(this$static, parentType);
      isFirstChild = this$static.effectivePos == 0 || this$static.doc.elementStartingAt(this$static.effectivePos - 1) != null;
      if (isFirstChild && requiredFirstChild != null) {
        return $addViolation_4(v, new DocOpAutomaton$SchemaViolation_0('attempt to delete required child', this$static.effectivePos, this$static.resultingPos));
      }
    }
  }
  return VALID;
}

function $checkElementEnd_0(this$static, v){
  var r;
  if (this$static.deletionStackDepth != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('insertion inside deletion', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.insertionStack.size == 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('elementEnd with no matching elementStart', this$static.effectivePos, this$static.resultingPos));
  }
  r = $checkAnnotationsForInsertion(this$static, v);
  if (r != ($clinit_1267() , VALID)) {
    return r;
  }
  if (this$static.nextRequiredElement != null) {
    return $childElementRequired(this$static, v, this$static.nextRequiredElement);
  }
  return VALID;
}

function $checkElementStart_0(this$static, type, attr, v){
  var parentTag, r;
  if (type == null) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('element type is null', this$static.effectivePos, this$static.resultingPos));
  }
  if (!isXmlName_0(type)) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('element type is not an XML Name: "' + type + '"', this$static.effectivePos, this$static.resultingPos));
  }
  r = $checkAttributesWellFormed(this$static, attr, v);
  if (r != ($clinit_1267() , VALID)) {
    return r;
  }
  if (this$static.deletionStackDepth != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('insertion inside deletion', this$static.effectivePos, this$static.resultingPos));
  }
  r = $checkAnnotationsForInsertion(this$static, v);
  if (r != VALID) {
    return r;
  }
  r = $validateAttributes_0(this$static, type, attr, v);
  if (r != VALID) {
    return r;
  }
  parentTag = $effectiveEnclosingElementTag_0(this$static);
  if (!this$static.constraints.permitsChild(parentTag, type)) {
    return parentTag == null?$addViolation_4(v, new DocOpAutomaton$SchemaViolation_0('element type ' + type + ' not permitted at top level', this$static.effectivePos, this$static.resultingPos)):$addViolation_4(v, new DocOpAutomaton$SchemaViolation_0('element type ' + parentTag + ' does not permit subelement type ' + type, this$static.effectivePos, this$static.resultingPos));
  }
  r = $checkForInsertionBeforeRequiredChild(this$static, v);
  if (r != VALID) {
    return r;
  }
  if (this$static.nextRequiredElement != null && !$equals_3(this$static.nextRequiredElement, type)) {
    return $differentElementTypeRequired(this$static, v, this$static.nextRequiredElement, type);
  }
  return VALID;
}

function $checkFinish_0(this$static, v){
  var e$iterator;
  if (this$static.insertionStack.size != 0) {
    for (e$iterator = new AbstractList$IteratorImpl_0(this$static.insertionStack); e$iterator.i < e$iterator.this$0_0.size_0();) {
      dynamicCast($next_6(e$iterator), 238);
      return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('elementStart with no matching elementEnd', this$static.effectivePos, this$static.resultingPos));
    }
  }
  if (this$static.deletionStackDepth != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('deleteElementStart with no matching deleteElementEnd', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.annotationsUpdate.updates.size_0() > 0) {
    return $mismatchedStartAnnotation(this$static, v, dynamicCast(this$static.annotationsUpdate.updates.get_0(0), 220).name_0);
  }
  if (this$static.effectivePos != this$static.doc.length_1()) {
    return $missingRetainToEnd(this$static, v, this$static.doc.length_1(), this$static.effectivePos);
  }
  return $clinit_1267() , VALID;
}

function $checkForInsertionBeforeRequiredChild(this$static, v){
  var isFirstChild, parentType, requiredFirstChild;
  if (this$static.effectivePos < this$static.doc.length_1() && this$static.insertionStack.size == 0) {
    parentType = this$static.doc.nthEnclosingElementTag(this$static.effectivePos, 0);
    requiredFirstChild = $requiredFirstChild(this$static, parentType);
    isFirstChild = this$static.effectivePos == 0 || this$static.doc.elementStartingAt(this$static.effectivePos - 1) != null;
    if (isFirstChild && requiredFirstChild != null) {
      return $addViolation_4(v, new DocOpAutomaton$SchemaViolation_0('attempt to insert before required child', this$static.effectivePos, this$static.resultingPos));
    }
  }
  return $clinit_1267() , VALID;
}

function $checkReplaceAttributes(this$static, oldAttrs, newAttrs, v){
  var actualOldAttrs, r, type;
  r = $checkAttributesWellFormed(this$static, oldAttrs, v);
  if (r != ($clinit_1267() , VALID)) {
    return r;
  }
  r = $checkAttributesWellFormed(this$static, newAttrs, v);
  if (r != VALID) {
    return r;
  }
  if (this$static.deletionStackDepth != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute change inside insert or delete', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.insertionStack.size != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute change inside insert or delete', this$static.effectivePos, this$static.resultingPos));
  }
  if ($effectiveDocSymbol_0(this$static) != ($clinit_1261() , OPEN_0)) {
    return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('no element start to change attributes here', this$static.effectivePos, this$static.resultingPos));
  }
  type = $effectiveDocSymbolTag_0(this$static);
  actualOldAttrs = $effectiveDocSymbolAttributes(this$static);
  if (!$attributesEqual(actualOldAttrs, oldAttrs)) {
    return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('old attributes differ from document', this$static.effectivePos, this$static.resultingPos));
  }
  r = $checkAnnotationsForRetain(this$static, v, 1);
  if (r != VALID) {
    return r;
  }
  r = $validateAttributes_0(this$static, type, newAttrs, v);
  if (r != VALID) {
    return r;
  }
  return VALID;
}

function $checkRetain_0(this$static, itemCount, v){
  if (itemCount <= 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('retain item count not positive', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.insertionStack.size != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('retain inside insert or delete', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.deletionStackDepth != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('retain inside insert or delete', this$static.effectivePos, this$static.resultingPos));
  }
  if (itemCount > (this$static.effectivePos >= this$static.doc.length_1()?0:this$static.doc.length_1() - this$static.effectivePos)) {
    return $retainPastEnd(this$static, v, this$static.doc.length_1(), itemCount);
  }
  return $checkAnnotationsForRetain(this$static, v, itemCount);
}

function $checkUpdateAttributes(this$static, u, v){
  var i, key, oldAttrs, oldValue, r, type, value, entry;
  r = $checkAttributesUpdateWellFormed(this$static, u, v);
  if (r != ($clinit_1267() , VALID)) {
    return r;
  }
  if (this$static.deletionStackDepth != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute change inside insert or delete', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.insertionStack.size != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute change inside insert or delete', this$static.effectivePos, this$static.resultingPos));
  }
  if ($effectiveDocSymbol_0(this$static) != ($clinit_1261() , OPEN_0)) {
    return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('no element start to change attributes here', this$static.effectivePos, this$static.resultingPos));
  }
  type = $effectiveDocSymbolTag_0(this$static);
  oldAttrs = $effectiveDocSymbolAttributes(this$static);
  for (i = 0; i < u.updates.size_0(); ++i) {
    key = dynamicCast(u.updates.get_0(i), 220).name_0;
    oldValue = dynamicCast(u.updates.get_0(i), 220).oldValue;
    if (!equal(oldValue, (entry = $implFindEntry(oldAttrs, key, false) , !entry?null:entry.getValue()))) {
      return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('old attributes differ from document', this$static.effectivePos, this$static.resultingPos));
    }
  }
  r = $checkAnnotationsForRetain(this$static, v, 1);
  if (r != VALID) {
    return r;
  }
  for (i = 0; i < u.updates.size_0(); ++i) {
    key = dynamicCast(u.updates.get_0(i), 220).name_0;
    value = dynamicCast(u.updates.get_0(i), 220).newValue;
    if (value != null) {
      if (!this$static.constraints.permitsAttribute_0(type, key, value)) {
        return $addViolation_4(v, new DocOpAutomaton$SchemaViolation_0('type ' + type + ' does not permit attribute ' + key + ' with value ' + value, this$static.effectivePos, this$static.resultingPos));
      }
    }
  }
  return VALID;
}

function $childElementRequired(this$static, v, expectedType){
  return $addViolation_4(v, new DocOpAutomaton$SchemaViolation_0('child element required, expected type ' + expectedType, this$static.effectivePos, this$static.resultingPos));
}

function $differentElementTypeRequired(this$static, v, expectedType, actualType){
  return $addViolation_4(v, new DocOpAutomaton$SchemaViolation_0('element of type ' + expectedType + ' required, not ' + actualType, this$static.effectivePos, this$static.resultingPos));
}

function $doAnnotationBoundary(this$static, map){
  this$static.annotationsUpdate = $composeWith_0(this$static.annotationsUpdate, map);
  this$static.afterAnnotationBoundary = true;
}

function $doCharacters_1(this$static, characters){
  this$static.effectivePos > this$static.doc.length_1()?(this$static.targetAnnotationsForDeletion = null):(this$static.targetAnnotationsForDeletion = $inheritedAnnotations(this$static).updateWithNoCompatibilityCheck(this$static.annotationsUpdate));
  this$static.resultingPos += characters.length;
  this$static.afterAnnotationBoundary = false;
}

function $doDeleteCharacters_2(this$static, chars){
  this$static.effectivePos += chars.length;
  this$static.afterAnnotationBoundary = false;
}

function $doDeleteElementEnd_1(this$static){
  --this$static.deletionStackDepth;
  this$static.effectivePos += 1;
  this$static.afterAnnotationBoundary = false;
}

function $doDeleteElementStart_1(this$static){
  ++this$static.deletionStackDepth;
  this$static.effectivePos += 1;
  this$static.afterAnnotationBoundary = false;
}

function $doElementEnd_1(this$static){
  this$static.effectivePos > this$static.doc.length_1()?(this$static.targetAnnotationsForDeletion = null):(this$static.targetAnnotationsForDeletion = $inheritedAnnotations(this$static).updateWithNoCompatibilityCheck(this$static.annotationsUpdate));
  $remove_10(this$static.insertionStack, this$static.insertionStack.size - 1);
  this$static.resultingPos += 1;
  this$static.afterAnnotationBoundary = false;
}

function $doElementStart_1(this$static, type){
  this$static.effectivePos > this$static.doc.length_1()?(this$static.targetAnnotationsForDeletion = null):(this$static.targetAnnotationsForDeletion = $inheritedAnnotations(this$static).updateWithNoCompatibilityCheck(this$static.annotationsUpdate));
  $add_9(this$static.insertionStack, new DocOpAutomaton$InsertStart_0(type));
  this$static.nextRequiredElement = $requiredFirstChild(this$static, type);
  this$static.resultingPos += 1;
  this$static.afterAnnotationBoundary = false;
}

function $doReplaceAttributes(this$static){
  this$static.effectivePos += 1;
  this$static.effectivePos > this$static.doc.length_1()?(this$static.targetAnnotationsForDeletion = null):(this$static.targetAnnotationsForDeletion = $inheritedAnnotations(this$static).updateWithNoCompatibilityCheck(this$static.annotationsUpdate));
  this$static.resultingPos += 1;
  this$static.afterAnnotationBoundary = false;
}

function $doRetain(this$static, itemCount){
  this$static.effectivePos += itemCount;
  this$static.effectivePos > this$static.doc.length_1()?(this$static.targetAnnotationsForDeletion = null):(this$static.targetAnnotationsForDeletion = $inheritedAnnotations(this$static).updateWithNoCompatibilityCheck(this$static.annotationsUpdate));
  this$static.resultingPos += itemCount;
  this$static.afterAnnotationBoundary = false;
}

function $doUpdateAttributes_0(this$static){
  this$static.effectivePos += 1;
  this$static.effectivePos > this$static.doc.length_1()?(this$static.targetAnnotationsForDeletion = null):(this$static.targetAnnotationsForDeletion = $inheritedAnnotations(this$static).updateWithNoCompatibilityCheck(this$static.annotationsUpdate));
  this$static.resultingPos += 1;
  this$static.afterAnnotationBoundary = false;
}

function $effectiveDocSymbol_0(this$static){
  var s;
  if (this$static.effectivePos >= this$static.doc.length_1()) {
    return $clinit_1261() , END_1;
  }
  s = (checkPositionIndex(this$static.effectivePos, this$static.doc.length_1()) , this$static.doc.elementStartingAt(this$static.effectivePos));
  if (s != null) {
    return $clinit_1261() , OPEN_0;
  }
  s = (checkPositionIndex(this$static.effectivePos, this$static.doc.length_1()) , this$static.doc.elementEndingAt(this$static.effectivePos));
  if (s != null) {
    return $clinit_1261() , CLOSE_0;
  }
  return $clinit_1261() , CHARACTER_2;
}

function $effectiveDocSymbolAttributes(this$static){
  var attributes;
  switch ($effectiveDocSymbol_0(this$static).ordinal) {
    case 1:
      {
        attributes = this$static.doc.attributesAt(this$static.effectivePos);
        return attributes;
      }

    default:throw new IllegalStateException_1('not at element start');
  }
}

function $effectiveDocSymbolTag_0(this$static){
  var tag;
  switch ($effectiveDocSymbol_0(this$static).ordinal) {
    case 1:
      {
        tag = (checkPositionIndex(this$static.effectivePos, this$static.doc.length_1()) , this$static.doc.elementStartingAt(this$static.effectivePos));
        return tag;
      }

    case 2:
      {
        tag = (checkPositionIndex(this$static.effectivePos, this$static.doc.length_1()) , this$static.doc.elementEndingAt(this$static.effectivePos));
        return tag;
      }

    default:throw new IllegalStateException_1('not at element start or end');
  }
}

function $effectiveEnclosingElementTag_0(this$static){
  var e, i;
  for (i = this$static.insertionStack.size - 1; i >= 0;) {
    e = dynamicCast($get_3(this$static.insertionStack, i), 238);
    return e.tag;
  }
  if (this$static.effectivePos > this$static.doc.length_1()) {
    return null;
  }
  return this$static.doc.nthEnclosingElementTag(this$static.effectivePos, 0);
}

function $inheritedAnnotations(this$static){
  var posToInheritFrom;
  if (this$static.effectivePos == 0 || this$static.effectivePos > this$static.doc.length_1()) {
    return EMPTY_ANNOTATIONS;
  }
   else {
    posToInheritFrom = this$static.effectivePos - 1;
    return this$static.doc.annotationsAt(posToInheritFrom);
  }
}

function $mismatchedStartAnnotation(this$static, v, key){
  return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('annotation of key ' + key + ' starts but never ends', this$static.effectivePos, this$static.resultingPos));
}

function $missingRetainToEnd(this$static, v, expectedLength, actualLength){
  return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('operation shorter than document, document length ' + expectedLength + ', length of input of operation ' + actualLength, this$static.effectivePos, this$static.resultingPos));
}

function $oldAnnotationsDifferFromDocument(this$static, v, key, oldValue, valueInDoc){
  return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('old annotations differ from document: purported old value for key ' + key + ' is ' + oldValue + ', actual value in document is ' + valueInDoc, this$static.effectivePos, this$static.resultingPos));
}

function $oldCharacterDiffersFromDocument(this$static, v, expected, actual){
  return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('attempt to delete character ' + String.fromCharCode(actual) + ' when the actual character is ' + String.fromCharCode(expected), this$static.effectivePos, this$static.resultingPos));
}

function $requiredFirstChild(this$static, parentType){
  var list;
  list = this$static.constraints.getRequiredInitialChildren(parentType);
  if (list.isEmpty()) {
    return null;
  }
   else if (list.size_0() > 1) {
    throw new UnsupportedOperationException_1('Schema requires multiple initial children');
  }
   else {
    return dynamicCast(list.get_0(0), 1);
  }
}

function $retainPastEnd(this$static, v, expectedLength, retainItemCount){
  return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('retain past end of document, document length ' + expectedLength + ', retain item count ' + retainItemCount, this$static.effectivePos, this$static.resultingPos));
}

function $validateAnnotationKey_0(this$static, key, v){
  if (key == null) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('annotation key is null', this$static.effectivePos, this$static.resultingPos));
  }
  if (key.indexOf('?') != -1 || key.indexOf('@') != -1) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('invalid character in annotation key: ' + key, this$static.effectivePos, this$static.resultingPos));
  }
  $clinit_1490();
  if (!traverseUtf16String(key, VALID_UTF16).value_0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('annotation key is not valid UTF-16', this$static.effectivePos, this$static.resultingPos));
  }
  return $clinit_1267() , VALID;
}

function $validateAnnotationValue(this$static, value, v){
  if (value == null) {
    return $clinit_1267() , VALID;
  }
  $clinit_1490();
  if (!traverseUtf16String(value, VALID_UTF16).value_0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('annotation value is not valid UTF-16', this$static.effectivePos, this$static.resultingPos));
  }
  return $clinit_1267() , VALID;
}

function $validateAttributes_0(this$static, tag, attr, v){
  var e, e$iterator, key, value;
  for (e$iterator = new ImmutableStateMap$1$1_0(attr.entrySet); e$iterator.iterator.hasNext();) {
    e = dynamicCast(e$iterator.iterator.next_0(), 221);
    key = e.name_0;
    value = e.value_0;
    if (!this$static.constraints.permitsAttribute_0(tag, key, value)) {
      return $addViolation_4(v, new DocOpAutomaton$SchemaViolation_0('type ' + tag + ' does not permit attribute ' + key + ' with value ' + value, this$static.effectivePos, this$static.resultingPos));
    }
  }
  return $clinit_1267() , VALID;
}

function DocOpAutomaton_0(doc, constraints){
  $clinit_1259();
  this.annotationsUpdate = new AnnotationsUpdateImpl_0;
  this.targetAnnotationsForDeletion = EMPTY_ANNOTATIONS;
  this.doc = doc;
  this.constraints = constraints;
  this.nextRequiredElement = $requiredFirstChild(this, null);
  this.insertionStack = new ArrayList_0;
}

function equal(a_0, b){
  return a_0 == null?b == null:$equals_3(a_0, b);
}

function DocOpAutomaton(){
}

_ = DocOpAutomaton_0.prototype = DocOpAutomaton.prototype = new Object_0;
_.getClass$ = function getClass_839(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton_2_classLit;
}
;
_.castableTypeMap$ = {};
_.afterAnnotationBoundary = false;
_.constraints = null;
_.deletionStackDepth = 0;
_.doc = null;
_.effectivePos = 0;
_.insertionStack = null;
_.nextRequiredElement = null;
_.resultingPos = 0;
var EMPTY_ANNOTATIONS, EMPTY_DOCUMENT;
function DocOpAutomaton$1_0(){
}

function DocOpAutomaton$1(){
}

_ = DocOpAutomaton$1_0.prototype = DocOpAutomaton$1.prototype = new Object_0;
_.annotationsAt = function annotationsAt_0(pos){
  return $clinit_1283() , EMPTY_MAP_1;
}
;
_.attributesAt = function attributesAt_0(pos){
  return null;
}
;
_.charAt_0 = function charAt_0(pos){
  return -1;
}
;
_.elementEndingAt = function elementEndingAt_0(pos){
  return null;
}
;
_.elementStartingAt = function elementStartingAt_0(pos){
  return null;
}
;
_.firstAnnotationChange_0 = function firstAnnotationChange_5(start, end, key, fromValue){
  checkPositionIndexesInRange(start, end, 0);
  return -1;
}
;
_.getAnnotation_0 = function getAnnotation_5(pos, key){
  return null;
}
;
_.getClass$ = function getClass_840(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$1_2_classLit;
}
;
_.length_1 = function length_2(){
  return 0;
}
;
_.nthEnclosingElementTag = function nthEnclosingElementTag_0(insertionPoint, depth){
  return null;
}
;
_.castableTypeMap$ = {};
function $clinit_1261(){
  $clinit_1261 = nullMethod;
  CHARACTER_2 = new DocOpAutomaton$DocSymbol_0('CHARACTER', 0);
  OPEN_0 = new DocOpAutomaton$DocSymbol_0('OPEN', 1);
  CLOSE_0 = new DocOpAutomaton$DocSymbol_0('CLOSE', 2);
  END_1 = new DocOpAutomaton$DocSymbol_0('END', 3);
  $VALUES_48 = initValues(_3Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$DocSymbol_2_classLit, {58:1, 138:1}, 113, [CHARACTER_2, OPEN_0, CLOSE_0, END_1]);
}

function DocOpAutomaton$DocSymbol_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_49(){
  $clinit_1261();
  return $VALUES_48;
}

function DocOpAutomaton$DocSymbol(){
}

_ = DocOpAutomaton$DocSymbol_0.prototype = DocOpAutomaton$DocSymbol.prototype = new Enum;
_.getClass$ = function getClass_841(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$DocSymbol_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 113:1};
var $VALUES_48, CHARACTER_2, CLOSE_0, END_1, OPEN_0;
function DocOpAutomaton$InsertStart_0(tag){
  this.tag = tag;
}

function DocOpAutomaton$InsertStart(){
}

_ = DocOpAutomaton$InsertStart_0.prototype = DocOpAutomaton$InsertStart.prototype = new Object_0;
_.getClass$ = function getClass_842(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$InsertStart_2_classLit;
}
;
_.castableTypeMap$ = {238:1};
_.tag = null;
function DocOpAutomaton$Violation(){
}

_ = DocOpAutomaton$Violation.prototype = new Object_0;
_.getClass$ = function getClass_843(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$Violation_2_classLit;
}
;
_.castableTypeMap$ = {};
_.description = null;
_.originalDocumentPos = 0;
_.resultingDocumentPos = 0;
--></script>
<script><!--
function DocOpAutomaton$OperationIllFormed_0(description, originalPos, resultingPos){
  this.description = description;
  this.originalDocumentPos = originalPos;
  this.resultingDocumentPos = resultingPos;
}

function DocOpAutomaton$OperationIllFormed(){
}

_ = DocOpAutomaton$OperationIllFormed_0.prototype = DocOpAutomaton$OperationIllFormed.prototype = new DocOpAutomaton$Violation;
_.getClass$ = function getClass_844(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$OperationIllFormed_2_classLit;
}
;
_.castableTypeMap$ = {239:1};
function DocOpAutomaton$OperationInvalid_0(description, originalPos, resultingPos){
  this.description = description;
  this.originalDocumentPos = originalPos;
  this.resultingDocumentPos = resultingPos;
}

function DocOpAutomaton$OperationInvalid(){
}

_ = DocOpAutomaton$OperationInvalid_0.prototype = DocOpAutomaton$OperationInvalid.prototype = new DocOpAutomaton$Violation;
_.getClass$ = function getClass_845(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$OperationInvalid_2_classLit;
}
;
_.castableTypeMap$ = {240:1};
function DocOpAutomaton$SchemaViolation_0(description, originalPos, resultingPos){
  this.description = description;
  this.originalDocumentPos = originalPos;
  this.resultingDocumentPos = resultingPos;
}

function DocOpAutomaton$SchemaViolation(){
}

_ = DocOpAutomaton$SchemaViolation_0.prototype = DocOpAutomaton$SchemaViolation.prototype = new DocOpAutomaton$Violation;
_.getClass$ = function getClass_846(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$SchemaViolation_2_classLit;
}
;
_.castableTypeMap$ = {241:1};
function $clinit_1267(){
  $clinit_1267 = nullMethod;
  ILL_FORMED = new DocOpAutomaton$ValidationResult_0('ILL_FORMED', 0);
  INVALID_DOCUMENT = new DocOpAutomaton$ValidationResult_0('INVALID_DOCUMENT', 1);
  INVALID_SCHEMA = new DocOpAutomaton$ValidationResult_0('INVALID_SCHEMA', 2);
  VALID = new DocOpAutomaton$ValidationResult_0('VALID', 3);
  $VALUES_49 = initValues(_3Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$ValidationResult_2_classLit, {58:1, 138:1}, 114, [ILL_FORMED, INVALID_DOCUMENT, INVALID_SCHEMA, VALID]);
}

function $mergeWith(this$static, other){
  checkNotNull_1(other, 'Null ValidationResult');
  return $VALUES_49[min_0(this$static.ordinal, other.ordinal)];
}

function DocOpAutomaton$ValidationResult_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_50(){
  $clinit_1267();
  return $VALUES_49;
}

function DocOpAutomaton$ValidationResult(){
}

_ = DocOpAutomaton$ValidationResult_0.prototype = DocOpAutomaton$ValidationResult.prototype = new Enum;
_.getClass$ = function getClass_847(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$ValidationResult_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 114:1};
var $VALUES_49, ILL_FORMED, INVALID_DOCUMENT, INVALID_SCHEMA, VALID;
function $firstDescription(this$static){
  var v, v$iterator;
  for (v$iterator = new AbstractList$IteratorImpl_0(this$static.operationIllFormed); v$iterator.i < v$iterator.this$0_0.size_0();) {
    v = dynamicCast($next_6(v$iterator), 239);
    return 'ill-formed: ' + v.description + ' at original document position ' + v.originalDocumentPos + ' / resulting document position ' + v.resultingDocumentPos;
  }
  for (v$iterator = new AbstractList$IteratorImpl_0(this$static.operationInvalid); v$iterator.i < v$iterator.this$0_0.size_0();) {
    v = dynamicCast($next_6(v$iterator), 240);
    return 'invalid operation: ' + v.description + ' at original document position ' + v.originalDocumentPos + ' / resulting document position ' + v.resultingDocumentPos;
  }
  for (v$iterator = new AbstractList$IteratorImpl_0(this$static.schemaViolations); v$iterator.i < v$iterator.this$0_0.size_0();) {
    v = dynamicCast($next_6(v$iterator), 241);
    return 'schema violation: ' + v.description + ' at original document position ' + v.originalDocumentPos + ' / resulting document position ' + v.resultingDocumentPos;
  }
  return null;
}

function $getValidationResult(this$static){
  return this$static.operationIllFormed.size == 0?this$static.operationInvalid.size == 0?this$static.schemaViolations.size == 0?($clinit_1267() , VALID):($clinit_1267() , INVALID_SCHEMA):($clinit_1267() , INVALID_DOCUMENT):($clinit_1267() , ILL_FORMED);
}

function DocOpAutomaton$ViolationCollector_0(){
  this.operationIllFormed = new ArrayList_0;
  this.operationInvalid = new ArrayList_0;
  this.schemaViolations = new ArrayList_0;
}

function DocOpAutomaton$ViolationCollector(){
}

_ = DocOpAutomaton$ViolationCollector_0.prototype = DocOpAutomaton$ViolationCollector.prototype = new Object_0;
_.getClass$ = function getClass_848(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$ViolationCollector_2_classLit;
}
;
_.toString$ = function toString_64(){
  var b;
  if (this.operationIllFormed.size + this.operationInvalid.size + this.schemaViolations.size == 0) {
    return 'ViolationCollector[0]';
  }
  b = new StringBuilder_0;
  $append_8(b, 'ViolationCollector[' + (this.operationIllFormed.size + this.operationInvalid.size + this.schemaViolations.size) + ': ' + $firstDescription(this) + ']');
  return b.impl.string;
}
;
_.castableTypeMap$ = {};
function $clinit_1269(){
  $clinit_1269 = nullMethod;
  NO_SCHEMA_CONSTRAINTS = new DocumentSchema$1_0;
}

var NO_SCHEMA_CONSTRAINTS;
function DocumentSchema$1_0(){
}

function DocumentSchema$1(){
}

_ = DocumentSchema$1_0.prototype = DocumentSchema$1.prototype = new Object_0;
_.getClass$ = function getClass_849(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$1_2_classLit;
}
;
_.getRequiredInitialChildren = function getRequiredInitialChildren(typeOrNull){
  return $clinit_430() , $clinit_430() , EMPTY_LIST;
}
;
_.permitsAttribute = function permitsAttribute(type, attributeName){
  return true;
}
;
_.permitsAttribute_0 = function permitsAttribute_0(type, attributeName, attributeValue){
  return true;
}
;
_.permitsChild = function permitsChild(parentType, childType){
  return true;
}
;
_.permittedCharacters = function permittedCharacters(type){
  return $clinit_1271() , ANY;
}
;
_.castableTypeMap$ = {};
function $clinit_1271(){
  $clinit_1271 = nullMethod;
  NONE_3 = new DocumentSchema$PermittedCharacters$1_0;
  BLIP_TEXT = new DocumentSchema$PermittedCharacters$2_0;
  ANY = new DocumentSchema$PermittedCharacters$3_0;
  $VALUES_50 = initValues(_3Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters_2_classLit, {58:1, 138:1}, 115, [NONE_3, BLIP_TEXT, ANY]);
}

function values_51(){
  $clinit_1271();
  return $VALUES_50;
}

function DocumentSchema$PermittedCharacters(){
}

_ = DocumentSchema$PermittedCharacters.prototype = new Enum;
_.getClass$ = function getClass_850(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 115:1};
var $VALUES_50, ANY, BLIP_TEXT, NONE_3;
function DocumentSchema$PermittedCharacters$1_0(){
  this.name_0 = 'NONE';
  this.ordinal = 0;
}

function DocumentSchema$PermittedCharacters$1(){
}

_ = DocumentSchema$PermittedCharacters$1_0.prototype = DocumentSchema$PermittedCharacters$1.prototype = new DocumentSchema$PermittedCharacters;
_.coerceString = function coerceString(string){
  throw new IllegalArgumentException_1("Text not permitted at all, can't convert");
}
;
_.getClass$ = function getClass_851(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters$1_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 115:1};
function $coerceString(string){
  var result;
  result = new StringBuilder_0;
  traverseUtf16String(string, new DocumentSchema$PermittedCharacters$2$1_0(result));
  return result.impl.string;
}

function DocumentSchema$PermittedCharacters$2_0(){
  this.name_0 = 'BLIP_TEXT';
  this.ordinal = 1;
}

function DocumentSchema$PermittedCharacters$2(){
}

_ = DocumentSchema$PermittedCharacters$2_0.prototype = DocumentSchema$PermittedCharacters$2.prototype = new DocumentSchema$PermittedCharacters;
_.coerceString = function coerceString_0(string){
  var result;
  return result = new StringBuilder_0 , traverseUtf16String(string, new DocumentSchema$PermittedCharacters$2$1_0(result)) , result.impl.string;
}
;
_.getClass$ = function getClass_852(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters$2_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 115:1};
function DocumentSchema$PermittedCharacters$2$1_0(val$result){
  this.val$result = val$result;
}

function DocumentSchema$PermittedCharacters$2$1(){
}

_ = DocumentSchema$PermittedCharacters$2$1_0.prototype = DocumentSchema$PermittedCharacters$2$1.prototype = new Object_0;
_.codePoint = function codePoint_0(cp){
  return cp == 9?$append_8(this.val$result, '    '):cp == 10 || cp == 13?$append_3(this.val$result, 32):($clinit_1490() , 0 <= cp && cp <= 1114111 || illegalArgument('Not a code point: 0x' + toPowerOfTwoString(cp)) , cp >= 65536?$append_3(this.val$result, 65533):isCodePointGoodForBlip(cp) == ($clinit_1494() , OK)?$append_3(this.val$result, cp & 65535):$append_3(this.val$result, 65533)) , null;
}
;
_.endOfString = function endOfString(){
  return null;
}
;
_.getClass$ = function getClass_853(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters$2$1_2_classLit;
}
;
_.unpairedSurrogate = function unpairedSurrogate(c){
  return $append_3(this.val$result, 65533) , null;
}
;
_.castableTypeMap$ = {};
_.val$result = null;
function DocumentSchema$PermittedCharacters$3_0(){
  this.name_0 = 'ANY';
  this.ordinal = 2;
}

function DocumentSchema$PermittedCharacters$3(){
}

_ = DocumentSchema$PermittedCharacters$3_0.prototype = DocumentSchema$PermittedCharacters$3.prototype = new DocumentSchema$PermittedCharacters;
_.coerceString = function coerceString_1(string){
  var result;
  result = new StringBuilder_0;
  traverseUtf16String(string, new DocumentSchema$PermittedCharacters$3$1_0(result));
  return result.impl.string;
}
;
_.getClass$ = function getClass_854(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters$3_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 115:1};
function DocumentSchema$PermittedCharacters$3$1_0(val$result){
  this.val$result = val$result;
}

function DocumentSchema$PermittedCharacters$3$1(){
}

_ = DocumentSchema$PermittedCharacters$3$1_0.prototype = DocumentSchema$PermittedCharacters$3$1.prototype = new Object_0;
_.codePoint = function codePoint_1(cp){
  return $clinit_1490() , 0 <= cp && cp <= 1114111 || illegalArgument('Not a code point: 0x' + toPowerOfTwoString(cp)) , cp >= 65536?$append_3(this.val$result, 65533):isCodePointValid(cp)?$append_3(this.val$result, cp & 65535):$append_3(this.val$result, 65533) , null;
}
;
_.endOfString = function endOfString_0(){
  return null;
}
;
_.getClass$ = function getClass_855(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters$3$1_2_classLit;
}
;
_.unpairedSurrogate = function unpairedSurrogate_0(c){
  return $append_3(this.val$result, 65533) , null;
}
;
_.castableTypeMap$ = {};
_.val$result = null;
function AbstractDocInitialization(){
}

_ = AbstractDocInitialization.prototype = new Object_0;
_.apply_5 = function apply_62(c){
  this.val$op.apply_5(c?c:new InitializationCursorAdapter_0(null));
}
;
_.applyComponent = function applyComponent_0(i, c){
  this.val$op.applyComponent(i, c?c:new InitializationCursorAdapter_0(null));
}
;
_.getClass$ = function getClass_856(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_AbstractDocInitialization_2_classLit;
}
;
_.castableTypeMap$ = {173:1, 218:1};
function AbstractBufferedDocInitialization(){
}

_ = AbstractBufferedDocInitialization.prototype = new AbstractDocInitialization;
_.apply_5 = function apply_63(c){
  this.val$op.apply_5(c?c:new InitializationCursorAdapter_0(null));
}
;
_.getClass$ = function getClass_857(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_AbstractBufferedDocInitialization_2_classLit;
}
;
_.toString$ = function toString_65(){
  return 'BufferedInit@' + toPowerOfTwoString(this.$H || (this.$H = ++sNextHashId)) + '[' + toConciseString(($clinit_1356() , $clinit_1356() , new DocOpUtil$1_0(scrub_0(this)))) + ']';
}
;
_.castableTypeMap$ = {173:1, 218:1};
function $clinit_1279(){
  $clinit_1279 = nullMethod;
  EMPTY_ARRAY = initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0);
  $build_1(new AnnotationBoundaryMapImpl$Builder_0);
}

function $copy(input){
  var i, ret;
  ret = initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, input.length, 0);
  for (i = 0; i < input.length; ++i) {
    ret[i] = input[i];
  }
  return ret;
}

function AnnotationBoundaryMapImpl_0(endKeys, changeKeys, changeOldValues, changeNewValues){
  $clinit_1279();
  var changeKey, changeKey$index, changeKey$max, changeKeySet, endKey, endKey$index, endKey$max, endKeySet;
  if (changeKeys.length != changeOldValues.length || changeKeys.length != changeNewValues.length) {
    throw new IllegalArgumentException_1("Change keys, new values, and old values sizes don't match");
  }
  changeKeySet = new HashSet_1(new Arrays$ArrayList_0(changeKeys));
  endKeySet = new HashSet_1(new Arrays$ArrayList_0(endKeys));
  if (changeKeySet.map.size_0() != changeKeys.length || endKeySet.map.size_0() != endKeys.length) {
    throw new IllegalArgumentException_1('Keys must all be unique');
  }
  if (changeKeySet.map.containsKey(null) || endKeySet.map.containsKey(null)) {
    throw new NullPointerException_1('Null keys are not permitted');
  }
  if (changeKeySet.map.containsKey('') || endKeySet.map.containsKey('')) {
    throw new IllegalArgumentException_1('Empty-string keys are not permitted');
  }
  for (changeKey$index = 0 , changeKey$max = changeKeys.length; changeKey$index < changeKey$max; ++changeKey$index) {
    changeKey = changeKeys[changeKey$index];
    validateAnnotationKey(changeKey);
  }
  for (endKey$index = 0 , endKey$max = endKeys.length; endKey$index < endKey$max; ++endKey$index) {
    endKey = endKeys[endKey$index];
    validateAnnotationKey(endKey);
    if (changeKeySet.map.containsKey(endKey)) {
      throw new IllegalArgumentException_1('Change keys and end keys must be disjoint sets');
    }
  }
  this.changeKeys = $copy(changeKeys);
  this.changeOldValues = $copy(changeOldValues);
  this.changeNewValues = $copy(changeNewValues);
  this.endKeys = $copy(endKeys);
}

function validateAnnotationKey(key){
  if (key.indexOf('?') != -1 || key.indexOf('@') != -1) {
    throw new IllegalArgumentException_1("Annotation keys must not contain the '?' or '@' characters");
  }
}

function AnnotationBoundaryMapImpl(){
}

_ = AnnotationBoundaryMapImpl_0.prototype = AnnotationBoundaryMapImpl.prototype = new Object_0;
_.changeSize = function changeSize_3(){
  return this.changeKeys.length;
}
;
_.endSize = function endSize_3(){
  return this.endKeys.length;
}
;
_.getChangeKey_0 = function getChangeKey_4(changeIndex){
  return this.changeKeys[changeIndex];
}
;
_.getClass$ = function getClass_858(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_AnnotationBoundaryMapImpl_2_classLit;
}
;
_.getEndKey_0 = function getEndKey_4(endIndex){
  return this.endKeys[endIndex];
}
;
_.getNewValue = function getNewValue_2(changeIndex){
  return this.changeNewValues[changeIndex];
}
;
_.getOldValue = function getOldValue_2(changeIndex){
  return this.changeOldValues[changeIndex];
}
;
_.toString$ = function toString_66(){
  return toConciseString_2(this);
}
;
_.castableTypeMap$ = {235:1};
_.changeKeys = null;
_.changeNewValues = null;
_.changeOldValues = null;
_.endKeys = null;
var EMPTY_ARRAY;
function $build_1(this$static){
  return new AnnotationBoundaryMapImpl_0(this$static.endKeys, this$static.changeKeys, this$static.changeOldValues, this$static.changeNewValues);
}

function AnnotationBoundaryMapImpl$Builder_0(){
  this.changeKeys = ($clinit_1279() , EMPTY_ARRAY);
  this.changeOldValues = EMPTY_ARRAY;
  this.changeNewValues = EMPTY_ARRAY;
  this.endKeys = EMPTY_ARRAY;
}

function AnnotationBoundaryMapImpl$Builder(){
}

_ = AnnotationBoundaryMapImpl$Builder_0.prototype = AnnotationBoundaryMapImpl$Builder.prototype = new Object_0;
_.getClass$ = function getClass_859(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_AnnotationBoundaryMapImpl$Builder_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_1282(){
  $clinit_1282 = nullMethod;
  comparator = new ImmutableStateMap$2_0;
}

function $attributeListFromMap(map){
  var attributeList, entry, entry$iterator;
  attributeList = new ArrayList_2(map.size_0());
  for (entry$iterator = map.entrySet_0().iterator_0(); entry$iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.next_0(), 66);
    (entry.getKey() == null || entry.getValue() == null) && nullPointer();
    $add_9(attributeList, new ImmutableStateMap$Attribute_0(entry));
  }
  sort_2(attributeList, comparator);
  return attributeList;
}

function $updateWith(this$static, attributeUpdate, checkCompatibility){
  var comparison, iterator, newImmutableStateMap, nextAttribute, update, update$iterator, updates;
  newImmutableStateMap = new ArrayList_0;
  iterator = this$static.attributes.iterator_0();
  nextAttribute = iterator.hasNext()?dynamicCast(iterator.next_0(), 221):null;
  updates = attributeUpdate.updates;
  for (update$iterator = updates.iterator_0(); update$iterator.hasNext();) {
    update = dynamicCast(update$iterator.next_0(), 220);
    while (nextAttribute) {
      comparison = compareTo_5(update.name_0, nextAttribute.name_0);
      if (comparison > 0) {
        setCheck(newImmutableStateMap.array, newImmutableStateMap.size++, nextAttribute);
        nextAttribute = iterator.hasNext()?dynamicCast(iterator.next_0(), 221):null;
      }
       else if (comparison < 0) {
        checkCompatibility && update.oldValue != null && illegalArgument('Mismatched old value: attempt to update unset attribute with ' + update);
        break;
      }
       else if (comparison == 0) {
        checkCompatibility && !$equals_3(nextAttribute.value_0, update.oldValue) && illegalArgument('Mismatched old value: attempt to update ' + nextAttribute + ' with ' + update);
        nextAttribute = iterator.hasNext()?dynamicCast(iterator.next_0(), 221):null;
        break;
      }
    }
    update.newValue != null && $add_9(newImmutableStateMap, new ImmutableStateMap$Attribute_1(update.name_0, update.newValue));
  }
  if (nextAttribute) {
    setCheck(newImmutableStateMap.array, newImmutableStateMap.size++, nextAttribute);
    while (iterator.hasNext()) {
      $add_9(newImmutableStateMap, dynamicCast(iterator.next_0(), 221));
    }
  }
  return this$static.createFromList(newImmutableStateMap);
}

function ImmutableStateMap_0(){
  $clinit_1282();
  this.entrySet = new ImmutableStateMap$1_0(this);
  this.attributes = ($clinit_430() , $clinit_430() , EMPTY_LIST);
}

function checkAttributesSorted(attributes){
  var a_0, a$iterator, previous;
  previous = null;
  for (a$iterator = new AbstractList$IteratorImpl_0(attributes); a$iterator.i < a$iterator.this$0_0.size_0();) {
    a_0 = dynamicCast($next_6(a$iterator), 221);
    checkNotNull_1(a_0, 'Null attribute');
    !!previous && compareTo_5(previous.name_0, a_0.name_0) >= 0 && illegalArgument('Attribute keys not strictly monotonic: ' + previous.name_0 + ', ' + a_0.name_0);
    previous = a_0;
  }
}

function ImmutableStateMap(){
}

_ = ImmutableStateMap.prototype = new AbstractMap;
_.entrySet_0 = function entrySet_5(){
  return this.entrySet;
}
;
_.getClass$ = function getClass_860(){
  return Lorg_waveprotocol_wave_model_document_operation_util_ImmutableStateMap_2_classLit;
}
;
_.castableTypeMap$ = {26:1};
_.attributes = null;
var comparator;
function $clinit_1283(){
  $clinit_1283 = nullMethod;
  $clinit_1282();
  EMPTY_MAP_1 = new AnnotationMapImpl_0;
}

function AnnotationMapImpl_0(){
  ImmutableStateMap_0.call(this);
}

function AnnotationMapImpl_1(map){
  $clinit_1283();
  this.entrySet = new ImmutableStateMap$1_0(this);
  this.attributes = $attributeListFromMap(map);
}

function AnnotationMapImpl_2(attributes){
  $clinit_1282();
  this.entrySet = new ImmutableStateMap$1_0(this);
  this.attributes = attributes;
}

function AnnotationMapImpl(){
}

_ = AnnotationMapImpl_2.prototype = AnnotationMapImpl_1.prototype = AnnotationMapImpl_0.prototype = AnnotationMapImpl.prototype = new ImmutableStateMap;
_.createFromList = function createFromList(attributes){
  return new AnnotationMapImpl_2(attributes);
}
;
_.getClass$ = function getClass_861(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_AnnotationMapImpl_2_classLit;
}
;
_.updateWithNoCompatibilityCheck = function updateWithNoCompatibilityCheck_0(attributeUpdate){
  return $updateWith(this, attributeUpdate, false);
}
;
_.castableTypeMap$ = {26:1, 225:1};
var EMPTY_MAP_1;
function $clinit_1285(){
  $clinit_1285 = nullMethod;
  comparator_0 = new ImmutableUpdateMap$1_0;
}

function $areEqual(a_0, b){
  return a_0 == null?b == null:$equals_3(a_0, b);
}

function $composeWith(this$static, mutation){
  var attribute, attribute$iterator, comparison, iterator, mutationAttributes, newAttributes, nextAttribute;
  newAttributes = new ArrayList_0;
  iterator = this$static.updates.iterator_0();
  nextAttribute = iterator.hasNext()?dynamicCast(iterator.next_0(), 220):null;
  mutationAttributes = mutation.updates;
  loop: for (attribute$iterator = mutationAttributes.iterator_0(); attribute$iterator.hasNext();) {
    attribute = dynamicCast(attribute$iterator.next_0(), 220);
    while (nextAttribute) {
      comparison = compareTo_5(dynamicCast(attribute, 220).name_0, dynamicCast(nextAttribute, 220).name_0);
      if (comparison < 0) {
        break;
      }
       else if (comparison > 0) {
        setCheck(newAttributes.array, newAttributes.size++, nextAttribute);
        nextAttribute = iterator.hasNext()?dynamicCast(iterator.next_0(), 220):null;
      }
       else {
        $areEqual(nextAttribute.newValue, attribute.oldValue) || illegalArgument('Mismatched old value: attempt to update ' + nextAttribute + ' with ' + attribute);
        $add_9(newAttributes, new ImmutableUpdateMap$AttributeUpdate_0(attribute.name_0, nextAttribute.oldValue, attribute.newValue));
        nextAttribute = iterator.hasNext()?dynamicCast(iterator.next_0(), 220):null;
        continue loop;
      }
    }
    setCheck(newAttributes.array, newAttributes.size++, attribute);
  }
  if (nextAttribute) {
    setCheck(newAttributes.array, newAttributes.size++, nextAttribute);
    while (iterator.hasNext()) {
      $add_9(newAttributes, dynamicCast(iterator.next_0(), 220));
    }
  }
  return new AttributesUpdateImpl_2(newAttributes);
}

function $exclude(this$static, names){
  var newAttributes, update, update$iterator;
  newAttributes = new ArrayList_0;
  for (update$iterator = this$static.updates.iterator_0(); update$iterator.hasNext();) {
    update = dynamicCast(update$iterator.next_0(), 220);
    names.map.containsKey(update.name_0) || (setCheck(newAttributes.array, newAttributes.size++, update) , true);
  }
  return new AttributesUpdateImpl_2(newAttributes);
}

function ImmutableUpdateMap_1(triples){
  $clinit_1285();
  var accu, i, x;
  checkArgument_0(triples.length % 3 == 0, 'Triples must come in groups of three');
  accu = new ArrayList_2(~~(triples.length / 3));
  for (i = 0; i < triples.length; i += 3) {
    checkNotNull_1(triples[i], 'Null key');
    $add_9(accu, new ImmutableUpdateMap$AttributeUpdate_0(triples[i], triples[i + 1], triples[i + 2]));
  }
  sort_2(accu, comparator_0);
  for (i = 1; i < accu.size; ++i) {
    x = $compare_6(dynamicCast((checkIndex(i - 1, accu.size) , accu.array[i - 1]), 220), dynamicCast((checkIndex(i, accu.size) , accu.array[i]), 220));
    if (x == 0) {
      throw new IllegalArgumentException_1('Duplicate key: ' + dynamicCast((checkIndex(i, accu.size) , accu.array[i]), 220).name_0);
    }
  }
  this.updates = accu;
}

function ImmutableUpdateMap(){
}

_ = ImmutableUpdateMap.prototype = new Object_0;
_.getClass$ = function getClass_862(){
  return Lorg_waveprotocol_wave_model_document_operation_util_ImmutableUpdateMap_2_classLit;
}
;
_.toString$ = function toString_67(){
  return 'Updates: ' + this.updates;
}
;
_.castableTypeMap$ = {};
_.updates = null;
var comparator_0;
function $clinit_1286(){
  $clinit_1286 = nullMethod;
  $clinit_1285();
  new AnnotationsUpdateImpl_0;
}

function $composeWith_0(this$static, map){
  var changeIndex, changeKey, endIndex, endKey, existingIndex, existingKey, existingVsChange, existingVsEnd, newUpdates;
  newUpdates = new ArrayList_0;
  existingIndex = 0;
  changeIndex = 0;
  endIndex = 0;
  while (existingIndex < this$static.updates.size_0() || changeIndex < map.changeSize() || endIndex < map.endSize()) {
    existingKey = existingIndex < this$static.updates.size_0()?dynamicCast(this$static.updates.get_0(existingIndex), 220).name_0:'\uFFFF';
    changeKey = changeIndex < map.changeSize()?map.getChangeKey_0(changeIndex):'\uFFFF';
    endKey = endIndex < map.endSize()?map.getEndKey_0(endIndex):'\uFFFF';
    existingVsEnd = compareTo_5(existingKey, endKey);
    existingVsChange = compareTo_5(existingKey, changeKey);
    if (existingVsEnd < 0) {
      if (existingVsChange < 0) {
        $add_9(newUpdates, dynamicCast(this$static.updates.get_0(existingIndex), 220));
        ++existingIndex;
      }
       else if (existingVsChange == 0) {
        $add_9(newUpdates, new ImmutableUpdateMap$AttributeUpdate_0(changeKey, map.getOldValue(changeIndex), map.getNewValue(changeIndex)));
        ++existingIndex;
        ++changeIndex;
      }
       else if (existingVsChange > 0) {
        $add_9(newUpdates, new ImmutableUpdateMap$AttributeUpdate_0(changeKey, map.getOldValue(changeIndex), map.getNewValue(changeIndex)));
        ++changeIndex;
      }
    }
     else if (existingVsEnd == 0) {
      if (existingVsChange < 0) {
        ++existingIndex;
        ++endIndex;
      }
       else if (existingVsChange == 0) {
        illegalArgument('AnnotationBoundaryMap with key both in change and end: ' + changeKey);
      }
       else if (existingVsChange > 0) {
        $add_9(newUpdates, new ImmutableUpdateMap$AttributeUpdate_0(changeKey, map.getOldValue(changeIndex), map.getNewValue(changeIndex)));
        ++existingIndex;
        ++endIndex;
        ++changeIndex;
      }
    }
     else 
      existingVsEnd > 0 && illegalArgument('Attempt to end key that is not part of the update: ' + endKey);
  }
  return new AnnotationsUpdateImpl_1(newUpdates);
}

function $containsKey_3(this$static, key){
  var u, u$iterator;
  checkNotNull_1(key, 'Null key');
  for (u$iterator = this$static.updates.iterator_0(); u$iterator.hasNext();) {
    u = dynamicCast(u$iterator.next_0(), 220);
    if ($equals_3(key, u.name_0)) {
      return true;
    }
  }
  return false;
}

function AnnotationsUpdateImpl_0(){
  $clinit_1286();
  this.updates = ($clinit_430() , $clinit_430() , EMPTY_LIST);
}

function AnnotationsUpdateImpl_1(updates){
  $clinit_1285();
  this.updates = updates;
}

function AnnotationsUpdateImpl(){
}

_ = AnnotationsUpdateImpl_1.prototype = AnnotationsUpdateImpl_0.prototype = AnnotationsUpdateImpl.prototype = new ImmutableUpdateMap;
_.getClass$ = function getClass_863(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_AnnotationsUpdateImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
function AttributesImpl_0(){
  $clinit_1282();
  ImmutableStateMap_0.call(this);
}

function AttributesImpl_1(map){
  $clinit_1282();
  this.entrySet = new ImmutableStateMap$1_0(this);
  this.attributes = $attributeListFromMap(map);
}

function AttributesImpl_2(attributes){
  $clinit_1282();
  this.entrySet = new ImmutableStateMap$1_0(this);
  this.attributes = attributes;
}

function fromStringMap(stringMap){
  $clinit_1282();
  var attrs;
  attrs = new ArrayList_0;
  stringMap.each(new AttributesImpl$1_0(attrs));
  return fromUnsortedAttributes(attrs);
}

function fromUnsortedAttributes(unsortedAttributes){
  $clinit_1282();
  var sorted;
  sorted = new ArrayList_1(unsortedAttributes);
  sort_2(sorted, comparator);
  return checkAttributesSorted(sorted) , new AttributesImpl_2(sorted);
}

function AttributesImpl(){
}

_ = AttributesImpl_2.prototype = AttributesImpl_1.prototype = AttributesImpl_0.prototype = AttributesImpl.prototype = new ImmutableStateMap;
_.createFromList = function createFromList_0(attributes){
  return new AttributesImpl_2(attributes);
}
;
_.getClass$ = function getClass_864(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_AttributesImpl_2_classLit;
}
;
_.castableTypeMap$ = {26:1, 236:1};
function AttributesImpl$1_0(val$attrs){
  this.val$attrs = val$attrs;
}

function AttributesImpl$1(){
}

_ = AttributesImpl$1_0.prototype = AttributesImpl$1.prototype = new Object_0;
_.apply_0 = function apply_64(key, value){
  $add_9(this.val$attrs, new ImmutableStateMap$Attribute_1(key, dynamicCast(value, 1)));
}
;
_.getClass$ = function getClass_865(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_AttributesImpl$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$attrs = null;
function $clinit_1289(){
  $clinit_1289 = nullMethod;
  $clinit_1285();
  new AttributesUpdateImpl_0;
}

function AttributesUpdateImpl_0(){
  $clinit_1289();
  this.updates = ($clinit_430() , $clinit_430() , EMPTY_LIST);
}

function AttributesUpdateImpl_1(triples){
  $clinit_1289();
  ImmutableUpdateMap_1.call(this, triples);
}

function AttributesUpdateImpl_2(updates){
  $clinit_1289();
  this.updates = updates;
}

--></script>
<script><!--
function AttributesUpdateImpl(){
}

_ = AttributesUpdateImpl_2.prototype = AttributesUpdateImpl_1.prototype = AttributesUpdateImpl_0.prototype = AttributesUpdateImpl.prototype = new ImmutableUpdateMap;
_.getClass$ = function getClass_866(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_AttributesUpdateImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
function BufferedDocOpImpl_0(components){
  this.components = components;
}

function checkWellformedness(value){
  var v;
  $clinit_1301();
  if (!(value?isWellFormed(null, value):validate_1(null, ($clinit_1269() , NO_SCHEMA_CONSTRAINTS), ($clinit_1259() , EMPTY_DOCUMENT), null) != ($clinit_1267() , ILL_FORMED))) {
    v = new DocOpAutomaton$ViolationCollector_0;
    value?isWellFormed(v, value):validate_1(v, ($clinit_1269() , NO_SCHEMA_CONSTRAINTS), ($clinit_1259() , EMPTY_DOCUMENT), null) != ($clinit_1267() , ILL_FORMED);
    illegalState('Attempt to build ill-formed operation (' + v + '): ' + value);
  }
}

function BufferedDocOpImpl(){
}

_ = BufferedDocOpImpl_0.prototype = BufferedDocOpImpl.prototype = new Object_0;
_.apply_5 = function apply_65(cursor){
  var component, component$array, component$index, component$max;
  for (component$array = this.components , component$index = 0 , component$max = component$array.length; component$index < component$max; ++component$index) {
    component = component$array[component$index];
    component.apply_5(cursor);
  }
}
;
_.applyComponent = function applyComponent_1(i, cursor){
  this.components[i].apply_5(cursor);
}
;
_.getClass$ = function getClass_867(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_BufferedDocOpImpl_2_classLit;
}
;
_.size_0 = function size_32(){
  return this.components.length;
}
;
_.toString$ = function toString_68(){
  return 'Buffered@' + toPowerOfTwoString(this.$H || (this.$H = ++sNextHashId)) + '[' + toConciseString(($clinit_1356() , scrub_0(this))) + ']';
}
;
_.castableTypeMap$ = {173:1};
_.components = null;
_.knownToBeWellFormed = false;
function $clinit_1291(){
  $clinit_1291 = nullMethod;
  EMPTY_ARRAY_0 = initDim(_3Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DocInitializationComponent_2_classLit, {58:1, 138:1, 193:1}, 116, 0, 0);
}

function DocInitializationBuilder_0(){
  $clinit_1291();
  this.accu = new ArrayList_0;
}

function DocInitializationBuilder(){
}

_ = DocInitializationBuilder_0.prototype = DocInitializationBuilder.prototype = new Object_0;
_.getClass$ = function getClass_868(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_DocInitializationBuilder_2_classLit;
}
;
_.castableTypeMap$ = {};
var EMPTY_ARRAY_0;
function $clinit_1292(){
  $clinit_1292 = nullMethod;
  EMPTY_ARRAY_1 = initDim(_3Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DocOpComponent_2_classLit, {58:1, 138:1, 193:1}, 117, 0, 0);
}

function UncheckedDocOpBuffer_0(){
  $clinit_1292();
  this.accu = new ArrayList_0;
}

function UncheckedDocOpBuffer(){
}

_ = UncheckedDocOpBuffer_0.prototype = UncheckedDocOpBuffer.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_13(map){
  $add_9(this.accu, new OperationComponents$AnnotationBoundary_0(map));
}
;
_.characters_0 = function characters_22(s){
  $add_9(this.accu, new OperationComponents$Characters_0(s));
}
;
_.deleteCharacters = function deleteCharacters_25(s){
  $add_9(this.accu, new OperationComponents$DeleteCharacters_0(s));
}
;
_.deleteElementEnd = function deleteElementEnd_23(){
  $add_9(this.accu, ($clinit_1310() , INSTANCE_14));
}
;
_.deleteElementStart = function deleteElementStart_23(type, attrs){
  $add_9(this.accu, new OperationComponents$DeleteElementStart_0(type, attrs));
}
;
_.elementEnd = function elementEnd_19(){
  $add_9(this.accu, ($clinit_1312() , INSTANCE_15));
}
;
_.elementStart = function elementStart_19(type, attrs){
  $add_9(this.accu, new OperationComponents$ElementStart_0(type, attrs));
}
;
_.finish_1 = function finish_12(){
  return new BufferedDocOpImpl_0(dynamicCast($toArray_1(this.accu, EMPTY_ARRAY_1), 193));
}
;
_.finish_0 = function finish_13(){
  return this.finish_1();
}
;
_.getClass$ = function getClass_869(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_UncheckedDocOpBuffer_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_25(oldAttrs, newAttrs){
  $add_9(this.accu, new OperationComponents$ReplaceAttributes_0(oldAttrs, newAttrs));
}
;
_.retain = function retain_21(itemCount){
  $add_9(this.accu, new OperationComponents$Retain_0(itemCount));
}
;
_.updateAttributes = function updateAttributes_25(update){
  $add_9(this.accu, new OperationComponents$UpdateAttributes_0(update));
}
;
_.castableTypeMap$ = {};
var EMPTY_ARRAY_1;
function DocOpBuffer_0(){
  $clinit_1292();
  this.accu = new ArrayList_0;
}

function DocOpBuffer(){
}

_ = DocOpBuffer_0.prototype = DocOpBuffer.prototype = new UncheckedDocOpBuffer;
_.finish_1 = function finish_14(){
  var op;
  return op = new BufferedDocOpImpl_0(dynamicCast($toArray_1(this.accu, EMPTY_ARRAY_1), 193)) , checkWellformedness(op) , op;
}
;
_.getClass$ = function getClass_870(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_DocOpBuffer_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_1294(){
  $clinit_1294 = nullMethod;
  EMPTY_ARRAY_2 = initDim(_3Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DocOpComponent_2_classLit, {58:1, 138:1, 193:1}, 117, 0, 0);
}

function $annotationBoundary_1(this$static, map){
  $add_9(this$static.accu, new OperationComponents$AnnotationBoundary_0(map));
  return this$static;
}

function $characters_3(this$static, s){
  $add_9(this$static.accu, new OperationComponents$Characters_0(s));
  return this$static;
}

function $elementStart_3(this$static, type, attrs){
  $add_9(this$static.accu, new OperationComponents$ElementStart_0(type, attrs));
  return this$static;
}

function DocOpBuilder_0(){
  $clinit_1294();
  this.accu = new ArrayList_0;
}

function DocOpBuilder(){
}

_ = DocOpBuilder_0.prototype = DocOpBuilder.prototype = new Object_0;
_.getClass$ = function getClass_871(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_DocOpBuilder_2_classLit;
}
;
_.castableTypeMap$ = {};
var EMPTY_ARRAY_2;
function attributeString(attributes){
  var b, e, e$iterator, first;
  b = new StringBuilder_0;
  first = true;
  for (e$iterator = new ImmutableStateMap$1$1_0(attributes.entrySet); e$iterator.iterator.hasNext();) {
    e = dynamicCast(e$iterator.iterator.next_0(), 221);
    first?(first = false):(b.impl.string += ' ' , b);
    $append_8(b, e.name_0 + '=' + (e.value_0 == null?'null':'"' + $replaceAll(e.value_0, '"', '&quot;') + '"'));
  }
  return b.impl.string;
}

function buildXmlString(op, b){
  var $e0, e;
  try {
    op.val$op.apply_5(new InitializationCursorAdapter_0(new DocOpUtil$3_0(b)));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 4)) {
      e = $e0;
      throw new RuntimeException_2('toXmlString: DocInitialization was probably ill-formed', e);
    }
     else 
      throw $e0;
  }
}

function docInitializationFromXml(text){
  var anBuilder, ann, ann$iterator, builder, key, name_0, newValue, op, p, parseAnnotations, changes, ends, op_0;
  p = new StreamingXmlParser_0(text);
  builder = new DocOpBuilder_0;
  while ($hasMore(p.buffer) || p.atSelfClosingStart) {
    switch ($next_16(p).ordinal) {
      case 0:
        $elementStart_3(builder, $getTagName_5(p.current), fromStringMap($getAttributes_4(p.current)));
        continue;
      case 1:
        $add_9(builder.accu, ($clinit_1312() , INSTANCE_15));
        continue;
      case 2:
        $characters_3(builder, $getText(p.current));
        continue;
      case 3:
        name_0 = $getProcessingInstructionName(p.current);
        anBuilder = new AnnotationBoundaryMapBuilder_0;
        if ($equals_3('a', name_0)) {
          parseAnnotations = $parse_0(new AnnotationParser_0($getProcessingInstructionValue(p.current)));
          for (ann$iterator = new AbstractList$IteratorImpl_0(parseAnnotations); ann$iterator.i < ann$iterator.this$0_0.size_0();) {
            ann = dynamicCast($next_6(ann$iterator), 224);
            key = dynamicCast(ann.first, 1);
            newValue = dynamicCast(ann.second, 1);
            newValue == null?($remove_25(anBuilder.changes, key) , $add_20(anBuilder.endKeys, key) , anBuilder):($remove_26(anBuilder.endKeys, key) , $put_5(anBuilder.changes, key, new Pair_0(null, newValue)) , anBuilder);
          }
          $annotationBoundary_1(builder, (ends = initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, anBuilder.endKeys.backend.size_0(), 0) , changes = initDim(_3Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$Triplet_2_classLit, {58:1, 138:1}, 111, anBuilder.changes.backend.size_0(), 0) , $each_3(anBuilder.endKeys, new AnnotationBoundaryMapBuilder$2_0(ends)) , $each_2(anBuilder.changes, new AnnotationBoundaryMapBuilder$3_0(changes)) , mergeSort(ends, 0, ends.length, ($clinit_447() , $clinit_447() , NATURAL)) , sort_0(changes, TRIPLET_COMPARATOR) , new AnnotationBoundaryMapBuilder$AnnotationBoundaryMapImpl_0(ends, changes)));
        }

        continue;
    }
  }
  op = (op_0 = new BufferedDocOpImpl_0(dynamicCast($toArray_1(builder.accu, ($clinit_1294() , EMPTY_ARRAY_2)), 193)) , checkWellformedness(op_0) , op_0);
  return new DocOpUtil$1_0(op);
}

function literalString(string){
  var regex, replacement;
  return string == null?'null':'"' + $replace_2((regex = $replaceAll('\\', '([/\\\\\\.\\*\\+\\?\\|\\(\\)\\[\\]\\{\\}$^])', '\\\\$1') , replacement = $replaceAll($replaceAll('\\\\', '\\\\', '\\\\\\\\'), '\\$', '\\\\$') , $replaceAll(string, regex, replacement)), '"', '\\"') + '"';
}

function toConciseString(op){
  var b;
  b = new StringBuilder_0;
  op.apply_5(new DocOpUtil$2_0(b));
  return b.impl.string;
}

function toConciseString_0(attributes){
  var b, entry, entry$iterator, first;
  if (attributes.size_0() == 0) {
    return '{}';
  }
  b = new StringBuilder_0;
  b.impl.string += '{ ';
  first = true;
  for (entry$iterator = new ImmutableStateMap$1$1_0(attributes.entrySet); entry$iterator.iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.iterator.next_0(), 221);
    first?(first = false):(b.impl.string += ', ' , b);
    $append_8(b, entry.name_0);
    b.impl.string += '=';
    $append_8(b, literalString(entry.value_0));
  }
  b.impl.string += ' }';
  return b.impl.string;
}

function toConciseString_1(update){
  var b, i;
  if (update.updates.size_0() == 0) {
    return '{}';
  }
  b = new StringBuilder_0;
  b.impl.string += '{ ';
  for (i = 0; i < update.updates.size_0(); ++i) {
    i > 0 && (b.impl.string += ', ' , b);
    $append_8(b, dynamicCast(update.updates.get_0(i), 220).name_0);
    b.impl.string += ': ';
    $append_8(b, literalString(dynamicCast(update.updates.get_0(i), 220).oldValue));
    b.impl.string += ' -> ';
    $append_8(b, literalString(dynamicCast(update.updates.get_0(i), 220).newValue));
  }
  b.impl.string += ' }';
  return b.impl.string;
}

function toConciseString_2(map){
  var b, i, notEmpty;
  b = new StringBuilder_0;
  b.impl.string += '{ ';
  notEmpty = false;
  for (i = 0; i < map.endSize(); ++i) {
    notEmpty?(b.impl.string += ', ' , b):(notEmpty = true);
    $append_8(b, literalString(map.getEndKey_0(i)));
  }
  for (i = 0; i < map.changeSize(); ++i) {
    notEmpty?(b.impl.string += ', ' , b):(notEmpty = true);
    $append_8(b, literalString(map.getChangeKey_0(i)));
    b.impl.string += ': ';
    $append_8(b, literalString(map.getOldValue(i)));
    b.impl.string += ' -> ';
    $append_8(b, literalString(map.getNewValue(i)));
  }
  b.impl.string += ' }';
  return notEmpty?b.impl.string:'{}';
}

function toPrettyXmlString(op){
  var b;
  b = new StringBuilder_0;
  buildXmlString(op, b);
  return b.impl.string;
}

function DocOpUtil$1_0(val$op){
  this.val$op = val$op;
}

function DocOpUtil$1(){
}

_ = DocOpUtil$1_0.prototype = DocOpUtil$1.prototype = new AbstractBufferedDocInitialization;
_.getClass$ = function getClass_872(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_DocOpUtil$1_2_classLit;
}
;
_.size_0 = function size_33(){
  return this.val$op.size_0();
}
;
_.castableTypeMap$ = {173:1, 218:1};
_.val$op = null;
function DocOpUtil$2_0(val$b){
  this.val$b = val$b;
}

function DocOpUtil$2(){
}

_ = DocOpUtil$2_0.prototype = DocOpUtil$2.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_14(map){
  $append_8(this.val$b, '|| ' + toConciseString_2(map) + '; ');
}
;
_.characters_0 = function characters_23(chars){
  var regex, replacement;
  $append_8(this.val$b, '++' + (chars == null?'null':'"' + $replace_2((regex = $replaceAll('\\', '([/\\\\\\.\\*\\+\\?\\|\\(\\)\\[\\]\\{\\}$^])', '\\\\$1') , replacement = $replaceAll($replaceAll('\\\\', '\\\\', '\\\\\\\\'), '\\$', '\\\\$') , $replaceAll(chars, regex, replacement)), '"', '\\"') + '"') + '; ');
}
;
_.deleteCharacters = function deleteCharacters_26(chars){
  var regex, replacement;
  $append_8(this.val$b, '--' + (chars == null?'null':'"' + $replace_2((regex = $replaceAll('\\', '([/\\\\\\.\\*\\+\\?\\|\\(\\)\\[\\]\\{\\}$^])', '\\\\$1') , replacement = $replaceAll($replaceAll('\\\\', '\\\\', '\\\\\\\\'), '\\$', '\\\\$') , $replaceAll(chars, regex, replacement)), '"', '\\"') + '"') + '; ');
}
;
_.deleteElementEnd = function deleteElementEnd_24(){
  $append_8(this.val$b, 'x>; ');
}
;
_.deleteElementStart = function deleteElementStart_24(type, attrs){
  $append_8(this.val$b, 'x< ' + type + ' ' + toConciseString_0(attrs) + '; ');
}
;
_.elementEnd = function elementEnd_20(){
  $append_8(this.val$b, '>>; ');
}
;
_.elementStart = function elementStart_20(type, attrs){
  $append_8(this.val$b, '<< ' + type + ' ' + toConciseString_0(attrs) + '; ');
}
;
_.getClass$ = function getClass_873(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_DocOpUtil$2_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_26(oldAttrs, newAttrs){
  $append_8(this.val$b, 'r@ ' + toConciseString_0(oldAttrs) + ' ' + toConciseString_0(newAttrs) + '; ');
}
;
_.retain = function retain_22(distance){
  $append_8(this.val$b, '__' + distance + '; ');
}
;
_.updateAttributes = function updateAttributes_26(attrUpdate){
  $append_8(this.val$b, 'u@ ' + toConciseString_1(attrUpdate) + '; ');
}
;
_.castableTypeMap$ = {};
_.val$b = null;
function $annotationBoundary_2(this$static, map){
  var entry, entry$iterator, i, key, value;
  $clear_7(this$static.changes);
  for (i = 0; i < map.changeSize(); ++i) {
    key = map.getChangeKey_0(i);
    value = map.getNewValue(i);
    if (!$equal(dynamicCast(this$static.currentAnnotations.get(key), 1), value)) {
      this$static.currentAnnotations.put(key, value);
      $put_0(this$static.changes, key, value);
    }
  }
  for (i = 0; i < map.endSize(); ++i) {
    key = map.getEndKey_0(i);
    if (this$static.currentAnnotations.get(key) != null) {
      this$static.currentAnnotations.remove_2(key);
      $put_0(this$static.changes, key, null);
    }
  }
  if (this$static.changes.size == 0) {
    return;
  }
  if (this$static.elementPart != null) {
    $append_8(this$static.val$b, this$static.elementPart + '>');
    this$static.elementPart = null;
  }
  $append_8(this$static.val$b, '<?a');
  for (entry$iterator = new TreeMap$EntryIterator_0((new TreeMap$EntrySet_0(this$static.changes)).this$0); $hasNext_3(entry$iterator.iter);) {
    entry = entry$iterator.last = dynamicCast($next_6(entry$iterator.iter), 66);
    if (entry.getValue() != null) {
      $append_8(this$static.val$b, ' "' + $replaceAll($replaceAll($replaceAll($replace_2($replace_2($replace_2(dynamicCast(entry.getKey(), 1), '\\', '\\\\'), '"', '\\"'), '?', '\\q'), '&', '&amp;'), '<', '&lt;'), '>', '&gt;') + '"');
      $append_8(this$static.val$b, '=');
      $append_8(this$static.val$b, '"' + $replaceAll($replaceAll($replaceAll($replace_2($replace_2($replace_2(dynamicCast(entry.getValue(), 1), '\\', '\\\\'), '"', '\\"'), '?', '\\q'), '&', '&amp;'), '<', '&lt;'), '>', '&gt;') + '"');
    }
     else {
      $append_8(this$static.val$b, ' "' + $replaceAll($replaceAll($replaceAll($replace_2($replace_2($replace_2(dynamicCast(entry.getKey(), 1), '\\', '\\\\'), '"', '\\"'), '?', '\\q'), '&', '&amp;'), '<', '&lt;'), '>', '&gt;') + '"');
    }
  }
  $append_8(this$static.val$b, '?>');
}

function $characters_4(this$static, chars){
  if (this$static.elementPart != null) {
    $append_8(this$static.val$b, this$static.elementPart + '>');
    this$static.elementPart = null;
  }
  $append_8(this$static.val$b, $replaceAll($replaceAll($replaceAll(chars, '&', '&amp;'), '<', '&lt;'), '>', '&gt;'));
}

function $elementEnd_3(this$static){
  var tag;
  if (this$static.elementPart != null) {
    $append_8(this$static.val$b, this$static.elementPart + '/>');
    this$static.elementPart = null;
    $remove_10(this$static.tags, this$static.tags.size - 1);
  }
   else {
    tag = dynamicCast($remove_10(this$static.tags, this$static.tags.size - 1), 1);
    $append_8(this$static.val$b, '<\/' + tag + '>');
  }
}

function $elementStart_4(this$static, type, attrs){
  if (this$static.elementPart != null) {
    $append_8(this$static.val$b, this$static.elementPart + '>');
    this$static.elementPart = null;
  }
  this$static.elementPart = '<' + type + (attrs.size_0() == 0?'':' ' + attributeString(attrs));
  $add_9(this$static.tags, type);
}

function $equal(a_0, b){
  return a_0 == null?b == null:$equals_3(a_0, b);
}

function DocOpUtil$3_0(val$b){
  this.val$b = val$b;
  this.currentAnnotations = new HashMap_0;
  this.changes = new TreeMap_0;
  this.tags = new ArrayList_0;
}

function DocOpUtil$3(){
}

_ = DocOpUtil$3_0.prototype = DocOpUtil$3.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_15(map){
  $annotationBoundary_2(this, map);
}
;
_.characters_0 = function characters_24(chars){
  $characters_4(this, chars);
}
;
_.elementEnd = function elementEnd_21(){
  $elementEnd_3(this);
}
;
_.elementStart = function elementStart_21(type, attrs){
  $elementStart_4(this, type, attrs);
}
;
_.getClass$ = function getClass_874(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_DocOpUtil$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.elementPart = null;
_.val$b = null;
function DocOpUtil$4_0(val$size){
  this.val$size = val$size;
}

function DocOpUtil$4(){
}

_ = DocOpUtil$4_0.prototype = DocOpUtil$4.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_16(map){
}
;
_.characters_0 = function characters_25(chars){
}
;
_.deleteCharacters = function deleteCharacters_27(chars){
  this.val$size[0] += chars.length;
}
;
_.deleteElementEnd = function deleteElementEnd_25(){
  ++this.val$size[0];
}
;
_.deleteElementStart = function deleteElementStart_25(type, attrs){
  ++this.val$size[0];
}
;
_.elementEnd = function elementEnd_22(){
}
;
_.elementStart = function elementStart_22(type, attrs){
}
;
_.getClass$ = function getClass_875(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_DocOpUtil$4_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_27(oldAttrs, newAttrs){
  ++this.val$size[0];
}
;
_.retain = function retain_23(itemCount){
  this.val$size[0] += itemCount;
}
;
_.updateAttributes = function updateAttributes_27(attrUpdate){
  ++this.val$size[0];
}
;
_.castableTypeMap$ = {};
_.val$size = null;
function DocOpUtil$5_0(val$size){
  this.val$size = val$size;
}

function DocOpUtil$5(){
}

_ = DocOpUtil$5_0.prototype = DocOpUtil$5.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_17(map){
}
;
_.characters_0 = function characters_26(chars){
  this.val$size[0] += chars.length;
}
;
_.deleteCharacters = function deleteCharacters_28(chars){
}
;
_.deleteElementEnd = function deleteElementEnd_26(){
}
;
_.deleteElementStart = function deleteElementStart_26(type, attrs){
}
;
_.elementEnd = function elementEnd_23(){
  ++this.val$size[0];
}
;
_.elementStart = function elementStart_23(type, attrs){
  ++this.val$size[0];
}
;
_.getClass$ = function getClass_876(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_DocOpUtil$5_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_28(oldAttrs, newAttrs){
  ++this.val$size[0];
}
;
_.retain = function retain_24(itemCount){
  this.val$size[0] += itemCount;
}
;
_.updateAttributes = function updateAttributes_28(attrUpdate){
  ++this.val$size[0];
}
;
_.castableTypeMap$ = {};
_.val$size = null;
function $clinit_1301(){
  $clinit_1301 = nullMethod;
  ILL_FORMED_0 = new DocOpValidator$IllFormed_0;
}

function isWellFormed(v, buffered){
  $clinit_1301();
  if (buffered.knownToBeWellFormed) {
    return true;
  }
   else {
    if (validate_1(v, ($clinit_1269() , NO_SCHEMA_CONSTRAINTS), ($clinit_1259() , EMPTY_DOCUMENT), buffered) == ($clinit_1267() , ILL_FORMED)) {
      return false;
    }
     else {
      buffered.knownToBeWellFormed = true;
      return true;
    }
  }
}

function validate_1(v, schema, doc, op){
  $clinit_1301();
  var $e0, a_0, accu;
  !schema && (schema = ($clinit_1269() , NO_SCHEMA_CONSTRAINTS));
  a_0 = new DocOpAutomaton_0(doc, schema);
  accu = initValues(_3Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$ValidationResult_2_classLit, {58:1, 138:1}, 114, [($clinit_1267() , VALID)]);
  try {
    op.apply_5(new DocOpValidator$1_0(accu, a_0, v));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 242)) {
      return ILL_FORMED;
    }
     else 
      throw $e0;
  }
  accu[0] = $mergeWith(accu[0], $checkFinish_0(a_0, v));
  return accu[0];
}

var ILL_FORMED_0;
function $abortIfIllFormed(this$static){
  if (this$static.val$accu[0] == ($clinit_1267() , ILL_FORMED)) {
    throw $clinit_1301() , ILL_FORMED_0;
  }
}

function DocOpValidator$1_0(val$accu, val$a, val$v){
  this.val$accu = val$accu;
  this.val$a = val$a;
  this.val$v = val$v;
}

function DocOpValidator$1(){
}

_ = DocOpValidator$1_0.prototype = DocOpValidator$1.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_18(map){
  this.val$accu[0] = $mergeWith(this.val$accu[0], $checkAnnotationBoundary(this.val$a, map, this.val$v));
  $abortIfIllFormed(this);
  $doAnnotationBoundary(this.val$a, map);
}
;
_.characters_0 = function characters_27(s){
  this.val$accu[0] = $mergeWith(this.val$accu[0], $checkCharacters_0(this.val$a, s, this.val$v));
  $abortIfIllFormed(this);
  $doCharacters_1(this.val$a, s);
}
;
_.deleteCharacters = function deleteCharacters_29(chars){
  this.val$accu[0] = $mergeWith(this.val$accu[0], $checkDeleteCharacters_0(this.val$a, chars, this.val$v));
  $abortIfIllFormed(this);
  $doDeleteCharacters_2(this.val$a, chars);
}
;
_.deleteElementEnd = function deleteElementEnd_27(){
  this.val$accu[0] = $mergeWith(this.val$accu[0], $checkDeleteElementEnd_0(this.val$a, this.val$v));
  $abortIfIllFormed(this);
  $doDeleteElementEnd_1(this.val$a);
}
;
_.deleteElementStart = function deleteElementStart_27(type, attrs){
  this.val$accu[0] = $mergeWith(this.val$accu[0], $checkDeleteElementStart_0(this.val$a, type, attrs, this.val$v));
  $abortIfIllFormed(this);
  $doDeleteElementStart_1(this.val$a);
}
;
_.elementEnd = function elementEnd_24(){
  this.val$accu[0] = $mergeWith(this.val$accu[0], $checkElementEnd_0(this.val$a, this.val$v));
  $abortIfIllFormed(this);
  $doElementEnd_1(this.val$a);
}
;
_.elementStart = function elementStart_24(type, attrs){
  this.val$accu[0] = $mergeWith(this.val$accu[0], $checkElementStart_0(this.val$a, type, attrs, this.val$v));
  $abortIfIllFormed(this);
  $doElementStart_1(this.val$a, type);
}
;
_.getClass$ = function getClass_877(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_DocOpValidator$1_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_29(oldAttrs, newAttrs){
  this.val$accu[0] = $mergeWith(this.val$accu[0], $checkReplaceAttributes(this.val$a, oldAttrs, newAttrs, this.val$v));
  $abortIfIllFormed(this);
  $doReplaceAttributes(this.val$a);
}
;
_.retain = function retain_25(itemCount){
  this.val$accu[0] = $mergeWith(this.val$accu[0], $checkRetain_0(this.val$a, itemCount, this.val$v));
  $abortIfIllFormed(this);
  $doRetain(this.val$a, itemCount);
}
;
_.updateAttributes = function updateAttributes_29(u){
  this.val$accu[0] = $mergeWith(this.val$accu[0], $checkUpdateAttributes(this.val$a, u, this.val$v));
  $abortIfIllFormed(this);
  $doUpdateAttributes_0(this.val$a);
}
;
_.castableTypeMap$ = {};
_.val$a = null;
_.val$accu = null;
_.val$v = null;
function DocOpValidator$IllFormed_0(){
  this.fillInStackTrace();
  this.detailMessage = 'Preallocated exception with a meaningless stack trace';
}

function DocOpValidator$IllFormed(){
}

_ = DocOpValidator$IllFormed_0.prototype = DocOpValidator$IllFormed.prototype = new RuntimeException;
_.fillInStackTrace = function fillInStackTrace_0(){
  return this;
}
;
_.getClass$ = function getClass_878(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_DocOpValidator$IllFormed_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1, 242:1};
function InitializationCursorAdapter_0(inner){
  this.inner = inner;
}

function InitializationCursorAdapter(){
}

_ = InitializationCursorAdapter_0.prototype = InitializationCursorAdapter.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_19(map){
  $annotationBoundary_2(this.inner, map);
}
;
_.characters_0 = function characters_28(chars){
  $characters_4(this.inner, chars);
}
;
_.deleteCharacters = function deleteCharacters_30(chars){
  throw new UnsupportedOperationException_1('deleteCharacters');
}
;
_.deleteElementEnd = function deleteElementEnd_28(){
  throw new UnsupportedOperationException_1('deleteElementEnd');
}
;
_.deleteElementStart = function deleteElementStart_28(type, attrs){
  throw new UnsupportedOperationException_1('deleteElementStart');
}
;
_.elementEnd = function elementEnd_25(){
  $elementEnd_3(this.inner);
}
;
_.elementStart = function elementStart_25(type, attrs){
  $elementStart_4(this.inner, type, attrs);
}
;
_.getClass$ = function getClass_879(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_InitializationCursorAdapter_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_30(oldAttrs, newAttrs){
  throw new UnsupportedOperationException_1('replaceAttributes');
}
;
_.retain = function retain_26(itemCount){
  throw new UnsupportedOperationException_1('retain');
}
;
_.updateAttributes = function updateAttributes_30(attrUpdate){
  throw new UnsupportedOperationException_1('updateAttributes');
}
;
_.castableTypeMap$ = {};
_.inner = null;
function OperationComponents$DocOpComponent(){
}

_ = OperationComponents$DocOpComponent.prototype = new Object_0;
_.getClass$ = function getClass_880(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DocOpComponent_2_classLit;
}
;
_.castableTypeMap$ = {117:1};
function OperationComponents$DocInitializationComponent(){
}

_ = OperationComponents$DocInitializationComponent.prototype = new OperationComponents$DocOpComponent;
_.apply_5 = function apply_66(c){
  this.apply_8(c);
}
;
_.getClass$ = function getClass_881(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DocInitializationComponent_2_classLit;
}
;
_.castableTypeMap$ = {116:1, 117:1};
function OperationComponents$AnnotationBoundary_0(boundary){
  this.boundary = boundary;
}

function OperationComponents$AnnotationBoundary(){
}

_ = OperationComponents$AnnotationBoundary_0.prototype = OperationComponents$AnnotationBoundary.prototype = new OperationComponents$DocInitializationComponent;
_.apply_8 = function apply_67(c){
  c.annotationBoundary(this.boundary);
}
;
_.getClass$ = function getClass_882(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$AnnotationBoundary_2_classLit;
}
;
_.castableTypeMap$ = {116:1, 117:1};
_.boundary = null;
function OperationComponents$Characters_0(string){
  this.string = string;
}

function OperationComponents$Characters(){
}

_ = OperationComponents$Characters_0.prototype = OperationComponents$Characters.prototype = new OperationComponents$DocInitializationComponent;
_.apply_8 = function apply_68(c){
  c.characters_0(this.string);
}
;
_.getClass$ = function getClass_883(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$Characters_2_classLit;
}
;
_.castableTypeMap$ = {116:1, 117:1};
_.string = null;
function OperationComponents$DeleteCharacters_0(string){
  this.string = string;
}

function OperationComponents$DeleteCharacters(){
}

_ = OperationComponents$DeleteCharacters_0.prototype = OperationComponents$DeleteCharacters.prototype = new OperationComponents$DocOpComponent;
_.apply_5 = function apply_69(c){
  c.deleteCharacters(this.string);
}
;
_.getClass$ = function getClass_884(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DeleteCharacters_2_classLit;
}
;
_.castableTypeMap$ = {117:1};
_.string = null;
function $clinit_1310(){
  $clinit_1310 = nullMethod;
  INSTANCE_14 = new OperationComponents$DeleteElementEnd_0;
}

function OperationComponents$DeleteElementEnd_0(){
}

function OperationComponents$DeleteElementEnd(){
}

_ = OperationComponents$DeleteElementEnd_0.prototype = OperationComponents$DeleteElementEnd.prototype = new OperationComponents$DocOpComponent;
_.apply_5 = function apply_70(c){
  c.deleteElementEnd();
}
;
_.getClass$ = function getClass_885(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DeleteElementEnd_2_classLit;
}
;
_.castableTypeMap$ = {117:1};
var INSTANCE_14;
function OperationComponents$DeleteElementStart_0(type, attrs){
  this.type_0 = type;
  this.attrs = attrs;
}

function OperationComponents$DeleteElementStart(){
}

--></script>
<script><!--
_ = OperationComponents$DeleteElementStart_0.prototype = OperationComponents$DeleteElementStart.prototype = new OperationComponents$DocOpComponent;
_.apply_5 = function apply_71(c){
  c.deleteElementStart(this.type_0, this.attrs);
}
;
_.getClass$ = function getClass_886(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DeleteElementStart_2_classLit;
}
;
_.castableTypeMap$ = {117:1};
_.attrs = null;
_.type_0 = null;
function $clinit_1312(){
  $clinit_1312 = nullMethod;
  INSTANCE_15 = new OperationComponents$ElementEnd_0;
}

function OperationComponents$ElementEnd_0(){
}

function OperationComponents$ElementEnd(){
}

_ = OperationComponents$ElementEnd_0.prototype = OperationComponents$ElementEnd.prototype = new OperationComponents$DocInitializationComponent;
_.apply_8 = function apply_72(c){
  c.elementEnd();
}
;
_.getClass$ = function getClass_887(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$ElementEnd_2_classLit;
}
;
_.castableTypeMap$ = {116:1, 117:1};
var INSTANCE_15;
function OperationComponents$ElementStart_0(type, attrs){
  this.type_0 = type;
  this.attrs = attrs;
}

function OperationComponents$ElementStart(){
}

_ = OperationComponents$ElementStart_0.prototype = OperationComponents$ElementStart.prototype = new OperationComponents$DocInitializationComponent;
_.apply_8 = function apply_73(c){
  c.elementStart(this.type_0, this.attrs);
}
;
_.getClass$ = function getClass_888(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$ElementStart_2_classLit;
}
;
_.castableTypeMap$ = {116:1, 117:1};
_.attrs = null;
_.type_0 = null;
function OperationComponents$ReplaceAttributes_0(oldAttrs, newAttrs){
  this.oldAttrs = oldAttrs;
  this.newAttrs = newAttrs;
}

function OperationComponents$ReplaceAttributes(){
}

_ = OperationComponents$ReplaceAttributes_0.prototype = OperationComponents$ReplaceAttributes.prototype = new OperationComponents$DocOpComponent;
_.apply_5 = function apply_74(c){
  c.replaceAttributes(this.oldAttrs, this.newAttrs);
}
;
_.getClass$ = function getClass_889(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$ReplaceAttributes_2_classLit;
}
;
_.castableTypeMap$ = {117:1};
_.newAttrs = null;
_.oldAttrs = null;
function OperationComponents$Retain_0(itemCount){
  this.itemCount = itemCount;
}

function OperationComponents$Retain(){
}

_ = OperationComponents$Retain_0.prototype = OperationComponents$Retain.prototype = new OperationComponents$DocOpComponent;
_.apply_5 = function apply_75(c){
  c.retain(this.itemCount);
}
;
_.getClass$ = function getClass_890(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$Retain_2_classLit;
}
;
_.castableTypeMap$ = {117:1};
_.itemCount = 0;
function OperationComponents$UpdateAttributes_0(update){
  this.update = update;
}

function OperationComponents$UpdateAttributes(){
}

_ = OperationComponents$UpdateAttributes_0.prototype = OperationComponents$UpdateAttributes.prototype = new OperationComponents$DocOpComponent;
_.apply_5 = function apply_76(c){
  c.updateAttributes(this.update);
}
;
_.getClass$ = function getClass_891(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$UpdateAttributes_2_classLit;
}
;
_.castableTypeMap$ = {117:1};
_.update = null;
function ImmutableStateMap$1_0(this$0){
  this.this$0 = this$0;
}

function ImmutableStateMap$1(){
}

_ = ImmutableStateMap$1_0.prototype = ImmutableStateMap$1.prototype = new AbstractSet;
_.getClass$ = function getClass_892(){
  return Lorg_waveprotocol_wave_model_document_operation_util_ImmutableStateMap$1_2_classLit;
}
;
_.iterator_0 = function iterator_21(){
  return new ImmutableStateMap$1$1_0(this);
}
;
_.size_0 = function size_34(){
  return this.this$0.attributes.size_0();
}
;
_.castableTypeMap$ = {40:1, 130:1};
_.this$0 = null;
function ImmutableStateMap$1$1_0(this$1){
  this.this$1 = this$1;
  this.iterator = this.this$1.this$0.attributes.iterator_0();
}

function ImmutableStateMap$1$1(){
}

_ = ImmutableStateMap$1$1_0.prototype = ImmutableStateMap$1$1.prototype = new Object_0;
_.getClass$ = function getClass_893(){
  return Lorg_waveprotocol_wave_model_document_operation_util_ImmutableStateMap$1$1_2_classLit;
}
;
_.hasNext = function hasNext_14(){
  return this.iterator.hasNext();
}
;
_.next_0 = function next_18(){
  return dynamicCast(this.iterator.next_0(), 221);
}
;
_.remove = function remove_38(){
  throw new UnsupportedOperationException_1('Attempt to modify an immutable set.');
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
function ImmutableStateMap$2_0(){
}

function ImmutableStateMap$2(){
}

_ = ImmutableStateMap$2_0.prototype = ImmutableStateMap$2.prototype = new Object_0;
_.compare = function compare_5(a_0, b){
  return compareTo_5(dynamicCast(a_0, 221).name_0, dynamicCast(b, 221).name_0);
}
;
_.getClass$ = function getClass_894(){
  return Lorg_waveprotocol_wave_model_document_operation_util_ImmutableStateMap$2_2_classLit;
}
;
_.castableTypeMap$ = {};
function $setValue_5(){
  throw new UnsupportedOperationException_1('Attempt to modify an immutable map entry.');
}

function ImmutableStateMap$Attribute_0(entry){
  ImmutableStateMap$Attribute_1.call(this, dynamicCast(entry.getKey(), 1), dynamicCast(entry.getValue(), 1));
}

function ImmutableStateMap$Attribute_1(name_0, value){
  checkNotNull_1(name_0, 'Null attribute name');
  checkNotNull_1(value, 'Null attribute value');
  this.name_0 = name_0;
  this.value_0 = value;
}

function ImmutableStateMap$Attribute(){
}

_ = ImmutableStateMap$Attribute_1.prototype = ImmutableStateMap$Attribute_0.prototype = ImmutableStateMap$Attribute.prototype = new Object_0;
_.equals$ = function equals_25(o){
  var entry;
  if (!(o != null && o.castableTypeMap$ && !!o.castableTypeMap$[66])) {
    return false;
  }
  entry = dynamicCast(o, 66);
  return (this.name_0 == null?entry.getKey() == null:$equals_3(this.name_0, entry.getKey())) && (this.value_0 == null?entry.getValue() == null:$equals_3(this.value_0, entry.getValue()));
}
;
_.getClass$ = function getClass_895(){
  return Lorg_waveprotocol_wave_model_document_operation_util_ImmutableStateMap$Attribute_2_classLit;
}
;
_.getKey = function getKey_4(){
  return this.name_0;
}
;
_.getValue = function getValue_6(){
  return this.value_0;
}
;
_.hashCode$ = function hashCode_25(){
  return (this.name_0 == null?0:getHashCode_0(this.name_0)) ^ (this.value_0 == null?0:getHashCode_0(this.value_0));
}
;
_.setValue = function setValue_4(value){
  return $setValue_5(dynamicCast(value, 1));
}
;
_.toString$ = function toString_69(){
  return 'Attribute(' + this.name_0 + '=' + this.value_0 + ')';
}
;
_.castableTypeMap$ = {66:1, 221:1};
_.name_0 = null;
_.value_0 = null;
function $compare_6(a_0, b){
  return compareTo_5(dynamicCast(a_0, 220).name_0, dynamicCast(b, 220).name_0);
}

function ImmutableUpdateMap$1_0(){
}

function ImmutableUpdateMap$1(){
}

_ = ImmutableUpdateMap$1_0.prototype = ImmutableUpdateMap$1.prototype = new Object_0;
_.compare = function compare_6(a_0, b){
  return compareTo_5(dynamicCast(a_0, 220).name_0, dynamicCast(b, 220).name_0);
}
;
_.getClass$ = function getClass_896(){
  return Lorg_waveprotocol_wave_model_document_operation_util_ImmutableUpdateMap$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function ImmutableUpdateMap$AttributeUpdate_0(name_0, oldValue, newValue){
  checkNotNull_1(name_0, 'Null name in AttributeUpdate');
  this.name_0 = name_0;
  this.oldValue = oldValue;
  this.newValue = newValue;
}

function ImmutableUpdateMap$AttributeUpdate(){
}

_ = ImmutableUpdateMap$AttributeUpdate_0.prototype = ImmutableUpdateMap$AttributeUpdate.prototype = new Object_0;
_.getClass$ = function getClass_897(){
  return Lorg_waveprotocol_wave_model_document_operation_util_ImmutableUpdateMap$AttributeUpdate_2_classLit;
}
;
_.toString$ = function toString_70(){
  return '[' + this.name_0 + ': ' + this.oldValue + ' -> ' + this.newValue + ']';
}
;
_.castableTypeMap$ = {220:1};
_.name_0 = null;
_.newValue = null;
_.oldValue = null;
function $ensure(condition, messages){
  var concatenated, i, toStr;
  if (!condition) {
    toStr = initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, messages.length, 0);
    for (i = 0; i < messages.length; ++i) {
      toStr[i] = '' + messages[i];
    }
    concatenated = join_0(toStr);
    throw new XmlParseException_2(concatenated);
  }
}

function $parse_0(this$static){
  var annotations, name_0, value;
  annotations = new ArrayList_0;
  while (this$static.offset < this$static.input.length) {
    name_0 = this$static.input.charCodeAt(this$static.offset) == 34?$quotedValue(this$static, 34):$quotedValue(this$static, 39);
    $ensure(name_0.indexOf('?') == -1, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['Invalid char ?: ', this$static.input]));
    $ensure(name_0.indexOf('@') == -1, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['Invalid char @: ', this$static.input]));
    if (this$static.offset < this$static.input.length && this$static.input.charCodeAt(this$static.offset) == 61) {
      ++this$static.offset;
      value = this$static.input.charCodeAt(this$static.offset) == 34?$quotedValue(this$static, 34):$quotedValue(this$static, 39);
      $add_9(annotations, new Pair_0(name_0, value));
    }
     else {
      $add_9(annotations, new Pair_0(name_0, null));
    }
    while (this$static.offset < this$static.input.length && this$static.input.charCodeAt(this$static.offset) == 32) {
      ++this$static.offset;
    }
  }
  return annotations;
}

function $quotedValue(this$static, quoteChar){
  var nextQuote, start, value;
  $ensure(this$static.input.charCodeAt(this$static.offset) == quoteChar, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['expected ', valueOf(quoteChar), ' at position ', valueOf_0(this$static.offset), ' in ', this$static.input]));
  ++this$static.offset;
  start = this$static.offset;
  while (true) {
    nextQuote = $indexOf_0(this$static.input, quoteChar, this$static.offset);
    $ensure(nextQuote != -1, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['closing ', valueOf(quoteChar), ' not found']));
    this$static.offset = nextQuote;
    if (this$static.input.charCodeAt(nextQuote - 1) != 92) {
      break;
    }
    ++this$static.offset;
  }
  value = $substring_0(this$static.input, start, this$static.offset);
  ++this$static.offset;
  return $replace_2($replace_2($replace_2($replaceAll($replaceAll($replaceAll(value, '&gt;', '>'), '&lt;', '<'), '&amp;', '&'), '\\q', '?'), '\\"', '"'), '\\\\', '\\');
}

function AnnotationParser_0(input){
  this.input = input;
  $ensure(($clinit_1490() , traverseUtf16String(input, VALID_UTF16).value_0), initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['Input is not valid UTF-16: ', input]));
}

function AnnotationParser(){
}

_ = AnnotationParser_0.prototype = AnnotationParser.prototype = new Object_0;
_.getClass$ = function getClass_898(){
  return Lorg_waveprotocol_wave_model_document_parser_AnnotationParser_2_classLit;
}
;
_.castableTypeMap$ = {};
_.input = null;
_.offset = 0;
function $getAttributes_4(this$static){
  checkState(this$static.type_0 == ($clinit_1327() , START_ELEMENT), 'Cursor not at element start');
  if (!this$static.attrs) {
    return $clinit_1445() , $clinit_1445() , EMPTY_MAP_2;
  }
  return this$static.attrs;
}

function $getProcessingInstructionName(this$static){
  checkState(this$static.type_0 == ($clinit_1327() , PROCESSING_INSTRUCTION), 'Cursor not at processing instruction');
  return this$static.name_0;
}

function $getProcessingInstructionValue(this$static){
  checkState(this$static.type_0 == ($clinit_1327() , PROCESSING_INSTRUCTION), 'Cursor not at processing instruction');
  return this$static.data_0;
}

function $getTagName_5(this$static){
  checkState(this$static.type_0 == ($clinit_1327() , START_ELEMENT) || this$static.type_0 == END_ELEMENT, 'Cursor not at element');
  return this$static.name_0;
}

function $getText(this$static){
  checkState(this$static.type_0 == ($clinit_1327() , TEXT), 'Cursor not at text');
  return this$static.data_0;
}

function $startElementToEndElement(this$static){
  checkState(this$static.type_0 == ($clinit_1327() , START_ELEMENT), 'Can only convert start elements to end elements');
  return new Item_0(END_ELEMENT, this$static.name_0, null, null);
}

function Item_0(type, name_0, attrs, data){
  var copy;
  this.type_0 = type;
  this.name_0 = name_0;
  this.attrs = !attrs || attrs.isEmpty()?null:($clinit_1445() , copy = new CollectionUtils$StringMapAdapter_0(new HashMap_0) , copy.backend.putAll(dynamicCast(attrs, 265).backend) , copy);
  this.data_0 = data;
}

function Item(){
}

_ = Item_0.prototype = Item.prototype = new Object_0;
_.getClass$ = function getClass_899(){
  return Lorg_waveprotocol_wave_model_document_parser_Item_2_classLit;
}
;
_.castableTypeMap$ = {};
_.attrs = null;
_.data_0 = null;
_.name_0 = null;
_.type_0 = null;
function $clinit_1327(){
  $clinit_1327 = nullMethod;
  START_ELEMENT = new ItemType_0('START_ELEMENT', 0);
  END_ELEMENT = new ItemType_0('END_ELEMENT', 1);
  TEXT = new ItemType_0('TEXT', 2);
  PROCESSING_INSTRUCTION = new ItemType_0('PROCESSING_INSTRUCTION', 3);
  $VALUES_51 = initValues(_3Lorg_waveprotocol_wave_model_document_parser_ItemType_2_classLit, {58:1, 138:1}, 118, [START_ELEMENT, END_ELEMENT, TEXT, PROCESSING_INSTRUCTION]);
}

function ItemType_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_52(){
  $clinit_1327();
  return $VALUES_51;
}

function ItemType(){
}

_ = ItemType_0.prototype = ItemType.prototype = new Enum;
_.getClass$ = function getClass_900(){
  return Lorg_waveprotocol_wave_model_document_parser_ItemType_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 118:1};
var $VALUES_51, END_ELEMENT, PROCESSING_INSTRUCTION, START_ELEMENT, TEXT;
function $clinit_1328(){
  $clinit_1328 = nullMethod;
  var tmp;
  tmp = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  checkNotNull_1('lt', 'StringMap cannot contain null keys');
  tmp.backend.put('lt', '<');
  checkNotNull_1('gt', 'StringMap cannot contain null keys');
  tmp.backend.put('gt', '>');
  checkNotNull_1('apos', 'StringMap cannot contain null keys');
  tmp.backend.put('apos', "'");
  checkNotNull_1('quot', 'StringMap cannot contain null keys');
  tmp.backend.put('quot', '"');
  checkNotNull_1('amp', 'StringMap cannot contain null keys');
  tmp.backend.put('amp', '&');
  entities = tmp;
  BASE_16_DIGITS = newStringSet(initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f', 'A', 'B', 'C', 'D', 'E', 'F']));
  BASE_10_DIGITS = newStringSet(initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9']));
}

function $attr(this$static){
  var attrName, attrValue;
  attrName = $name(this$static);
  if (attrName == null) {
    return null;
  }
  $ensure_0(this$static, $match_0(this$static, 61), initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['Matching =']));
  attrValue = $attrValue(this$static);
  $ensure_0(this$static, attrValue != null, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['Matching attr value']));
  return new Pair_0(attrName, attrValue);
}

function $attrList(this$static){
  var attr, ret;
  ret = null;
  $whitespace(this$static);
  while ($hasMore(this$static.buffer)) {
    attr = $attr(this$static);
    if (!attr) {
      break;
    }
     else {
      ret = ret?ret:($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
      ret.put_0(dynamicCast(attr.first, 1), dynamicCast(attr.second, 1));
    }
    $whitespace(this$static);
  }
  return ret;
}

function $attrValue(this$static){
  if ($match_0(this$static, 34)) {
    return $attrValueInner(this$static, 34);
  }
   else if ($match_0(this$static, 39)) {
    return $attrValueInner(this$static, 39);
  }
   else {
    throw new XmlParseException_2('Cannot match opening quote ' + this$static.buffer.position_0);
  }
}

function $attrValueInner(this$static, quote){
  var end, except, reference, ret, start, val;
  except = initValues(_3C_classLit, {58:1}, -1, [60, 38, quote]);
  ret = new StringBuilder_0;
  while (true) {
    start = this$static.buffer.position_0;
    while (!$contains_6(except, $peek_1(this$static.buffer))) {
      $advanceCodePoint(this$static.buffer);
    }
    end = this$static.buffer.position_0;
    if (start != end) {
      $append_8(ret, $substring_0(this$static.buffer.str, start, end));
      continue;
    }
    reference = $reference(this$static);
    if (reference != null) {
      ret.impl.string += reference;
      continue;
    }
    $ensure_0(this$static, $match_0(this$static, quote), initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['matching closing quote']));
    val = ret.impl.string;
    $ensure_0(this$static, ($clinit_1490() , traverseUtf16String(val, VALID_UTF16).value_0), initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['Not valid UTF-16: ' + val]));
    return val;
  }
}

function $charData(this$static){
  var end, except, start;
  except = initValues(_3C_classLit, {58:1}, -1, [60, 38]);
  start = this$static.buffer.position_0;
  while ($hasMore(this$static.buffer)) {
    if ($contains_6(except, $peek_1(this$static.buffer))) {
      break;
    }
     else {
      $advanceCodePoint(this$static.buffer);
    }
  }
  end = this$static.buffer.position_0;
  return start == end?null:$substring_0(this$static.buffer.str, start, end);
}

function $charReference(this$static){
  var $e0, base, codePoint, e, end, number, ret, start, validDigits;
  if ($match(this$static, '&#')) {
    if ($match_0(this$static, 120)) {
      base = 16;
      validDigits = BASE_16_DIGITS;
    }
     else {
      base = 10;
      validDigits = BASE_10_DIGITS;
    }
    start = this$static.buffer.position_0;
    while ($contains_7(validDigits, '' + String.fromCharCode($peek_1(this$static.buffer) & 65535))) {
      this$static.buffer.position_0 += 1;
    }
    end = this$static.buffer.position_0;
    $ensure_0(this$static, start != end, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['empty char reference']));
    number = $substring_0(this$static.buffer.str, start, end);
    try {
      codePoint = __parseAndValidateInt(number, base);
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 147)) {
        e = $e0;
        throw new XmlParseException_1('Could not parse number: ' + number, e);
      }
       else 
        throw $e0;
    }
    $ensure_0(this$static, ($clinit_1490() , 0 <= codePoint && codePoint <= 1114111), initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['Not a codepoint: ' + (base == 16?'0x':'') + number]));
    ret = String.fromCharCode.apply(null, toChars(codePoint));
    $ensure_0(this$static, $match_0(this$static, 59), initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['Must match ; at end of charReference']));
    return ret;
  }
  return null;
}

function $contains_6(except, c){
  var i, i$index, i$max;
  for (i$index = 0 , i$max = except.length; i$index < i$max; ++i$index) {
    i = except[i$index];
    if (i == c) {
      return true;
    }
  }
  return false;
}

function $ensure_0(this$static, condition, messages){
  var builder, m_0, m$index, m$max;
  if (!condition) {
    builder = new StringBuilder_0;
    builder.impl.string += 'message: ';
    for (m$index = 0 , m$max = messages.length; m$index < m$max; ++m$index) {
      m_0 = messages[m$index];
      $append_8(builder, dynamicCast(m_0, 1));
    }
    builder.impl.string += ', at position: ';
    $append_6(builder, this$static.buffer.position_0);
    throw new XmlParseException_2(builder.impl.string);
  }
}

function $entityReference(this$static){
  var entityAsString, entityName;
  if ($match_0(this$static, 38)) {
    entityName = $name(this$static);
    $ensure_0(this$static, entityName != null, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['parsing entity name']));
    $ensure_0(this$static, $match_0(this$static, 59), initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['matching ; on entity']));
    entityAsString = dynamicCast($get_12(entities, entityName), 1);
    if (entityAsString != null) {
      return entityAsString;
    }
     else {
      throw new XmlParseException_2('entity name not recognised: ' + entityName);
    }
  }
   else {
    return null;
  }
}

function $getTextChunk(this$static){
  var b, c, r, val;
  b = new StringBuffer_0;
  while (true) {
    c = $charData(this$static);
    if (c != null) {
      b.impl.string += c;
      continue;
    }
    r = $reference(this$static);
    if (r != null) {
      b.impl.string += r;
      continue;
    }
    if (b.impl.string.length > 0) {
      val = b.impl.string;
      $ensure_0(this$static, ($clinit_1490() , traverseUtf16String(val, VALID_UTF16).value_0), initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['Not valid UTF-16: ' + val]));
      return new Item_0(($clinit_1327() , TEXT), null, null, val);
    }
     else {
      return null;
    }
  }
}

function $isWhiteSpaceChar(c){
  return 32 == c || 9 == c || 10 == c || 13 == c;
}

function $isXmlNameChar(codePoint){
  var $e0, e;
  try {
    return isXmlNameChar_0(codePoint);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 4)) {
      e = $e0;
      throw new XmlParseException_0(e);
    }
     else 
      throw $e0;
  }
}

function $isXmlNameStartChar(codePoint){
  var $e0, e;
  try {
    return $clinit_1490() , codePoint == 58 || 65 <= codePoint && codePoint <= 90 || codePoint == 95 | (97 <= codePoint && codePoint <= 122) || 192 <= codePoint && codePoint <= 214 || 216 <= codePoint && codePoint <= 246 || 248 <= codePoint && codePoint <= 767 || 880 <= codePoint && codePoint <= 893 || 895 <= codePoint && codePoint <= 8191 || 8204 <= codePoint && codePoint <= 8205 || 8304 <= codePoint && codePoint <= 8591 || 11264 <= codePoint && codePoint <= 12271 || 12289 <= codePoint && codePoint <= 55295 || 63744 <= codePoint && codePoint <= 64975 || 65008 <= codePoint && codePoint <= 65533 || 65536 <= codePoint && codePoint <= 983039 && isCodePointValid(codePoint);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 4)) {
      e = $e0;
      throw new XmlParseException_0(e);
    }
     else 
      throw $e0;
  }
}

function $match(this$static, t){
  if ($startsWith(this$static.buffer, t)) {
    this$static.buffer.position_0 += t.length;
    return true;
  }
   else {
    return false;
  }
}

function $match_0(this$static, t){
  var $e0, e;
  if (!$hasMore(this$static.buffer)) {
    return false;
  }
  try {
    if ($peek_1(this$static.buffer) == t) {
      this$static.buffer.position_0 += 1;
      return true;
    }
     else {
      return false;
    }
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 203)) {
      e = $e0;
      throw new RuntimeException_2('Impossible, as buffer has more: ', e);
    }
     else 
      throw $e0;
  }
}

function $name(this$static){
  var end, start;
  start = this$static.buffer.position_0;
  if (!$isXmlNameStartChar($peek_1(this$static.buffer))) {
    return null;
  }
  this$static.buffer.position_0 += 1;
  while ($isXmlNameChar($peek_1(this$static.buffer))) {
    this$static.buffer.position_0 += 1;
  }
  end = this$static.buffer.position_0;
  return $substring_0(this$static.buffer.str, start, end);
}

function $next_16(this$static){
  var closingName, matchingStart;
  if (!($hasMore(this$static.buffer) || this$static.atSelfClosingStart)) {
    throw new NoSuchElementException_0;
  }
  if (this$static.atSelfClosingStart) {
    this$static.atSelfClosingStart = false;
    this$static.current = $startElementToEndElement(this$static.current);
  }
   else {
    $hasMore(this$static.buffer)?(this$static.current = $startsWith(this$static.buffer, '<?')?$processingInstruction(this$static):$startsWith(this$static.buffer, '<\/')?($ensure_0(this$static, $match(this$static, '<\/'), initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['Matching <\/'])) , closingName = $name(this$static) , $ensure_0(this$static, closingName != null, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['Matching name'])) , $whitespace(this$static) , $ensure_0(this$static, $match_0(this$static, 62), initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['Matching >'])) , $ensure_0(this$static, this$static.elementTagStack.arrayList.size != 0, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['no matching start tag'])) , matchingStart = dynamicCast($pop(this$static.elementTagStack), 1) , $ensure_0(this$static, $equals_3(matchingStart, closingName), initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['start and end tag mismatch, start: ' + matchingStart + ' end: ' + closingName])) , new Item_0(($clinit_1327() , END_ELEMENT), closingName, null, null)):$peek_1(this$static.buffer) == 60?$startTag(this$static):$getTextChunk(this$static)):(this$static.current = null);
  }
  $hasMore(this$static.buffer) || this$static.atSelfClosingStart || $ensure_0(this$static, this$static.elementTagStack.arrayList.size == 0, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['Start tags not closed, ' + this$static.elementTagStack.arrayList.size]));
  return !this$static.current?null:this$static.current.type_0;
}

function $processingInstruction(this$static){
  var end, name_0, start;
  $ensure_0(this$static, $match(this$static, '<?'), initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['Matching <?']));
  name_0 = $name(this$static);
  $ensure_0(this$static, name_0 != null, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['Processing instruction target must start with a valid xml nameStartChar, but instead encountered: ' + String.fromCharCode($peek_1(this$static.buffer) & 65535)]));
  $whitespace(this$static);
  start = this$static.buffer.position_0;
  while ($hasMore(this$static.buffer) && !$startsWith(this$static.buffer, '?>')) {
    this$static.buffer.position_0 += 1;
  }
  end = this$static.buffer.position_0;
  $ensure_0(this$static, $match(this$static, '?>'), initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['Matching ?>']));
  return new Item_0(($clinit_1327() , PROCESSING_INSTRUCTION), name_0, null, $substring_0(this$static.buffer.str, start, end));
}

function $reference(this$static){
  var charReference, entityReference;
  charReference = $charReference(this$static);
  if (charReference != null) {
    return charReference;
  }
  entityReference = $entityReference(this$static);
  if (entityReference != null) {
    return entityReference;
  }
  return null;
}

function $startTag(this$static){
  var attrList, tagName;
  $ensure_0(this$static, $match_0(this$static, 60), initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['Matching <']));
  tagName = $name(this$static);
  $ensure_0(this$static, tagName != null, initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, ['Matching name']));
  attrList = $attrList(this$static);
  $whitespace(this$static);
  if ($match(this$static, '/>')) {
    this$static.atSelfClosingStart = true;
    return new Item_0(($clinit_1327() , START_ELEMENT), tagName, attrList, null);
  }
   else if ($match_0(this$static, 62)) {
    $add_9(this$static.elementTagStack.arrayList, tagName);
    return new Item_0(($clinit_1327() , START_ELEMENT), tagName, attrList, null);
  }
   else {
    throw new XmlParseException_2('Matching > or />');
  }
}

function $whitespace(this$static){
  var end, start;
  start = this$static.buffer.position_0;
  if (!$isWhiteSpaceChar($peek_1(this$static.buffer))) {
    return null;
  }
  while ($hasMore(this$static.buffer) && $isWhiteSpaceChar($peek_1(this$static.buffer))) {
    this$static.buffer.position_0 += 1;
  }
  end = this$static.buffer.position_0;
  return $substring_0(this$static.buffer.str, start, end);
}

function StreamingXmlParser_0(xml){
  $clinit_1328();
  this.elementTagStack = new Stack_0;
  $clinit_1490();
  if (traverseUtf16String(xml, VALID_UTF16).value_0) {
    this.buffer = new StreamingXmlParser$Buffer_0(xml);
  }
   else {
    throw new XmlParseException_2('Input is not valid UTF-16: ' + xml);
  }
}

function StreamingXmlParser(){
}

_ = StreamingXmlParser_0.prototype = StreamingXmlParser.prototype = new Object_0;
_.getClass$ = function getClass_901(){
  return Lorg_waveprotocol_wave_model_document_parser_StreamingXmlParser_2_classLit;
}
;
_.castableTypeMap$ = {};
_.atSelfClosingStart = false;
_.buffer = null;
_.current = null;
var BASE_10_DIGITS, BASE_16_DIGITS, entities = null;
function $advanceCodePoint(this$static){
  isHighSurrogate(this$static.str.charCodeAt(this$static.position_0))?(this$static.position_0 += 2):++this$static.position_0;
}

function $hasMore(this$static){
  var hasMore;
  hasMore = this$static.position_0 != this$static.str.length;
  return hasMore;
}

function $peek_1(this$static){
  if (this$static.position_0 >= this$static.str.length) {
    throw new XmlParseException_2('Reading past end of input.');
  }
  return $codePointAt(this$static.str, this$static.position_0);
}

function $startsWith(this$static, s){
  var i;
  if (this$static.str.length < this$static.position_0 + s.length) {
    return false;
  }
  for (i = 0; i < s.length; ++i) {
    if (s.charCodeAt(i) != this$static.str.charCodeAt(i + this$static.position_0)) {
      return false;
    }
  }
  return true;
}

function StreamingXmlParser$Buffer_0(str){
  this.str = str;
}

function StreamingXmlParser$Buffer(){
}

_ = StreamingXmlParser$Buffer_0.prototype = StreamingXmlParser$Buffer.prototype = new Object_0;
--></script>
<script><!--
_.getClass$ = function getClass_902(){
  return Lorg_waveprotocol_wave_model_document_parser_StreamingXmlParser$Buffer_2_classLit;
}
;
_.castableTypeMap$ = {};
_.position_0 = 0;
_.str = null;
function XmlParseException_0(t){
  Exception_3.call(this, t);
}

function XmlParseException_1(message, t){
  this.fillInStackTrace();
  this.cause = t;
  this.detailMessage = message;
}

function XmlParseException_2(message){
  this.fillInStackTrace();
  this.detailMessage = message;
}

function XmlParseException(){
}

_ = XmlParseException_2.prototype = XmlParseException_1.prototype = XmlParseException_0.prototype = XmlParseException.prototype = new Exception;
_.getClass$ = function getClass_903(){
  return Lorg_waveprotocol_wave_model_document_parser_XmlParseException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 58:1, 143:1, 203:1};
function Node_1(){
}

_ = Node_1.prototype = new Object_0;
_.getClass$ = function getClass_904(){
  return Lorg_waveprotocol_wave_model_document_raw_impl_Node_2_classLit;
}
;
_.castableTypeMap$ = {245:1};
_.firstChild_0 = null;
_.indexingContainer = null;
_.lastChild_0 = null;
_.nextSibling_0 = null;
_.parent_0 = null;
_.previousSibling_0 = null;
function $constructMaps(this$static){
  this$static.backingAttributeMap = new TreeMap_0;
  this$static.publicAttributeMap = ($clinit_430() , new Collections$UnmodifiableMap_0(this$static.backingAttributeMap));
}

function $insertBefore_7(this$static, newChild, refChild){
  var childBefore;
  !!newChild.parent_0 && $removeChild_4(newChild.parent_0, newChild);
  if (refChild) {
    childBefore = refChild.previousSibling_0;
    refChild.previousSibling_0 = newChild;
  }
   else {
    childBefore = this$static.lastChild_0;
    this$static.lastChild_0 = newChild;
  }
  childBefore?(childBefore.nextSibling_0 = newChild):(this$static.firstChild_0 = newChild);
  newChild.parent_0 = this$static;
  newChild.previousSibling_0 = childBefore;
  newChild.nextSibling_0 = refChild;
  return newChild;
}

function $removeChild_4(this$static, oldChild){
  var siblingAfter, siblingBefore;
  if (oldChild.parent_0 != this$static) {
    throw new IllegalArgumentException_1('removeChild: oldChild is not child of parent');
  }
  siblingBefore = oldChild.previousSibling_0;
  siblingAfter = oldChild.nextSibling_0;
  siblingBefore?(siblingBefore.nextSibling_0 = siblingAfter):(this$static.firstChild_0 = siblingAfter);
  siblingAfter?(siblingAfter.previousSibling_0 = siblingBefore):(this$static.lastChild_0 = siblingBefore);
  oldChild.previousSibling_0 = null;
  oldChild.nextSibling_0 = null;
  oldChild.parent_0 = null;
  return oldChild;
}

function $setAttribute_4(this$static, name_0, value){
  !this$static.backingAttributeMap && (this$static.backingAttributeMap = new TreeMap_0 , this$static.publicAttributeMap = ($clinit_430() , new Collections$UnmodifiableMap_0(this$static.backingAttributeMap)));
  $put_0(this$static.backingAttributeMap, name_0, value);
}

function Element_2(tagName){
  this.tagName_0 = tagName;
}

function Element_1(){
}

_ = Element_2.prototype = Element_1.prototype = new Node_1;
_.asElement_1 = function asElement_7(){
  return this;
}
;
_.asText_1 = function asText_7(){
  return null;
}
;
_.getClass$ = function getClass_905(){
  return Lorg_waveprotocol_wave_model_document_raw_impl_Element_2_classLit;
}
;
_.getNodeType = function getNodeType_6(){
  return 1;
}
;
_.toString$ = function toString_71(){
  return $appendNode_0(new XmlStringBuilderDoc_0(new RawDocumentImpl_0('x', ($clinit_1145() , EMPTY_MAP_0)), ($clinit_1271() , ANY)), this).builder.impl.string;
}
;
_.castableTypeMap$ = {244:1, 245:1};
_.backingAttributeMap = null;
_.publicAttributeMap = null;
_.tagName_0 = null;
function $asElement_6(node){
  return node?node.asElement_1():null;
}

function $asText_5(node){
  return node?node.asText_1():null;
}

function $createElement_9(tagName, attributes, parentElement, nodeAfter){
  var el;
  el = $createElement_10(tagName, attributes);
  $insertBefore_7(parentElement, el, nodeAfter);
  return el;
}

function $createElement_10(tagName, attributes){
  var attribute, attribute$iterator, element;
  element = new Element_2(tagName);
  for (attribute$iterator = new ImmutableStateMap$1$1_0(attributes.entrySet); attribute$iterator.iterator.hasNext();) {
    attribute = dynamicCast(attribute$iterator.iterator.next_0(), 221);
    $setAttribute_4(element, attribute.name_0, attribute.value_0);
  }
  return element;
}

function $createTextNode_6(data, parentElement, nodeAfter){
  var node;
  node = new Text_2(data);
  $insertBefore_7(parentElement, node, nodeAfter);
  return node;
}

function $deleteData_3(textNode, offset, count){
  textNode.data_0 = textNode.data_0.substr(0, offset - 0) + $substring(textNode.data_0, offset + count);
}

function $getAttribute_6(element, name_0){
  var entry;
  return !element.backingAttributeMap?null:dynamicCast((!element.backingAttributeMap && $constructMaps(element) , entry = $getEntry(element.backingAttributeMap, name_0) , entry?entry.value_0:null), 1);
}

function $getAttributes_5(element){
  return !element.publicAttributeMap && (element.backingAttributeMap = new TreeMap_0 , element.publicAttributeMap = ($clinit_430() , new Collections$UnmodifiableMap_0(element.backingAttributeMap))) , element.publicAttributeMap;
}

function $insertData_4(textNode, offset, arg){
  textNode.data_0 = textNode.data_0.substr(0, offset - 0) + arg + $substring(textNode.data_0, offset);
}

function $removeAttribute_3(element, name_0){
  !element.backingAttributeMap && $constructMaps(element);
  $remove_17(element.backingAttributeMap, name_0);
}

function $setAttribute_5(element, name_0, value){
  checkNotNull_1(value, 'Null attribute value in setAttribute');
  !element.backingAttributeMap && $constructMaps(element);
  $put_0(element.backingAttributeMap, name_0, value);
}

function RawDocumentImpl_0(tagName, attributes){
  this.documentElement_0 = $createElement_10(tagName, attributes);
}

function RawDocumentImpl(){
}

_ = RawDocumentImpl_0.prototype = RawDocumentImpl.prototype = new Object_0;
_.appendData = function appendData_1(textNode, arg){
  dynamicCast(textNode, 243).data_0 += arg;
}
;
_.asElement_0 = function asElement_8(node){
  return $asElement_6(dynamicCast(node, 245));
}
;
_.asText_0 = function asText_8(node){
  return $asText_5(dynamicCast(node, 245));
}
;
_.createElement_0 = function createElement_5(tagName, attributes, parentElement, nodeAfter){
  return $createElement_9(tagName, attributes, dynamicCast(parentElement, 244), dynamicCast(nodeAfter, 245));
}
;
_.createTextNode_0 = function createTextNode_3(data, parentElement, nodeAfter){
  return $createTextNode_6(data, dynamicCast(parentElement, 244), dynamicCast(nodeAfter, 245));
}
;
_.deleteData_0 = function deleteData_1(textNode, offset, count){
  $deleteData_3(dynamicCast(textNode, 243), offset, count);
}
;
_.getAttribute_0 = function getAttribute_4(element, name_0){
  return $getAttribute_6(dynamicCast(element, 244), name_0);
}
;
_.getAttributes = function getAttributes_4(element){
  return $getAttributes_5(dynamicCast(element, 244));
}
;
_.getClass$ = function getClass_906(){
  return Lorg_waveprotocol_wave_model_document_raw_impl_RawDocumentImpl_2_classLit;
}
;
_.getData = function getData_4(textNode){
  return dynamicCast(textNode, 243).data_0;
}
;
_.getDocumentElement = function getDocumentElement_6(){
  return this.documentElement_0;
}
;
_.getFirstChild_0 = function getFirstChild_9(node){
  return dynamicCast(node, 245).firstChild_0;
}
;
_.getIndexingContainer = function getIndexingContainer_1(domNode){
  return dynamicCast(domNode, 245).indexingContainer;
}
;
_.getLastChild_0 = function getLastChild_9(node){
  return dynamicCast(node, 245).lastChild_0;
}
;
_.getLength = function getLength_4(textNode){
  return dynamicCast(textNode, 243).data_0.length;
}
;
_.getNextSibling = function getNextSibling_7(node){
  return dynamicCast(node, 245).nextSibling_0;
}
;
_.getNodeType_0 = function getNodeType_7(node){
  return dynamicCast(node, 245).getNodeType();
}
;
_.getParentElement = function getParentElement_5(node){
  return dynamicCast(node, 245).parent_0;
}
;
_.getPreviousSibling = function getPreviousSibling_7(node){
  return dynamicCast(node, 245).previousSibling_0;
}
;
_.getTagName = function getTagName_4(element){
  return dynamicCast(element, 244).tagName_0;
}
;
_.insertData_0 = function insertData_2(textNode, offset, arg){
  $insertData_4(dynamicCast(textNode, 243), offset, arg);
}
;
_.isSameNode = function isSameNode_4(node, other){
  return dynamicCast(node, 245) == dynamicCast(other, 245);
}
;
_.removeAttribute_0 = function removeAttribute_1(element, name_0){
  $removeAttribute_3(dynamicCast(element, 244), name_0);
}
;
_.removeChild_0 = function removeChild_2(parent_0, oldChild){
  $removeChild_4(dynamicCast(parent_0, 244), dynamicCast(oldChild, 245));
}
;
_.setAttribute_0 = function setAttribute_1(element, name_0, value){
  $setAttribute_5(dynamicCast(element, 244), name_0, value);
}
;
_.setIndexingContainer = function setIndexingContainer_1(domNode, indexingContainer){
  dynamicCast(domNode, 245).indexingContainer = indexingContainer;
}
;
_.splitText_0 = function splitText_3(textNode, offset){
  return $splitText_6(dynamicCast(textNode, 243), offset);
}
;
_.toString$ = function toString_72(){
  return createNode(this, this.documentElement_0).builder.impl.string;
}
;
_.castableTypeMap$ = {109:1};
_.documentElement_0 = null;
function $splitText_6(this$static, offset){
  var newNode, splitOffText;
  if (offset == 0) {
    return this$static;
  }
   else if (offset >= this$static.data_0.length) {
    return null;
  }
  splitOffText = $substring(this$static.data_0, offset);
  this$static.data_0 = this$static.data_0.substr(0, offset - 0);
  newNode = new Text_2(splitOffText);
  $insertBefore_7(this$static.parent_0, newNode, this$static.nextSibling_0);
  return newNode;
}

function Text_2(data){
  this.data_0 = data;
}

function Text_1(){
}

_ = Text_2.prototype = Text_1.prototype = new Node_1;
_.asElement_1 = function asElement_9(){
  return null;
}
;
_.asText_1 = function asText_9(){
  return this;
}
;
_.getClass$ = function getClass_907(){
  return Lorg_waveprotocol_wave_model_document_raw_impl_Text_2_classLit;
}
;
_.getNodeType = function getNodeType_8(){
  return 3;
}
;
_.toString$ = function toString_73(){
  return this.data_0;
}
;
_.castableTypeMap$ = {243:1, 245:1};
_.data_0 = null;
function $mapToString_0(map){
  var buf, first;
  buf = new StringBuilder_2('{');
  first = initValues(_3Z_classLit, {58:1}, -1, [true]);
  map.each(new AnnotationIntervalImpl$1_0(first, buf));
  buf.impl.string += '}';
  return buf.impl.string;
}

function $set_4(this$static, start, end, annotations, diffFromPrevious){
  checkPositionIndexesInRange(start, end, 2147483647);
  checkNotNull_1(annotations, 'annotations must not be null');
  checkNotNull_1(diffFromPrevious, 'diffFromPrevious must not be null');
  if (start >= end) {
    throw new IllegalArgumentException_1('Attempt to set AnnotationInterval to zero length');
  }
  this$static.start = start;
  this$static.end = end;
  this$static.annotations = annotations;
  this$static.diffFromLeft = diffFromPrevious;
}

function AnnotationIntervalImpl_0(start, end, annotations, diffFromLeft){
  $set_4(this, start, end, annotations, diffFromLeft);
}

function AnnotationIntervalImpl(){
}

_ = AnnotationIntervalImpl_0.prototype = AnnotationIntervalImpl.prototype = new Object_0;
_.getClass$ = function getClass_908(){
  return Lorg_waveprotocol_wave_model_document_util_AnnotationIntervalImpl_2_classLit;
}
;
_.toString$ = function toString_74(){
  return 'AnnotationIntervalImpl(' + this.start + ', ' + this.end + ', ' + $mapToString_0(this.annotations) + ', ' + $mapToString_0(this.diffFromLeft) + ')';
}
;
_.castableTypeMap$ = {219:1};
_.annotations = null;
_.diffFromLeft = null;
_.end = 0;
_.start = 0;
function AnnotationIntervalImpl$1_0(val$first, val$buf){
  this.val$first = val$first;
  this.val$buf = val$buf;
}

function AnnotationIntervalImpl$1(){
}

_ = AnnotationIntervalImpl$1_0.prototype = AnnotationIntervalImpl$1.prototype = new Object_0;
_.apply_0 = function apply_77(key, value){
  this.val$first[0]?(this.val$first[0] = false):$append_8(this.val$buf, ', ');
  $append_8(this.val$buf, key + '=' + value);
}
;
_.getClass$ = function getClass_909(){
  return Lorg_waveprotocol_wave_model_document_util_AnnotationIntervalImpl$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$buf = null;
_.val$first = null;
function validatePrefix(prefix){
  if (prefix == null) {
    throw new IllegalArgumentException_1('Prefix cannot be null');
  }
  if ($equals_3('', prefix)) {
    throw new IllegalArgumentException_1('Cannot register handler on root prefix');
  }
  if (prefix.indexOf('/') == 0 || prefix.indexOf('?') == 0) {
    throw new IllegalArgumentException_1('Illegal initial character: ' + String.fromCharCode(prefix.charCodeAt(0)));
  }
  if (prefix.lastIndexOf('/') != -1 && prefix.lastIndexOf('/') == prefix.length - '/'.length) {
    throw new IllegalArgumentException_1('Illegal final character: ' + String.fromCharCode(prefix.charCodeAt(0)));
  }
}

function $clinit_1342(){
  $clinit_1342 = nullMethod;
  handlerDataDomain_0 = new AnnotationRegistryImpl$1_0;
  ROOT_0 = new AnnotationRegistryImpl_0;
}

function $getBehaviours(this$static, prefix){
  var behaviours, parts;
  parts = prefix + '/';
  behaviours = dynamicCast(this$static.data_0.roCache, 162).behaviours;
  return new AnnotationRegistryImpl$3_0(parts, behaviours);
}

function $getClosestBehaviour(this$static, key){
  var behaviours, closest, behaviours_0, parts, ret;
  closest = null;
  behaviours = (parts = key + '/' , behaviours_0 = dynamicCast(this$static.data_0.roCache, 162).behaviours , new AnnotationRegistryImpl$3_0(parts, behaviours_0));
  while (behaviours.next) {
    closest = (ret = behaviours.next , $getNext_1(behaviours) , ret);
  }
  return closest;
}

function $getHandlers(this$static, prefix){
  var handlers, parts;
  parts = prefix + '/';
  handlers = dynamicCast(this$static.data_0.roCache, 162).handlers;
  return new AnnotationRegistryImpl$2_0(parts, handlers);
}

function $registerBehaviour(this$static, prefix, behaviour){
  validatePrefix(prefix);
  $put_5(dynamicCast($modify_0(this$static.data_0), 162).behaviours, prefix, behaviour);
}

function $registerHandler(this$static, prefix, handler){
  validatePrefix(prefix);
  $put_5(dynamicCast($modify_0(this$static.data_0), 162).handlers, prefix, handler);
}

function AnnotationRegistryImpl_0(){
  this.data_0 = new ChainedData_0(handlerDataDomain_0);
}

function AnnotationRegistryImpl(){
}

_ = AnnotationRegistryImpl_0.prototype = AnnotationRegistryImpl.prototype = new Object_0;
_.getClass$ = function getClass_910(){
  return Lorg_waveprotocol_wave_model_document_util_AnnotationRegistryImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.data_0 = null;
var ROOT_0, handlerDataDomain_0;
function AnnotationRegistryImpl$1_0(){
}

function AnnotationRegistryImpl$1(){
}

_ = AnnotationRegistryImpl$1_0.prototype = AnnotationRegistryImpl$1.prototype = new Object_0;
_.empty = function empty_1(){
  return new AnnotationRegistryImpl$HandlerData_0;
}
;
_.getClass$ = function getClass_911(){
  return Lorg_waveprotocol_wave_model_document_util_AnnotationRegistryImpl$1_2_classLit;
}
;
_.readOnlyView = function readOnlyView_1(modifiable){
  return dynamicCast(modifiable, 162);
}
;
_.castableTypeMap$ = {};
function $getNext_0(this$static){
  var handler;
  while ((this$static.fromIndex = $indexOf_0(this$static.val$parts, 47, this$static.fromIndex + 1)) != -1) {
    handler = dynamicCast($get_12(this$static.val$handlers, this$static.val$parts.substr(0, this$static.fromIndex - 0)), 246);
    if (handler) {
      this$static.next = handler;
      return;
    }
  }
  this$static.next = null;
}

function AnnotationRegistryImpl$2_0(val$parts, val$handlers){
  this.val$parts = val$parts;
  this.val$handlers = val$handlers;
  $getNext_0(this);
}

function AnnotationRegistryImpl$2(){
}

_ = AnnotationRegistryImpl$2_0.prototype = AnnotationRegistryImpl$2.prototype = new Object_0;
_.getClass$ = function getClass_912(){
  return Lorg_waveprotocol_wave_model_document_util_AnnotationRegistryImpl$2_2_classLit;
}
;
_.hasNext = function hasNext_15(){
  return !!this.next;
}
;
_.next_0 = function next_19(){
  var ret;
  return ret = this.next , $getNext_0(this) , ret;
}
;
_.remove = function remove_39(){
  throw new UnsupportedOperationException_1('getHandlers iterator: remove');
}
;
_.castableTypeMap$ = {};
_.fromIndex = -1;
_.next = null;
_.val$handlers = null;
_.val$parts = null;
function $getNext_1(this$static){
  var behaviour;
  while ((this$static.fromIndex = $indexOf_0(this$static.val$parts, 47, this$static.fromIndex + 1)) != -1) {
    behaviour = dynamicCast($get_12(this$static.val$behaviours, this$static.val$parts.substr(0, this$static.fromIndex - 0)), 247);
    if (behaviour) {
      this$static.next = behaviour;
      return;
    }
  }
  this$static.next = null;
}

function AnnotationRegistryImpl$3_0(val$parts, val$behaviours){
  this.val$parts = val$parts;
  this.val$behaviours = val$behaviours;
  $getNext_1(this);
}

function AnnotationRegistryImpl$3(){
}

_ = AnnotationRegistryImpl$3_0.prototype = AnnotationRegistryImpl$3.prototype = new Object_0;
_.getClass$ = function getClass_913(){
  return Lorg_waveprotocol_wave_model_document_util_AnnotationRegistryImpl$3_2_classLit;
}
;
_.hasNext = function hasNext_16(){
  return !!this.next;
}
;
_.next_0 = function next_20(){
  var ret;
  return ret = this.next , $getNext_1(this) , ret;
}
;
_.remove = function remove_40(){
  throw new UnsupportedOperationException_1('getBehaviours iterator: remove');
}
;
_.castableTypeMap$ = {};
_.fromIndex = -1;
_.next = null;
_.val$behaviours = null;
_.val$parts = null;
function AnnotationRegistryImpl$HandlerData_0(){
  this.handlers = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  this.behaviours = new CollectionUtils$StringMapAdapter_0(new HashMap_0);
}

function AnnotationRegistryImpl$HandlerData(){
}

_ = AnnotationRegistryImpl$HandlerData_0.prototype = AnnotationRegistryImpl$HandlerData.prototype = new Object_0;
_.getClass$ = function getClass_914(){
  return Lorg_waveprotocol_wave_model_document_util_AnnotationRegistryImpl$HandlerData_2_classLit;
}
;
_.castableTypeMap$ = {162:1};
function checkPersistentKey(key){
  checkNotNull_1(key, 'Annotation key may not be null');
  key.charCodeAt(0) == 64 && illegalArgument("Attempt to use local annotation key '" + key + "' as a persistent key");
  (key.indexOf(fromCodePoint(64)) != -1 || key.indexOf(fromCodePoint(63)) != -1) && illegalArgument("Persistent annotation key '" + key + "' contains invalid characters");
}

function firstAnnotationBoundary(annotations, end, key){
  var ret;
  ret = $firstAnnotationChange(annotations.fullAnnotationSet, 0, end, key, null);
  return ret != -1?ret:end;
}

function getAlignedAnnotation(annotations, location_0, key, leftAlign){
  if (leftAlign) {
    if (location_0 == 0) {
      return null;
    }
    --location_0;
  }
   else {
    if (location_0 == $size_10(annotations.doc)) {
      return null;
    }
  }
  return $getAnnotation_2(annotations.doc, location_0, key);
}

function guardedResetAnnotation(annotations, end, key){
  var isSet, size;
  size = annotations.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1;
  isSet = $firstAnnotationChange(annotations.fullAnnotationSet, 0, 0, key, null) == -1 && $firstAnnotationChange(annotations.fullAnnotationSet, 0, end, key, null) == -1 && $firstAnnotationChange(annotations.fullAnnotationSet, end, size, key, null) == -1;
  isSet || $resetAnnotation(annotations, 0, end, key, null);
  return !isSet;
}

var prefixIncrementor = 0;
function ensureNodeBoundary(point, doc, textNodeOrganiser){
  var maybeSecond, textNode, textPoint;
  textPoint = point.asTextPoint();
  if (textPoint) {
    textNode = doc.asText_0(textPoint.container);
    maybeSecond = $splitText_2(textNodeOrganiser, textNode, $getTextOffset(textPoint));
    return maybeSecond?new Point$El_0(doc.getParentElement(maybeSecond), maybeSecond):new Point$El_0(doc.getParentElement(textNode), doc.getNextSibling(textNode));
  }
   else {
    return point.asElementPoint();
  }
}

function ensureNodeBoundaryReturnNextNode(point, doc, textNodeOrganiser){
  var maybeSecond, textNode, textStartPoint;
  textStartPoint = point.asTextPoint();
  if (textStartPoint) {
    textNode = doc.inner_0.asText_0(textStartPoint.container);
    maybeSecond = $splitText_2(textNodeOrganiser, textNode, $getTextOffset(textStartPoint));
    return maybeSecond?maybeSecond:getNextOrPrevNodeDepthFirst_1(doc, textNode, null, false, true);
  }
   else 
    return $getNodeAfter(point) != null?$getNodeAfter(point):getNextOrPrevNodeDepthFirst_1(doc, point.container, null, false, true);
}

function getFilteredPoint(filteredView, point){
  var next, visible;
  filteredView.onBeforeFilter(point);
  if (point.offset >= 0) {
    visible = $getVisibleNode(filteredView, point.container);
    if ((visible == null?null:visible) === maskUndefined(point.container)) {
      return point;
    }
     else {
      next = getNextOrPrevNodeDepthFirst_1(filteredView, point.container, visible, false, true);
      return next == null?new Point$El_0(visible, null):new Point$El_0($getParentElement_3(filteredView, next), next);
    }
  }
   else 
    return $getNodeAfter(point) == null?getLocationOfNodeEnd(filteredView, point.container):getLocationOfBeforeNode(filteredView, $getNodeAfter(point));
}

function getItemSize(doc, node){
  var locationAfter, next, parent_0, textNode;
  textNode = doc.substrate.asText_0(node);
  if (textNode != null) {
    return doc.substrate.getLength(textNode);
  }
  parent_0 = doc.substrate.getParentElement(node);
  if (parent_0 == null) {
    return $checkSizeConsistency(doc, 'size') , doc.offsetList.root.offset;
  }
  next = doc.substrate.getNextSibling(node);
  locationAfter = next != null?$getLocation_3(doc, dynamicCast(next, 163)):$getLocation_4(doc, new Point$El_0(parent_0, null));
  return locationAfter - $getLocation_3(doc, dynamicCast(node, 163));
}

function getLocationOfBeforeNode(doc, node){
  var next, parent_0;
  parent_0 = $getVisibleNode(doc, node);
  if ((parent_0 == null?null:parent_0) === (node == null?null:node)) {
    return new Point$El_0($getParentElement_3(doc, node), node);
  }
  next = getNextOrPrevNodeDepthFirst_1(doc, node, parent_0, true, true);
  return next == null?new Point$El_0(parent_0, null):new Point$El_0($getParentElement_3(doc, next), next);
}

function getLocationOfNodeEnd(doc, node){
  var next, parent_0;
  parent_0 = $getVisibleNode(doc, node);
  if ((parent_0 == null?null:parent_0) === (node == null?null:node)) {
    return new Point$El_0(node, null);
  }
  next = getNextOrPrevNodeDepthFirst_1(doc, node, parent_0, false, true);
  return next == null?new Point$El_0(parent_0, null):new Point$El_0($getParentElement_3(doc, next), next);
}

function getNextOrPrevNodeDepthFirst_1(doc, start, stopAt, enter, rightwards){
  var element, next;
  stopAt == null && (stopAt = doc.getDocumentElement());
  if (enter) {
    element = doc.asElement_0(start);
    if (element != null) {
      next = rightwards?doc.getFirstChild_0(element):doc.getLastChild_0(element);
      if (next != null) {
        return next;
      }
    }
  }
  while (start != null && !doc.isSameNode(start, stopAt)) {
    next = rightwards?doc.getNextSibling(start):doc.getPreviousSibling(start);
    if (doc.isSameNode(next, stopAt)) {
      return null;
    }
    if (next != null) {
      return next;
    }
    start = doc.getParentElement(start);
  }
  return null;
}

function getNodeAfterOutwards(doc, point, output){
  var node, parent_0, startOffset;
  if (point.offset >= 0) {
    node = point.container;
    startOffset = $getTextOffset(point);
  }
   else {
    node = $getNodeAfter(point);
    if (node == null) {
      parent_0 = point.container;
      while (parent_0 != null) {
        node = doc.substrate.getNextSibling(parent_0);
        if (node != null) {
          break;
        }
        parent_0 = doc.substrate.getParentElement(parent_0);
      }
    }
    startOffset = 0;
  }
  output.node = node;
  output.offset = startOffset;
}

function getText(doc, start, end){
  var endPoint, startPoint;
  return checkPositionIndexesInRange(start, end, ($checkSizeConsistency(doc, 'size') , doc.offsetList.root.offset)) , startPoint = (checkPositionIndex(start, doc.offsetList.root.offset) , $performActionAt(doc.offsetList, start, doc.pointFinder)) , endPoint = (checkPositionIndex(end, doc.offsetList.root.offset) , $performActionAt(doc.offsetList, end, doc.pointFinder)) , getText_1(doc, startPoint, endPoint);
}

function getText_1(doc, startPoint, endPoint){
  var endNode, endOffset, node, output, startNode, startOffset, str, text;
  output = new DocHelper$NodeOffset_0;
  getNodeAfterOutwards(doc, startPoint, output);
  startNode = output.node;
  startOffset = output.offset;
  getNodeAfterOutwards(doc, endPoint, output);
  endNode = output.node;
  endOffset = output.offset;
  if (startNode == null) {
    return '';
  }
  text = doc.substrate.asText_0(startNode);
  if (doc.substrate.isSameNode(startNode, endNode)) {
    return text == null?'':$substring_0(doc.substrate.getData(text), startOffset, endOffset);
  }
  str = new StringBuilder_0;
  text != null && $append_8(str, $substring(doc.substrate.getData(text), startOffset));
  node = getNextOrPrevNodeDepthFirst_1(doc, startNode, null, true, true);
  while ((node == null?null:node) !== (endNode == null?null:endNode)) {
    text = doc.substrate.asText_0(node);
    text != null && $append_8(str, doc.substrate.getData(text));
    node = getNextOrPrevNodeDepthFirst_1(doc, node, null, true, true);
  }
  text = doc.substrate.asText_0(node);
  text != null && $append_8(str, doc.substrate.getData(text).substr(0, endOffset - 0));
  return str.impl.string;
}

function isAncestor(doc, ancestor, child, canEqual){
  checkNotNull_1(ancestor, "Shouldn't check ancestry of a null node");
  while (child != null) {
    if ((ancestor == null?null:ancestor) === (child == null?null:child)) {
      return canEqual;
    }
    canEqual = true;
    child = doc.inner_0.getParentElement(child);
  }
  return false;
}

function jumpOut(doc, location_0){
  var el, nodeAfter;
  if (location_0.offset >= 0) {
    el = doc.doc.substrate.getParentElement(location_0.container);
    nodeAfter = doc.doc.substrate.getNextSibling(location_0.container);
    if (isLineContainer(doc, el)) {
      return location_0;
    }
  }
   else {
    el = location_0.container;
    nodeAfter = $getNodeAfter(location_0);
  }
  while (el != null && !isLineContainer(doc, el)) {
    nodeAfter = doc.doc.substrate.getNextSibling(el);
    el = doc.doc.substrate.getParentElement(el);
  }
  if (el == null) {
    return null;
  }
  return (el == null?null:el) === maskUndefined(location_0.container)?location_0:new Point$El_0(el, nodeAfter);
}

function leftAlign_0(current, fullDoc, important){
  var at, lastBefore, lcaVis, nodeLast, parent_0, visibleParent;
  if (!current || current.offset >= 0) {
    return current;
  }
  parent_0 = current.container;
  at = $getNodeAfter(current);
  at == null?(lastBefore = fullDoc.inner_0.getLastChild_0(parent_0)):(lastBefore = fullDoc.inner_0.getPreviousSibling(at));
  visibleParent = $getVisibleNode(important, parent_0);
  if (lastBefore == null) {
    if ((parent_0 == null?null:parent_0) === (visibleParent == null?null:visibleParent)) {
      return textOrElementStart(fullDoc, parent_0);
    }
    lastBefore = parent_0;
  }
  nodeLast = $getPreviousVisibleNodeDepthFirst(important, lastBefore, null, true);
  lcaVis = nodeLast == null?lastBefore:nearestCommonAncestor_0(fullDoc, nodeLast, lastBefore);
  if (isAncestor(fullDoc, lcaVis, visibleParent, false)) {
    return textOrElementStart(fullDoc, visibleParent);
  }
  at = nodeLast == null?null:$getNextSibling_3(important, nodeLast);
  at != null?(parent_0 = fullDoc.inner_0.getParentElement(at)):nodeLast != null && (parent_0 = fullDoc.inner_0.getParentElement(nodeLast));
  return at == null?new Point$El_0(parent_0, null):new Point$El_0(fullDoc.inner_0.getParentElement(at), at);
}

function nearestCommonAncestor_0(doc, node1, node2){
  var ancestors, commonAncestor;
  ancestors = ($clinit_1445() , $clinit_1445() , new CollectionUtils$IdentityHashMapAdapter_0);
  if ((node1 == null?null:node1) === (node2 == null?null:node2)) {
    return node1;
  }
  commonAncestor = null;
  while (node1 != null || node2 != null) {
    if (node1 != null) {
      if ($containsKey_0(ancestors.backend, node1)) {
        commonAncestor = node1;
        break;
      }
      $put_2(ancestors, node1, node1);
      node1 = doc.getParentElement(node1);
    }
    if (node2 != null) {
      if ($containsKey_0(ancestors.backend, node2)) {
        commonAncestor = node2;
        break;
      }
      $put_2(ancestors, node2, node2);
      node2 = doc.getParentElement(node2);
    }
  }
  if (commonAncestor == null) {
    throw new IllegalArgumentException_1('nearestCommonAncestor: Given nodes are not in the same document');
  }
  return commonAncestor;
}

function normalizePoint(point, doc){
  var nodeAfterAsText, previous, previousAsText;
  previous = null;
  if (point.offset >= 0) {
    $getTextOffset(point) == 0 && (previous = $getPreviousSibling_3(doc, point.container));
  }
   else {
    previous = nodeBefore_0(doc, point.asElementPoint());
    nodeAfterAsText = doc.inner_0.asText_0($getNodeAfter(point));
    nodeAfterAsText != null && (point = new Point$Tx_0(nodeAfterAsText, 0));
  }
  previousAsText = doc.inner_0.asText_0(previous);
  previous != null && previousAsText != null && (point = new Point$Tx_0(previous, doc.inner_0.getLength(previousAsText)));
  return point;
}

--></script>
<script><!--
function transparentSlice(splitAt, cxt){
  var location_0, nodeAfter, pParent, pPoint, text;
  location_0 = $getLocation_4(cxt.this$0.indexedDoc, getFilteredPoint(cxt.this$0.persistentContentView, splitAt));
  pPoint = $locate_0(cxt.this$0.indexedDoc, location_0);
  if (pPoint.offset >= 0) {
    text = cxt.this$0.mutableContent.doc.substrate.asText_0(pPoint.container);
    pParent = cxt.this$0.mutableContent.doc.substrate.getParentElement(text);
    if ((pParent == null?null:pParent) === maskUndefined(cxt.this$0.fullContentView.inner_0.getParentElement(text))) {
      return pPoint;
    }
     else {
      pPoint = ensureNodeBoundary(pPoint, cxt.this$0.mutableContent, cxt.this$0.indexedDoc);
    }
  }
  if ($getNodeAfter(pPoint) != null) {
    nodeAfter = $getNodeAfter(pPoint);
    return maskUndefined(cxt.this$0.fullContentView.inner_0.getParentElement(nodeAfter)) !== maskUndefined(pPoint.container)?new Point$El_0(pPoint.container, $transparentSlice(cxt.this$0.fullContentView, dynamicCast(nodeAfter, 163))):pPoint;
  }
   else {
    return pPoint;
  }
}

function DocHelper$NodeOffset_0(){
}

function DocHelper$NodeOffset(){
}

_ = DocHelper$NodeOffset_0.prototype = DocHelper$NodeOffset.prototype = new Object_0;
_.getClass$ = function getClass_915(){
  return Lorg_waveprotocol_wave_model_document_util_DocHelper$NodeOffset_2_classLit;
}
;
_.castableTypeMap$ = {};
_.node = null;
_.offset = 0;
function $clinit_1350(){
  $clinit_1350 = nullMethod;
  FORWARD_DEPTH_FIRST_ITERATOR = new DocIterate$DeepIteratorFilter_0(true);
  new DocIterate$DeepIteratorFilter_0(false);
  new DocIterate$ElementFilter_0(true);
  REVERSE_DEPTH_FIRST_ELEMENT_ITERATOR = new DocIterate$ElementFilter_0(false);
}

function iterate(doc, startNode, stopAt, iterateFunction){
  $clinit_1350();
  return new DocIterate$1_0(startNode, iterateFunction, doc, stopAt);
}

var FORWARD_DEPTH_FIRST_ITERATOR, REVERSE_DEPTH_FIRST_ELEMENT_ITERATOR;
function $iterator_14(this$static){
  return new DocIterate$1$1_0(this$static.val$startNode, this$static.val$iterateFunction, this$static.val$doc, this$static.val$stopAt);
}

function DocIterate$1_0(val$startNode, val$iterateFunction, val$doc, val$stopAt){
  this.val$startNode = val$startNode;
  this.val$iterateFunction = val$iterateFunction;
  this.val$doc = val$doc;
  this.val$stopAt = val$stopAt;
}

function DocIterate$1(){
}

_ = DocIterate$1_0.prototype = DocIterate$1.prototype = new Object_0;
_.getClass$ = function getClass_916(){
  return Lorg_waveprotocol_wave_model_document_util_DocIterate$1_2_classLit;
}
;
_.iterator_0 = function iterator_22(){
  return new DocIterate$1$1_0(this.val$startNode, this.val$iterateFunction, this.val$doc, this.val$stopAt);
}
;
_.castableTypeMap$ = {};
_.val$doc = null;
_.val$iterateFunction = null;
_.val$startNode = null;
_.val$stopAt = null;
function $next_21(this$static){
  var currentNode;
  currentNode = this$static.next;
  this$static.next = this$static.val$iterateFunction.next_1(this$static.val$doc, currentNode, this$static.val$stopAt);
  return this$static.val$iterateFunction.value_1(this$static.val$doc, currentNode);
}

function DocIterate$1$1_0(val$startNode, val$iterateFunction, val$doc, val$stopAt){
  this.val$startNode = val$startNode;
  this.val$iterateFunction = val$iterateFunction;
  this.val$doc = val$doc;
  this.val$stopAt = val$stopAt;
  this.next = this.val$startNode;
}

function DocIterate$1$1(){
}

_ = DocIterate$1$1_0.prototype = DocIterate$1$1.prototype = new Object_0;
_.getClass$ = function getClass_917(){
  return Lorg_waveprotocol_wave_model_document_util_DocIterate$1$1_2_classLit;
}
;
_.hasNext = function hasNext_17(){
  return this.next != null;
}
;
_.next_0 = function next_21(){
  return $next_21(this);
}
;
_.remove = function remove_41(){
  throw new UnsupportedOperationException_1('remove');
}
;
_.castableTypeMap$ = {};
_.val$doc = null;
_.val$iterateFunction = null;
_.val$startNode = null;
_.val$stopAt = null;
function DocIterate$DeepIteratorFilter_0(rightwards){
  this.rightwards = rightwards;
}

function DocIterate$DeepIteratorFilter(){
}

_ = DocIterate$DeepIteratorFilter_0.prototype = DocIterate$DeepIteratorFilter.prototype = new Object_0;
_.getClass$ = function getClass_918(){
  return Lorg_waveprotocol_wave_model_document_util_DocIterate$DeepIteratorFilter_2_classLit;
}
;
_.next_1 = function next_22(doc, current, stopAt){
  return getNextOrPrevNodeDepthFirst_1(doc, current, stopAt, true, this.rightwards);
}
;
_.value_1 = function value_24(doc, node){
  return node;
}
;
_.castableTypeMap$ = {};
_.rightwards = false;
function DocIterate$ElementFilter_0(rightwards){
  this.rightwards = rightwards;
}

function DocIterate$ElementFilter(){
}

_ = DocIterate$ElementFilter_0.prototype = DocIterate$ElementFilter.prototype = new DocIterate$DeepIteratorFilter;
_.getClass$ = function getClass_919(){
  return Lorg_waveprotocol_wave_model_document_util_DocIterate$ElementFilter_2_classLit;
}
;
_.next_1 = function next_23(doc, current, stopAt){
  var next;
  next = getNextOrPrevNodeDepthFirst_1(doc, current, stopAt, true, this.rightwards);
  while (next != null && doc.asElement_0(next) == null) {
    next = getNextOrPrevNodeDepthFirst_1(doc, next, stopAt, true, this.rightwards);
  }
  return next;
}
;
_.value_1 = function value_25(doc, node){
  var ret;
  ret = doc.asElement_0(node);
  return ret;
}
;
_.castableTypeMap$ = {};
function $clinit_1356(){
  $clinit_1356 = nullMethod;
  attrNameScrubber = new DocOpScrub$1_0;
  annotationKeyScrubber = new DocOpScrub$2_0;
}

function scrub_0(op){
  var annotationNames, attrNames, op_0;
  $clinit_1356();
  var $e0, b, e;
  try {
    b = new DocOpBuffer_0;
    op.apply_5((attrNames = new DocOpScrub$ScrubCache_0(attrNameScrubber) , annotationNames = new DocOpScrub$ScrubCache_0(annotationKeyScrubber) , new DocOpScrub$3_0(b, attrNames, annotationNames)));
    return new BufferedDocOpImpl_0(dynamicCast($toArray_1(b.accu, ($clinit_1292() , EMPTY_ARRAY_1)), 193));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 4)) {
      e = $e0;
      return op_0 = new BufferedDocOpImpl_0(dynamicCast($toArray_1($characters_3(new DocOpBuilder_0, 'Scrub exploded: ' + e).accu, ($clinit_1294() , EMPTY_ARRAY_2)), 193)) , checkWellformedness(op_0) , op_0;
    }
     else 
      throw $e0;
  }
}

function scrubAnnotationBoundary(unscrubbed, nameScrubber){
  $clinit_1356();
  var changeTriplets, ends, i;
  ends = initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, unscrubbed.endSize(), 0);
  changeTriplets = initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, unscrubbed.changeSize() * 3, 0);
  for (i = 0; i < unscrubbed.endSize(); ++i) {
    ends[i] = $scrubUniquely(nameScrubber, unscrubbed.getEndKey_0(i));
  }
  for (i = 0; i < unscrubbed.changeSize(); ++i) {
    changeTriplets[i * 3] = $scrubUniquely(nameScrubber, unscrubbed.getChangeKey_0(i));
    changeTriplets[i * 3 + 1] = scrubMostString(unscrubbed.getOldValue(i));
    changeTriplets[i * 3 + 2] = scrubMostString(unscrubbed.getNewValue(i));
  }
  return new DocOpScrub$UncheckedAnnotationBoundary_0(changeTriplets, ends);
}

function scrubAttributes(unscrubbed, nameScrubber){
  var sorted;
  $clinit_1356();
  var entry, entry$iterator, list;
  list = new ArrayList_0;
  for (entry$iterator = new ImmutableStateMap$1$1_0(unscrubbed.entrySet); entry$iterator.iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.iterator.next_0(), 221);
    $add_9(list, new ImmutableStateMap$Attribute_1($scrubUniquely(nameScrubber, entry.name_0), scrubMostString(entry.value_0)));
  }
  return $clinit_1282() , sorted = new ArrayList_1(list) , sort_2(sorted, comparator) , new AttributesImpl_2(sorted);
}

function scrubAttributesUpdate(unscrubbed, nameScrubber){
  var sorted;
  $clinit_1356();
  var i, list;
  list = new ArrayList_0;
  for (i = 0; i < unscrubbed.updates.size_0(); ++i) {
    $add_9(list, new ImmutableUpdateMap$AttributeUpdate_0($scrubUniquely(nameScrubber, dynamicCast(unscrubbed.updates.get_0(i), 220).name_0), scrubMostString(dynamicCast(unscrubbed.updates.get_0(i), 220).oldValue), scrubMostString(dynamicCast(unscrubbed.updates.get_0(i), 220).newValue)));
  }
  return $clinit_1289() , sorted = new ArrayList_1(list) , sort_2(sorted, comparator_0) , new AttributesUpdateImpl_2(sorted);
}

function scrubChar(c, scrubValid){
  $clinit_1490();
  if (55296 <= c && c <= 57343) {
    return 55296 <= c && c <= 56319?60:62;
  }
  switch (isCodePointGoodForBlip(c).ordinal) {
    case 0:
      return scrubValid?c <= 127?97:c <= 255?98:c <= 383?99:c <= 591?100:11360 <= c && c <= 11391?101:42784 <= c && c <= 43007?102:c <= 687?73:c <= 767?83:c <= 879?58:c <= 1023?968:c <= 1327?1071:c <= 1423?1364:c <= 1535?72:c <= 1791?65:2304 <= c && c <= 2431?68:3584 <= c && c <= 3711?84:4352 <= c && c <= 4607?75:8352 <= c && c <= 11263?37:11904 <= c && c <= 12031 || 12288 <= c && c <= 12351 || 12800 <= c && c <= 40959?25105:12352 <= c && c <= 12543?74:63:c;
    case 3:
      return 124;
    case 1:
      return 94;
    case 5:
      return 33;
    default:return 35;
  }
}

function scrubMostAnnotationKey(unscrubbed){
  $clinit_1356();
  var i, parts;
  parts = $split(unscrubbed, '/', -1);
  new StringBuilder_0;
  for (i = 0; i < parts.length; ++i) {
    parts[i] = scrubMostString(parts[i]);
  }
  return join(parts);
}

function scrubMostString(unscrubbed){
  $clinit_1356();
  var index, parts;
  if (unscrubbed == null) {
    return null;
  }
  index = unscrubbed.indexOf(fromCodePoint(64));
  if (index != -1 && unscrubbed.lastIndexOf(fromCodePoint(64)) == index) {
    parts = $split(unscrubbed, '@', 2);
    return scrubString(parts[0], true) + '@' + scrubString(parts[1], true);
  }
   else 
    return unscrubbed.length >= 3?scrubString(unscrubbed.substr(0, 3 - 0), false) + scrubString(unscrubbed.substr(3, unscrubbed.length - 3), true):unscrubbed;
}

function scrubString(unscrubbed, scrubValidChars){
  $clinit_1356();
  var chars, i;
  chars = initDim(_3C_classLit, {58:1}, -1, unscrubbed.length, 1);
  for (i = 0; i < unscrubbed.length; ++i) {
    chars[i] = scrubChar(unscrubbed.charCodeAt(i), scrubValidChars);
  }
  return String.fromCharCode.apply(null, chars);
}

var annotationKeyScrubber, attrNameScrubber;
function DocOpScrub$1_0(){
}

function DocOpScrub$1(){
}

_ = DocOpScrub$1_0.prototype = DocOpScrub$1.prototype = new Object_0;
_.getClass$ = function getClass_920(){
  return Lorg_waveprotocol_wave_model_document_util_DocOpScrub$1_2_classLit;
}
;
_.scrub = function scrub_1(input){
  return scrubMostString(input);
}
;
_.castableTypeMap$ = {};
function DocOpScrub$2_0(){
}

function DocOpScrub$2(){
}

_ = DocOpScrub$2_0.prototype = DocOpScrub$2.prototype = new Object_0;
_.getClass$ = function getClass_921(){
  return Lorg_waveprotocol_wave_model_document_util_DocOpScrub$2_2_classLit;
}
;
_.scrub = function scrub_2(input){
  return scrubMostAnnotationKey(input);
}
;
_.castableTypeMap$ = {};
function DocOpScrub$3_0(val$target, val$attrNames, val$annotationNames){
  this.val$target = val$target;
  this.val$attrNames = val$attrNames;
  this.val$annotationNames = val$annotationNames;
}

function DocOpScrub$3(){
}

_ = DocOpScrub$3_0.prototype = DocOpScrub$3.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_20(map){
  $add_9(this.val$target.accu, new OperationComponents$AnnotationBoundary_0(scrubAnnotationBoundary(map, this.val$annotationNames)));
}
;
_.characters_0 = function characters_29(chars){
  $add_9(this.val$target.accu, new OperationComponents$Characters_0(($clinit_1356() , scrubString(chars, true))));
}
;
_.deleteCharacters = function deleteCharacters_31(chars){
  $add_9(this.val$target.accu, new OperationComponents$DeleteCharacters_0(($clinit_1356() , scrubString(chars, true))));
}
;
_.deleteElementEnd = function deleteElementEnd_29(){
  $add_9(this.val$target.accu, ($clinit_1310() , INSTANCE_14));
}
;
_.deleteElementStart = function deleteElementStart_29(type, attrs){
  $add_9(this.val$target.accu, new OperationComponents$DeleteElementStart_0(type, scrubAttributes(attrs, this.val$attrNames)));
}
;
_.elementEnd = function elementEnd_26(){
  $add_9(this.val$target.accu, ($clinit_1312() , INSTANCE_15));
}
;
_.elementStart = function elementStart_26(type, attrs){
  $add_9(this.val$target.accu, new OperationComponents$ElementStart_0(type, scrubAttributes(attrs, this.val$attrNames)));
}
;
_.getClass$ = function getClass_922(){
  return Lorg_waveprotocol_wave_model_document_util_DocOpScrub$3_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_31(oldAttrs, newAttrs){
  $add_9(this.val$target.accu, new OperationComponents$ReplaceAttributes_0(scrubAttributes(oldAttrs, this.val$attrNames), scrubAttributes(newAttrs, this.val$attrNames)));
}
;
_.retain = function retain_27(itemCount){
  $add_9(this.val$target.accu, new OperationComponents$Retain_0(itemCount));
}
;
_.updateAttributes = function updateAttributes_31(attrUpdate){
  $add_9(this.val$target.accu, new OperationComponents$UpdateAttributes_0(scrubAttributesUpdate(attrUpdate, this.val$attrNames)));
}
;
_.castableTypeMap$ = {};
_.val$annotationNames = null;
_.val$attrNames = null;
_.val$target = null;
function $scrubUniquely(this$static, input){
  var bareScrubbed, scrubbed;
  if ($containsKey_5(this$static.alreadyScrubbed, input)) {
    return dynamicCast($get_12(this$static.alreadyScrubbed, input), 1);
  }
  bareScrubbed = this$static.format.scrub(input);
  scrubbed = bareScrubbed;
  while ($contains_7(this$static.scrubbings, scrubbed)) {
    scrubbed = bareScrubbed + '_' + ++this$static.uniqueSuffix;
  }
  $put_5(this$static.alreadyScrubbed, input, scrubbed);
  $add_20(this$static.scrubbings, scrubbed);
  return scrubbed;
}

function DocOpScrub$ScrubCache_0(format){
  this.alreadyScrubbed = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  this.scrubbings = new CollectionUtils$StringSetAdapter_0(new HashSet_0);
  this.format = format;
}

function DocOpScrub$ScrubCache(){
}

_ = DocOpScrub$ScrubCache_0.prototype = DocOpScrub$ScrubCache.prototype = new Object_0;
_.getClass$ = function getClass_923(){
  return Lorg_waveprotocol_wave_model_document_util_DocOpScrub$ScrubCache_2_classLit;
}
;
_.castableTypeMap$ = {};
_.format = null;
_.uniqueSuffix = 0;
function $copy_0(input){
  var i, ret;
  ret = initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, input.length, 0);
  for (i = 0; i < input.length; ++i) {
    ret[i] = input[i];
  }
  return ret;
}

function DocOpScrub$UncheckedAnnotationBoundary_0(triplets, ends){
  var i;
  checkArgument_0(triplets.length % 3 == 0, 'triplets.length not a multiple of 3');
  this.ends = $copy_0(ends);
  sort(this.ends);
  this.changes = initDim(_3Lorg_waveprotocol_wave_model_document_util_DocOpScrub$UncheckedAnnotationBoundary$Triplet_2_classLit, {58:1, 138:1}, 119, ~~(triplets.length / 3), 0);
  for (i = 0; i < triplets.length; i += 3) {
    this.changes[~~(i / 3)] = new DocOpScrub$UncheckedAnnotationBoundary$Triplet_0(triplets[i], triplets[i + 1], triplets[i + 2]);
  }
  sort(this.changes);
}

function DocOpScrub$UncheckedAnnotationBoundary(){
}

_ = DocOpScrub$UncheckedAnnotationBoundary_0.prototype = DocOpScrub$UncheckedAnnotationBoundary.prototype = new Object_0;
_.changeSize = function changeSize_4(){
  return this.changes.length;
}
;
_.endSize = function endSize_4(){
  return this.ends.length;
}
;
_.getChangeKey_0 = function getChangeKey_5(i){
  return this.changes[i].key;
}
;
_.getClass$ = function getClass_924(){
  return Lorg_waveprotocol_wave_model_document_util_DocOpScrub$UncheckedAnnotationBoundary_2_classLit;
}
;
_.getEndKey_0 = function getEndKey_5(i){
  return this.ends[i];
}
;
_.getNewValue = function getNewValue_3(i){
  return this.changes[i].newVal;
}
;
_.getOldValue = function getOldValue_3(i){
  return this.changes[i].oldVal;
}
;
_.castableTypeMap$ = {235:1};
_.changes = null;
_.ends = null;
function DocOpScrub$UncheckedAnnotationBoundary$Triplet_0(key, oldVal, newVal){
  checkNotNull_1(key, 'triplet key');
  this.key = key;
  this.oldVal = oldVal;
  this.newVal = newVal;
}

function DocOpScrub$UncheckedAnnotationBoundary$Triplet(){
}

_ = DocOpScrub$UncheckedAnnotationBoundary$Triplet_0.prototype = DocOpScrub$UncheckedAnnotationBoundary$Triplet.prototype = new Object_0;
_.compareTo$ = function compareTo_10(o){
  return compareTo_5(this.key, dynamicCast(o, 119).key);
}
;
_.getClass$ = function getClass_925(){
  return Lorg_waveprotocol_wave_model_document_util_DocOpScrub$UncheckedAnnotationBoundary$Triplet_2_classLit;
}
;
_.castableTypeMap$ = {61:1, 119:1};
_.key = null;
_.newVal = null;
_.oldVal = null;
function $clinit_1364(){
  $clinit_1364 = nullMethod;
  $clinit_1105();
}

function buildDomInitializationFromElement(doc, element, cursor){
  var child;
  cursor.elementStart(doc.getTagName(element), new AttributesImpl_1(doc.getAttributes(element)));
  for (child = doc.getFirstChild_0(element); child != null; child = doc.getNextSibling(child)) {
    buildDomInitializationFromSubtree(doc, child, cursor);
  }
  cursor.elementEnd();
}

function buildDomInitializationFromSubtree(doc, node, cursor){
  var text;
  text = doc.asText_0(node);
  text == null?buildDomInitializationFromElement(doc, doc.asElement_0(node), cursor):cursor.characters_0(doc.getData(text));
}

function $clinit_1369(){
  var op, op_0;
  $clinit_1369 = nullMethod;
  EMPTY_DOCUMENT_0 = new DocOpUtil$1_0((op = new BufferedDocOpImpl_0(dynamicCast($toArray_1((new DocInitializationBuilder_0).accu, ($clinit_1291() , EMPTY_ARRAY_0)), 193)) , checkWellformedness(op) , op));
  op_0 = new BufferedDocOpImpl_0(dynamicCast($toArray_1((new DocOpBuilder_0).accu, ($clinit_1294() , EMPTY_ARRAY_2)), 193));
  checkWellformedness(op_0);
}

var EMPTY_DOCUMENT_0;
function FilterProduct_0(filters){
  FilteredView_0.call(this, argumentCheck(filters));
  this.filters = filters;
}

function argumentCheck(filters){
  var i;
  for (i = 1; i < filters.length; ++i) {
  }
  return filters[0].inner_0;
}

function FilterProduct(){
}

_ = FilterProduct_0.prototype = FilterProduct.prototype = new FilteredView;
_.getClass$ = function getClass_926(){
  return Lorg_waveprotocol_wave_model_document_util_FilterProduct_2_classLit;
}
;
_.getSkipLevel = function getSkipLevel_3(node){
  var i, levels;
  levels = initDim(_3Lorg_waveprotocol_wave_model_document_util_FilteredView$Skip_2_classLit, {58:1, 138:1}, 120, this.filters.length, 0);
  for (i = 0; i < this.filters.length; ++i) {
    levels[i] = this.filters[i].getSkipLevel(node);
  }
  return $resolveSkip(dynamicCast(node, 163), levels);
}
;
_.castableTypeMap$ = {109:1, 121:1, 122:1, 125:1};
_.filters = null;
function $clinit_1371(){
  $clinit_1371 = nullMethod;
  NONE_4 = new FilteredView$Skip_0('NONE', 0);
  SHALLOW = new FilteredView$Skip_0('SHALLOW', 1);
  DEEP = new FilteredView$Skip_0('DEEP', 2);
  INVALID = new FilteredView$Skip_0('INVALID', 3);
  $VALUES_52 = initValues(_3Lorg_waveprotocol_wave_model_document_util_FilteredView$Skip_2_classLit, {58:1, 138:1}, 120, [NONE_4, SHALLOW, DEEP, INVALID]);
}

function FilteredView$Skip_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_53(){
  $clinit_1371();
  return $VALUES_52;
}

function FilteredView$Skip(){
}

_ = FilteredView$Skip_0.prototype = FilteredView$Skip.prototype = new Enum;
_.getClass$ = function getClass_927(){
  return Lorg_waveprotocol_wave_model_document_util_FilteredView$Skip_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 120:1};
var $VALUES_52, DEEP, INVALID, NONE_4, SHALLOW;
function $asRange(this$static){
  !this$static.range && (this$static.range = this$static.anchor < this$static.focus_0?new Range_2(this$static.anchor, this$static.focus_0):new Range_2(this$static.focus_0, this$static.anchor));
  return this$static.range;
}

function $isOrdered(this$static){
  return this$static.anchor <= this$static.focus_0;
}

function FocusedRange_0(anchor, focus_0){
  (anchor < 0 || focus_0 < 0) && illegalArgument('Bad focused range: (' + anchor + ', ' + focus_0 + ')');
  this.anchor = anchor;
  this.focus_0 = focus_0;
}

function FocusedRange(){
}

_ = FocusedRange_0.prototype = FocusedRange.prototype = new Object_0;
_.equals$ = function equals_26(obj){
  var other;
  if (this === obj)
    return true;
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[175]))
    return false;
  other = dynamicCast(obj, 175);
  if (this.focus_0 != other.focus_0)
    return false;
  if (this.anchor != other.anchor)
    return false;
  return true;
}
;
_.getClass$ = function getClass_928(){
  return Lorg_waveprotocol_wave_model_document_util_FocusedRange_2_classLit;
}
;
_.hashCode$ = function hashCode_26(){
  return this.anchor + 37 * this.focus_0;
}
;
_.toString$ = function toString_75(){
  return 'FocusedRange(' + this.anchor + (this.anchor == this.focus_0?'':'->' + this.focus_0) + ')';
}
;
_.castableTypeMap$ = {175:1};
_.anchor = 0;
_.focus_0 = 0;
_.range = null;
function $advance_0(this$static, keyLocation){
  var val;
  val = $getAnnotation(this$static.annotations.fullAnnotationSet, keyLocation.location_0, keyLocation.key);
  keyLocation.location_0 = $firstAnnotationChange(this$static.annotations.fullAnnotationSet, keyLocation.location_0, this$static.end, keyLocation.key, val);
  keyLocation.location_0 != -1 && $add_8(this$static.locations, keyLocation);
}

function $nextLocation(this$static){
  var currentKeys, keyLocation;
  if (this$static.locations.heap.size == 0) {
    throw new NoSuchElementException_0;
  }
  currentKeys = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringSetAdapter_0(new HashSet_0));
  this$static.currentLocation = dynamicCast($peek(this$static.locations), 250).location_0;
  do {
    keyLocation = dynamicCast($remove_9(this$static.locations), 250);
    $add_20(currentKeys, keyLocation.key);
    $advance_0(this$static, keyLocation);
  }
   while (this$static.locations.heap.size != 0 && dynamicCast($peek(this$static.locations), 250).location_0 == this$static.currentLocation);
  return currentKeys;
}

function GenericAnnotationCursor_0(annotations, start, end, keys){
  this.locations = new PriorityQueue_0;
  checkPositionIndexesInRange(start, end, annotations.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1);
  checkNotNull_1(keys, 'GenericAnnotationCursor: Key set must not be null');
  this.annotations = annotations;
  this.end = end;
  $each_3(keys, new GenericAnnotationCursor$1_0(this, start));
  this.currentLocation = this.locations.heap.size == 0?-1:start;
}

function GenericAnnotationCursor(){
}

_ = GenericAnnotationCursor_0.prototype = GenericAnnotationCursor.prototype = new Object_0;
_.getClass$ = function getClass_929(){
  return Lorg_waveprotocol_wave_model_document_util_GenericAnnotationCursor_2_classLit;
}
;
_.castableTypeMap$ = {};
_.annotations = null;
_.currentLocation = 0;
_.end = 0;
function GenericAnnotationCursor$1_0(this$0, val$start){
  this.this$0 = this$0;
  this.val$start = val$start;
}

function GenericAnnotationCursor$1(){
}

_ = GenericAnnotationCursor$1_0.prototype = GenericAnnotationCursor$1.prototype = new Object_0;
_.apply_3 = function apply_78(key){
  $advance_0(this.this$0, new GenericAnnotationCursor$KeyLocation_0(key, this.val$start));
}
;
_.getClass$ = function getClass_930(){
  return Lorg_waveprotocol_wave_model_document_util_GenericAnnotationCursor$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$start = 0;
function GenericAnnotationCursor$KeyLocation_0(key, initialLocation){
  this.key = key;
  this.location_0 = initialLocation;
}

function GenericAnnotationCursor$KeyLocation(){
}

_ = GenericAnnotationCursor$KeyLocation_0.prototype = GenericAnnotationCursor$KeyLocation.prototype = new Object_0;
_.compareTo$ = function compareTo_11(other){
  return this.location_0 - dynamicCast(other, 250).location_0;
}
;
_.getClass$ = function getClass_931(){
  return Lorg_waveprotocol_wave_model_document_util_GenericAnnotationCursor$KeyLocation_2_classLit;
}
;
_.castableTypeMap$ = {61:1, 250:1};
_.key = null;
_.location_0 = 0;
function $iterator_15(this$static){
  return new GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator_0(this$static.a_0, this$static.start, this$static.end, this$static.keys);
}

function GenericAnnotationIntervalIterable_0(a_0, start, end, keys){
  this.a_0 = a_0;
  this.start = start;
  this.end = end;
  this.keys = keys;
}

function GenericAnnotationIntervalIterable(){
}

_ = GenericAnnotationIntervalIterable_0.prototype = GenericAnnotationIntervalIterable.prototype = new Object_0;
_.getClass$ = function getClass_932(){
  return Lorg_waveprotocol_wave_model_document_util_GenericAnnotationIntervalIterable_2_classLit;
}
;
_.iterator_0 = function iterator_23(){
  return new GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator_0(this.a_0, this.start, this.end, this.keys);
}
;
_.castableTypeMap$ = {};
_.a_0 = null;
_.end = 0;
_.keys = null;
_.start = 0;
function $next_23(this$static){
  var entry, key, nextIntervalStart, thisIntervalStart, value;
  if (!(this$static.first || this$static.entries.heap.size != 0)) {
    throw new NoSuchElementException_1('No more intervals');
  }
  thisIntervalStart = this$static.intervalStart;
  if (this$static.first) {
    this$static.entries.heap.size == 0?(nextIntervalStart = this$static.end):(nextIntervalStart = dynamicCast($peek(this$static.entries), 251).nextChange);
    this$static.first = false;
  }
   else {
    this$static.diffFromLeft.backend.clear();
    do {
      entry = dynamicCast($remove_9(this$static.entries), 251);
      key = entry.key;
      value = this$static.set.getAnnotation(thisIntervalStart, key);
      $put_5(this$static.diffFromLeft, key, value);
      $put_5(this$static.annotationsHere, key, value);
      entry.nextChange = this$static.set.firstAnnotationChange(thisIntervalStart + 1, this$static.end, key, value);
      entry.nextChange != -1 && $add_8(this$static.entries, entry);
    }
     while (this$static.entries.heap.size != 0 && dynamicCast($peek(this$static.entries), 251).nextChange == thisIntervalStart);
    this$static.entries.heap.size == 0?(nextIntervalStart = this$static.end):(nextIntervalStart = dynamicCast($peek(this$static.entries), 251).nextChange);
  }
  !this$static.interval?(this$static.interval = new AnnotationIntervalImpl_0(thisIntervalStart, nextIntervalStart, this$static.annotationsHere, this$static.diffFromLeft)):$set_4(this$static.interval, thisIntervalStart, nextIntervalStart, this$static.annotationsHere, this$static.diffFromLeft);
  this$static.intervalStart = nextIntervalStart;
  return this$static.interval;
}

function GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator_0(set, start, end, keys){
  this.entries = new PriorityQueue_0;
  checkPositionIndexesInRange(start, end, set.size_0());
  checkNotNull_1(keys, 'GenericAnnotationIntervalIterator: Key set must not be null');
  this.set = set;
  this.end = end;
  this.annotationsHere = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  this.diffFromLeft = new CollectionUtils$StringMapAdapter_0(new HashMap_0);
  this.intervalStart = start;
  if (start >= end) {
    this.first = false;
    return;
  }
  $each_3(keys, new GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$1_0(this, set, start, end));
}

function GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator(){
}

_ = GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator_0.prototype = GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator.prototype = new Object_0;
_.getClass$ = function getClass_933(){
  return Lorg_waveprotocol_wave_model_document_util_GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator_2_classLit;
}
;
_.hasNext = function hasNext_18(){
  return this.first || this.entries.heap.size != 0;
}
;
_.next_0 = function next_24(){
  return $next_23(this);
}
;
_.remove = function remove_42(){
  throw new UnsupportedOperationException_1('Removing an annotation interval is not supported');
}
;
_.castableTypeMap$ = {};
_.annotationsHere = null;
_.diffFromLeft = null;
_.end = 0;
_.first = true;
_.interval = null;
_.intervalStart = 0;
_.set = null;
function GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$1_0(this$1, val$set, val$start, val$end){
  this.this$1 = this$1;
  this.val$set = val$set;
  this.val$start = val$start;
  this.val$end = val$end;
}

function GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$1(){
}

_ = GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$1_0.prototype = GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$1.prototype = new Object_0;
_.apply_3 = function apply_79(key){
  var nextChange, startValue, valueLeft;
  startValue = this.val$set.getAnnotation(this.val$start, key);
  this.val$start == 0?(valueLeft = null):(valueLeft = this.val$set.getAnnotation(this.val$start - 1, key));
  if (valueLeft == null?startValue == null:equals__devirtual$(valueLeft, startValue))
  ;
  else {
    $put_5(this.this$1.diffFromLeft, key, startValue);
  }
  $put_5(this.this$1.annotationsHere, key, startValue);
  nextChange = this.val$set.firstAnnotationChange(this.val$start, this.val$end, key, startValue);
  if (nextChange == -1)
  ;
  else {
    $add_8(this.this$1.entries, new GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$KeyEntry_0(key, nextChange));
  }
}
;
_.getClass$ = function getClass_934(){
  return Lorg_waveprotocol_wave_model_document_util_GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
_.val$end = 0;
_.val$set = null;
_.val$start = 0;
--></script>
<script><!--
function GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$KeyEntry_0(key, nextChange){
  this.key = key;
  this.nextChange = nextChange;
}

function GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$KeyEntry(){
}

_ = GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$KeyEntry_0.prototype = GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$KeyEntry.prototype = new Object_0;
_.compareTo$ = function compareTo_12(other){
  return this.nextChange - dynamicCast(other, 251).nextChange;
}
;
_.getClass$ = function getClass_935(){
  return Lorg_waveprotocol_wave_model_document_util_GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$KeyEntry_2_classLit;
}
;
_.castableTypeMap$ = {61:1, 251:1};
_.key = null;
_.nextChange = 0;
function GenericRangedAnnotationIterable_0(a_0, start, end, keys){
  this.a_0 = a_0;
  this.start = start;
  this.end = end;
  this.keys = keys;
}

function GenericRangedAnnotationIterable(){
}

_ = GenericRangedAnnotationIterable_0.prototype = GenericRangedAnnotationIterable.prototype = new Object_0;
_.getClass$ = function getClass_936(){
  return Lorg_waveprotocol_wave_model_document_util_GenericRangedAnnotationIterable_2_classLit;
}
;
_.iterator_0 = function iterator_24(){
  return new GenericRangedAnnotationIterable$GenericRangedAnnotationIterator_0(this.a_0, this.start, this.end, this.keys);
}
;
_.castableTypeMap$ = {};
_.a_0 = null;
_.end = 0;
_.keys = null;
_.start = 0;
function $next_25(this$static){
  var entry;
  if (this$static.entries.heap.size == 0) {
    throw new NoSuchElementException_1('No more ranged annotations');
  }
  entry = dynamicCast($remove_9(this$static.entries), 252);
  !this$static.rangedAnnotation?(this$static.rangedAnnotation = new RangedAnnotationImpl_0(entry.key, entry.value_0, entry.start, entry.end)):$set_5(this$static.rangedAnnotation, entry.key, entry.value_0, entry.start, entry.end);
  entry.start = entry.end;
  if (entry.start < this$static.end) {
    entry.value_0 = this$static.a_0.getAnnotation(entry.start, entry.key);
    entry.end = this$static.a_0.firstAnnotationChange(entry.start, this$static.a_0.size_0(), entry.key, entry.value_0);
    entry.end == -1 && (entry.end = this$static.a_0.size_0());
    $add_8(this$static.entries, entry);
  }
  return this$static.rangedAnnotation;
}

function GenericRangedAnnotationIterable$GenericRangedAnnotationIterator_0(a_0, start, end, keys){
  this.entries = new PriorityQueue_0;
  checkPositionIndexesInRange(start, end, a_0.size_0());
  checkNotNull_1(keys, 'GenericRangedAnnotationIterator: Key set must not be null');
  this.a_0 = a_0;
  this.end = end;
  if (start >= end) {
    return;
  }
  $each_3(keys, new GenericRangedAnnotationIterable$GenericRangedAnnotationIterator$1_0(this, a_0, start));
}

function GenericRangedAnnotationIterable$GenericRangedAnnotationIterator(){
}

_ = GenericRangedAnnotationIterable$GenericRangedAnnotationIterator_0.prototype = GenericRangedAnnotationIterable$GenericRangedAnnotationIterator.prototype = new Object_0;
_.getClass$ = function getClass_937(){
  return Lorg_waveprotocol_wave_model_document_util_GenericRangedAnnotationIterable$GenericRangedAnnotationIterator_2_classLit;
}
;
_.hasNext = function hasNext_19(){
  return this.entries.heap.size != 0;
}
;
_.next_0 = function next_25(){
  return $next_25(this);
}
;
_.remove = function remove_43(){
  throw new UnsupportedOperationException_1('Removing a ranged annotation is not supported');
}
;
_.castableTypeMap$ = {};
_.a_0 = null;
_.end = 0;
_.rangedAnnotation = null;
function GenericRangedAnnotationIterable$GenericRangedAnnotationIterator$1_0(this$1, val$a, val$start){
  this.this$1 = this$1;
  this.val$a = val$a;
  this.val$start = val$start;
}

function GenericRangedAnnotationIterable$GenericRangedAnnotationIterator$1(){
}

_ = GenericRangedAnnotationIterable$GenericRangedAnnotationIterator$1_0.prototype = GenericRangedAnnotationIterable$GenericRangedAnnotationIterator$1.prototype = new Object_0;
_.apply_3 = function apply_80(key){
  var firstEnd, firstStart, firstValue;
  firstValue = this.val$a.getAnnotation(this.val$start, key);
  firstStart = this.val$a.lastAnnotationChange(0, this.val$start, key, firstValue);
  firstStart == -1 && (firstStart = 0);
  firstEnd = this.val$a.firstAnnotationChange(this.val$start, this.val$a.size_0(), key, firstValue);
  firstEnd == -1 && (firstEnd = this.val$a.size_0());
  $add_8(this.this$1.entries, new GenericRangedAnnotationIterable$GenericRangedAnnotationIterator$KeyEntry_0(key, firstStart, firstEnd, firstValue));
}
;
_.getClass$ = function getClass_938(){
  return Lorg_waveprotocol_wave_model_document_util_GenericRangedAnnotationIterable$GenericRangedAnnotationIterator$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
_.val$a = null;
_.val$start = 0;
function GenericRangedAnnotationIterable$GenericRangedAnnotationIterator$KeyEntry_0(key, initialStart, initialEnd, initialValue){
  this.key = key;
  this.start = initialStart;
  this.end = initialEnd;
  this.value_0 = initialValue;
}

function GenericRangedAnnotationIterable$GenericRangedAnnotationIterator$KeyEntry(){
}

_ = GenericRangedAnnotationIterable$GenericRangedAnnotationIterator$KeyEntry_0.prototype = GenericRangedAnnotationIterable$GenericRangedAnnotationIterator$KeyEntry.prototype = new Object_0;
_.compareTo$ = function compareTo_13(other){
  return this.start - dynamicCast(other, 252).start;
}
;
_.getClass$ = function getClass_939(){
  return Lorg_waveprotocol_wave_model_document_util_GenericRangedAnnotationIterable$GenericRangedAnnotationIterator$KeyEntry_2_classLit;
}
;
_.castableTypeMap$ = {61:1, 252:1};
_.end = 0;
_.key = null;
_.start = 0;
_.value_0 = null;
function $clinit_1384(){
  $clinit_1384 = nullMethod;
  lineContainerTagnames = new HashSet_0;
}

function appendLine(doc, attributes){
  $clinit_1384();
  var el, el$iterator, lc, line;
  checkArgument_0(!isUnsupportedParagraphDocument(doc), 'Paragraph docs no longer supported');
  lc = null;
  for (el$iterator = ($clinit_1350() , $iterator_14(iterate(doc, doc.doc.substrate.getDocumentElement(), null, REVERSE_DEPTH_FIRST_ELEMENT_ITERATOR))); el$iterator.next != null;) {
    el = $next_21(el$iterator);
    if (isLineContainer(doc, el)) {
      lc = el;
      break;
    }
  }
  if (lc == null) {
    lc = $appendXml(doc, $wrap_2($wrap_2(new XmlStringBuilderDoc_0(null, ($clinit_1271() , ANY)), 'line'), (checkState(topLevelContainerTagname != null, 'Top level line container tag name not set!') , topLevelContainerTagname)));
    line = $asElement_0(doc, doc.doc.substrate.getFirstChild_0(lc));
    !!attributes && $setElementAttributes(doc, line, attributes);
    return line;
  }
   else {
    return $createElement_1(doc, new Point$El_0(lc, null), attributes);
  }
}

function appendLine_0(doc, lineContainer, attributes){
  $clinit_1384();
  var line;
  line = $createElement_1(doc, new Point$El_0(lineContainer, null), attributes);
  return line;
}

function getRelatedLineElement(doc, at){
  $clinit_1384();
  var atStart;
  atStart = roundLocation(doc, ($clinit_1386() , LINE_2), at, ($clinit_1385() , LEFT_4));
  if (!atStart || $getNodeAfter(atStart) == null) {
    return null;
  }
  return doc.doc.substrate.asElement_0($getNodeAfter(atStart));
}

function isAtLineEnd(doc, point){
  $clinit_1384();
  return (checkNotNull_1(point, 'getLocation: Null point') , $getLocation_4(doc.doc, point)) == $getLocation_0(doc, roundLocation(doc, ($clinit_1386() , LINE_2), point, ($clinit_1385() , RIGHT_4)));
}

function isAtLineStart(doc, point){
  var el;
  $clinit_1384();
  var elementBefore;
  elementBefore = !point?null:point.offset >= 0?$getTextOffset(point) > 0?null:$asElement_0(doc, doc.doc.substrate.getPreviousSibling(point.container)):doc.doc.substrate.asElement_0(nodeBefore_0(doc, point.asElementPoint()));
  return elementBefore != null && (el = doc.doc.substrate.asElement_0(elementBefore) , el != null && $equals_3(doc.doc.substrate.getTagName(el), 'line'));
}

function isLineContainer(doc, node){
  $clinit_1384();
  var el;
  el = doc.asElement_0(node);
  return el != null && lineContainerTagnames.map.containsKey(doc.getTagName(el));
}

function isUnsupportedParagraphDocument(doc){
  var el;
  $clinit_1384();
  var child, root;
  if ($getFirstChild_1(doc, doc.doc.substrate.getDocumentElement()) == null) {
    return false;
  }
  root = doc.doc.substrate.getDocumentElement();
  for (child = doc.doc.substrate.getFirstChild_0(root); child != null; child = doc.doc.substrate.getNextSibling(child)) {
    if (el = doc.doc.substrate.asElement_0(child) , el != null && $equals_3(doc.doc.substrate.getTagName(el), 'p')) {
      return true;
    }
  }
  return false;
}

function roundLocation(doc, rounding, location_0, direction){
  var el, nodeAfter, nodeBefore, point, el_0, el_1;
  checkNotNull_1(direction, 'Rounding direction cannot be null.');
  switch (rounding.ordinal) {
    case 0:
      return location_0;
    case 1:
    case 2:
      throw new UnsupportedOperationException_1('Not implemented');
    case 3:
      checkArgument_0(!isUnsupportedParagraphDocument(doc), 'Paragraph docs no longer supported');
      point = jumpOut(doc, location_0);
      if (!point) {
        return null;
      }

      el = enclosingElement(doc, point.container);
      if (direction == ($clinit_1385() , RIGHT_4)) {
        nodeAfter = point.offset >= 0?doc.doc.substrate.getNextSibling(point.container):$getNodeAfter(point);
        while (nodeAfter != null && !(el_0 = doc.doc.substrate.asElement_0(nodeAfter) , el_0 != null && $equals_3(doc.doc.substrate.getTagName(el_0), 'line'))) {
          nodeAfter = doc.doc.substrate.getNextSibling(nodeAfter);
        }
        return new Point$El_0(el, nodeAfter);
      }
       else {
        nodeBefore = point.offset >= 0?doc.doc.substrate.getPreviousSibling(point.container):nodeBefore_0(doc, point.asElementPoint());
        while (nodeBefore != null && !(el_1 = doc.doc.substrate.asElement_0(nodeBefore) , el_1 != null && $equals_3(doc.doc.substrate.getTagName(el_1), 'line'))) {
          nodeBefore = doc.doc.substrate.getPreviousSibling(nodeBefore);
        }
        return nodeBefore == null?null:new Point$El_0(doc.doc.substrate.getParentElement(nodeBefore), nodeBefore);
      }

    default:throw new AssertionError_0('Missing rounding implementations');
  }
}

var lineContainerTagnames, topLevelContainerTagname = null;
function $clinit_1385(){
  $clinit_1385 = nullMethod;
  LEFT_4 = new LineContainers$RoundDirection_0('LEFT', 0);
  RIGHT_4 = new LineContainers$RoundDirection_0('RIGHT', 1);
  $VALUES_53 = initValues(_3Lorg_waveprotocol_wave_model_document_util_LineContainers$RoundDirection_2_classLit, {58:1, 138:1}, 123, [LEFT_4, RIGHT_4]);
}

function LineContainers$RoundDirection_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_54(){
  $clinit_1385();
  return $VALUES_53;
}

function LineContainers$RoundDirection(){
}

_ = LineContainers$RoundDirection_0.prototype = LineContainers$RoundDirection.prototype = new Enum;
_.getClass$ = function getClass_940(){
  return Lorg_waveprotocol_wave_model_document_util_LineContainers$RoundDirection_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 123:1};
var $VALUES_53, LEFT_4, RIGHT_4;
function $clinit_1386(){
  $clinit_1386 = nullMethod;
  NONE_5 = new LineContainers$Rounding_0('NONE', 0);
  WORD_1 = new LineContainers$Rounding_0('WORD', 1);
  SENTENCE_0 = new LineContainers$Rounding_0('SENTENCE', 2);
  LINE_2 = new LineContainers$Rounding_0('LINE', 3);
  $VALUES_54 = initValues(_3Lorg_waveprotocol_wave_model_document_util_LineContainers$Rounding_2_classLit, {58:1, 138:1}, 124, [NONE_5, WORD_1, SENTENCE_0, LINE_2]);
}

function LineContainers$Rounding_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_55(){
  $clinit_1386();
  return $VALUES_54;
}

function LineContainers$Rounding(){
}

_ = LineContainers$Rounding_0.prototype = LineContainers$Rounding.prototype = new Enum;
_.getClass$ = function getClass_941(){
  return Lorg_waveprotocol_wave_model_document_util_LineContainers$Rounding_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 124:1};
var $VALUES_54, LINE_2, NONE_5, SENTENCE_0, WORD_1;
function PersistentContent$HardContent_0(this$0){
  this.this$0 = this$0;
  FilteredView_0.call(this, this$0.fullDoc);
}

function PersistentContent$HardContent(){
}

_ = PersistentContent$HardContent_0.prototype = PersistentContent$HardContent.prototype = new FilteredView;
_.getClass$ = function getClass_942(){
  return Lorg_waveprotocol_wave_model_document_util_PersistentContent$HardContent_2_classLit;
}
;
_.getSkipLevel = function getSkipLevel_4(node){
  var element;
  element = this.inner_0.asElement_0(node);
  return element == null || $isHard(this.this$0, element)?($clinit_1371() , NONE_4):$getSkipLevel_0(this.this$0, node);
}
;
_.castableTypeMap$ = {109:1, 121:1, 122:1, 125:1};
_.this$0 = null;
function $equals_6(this$static, obj){
  var other;
  if (this$static === obj) {
    return true;
  }
  if (obj == null) {
    return false;
  }
  if (this$static.getClass$() != getClass__devirtual$(obj)) {
    return false;
  }
  other = dynamicCast(obj, 248);
  if (this$static.container == null) {
    if (other.container != null) {
      return false;
    }
  }
   else if (!equals__devirtual$(this$static.container, other.container)) {
    return false;
  }
  if (this$static.nodeAfter == null) {
    if (other.nodeAfter != null) {
      return false;
    }
  }
   else if (!equals__devirtual$(this$static.nodeAfter, other.nodeAfter)) {
    return false;
  }
  if (this$static.offset != other.offset) {
    return false;
  }
  return true;
}

function $getNodeAfter(this$static){
  if (this$static.offset >= 0) {
    throw new IllegalStateException_1('getNodeAfter() can only be called on points within elements');
  }
  return this$static.nodeAfter;
}

function $getTextOffset(this$static){
  if (this$static.offset < 0) {
    throw new IllegalStateException_1('getOffset() can only be called on points within text nodes');
  }
  return this$static.offset;
}

function $hashCode_3(this$static){
  var result;
  result = 31 + (this$static.container == null?0:hashCode__devirtual$(this$static.container));
  result = 31 * result + (this$static.nodeAfter == null?0:hashCode__devirtual$(this$static.nodeAfter));
  result = 31 * result + this$static.offset;
  return result;
}

function after_1(doc, node){
  return new Point$El_0($getParentElement_3(doc, node), $getNextSibling_3(doc, node));
}

function before_0(doc, node){
  return new Point$El_0(doc.getParentElement(node), node);
}

function checkOffset(doc, textNode, offset, msgPrefix){
  checkNotNull_1(textNode, 'Container must not be null');
  if (offset < 0 || offset > doc.getLength(textNode)) {
    throw new IllegalArgumentException_1(msgPrefix + ": offset '" + offset + "' is not inside text node, length " + doc.getLength(textNode) + ", text: '" + doc.getData(textNode) + "'");
  }
}

function checkRelationship(doc, parent_0, nodeAfter, msgPrefix){
  checkNotNull_1(parent_0, 'Container must not be null');
  if (nodeAfter != null && maskUndefined(doc.getParentElement(nodeAfter)) !== (parent_0 == null?null:parent_0)) {
    throw new IllegalArgumentException_1(msgPrefix + ': nodeAfter must be null or a child of parent');
  }
}

function elementAfter(doc, point){
  return point.offset >= 0?$getTextOffset(point) < doc.getLength(point.container)?null:doc.asElement_0(doc.getNextSibling(point.container)):doc.asElement_0($getNodeAfter(point));
}

function elementEndingAt_1(doc, point){
  return point.offset >= 0?$getTextOffset(point) < doc.substrate.getLength(point.container)?null:doc.substrate.getNextSibling(point.container) == null?doc.substrate.getParentElement(point.container):null:$getNodeAfter(point) == null?point.container:null;
}

function enclosingElement(doc, node){
  var el;
  el = doc.asElement_0(node);
  return el == null?doc.getParentElement(node):el;
}

function nodeBefore_0(doc, point){
  var node;
  node = $getNodeAfter(point);
  return node == null?doc.getLastChild_0(point.container):doc.getPreviousSibling(node);
}

function start_5(doc, element){
  return new Point$El_0(element, doc.getFirstChild_0(element));
}

function textOrElementStart(doc, node){
  var elt;
  elt = doc.inner_0.asElement_0(node);
  return elt == null?new Point$Tx_0(node, 0):new Point$El_0(elt, doc.inner_0.getFirstChild_0(elt));
}

function Point(){
}

_ = Point.prototype = new Object_0;
_.equals$ = function equals_27(obj){
  return $equals_6(this, obj);
}
;
_.getClass$ = function getClass_943(){
  return Lorg_waveprotocol_wave_model_document_util_Point_2_classLit;
}
;
_.hashCode$ = function hashCode_27(){
  return $hashCode_3(this);
}
;
_.toString$ = function toString_76(){
  return '{' + this.container + '~' + (this.offset >= 0?$getTextOffset(this) + '':$getNodeAfter(this) + '') + '}';
}
;
_.castableTypeMap$ = {248:1};
_.container = null;
_.nodeAfter = null;
_.offset = 0;
function Point$El_0(container, nodeAfter){
  checkNotNull_1(container, 'Container must not be null');
  this.container = container;
  this.nodeAfter = nodeAfter;
  this.offset = -1;
}

function Point$El(){
}

_ = Point$El_0.prototype = Point$El.prototype = new Point;
_.asElementPoint = function asElementPoint_1(){
  return this;
}
;
_.asTextPoint = function asTextPoint(){
  return null;
}
;
_.getClass$ = function getClass_944(){
  return Lorg_waveprotocol_wave_model_document_util_Point$El_2_classLit;
}
;
_.castableTypeMap$ = {248:1};
function Point$Tx_0(container, offset){
  checkNotNull_1(container, 'Container must not be null');
  this.container = container;
  this.nodeAfter = null;
  this.offset = offset;
}

function Point$Tx(){
}

_ = Point$Tx_0.prototype = Point$Tx.prototype = new Point;
_.asElementPoint = function asElementPoint_2(){
  return null;
}
;
_.asTextPoint = function asTextPoint_0(){
  return this;
}
;
_.getClass$ = function getClass_945(){
  return Lorg_waveprotocol_wave_model_document_util_Point$Tx_2_classLit;
}
;
_.castableTypeMap$ = {248:1};
function $appendAttributes(this$static, doc, element){
  var $e0, attribute, attribute$iterator, attributes, name_0, name$array, name$index, name$max, value;
  try {
    attributes = doc.getAttributes(element);
    for (attribute$iterator = attributes.entrySet_0().iterator_0(); attribute$iterator.hasNext();) {
      attribute = dynamicCast(attribute$iterator.next_0(), 66);
      $append_5(this$static.builder, ' ' + dynamicCast(attribute.getKey(), 1) + "='" + dynamicCast(attribute.getValue(), 1) + "'");
    }
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 143)) {
      for (name$array = initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['class', 'src', 'id', 'type', 'name', 'for', 'href', 'target']) , name$index = 0 , name$max = name$array.length; name$index < name$max; ++name$index) {
        name_0 = name$array[name$index];
        value = doc.getAttribute_0(element, name_0);
        value != null && value.length > 0 && $append_5(this$static.builder, ' ' + name_0 + "='" + value + "'");
      }
    }
     else 
      throw $e0;
  }
}

function $appendElement(this$static, doc, element){
  var child, first, firstChild, next;
  firstChild = doc.getFirstChild_0(element);
  if (firstChild == null) {
    $appendStartTag(this$static, doc, element, true);
  }
   else {
    $appendStartTag(this$static, doc, element, false);
    child = firstChild;
    first = true;
    ++this$static.indent;
    while (child != null) {
      next = doc.getNextSibling(child);
      (first && !$isInline(doc, element) || !$isInline(doc, child)) && $appendNewLine(this$static);
      $appendNode(this$static, doc, child);
      first = false;
      child = next;
    }
    --this$static.indent;
    (!$isInline(doc, element) || !$isInline(doc, firstChild)) && $appendNewLine(this$static);
    $append_5(this$static.builder, '<\/');
    $append_5(this$static.builder, doc.getTagName(element).toLowerCase());
    $append_5(this$static.builder, '>');
  }
}

function $appendNewLine(this$static){
  var i;
  $append_5(this$static.builder, '\n');
  for (i = 0; i < this$static.indent; ++i) {
    $append_5(this$static.builder, '  ');
  }
}

function $appendNode(this$static, doc, node){
  var element, text, endOffset, value;
  element = doc.asElement_0(node);
  if (element != null) {
    $appendElement(this$static, doc, element);
    return;
  }
  text = doc.asText_0(node);
  if (text != null) {
    value = $replaceAll($replaceAll(doc.getData(text), '\xA0', '\u25AA'), ' ', '\u25AB');
    endOffset = value.length;
    $append_3(this$static.builder, 39);
    $append_5(this$static.builder, value.substr(0, 0 - 0));
    $append_5(this$static.builder, '');
    $append_5(this$static.builder, value.substr(0, endOffset - 0));
    $append_5(this$static.builder, '');
    $append_5(this$static.builder, $substring_0(value, endOffset, value.length));
    $append_3(this$static.builder, 39);
    return;
  }
}

function $appendStartTag(this$static, doc, element, selfClosing){
  $append_5(this$static.builder, '<');
  $append_5(this$static.builder, doc.getTagName(element).toLowerCase());
  $appendAttributes(this$static, doc, element);
  $append_5(this$static.builder, selfClosing?'/>':'>');
}

function $isInline(doc, node){
  var element, text;
  element = doc.asElement_0(node);
  text = doc.asText_0(node);
  return text != null || '|b|u|i|'.indexOf('|' + doc.getTagName(element).toLowerCase() + '|') != -1;
}

function $print(this$static, doc){
  this$static.indent = 0;
  this$static.builder.impl.string.length > 0 && (this$static.builder = new StringBuilder_0);
  $appendElement(this$static, doc, doc.getDocumentElement());
  return this$static.builder.impl.string;
}

function $print_0(this$static, doc, node){
  this$static.indent = 0;
  this$static.builder.impl.string.length > 0 && (this$static.builder = new StringBuilder_0);
  $appendNode(this$static, doc, node);
  return this$static.builder.impl.string;
}

function Pretty_0(){
  this.builder = new StringBuilder_0;
}

function Pretty(){
}

_ = Pretty_0.prototype = Pretty.prototype = new Object_0;
_.getClass$ = function getClass_946(){
  return Lorg_waveprotocol_wave_model_document_util_Pretty_2_classLit;
}
;
_.castableTypeMap$ = {};
_.indent = 0;
function Property(){
}

_ = Property.prototype = new Object_0;
_.getClass$ = function getClass_947(){
  return Lorg_waveprotocol_wave_model_document_util_Property_2_classLit;
}
;
_.castableTypeMap$ = {};
_.id_0 = 0;
_.name_0 = null;
var uniqueId = 0;
function Property$ImmutableProperty_0(debugName){
  this.id_0 = ++uniqueId;
  this.name_0 = debugName;
}

function Property$ImmutableProperty(){
}

_ = Property$ImmutableProperty_0.prototype = Property$ImmutableProperty.prototype = new Property;
_.getClass$ = function getClass_948(){
  return Lorg_waveprotocol_wave_model_document_util_Property$ImmutableProperty_2_classLit;
}
;
_.toString$ = function toString_77(){
  return 'ImmutableProperty[' + this.name_0 + ']';
}
;
_.castableTypeMap$ = {};
function Property$MutableProperty_0(debugName){
  this.id_0 = ++uniqueId;
  this.name_0 = debugName;
}

function Property$MutableProperty(){
}

_ = Property$MutableProperty_0.prototype = Property$MutableProperty.prototype = new Property;
_.getClass$ = function getClass_949(){
  return Lorg_waveprotocol_wave_model_document_util_Property$MutableProperty_2_classLit;
}
;
_.toString$ = function toString_78(){
  return 'MutableProperty[' + this.name_0 + ']';
}
;
_.castableTypeMap$ = {};
function Range_2(start, end){
  (start < 0 || start > end) && illegalArgument('Bad range: (' + start + ', ' + end + ')');
  this.start = start;
  this.end = end;
}

function Range_1(){
}

_ = Range_2.prototype = Range_1.prototype = new Object_0;
_.equals$ = function equals_28(obj){
  var other;
  if (this === obj)
    return true;
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[254]))
    return false;
  other = dynamicCast(obj, 254);
  if (this.end != other.end)
    return false;
  if (this.start != other.start)
    return false;
  return true;
}
;
_.getClass$ = function getClass_950(){
  return Lorg_waveprotocol_wave_model_document_util_Range_2_classLit;
}
;
_.hashCode$ = function hashCode_28(){
  return this.start + 37 * this.end;
}
;
_.toString$ = function toString_79(){
  return 'Range(' + this.start + (this.start == this.end?'':'-' + this.end) + ')';
}
;
_.castableTypeMap$ = {254:1};
_.end = 0;
_.start = 0;
function $clinit_1397(){
  $clinit_1397 = nullMethod;
  trackValue = new Object_1;
}

function $clearRange(this$static){
  this$static.isTracking = false;
  $resetAnnotation(this$static.annotations, 0, this$static.annotations.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1, this$static.startKey, null);
  $resetAnnotation(this$static.annotations, 0, this$static.annotations.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1, this$static.endKey, null);
}

function $getFocusedRange(this$static){
  var end, size, start;
  if (!this$static.isTracking) {
    return null;
  }
  size = this$static.annotations.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1;
  start = firstAnnotationBoundary(this$static.annotations, size, this$static.startKey);
  end = firstAnnotationBoundary(this$static.annotations, size, this$static.endKey);
  return new FocusedRange_0(start, end);
}

function $trackRange(this$static, range){
  var size;
  this$static.isTracking = true;
  size = this$static.annotations.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1;
  $resetAnnotation(this$static.annotations, range.start, size, this$static.startKey, trackValue);
  $resetAnnotation(this$static.annotations, range.end, size, this$static.endKey, trackValue);
}

function $trackRange_0(this$static, range){
  var size;
  this$static.isTracking = true;
  size = this$static.annotations.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1;
  $resetAnnotation(this$static.annotations, range.anchor, size, this$static.startKey, trackValue);
  $resetAnnotation(this$static.annotations, range.focus_0, size, this$static.endKey, trackValue);
}

function RangeTracker_0(localAnnotationSet, debugPrefix){
  $clinit_1397();
  this.annotations = localAnnotationSet;
  this.startKey = '@' + prefixIncrementor++ + '/' + debugPrefix;
  this.endKey = '@' + prefixIncrementor++ + '/' + debugPrefix;
}

function RangeTracker(){
}

_ = RangeTracker_0.prototype = RangeTracker.prototype = new Object_0;
_.getClass$ = function getClass_951(){
  return Lorg_waveprotocol_wave_model_document_util_RangeTracker_2_classLit;
}
;
_.castableTypeMap$ = {165:1};
_.annotations = null;
_.endKey = null;
_.isTracking = false;
_.startKey = null;
var trackValue;
function $set_5(this$static, key, value, start, end){
  checkPositionIndexesInRange(start, end, 2147483647);
  checkNotNull_1(key, 'key must not be null');
  if (start >= end) {
    throw new IllegalArgumentException_1('Attempt to set RangedAnnotation to zero length');
  }
  this$static.key = key;
  this$static.value_0 = value;
  this$static.start = start;
  this$static.end = end;
}

function RangedAnnotationImpl_0(key, value, start, end){
  $set_5(this, key, value, start, end);
}

function RangedAnnotationImpl(){
}

_ = RangedAnnotationImpl_0.prototype = RangedAnnotationImpl.prototype = new Object_0;
_.getClass$ = function getClass_952(){
  return Lorg_waveprotocol_wave_model_document_util_RangedAnnotationImpl_2_classLit;
}
;
_.toString$ = function toString_80(){
  return 'RangedAnnotationImpl(' + this.key + ', ' + this.value_0 + ', ' + this.start + ', ' + this.end + ')';
}
;
_.castableTypeMap$ = {142:1};
_.end = 0;
_.key = null;
_.start = 0;
_.value_0 = null;
function $checkComplete(this$static){
  checkState(this$static.nodeWalker.next == null, 'Tree Walker: Did not end walk at the correct node');
  return this$static.nodeWalker.next == null;
}

function $checkElement(this$static, tagName, attributes){
  var element;
  checkState(this$static.nodeWalker.next != null, 'Tree Walker: no more nodes to walk, element expected');
  this$static.currentNode = $next_21(this$static.nodeWalker);
  element = this$static.document_0.inner_0.asElement_0(this$static.currentNode);
  checkState(element != null, 'Tree Walker: At text node, element expected');
  checkState($equals_3(this$static.document_0.inner_0.getTagName(element), tagName), 'Tree Walker: Incorrect tag name');
  checkState(equal_0(this$static.document_0.inner_0.getAttributes(element), attributes), 'Tree Walker: Incorrect attributes');
  return element;
}

function $checkTextNode(this$static, data){
  var textNode;
  checkState(this$static.nodeWalker.next != null, 'Tree Walker: no more nodes to walk, text node expected');
  this$static.currentNode = $next_21(this$static.nodeWalker);
  textNode = this$static.document_0.inner_0.asText_0(this$static.currentNode);
  checkState(textNode != null, 'Tree Walker: At element, text node expected');
  checkState($equals_3(this$static.document_0.inner_0.getData(textNode), data), 'Tree Walker: Incorrect text node data');
  return textNode;
}

function ReadableTreeWalker_0(document_0, rootNode){
  ReadableTreeWalker_1.call(this, document_0, iterate(document_0, rootNode, getNextOrPrevNodeDepthFirst_1(document_0, rootNode, null, false, true), ($clinit_1350() , $clinit_1350() , FORWARD_DEPTH_FIRST_ITERATOR)));
}

function ReadableTreeWalker_1(document_0, nodeIterable){
  this.document_0 = document_0;
  this.nodeWalker = new DocIterate$1$1_0(nodeIterable.val$startNode, nodeIterable.val$iterateFunction, nodeIterable.val$doc, nodeIterable.val$stopAt);
}

function ReadableTreeWalker(){
}

_ = ReadableTreeWalker_0.prototype = ReadableTreeWalker.prototype = new Object_0;
_.getClass$ = function getClass_953(){
  return Lorg_waveprotocol_wave_model_document_util_ReadableTreeWalker_2_classLit;
}
;
_.castableTypeMap$ = {};
--></script>
<script><!--
_.currentNode = null;
_.document_0 = null;
_.nodeWalker = null;
function $wrap_1(this$static, tagName, attribs){
  var attribList;
  attribList = new ArrayList_0;
  $each_2(attribs, new XmlStringBuilder$1_0(attribList));
  return $wrap_3(this$static, tagName, dynamicCast($toArray_1(attribList, initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, attribs.backend.size_0() * 2, 0)), 234));
}

function createChildren(view, element){
  return $appendChildXmlFragment(new XmlStringBuilderDoc_0(view, ($clinit_1271() , ANY)), element);
}

function createFromXmlStringWithContraints(xmlContent, permittedChars){
  return innerXml($parse(($clinit_1364() , xmlContent)), permittedChars);
}

function createNode(view, node){
  return $appendNode_0(new XmlStringBuilderDoc_0(view, ($clinit_1271() , ANY)), node);
}

function innerXml(doc, permittedChars){
  return $appendChildXmlFragment(new XmlStringBuilderDoc_0(doc, permittedChars), doc.substrate.getDocumentElement());
}

function innerXml1(doc){
  return createChildren(doc, doc.getDocumentElement());
}

function XmlStringBuilder(){
}

_ = XmlStringBuilder.prototype = new Object_0;
_.getClass$ = function getClass_954(){
  return Lorg_waveprotocol_wave_model_document_util_XmlStringBuilder_2_classLit;
}
;
_.castableTypeMap$ = {};
function $apply_22(this$static, key, value){
  checkNotNull_1(key, 'key should not be null be null');
  checkNotNull_1(value, 'value should not be null be null');
  $add_9(this$static.val$attribList, key);
  $add_9(this$static.val$attribList, value);
}

function XmlStringBuilder$1_0(val$attribList){
  this.val$attribList = val$attribList;
}

function XmlStringBuilder$1(){
}

_ = XmlStringBuilder$1_0.prototype = XmlStringBuilder$1.prototype = new Object_0;
_.apply_0 = function apply_81(key, value){
  $apply_22(this, key, dynamicCast(value, 1));
}
;
_.getClass$ = function getClass_955(){
  return Lorg_waveprotocol_wave_model_document_util_XmlStringBuilder$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$attribList = null;
function $addChildXmlFragment(this$static, element){
  var n, size;
  size = 0;
  for (n = this$static.view.getFirstChild_0(element); n != null; n = this$static.view.getNextSibling(n)) {
    size += $addNode(this$static, n);
  }
  return size;
}

function $addNode(this$static, node){
  var data, element, len, selfClosing;
  element = this$static.view.asElement_0(node);
  if (element != null) {
    selfClosing = $equals_3(this$static.view.getTagName(element), 'br') && this$static.view.getFirstChild_0(element) == null;
    $append_8(this$static.builder, '<' + this$static.view.getTagName(element) + $getAttributesString(this$static, element) + (selfClosing?'/>':'>'));
    len = 2;
    if (!selfClosing) {
      len += $addChildXmlFragment(this$static, element);
      $append_8(this$static.builder, '<\/' + this$static.view.getTagName(element) + '>');
    }
    return len;
  }
   else {
    data = this$static.view.getData(this$static.view.asText_0(node));
    return $addText(this$static, this$static.permittedChars.coerceString(data));
  }
}

function $addText(this$static, text){
  $append_8(this$static.builder, $replaceAll($replaceAll($replaceAll(text, '&', '&amp;'), '<', '&lt;'), '>', '&gt;'));
  return text.length;
}

function $append_10(this$static, xml){
  var seq;
  if (xml) {
    seq = xml.builder;
    $append_5(this$static.builder, seq);
  }
   else {
    $append_8(this$static.builder, null.nullField);
  }
  this$static.length_0 += xml.length_0;
  return this$static;
}

function $appendChildXmlFragment(this$static, element){
  this$static.length_0 += $addChildXmlFragment(this$static, element);
  return this$static;
}

function $appendNode_0(this$static, node){
  this$static.length_0 += $addNode(this$static, node);
  return this$static;
}

function $appendText_0(this$static, text){
  var result;
  this$static.length_0 += $addText(this$static, (result = new StringBuilder_0 , traverseUtf16String(text, new DocumentSchema$PermittedCharacters$2$1_0(result)) , result.impl.string));
  return this$static;
}

function $getAttributesString(this$static, element){
  var attributes, key, key$iterator, soFar;
  attributes = this$static.view.getAttributes(element);
  soFar = '';
  for (key$iterator = attributes.keySet_0().iterator_0(); key$iterator.hasNext();) {
    key = dynamicCast(key$iterator.next_0(), 1);
    soFar += ' ' + key + '="' + $replaceAll($replaceAll($replaceAll($replaceAll($replaceAll(dynamicCast(attributes.get(key), 1), '&', '&amp;'), '<', '&lt;'), '>', '&gt;'), '"', '&quot;'), "'", '&apos;') + '"';
  }
  return soFar;
}

function $wrap_2(this$static, tagName){
  isXmlName_0(tagName) || illegalArgument("Invalid tag name: '" + tagName + "'");
  $insert_0(this$static.builder, 0, '<' + tagName + '>');
  $append_8(this$static.builder, '<\/' + tagName + '>');
  this$static.length_0 += 2;
  return this$static;
}

function $wrap_3(this$static, tagName, attribs){
  var attrName, i, startTag;
  isXmlName_0(tagName) || illegalArgument("Invalid tag name: '" + tagName + "'");
  checkArgument_0(attribs.length % 2 == 0, 'Attribs must come in string pairs');
  startTag = '<' + tagName;
  for (i = 0; i < attribs.length; i += 2) {
    if (attribs[i + 1] != null) {
      attrName = attribs[i];
      isXmlName_0(attrName) || illegalArgument("Invalid attribute name: '" + attrName + "'");
      startTag += ' ' + attrName + '="' + $replaceAll($replaceAll($replaceAll($replaceAll($replaceAll(attribs[i + 1], '&', '&amp;'), '<', '&lt;'), '>', '&gt;'), '"', '&quot;'), "'", '&apos;') + '"';
    }
  }
  startTag += '>';
  $insert_0(this$static.builder, 0, startTag);
  $append_8(this$static.builder, '<\/' + tagName + '>');
  this$static.length_0 += 2;
  return this$static;
}

function XmlStringBuilderDoc_0(view, permittedChars){
  this.builder = new StringBuilder_0;
  this.view = view;
  this.permittedChars = permittedChars;
}

function XmlStringBuilderDoc(){
}

_ = XmlStringBuilderDoc_0.prototype = XmlStringBuilderDoc.prototype = new XmlStringBuilder;
_.equals$ = function equals_29(o){
  if (o === this) {
    return true;
  }
  if (o != null && o.castableTypeMap$ && !!o.castableTypeMap$[255]) {
    return $equals_3(this.builder.impl.string, dynamicCast(o, 255).builder.impl.string) && this.length_0 == dynamicCast(o, 255).length_0;
  }
  return false;
}
;
_.getClass$ = function getClass_956(){
  return Lorg_waveprotocol_wave_model_document_util_XmlStringBuilderDoc_2_classLit;
}
;
_.hashCode$ = function hashCode_29(){
  return getHashCode_0(this.builder.impl.string);
}
;
_.toString$ = function toString_81(){
  return this.builder.impl.string;
}
;
_.castableTypeMap$ = {255:1};
_.length_0 = 0;
_.permittedChars = null;
_.view = null;
function $deserialiseWaveId(serialisedForm){
  var $e0;
  try {
    return $deserialiseWaveId_1(serialisedForm);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 161)) {
      return $deserialiseWaveId_0(serialisedForm);
    }
     else 
      throw $e0;
  }
}

function isConversationalId(waveletId){
  var tokens, tokens_0;
  return $equals_3((tokens = $split_0(($clinit_1410() , DEFAULT_ESCAPER), waveletId.id_0) , tokens.length > 1?tokens[0]:''), 'conv') || $isEmpty_0((tokens_0 = $split_0(DEFAULT_ESCAPER, waveletId.id_0) , tokens_0.length > 1?tokens_0[0]:''));
}

function InvalidIdException_0(id, message){
  this.fillInStackTrace();
  this.detailMessage = message;
  this.id_0 = id;
}

function InvalidIdException(){
}

_ = InvalidIdException_0.prototype = InvalidIdException.prototype = new Exception;
_.getClass$ = function getClass_957(){
  return Lorg_waveprotocol_wave_model_id_InvalidIdException_2_classLit;
}
;
_.getMessage = function getMessage_1(){
  return "Invalid id '" + this.id_0 + "': " + this.detailMessage;
}
;
_.castableTypeMap$ = {3:1, 58:1, 143:1, 161:1};
_.id_0 = null;
function $deserialiseWaveId_0(serialisedForm){
  var $e0, ex, parts;
  parts = $splitWithoutUnescaping(($clinit_1410() , DEFAULT_ESCAPER), 33, serialisedForm);
  if (parts.length != 2 || !parts[0].length || !parts[1].length) {
    throw new InvalidIdException_0(serialisedForm, 'Wave id must be of the form <domain>!<id>');
  }
  try {
    return checkNotNull_1(parts[0], 'Null domain') , checkNotNull_1(parts[1], 'Null id') , checkArgument_0(!!parts[0].length, 'Empty domain') , checkArgument_0(!!parts[1].length, 'Empty id') , $hasEscapeCharacters(DEFAULT_ESCAPER, parts[0]) && illegalArgument('Domain cannot contain characters that requires escaping: ' + parts[0]) , $isEscapedProperly(DEFAULT_ESCAPER, parts[1]) || illegalArgument('Id is not properly escaped: ' + parts[1]) , new WaveId_0(parts[0], parts[1]);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 202)) {
      ex = $e0;
      throw new InvalidIdException_0(serialisedForm, ex.detailMessage);
    }
     else 
      throw $e0;
  }
}

function $deserialiseWaveId_1(serialisedForm){
  var tokens;
  tokens = $split(serialisedForm, '/', 0);
  if (tokens.length != 2) {
    throw new InvalidIdException_0(serialisedForm, "Required 2 '/'-separated tokens in serialised wave id: " + serialisedForm);
  }
  return ofChecked(tokens[0], tokens[1]);
}

function $deserialiseWaveletId(serialisedForm){
  var tokens;
  tokens = $split(serialisedForm, '/', 0);
  if (tokens.length != 2) {
    throw new InvalidIdException_0(serialisedForm, "Required 2 '/'-separated tokens in serialised wavelet id: " + serialisedForm);
  }
  return ofChecked_0(tokens[0], tokens[1]);
}

function $serialiseWaveId(id){
  checkArgument_1(isValidDomain(id.domain), 'Invalid domain %s', initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, [id.domain]));
  checkArgument_1(isValidIdentifier(id.id_0), 'Invalid id %s', initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, [id.id_0]));
  return $append_8($append_8(new StringBuilder_2(id.domain), '/'), id.id_0).impl.string;
}

function $serialiseWaveletId(id){
  checkArgument_1(isValidDomain(id.domain), 'Invalid domain %s', initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, [id.domain]));
  checkArgument_1(isValidIdentifier(id.id_0), 'Invalid id %s', initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, [id.id_0]));
  return $append_8($append_8(new StringBuilder_2(id.domain), '/'), id.id_0).impl.string;
}

function $clinit_1410(){
  $clinit_1410 = nullMethod;
  DEFAULT_ESCAPER = new SimplePrefixEscaper_0(initValues(_3C_classLit, {58:1}, -1, [43, 33]));
  EMPTY_STRING_ARRAY = initDim(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, 0, 0);
}

function $hasEscapeCharacters(this$static, unescaped){
  var i;
  for (i = 0; i < unescaped.length; ++i) {
    if (this$static.needsEscaping.map.containsKey(valueOf(unescaped.charCodeAt(i)))) {
      return true;
    }
  }
  return false;
}

function $isEscapedProperly(this$static, escapedValue){
  var c, i;
  for (i = 0; i < escapedValue.length; ++i) {
    c = escapedValue.charCodeAt(i);
    if (c == this$static.prefix_0) {
      if (i >= escapedValue.length - 1 || !this$static.needsEscaping.map.containsKey(valueOf(escapedValue.charCodeAt(i + 1)))) {
        return false;
      }
       else {
        ++i;
      }
    }
     else if (c != 43 && this$static.needsEscaping.map.containsKey(valueOf(c))) {
      return false;
    }
  }
  return true;
}

function $split_0(this$static, toSplit){
  var i, ret;
  ret = $splitWithoutUnescaping(this$static, 43, toSplit);
  for (i = 0; i < ret.length; ++i) {
    ret[i] = $unescape(this$static, ret[i]);
  }
  return ret;
}

function $splitWithoutUnescaping(this$static, separator, toSplit){
  var end, ret, start;
  if (separator == this$static.prefix_0) {
    throw new IllegalArgumentException_1("It's unsafe to split strings together the prefix char.");
  }
  ret = new ArrayList_0;
  start = 0;
  while (start <= toSplit.length) {
    end = start;
    while (end < toSplit.length && toSplit.charCodeAt(end) != separator) {
      end += toSplit.charCodeAt(end) == this$static.prefix_0?2:1;
    }
    end >= toSplit.length && (end = toSplit.length);
    $add_9(ret, toSplit.substr(start, end - start));
    start = end + 1;
  }
  return dynamicCast($toArray_1(ret, EMPTY_STRING_ARRAY), 234);
}

function $unescape(this$static, toUnescape){
  var cache, i;
  cache = new StringBuilder_1(~~(toUnescape.length / 2));
  for (i = 0; i < toUnescape.length; ++i) {
    if (toUnescape.charCodeAt(i) == this$static.prefix_0) {
      if (i + 1 >= toUnescape.length) {
        throw new IllegalArgumentException_1('The value to unescape cannot be terminated with the prefix: ' + String.fromCharCode(this$static.prefix_0));
      }
      if (!this$static.needsEscaping.map.containsKey(valueOf(toUnescape.charCodeAt(i + 1)))) {
        throw new IllegalArgumentException_1('The value to unescape is not a properly escaped value. The prefix charater is not followed by a character at needs prefixing: ' + toUnescape);
      }
      ++i;
    }
     else if (this$static.needsEscaping.map.containsKey(valueOf(toUnescape.charCodeAt(i)))) {
      throw new IllegalArgumentException_1('The value to unescape is not a properly escaped value. Some chars are found unescaped: ' + toUnescape);
    }
    $append_3(cache, toUnescape.charCodeAt(i));
  }
  return cache.impl.string;
}

function SimplePrefixEscaper_0(needsEscaping){
  var s, s$index, s$max;
  this.needsEscaping = new HashSet_0;
  this.prefix_0 = 126;
  $add_11(this.needsEscaping, valueOf(126));
  for (s$index = 0 , s$max = needsEscaping.length; s$index < s$max; ++s$index) {
    s = needsEscaping[s$index];
    $add_11(this.needsEscaping, valueOf(s));
  }
}

function SimplePrefixEscaper(){
}

_ = SimplePrefixEscaper_0.prototype = SimplePrefixEscaper.prototype = new Object_0;
_.getClass$ = function getClass_958(){
  return Lorg_waveprotocol_wave_model_id_SimplePrefixEscaper_2_classLit;
}
;
_.castableTypeMap$ = {};
_.prefix_0 = 0;
var DEFAULT_ESCAPER, EMPTY_STRING_ARRAY;
function $compareTo_12(this$static, other){
  var domainCompare;
  domainCompare = compareTo_5(this$static.domain, other.domain);
  return domainCompare == 0?compareTo_5(this$static.id_0, other.id_0):domainCompare;
}

function $hashCode_4(this$static){
  var result;
  result = 31 + getHashCode_0(this$static.domain);
  result = 31 * result + getHashCode_0(this$static.id_0);
  return result;
}

function WaveId_0(domain, id){
  this.domain = String(domain);
  this.id_0 = id;
}

function ofChecked(domain, id){
  checkNotNull_1(domain, 'Null domain');
  checkNotNull_1(id, 'Null id');
  if (!isValidDomain(domain)) {
    throw new InvalidIdException_0(domain, 'Invalid domain');
  }
  $clinit_1412();
  if (!(!!id.length && traverseUtf16String(id, GOOD_UTF16_FOR_ID).value_0)) {
    throw new InvalidIdException_0(id, 'Invalid id');
  }
  return new WaveId_0(domain, id);
}

function WaveId(){
}

_ = WaveId_0.prototype = WaveId.prototype = new Object_0;
_.compareTo$ = function compareTo_14(other){
  return $compareTo_12(this, dynamicCast(other, 256));
}
;
_.equals$ = function equals_30(obj){
  var other;
  if (this === obj)
    return true;
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[256]))
    return false;
  other = dynamicCast(obj, 256);
  return $equals_3(this.domain, other.domain) && $equals_3(this.id_0, other.id_0);
}
;
_.getClass$ = function getClass_959(){
  return Lorg_waveprotocol_wave_model_id_WaveId_2_classLit;
}
;
_.hashCode$ = function hashCode_30(){
  return $hashCode_4(this);
}
;
_.toString$ = function toString_82(){
  return '[WaveId ' + $serialiseWaveId(this) + ']';
}
;
_.castableTypeMap$ = {58:1, 61:1, 256:1};
_.domain = null;
_.id_0 = null;
function $clinit_1412(){
  $clinit_1412 = nullMethod;
  var c, c$iterator;
  SAFE_ASCII_CHARS = initDim(_3Z_classLit, {58:1}, -1, 127, 2);
  for (c = 65; c <= 90; ++c) {
    SAFE_ASCII_CHARS[c] = true;
  }
  for (c = 97; c <= 122; ++c) {
    SAFE_ASCII_CHARS[c] = true;
  }
  for (c = 48; c <= 57; ++c) {
    SAFE_ASCII_CHARS[c] = true;
  }
  for (c$iterator = new AbstractList$IteratorImpl_0(new Arrays$ArrayList_0(initValues(_3Ljava_lang_Character_2_classLit, {58:1, 138:1}, 60, [valueOf(45), valueOf(46), valueOf(95), valueOf(126), valueOf(43), valueOf(42), valueOf(64)]))); c$iterator.i < c$iterator.this$0_0.size_0();) {
    c = dynamicCast($next_6(c$iterator), 60).value_0;
    SAFE_ASCII_CHARS[c] = true;
  }
  GOOD_UTF16_FOR_ID = new WaveIdentifiers$1_0;
}

function isValidDomain(x){
  $clinit_1412();
  var c, d, index, length_0;
  index = 0;
  length_0 = x.length;
  if (length_0 > 253 || length_0 < 1) {
    return false;
  }
  while (index < x.length) {
    c = x.charCodeAt(index);
    if ((97 > c || c > 122) && (48 > c || c > 57)) {
      return false;
    }
    d = c;
    while (++index < x.length) {
      c = x.charCodeAt(index);
      if ((97 > c || c > 122) && (48 > c || c > 57) && c != 45) {
        break;
      }
      d = c;
    }
    if (index >= x.length) {
      return d != 45;
    }
    if (46 != c || d == 45) {
      return false;
    }
    ++index;
  }
  return false;
}

function isValidIdentifier(id){
  $clinit_1412();
  return !!id.length && traverseUtf16String(id, GOOD_UTF16_FOR_ID).value_0;
}

var GOOD_UTF16_FOR_ID, SAFE_ASCII_CHARS = null;
function $codePoint(cp){
  if (!isCodePointValid(cp)) {
    return $clinit_382() , $clinit_382() , FALSE;
  }
  if (cp < ($clinit_1412() , SAFE_ASCII_CHARS).length && !SAFE_ASCII_CHARS[cp]) {
    return $clinit_382() , $clinit_382() , FALSE;
  }
  if (cp >= SAFE_ASCII_CHARS.length && !(cp >= 160 && cp <= 55295 || cp >= 63744 && cp <= 64975 || cp >= 65008 && cp <= 65519 || cp >= 65536 && cp <= 131069 || cp >= 131072 && cp <= 196605 || cp >= 196608 && cp <= 262141 || cp >= 262144 && cp <= 327677 || cp >= 327680 && cp <= 393213 || cp >= 393216 && cp <= 458749 || cp >= 458752 && cp <= 524285 || cp >= 524288 && cp <= 589821 || cp >= 589824 && cp <= 655357 || cp >= 655360 && cp <= 720893 || cp >= 720896 && cp <= 786429 || cp >= 786432 && cp <= 851965 || cp >= 851968 && cp <= 917501 || cp >= 921600 && cp <= 983037)) {
    return $clinit_382() , $clinit_382() , FALSE;
  }
  return null;
}

function WaveIdentifiers$1_0(){
}

function WaveIdentifiers$1(){
}

_ = WaveIdentifiers$1_0.prototype = WaveIdentifiers$1.prototype = new Object_0;
_.codePoint = function codePoint_2(cp){
  return $codePoint(cp);
}
;
_.endOfString = function endOfString_1(){
  return $clinit_382() , $clinit_382() , TRUE;
}
;
_.getClass$ = function getClass_960(){
  return Lorg_waveprotocol_wave_model_id_WaveIdentifiers$1_2_classLit;
}
;
_.unpairedSurrogate = function unpairedSurrogate_1(c){
  return $clinit_382() , $clinit_382() , FALSE;
}
;
_.castableTypeMap$ = {};
function $compareTo_13(this$static, other){
  var domainCompare;
  domainCompare = compareTo_5(this$static.domain, other.domain);
  return domainCompare == 0?compareTo_5(this$static.id_0, other.id_0):domainCompare;
}

function $hashCode_5(this$static){
  var result;
  result = 31 + getHashCode_0(this$static.domain);
  result = 31 * result + getHashCode_0(this$static.id_0);
  return result;
}

function WaveletId_0(domain, id){
  this.domain = String(domain);
  this.id_0 = id;
}

function ofChecked_0(domain, id){
  checkNotNull_1(domain, 'Null domain');
  checkNotNull_1(id, 'Null id');
  if (!isValidDomain(domain)) {
    throw new InvalidIdException_0(domain, 'Invalid domain');
  }
  $clinit_1412();
  if (!(!!id.length && traverseUtf16String(id, GOOD_UTF16_FOR_ID).value_0)) {
    throw new InvalidIdException_0(id, 'Invalid id');
  }
  return new WaveletId_0(domain, id);
}

function WaveletId(){
}

_ = WaveletId_0.prototype = WaveletId.prototype = new Object_0;
_.compareTo$ = function compareTo_15(other){
  return $compareTo_13(this, dynamicCast(other, 257));
}
;
_.equals$ = function equals_31(obj){
  var other;
  if (this === obj) {
    return true;
  }
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[257])) {
    return false;
  }
  other = dynamicCast(obj, 257);
  return $equals_3(this.domain, other.domain) && $equals_3(this.id_0, other.id_0);
}
;
_.getClass$ = function getClass_961(){
  return Lorg_waveprotocol_wave_model_id_WaveletId_2_classLit;
}
;
_.hashCode$ = function hashCode_31(){
  return $hashCode_5(this);
}
;
_.toString$ = function toString_83(){
  return '[WaveletId ' + $serialiseWaveletId(this) + ']';
}
;
_.castableTypeMap$ = {58:1, 61:1, 257:1};
_.domain = null;
_.id_0 = null;
function $deserialize(s){
  var $e0, e;
  try {
    return $deserialiseWaveletId(s);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 161)) {
      e = $e0;
      throw new IllegalArgumentException_3(e);
    }
     else 
      throw $e0;
  }
}

function OpCursorException_0(message){
  this.fillInStackTrace();
  this.detailMessage = message;
}

function OpCursorException(){
}

_ = OpCursorException_0.prototype = OpCursorException.prototype = new RuntimeException;
_.getClass$ = function getClass_962(){
  return Lorg_waveprotocol_wave_model_operation_OpCursorException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1, 217:1};
function OperationException_0(message){
  this.fillInStackTrace();
  this.detailMessage = message;
}

function OperationException_1(message, cause){
  this.fillInStackTrace();
  this.cause = cause;
  this.detailMessage = message;
}

function OperationException_2(violations){
  this.fillInStackTrace();
  this.detailMessage = 'Validation failure: ' + violations;
  this.violations = violations;
}

function OperationException(){
}

_ = OperationException_2.prototype = OperationException_1.prototype = OperationException_0.prototype = OperationException.prototype = new Exception;
_.getClass$ = function getClass_963(){
  return Lorg_waveprotocol_wave_model_operation_OperationException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 58:1, 143:1, 189:1};
_.violations = null;
function OperationPair_0(clientOp, serverOp){
  this.clientOp = clientOp;
  this.serverOp = serverOp;
}

function OperationPair(){
}

_ = OperationPair_0.prototype = OperationPair.prototype = new Object_0;
_.getClass$ = function getClass_964(){
  return Lorg_waveprotocol_wave_model_operation_OperationPair_2_classLit;
}
;
_.castableTypeMap$ = {};
_.clientOp = null;
_.serverOp = null;
function OperationRuntimeException_0(message, opException){
  this.fillInStackTrace();
  this.cause = opException;
  this.detailMessage = message;
  this.message_0 = message;
  this.opException = opException;
}

function OperationRuntimeException(){
}

_ = OperationRuntimeException_0.prototype = OperationRuntimeException.prototype = new RuntimeException;
_.getClass$ = function getClass_965(){
  return Lorg_waveprotocol_wave_model_operation_OperationRuntimeException_2_classLit;
}
;
_.toString$ = function toString_84(){
  return 'BoxedOpException: ' + this.message_0 + ': ' + this.opException;
}
;
_.castableTypeMap$ = {3:1, 4:1, 58:1, 143:1, 167:1};
_.message_0 = null;
_.opException = null;
function $clinit_1422(){
  $clinit_1422 = nullMethod;
  VOID = new SilentOperationSink$1_0;
}

var VOID;
function SilentOperationSink$1_0(){
}

function SilentOperationSink$1(){
}

_ = SilentOperationSink$1_0.prototype = SilentOperationSink$1.prototype = new Object_0;
_.consume = function consume_7(op){
}
;
_.getClass$ = function getClass_966(){
  return Lorg_waveprotocol_wave_model_operation_SilentOperationSink$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function TransformException_0(message){
  this.fillInStackTrace();
  this.detailMessage = message;
}

function TransformException_1(cause){
  Exception_3.call(this, cause);
}

function TransformException(){
}

_ = TransformException_1.prototype = TransformException_0.prototype = TransformException.prototype = new Exception;
_.getClass$ = function getClass_967(){
  return Lorg_waveprotocol_wave_model_operation_TransformException_2_classLit;
}
;
_.castableTypeMap$ = {3:1, 58:1, 143:1, 264:1};
function $clinit_1425(){
  $clinit_1425 = nullMethod;
  defaultAnnotations = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  $put_5(defaultAnnotations, 'style/textDecoration', newStringSet(initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['none'])));
  $put_5(defaultAnnotations, 'style/fontWeight', newStringSet(initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['normal'])));
  $put_5(defaultAnnotations, 'style/fontStyle', newStringSet(initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['normal'])));
  $put_5(defaultAnnotations, 'style/backgroundColor', newStringSet(initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['initial', 'transparent'])));
  $put_5(defaultAnnotations, 'style/color', newStringSet(initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['black'])));
}

function $applyMutations(this$static, tokenizer, builder, doc, splitContainer){
  var i, key, key$iterator, tokenType, outerIter, entry;
  $reset(this$static);
  while (tokenizer.tokenIndex < tokenizer.tokenList.size - 1) {
    tokenType = $next_27(tokenizer);
    switch (tokenType.ordinal) {
      case 4:
      case 5:
        $handleNewLine(this$static, tokenizer, builder, doc, splitContainer, $structuralAttributes(this$static, tokenizer));
        break;
      default:$handleBasicMutation(this$static, tokenizer, builder);
    }
    this$static.isFirstToken = false;
  }
  for (key$iterator = (outerIter = $keySet(this$static.startedAnnotations).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter)); key$iterator.val$outerIter.hasNext();) {
    key = dynamicCast((entry = dynamicCast(key$iterator.val$outerIter.next_0(), 66) , entry.getKey()), 1);
    $add_9(builder.mutationList, new Nindo$EndAnnotation_0(key));
  }
  this$static.lastGoodCursorOffset = this$static.offset;
  for (i = 0; i < this$static.elementCount; ++i) {
    $add_9(builder.mutationList, ($clinit_1167() , INSTANCE_13));
    ++this$static.offset;
  }
  return this$static.affectedKeys;
}

function $endAnnotation_2(this$static, builder, annotationKey){
  var annotationStack, current, nextAnnotation;
  annotationStack = dynamicCast(this$static.startedAnnotations.get(annotationKey), 258);
  checkNotNull_1(annotationStack, 'cannot end unstarted annotation');
  current = dynamicCast($pop(annotationStack), 1);
  if (annotationStack.arrayList.size == 0 && current != null) {
    $containsKey_5(defaultAnnotations, annotationKey) && $contains_7(dynamicCast($get_12(defaultAnnotations, annotationKey), 259), current) || $add_9(builder.mutationList, new Nindo$EndAnnotation_0(annotationKey));
    $containsKey_5(this$static.defaultValueMap, annotationKey)?($add_9(builder.mutationList, new Nindo$StartAnnotation_0(annotationKey, dynamicCast($get_12(this$static.defaultValueMap, annotationKey), 1))) , undefined):this$static.startedAnnotations.remove_2(annotationKey);
  }
   else {
    nextAnnotation = dynamicCast($peek_0(annotationStack), 1);
    (current == null?nextAnnotation != null:!$equals_3(current, nextAnnotation)) && ($containsKey_5(defaultAnnotations, annotationKey) && $contains_7(dynamicCast($get_12(defaultAnnotations, annotationKey), 259), nextAnnotation)?$add_9(builder.mutationList, new Nindo$EndAnnotation_0(annotationKey)):$add_9(builder.mutationList, new Nindo$StartAnnotation_0(annotationKey, nextAnnotation)));
  }
}

function $endElement(this$static, builder){
  if (--this$static.elementCount < 0) {
    throw new IllegalStateException_1('Element count is negative.');
  }
  $add_9(builder.mutationList, ($clinit_1167() , INSTANCE_13));
  ++this$static.offset;
}

function $handleBasicMutation(this$static, tokenizer, builder){
  var currentType;
  currentType = $getCurrentToken(tokenizer).type_0;
  switch (currentType.ordinal) {
    case 6:
      if ($getCurrentToken(tokenizer).data_0 != null) {
        $characters(builder, $coerceString(($clinit_1271() , $getCurrentToken(tokenizer).data_0)));
        this$static.offset += $getCurrentToken(tokenizer).data_0.length;
      }

      break;
    case 7:
      $startAnnotation_2(this$static, builder, 'style/fontWeight', $getCurrentToken(tokenizer).data_0);
      break;
    case 8:
      $endAnnotation_2(this$static, builder, 'style/fontWeight');
      break;
    case 9:
      $startAnnotation_2(this$static, builder, 'style/fontStyle', $getCurrentToken(tokenizer).data_0);
      break;
    case 10:
      $endAnnotation_2(this$static, builder, 'style/fontStyle');
      break;
    case 11:
      $startAnnotation_2(this$static, builder, 'style/textDecoration', $getCurrentToken(tokenizer).data_0);
      break;
    case 12:
      $endAnnotation_2(this$static, builder, 'style/textDecoration');
      break;
    case 13:
      $startAnnotation_2(this$static, builder, 'style/color', $getCurrentToken(tokenizer).data_0);
      break;
    case 14:
      $endAnnotation_2(this$static, builder, 'style/color');
      break;
    case 15:
      $startAnnotation_2(this$static, builder, 'style/backgroundColor', $getCurrentToken(tokenizer).data_0);
      break;
    case 16:
      $endAnnotation_2(this$static, builder, 'style/backgroundColor');
      break;
    case 17:
      $startAnnotation_2(this$static, builder, 'style/fontFamily', $getCurrentToken(tokenizer).data_0);
      break;
    case 18:
      $endAnnotation_2(this$static, builder, 'style/fontFamily');
      break;
    case 19:
      $startAnnotation_2(this$static, builder, 'link/manual', $getCurrentToken(tokenizer).data_0);
      break;
    case 20:
      $endAnnotation_2(this$static, builder, 'link/manual');
      break;
    case 0:
    case 2:
      $add_9(this$static.structureStack, currentType);
      this$static.indentationLevel += currentType.indent;
      break;
    case 1:
    case 3:
      this$static.structureStack.size > 0 && (this$static.indentationLevel -= dynamicCast($remove_10(this$static.structureStack, this$static.structureStack.size - 1), 127).indent);
      break;
    default:throw new IllegalStateException_1('Unhandled token: ' + currentType.name_0);
  }
}

--></script>
<script><!--
function $handleNewLine(this$static, tokenizer, builder, doc, splitContainer, attributes){
  var el;
  isLineContainer(doc, (el = doc.asElement_0(splitContainer) , el == null?doc.getParentElement(splitContainer):el)) && $lcHandleNewLine(this$static, tokenizer, builder, attributes);
}

function $lcHandleNewLine(this$static, tokenizer, builder, attributes){
  var isLastToken;
  isLastToken = tokenizer.tokenIndex >= tokenizer.tokenList.size - 1;
  if (!this$static.isFirstToken && !isLastToken || attributes.entrySet.this$0.attributes.size_0() != 0) {
    ++this$static.elementCount;
    $add_9(builder.mutationList, new Nindo$ElementStart_0('line', attributes));
    ++this$static.offset;
    $endElement(this$static, builder);
  }
}

function $peek_2(this$static){
  if (this$static.structureStack.size == 0) {
    return null;
  }
  return dynamicCast($get_3(this$static.structureStack, this$static.structureStack.size - 1), 127);
}

function $reset(this$static){
  this$static.offset = 0;
  $clear_2(this$static.structureStack);
  this$static.elementCount = 0;
  this$static.lastGoodCursorOffset = 0;
  this$static.startedAnnotations.clear();
  this$static.affectedKeys.backend.clear();
  this$static.isFirstToken = true;
}

function $startAnnotation_2(this$static, builder, annotationKey, annotationValue){
  var annotationStack, current;
  annotationStack = dynamicCast(this$static.startedAnnotations.get(annotationKey), 258);
  if (!annotationStack) {
    annotationStack = new Stack_0;
    this$static.startedAnnotations.put(annotationKey, annotationStack);
    $add_20(this$static.affectedKeys, annotationKey);
  }
  current = annotationStack.arrayList.size == 0?null:dynamicCast($peek_0(annotationStack), 1);
  if (annotationValue == null?current != null:!$equals_3(annotationValue, current)) {
    if (current == null && $containsKey_5(defaultAnnotations, annotationKey) && $contains_7(dynamicCast($get_12(defaultAnnotations, annotationKey), 259), annotationValue))
    ;
    else {
      $add_9(builder.mutationList, new Nindo$StartAnnotation_0(annotationKey, annotationValue));
    }
  }
  $add_9(annotationStack.arrayList, annotationValue);
}

function $structuralAttributes(this$static, tokenizer){
  var attrList, attributes, currentStructureType, indent;
  currentStructureType = $peek_2(this$static);
  attrList = new ArrayList_0;
  if (currentStructureType) {
    indent = this$static.indentationLevel;
    if ($getCurrentToken(tokenizer).type_0 == ($clinit_1427() , LIST_ITEM)) {
      switch (currentStructureType.ordinal) {
        case 0:
          --indent;
          $add_9(attrList, new ImmutableStateMap$Attribute_1('t', 'li'));
          break;
        case 2:
          --indent;
          $add_9(attrList, new ImmutableStateMap$Attribute_1('t', 'li'));
          $add_9(attrList, new ImmutableStateMap$Attribute_1('listyle', 'decimal'));
      }
    }
     else 
      $getCurrentToken(tokenizer).data_0 != null && $add_9(attrList, new ImmutableStateMap$Attribute_1('t', $getCurrentToken(tokenizer).data_0));
    indent > 0 && $add_9(attrList, new ImmutableStateMap$Attribute_1('i', '' + indent));
  }
  attributes = fromUnsortedAttributes(attrList);
  return attributes;
}

function RichTextMutationBuilder_0(defaultValueMap){
  $clinit_1425();
  this.startedAnnotations = new HashMap_0;
  this.structureStack = new ArrayList_0;
  this.affectedKeys = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringSetAdapter_0(new HashSet_0));
  this.defaultValueMap = defaultValueMap;
  $reset(this);
}

function RichTextMutationBuilder(){
}

_ = RichTextMutationBuilder_0.prototype = RichTextMutationBuilder.prototype = new Object_0;
_.getClass$ = function getClass_968(){
  return Lorg_waveprotocol_wave_model_richtext_RichTextMutationBuilder_2_classLit;
}
;
_.castableTypeMap$ = {};
_.defaultValueMap = null;
_.elementCount = 0;
_.indentationLevel = 0;
_.isFirstToken = false;
_.lastGoodCursorOffset = 0;
_.offset = 0;
var defaultAnnotations;
function $clinit_1427(){
  $clinit_1427 = nullMethod;
  UNORDERED_LIST_START = new RichTextTokenizer$Type_1('UNORDERED_LIST_START', 0, ($clinit_1428() , BLOCK_RANGE), 1);
  UNORDERED_LIST_END = new RichTextTokenizer$Type_0('UNORDERED_LIST_END', 1, BLOCK_RANGE);
  ORDERED_LIST_START = new RichTextTokenizer$Type_1('ORDERED_LIST_START', 2, BLOCK_RANGE, 1);
  ORDERED_LIST_END = new RichTextTokenizer$Type_0('ORDERED_LIST_END', 3, BLOCK_RANGE);
  NEW_LINE = new RichTextTokenizer$Type_0('NEW_LINE', 4, BLOCK_1);
  LIST_ITEM = new RichTextTokenizer$Type_0('LIST_ITEM', 5, BLOCK_1);
  TEXT_0 = new RichTextTokenizer$Type_0('TEXT', 6, TEXTUAL);
  STYLE_FONT_WEIGHT_START = new RichTextTokenizer$Type_0('STYLE_FONT_WEIGHT_START', 7, STYLE);
  STYLE_FONT_WEIGHT_END = new RichTextTokenizer$Type_0('STYLE_FONT_WEIGHT_END', 8, STYLE);
  STYLE_FONT_STYLE_START = new RichTextTokenizer$Type_0('STYLE_FONT_STYLE_START', 9, STYLE);
  STYLE_FONT_STYLE_END = new RichTextTokenizer$Type_0('STYLE_FONT_STYLE_END', 10, STYLE);
  STYLE_TEXT_DECORATION_START = new RichTextTokenizer$Type_0('STYLE_TEXT_DECORATION_START', 11, STYLE);
  STYLE_TEXT_DECORATION_END = new RichTextTokenizer$Type_0('STYLE_TEXT_DECORATION_END', 12, STYLE);
  STYLE_COLOR_START = new RichTextTokenizer$Type_0('STYLE_COLOR_START', 13, STYLE);
  STYLE_COLOR_END = new RichTextTokenizer$Type_0('STYLE_COLOR_END', 14, STYLE);
  STYLE_BG_COLOR_START = new RichTextTokenizer$Type_0('STYLE_BG_COLOR_START', 15, STYLE);
  STYLE_BG_COLOR_END = new RichTextTokenizer$Type_0('STYLE_BG_COLOR_END', 16, STYLE);
  STYLE_FONT_FAMILY_START = new RichTextTokenizer$Type_0('STYLE_FONT_FAMILY_START', 17, STYLE);
  STYLE_FONT_FAMILY_END = new RichTextTokenizer$Type_0('STYLE_FONT_FAMILY_END', 18, STYLE);
  LINK_START = new RichTextTokenizer$Type_0('LINK_START', 19, STYLE);
  LINK_END = new RichTextTokenizer$Type_0('LINK_END', 20, STYLE);
  $VALUES_55 = initValues(_3Lorg_waveprotocol_wave_model_richtext_RichTextTokenizer$Type_2_classLit, {58:1, 138:1}, 127, [UNORDERED_LIST_START, UNORDERED_LIST_END, ORDERED_LIST_START, ORDERED_LIST_END, NEW_LINE, LIST_ITEM, TEXT_0, STYLE_FONT_WEIGHT_START, STYLE_FONT_WEIGHT_END, STYLE_FONT_STYLE_START, STYLE_FONT_STYLE_END, STYLE_TEXT_DECORATION_START, STYLE_TEXT_DECORATION_END, STYLE_COLOR_START, STYLE_COLOR_END, STYLE_BG_COLOR_START, STYLE_BG_COLOR_END, STYLE_FONT_FAMILY_START, STYLE_FONT_FAMILY_END, LINK_START, LINK_END]);
}

function RichTextTokenizer$Type_0(enum$name, enum$ordinal, group){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
  this.group = group;
  this.indent = -1;
}

function RichTextTokenizer$Type_1(enum$name, enum$ordinal, group, indent){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
  this.group = group;
  this.indent = indent;
}

function values_56(){
  $clinit_1427();
  return $VALUES_55;
}

function RichTextTokenizer$Type(){
}

_ = RichTextTokenizer$Type_1.prototype = RichTextTokenizer$Type_0.prototype = RichTextTokenizer$Type.prototype = new Enum;
_.getClass$ = function getClass_969(){
  return Lorg_waveprotocol_wave_model_richtext_RichTextTokenizer$Type_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 127:1};
_.group = null;
_.indent = 0;
var $VALUES_55, LINK_END, LINK_START, LIST_ITEM, NEW_LINE, ORDERED_LIST_END, ORDERED_LIST_START, STYLE_BG_COLOR_END, STYLE_BG_COLOR_START, STYLE_COLOR_END, STYLE_COLOR_START, STYLE_FONT_FAMILY_END, STYLE_FONT_FAMILY_START, STYLE_FONT_STYLE_END, STYLE_FONT_STYLE_START, STYLE_FONT_WEIGHT_END, STYLE_FONT_WEIGHT_START, STYLE_TEXT_DECORATION_END, STYLE_TEXT_DECORATION_START, TEXT_0, UNORDERED_LIST_END, UNORDERED_LIST_START;
function $clinit_1428(){
  $clinit_1428 = nullMethod;
  BLOCK_RANGE = new RichTextTokenizer$Type$TypeGroup_0('BLOCK_RANGE', 0);
  BLOCK_1 = new RichTextTokenizer$Type$TypeGroup_0('BLOCK', 1);
  TEXTUAL = new RichTextTokenizer$Type$TypeGroup_0('TEXTUAL', 2);
  STYLE = new RichTextTokenizer$Type$TypeGroup_0('STYLE', 3);
  $VALUES_56 = initValues(_3Lorg_waveprotocol_wave_model_richtext_RichTextTokenizer$Type$TypeGroup_2_classLit, {58:1, 138:1}, 126, [BLOCK_RANGE, BLOCK_1, TEXTUAL, STYLE]);
}

function RichTextTokenizer$Type$TypeGroup_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_57(){
  $clinit_1428();
  return $VALUES_56;
}

function RichTextTokenizer$Type$TypeGroup(){
}

_ = RichTextTokenizer$Type$TypeGroup_0.prototype = RichTextTokenizer$Type$TypeGroup.prototype = new Enum;
_.getClass$ = function getClass_970(){
  return Lorg_waveprotocol_wave_model_richtext_RichTextTokenizer$Type$TypeGroup_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 126:1};
var $VALUES_56, BLOCK_1, BLOCK_RANGE, STYLE, TEXTUAL;
function $clinit_1429(){
  $clinit_1429 = nullMethod;
  fontWeightMap = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  $put_5(fontWeightMap, 'b', 'bold');
  $put_5(fontWeightMap, 'strong', 'bold');
  fontStyleMap = new CollectionUtils$StringMapAdapter_0(new HashMap_0);
  $put_5(fontStyleMap, 'i', 'italic');
  $put_5(fontStyleMap, 'em', 'italic');
  textDecorationMap = new CollectionUtils$StringMapAdapter_0(new HashMap_0);
  $put_5(textDecorationMap, 'u', 'underline');
  FONT_WEIGHT_HANDLER = new RichTextTokenizerImpl$StyleTokenExtractor_0(($clinit_1427() , STYLE_FONT_WEIGHT_START), STYLE_FONT_WEIGHT_END, fontWeightMap, 'fontWeight');
  FONT_STYLE_HANDLER = new RichTextTokenizerImpl$StyleTokenExtractor_0(STYLE_FONT_STYLE_START, STYLE_FONT_STYLE_END, fontStyleMap, 'fontStyle');
  TEXT_DECORATION_HANDLER = new RichTextTokenizerImpl$StyleTokenExtractor_0(STYLE_TEXT_DECORATION_START, STYLE_TEXT_DECORATION_END, textDecorationMap, 'textDecoration');
}

function $addTextToken(this$static, text){
  var builder, ch, i;
  builder = new StringBuilder_1(text.length);
  for (i = 0; i < text.length; ++i) {
    ch = text.charCodeAt(i);
    if (ch == 160) {
      builder.impl.string += ' ';
    }
     else if (ch == 9) {
      builder.impl.string += '    ';
    }
     else if (ch == 10) {
      builder.impl.string.length != 0 && $addToken(this$static, new RichTextTokenizerImpl$Token_1(($clinit_1427() , TEXT_0), builder.impl.string));
      $addToken(this$static, new RichTextTokenizerImpl$Token_0(($clinit_1427() , NEW_LINE)));
      builder = new StringBuilder_1(text.length - i);
    }
     else {
      builder.impl.string += String.fromCharCode(ch);
    }
  }
  builder.impl.string.length != 0 && $addToken(this$static, new RichTextTokenizerImpl$Token_1(($clinit_1427() , TEXT_0), builder.impl.string));
}

function $addToken(this$static, token){
  token.type_0.group != ($clinit_1428() , STYLE) && (this$static.mergeNextNewLine = token.type_0.group == BLOCK_1);
  $add_9(this$static.tokenList, token);
}

function $addTokenOrIncrement(this$static, replace, token, endType){
  (replace || this$static.activeTokenCounts[endType.ordinal] <= 0) && (token.type_0.group != ($clinit_1428() , STYLE) && (this$static.mergeNextNewLine = token.type_0.group == BLOCK_1) , $add_9(this$static.tokenList, token));
  ++this$static.activeTokenCounts[endType.ordinal];
}

function $asElement_7(node){
  if (node) {
    return $asElement_4(dynamicCastJso(node));
  }
  return null;
}

function $getCurrentToken(this$static){
  if (this$static.tokenIndex >= this$static.tokenList.size) {
    throw new IllegalStateException_1('No token available.');
  }
  return dynamicCast($get_3(this$static.tokenList, this$static.tokenIndex), 260);
}

function $getDepthFromBlock(this$static, node){
  var depth, e;
  depth = 1;
  e = $getParentElement_5(node);
  while (e) {
    if (e == this$static.root || isBlockElement(dynamicCastJso(e).tagName)) {
      break;
    }
    ++depth;
    e = $getParentElement_5(e);
  }
  return depth;
}

function $getStyleProperty(el, tagName, tokenHandler){
  var lowerCaseTag, value;
  value = el.style[tokenHandler.stylePropertyName];
  if (value != null && !!value.length) {
    return value;
  }
  lowerCaseTag = tagName.toLowerCase();
  return $containsKey_5(tokenHandler.tagToValue, lowerCaseTag)?dynamicCast($get_12(tokenHandler.tagToValue, lowerCaseTag), 1):null;
}

function $handleLinkElement(this$static, el, tagName){
  var attr;
  if ($equalsIgnoreCase('a', tagName)) {
    attr = $getAttribute_4(dynamicCastJso(el), 'href');
    if (attr != null) {
      $addTokenOrIncrement(this$static, false, new RichTextTokenizerImpl$Token_1(($clinit_1427() , LINK_START), attr), LINK_END);
      return LINK_END;
    }
  }
  return null;
}

function $handleListElement(this$static, tagName){
  if ($equalsIgnoreCase('ol', tagName)) {
    $addTokenOrIncrement(this$static, true, new RichTextTokenizerImpl$Token_0(($clinit_1427() , ORDERED_LIST_START)), ORDERED_LIST_END);
    return ORDERED_LIST_END;
  }
   else if ($equalsIgnoreCase('ul', tagName)) {
    $addTokenOrIncrement(this$static, true, new RichTextTokenizerImpl$Token_0(($clinit_1427() , UNORDERED_LIST_START)), UNORDERED_LIST_END);
    return UNORDERED_LIST_END;
  }
   else {
    return null;
  }
}

function $handleStyleElements(this$static, el, tagName, closeStack){
  var value, value_0, value_1, value_2;
  $maybeExtractStyleToken(this$static, el, tagName, closeStack, FONT_WEIGHT_HANDLER);
  $maybeExtractStyleToken(this$static, el, tagName, closeStack, FONT_STYLE_HANDLER);
  $maybeExtractStyleToken(this$static, el, tagName, closeStack, TEXT_DECORATION_HANDLER);
  if (value_0 = el.style['color'] , value_0 != null && !!value_0.length) {
    value = el.style['color'];
    $addTokenOrIncrement(this$static, true, new RichTextTokenizerImpl$Token_1(($clinit_1427() , STYLE_COLOR_START), value), STYLE_COLOR_END);
    $add_9(closeStack, STYLE_COLOR_END);
  }
  if (value_1 = el.style['backgroundColor'] , value_1 != null && !!value_1.length) {
    value = el.style['backgroundColor'];
    $addTokenOrIncrement(this$static, true, new RichTextTokenizerImpl$Token_1(($clinit_1427() , STYLE_BG_COLOR_START), value), STYLE_BG_COLOR_END);
    $add_9(closeStack, STYLE_BG_COLOR_END);
  }
  if (value_2 = el.style['fontFamily'] , value_2 != null && !!value_2.length) {
    value = el.style['fontFamily'];
    $addTokenOrIncrement(this$static, true, new RichTextTokenizerImpl$Token_1(($clinit_1427() , STYLE_FONT_FAMILY_START), value), STYLE_FONT_FAMILY_END);
    $add_9(closeStack, STYLE_FONT_FAMILY_END);
  }
}

function $ignorableBlock(this$static, element, tagName){
  if ($equalsIgnoreCase('div', tagName)) {
    if (!this$static.document_0.getFirstChild_1(element)) {
      return true;
    }
  }
  return false;
}

function $isLastLinebreak(this$static, element){
  var el, sibling;
  sibling = this$static.document_0.getNextSibling_0(element);
  if (sibling) {
    el = $asElement_7(sibling);
    if (!el || !isBlockElement(dynamicCastJso(el).tagName)) {
      return false;
    }
  }
  return $getDepthFromBlock(this$static, element) == 1;
}

function $maybeExtractStyleToken(this$static, el, tagName, closeStack, tokenHandler){
  var styleProperty;
  styleProperty = $getStyleProperty(el, tagName, tokenHandler);
  if (styleProperty != null) {
    $addTokenOrIncrement(this$static, true, new RichTextTokenizerImpl$Token_1(tokenHandler.tokenStartType, styleProperty), tokenHandler.tokenEndType);
    $add_9(closeStack, tokenHandler.tokenEndType);
  }
}

function $maybeInsertNewline(this$static){
  if (!this$static.mergeNextNewLine) {
    $addToken(this$static, new RichTextTokenizerImpl$Token_0(($clinit_1427() , NEW_LINE)));
    return true;
  }
  return false;
}

function $next_27(this$static){
  if (this$static.tokenIndex >= this$static.tokenList.size - 1) {
    throw new NoSuchElementException_0;
  }
  ++this$static.tokenIndex;
  return $getCurrentToken(this$static).type_0;
}

function $process(this$static, container){
  var child, j;
  if (!container) {
    throw new IllegalArgumentException_0;
  }
  this$static.root = container;
  $clear_2(this$static.tokenList);
  this$static.tokenIndex = -1;
  for (child = this$static.document_0.getFirstChild_1(this$static.root); child; child = this$static.document_0.getNextSibling_0(child)) {
    $processNode(this$static, child);
  }
  for (j = 0; j < this$static.activeTokenCounts.length; ++j) {
  }
}

function $processElement(this$static, element){
  var child, closingType, closingTypeStack, maybeEndParagraph, setEndBlockPending, tagName, newValue;
  tagName = dynamicCastJso(element).tagName.toLowerCase();
  closingTypeStack = new ArrayList_0;
  maybeEndParagraph = false;
  setEndBlockPending = false;
  if ($equalsIgnoreCase('p', tagName) || $equalsIgnoreCase('div', tagName) || $equalsIgnoreCase('li', tagName)) {
    if ($equalsIgnoreCase('li', tagName)) {
      $addToken(this$static, new RichTextTokenizerImpl$Token_0(($clinit_1427() , LIST_ITEM)));
    }
     else {
      if (!$ignorableBlock(this$static, element, tagName)) {
        $maybeInsertNewline(this$static);
        maybeEndParagraph = true;
        setEndBlockPending = true;
      }
    }
  }
   else if ($equalsIgnoreCase('br', tagName)) {
    if (!$isLastLinebreak(this$static, element)) {
      $addToken(this$static, new RichTextTokenizerImpl$Token_0(($clinit_1427() , NEW_LINE)));
      this$static.mergeNextNewLine = false;
    }
  }
   else if (isHeading_0(tagName)) {
    $addToken(this$static, new RichTextTokenizerImpl$Token_1(($clinit_1427() , NEW_LINE), tagName));
    maybeEndParagraph = true;
    setEndBlockPending = true;
  }
   else if ($equalsIgnoreCase('ol', tagName) || $equalsIgnoreCase('ul', tagName)) {
    $putIfNotNull(closingTypeStack, $handleListElement(this$static, tagName));
    maybeEndParagraph = false;
    setEndBlockPending = true;
  }
   else if ($equalsIgnoreCase('table', tagName) || $equalsIgnoreCase('tr', tagName) || $equalsIgnoreCase('th', tagName) || $equalsIgnoreCase('td', tagName) || $equalsIgnoreCase('thead', tagName) || $equalsIgnoreCase('tbody', tagName)) {
    if ($equalsIgnoreCase('table', tagName)) {
      $addToken(this$static, new RichTextTokenizerImpl$Token_0(($clinit_1427() , NEW_LINE)));
    }
     else if ($equalsIgnoreCase('tr', tagName)) {
      maybeEndParagraph = true;
      setEndBlockPending = true;
    }
     else 
      ($equalsIgnoreCase('th', tagName) || $equalsIgnoreCase('td', tagName)) && $addToken(this$static, new RichTextTokenizerImpl$Token_1(($clinit_1427() , TEXT_0), ' '));
  }
   else {
    $putIfNotNull(closingTypeStack, $handleLinkElement(this$static, element, tagName));
  }
  $handleStyleElements(this$static, element, tagName, closingTypeStack);
  for (child = this$static.document_0.getFirstChild_1(element); child; child = this$static.document_0.getNextSibling_0(child)) {
    $processNode(this$static, child);
  }
  while (closingTypeStack.size != 0) {
    closingType = dynamicCast($remove_10(closingTypeStack, closingTypeStack.size - 1), 127);
    $addToken(this$static, new RichTextTokenizerImpl$Token_0(closingType));
    newValue = --this$static.activeTokenCounts[closingType.ordinal];
  }
  this$static.endBlockPending |= setEndBlockPending;
  if (maybeEndParagraph && this$static.endBlockPending) {
    $maybeInsertNewline(this$static);
    this$static.endBlockPending = false;
  }
}

function $processNode(this$static, node){
  var element, textNode;
  textNode = $asText_3(dynamicCastJso(node));
  if (textNode) {
    $processTextNode(this$static, textNode);
    return;
  }
  element = $asElement_7(node);
  !!element && $processElement(this$static, element);
}

function $processTextNode(this$static, textNode){
  var text;
  if (this$static.endBlockPending) {
    $maybeInsertNewline(this$static);
    this$static.endBlockPending = false;
  }
  text = dynamicCastJso(textNode).data;
  !text.length || $addTextToken(this$static, text);
}

function $putIfNotNull(list, item){
  !!item && (setCheck(list.array, list.size++, item) , true);
}

function RichTextTokenizerImpl_0(doc){
  $clinit_1429();
  var i;
  this.document_0 = doc;
  this.tokenList = new ArrayList_0;
  this.activeTokenCounts = initDim(_3I_classLit, {58:1}, -1, ($clinit_1427() , $clinit_1427() , $VALUES_55).length, 1);
  for (i = 0; i < this.activeTokenCounts.length; ++i) {
    this.activeTokenCounts[i] = 0;
  }
  $process(this, doc.documentElement_0);
}

function isBlockElement(tagName){
  return $equalsIgnoreCase('p', tagName) || $equalsIgnoreCase('div', tagName) || $equalsIgnoreCase('li', tagName);
}

function isHeading_0(tagName){
  var size;
  if (tagName.length == 2) {
    if (tagName.charCodeAt(0) == 104 || tagName.charCodeAt(0) == 72) {
      size = tagName.charCodeAt(1) - 48;
      if (size >= 1 && size <= 4) {
        return true;
      }
    }
  }
  return false;
}

function RichTextTokenizerImpl(){
}

_ = RichTextTokenizerImpl_0.prototype = RichTextTokenizerImpl.prototype = new Object_0;
_.getClass$ = function getClass_971(){
  return Lorg_waveprotocol_wave_model_richtext_RichTextTokenizerImpl_2_classLit;
}
;
_.toString$ = function toString_85(){
  return $toString_2(this.tokenList);
}
;
_.castableTypeMap$ = {};
_.activeTokenCounts = null;
_.document_0 = null;
_.endBlockPending = false;
_.mergeNextNewLine = false;
_.root = null;
_.tokenIndex = -1;
_.tokenList = null;
var FONT_STYLE_HANDLER, FONT_WEIGHT_HANDLER, TEXT_DECORATION_HANDLER, fontStyleMap = null, fontWeightMap = null, textDecorationMap = null;
function RichTextTokenizerImpl$StyleTokenExtractor_0(tokenStartType, tokenEndType, tagToValue, stylePropertyName){
  this.tokenStartType = tokenStartType;
  this.tokenEndType = tokenEndType;
  this.tagToValue = tagToValue;
  this.stylePropertyName = stylePropertyName;
}

function RichTextTokenizerImpl$StyleTokenExtractor(){
}

_ = RichTextTokenizerImpl$StyleTokenExtractor_0.prototype = RichTextTokenizerImpl$StyleTokenExtractor.prototype = new Object_0;
_.getClass$ = function getClass_972(){
  return Lorg_waveprotocol_wave_model_richtext_RichTextTokenizerImpl$StyleTokenExtractor_2_classLit;
}
;
_.castableTypeMap$ = {};
_.stylePropertyName = null;
_.tagToValue = null;
_.tokenEndType = null;
_.tokenStartType = null;
function RichTextTokenizerImpl$Token_0(type){
  this.type_0 = type;
  this.data_0 = null;
}

function RichTextTokenizerImpl$Token_1(type, data){
  this.type_0 = type;
  this.data_0 = data;
}

function RichTextTokenizerImpl$Token(){
}

_ = RichTextTokenizerImpl$Token_1.prototype = RichTextTokenizerImpl$Token_0.prototype = RichTextTokenizerImpl$Token.prototype = new Object_0;
_.getClass$ = function getClass_973(){
  return Lorg_waveprotocol_wave_model_richtext_RichTextTokenizerImpl$Token_2_classLit;
}
;
_.toString$ = function toString_86(){
  return '(' + this.type_0 + ',' + this.data_0 + ')';
}
;
_.castableTypeMap$ = {260:1};
_.data_0 = null;
_.type_0 = null;
function $addAttrWithValues(this$static, type, attrName, permittedValues){
  var attrs, value, value$index, value$max, values;
  checkArgument_0(!$equals_3('', type), 'Invalid type');
  checkNotNull_1(type, 'Null type');
  attrs = dynamicCast($get_12(this$static.permittedAttrs, type), 262);
  !attrs && $put_5(this$static.permittedAttrs, type, attrs = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0)));
  if (permittedValues.length == 0) {
    attrs.put_0(attrName, null);
  }
   else {
    values = dynamicCast(attrs.get_3(attrName), 261);
    !values && attrs.put_0(attrName, values = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringSetAdapter_0(new HashSet_0)));
    for (value$index = 0 , value$max = permittedValues.length; value$index < value$max; ++value$index) {
      value = permittedValues[value$index];
      checkNotNull_1(value, 'StringSet cannot contain null values');
      values.backend.add_0(value);
    }
  }
}

function $addAttrs(this$static, type, attrNames){
  var name_0, name$index, name$max;
  checkArgument_0(!$equals_3('', type), 'Invalid type');
  checkNotNull_1(type, 'Null type');
  for (name$index = 0 , name$max = attrNames.length; name$index < name$max; ++name$index) {
    name_0 = attrNames[name$index];
    $addAttrWithValues(this$static, type, name_0, initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, []));
  }
}

function $addChildren(this$static, parentType, childTypes){
  var childType, childType$index, childType$max, permitted;
  parentType = (checkArgument_0(!$equals_3('', parentType), 'Invalid type') , parentType == null?'':parentType);
  permitted = dynamicCast($get_12(this$static.permittedChildren, parentType), 261);
  !permitted && $put_5(this$static.permittedChildren, parentType, permitted = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringSetAdapter_0(new HashSet_0)));
  for (childType$index = 0 , childType$max = childTypes.length; childType$index < childType$max; ++childType$index) {
    childType = childTypes[childType$index];
    checkArgument_0(!$equals_3('', childType), 'Invalid type');
    checkNotNull_1(childType, 'Null type');
    checkNotNull_1(childType, 'StringSet cannot contain null values');
    permitted.backend.add_0(childType);
  }
}

function $containsBlipText(this$static, types){
  var type, type$index, type$max;
  for (type$index = 0 , type$max = types.length; type$index < type$max; ++type$index) {
    type = types[type$index];
    type = (checkArgument_0(!$equals_3('', type), 'Invalid type') , type == null?'':type);
    $put_5(this$static.textPermitted, type, ($clinit_1271() , BLIP_TEXT));
  }
}

function $permitsAttribute(this$static, type, attr, value){
  var attrs;
  checkArgument_0(!$equals_3('', type), 'Invalid type');
  checkNotNull_1(type, 'Null type');
  attrs = dynamicCast($get_12(this$static.permittedAttrs, type), 262);
  return !!attrs && attrs.containsKey_0(attr) && (attrs.get_3(attr) == null || $contains_7(dynamicCast(attrs.get_3(attr), 261), value));
}

function AbstractXmlSchemaConstraints_0(){
  this.permittedChildren = ($clinit_1445() , $clinit_1445() , $clinit_1445() , new CollectionUtils$StringMapAdapter_0(new HashMap_0));
  this.permittedAttrs = new CollectionUtils$StringMapAdapter_0(new HashMap_0);
  this.textPermitted = new CollectionUtils$StringMapAdapter_0(new HashMap_0);
  this.requiredInitial = new CollectionUtils$StringMapAdapter_0(new HashMap_0);
}

function AbstractXmlSchemaConstraints(){
}

_ = AbstractXmlSchemaConstraints.prototype = new Object_0;
_.getClass$ = function getClass_974(){
  return Lorg_waveprotocol_wave_model_schema_AbstractXmlSchemaConstraints_2_classLit;
}
;
_.getRequiredInitialChildren = function getRequiredInitialChildren_0(type){
  type = (checkArgument_0(!$equals_3('', type), 'Invalid type') , type == null?'':type);
  return $containsKey_5(this.requiredInitial, type)?dynamicCast($get_12(this.requiredInitial, type), 27):($clinit_430() , $clinit_430() , EMPTY_LIST);
}
;
_.permitsAttribute = function permitsAttribute_1(type, attr){
  var attrs;
  checkArgument_0(!$equals_3('', type), 'Invalid type');
  checkNotNull_1(type, 'Null type');
  attrs = dynamicCast($get_12(this.permittedAttrs, type), 262);
  return !!attrs && attrs.containsKey_0(attr);
}
;
_.permitsAttribute_0 = function permitsAttribute_2(type, attr, value){
  return $permitsAttribute(this, type, attr, value);
}
;
_.permitsChild = function permitsChild_0(parentType, childType){
  var permitted;
  parentType = (checkArgument_0(!$equals_3('', parentType), 'Invalid type') , parentType == null?'':parentType);
  checkArgument_0(!$equals_3('', childType), 'Invalid type');
  checkNotNull_1(childType, 'Null type');
  permitted = dynamicCast($get_12(this.permittedChildren, parentType), 261);
  return !!permitted && (checkNotNull_1(childType, 'StringSet cannot contain null values') , permitted.backend.contains(childType));
}
;
_.permittedCharacters = function permittedCharacters_0(typeOrNull){
  var permitted;
  typeOrNull = (checkArgument_0(!$equals_3('', typeOrNull), 'Invalid type') , typeOrNull == null?'':typeOrNull);
  permitted = dynamicCast($get_12(this.textPermitted, typeOrNull), 115);
  return permitted?permitted:($clinit_1271() , NONE_3);
}
;
_.castableTypeMap$ = {};
function $clinit_1433(){
  $clinit_1433 = nullMethod;
  BOOLEAN_VALUES = initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['true', 'false']);
}

function isValidInteger(value, min){
  $clinit_1433();
  var $e0, x;
  try {
    x = __parseAndValidateInt(value, 10);
    return x >= min;
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 147)) {
      return false;
    }
     else 
      throw $e0;
  }
}

var BOOLEAN_VALUES;
function $clinit_1434(){
  $clinit_1434 = nullMethod;
  BLIP_SCHEMA_CONSTRAINTS = new ConversationSchemas$DefaultDocumentSchema_0;
  new ConversationSchemas$1_0;
}

var BLIP_SCHEMA_CONSTRAINTS;
function ConversationSchemas$1_0(){
  AbstractXmlSchemaConstraints_0.call(this);
  $addChildren(this, null, initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['conversation']));
  $addAttrs(this, 'conversation', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['anchorWavelet', 'anchorManifestOffset', 'anchorVersion', 'anchorBlip', 'anchorOffset', 'sort']));
  $addChildren(this, 'conversation', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['blip']));
  $addAttrs(this, 'blip', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['id']));
  $addAttrWithValues(this, 'blip', 'deleted', ($clinit_1433() , BOOLEAN_VALUES));
  $addChildren(this, 'blip', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['thread']));
  $addChildren(this, 'blip', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['peer']));
  $addAttrs(this, 'thread', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['id']));
  $addAttrWithValues(this, 'thread', 'inline', BOOLEAN_VALUES);
  $addChildren(this, 'thread', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['blip']));
  $addAttrs(this, 'peer', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['id']));
}

--></script>
<script><!--
function ConversationSchemas$1(){
}

_ = ConversationSchemas$1_0.prototype = ConversationSchemas$1.prototype = new AbstractXmlSchemaConstraints;
_.getClass$ = function getClass_975(){
  return Lorg_waveprotocol_wave_model_schema_conversation_ConversationSchemas$1_2_classLit;
}
;
_.permitsAttribute_0 = function permitsAttribute_3(tag, attr, value){
  if ($equals_3('conversation', tag)) {
    if ($equals_3('anchorWavelet', attr)) {
      return isConversationalId(value != null?$deserialize(value):null);
    }
     else if ($indexOf_3(new Arrays$ArrayList_0(initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['anchorManifestOffset', 'anchorVersion', 'anchorOffset'])), attr) != -1) {
      return $clinit_1433() , isValidInteger(value, 0);
    }
     else if ($equals_3('anchorBlip', attr)) {
      return value.indexOf('b+') == 0 || value.indexOf('g+') == 0 || value.indexOf('*') != -1 && value.indexOf('m/') != 0 && value.indexOf('attach+') != 0 && value.indexOf('spell+') != 0;
    }
  }
  if ($equals_3('blip', tag) && $equals_3('id', attr)) {
    return value.indexOf('b+') == 0 || value.indexOf('g+') == 0 || value.indexOf('*') != -1 && value.indexOf('m/') != 0 && value.indexOf('attach+') != 0 && value.indexOf('spell+') != 0;
  }
  return $permitsAttribute(this, tag, attr, value);
}
;
_.castableTypeMap$ = {};
function $$init_163(this$static){
  var gadgetEl, gadgetEl$array, gadgetEl$index, gadgetEl$max;
  $addChildren(this$static, null, initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['head']));
  $addChildren(this$static, 'head', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['timestamp']));
  $addChildren(this$static, 'timestamp', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['lmt']));
  $addAttrs(this$static, 'lmt', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['t']));
  $addChildren(this$static, null, initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['body']));
  $lineContainer(this$static, 'body');
  $addAttrWithValues(this$static, 'line', 't', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['h1', 'h2', 'h3', 'h4', 'li']));
  $addAttrWithValues(this$static, 'line', 'listyle', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['decimal']));
  $addAttrWithValues(this$static, 'line', 'a', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['l', 'r', 'c', 'j']));
  $addAttrWithValues(this$static, 'line', 'd', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['l', 'r']));
  $addAttrWithValues(this$static, 'line', 'i', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, []));
  $addChildren(this$static, 'image', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['caption']));
  $addAttrWithValues(this$static, 'image', 'attachment', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, []));
  $addAttrWithValues(this$static, 'image', 'style', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['full']));
  $addChildren(this$static, 'image', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['gadget']));
  $containsBlipText(this$static, initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['caption']));
  $addChildren(this$static, 'caption', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['reply']));
  $containsBlipText(this$static, initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['label']));
  $containsBlipText(this$static, initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['input']));
  $addAttrs(this$static, 'reply', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['id']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['button', 'check', 'input', 'label', 'password', 'radiogroup', 'radio', 'textarea']));
  $lineContainer(this$static, 'textarea');
  $addAttrs(this$static, 'button', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['name']));
  $addChildren(this$static, 'button', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['caption', 'events']));
  $addChildren(this$static, 'events', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['click']));
  $addAttrs(this$static, 'click', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['time', 'clicker']));
  $addAttrs(this$static, 'check', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['name', 'submit', 'value']));
  $addAttrs(this$static, 'radiogroup', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['name', 'submit', 'value']));
  $addAttrs(this$static, 'password', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['name', 'submit', 'value']));
  $addAttrs(this$static, 'textarea', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['name', 'submit', 'value']));
  $addAttrs(this$static, 'input', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['name', 'submit']));
  $addAttrs(this$static, 'radio', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['name', 'group']));
  $addAttrs(this$static, 'click', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['time', 'clicker']));
  $addAttrs(this$static, 'label', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['for']));
  $addChildren(this$static, 'gadget', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['title', 'thumbnail', 'category', 'state', 'pref']));
  $addAttrs(this$static, 'gadget', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['url', 'title', 'prefs', 'state', 'author', 'height', 'width', 'id', 'extension', 'ifr', 'snippet']));
  for (gadgetEl$array = initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['category', 'state', 'pref']) , gadgetEl$index = 0 , gadgetEl$max = gadgetEl$array.length; gadgetEl$index < gadgetEl$max; ++gadgetEl$index) {
    gadgetEl = gadgetEl$array[gadgetEl$index];
    $addAttrs(this$static, gadgetEl, initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['name']));
  }
  for (gadgetEl$array = initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['title', 'thumbnail', 'state', 'pref']) , gadgetEl$index = 0 , gadgetEl$max = gadgetEl$array.length; gadgetEl$index < gadgetEl$max; ++gadgetEl$index) {
    gadgetEl = gadgetEl$array[gadgetEl$index];
    $addAttrs(this$static, gadgetEl, initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['value']));
  }
  $addChildren(this$static, 'profile', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['profile-field', 'gadget']));
  $addAttrs(this$static, 'profile-field', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['name', 'user-set']));
  $addAttrs(this$static, 'profile', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['avatar-url']));
  $containsBlipText(this$static, initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['profile-field']));
  $addChildren(this$static, 'mediasearch', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['result', 'customsearch']));
  $addAttrs(this$static, 'mediasearch', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['page', 'corpora', 'query', 'selected', 'pending', 'lang']));
  $addAttrs(this$static, 'result', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['thumbnail', 'thumbwidth', 'thumbheight', 'content', 'url', 'dispurl', 'title', 'snippet', 'num', 'type', 'disphtml']));
  $addAttrs(this$static, 'customsearch', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['name', 'icon', 'shortname', 'resultrows', 'resultcols', 'addmethod']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['trustreq']));
  $containsBlipText(this$static, initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['trustreq']));
  $addChildren(this$static, 'trustreq', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['trwave']));
  $addAttrs(this$static, 'trustreq', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['from', 'numberOfWaves', 'userAction']));
  $addAttrs(this$static, 'trwave', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['messageCount', 'lastModified']));
  $containsBlipText(this$static, initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['trwave']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['blacklist']));
  $addAttrs(this$static, 'blacklist', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['address', 'contacts']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['invitation']));
  $addAttrs(this$static, 'invitation', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['remaining', 'title', 'invitedString']));
  $addChildren(this$static, 'invitation', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['invited']));
  $addAttrs(this$static, 'invited', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['address']));
  $addAttrWithValues(this$static, 'eqn', 'format', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['tex']));
  $containsBlipText(this$static, initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['eqn']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['settings']));
  $addAttrs(this$static, 'settings', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['name']));
  $addChildren(this$static, 'settings', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['bool-setting', 'radio-setting', 'text-setting', 'listbox-setting']));
  $addAttrs(this$static, 'bool-setting', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['id', 'live-value', 'saved-value']));
  $addAttrs(this$static, 'radio-setting', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['id', 'live-value', 'saved-value']));
  $addAttrs(this$static, 'listbox-setting', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['id', 'live-value', 'saved-value']));
  $addAttrs(this$static, 'text-setting', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['id', 'saved-value']));
  $containsBlipText(this$static, initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['text-setting']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['html']));
  $addChildren(this$static, 'html', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['data']));
  $containsBlipText(this$static, initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['data']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['experimental']));
  $addAttrs(this$static, 'experimental', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['url']));
  $addChildren(this$static, 'experimental', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['namevaluepair', 'part']));
  $addAttrs(this$static, 'part', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['id']));
  $lineContainer(this$static, 'part');
  $addChildren(this$static, 'part', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['button', 'check', 'input', 'label', 'password', 'radiogroup', 'radio', 'textarea']));
  $addAttrs(this$static, 'namevaluepair', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['name']));
  $addAttrs(this$static, 'namevaluepair', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['value']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['translation']));
  $addChildren(this$static, 'translation', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['stanza']));
  $lineContainer(this$static, 'stanza');
  $addAttrs(this$static, 'stanza', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['lang', 'users']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['extension_installer']));
  $addAttrs(this$static, 'extension_installer', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['manifest', 'img', 'installed']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['ext-settings']));
  $addAttrs(this$static, 'ext-settings', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['manifest', 'enabled']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['gadget-settings']));
  $addAttrs(this$static, 'gadget-settings', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['url', 'prefs']));
  $addAttrs(this$static, 'img', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['alt', 'height', 'width', 'src']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['quote']));
  $lineContainer(this$static, 'quote');
}

function $lineContainer(this$static, element){
  $addChildren(this$static, element, initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, ['line', 'image', 'gadget', 'eqn', 'experimental', 'mediasearch', 'img', 'reply', 'profile']));
  $containsBlipText(this$static, initValues(_3Ljava_lang_String_2_classLit, {58:1, 138:1, 234:1}, 1, [element]));
  $put_5(this$static.requiredInitial, element, ($clinit_430() , new Collections$SingletonList_0));
}

function ConversationSchemas$DefaultDocumentSchema_0(){
  AbstractXmlSchemaConstraints_0.call(this);
  $$init_163(this);
}

function ConversationSchemas$DefaultDocumentSchema(){
}

_ = ConversationSchemas$DefaultDocumentSchema_0.prototype = ConversationSchemas$DefaultDocumentSchema.prototype = new AbstractXmlSchemaConstraints;
_.getClass$ = function getClass_976(){
  return Lorg_waveprotocol_wave_model_schema_conversation_ConversationSchemas$DefaultDocumentSchema_2_classLit;
}
;
_.permitsAttribute_0 = function permitsAttribute_4(tag, attr, value){
  if ($equals_3('line', tag) && $equals_3('i', attr)) {
    return $clinit_1433() , isValidInteger(value, 1);
  }
  if ($equals_3('img', tag) && ($equals_3('width', attr) || $equals_3('height', attr))) {
    return isValidInteger(value, 0);
  }
  if ($equals_3('lmt', tag) && $equals_3('t', attr)) {
    return $clinit_1433() , isValidInteger(value, 0);
  }
  if ($equals_3('invitation', tag) && $equals_3('remaining', attr)) {
    return $clinit_1433() , isValidInteger(value, 0);
  }
  return $permitsAttribute(this, tag, attr, value);
}
;
_.castableTypeMap$ = {};
function $nonUndoableOp_0(this$static, op){
  $nonUndoableOperation(this$static.undoStack, op);
  $nonUndoableOperation(this$static.redoStack, op);
}

function $redoPlus(this$static){
  var ops;
  ops = $pop_0(this$static.redoStack);
  if (ops) {
    $checkpoint_0(this$static.checkpointer);
    $push_1(this$static.undoStack.stack_0, new UndoStack$StackEntry_0(ops.first));
    ++this$static.checkpointer.lastPartition;
  }
  return ops;
}

function $undoPlus(this$static){
  var i, numToUndo, op, operations, ops;
  numToUndo = $releaseCheckpoint(this$static.checkpointer);
  if (numToUndo == 0) {
    return null;
  }
  operations = new ArrayList_0;
  for (i = 0; i < numToUndo - 1; ++i) {
    $add_9(operations, $pop_0(this$static.undoStack).first);
  }
  ops = $pop_0(this$static.undoStack);
  $add_9(operations, ops.first);
  op = compose_0(operations);
  $push_1(this$static.redoStack.stack_0, new UndoStack$StackEntry_0(op));
  return new Pair_0(op, ops.second);
}

function $undoableOp_0(this$static, op){
  $push_1(this$static.undoStack.stack_0, new UndoStack$StackEntry_0(op));
  ++this$static.checkpointer.lastPartition;
  $clear_2(this$static.redoStack.stack_0.arrayList);
}

function UndoManagerImpl_0(){
  this.checkpointer = new UndoManagerImpl$Checkpointer_0;
  this.undoStack = new UndoStack_0;
  this.redoStack = new UndoStack_0;
}

function UndoManagerImpl(){
}

_ = UndoManagerImpl_0.prototype = UndoManagerImpl.prototype = new Object_0;
_.getClass$ = function getClass_977(){
  return Lorg_waveprotocol_wave_model_undo_UndoManagerImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.redoStack = null;
_.undoStack = null;
function $checkpoint_0(this$static){
  if (this$static.lastPartition > 0) {
    $push_1(this$static.partitions, valueOf_0(this$static.lastPartition));
    this$static.lastPartition = 0;
  }
}

function $releaseCheckpoint(this$static){
  var value;
  if (this$static.lastPartition > 0) {
    value = this$static.lastPartition;
    this$static.lastPartition = 0;
    return value;
  }
  if (this$static.partitions.arrayList.size == 0) {
    return 0;
  }
  return dynamicCast($pop(this$static.partitions), 63).value_0;
}

function UndoManagerImpl$Checkpointer_0(){
  this.partitions = new Stack_0;
}

function UndoManagerImpl$Checkpointer(){
}

_ = UndoManagerImpl$Checkpointer_0.prototype = UndoManagerImpl$Checkpointer.prototype = new Object_0;
_.getClass$ = function getClass_978(){
  return Lorg_waveprotocol_wave_model_undo_UndoManagerImpl$Checkpointer_2_classLit;
}
;
_.castableTypeMap$ = {};
_.lastPartition = 0;
function $nonUndoableOperation(this$static, op){
  this$static.stack_0.arrayList.size == 0 || $add_9(dynamicCast($peek_0(this$static.stack_0), 263).nonUndoables, op);
}

function $pop_0(this$static){
  var $e0, e, entry, nextEntry, op, pair;
  if (this$static.stack_0.arrayList.size == 0) {
    return null;
  }
  entry = dynamicCast($pop(this$static.stack_0), 263);
  op = invert(dynamicCast(entry.op, 173));
  if (entry.nonUndoables.size == 0) {
    return new Pair_0(op, null);
  }
  try {
    pair = transform(op, compose_0(entry.nonUndoables));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 264)) {
      e = $e0;
      throw new IllegalStateException_2(e);
    }
     else 
      throw $e0;
  }
  nextEntry = this$static.stack_0.arrayList.size == 0?null:dynamicCast($peek_0(this$static.stack_0), 263);
  !!nextEntry && $add_9(nextEntry.nonUndoables, pair.serverOp);
  return new Pair_0(pair.clientOp, pair.serverOp);
}

function UndoStack_0(){
  this.stack_0 = new Stack_0;
}

function UndoStack(){
}

_ = UndoStack_0.prototype = UndoStack.prototype = new Object_0;
_.getClass$ = function getClass_979(){
  return Lorg_waveprotocol_wave_model_undo_UndoStack_2_classLit;
}
;
_.castableTypeMap$ = {};
function UndoStack$StackEntry_0(op){
  this.nonUndoables = new ArrayList_0;
  this.op = op;
}

function UndoStack$StackEntry(){
}

_ = UndoStack$StackEntry_0.prototype = UndoStack$StackEntry.prototype = new Object_0;
_.getClass$ = function getClass_980(){
  return Lorg_waveprotocol_wave_model_undo_UndoStack$StackEntry_2_classLit;
}
;
_.castableTypeMap$ = {263:1};
_.op = null;
function Box_0(){
  this.boxed = null;
}

function Box_1(boxed){
  this.boxed = boxed;
}

function Box(){
}

_ = Box_1.prototype = Box_0.prototype = Box.prototype = new Object_0;
_.getClass$ = function getClass_981(){
  return Lorg_waveprotocol_wave_model_util_Box_2_classLit;
}
;
_.castableTypeMap$ = {};
_.boxed = null;
function $modify_0(this$static){
  ++this$static.version;
  return this$static.overlay;
}

function ChainedData_0(domain){
  this.overlay = domain.empty();
  this.cache = this.overlay;
  this.roCache = domain.readOnlyView(this.cache);
}

function ChainedData(){
}

_ = ChainedData_0.prototype = ChainedData.prototype = new Object_0;
_.getClass$ = function getClass_982(){
  return Lorg_waveprotocol_wave_model_util_ChainedData_2_classLit;
}
;
_.castableTypeMap$ = {};
_.cache = null;
_.overlay = null;
_.roCache = null;
_.version = 0;
function $clinit_1445(){
  $clinit_1445 = nullMethod;
  EMPTY_MAP_2 = new CollectionUtils$EmptyStringMap_0;
}

function copyToJavaMap(source, target){
  $clinit_1445();
  source.each(new CollectionUtils$6_0(target));
  return target;
}

function join(parts){
  $clinit_1445();
  var i, ret;
  ret = new StringBuilder_0;
  parts.length > 0 && (ret.impl.string += parts[0] , ret);
  for (i = 1; i < parts.length; ++i) {
    ret.impl.string += '/';
    ret.impl.string += parts[i];
  }
  return ret.impl.string;
}

function join_0(parts){
  $clinit_1445();
  var i, ret;
  ret = new StringBuilder_0;
  parts.length > 0 && (ret.impl.string += parts[0] , ret);
  for (i = 1; i < parts.length; ++i) {
    ret.impl.string += parts[i];
  }
  return ret.impl.string;
}

function newArrayList(elements){
  $clinit_1445();
  var e, e$iterator, list;
  list = new ArrayList_0;
  for (e$iterator = elements.iterator_0(); e$iterator.hasNext();) {
    e = e$iterator.next_0();
    setCheck(list.array, list.size++, e);
  }
  return list;
}

function newStringSet(values){
  $clinit_1445();
  var s, value, value$index, value$max;
  s = new CollectionUtils$StringSetAdapter_0(new HashSet_0);
  for (value$index = 0 , value$max = values.length; value$index < value$max; ++value$index) {
    value = values[value$index];
    checkNotNull_1(value, 'StringSet cannot contain null values');
    s.backend.add_0(value);
  }
  return s;
}

var EMPTY_MAP_2;
function CollectionUtils$6_0(val$target){
  this.val$target = val$target;
}

function CollectionUtils$6(){
}

_ = CollectionUtils$6_0.prototype = CollectionUtils$6.prototype = new Object_0;
_.apply_0 = function apply_82(key, value){
  this.val$target.put(key, value);
}
;
_.getClass$ = function getClass_983(){
  return Lorg_waveprotocol_wave_model_util_CollectionUtils$6_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$target = null;
function CollectionUtils$EmptyStringMap_0(){
}

function CollectionUtils$EmptyStringMap(){
}

_ = CollectionUtils$EmptyStringMap_0.prototype = CollectionUtils$EmptyStringMap.prototype = new Object_0;
_.clear = function clear_18(){
}
;
_.containsKey_0 = function containsKey_5(key){
  return false;
}
;
_.each = function each(callback){
}
;
_.filter_0 = function filter_0(filter){
}
;
_.get_2 = function get_17(key, defaultValue){
  return null;
}
;
_.get_3 = function get_18(key){
  return null;
}
;
_.getClass$ = function getClass_984(){
  return Lorg_waveprotocol_wave_model_util_CollectionUtils$EmptyStringMap_2_classLit;
}
;
_.getExisting = function getExisting(key){
  throw new UnsupportedOperationException_0;
}
;
_.isEmpty = function isEmpty_8(){
  return true;
}
;
_.put_0 = function put_4(key, value){
  throw new UnsupportedOperationException_0;
}
;
_.putAll_0 = function putAll_1(pairsToAdd){
  throw new UnsupportedOperationException_0;
}
;
_.remove_4 = function remove_44(key){
}
;
_.castableTypeMap$ = {223:1, 262:1};
function $each(this$static, proc){
  var entry, entry$iterator;
  for (entry$iterator = new AbstractHashMap$EntrySetIterator_0((new AbstractHashMap$EntrySet_0(this$static.backend)).this$0); $hasNext_3(entry$iterator.iter);) {
    entry = entry$iterator.last = dynamicCast($next_6(entry$iterator.iter), 66);
    proc.apply_4(entry.getKey(), entry.getValue());
  }
}

function $put_2(this$static, key, value){
  if (key != null && key.castableTypeMap$ && !!key.castableTypeMap$[1] || key != null && key.castableTypeMap$ && !!key.castableTypeMap$[63] || key != null && key.castableTypeMap$ && !!key.castableTypeMap$[137] || key != null && key.castableTypeMap$ && !!key.castableTypeMap$[136]) {
    throw new UnsupportedOperationException_1('Should NOT use boxed primitives as key with identity map');
  }
  $put(this$static.backend, key, value);
}

function CollectionUtils$IdentityHashMapAdapter_0(){
  this.backend = new IdentityHashMap_0;
}

function CollectionUtils$IdentityHashMapAdapter(){
}

_ = CollectionUtils$IdentityHashMapAdapter_0.prototype = CollectionUtils$IdentityHashMapAdapter.prototype = new Object_0;
_.getClass$ = function getClass_985(){
  return Lorg_waveprotocol_wave_model_util_CollectionUtils$IdentityHashMapAdapter_2_classLit;
}
;
_.toString$ = function toString_87(){
  return $toString_6(this.backend);
}
;
_.castableTypeMap$ = {};
function $add_19(this$static, x){
  checkNotNull_1(x, 'IdentitySet cannot contain null values');
  if (x != null && x.castableTypeMap$ && !!x.castableTypeMap$[1] || x != null && x.castableTypeMap$ && !!x.castableTypeMap$[63] || x != null && x.castableTypeMap$ && !!x.castableTypeMap$[137] || x != null && x.castableTypeMap$ && !!x.castableTypeMap$[136]) {
    throw new UnsupportedOperationException_1('Should NOT use boxed primitives with IdentitySet');
  }
  $put(this$static.backend, x, x);
}

function $each_0(this$static){
  var s, s$iterator, outerIter, entry;
  for (s$iterator = (outerIter = $keySet(this$static.backend).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter)); s$iterator.val$outerIter.hasNext();) {
    s = (entry = dynamicCast(s$iterator.val$outerIter.next_0(), 66) , entry.getKey());
    $unregister(dynamicCastJso(s));
  }
}

function $remove_23(this$static, s){
  checkNotNull_1(s, 'IdentitySet cannot contain null values');
  $remove_6(this$static.backend, s);
}

function $someElement(this$static){
  var e, e$iterator, outerIter, entry;
  for (e$iterator = (outerIter = $keySet(this$static.backend).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter)); e$iterator.val$outerIter.hasNext();) {
    e = (entry = dynamicCast(e$iterator.val$outerIter.next_0(), 66) , entry.getKey());
    return e;
  }
  return null;
}

function CollectionUtils$IdentitySetAdapter_0(){
  this.backend = new IdentityHashMap_0;
}

function CollectionUtils$IdentitySetAdapter(){
}

_ = CollectionUtils$IdentitySetAdapter_0.prototype = CollectionUtils$IdentitySetAdapter.prototype = new Object_0;
_.getClass$ = function getClass_986(){
  return Lorg_waveprotocol_wave_model_util_CollectionUtils$IdentitySetAdapter_2_classLit;
}
;
_.toString$ = function toString_88(){
  return $toString_6(this.backend);
}
;
_.castableTypeMap$ = {};
function $each_1(this$static, callback){
  var entry, entry$iterator;
  for (entry$iterator = this$static.backend.entrySet_0().iterator_0(); entry$iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.next_0(), 66);
    $apply_1(callback, dynamicCast(entry.getKey(), 63).value_0, entry.getValue());
  }
}

function $put_3(this$static, key, value){
  this$static.backend.put(valueOf_0(key), value);
}

function CollectionUtils$IntMapAdapter_0(backend){
  checkNotNull_1(backend, 'Attempt to adapt a null map');
  this.backend = backend;
}

function CollectionUtils$IntMapAdapter(){
}

_ = CollectionUtils$IntMapAdapter_0.prototype = CollectionUtils$IntMapAdapter.prototype = new Object_0;
_.getClass$ = function getClass_987(){
  return Lorg_waveprotocol_wave_model_util_CollectionUtils$IntMapAdapter_2_classLit;
}
;
_.toString$ = function toString_89(){
  return $toString_6(this.backend);
}
;
_.castableTypeMap$ = {};
_.backend = null;
function $put_4(this$static, key, value){
  this$static.backend.put(new Double_0(key), value);
}

function CollectionUtils$NumberMapAdapter_0(backend){
  checkNotNull_1(backend, 'Attempt to adapt a null map');
  this.backend = backend;
}

function CollectionUtils$NumberMapAdapter(){
}

_ = CollectionUtils$NumberMapAdapter_0.prototype = CollectionUtils$NumberMapAdapter.prototype = new Object_0;
_.getClass$ = function getClass_988(){
  return Lorg_waveprotocol_wave_model_util_CollectionUtils$NumberMapAdapter_2_classLit;
}
;
_.toString$ = function toString_90(){
  return $toString_6(this.backend);
}
;
_.castableTypeMap$ = {};
_.backend = null;
function CollectionUtils$NumberPriorityQueueAdapter_0(queue){
  this.queue = queue;
}

function CollectionUtils$NumberPriorityQueueAdapter(){
}

_ = CollectionUtils$NumberPriorityQueueAdapter_0.prototype = CollectionUtils$NumberPriorityQueueAdapter.prototype = new Object_0;
_.getClass$ = function getClass_989(){
  return Lorg_waveprotocol_wave_model_util_CollectionUtils$NumberPriorityQueueAdapter_2_classLit;
}
;
_.castableTypeMap$ = {};
_.queue = null;
function $containsKey_5(this$static, key){
  checkNotNull_1(key, 'StringMap cannot contain null keys');
  return this$static.backend.containsKey(key);
}

function $each_2(this$static, callback){
  var entry, entry$iterator;
  for (entry$iterator = this$static.backend.entrySet_0().iterator_0(); entry$iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.next_0(), 66);
    callback.apply_0(dynamicCast(entry.getKey(), 1), entry.getValue());
  }
}

function $get_12(this$static, key){
  checkNotNull_1(key, 'StringMap cannot contain null keys');
  return this$static.backend.get(key);
}

function $get_13(this$static, key, defaultValue){
  checkNotNull_1(key, 'StringMap cannot contain null keys');
  return this$static.backend.containsKey(key)?this$static.backend.get(key):defaultValue;
}

function $getExisting(this$static, key){
  checkNotNull_1(key, 'StringMap cannot contain null keys');
  if (!this$static.backend.containsKey(key)) {
    throw new IllegalStateException_1("getExisting: Key '" + key + "' is not in map");
  }
  return this$static.backend.get(key);
}

function $put_5(this$static, key, value){
  checkNotNull_1(key, 'StringMap cannot contain null keys');
  this$static.backend.put(key, value);
}

function $remove_25(this$static, key){
  checkNotNull_1(key, 'StringMap cannot contain null keys');
  this$static.backend.remove_2(key);
}

function CollectionUtils$StringMapAdapter_0(backend){
  checkNotNull_1(backend, 'Attempt to adapt a null map');
  this.backend = backend;
}

--></script>
<script><!--
function CollectionUtils$StringMapAdapter(){
}

_ = CollectionUtils$StringMapAdapter_0.prototype = CollectionUtils$StringMapAdapter.prototype = new Object_0;
_.clear = function clear_19(){
  this.backend.clear();
}
;
_.containsKey_0 = function containsKey_6(key){
  return checkNotNull_1(key, 'StringMap cannot contain null keys') , this.backend.containsKey(key);
}
;
_.each = function each_0(callback){
  $each_2(this, callback);
}
;
_.filter_0 = function filter_1(filter){
  var entry, iterator;
  for (iterator = this.backend.entrySet_0().iterator_0(); iterator.hasNext();) {
    entry = dynamicCast(iterator.next_0(), 66);
    if ($apply_10(filter, dynamicCast(entry.getKey(), 1), entry.getValue()))
    ;
    else {
      iterator.remove();
    }
  }
}
;
_.get_3 = function get_19(key){
  return checkNotNull_1(key, 'StringMap cannot contain null keys') , this.backend.get(key);
}
;
_.get_2 = function get_20(key, defaultValue){
  return checkNotNull_1(key, 'StringMap cannot contain null keys') , this.backend.containsKey(key)?this.backend.get(key):defaultValue;
}
;
_.getClass$ = function getClass_990(){
  return Lorg_waveprotocol_wave_model_util_CollectionUtils$StringMapAdapter_2_classLit;
}
;
_.getExisting = function getExisting_0(key){
  return $getExisting(this, key);
}
;
_.isEmpty = function isEmpty_9(){
  return this.backend.isEmpty();
}
;
_.put_0 = function put_5(key, value){
  checkNotNull_1(key, 'StringMap cannot contain null keys');
  this.backend.put(key, value);
}
;
_.putAll_0 = function putAll_2(pairsToAdd){
  this.backend.putAll(dynamicCast(pairsToAdd, 265).backend);
}
;
_.remove_4 = function remove_45(key){
  checkNotNull_1(key, 'StringMap cannot contain null keys');
  this.backend.remove_2(key);
}
;
_.toString$ = function toString_91(){
  return toString__devirtual$(this.backend);
}
;
_.castableTypeMap$ = {223:1, 262:1, 265:1};
_.backend = null;
function $add_20(this$static, s){
  checkNotNull_1(s, 'StringSet cannot contain null values');
  this$static.backend.add_0(s);
}

function $contains_7(this$static, s){
  checkNotNull_1(s, 'StringSet cannot contain null values');
  return this$static.backend.contains(s);
}

function $each_3(this$static, callback){
  var s, s$iterator;
  for (s$iterator = this$static.backend.iterator_0(); s$iterator.hasNext();) {
    s = dynamicCast(s$iterator.next_0(), 1);
    callback.apply_3(s);
  }
}

function $filter(this$static, filter){
  var iterator, x;
  for (iterator = this$static.backend.iterator_0(); iterator.hasNext();) {
    x = dynamicCast(iterator.next_0(), 1);
    if ($apply_11(filter, x))
    ;
    else {
      iterator.remove();
    }
  }
}

function $isSubsetOf(this$static, other){
  var s, s$iterator;
  for (s$iterator = this$static.backend.iterator_0(); s$iterator.hasNext();) {
    s = dynamicCast(s$iterator.next_0(), 1);
    checkNotNull_1(s, 'StringSet cannot contain null values');
    if (!other.backend.contains(s)) {
      return false;
    }
  }
  return true;
}

function $remove_26(this$static, s){
  checkNotNull_1(s, 'StringSet cannot contain null values');
  this$static.backend.remove_1(s);
}

function CollectionUtils$StringSetAdapter_0(backend){
  checkNotNull_1(backend, 'Attempt to adapt a null set');
  this.backend = backend;
}

function CollectionUtils$StringSetAdapter(){
}

_ = CollectionUtils$StringSetAdapter_0.prototype = CollectionUtils$StringSetAdapter.prototype = new Object_0;
_.getClass$ = function getClass_991(){
  return Lorg_waveprotocol_wave_model_util_CollectionUtils$StringSetAdapter_2_classLit;
}
;
_.toString$ = function toString_92(){
  return toString__devirtual$(this.backend);
}
;
_.castableTypeMap$ = {259:1, 261:1};
_.backend = null;
function ConcurrentSet_0(){
  this.set = new HashSet_0;
  new HashSet_0;
  new HashSet_0;
}

function ConcurrentSet(){
}

_ = ConcurrentSet_0.prototype = ConcurrentSet.prototype = new Object_0;
_.getClass$ = function getClass_992(){
  return Lorg_waveprotocol_wave_model_util_ConcurrentSet_2_classLit;
}
;
_.iterator_0 = function iterator_25(){
  var outerIter;
  return outerIter = $keySet(this.set.map).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter);
}
;
_.castableTypeMap$ = {};
function $clinit_1456(){
  $clinit_1456 = nullMethod;
  HASH_SET = new CopyOnWriteSet$1_0;
  LIST_SET = new CopyOnWriteSet$2_0;
}

function $add_22(this$static, o){
  if (this$static.stale) {
    if (this$static.contents.contains(o)) {
      return false;
    }
     else {
      this$static.contents = this$static.factory.copy(this$static.contents);
      this$static.stale = false;
      return this$static.contents.add_0(o);
    }
  }
   else {
    return this$static.contents.add_0(o);
  }
}

function $clear_12(this$static){
  this$static.contents = ($clinit_430() , $clinit_430() , EMPTY_SET);
  this$static.stale = true;
}

function $iterator_17(this$static){
  this$static.stale = true;
  return this$static.contents.iterator_0();
}

function $remove_28(this$static, o){
  if (this$static.stale) {
    if (this$static.contents.contains(o)) {
      this$static.contents = this$static.factory.copy(this$static.contents);
      this$static.stale = false;
      return this$static.contents.remove_1(o);
    }
     else {
      return false;
    }
  }
   else {
    return this$static.contents.remove_1(o);
  }
}

function CopyOnWriteSet_0(factory){
  $clinit_1456();
  this.contents = ($clinit_430() , $clinit_430() , EMPTY_SET);
  this.factory = factory;
}

function CopyOnWriteSet(){
}

_ = CopyOnWriteSet_0.prototype = CopyOnWriteSet.prototype = new Object_0;
_.getClass$ = function getClass_993(){
  return Lorg_waveprotocol_wave_model_util_CopyOnWriteSet_2_classLit;
}
;
_.iterator_0 = function iterator_26(){
  return this.stale = true , this.contents.iterator_0();
}
;
_.toString$ = function toString_93(){
  return this.contents.toString$();
}
;
_.castableTypeMap$ = {};
_.factory = null;
_.stale = true;
var HASH_SET, LIST_SET;
function CopyOnWriteSet$1_0(){
}

function CopyOnWriteSet$1(){
}

_ = CopyOnWriteSet$1_0.prototype = CopyOnWriteSet$1.prototype = new Object_0;
_.copy = function copy_1(source){
  return new LinkedHashSet_0(source);
}
;
_.getClass$ = function getClass_994(){
  return Lorg_waveprotocol_wave_model_util_CopyOnWriteSet$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function CopyOnWriteSet$2_0(){
}

function CopyOnWriteSet$2(){
}

_ = CopyOnWriteSet$2_0.prototype = CopyOnWriteSet$2.prototype = new Object_0;
_.copy = function copy_2(source){
  return newArrayList(source);
}
;
_.getClass$ = function getClass_995(){
  return Lorg_waveprotocol_wave_model_util_CopyOnWriteSet$2_2_classLit;
}
;
_.castableTypeMap$ = {};
function $performActionAt(this$static, offset, locationAction){
  var node;
  node = this$static.root;
  while (node) {
    if (offset < node.offset) {
      node = node.leftChild;
    }
     else {
      offset -= node.offset;
      if (offset < node.size) {
        return locationAction.performAction(node, offset);
      }
      offset -= node.size;
      node = node.rightChild;
    }
  }
  throw new IndexOutOfBoundsException_1('Invalid offest: ' + offset + ', size: ' + this$static.root.offset);
}

function EvaluableOffsetList_0(){
  this.root = new EvaluableOffsetList$Node_0(null, 1);
  this.root.previousContainer = this.root;
  this.root.nextContainer = this.root;
}

function getHeight(node){
  return !node?-1:node.height_0;
}

function EvaluableOffsetList(){
}

_ = EvaluableOffsetList_0.prototype = EvaluableOffsetList.prototype = new Object_0;
_.getClass$ = function getClass_996(){
  return Lorg_waveprotocol_wave_model_util_EvaluableOffsetList_2_classLit;
}
;
_.iterator_0 = function iterator_27(){
  return new EvaluableOffsetList$1_0(this);
}
;
_.castableTypeMap$ = {};
_.root = null;
function EvaluableOffsetList$1_0(this$0){
  this.this$0 = this$0;
  this.nextContainer = this.this$0.root.nextContainer;
}

function EvaluableOffsetList$1(){
}

_ = EvaluableOffsetList$1_0.prototype = EvaluableOffsetList$1.prototype = new Object_0;
_.getClass$ = function getClass_997(){
  return Lorg_waveprotocol_wave_model_util_EvaluableOffsetList$1_2_classLit;
}
;
_.hasNext = function hasNext_20(){
  return this.nextContainer != this.this$0.root;
}
;
_.next_0 = function next_26(){
  var returnValue_0;
  return returnValue_0 = this.nextContainer.value_0 , this.nextContainer = this.nextContainer.nextContainer , returnValue_0;
}
;
_.remove = function remove_46(){
  throw new UnsupportedOperationException_0;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $correctOffsets(this$static, sizeDelta){
  var node, parentNode;
  for (node = this$static , parentNode = this$static.parent_0; parentNode; node = parentNode , parentNode = parentNode.parent_0) {
    parentNode.leftChild == node && (parentNode.offset += sizeDelta);
  }
}

function $getFirstInSubtree(this$static){
  var child, node;
  node = this$static;
  for (child = this$static.leftChild; child; node = child , child = child.leftChild) {
  }
  return node;
}

function $getLastInSubtree(this$static){
  var child, node;
  node = this$static;
  for (child = this$static.rightChild; child; node = child , child = child.rightChild) {
  }
  return node;
}

function $increaseSize(this$static, sizeDelta){
  this$static.size += sizeDelta;
  $correctOffsets(this$static, sizeDelta);
}

function $insertBefore_8(this$static, newValue, valueSize){
  var newContainer;
  newContainer = new EvaluableOffsetList$Node_0(newValue, valueSize);
  newContainer.previousContainer = this$static.previousContainer;
  newContainer.nextContainer = this$static;
  this$static.previousContainer.nextContainer = newContainer;
  this$static.previousContainer = newContainer;
  !this$static.leftChild?(this$static.leftChild = newContainer , newContainer.parent_0 = this$static):$setRightChild($getLastInSubtree(this$static.leftChild), newContainer);
  this$static.offset += newContainer.size;
  $correctOffsets(this$static, newContainer.size);
  $rebalance(newContainer.parent_0);
  return newContainer;
}

function $offset(this$static){
  var currentNode, currentParent, totalOffset;
  totalOffset = this$static.offset;
  for (currentNode = this$static , currentParent = this$static.parent_0; currentParent; currentParent = currentParent.parent_0) {
    currentParent.rightChild == currentNode && (totalOffset += currentParent.offset + currentParent.size);
    currentNode = currentParent;
  }
  return totalOffset;
}

function $rebalance(this$static){
  var leftHeight, node, oldHeight, rightHeight;
  for (node = this$static; node.parent_0; node = node.parent_0) {
    oldHeight = node.height_0;
    leftHeight = getHeight(node.leftChild);
    rightHeight = getHeight(node.rightChild);
    if (rightHeight == leftHeight + 2) {
      getHeight(node.rightChild.rightChild) != rightHeight - 1 && $rotateRight(node.rightChild);
      node = $rotateLeft(node);
    }
     else if (leftHeight == rightHeight + 2) {
      getHeight(node.leftChild.leftChild) != leftHeight - 1 && $rotateLeft(node.leftChild);
      node = $rotateRight(node);
    }
     else {
      node.height_0 = (leftHeight > rightHeight?leftHeight:rightHeight) + 1;
    }
    if (node.height_0 == oldHeight) {
      break;
    }
  }
}

function $remove_29(this$static){
  var node, parentOfReplacement, removalSize, replacementNode;
  this$static.nextContainer.previousContainer = this$static.previousContainer;
  this$static.previousContainer.nextContainer = this$static.nextContainer;
  $correctOffsets(this$static, -this$static.size);
  if (!this$static.rightChild) {
    $replaceWith(this$static, this$static.leftChild);
    $rebalance(this$static.parent_0);
  }
   else {
    replacementNode = $getFirstInSubtree(this$static.rightChild);
    parentOfReplacement = replacementNode.parent_0;
    removalSize = replacementNode.size;
    for (node = parentOfReplacement; node != this$static; node = node.parent_0) {
      node.offset -= removalSize;
    }
    $replaceWith(replacementNode, replacementNode.rightChild);
    !!replacementNode && (replacementNode.parent_0 = this$static.parent_0);
    this$static.parent_0.leftChild == this$static?(this$static.parent_0.leftChild = replacementNode):(this$static.parent_0.rightChild = replacementNode);
    $setLeftChildSafely(replacementNode, this$static.leftChild);
    $setRightChildSafely(replacementNode, this$static.rightChild);
    replacementNode.offset = this$static.offset;
    replacementNode.height_0 = this$static.height_0;
    $rebalance(parentOfReplacement != this$static?parentOfReplacement:replacementNode);
  }
  this$static.nextContainer = null;
  this$static.previousContainer = null;
  this$static.parent_0 = null;
  this$static.leftChild = null;
  this$static.rightChild = null;
}

function $replaceWith(this$static, replacement){
  !!replacement && (replacement.parent_0 = this$static.parent_0);
  this$static.parent_0.leftChild == this$static?(this$static.parent_0.leftChild = replacement):(this$static.parent_0.rightChild = replacement);
}

function $rotateLeft(this$static){
  var newRoot, subtree1, subtree2;
  newRoot = this$static.rightChild;
  subtree1 = newRoot.leftChild;
  subtree2 = this$static.leftChild;
  !!newRoot && (newRoot.parent_0 = this$static.parent_0);
  this$static.parent_0.leftChild == this$static?(this$static.parent_0.leftChild = newRoot):(this$static.parent_0.rightChild = newRoot);
  this$static.rightChild = subtree1;
  !!subtree1 && (subtree1.parent_0 = this$static);
  newRoot.leftChild = this$static;
  this$static.parent_0 = newRoot;
  this$static.height_0 = max(!subtree1?-1:subtree1.height_0, !subtree2?-1:subtree2.height_0) + 1;
  this$static.height_0 + 1 > newRoot.height_0 && (newRoot.height_0 = this$static.height_0 + 1);
  newRoot.offset += this$static.offset + this$static.size;
  return newRoot;
}

function $rotateRight(this$static){
  var newRoot, subtree1, subtree2;
  newRoot = this$static.leftChild;
  subtree1 = newRoot.rightChild;
  subtree2 = this$static.rightChild;
  !!newRoot && (newRoot.parent_0 = this$static.parent_0);
  this$static.parent_0.leftChild == this$static?(this$static.parent_0.leftChild = newRoot):(this$static.parent_0.rightChild = newRoot);
  this$static.leftChild = subtree1;
  !!subtree1 && (subtree1.parent_0 = this$static);
  newRoot.rightChild = this$static;
  this$static.parent_0 = newRoot;
  this$static.height_0 = max(!subtree1?-1:subtree1.height_0, !subtree2?-1:subtree2.height_0) + 1;
  this$static.height_0 + 1 > newRoot.height_0 && (newRoot.height_0 = this$static.height_0 + 1);
  this$static.offset -= newRoot.offset + newRoot.size;
  return newRoot;
}

function $setLeftChildSafely(this$static, leftChild){
  this$static.leftChild = leftChild;
  !!leftChild && (leftChild.parent_0 = this$static);
}

function $setRightChild(this$static, rightChild){
  this$static.rightChild = rightChild;
  rightChild.parent_0 = this$static;
}

function $setRightChildSafely(this$static, rightChild){
  this$static.rightChild = rightChild;
  !!rightChild && (rightChild.parent_0 = this$static);
}

function $split_1(this$static, offset, newValue){
  var newContainer, node, secondSize;
  secondSize = this$static.size - offset;
  newContainer = new EvaluableOffsetList$Node_0(newValue, secondSize);
  newContainer.nextContainer = this$static.nextContainer;
  newContainer.previousContainer = this$static;
  this$static.nextContainer.previousContainer = newContainer;
  this$static.nextContainer = newContainer;
  this$static.size = offset;
  if (!this$static.rightChild) {
    this$static.rightChild = newContainer;
    newContainer.parent_0 = this$static;
  }
   else {
    node = this$static.rightChild;
    while (node.leftChild) {
      node.offset += secondSize;
      node = node.leftChild;
    }
    node.offset += secondSize;
    node.leftChild = newContainer;
    newContainer.parent_0 = node;
  }
  $rebalance(newContainer.parent_0);
  return newContainer;
}

function EvaluableOffsetList$Node_0(value, size){
  this.value_0 = value;
  this.size = size;
}

function EvaluableOffsetList$Node(){
}

_ = EvaluableOffsetList$Node_0.prototype = EvaluableOffsetList$Node.prototype = new Object_0;
_.getClass$ = function getClass_998(){
  return Lorg_waveprotocol_wave_model_util_EvaluableOffsetList$Node_2_classLit;
}
;
_.toString$ = function toString_94(){
  return $offset(this) + ',' + this.size + ':' + this.value_0;
}
;
_.castableTypeMap$ = {};
_.height_0 = 0;
_.leftChild = null;
_.nextContainer = null;
_.offset = 0;
_.parent_0 = null;
_.previousContainer = null;
_.rightChild = null;
_.size = 0;
_.value_0 = null;
function Pair_0(first, second){
  this.first = first;
  this.second = second;
}

function Pair(){
}

_ = Pair_0.prototype = Pair.prototype = new Object_0;
_.equals$ = function equals_32(o){
  var p;
  if (o == null)
    return false;
  if (o === this)
    return true;
  if (o != null && o.castableTypeMap$ && !!o.castableTypeMap$[224]) {
    p = dynamicCast(o, 224);
    return (maskUndefined(p.first) === maskUndefined(this.first) || this.first != null && equals__devirtual$(this.first, p.first)) && (maskUndefined(p.second) === maskUndefined(this.second) || this.second != null && equals__devirtual$(this.second, p.second));
  }
  return false;
}
;
_.getClass$ = function getClass_999(){
  return Lorg_waveprotocol_wave_model_util_Pair_2_classLit;
}
;
_.hashCode$ = function hashCode_32(){
  return (this.first == null?0:hashCode__devirtual$(this.first)) + 37 * (this.second == null?0:hashCode__devirtual$(this.second));
}
;
_.toString$ = function toString_95(){
  return '(' + this.first + ',' + this.second + ')';
}
;
_.castableTypeMap$ = {224:1};
_.first = null;
_.second = null;
function checkArgument_0(condition, errorMessage){
  if (!condition) {
    throw new IllegalArgumentException_1('' + errorMessage);
  }
}

function checkArgument_1(condition, errorMessageTemplate, errorMessageArgs){
  if (!condition) {
    throw new IllegalArgumentException_1(format_0(errorMessageTemplate, errorMessageArgs));
  }
}

function checkElementIndex(index, size){
  if (index < 0) {
    throw new IndexOutOfBoundsException_1('index (' + index + ') must not be negative');
  }
  if (index >= size) {
    throw new IndexOutOfBoundsException_1('index (' + index + ') must be less than size (' + size + ')');
  }
}

function checkNotNull_1(x, errorMessage){
  if (x == null) {
    throw new NullPointerException_1('' + errorMessage);
  }
  return x;
}

function checkPositionIndex(index, size){
  if (index < 0) {
    throw new IndexOutOfBoundsException_1('index (' + index + ') must not be negative');
  }
  if (index > size) {
    throw new IndexOutOfBoundsException_1('index (' + index + ') must not be greater than size (' + size + ')');
  }
}

function checkPositionIndexesInRange(start, end, rangeEnd){
  if (start < 0) {
    throw new IndexOutOfBoundsException_1('start index (' + start + ') must not be less than start of range (0)');
  }
  if (end < start) {
    throw new IndexOutOfBoundsException_1('end index (' + end + ') must not be less than start index (' + start + ')');
  }
  if (end > rangeEnd) {
    throw new IndexOutOfBoundsException_1('end index (' + end + ') must not be greater than end of range (' + rangeEnd + ')');
  }
}

function checkState(condition, errorMessage){
  if (!condition) {
    throw new IllegalStateException_1('' + errorMessage);
  }
}

function format_0(template, args){
  var builder, i, placeholderStart, templateStart;
  template = '' + template;
  builder = new StringBuilder_1(template.length + 16 * args.length);
  templateStart = 0;
  i = 0;
  while (i < args.length) {
    placeholderStart = template.indexOf('%s', templateStart);
    if (placeholderStart == -1) {
      break;
    }
    $append_8(builder, template.substr(templateStart, placeholderStart - templateStart));
    $append_7(builder, args[i++]);
    templateStart = placeholderStart + 2;
  }
  $append_8(builder, template.substr(templateStart, template.length - templateStart));
  if (i < args.length) {
    builder.impl.string += ' [';
    $append_7(builder, args[i++]);
    while (i < args.length) {
      builder.impl.string += ', ';
      $append_7(builder, args[i++]);
    }
    builder.impl.string += ']';
  }
  return builder.impl.string;
}

function illegalArgument(errorMessage){
  throw new IllegalArgumentException_1('' + errorMessage);
}

function illegalState(errorMessage){
  throw new IllegalStateException_1('' + errorMessage);
}

function nullPointer(){
  throw new NullPointerException_1('This map does not allow null keys or values');
}

function $clinit_1490(){
  $clinit_1490 = nullMethod;
  VALID_UTF16 = new Utf16Util$2_0;
  GOOD_UTF16_FOR_BLIP = new Utf16Util$3_0;
}

function firstSurrogate(s){
  $clinit_1490();
  var i;
  for (i = 0; i < s.length; ++i) {
    if (isSurrogate(s.charCodeAt(i))) {
      return i;
    }
  }
  return -1;
}

function isCodePointGoodForBlip(c){
  $clinit_1490();
  0 <= c && c <= 1114111 || illegalArgument('Not a code point: 0x' + toPowerOfTwoString(c));
  (0 <= c && c <= 1114111 || illegalArgument('Not a code point: 0x' + toPowerOfTwoString(c)) , 55296 <= c && c <= 57343) && illegalArgument('Code point is a surrogate: 0x' + toPowerOfTwoString(c));
  if (!isCodePointValid(c)) {
    return $clinit_1494() , NONCHARACTER;
  }
  if (0 <= c && c <= 31 || 127 <= c && c <= 159) {
    return $clinit_1494() , CONTROL;
  }
  if (8298 <= c && c <= 8303) {
    return $clinit_1494() , DEPRECATED;
  }
  if (c == 8206 || c == 8207) {
    return $clinit_1494() , BIDI;
  }
  if (8234 <= c && c <= 8238) {
    return $clinit_1494() , BIDI;
  }
  if (917504 <= c && c <= 917631) {
    return $clinit_1494() , TAG;
  }
  return $clinit_1494() , OK;
}

function isCodePointValid(c){
  $clinit_1490();
  var d;
  0 <= c && c <= 1114111 || illegalArgument('Not a code point: 0x' + toPowerOfTwoString(c));
  (0 <= c && c <= 1114111 || illegalArgument('Not a code point: 0x' + toPowerOfTwoString(c)) , 55296 <= c && c <= 57343) && illegalArgument('Code point is a surrogate: 0x' + toPowerOfTwoString(c));
  d = c & 65535;
  if (d == 65534 || d == 65535) {
    return false;
  }
  if (64976 <= c && c <= 65007) {
    return false;
  }
  return true;
}

function isHighSurrogate(c){
  $clinit_1490();
  return 55296 <= c && c <= 56319;
}

function isSurrogate(c){
  return 55296 <= c && c <= 57343;
}

function isXmlName_0(s){
  $clinit_1490();
  checkNotNull_1(s, 'Null XML name string');
  if (!s.length) {
    return false;
  }
  return traverseUtf16String(s, new Utf16Util$5_0).value_0;
}

function isXmlNameChar_0(c){
  $clinit_1490();
  if (!isCodePointValid(c)) {
    return false;
  }
  return c == 58 || 65 <= c && c <= 90 || c == 95 | (97 <= c && c <= 122) || 192 <= c && c <= 214 || 216 <= c && c <= 246 || 248 <= c && c <= 767 || 880 <= c && c <= 893 || 895 <= c && c <= 8191 || 8204 <= c && c <= 8205 || 8304 <= c && c <= 8591 || 11264 <= c && c <= 12271 || 12289 <= c && c <= 55295 || 63744 <= c && c <= 64975 || 65008 <= c && c <= 65533 || 65536 <= c && c <= 983039 && isCodePointValid(c) || c == 45 || c == 46 || 48 <= c && c <= 57 || c == 183 || 768 <= c && c <= 879 || 8255 <= c && c <= 8256;
}

function traverseUtf16String(s, handler){
  $clinit_1490();
  var c, c2, cp, i, v;
  checkNotNull_1(s, 'Null string');
  nextCodeUnit: for (i = 0; i < s.length; ++i) {
    c = s.charCodeAt(i);
    if (55296 <= c && c <= 57343) {
      if (56320 <= c && c <= 57343) {
        v = handler.unpairedSurrogate(c);
        if (v) {
          return v;
        }
        continue nextCodeUnit;
      }
      ++i;
      if (i >= s.length) {
        v = handler.unpairedSurrogate(c);
        if (v) {
          return v;
        }
        break nextCodeUnit;
      }
      c2 = s.charCodeAt(i);
      if (56320 <= c2 && c2 <= 57343) {
        cp = 65536 + ((c & 1023) << 10) + (c2 & 1023);
      }
       else {
        v = handler.unpairedSurrogate(c);
        if (v) {
          return v;
        }
        --i;
        continue nextCodeUnit;
      }
    }
     else {
      cp = c;
    }
    v = handler.codePoint(cp);
    if (v) {
      return v;
    }
  }
  return handler.endOfString();
}

var GOOD_UTF16_FOR_BLIP, VALID_UTF16;
function $codePoint_0(cp){
  if (!isCodePointValid(cp)) {
    return $clinit_382() , $clinit_382() , FALSE;
  }
  return null;
}

function Utf16Util$2_0(){
}

function Utf16Util$2(){
}

_ = Utf16Util$2_0.prototype = Utf16Util$2.prototype = new Object_0;
_.codePoint = function codePoint_3(cp){
  return $codePoint_0(cp);
}
;
_.endOfString = function endOfString_2(){
  return $clinit_382() , $clinit_382() , TRUE;
}
;
_.getClass$ = function getClass_1000(){
  return Lorg_waveprotocol_wave_model_util_Utf16Util$2_2_classLit;
}
;
_.unpairedSurrogate = function unpairedSurrogate_2(c){
  return $clinit_382() , $clinit_382() , FALSE;
}
;
_.castableTypeMap$ = {};
function $codePoint_1(cp){
  if (isCodePointGoodForBlip(cp) != ($clinit_1494() , OK)) {
    return $clinit_382() , $clinit_382() , FALSE;
  }
  return null;
}

function Utf16Util$3_0(){
}

function Utf16Util$3(){
}

_ = Utf16Util$3_0.prototype = Utf16Util$3.prototype = new Object_0;
_.codePoint = function codePoint_4(cp){
  return $codePoint_1(cp);
}
;
_.endOfString = function endOfString_3(){
  return $clinit_382() , $clinit_382() , TRUE;
}
;
_.getClass$ = function getClass_1001(){
  return Lorg_waveprotocol_wave_model_util_Utf16Util$3_2_classLit;
}
;
_.unpairedSurrogate = function unpairedSurrogate_3(c){
  return $clinit_382() , $clinit_382() , FALSE;
}
;
_.castableTypeMap$ = {};
function $codePoint_2(this$static, cp){
  if (this$static.first) {
    $clinit_1490();
    if (!(cp == 58 || 65 <= cp && cp <= 90 || cp == 95 | (97 <= cp && cp <= 122) || 192 <= cp && cp <= 214 || 216 <= cp && cp <= 246 || 248 <= cp && cp <= 767 || 880 <= cp && cp <= 893 || 895 <= cp && cp <= 8191 || 8204 <= cp && cp <= 8205 || 8304 <= cp && cp <= 8591 || 11264 <= cp && cp <= 12271 || 12289 <= cp && cp <= 55295 || 63744 <= cp && cp <= 64975 || 65008 <= cp && cp <= 65533 || 65536 <= cp && cp <= 983039 && isCodePointValid(cp))) {
      return $clinit_382() , $clinit_382() , FALSE;
    }
    this$static.first = false;
  }
   else {
    if (!isXmlNameChar_0(cp)) {
      return $clinit_382() , $clinit_382() , FALSE;
    }
  }
  return null;
}

function Utf16Util$5_0(){
}

function Utf16Util$5(){
}

_ = Utf16Util$5_0.prototype = Utf16Util$5.prototype = new Object_0;
_.codePoint = function codePoint_5(cp){
  return $codePoint_2(this, cp);
}
;
_.endOfString = function endOfString_4(){
  return $clinit_382() , $clinit_382() , TRUE;
}
;
_.getClass$ = function getClass_1002(){
  return Lorg_waveprotocol_wave_model_util_Utf16Util$5_2_classLit;
}
;
_.unpairedSurrogate = function unpairedSurrogate_4(c){
  return $clinit_382() , $clinit_382() , FALSE;
}
;
_.castableTypeMap$ = {};
_.first = true;
function $clinit_1494(){
  $clinit_1494 = nullMethod;
  OK = new Utf16Util$BlipCodePointResult_0('OK', 0);
  CONTROL = new Utf16Util$BlipCodePointResult_0('CONTROL', 1);
  DEPRECATED = new Utf16Util$BlipCodePointResult_0('DEPRECATED', 2);
  BIDI = new Utf16Util$BlipCodePointResult_0('BIDI', 3);
  TAG = new Utf16Util$BlipCodePointResult_0('TAG', 4);
  NONCHARACTER = new Utf16Util$BlipCodePointResult_0('NONCHARACTER', 5);
  $VALUES_57 = initValues(_3Lorg_waveprotocol_wave_model_util_Utf16Util$BlipCodePointResult_2_classLit, {58:1, 138:1}, 128, [OK, CONTROL, DEPRECATED, BIDI, TAG, NONCHARACTER]);
}

function Utf16Util$BlipCodePointResult_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_58(){
  $clinit_1494();
  return $VALUES_57;
}

function Utf16Util$BlipCodePointResult(){
}

_ = Utf16Util$BlipCodePointResult_0.prototype = Utf16Util$BlipCodePointResult.prototype = new Enum;
_.getClass$ = function getClass_1003(){
  return Lorg_waveprotocol_wave_model_util_Utf16Util$BlipCodePointResult_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 128:1};
var $VALUES_57, BIDI, CONTROL, DEPRECATED, NONCHARACTER, OK, TAG;
function equal_0(a_0, b){
  return a_0 == null?b == null:equals__devirtual$(a_0, b);
}

function valueOrDefault(value, def){
  return value != null?value:def;
}

function InvalidWaveRefException_0(ref, message){
  this.fillInStackTrace();
  this.detailMessage = message;
  this.ref = ref;
}

function InvalidWaveRefException_1(ref, message, cause){
  this.fillInStackTrace();
  this.cause = cause;
  this.detailMessage = message;
  this.ref = ref;
}

function InvalidWaveRefException(){
}

_ = InvalidWaveRefException_1.prototype = InvalidWaveRefException_0.prototype = InvalidWaveRefException.prototype = new Exception;
_.getClass$ = function getClass_1004(){
  return Lorg_waveprotocol_wave_model_waveref_InvalidWaveRefException_2_classLit;
}
;
_.getMessage = function getMessage_2(){
  return "Invalid waveRef '" + this.ref + "': " + this.detailMessage;
}
;
_.castableTypeMap$ = {3:1, 58:1, 143:1, 160:1};
_.ref = null;
function WaveRef_0(waveId, wavelet, documentId){
  checkNotNull_1(waveId, 'Waveref must have non-null wave-id');
  this.waveId = waveId;
  this.waveletId = wavelet;
  wavelet?(this.documentId = documentId):(this.documentId = null);
}

function of_2(waveId){
  checkNotNull_1(waveId, 'Null wave Id');
  return new WaveRef_0(waveId, null, null);
}

function WaveRef(){
}

_ = WaveRef_0.prototype = WaveRef.prototype = new Object_0;
_.equals$ = function equals_33(obj){
  var other;
  if (this === obj) {
    return true;
  }
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[266])) {
    return false;
  }
  other = dynamicCast(obj, 266);
  return equal_0(this.waveId, other.waveId) && equal_0(this.waveletId, other.waveletId) && equal_0(this.documentId, other.documentId);
}
;
_.getClass$ = function getClass_1005(){
  return Lorg_waveprotocol_wave_model_waveref_WaveRef_2_classLit;
}
;
--></script>
<script><!--
_.hashCode$ = function hashCode_33(){
  var result;
  result = 31 + $hashCode_4(this.waveId);
  !!this.waveletId && (result = 31 * result + $hashCode_5(this.waveletId));
  this.documentId != null && (result = 31 * result + getHashCode_0(this.documentId));
  return result;
}
;
_.toString$ = function toString_96(){
  var result;
  result = new StringBuilder_2('[WaveRef:');
  !!this.waveId && $append_8(result, '[WaveId ' + $serialiseWaveId(this.waveId) + ']');
  !!this.waveletId && $append_8(result, '[WaveletId ' + $serialiseWaveletId(this.waveletId) + ']');
  if (this.documentId != null) {
    result.impl.string += '[documentId:';
    $append_8(result, this.documentId);
    result.impl.string += ']';
  }
  return (result.impl.string += ']' , result).impl.string;
}
;
_.castableTypeMap$ = {266:1};
_.documentId = null;
_.waveId = null;
_.waveletId = null;
function $decode(string){
  var $e0, e;
  try {
    return throwIfNull('encodedURL', string) , decodeURI(string);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 202)) {
      e = $e0;
      throw new InvalidWaveRefException_1(string, 'Failed to decode', e);
    }
     else 
      throw $e0;
  }
}

function $decodeWaveRefFromPath(path){
  var $e0, documentId, e, tokens, waveDomain, waveId, waveIdStr, waveletDomain, waveletId, waveletIdStr;
  tokens = $split(path, '/', 0);
  if (tokens.length < 2 || tokens.length == 3) {
    throw new InvalidWaveRefException_0(path, 'Invalid number of tokens in path given to decodeWaveRefFromPath');
  }
  if (tokens[0].length == 0 || tokens[1].length == 0) {
    throw new InvalidWaveRefException_0(path, 'The wave domain and thewave Id must not be empty.');
  }
  waveDomain = $decode(tokens[0].toLowerCase());
  waveIdStr = $decode(tokens[1]);
  try {
    waveId = (checkNotNull_1(waveDomain, 'Null domain') , checkNotNull_1(waveIdStr, 'Null id') , checkArgument_1(isValidDomain(waveDomain), 'Invalid domain %s', initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, [waveDomain])) , checkArgument_1(($clinit_1412() , !!waveIdStr.length && traverseUtf16String(waveIdStr, GOOD_UTF16_FOR_ID).value_0), 'Invalid id %s', initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, [waveIdStr])) , new WaveId_0(waveDomain, waveIdStr));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 202)) {
      e = $e0;
      throw new InvalidWaveRefException_0(path, 'Invalid WaveID:' + e.detailMessage);
    }
     else 
      throw $e0;
  }
  if (tokens.length == 2) {
    return checkNotNull_1(waveId, 'Null wave Id') , new WaveRef_0(waveId, null, null);
  }
  if (tokens[2].length == 0 || tokens[3].length == 0) {
    throw new InvalidWaveRefException_0(path, 'The wavelet domain and thewavelet Id must not be empty.');
  }
  waveletDomain = $decode(tokens[2]);
  $equals_3(waveletDomain, '~') && (waveletDomain = waveDomain);
  waveletIdStr = $decode(tokens[3]);
  try {
    waveletId = (checkNotNull_1(waveletDomain, 'Null domain') , checkNotNull_1(waveletIdStr, 'Null id') , checkArgument_1(isValidDomain(waveletDomain), 'Invalid domain %s', initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, [waveletDomain])) , checkArgument_1(($clinit_1412() , !!waveletIdStr.length && traverseUtf16String(waveletIdStr, GOOD_UTF16_FOR_ID).value_0), 'Invalid id %s', initValues(_3Ljava_lang_Object_2_classLit, {58:1, 138:1}, 0, [waveletIdStr])) , new WaveletId_0(waveletDomain, waveletIdStr));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 202)) {
      e = $e0;
      throw new InvalidWaveRefException_1(path, 'Invalid WaveletID', e);
    }
     else 
      throw $e0;
  }
  if (tokens.length == 4) {
    return checkNotNull_1(waveId, 'Null wave Id') , checkNotNull_1(waveletId, 'Null wavelet Id') , new WaveRef_0(waveId, waveletId, null);
  }
   else {
    documentId = tokens[4];
    return checkNotNull_1(waveId, 'Null wave Id') , checkNotNull_1(waveletId, 'Null wavelet Id') , checkNotNull_1(documentId, 'Null blip Id') , new WaveRef_0(waveId, waveletId, documentId);
  }
}

function $encode(ref, escaperType){
  var result;
  result = new StringBuilder_2($encode_0(ref.waveId.domain, escaperType));
  $append_8((result.impl.string += '/' , result), $encode_0(ref.waveId.id_0, escaperType));
  if (ref.waveletId) {
    $equals_3(ref.waveletId.domain, ref.waveId.domain)?(result.impl.string += '/~' , result):$append_8((result.impl.string += '/' , result), $encode_0(ref.waveletId.domain, escaperType));
    $append_8((result.impl.string += '/' , result), $encode_0(ref.waveletId.id_0, escaperType));
  }
  ref.documentId != null && $append_8((result.impl.string += '/' , result), $encode_0(ref.documentId, escaperType));
  return result.impl.string;
}

function $encode_0(str, escaperType){
  return escaperType == ($clinit_1500() , PATH)?$escape(($clinit_1501() , pathEscaper), str):$escape(($clinit_1501() , queryEscaper), str);
}

function $clinit_1500(){
  $clinit_1500 = nullMethod;
  PATH = new WaverefEncoder$EscaperType_0('PATH', 0);
  QUERY = new WaverefEncoder$EscaperType_0('QUERY', 1);
  $VALUES_58 = initValues(_3Lorg_waveprotocol_wave_model_waveref_WaverefEncoder$EscaperType_2_classLit, {58:1, 138:1}, 129, [PATH, QUERY]);
}

function WaverefEncoder$EscaperType_0(enum$name, enum$ordinal){
  this.name_0 = enum$name;
  this.ordinal = enum$ordinal;
}

function values_59(){
  $clinit_1500();
  return $VALUES_58;
}

function WaverefEncoder$EscaperType(){
}

_ = WaverefEncoder$EscaperType_0.prototype = WaverefEncoder$EscaperType.prototype = new Enum;
_.getClass$ = function getClass_1006(){
  return Lorg_waveprotocol_wave_model_waveref_WaverefEncoder$EscaperType_2_classLit;
}
;
_.castableTypeMap$ = {58:1, 61:1, 62:1, 129:1};
var $VALUES_58, PATH, QUERY;
function $clinit_1501(){
  $clinit_1501 = nullMethod;
  pathEscaper = new PercentEscaper_0("-_.!~*'()@:$&,;=+");
  queryEscaper = new PercentEscaper_0("-_.!~*'()@:$,;/?:+");
}

var pathEscaper, queryEscaper;
function $escapeSlow(this$static, s, index){
  var charsSkipped, cp, dest, destIndex, destLength, end, endIndex, escaped, nextIndex, sizeNeeded, unescapedChunkStart, copy, copy_0;
  end = s.length;
  dest = initDim(_3C_classLit, {58:1}, -1, 1024, 1);
  destIndex = 0;
  unescapedChunkStart = 0;
  while (index < end) {
    cp = codePointAt_0(s, index, end);
    if (cp < 0) {
      throw new IllegalArgumentException_1('Trailing high surrogate at end of input');
    }
    escaped = $escape_0(this$static, cp);
    nextIndex = index + (cp >= 65536 && cp <= 1114111?2:1);
    if (escaped != null) {
      charsSkipped = index - unescapedChunkStart;
      sizeNeeded = destIndex + charsSkipped + escaped.length;
      if (dest.length < sizeNeeded) {
        destLength = sizeNeeded + (end - index) + 32;
        dest = (copy = initDim(_3C_classLit, {58:1}, -1, destLength, 1) , destIndex > 0 && arraycopy(dest, 0, copy, 0, destIndex) , copy);
      }
      if (charsSkipped > 0) {
        $getChars(s, unescapedChunkStart, index, dest, destIndex);
        destIndex += charsSkipped;
      }
      if (escaped.length > 0) {
        arraycopy(escaped, 0, dest, destIndex, escaped.length);
        destIndex += escaped.length;
      }
      unescapedChunkStart = nextIndex;
    }
    index = $nextEscapeIndex(this$static, s, nextIndex, end);
  }
  charsSkipped = end - unescapedChunkStart;
  if (charsSkipped > 0) {
    endIndex = destIndex + charsSkipped;
    dest.length < endIndex && (dest = (copy_0 = initDim(_3C_classLit, {58:1}, -1, endIndex, 1) , destIndex > 0 && arraycopy(dest, 0, copy_0, 0, destIndex) , copy_0));
    $getChars(s, unescapedChunkStart, end, dest, destIndex);
    destIndex = endIndex;
  }
  return __checkBounds(dest.length, destIndex) , __valueOf(dest, 0, destIndex);
}

function codePointAt_0(seq, index, end){
  var c1, c2;
  if (index < end) {
    c1 = seq.charCodeAt(index++);
    if (c1 < 55296 || c1 > 57343) {
      return c1;
    }
     else if (c1 <= 56319) {
      if (index == end) {
        return -c1;
      }
      c2 = seq.charCodeAt(index);
      if (c2 >= 56320 && c2 <= 57343) {
        return 65536 + ((c1 & 1023) << 10) + (c2 & 1023);
      }
      throw new IllegalArgumentException_1("Expected low surrogate but got char '" + String.fromCharCode(c2) + "' with value " + c2 + ' at index ' + index);
    }
     else {
      throw new IllegalArgumentException_1("Unexpected low surrogate character '" + String.fromCharCode(c1) + "' with value " + c1 + ' at index ' + (index - 1));
    }
  }
  throw new IndexOutOfBoundsException_1('Index exceeds specified range');
}

function UnicodeEscaper(){
}

_ = UnicodeEscaper.prototype = new Object_0;
_.getClass$ = function getClass_1007(){
  return Lorg_waveprotocol_wave_util_escapers_UnicodeEscaper_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_1503(){
  $clinit_1503 = nullMethod;
  URI_ESCAPED_SPACE = initValues(_3C_classLit, {58:1}, -1, [43]);
  UPPER_HEX_DIGITS = $toCharArray('0123456789ABCDEF');
}

function $escape(this$static, s){
  var c, index, slen;
  checkNotNull(s);
  slen = s.length;
  for (index = 0; index < slen; ++index) {
    c = s.charCodeAt(index);
    if (c >= this$static.safeOctets.length || !this$static.safeOctets[c]) {
      return $escapeSlow(this$static, s, index);
    }
  }
  return s;
}

function $escape_0(this$static, cp){
  var dest;
  if (cp < this$static.safeOctets.length && this$static.safeOctets[cp]) {
    return null;
  }
   else if (cp == 32 && this$static.plusForSpace) {
    return URI_ESCAPED_SPACE;
  }
   else if (cp <= 127) {
    dest = initDim(_3C_classLit, {58:1}, -1, 3, 1);
    dest[0] = 37;
    dest[2] = UPPER_HEX_DIGITS[cp & 15];
    dest[1] = UPPER_HEX_DIGITS[~~cp >>> 4];
    return dest;
  }
   else if (cp <= 2047) {
    dest = initDim(_3C_classLit, {58:1}, -1, 6, 1);
    dest[0] = 37;
    dest[3] = 37;
    dest[5] = UPPER_HEX_DIGITS[cp & 15];
    cp >>>= 4;
    dest[4] = UPPER_HEX_DIGITS[8 | cp & 3];
    cp >>>= 2;
    dest[2] = UPPER_HEX_DIGITS[cp & 15];
    cp >>>= 4;
    dest[1] = UPPER_HEX_DIGITS[12 | cp];
    return dest;
  }
   else if (cp <= 65535) {
    dest = initDim(_3C_classLit, {58:1}, -1, 9, 1);
    dest[0] = 37;
    dest[1] = 69;
    dest[3] = 37;
    dest[6] = 37;
    dest[8] = UPPER_HEX_DIGITS[cp & 15];
    cp >>>= 4;
    dest[7] = UPPER_HEX_DIGITS[8 | cp & 3];
    cp >>>= 2;
    dest[5] = UPPER_HEX_DIGITS[cp & 15];
    cp >>>= 4;
    dest[4] = UPPER_HEX_DIGITS[8 | cp & 3];
    cp >>>= 2;
    dest[2] = UPPER_HEX_DIGITS[cp];
    return dest;
  }
   else if (cp <= 1114111) {
    dest = initDim(_3C_classLit, {58:1}, -1, 12, 1);
    dest[0] = 37;
    dest[1] = 70;
    dest[3] = 37;
    dest[6] = 37;
    dest[9] = 37;
    dest[11] = UPPER_HEX_DIGITS[cp & 15];
    cp >>>= 4;
    dest[10] = UPPER_HEX_DIGITS[8 | cp & 3];
    cp >>>= 2;
    dest[8] = UPPER_HEX_DIGITS[cp & 15];
    cp >>>= 4;
    dest[7] = UPPER_HEX_DIGITS[8 | cp & 3];
    cp >>>= 2;
    dest[5] = UPPER_HEX_DIGITS[cp & 15];
    cp >>>= 4;
    dest[4] = UPPER_HEX_DIGITS[8 | cp & 3];
    cp >>>= 2;
    dest[2] = UPPER_HEX_DIGITS[cp & 7];
    return dest;
  }
   else {
    throw new IllegalArgumentException_1('Invalid unicode character value ' + cp);
  }
}

function $nextEscapeIndex(this$static, csq, index, end){
  var c;
  for (; index < end; ++index) {
    c = csq.charCodeAt(index);
    if (c >= this$static.safeOctets.length || !this$static.safeOctets[c]) {
      break;
    }
  }
  return index;
}

function PercentEscaper_0(safeChars){
  var matchObj;
  $clinit_1503();
  checkNotNull(safeChars);
  if (matchObj = (new RegExp('.*[0-9A-Za-z].*')).exec(safeChars) , matchObj == null?false:safeChars == matchObj[0]) {
    throw new IllegalArgumentException_1("Alphanumeric characters are always 'safe' and should not be explicitly specified");
  }
  if (safeChars.indexOf('%') != -1) {
    throw new IllegalArgumentException_1("The '%' character cannot be specified as 'safe'");
  }
  this.plusForSpace = false;
  this.safeOctets = createSafeOctets(safeChars);
}

function createSafeOctets(safeChars){
  var c, c$index, c$max, maxChar, octets, safeCharArray;
  maxChar = 122;
  safeCharArray = $toCharArray(safeChars);
  for (c$index = 0 , c$max = safeCharArray.length; c$index < c$max; ++c$index) {
    c = safeCharArray[c$index];
    maxChar = c > maxChar?c:maxChar;
  }
  octets = initDim(_3Z_classLit, {58:1}, -1, maxChar + 1, 2);
  for (c = 48; c <= 57; ++c) {
    octets[c] = true;
  }
  for (c = 65; c <= 90; ++c) {
    octets[c] = true;
  }
  for (c = 97; c <= 122; ++c) {
    octets[c] = true;
  }
  for (c$index = 0 , c$max = safeCharArray.length; c$index < c$max; ++c$index) {
    c = safeCharArray[c$index];
    octets[c] = true;
  }
  return octets;
}

function PercentEscaper(){
}

_ = PercentEscaper_0.prototype = PercentEscaper.prototype = new UnicodeEscaper;
_.getClass$ = function getClass_1008(){
  return Lorg_waveprotocol_wave_util_escapers_PercentEscaper_2_classLit;
}
;
_.castableTypeMap$ = {};
_.plusForSpace = false;
_.safeOctets = null;
var UPPER_HEX_DIGITS, URI_ESCAPED_SPACE;
var $entry = entry_0;
function gwtOnLoad(errFn, modName, modBase, softPermutationId){
  $moduleName = modName;
  $moduleBase = modBase;
  if (errFn)
    try {
      $entry(init)();
    }
     catch (e) {
      errFn(modName);
    }
   else {
    $entry(init)();
  }
}

--></script>
<script><!--
var Ljava_lang_Object_2_classLit = createForClass('java.lang.', 'Object'), _3Ljava_lang_Object_2_classLit = createForArray('[Ljava.lang.', 'Object;', Ljava_lang_Object_2_classLit), Lcom_google_gwt_animation_client_Animation_2_classLit = createForClass('com.google.gwt.animation.client.', 'Animation'), _3Lcom_google_gwt_animation_client_Animation_2_classLit = createForArray('[Lcom.google.gwt.animation.client.', 'Animation;', Lcom_google_gwt_animation_client_Animation_2_classLit), Lcom_google_gwt_user_client_Timer_2_classLit = createForClass('com.google.gwt.user.client.', 'Timer'), Lcom_google_gwt_animation_client_Animation$1_2_classLit = createForClass('com.google.gwt.animation.client.', 'Animation$1'), I_classLit = createForPrimitive('int'), _3I_classLit = createForArray('', '[I', I_classLit), Z_classLit = createForPrimitive('boolean'), _3Z_classLit = createForArray('', '[Z', Z_classLit), Ljava_lang_Throwable_2_classLit = createForClass('java.lang.', 'Throwable'), Ljava_lang_Exception_2_classLit = createForClass('java.lang.', 'Exception'), Ljava_lang_RuntimeException_2_classLit = createForClass('java.lang.', 'RuntimeException'), Lcom_google_gwt_core_client_Scheduler_2_classLit = createForClass('com.google.gwt.core.client.', 'Scheduler'), Lcom_google_gwt_core_client_impl_SchedulerImpl_2_classLit = createForClass('com.google.gwt.core.client.impl.', 'SchedulerImpl'), Lcom_google_gwt_core_client_impl_StackTraceCreator$Collector_2_classLit = createForClass('com.google.gwt.core.client.impl.', 'StackTraceCreator$Collector'), Ljava_lang_StackTraceElement_2_classLit = createForClass('java.lang.', 'StackTraceElement'), _3Ljava_lang_StackTraceElement_2_classLit = createForArray('[Ljava.lang.', 'StackTraceElement;', Ljava_lang_StackTraceElement_2_classLit), Lcom_google_gwt_core_client_impl_StackTraceCreator$CollectorMoz_2_classLit = createForClass('com.google.gwt.core.client.impl.', 'StackTraceCreator$CollectorMoz'), Lcom_google_gwt_core_client_impl_StackTraceCreator$CollectorChrome_2_classLit = createForClass('com.google.gwt.core.client.impl.', 'StackTraceCreator$CollectorChrome'), Lcom_google_gwt_core_client_impl_StringBufferImpl_2_classLit = createForClass('com.google.gwt.core.client.impl.', 'StringBufferImpl'), Lcom_google_gwt_core_client_impl_StringBufferImplAppend_2_classLit = createForClass('com.google.gwt.core.client.impl.', 'StringBufferImplAppend'), Lcom_google_gwt_core_client_JavaScriptException_2_classLit = createForClass('com.google.gwt.core.client.', 'JavaScriptException'), Lcom_google_gwt_core_client_JavaScriptObject_2_classLit = createForClass('com.google.gwt.core.client.', 'JavaScriptObject$'), Ljava_lang_String_2_classLit = createForClass('java.lang.', 'String'), _3Ljava_lang_String_2_classLit = createForArray('[Ljava.lang.', 'String;', Ljava_lang_String_2_classLit), Ljava_lang_Enum_2_classLit = createForClass('java.lang.', 'Enum'), Lcom_google_gwt_dom_client_Style$Unit_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Unit', values_5), _3Lcom_google_gwt_dom_client_Style$Unit_2_classLit = createForArray('[Lcom.google.gwt.dom.client.', 'Style$Unit;', Lcom_google_gwt_dom_client_Style$Unit_2_classLit), Lcom_google_gwt_dom_client_Style$Unit$1_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Unit$1', null), Lcom_google_gwt_dom_client_Style$Unit$2_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Unit$2', null), Lcom_google_gwt_dom_client_Style$Unit$3_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Unit$3', null), Lcom_google_gwt_dom_client_Style$Unit$4_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Unit$4', null), Lcom_google_gwt_dom_client_Style$Unit$5_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Unit$5', null), Lcom_google_gwt_dom_client_Style$Unit$6_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Unit$6', null), Lcom_google_gwt_dom_client_Style$Unit$7_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Unit$7', null), Lcom_google_gwt_dom_client_Style$Unit$8_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Unit$8', null), Lcom_google_gwt_dom_client_Style$Unit$9_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Unit$9', null), Lcom_google_gwt_dom_client_Style$BorderStyle_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$BorderStyle', values_0), _3Lcom_google_gwt_dom_client_Style$BorderStyle_2_classLit = createForArray('[Lcom.google.gwt.dom.client.', 'Style$BorderStyle;', Lcom_google_gwt_dom_client_Style$BorderStyle_2_classLit), Lcom_google_gwt_dom_client_Style$BorderStyle$1_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$BorderStyle$1', null), Lcom_google_gwt_dom_client_Style$BorderStyle$2_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$BorderStyle$2', null), Lcom_google_gwt_dom_client_Style$BorderStyle$3_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$BorderStyle$3', null), Lcom_google_gwt_dom_client_Style$BorderStyle$4_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$BorderStyle$4', null), Lcom_google_gwt_dom_client_Style$BorderStyle$5_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$BorderStyle$5', null), Lcom_google_gwt_dom_client_Style$Display_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Display', values_1), _3Lcom_google_gwt_dom_client_Style$Display_2_classLit = createForArray('[Lcom.google.gwt.dom.client.', 'Style$Display;', Lcom_google_gwt_dom_client_Style$Display_2_classLit), Lcom_google_gwt_dom_client_Style$Display$1_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Display$1', null), Lcom_google_gwt_dom_client_Style$Display$2_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Display$2', null), Lcom_google_gwt_dom_client_Style$Display$3_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Display$3', null), Lcom_google_gwt_dom_client_Style$Display$4_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Display$4', null), Lcom_google_gwt_dom_client_Style$FontWeight_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$FontWeight', values_2), _3Lcom_google_gwt_dom_client_Style$FontWeight_2_classLit = createForArray('[Lcom.google.gwt.dom.client.', 'Style$FontWeight;', Lcom_google_gwt_dom_client_Style$FontWeight_2_classLit), Lcom_google_gwt_dom_client_Style$FontWeight$1_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$FontWeight$1', null), Lcom_google_gwt_dom_client_Style$FontWeight$2_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$FontWeight$2', null), Lcom_google_gwt_dom_client_Style$FontWeight$3_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$FontWeight$3', null), Lcom_google_gwt_dom_client_Style$FontWeight$4_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$FontWeight$4', null), Lcom_google_gwt_dom_client_Style$Overflow_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Overflow', values_3), _3Lcom_google_gwt_dom_client_Style$Overflow_2_classLit = createForArray('[Lcom.google.gwt.dom.client.', 'Style$Overflow;', Lcom_google_gwt_dom_client_Style$Overflow_2_classLit), Lcom_google_gwt_dom_client_Style$Overflow$1_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Overflow$1', null), Lcom_google_gwt_dom_client_Style$Overflow$2_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Overflow$2', null), Lcom_google_gwt_dom_client_Style$Overflow$3_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Overflow$3', null), Lcom_google_gwt_dom_client_Style$Overflow$4_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Overflow$4', null), Lcom_google_gwt_dom_client_Style$Position_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Position', values_4), _3Lcom_google_gwt_dom_client_Style$Position_2_classLit = createForArray('[Lcom.google.gwt.dom.client.', 'Style$Position;', Lcom_google_gwt_dom_client_Style$Position_2_classLit), Lcom_google_gwt_dom_client_Style$Position$1_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Position$1', null), Lcom_google_gwt_dom_client_Style$Position$2_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Position$2', null), Lcom_google_gwt_dom_client_Style$Position$3_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Position$3', null), Lcom_google_gwt_dom_client_Style$Position$4_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Position$4', null), Lcom_google_gwt_dom_client_Style$Visibility_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Visibility', values_6), _3Lcom_google_gwt_dom_client_Style$Visibility_2_classLit = createForArray('[Lcom.google.gwt.dom.client.', 'Style$Visibility;', Lcom_google_gwt_dom_client_Style$Visibility_2_classLit), Lcom_google_gwt_dom_client_Style$Visibility$1_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Visibility$1', null), Lcom_google_gwt_dom_client_Style$Visibility$2_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Visibility$2', null), Lcom_google_gwt_dom_client_StyleInjector$StyleInjectorImpl_2_classLit = createForClass('com.google.gwt.dom.client.', 'StyleInjector$StyleInjectorImpl'), Lcom_google_gwt_dom_client_StyleInjector$1_2_classLit = createForClass('com.google.gwt.dom.client.', 'StyleInjector$1'), Lcom_google_gwt_event_shared_GwtEvent_2_classLit = createForClass('com.google.gwt.event.shared.', 'GwtEvent'), Lcom_google_gwt_event_dom_client_DomEvent_2_classLit = createForClass('com.google.gwt.event.dom.client.', 'DomEvent'), Lcom_google_gwt_event_dom_client_BlurEvent_2_classLit = createForClass('com.google.gwt.event.dom.client.', 'BlurEvent'), Lcom_google_gwt_event_dom_client_ChangeEvent_2_classLit = createForClass('com.google.gwt.event.dom.client.', 'ChangeEvent'), Lcom_google_gwt_event_dom_client_MouseEvent_2_classLit = createForClass('com.google.gwt.event.dom.client.', 'MouseEvent'), Lcom_google_gwt_event_dom_client_ClickEvent_2_classLit = createForClass('com.google.gwt.event.dom.client.', 'ClickEvent'), Lcom_google_gwt_event_shared_GwtEvent$Type_2_classLit = createForClass('com.google.gwt.event.shared.', 'GwtEvent$Type'), Lcom_google_gwt_event_dom_client_DomEvent$Type_2_classLit = createForClass('com.google.gwt.event.dom.client.', 'DomEvent$Type'), Lcom_google_gwt_event_dom_client_ErrorEvent_2_classLit = createForClass('com.google.gwt.event.dom.client.', 'ErrorEvent'), Lcom_google_gwt_event_dom_client_HandlesAllKeyEvents_2_classLit = createForClass('com.google.gwt.event.dom.client.', 'HandlesAllKeyEvents'), Lcom_google_gwt_event_dom_client_KeyEvent_2_classLit = createForClass('com.google.gwt.event.dom.client.', 'KeyEvent'), Lcom_google_gwt_event_dom_client_KeyCodeEvent_2_classLit = createForClass('com.google.gwt.event.dom.client.', 'KeyCodeEvent'), Lcom_google_gwt_event_dom_client_KeyDownEvent_2_classLit = createForClass('com.google.gwt.event.dom.client.', 'KeyDownEvent'), Lcom_google_gwt_event_dom_client_KeyPressEvent_2_classLit = createForClass('com.google.gwt.event.dom.client.', 'KeyPressEvent'), Lcom_google_gwt_event_dom_client_KeyUpEvent_2_classLit = createForClass('com.google.gwt.event.dom.client.', 'KeyUpEvent'), Lcom_google_gwt_event_dom_client_LoadEvent_2_classLit = createForClass('com.google.gwt.event.dom.client.', 'LoadEvent'), Lcom_google_gwt_event_dom_client_MouseDownEvent_2_classLit = createForClass('com.google.gwt.event.dom.client.', 'MouseDownEvent'), Lcom_google_gwt_event_dom_client_MouseOutEvent_2_classLit = createForClass('com.google.gwt.event.dom.client.', 'MouseOutEvent'), Lcom_google_gwt_event_dom_client_MouseOverEvent_2_classLit = createForClass('com.google.gwt.event.dom.client.', 'MouseOverEvent'), Lcom_google_gwt_event_dom_client_MouseUpEvent_2_classLit = createForClass('com.google.gwt.event.dom.client.', 'MouseUpEvent'), Lcom_google_gwt_event_dom_client_PrivateMap_2_classLit = createForClass('com.google.gwt.event.dom.client.', 'PrivateMap'), Lcom_google_gwt_event_logical_shared_CloseEvent_2_classLit = createForClass('com.google.gwt.event.logical.shared.', 'CloseEvent'), Lcom_google_gwt_event_logical_shared_ResizeEvent_2_classLit = createForClass('com.google.gwt.event.logical.shared.', 'ResizeEvent'), Lcom_google_gwt_event_logical_shared_SelectionEvent_2_classLit = createForClass('com.google.gwt.event.logical.shared.', 'SelectionEvent'), Lcom_google_gwt_event_logical_shared_ValueChangeEvent_2_classLit = createForClass('com.google.gwt.event.logical.shared.', 'ValueChangeEvent'), Lcom_google_gwt_event_shared_EventBus_2_classLit = createForClass('com.google.gwt.event.shared.', 'EventBus'), Lcom_google_gwt_event_shared_HandlerManager_2_classLit = createForClass('com.google.gwt.event.shared.', 'HandlerManager'), Lcom_google_gwt_event_shared_SimpleEventBus_2_classLit = createForClass('com.google.gwt.event.shared.', 'SimpleEventBus'), Lcom_google_gwt_event_shared_SimpleEventBus$1_2_classLit = createForClass('com.google.gwt.event.shared.', 'SimpleEventBus$1'), Lcom_google_gwt_event_shared_SimpleEventBus$2_2_classLit = createForClass('com.google.gwt.event.shared.', 'SimpleEventBus$2'), Lcom_google_gwt_event_shared_SimpleEventBus$3_2_classLit = createForClass('com.google.gwt.event.shared.', 'SimpleEventBus$3'), _3Ljava_lang_Throwable_2_classLit = createForArray('[Ljava.lang.', 'Throwable;', Ljava_lang_Throwable_2_classLit), Lcom_google_gwt_event_shared_UmbrellaException_2_classLit = createForClass('com.google.gwt.event.shared.', 'UmbrellaException'), Lcom_google_gwt_i18n_client_constants_NumberConstantsImpl_1en_2_classLit = createForClass('com.google.gwt.i18n.client.constants.', 'NumberConstantsImpl_en'), Lcom_google_gwt_i18n_client_AutoDirectionHandler_2_classLit = createForClass('com.google.gwt.i18n.client.', 'AutoDirectionHandler'), Lcom_google_gwt_i18n_client_HasDirection$Direction_2_classLit = createForEnum('com.google.gwt.i18n.client.', 'HasDirection$Direction', values_7), _3Lcom_google_gwt_i18n_client_HasDirection$Direction_2_classLit = createForArray('[Lcom.google.gwt.i18n.client.', 'HasDirection$Direction;', Lcom_google_gwt_i18n_client_HasDirection$Direction_2_classLit), Lcom_google_gwt_i18n_client_LocaleInfo_2_classLit = createForClass('com.google.gwt.i18n.client.', 'LocaleInfo'), Lcom_google_gwt_i18n_client_NumberFormat_2_classLit = createForClass('com.google.gwt.i18n.client.', 'NumberFormat'), Lcom_google_gwt_lang_LongLibBase$LongEmul_2_classLit = createForClass('com.google.gwt.lang.', 'LongLibBase$LongEmul'), _3Lcom_google_gwt_lang_LongLibBase$LongEmul_2_classLit = createForArray('[Lcom.google.gwt.lang.', 'LongLibBase$LongEmul;', Lcom_google_gwt_lang_LongLibBase$LongEmul_2_classLit), Lcom_google_gwt_resources_client_impl_ImageResourcePrototype_2_classLit = createForClass('com.google.gwt.resources.client.impl.', 'ImageResourcePrototype'), Lcom_google_gwt_safehtml_shared_SafeHtmlBuilder_2_classLit = createForClass('com.google.gwt.safehtml.shared.', 'SafeHtmlBuilder'), Lcom_google_gwt_safehtml_shared_SafeHtmlString_2_classLit = createForClass('com.google.gwt.safehtml.shared.', 'SafeHtmlString'), Lcom_google_gwt_text_shared_testing_PassthroughParser_2_classLit = createForClass('com.google.gwt.text.shared.testing.', 'PassthroughParser'), Lcom_google_gwt_text_shared_AbstractRenderer_2_classLit = createForClass('com.google.gwt.text.shared.', 'AbstractRenderer'), Lcom_google_gwt_text_shared_testing_PassthroughRenderer_2_classLit = createForClass('com.google.gwt.text.shared.testing.', 'PassthroughRenderer'), Lcom_google_gwt_uibinder_client_UiBinderUtil$TempAttachment_2_classLit = createForClass('com.google.gwt.uibinder.client.', 'UiBinderUtil$TempAttachment'), Lcom_google_gwt_user_client_impl_HistoryImpl_2_classLit = createForClass('com.google.gwt.user.client.impl.', 'HistoryImpl'), Lcom_google_gwt_user_client_impl_HistoryImplTimer_2_classLit = createForClass('com.google.gwt.user.client.impl.', 'HistoryImplTimer'), Lcom_google_gwt_user_client_impl_HistoryImplSafari_2_classLit = createForClass('com.google.gwt.user.client.impl.', 'HistoryImplSafari'), Lcom_google_gwt_user_client_ui_AbstractImagePrototype_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'AbstractImagePrototype'), Lcom_google_gwt_user_client_ui_impl_ClippedImagePrototype_2_classLit = createForClass('com.google.gwt.user.client.ui.impl.', 'ClippedImagePrototype'), Lcom_google_gwt_user_client_ui_impl_FocusImpl_2_classLit = createForClass('com.google.gwt.user.client.ui.impl.', 'FocusImpl'), Lcom_google_gwt_user_client_ui_impl_FocusImplStandard_2_classLit = createForClass('com.google.gwt.user.client.ui.impl.', 'FocusImplStandard'), Lcom_google_gwt_user_client_ui_impl_FocusImplSafari_2_classLit = createForClass('com.google.gwt.user.client.ui.impl.', 'FocusImplSafari'), Lcom_google_gwt_user_client_ui_UIObject_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'UIObject'), Lcom_google_gwt_user_client_ui_Widget_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'Widget'), Lcom_google_gwt_user_client_ui_Panel_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'Panel'), Lcom_google_gwt_user_client_ui_ComplexPanel_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'ComplexPanel'), Lcom_google_gwt_user_client_ui_AbsolutePanel_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'AbsolutePanel'), Lcom_google_gwt_user_client_ui_AttachDetachException_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'AttachDetachException'), Lcom_google_gwt_user_client_ui_AttachDetachException$1_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'AttachDetachException$1'), Lcom_google_gwt_user_client_ui_AttachDetachException$2_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'AttachDetachException$2'), Lcom_google_gwt_user_client_ui_FocusWidget_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'FocusWidget'), Lcom_google_gwt_user_client_ui_ButtonBase_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'ButtonBase'), Lcom_google_gwt_user_client_ui_Button_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'Button'), Lcom_google_gwt_user_client_ui_CellPanel_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'CellPanel'), Lcom_google_gwt_user_client_ui_CheckBox_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'CheckBox'), Lcom_google_gwt_user_client_ui_CheckBox$1_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'CheckBox$1'), Lcom_google_gwt_user_client_ui_Composite_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'Composite'), Lcom_google_gwt_user_client_ui_SimplePanel_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'SimplePanel'), Lcom_google_gwt_user_client_ui_PopupPanel_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'PopupPanel'), Lcom_google_gwt_user_client_ui_DecoratedPopupPanel_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'DecoratedPopupPanel'), Lcom_google_gwt_user_client_ui_DecoratorPanel_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'DecoratorPanel'), Lcom_google_gwt_user_client_ui_DirectionalTextHelper_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'DirectionalTextHelper'), _3Lcom_google_gwt_user_client_ui_Widget_2_classLit = createForArray('[Lcom.google.gwt.user.client.ui.', 'Widget;', Lcom_google_gwt_user_client_ui_Widget_2_classLit), Lcom_google_gwt_user_client_ui_FlowPanel_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'FlowPanel'), Lcom_google_gwt_user_client_ui_LabelBase_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'LabelBase'), Lcom_google_gwt_user_client_ui_Label_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'Label'), Lcom_google_gwt_user_client_ui_HTML_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'HTML'), Lcom_google_gwt_user_client_ui_HTMLPanel_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'HTMLPanel'), Lcom_google_gwt_user_client_ui_HasHorizontalAlignment$AutoHorizontalAlignmentConstant_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'HasHorizontalAlignment$AutoHorizontalAlignmentConstant'), Lcom_google_gwt_user_client_ui_HasHorizontalAlignment$HorizontalAlignmentConstant_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'HasHorizontalAlignment$HorizontalAlignmentConstant'), Lcom_google_gwt_user_client_ui_HasVerticalAlignment$VerticalAlignmentConstant_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'HasVerticalAlignment$VerticalAlignmentConstant'), Lcom_google_gwt_user_client_ui_HorizontalPanel_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'HorizontalPanel'), Lcom_google_gwt_user_client_ui_Image_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'Image'), Lcom_google_gwt_user_client_ui_Image$State_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'Image$State'), Lcom_google_gwt_user_client_ui_Image$State$1_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'Image$State$1'), Lcom_google_gwt_user_client_ui_Image$UnclippedState_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'Image$UnclippedState'), Lcom_google_gwt_user_client_ui_InlineLabel_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'InlineLabel'), Ljava_util_AbstractCollection_2_classLit = createForClass('java.util.', 'AbstractCollection'), Ljava_util_AbstractList_2_classLit = createForClass('java.util.', 'AbstractList'), Ljava_util_ArrayList_2_classLit = createForClass('java.util.', 'ArrayList'), Lcom_google_gwt_user_client_ui_ListBox_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'ListBox'), Lcom_google_gwt_user_client_BaseListenerWrapper_2_classLit = createForClass('com.google.gwt.user.client.', 'BaseListenerWrapper'), Lcom_google_gwt_user_client_ui_ListenerWrapper_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'ListenerWrapper'), Lcom_google_gwt_user_client_ui_ListenerWrapper$WrappedPopupListener_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'ListenerWrapper$WrappedPopupListener'), Lcom_google_gwt_user_client_ui_MenuBar_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'MenuBar'), Lcom_google_gwt_user_client_ui_MenuBar$1_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'MenuBar$1'), Lcom_google_gwt_user_client_ui_MenuBar$2_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'MenuBar$2'), Lcom_google_gwt_user_client_ui_MenuBar$3_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'MenuBar$3'), Lcom_google_gwt_user_client_ui_MenuBar$4_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'MenuBar$4'), Lcom_google_gwt_user_client_ui_MenuItem_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'MenuItem'), C_classLit = createForPrimitive('char'), _3C_classLit = createForArray('', '[C', C_classLit), Lcom_google_gwt_user_client_ui_SuggestOracle_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'SuggestOracle'), Lcom_google_gwt_user_client_ui_MultiWordSuggestOracle_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'MultiWordSuggestOracle'), Lcom_google_gwt_user_client_ui_MultiWordSuggestOracle$MultiWordSuggestion_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'MultiWordSuggestOracle$MultiWordSuggestion'), Lcom_google_gwt_user_client_ui_MultiWordSuggestOracle$WordBounds_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'MultiWordSuggestOracle$WordBounds'), Lcom_google_gwt_user_client_ui_PopupPanel$AnimationType_2_classLit = createForEnum('com.google.gwt.user.client.ui.', 'PopupPanel$AnimationType', values_8), _3Lcom_google_gwt_user_client_ui_PopupPanel$AnimationType_2_classLit = createForArray('[Lcom.google.gwt.user.client.ui.', 'PopupPanel$AnimationType;', Lcom_google_gwt_user_client_ui_PopupPanel$AnimationType_2_classLit), Lcom_google_gwt_user_client_ui_PopupPanel$ResizeAnimation_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'PopupPanel$ResizeAnimation'), Lcom_google_gwt_user_client_ui_PopupPanel$ResizeAnimation$1_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'PopupPanel$ResizeAnimation$1'), Lcom_google_gwt_user_client_ui_PopupPanel$1_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'PopupPanel$1'), Lcom_google_gwt_user_client_ui_PopupPanel$2_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'PopupPanel$2'), Lcom_google_gwt_user_client_ui_PopupPanel$3_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'PopupPanel$3'), Lcom_google_gwt_user_client_ui_PopupPanel$4_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'PopupPanel$4'), Lcom_google_gwt_user_client_ui_PrefixTree_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'PrefixTree'), Lcom_google_gwt_user_client_ui_PrefixTree$PrefixTreeIterator_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'PrefixTree$PrefixTreeIterator'), Lcom_google_gwt_user_client_ui_RadioButton_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'RadioButton'), Lcom_google_gwt_user_client_ui_RootPanel_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'RootPanel'), Lcom_google_gwt_user_client_ui_RootPanel$DefaultRootPanel_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'RootPanel$DefaultRootPanel'), Lcom_google_gwt_user_client_ui_RootPanel$1_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'RootPanel$1'), Lcom_google_gwt_user_client_ui_RootPanel$2_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'RootPanel$2'), Lcom_google_gwt_user_client_ui_SimplePanel$1_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'SimplePanel$1'), Lcom_google_gwt_user_client_ui_SuggestBox_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'SuggestBox'), Lcom_google_gwt_user_client_ui_SuggestBox$SuggestionDisplay_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'SuggestBox$SuggestionDisplay'), Lcom_google_gwt_user_client_ui_SuggestBox$DefaultSuggestionDisplay_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'SuggestBox$DefaultSuggestionDisplay'), Lcom_google_gwt_user_client_ui_SuggestBox$DefaultSuggestionDisplay$1_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'SuggestBox$DefaultSuggestionDisplay$1'), Lcom_google_gwt_user_client_ui_SuggestBox$SuggestionMenu_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'SuggestBox$SuggestionMenu'), Lcom_google_gwt_user_client_ui_SuggestBox$SuggestionMenuItem_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'SuggestBox$SuggestionMenuItem'), Lcom_google_gwt_user_client_ui_SuggestBox$1_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'SuggestBox$1'), Lcom_google_gwt_user_client_ui_SuggestBox$2_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'SuggestBox$2'), Lcom_google_gwt_user_client_ui_SuggestBox$1TextBoxEvents_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'SuggestBox$1TextBoxEvents'), Lcom_google_gwt_user_client_ui_SuggestOracle$Request_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'SuggestOracle$Request'), Lcom_google_gwt_user_client_ui_SuggestOracle$Response_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'SuggestOracle$Response'), Lcom_google_gwt_user_client_ui_ValueBoxBase_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'ValueBoxBase'), Lcom_google_gwt_user_client_ui_TextBoxBase_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'TextBoxBase'), Lcom_google_gwt_user_client_ui_TextArea_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'TextArea'), Lcom_google_gwt_user_client_ui_TextBox_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'TextBox'), Lcom_google_gwt_user_client_ui_ValueBoxBase$TextAlignment_2_classLit = createForEnum('com.google.gwt.user.client.ui.', 'ValueBoxBase$TextAlignment', values_9), _3Lcom_google_gwt_user_client_ui_ValueBoxBase$TextAlignment_2_classLit = createForArray('[Lcom.google.gwt.user.client.ui.', 'ValueBoxBase$TextAlignment;', Lcom_google_gwt_user_client_ui_ValueBoxBase$TextAlignment_2_classLit), Lcom_google_gwt_user_client_ui_ValueBoxBase$TextAlignment$1_2_classLit = createForEnum('com.google.gwt.user.client.ui.', 'ValueBoxBase$TextAlignment$1', null), Lcom_google_gwt_user_client_ui_ValueBoxBase$TextAlignment$2_2_classLit = createForEnum('com.google.gwt.user.client.ui.', 'ValueBoxBase$TextAlignment$2', null), Lcom_google_gwt_user_client_ui_ValueBoxBase$TextAlignment$3_2_classLit = createForEnum('com.google.gwt.user.client.ui.', 'ValueBoxBase$TextAlignment$3', null), Lcom_google_gwt_user_client_ui_ValueBoxBase$TextAlignment$4_2_classLit = createForEnum('com.google.gwt.user.client.ui.', 'ValueBoxBase$TextAlignment$4', null), Lcom_google_gwt_user_client_ui_ValueBoxBase$1_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'ValueBoxBase$1'), Lcom_google_gwt_user_client_ui_VerticalPanel_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'VerticalPanel'), Lcom_google_gwt_user_client_ui_WidgetCollection_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'WidgetCollection'), Lcom_google_gwt_user_client_ui_WidgetCollection$WidgetIterator_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'WidgetCollection$WidgetIterator'), Lcom_google_gwt_user_client_CommandCanceledException_2_classLit = createForClass('com.google.gwt.user.client.', 'CommandCanceledException'), Lcom_google_gwt_user_client_CommandExecutor_2_classLit = createForClass('com.google.gwt.user.client.', 'CommandExecutor'), Lcom_google_gwt_user_client_CommandExecutor$CircularIterator_2_classLit = createForClass('com.google.gwt.user.client.', 'CommandExecutor$CircularIterator'), Lcom_google_gwt_user_client_CommandExecutor$1_2_classLit = createForClass('com.google.gwt.user.client.', 'CommandExecutor$1'), Lcom_google_gwt_user_client_CommandExecutor$2_2_classLit = createForClass('com.google.gwt.user.client.', 'CommandExecutor$2'), Lcom_google_gwt_user_client_Event$NativePreviewEvent_2_classLit = createForClass('com.google.gwt.user.client.', 'Event$NativePreviewEvent'), Lcom_google_gwt_user_client_Timer$1_2_classLit = createForClass('com.google.gwt.user.client.', 'Timer$1'), Lcom_google_gwt_user_client_Window$ClosingEvent_2_classLit = createForClass('com.google.gwt.user.client.', 'Window$ClosingEvent'), Lcom_google_gwt_user_client_Window$WindowHandlers_2_classLit = createForClass('com.google.gwt.user.client.', 'Window$WindowHandlers'), Ljava_lang_IndexOutOfBoundsException_2_classLit = createForClass('java.lang.', 'IndexOutOfBoundsException'), Ljava_lang_ArrayStoreException_2_classLit = createForClass('java.lang.', 'ArrayStoreException'), Ljava_lang_Error_2_classLit = createForClass('java.lang.', 'Error'), Ljava_lang_AssertionError_2_classLit = createForClass('java.lang.', 'AssertionError'), Ljava_lang_Boolean_2_classLit = createForClass('java.lang.', 'Boolean'), Ljava_lang_Number_2_classLit = createForClass('java.lang.', 'Number'), Ljava_lang_Character_2_classLit = createForClass('java.lang.', 'Character'), _3Ljava_lang_Character_2_classLit = createForArray('[Ljava.lang.', 'Character;', Ljava_lang_Character_2_classLit), Ljava_lang_Class_2_classLit = createForClass('java.lang.', 'Class'), Ljava_lang_ClassCastException_2_classLit = createForClass('java.lang.', 'ClassCastException'), Ljava_lang_Double_2_classLit = createForClass('java.lang.', 'Double'), Ljava_lang_IllegalArgumentException_2_classLit = createForClass('java.lang.', 'IllegalArgumentException'), Ljava_lang_IllegalStateException_2_classLit = createForClass('java.lang.', 'IllegalStateException'), Ljava_lang_Integer_2_classLit = createForClass('java.lang.', 'Integer'), _3Ljava_lang_Integer_2_classLit = createForArray('[Ljava.lang.', 'Integer;', Ljava_lang_Integer_2_classLit), Ljava_lang_NullPointerException_2_classLit = createForClass('java.lang.', 'NullPointerException'), Ljava_lang_NumberFormatException_2_classLit = createForClass('java.lang.', 'NumberFormatException'), Ljava_lang_StringBuffer_2_classLit = createForClass('java.lang.', 'StringBuffer'), Ljava_lang_StringBuilder_2_classLit = createForClass('java.lang.', 'StringBuilder'), Ljava_lang_StringIndexOutOfBoundsException_2_classLit = createForClass('java.lang.', 'StringIndexOutOfBoundsException'), Ljava_lang_UnsupportedOperationException_2_classLit = createForClass('java.lang.', 'UnsupportedOperationException'), Ljava_util_AbstractMap_2_classLit = createForClass('java.util.', 'AbstractMap'), Ljava_util_AbstractHashMap_2_classLit = createForClass('java.util.', 'AbstractHashMap'), Ljava_util_AbstractSet_2_classLit = createForClass('java.util.', 'AbstractSet'), Ljava_util_AbstractHashMap$EntrySet_2_classLit = createForClass('java.util.', 'AbstractHashMap$EntrySet'), Ljava_util_AbstractHashMap$EntrySetIterator_2_classLit = createForClass('java.util.', 'AbstractHashMap$EntrySetIterator'), Ljava_util_AbstractMapEntry_2_classLit = createForClass('java.util.', 'AbstractMapEntry'), Ljava_util_AbstractHashMap$MapEntryNull_2_classLit = createForClass('java.util.', 'AbstractHashMap$MapEntryNull'), Ljava_util_AbstractHashMap$MapEntryString_2_classLit = createForClass('java.util.', 'AbstractHashMap$MapEntryString'), Ljava_util_AbstractList$IteratorImpl_2_classLit = createForClass('java.util.', 'AbstractList$IteratorImpl'), Ljava_util_AbstractList$ListIteratorImpl_2_classLit = createForClass('java.util.', 'AbstractList$ListIteratorImpl'), Ljava_util_AbstractMap$1_2_classLit = createForClass('java.util.', 'AbstractMap$1'), Ljava_util_AbstractMap$1$1_2_classLit = createForClass('java.util.', 'AbstractMap$1$1'), Ljava_util_AbstractQueue_2_classLit = createForClass('java.util.', 'AbstractQueue'), Ljava_util_AbstractSequentialList_2_classLit = createForClass('java.util.', 'AbstractSequentialList'), Ljava_util_Arrays$ArrayList_2_classLit = createForClass('java.util.', 'Arrays$ArrayList'), Ljava_util_Collections$EmptyList_2_classLit = createForClass('java.util.', 'Collections$EmptyList'), Ljava_util_Collections$EmptySet_2_classLit = createForClass('java.util.', 'Collections$EmptySet'), Ljava_util_Collections$EmptySet$1_2_classLit = createForClass('java.util.', 'Collections$EmptySet$1'), Ljava_util_Collections$EmptyMap_2_classLit = createForClass('java.util.', 'Collections$EmptyMap'), Ljava_util_Collections$SingletonList_2_classLit = createForClass('java.util.', 'Collections$SingletonList'), Ljava_util_Collections$UnmodifiableCollection_2_classLit = createForClass('java.util.', 'Collections$UnmodifiableCollection'), Ljava_util_Collections$UnmodifiableList_2_classLit = createForClass('java.util.', 'Collections$UnmodifiableList'), Ljava_util_Collections$UnmodifiableMap_2_classLit = createForClass('java.util.', 'Collections$UnmodifiableMap'), Ljava_util_Collections$UnmodifiableSet_2_classLit = createForClass('java.util.', 'Collections$UnmodifiableSet'), Ljava_util_Collections$UnmodifiableMap$UnmodifiableEntrySet_2_classLit = createForClass('java.util.', 'Collections$UnmodifiableMap$UnmodifiableEntrySet'), Ljava_util_Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry_2_classLit = createForClass('java.util.', 'Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry'), Ljava_util_Collections$UnmodifiableMap$UnmodifiableEntrySet$1_2_classLit = createForClass('java.util.', 'Collections$UnmodifiableMap$UnmodifiableEntrySet$1'), Ljava_util_Collections$UnmodifiableRandomAccessList_2_classLit = createForClass('java.util.', 'Collections$UnmodifiableRandomAccessList'), Ljava_util_Collections$UnmodifiableCollectionIterator_2_classLit = createForClass('java.util.', 'Collections$UnmodifiableCollectionIterator'), Ljava_util_Collections$UnmodifiableListIterator_2_classLit = createForClass('java.util.', 'Collections$UnmodifiableListIterator'), Ljava_util_Comparators$1_2_classLit = createForClass('java.util.', 'Comparators$1'), Ljava_util_Date_2_classLit = createForClass('java.util.', 'Date'), Ljava_util_EmptyStackException_2_classLit = createForClass('java.util.', 'EmptyStackException'), Ljava_util_HashMap_2_classLit = createForClass('java.util.', 'HashMap'), Ljava_util_HashSet_2_classLit = createForClass('java.util.', 'HashSet'), Ljava_util_IdentityHashMap_2_classLit = createForClass('java.util.', 'IdentityHashMap'), Ljava_util_LinkedHashMap_2_classLit = createForClass('java.util.', 'LinkedHashMap'), Ljava_util_MapEntryImpl_2_classLit = createForClass('java.util.', 'MapEntryImpl'), Ljava_util_LinkedHashMap$ChainEntry_2_classLit = createForClass('java.util.', 'LinkedHashMap$ChainEntry'), Ljava_util_LinkedHashMap$EntrySet_2_classLit = createForClass('java.util.', 'LinkedHashMap$EntrySet'), Ljava_util_LinkedHashMap$EntrySet$EntryIterator_2_classLit = createForClass('java.util.', 'LinkedHashMap$EntrySet$EntryIterator'), Ljava_util_LinkedHashSet_2_classLit = createForClass('java.util.', 'LinkedHashSet'), Ljava_util_LinkedList_2_classLit = createForClass('java.util.', 'LinkedList'), Ljava_util_LinkedList$ListIteratorImpl_2_classLit = createForClass('java.util.', 'LinkedList$ListIteratorImpl'), Ljava_util_LinkedList$Node_2_classLit = createForClass('java.util.', 'LinkedList$Node'), Ljava_util_NoSuchElementException_2_classLit = createForClass('java.util.', 'NoSuchElementException'), Ljava_util_PriorityQueue_2_classLit = createForClass('java.util.', 'PriorityQueue'), Ljava_util_Vector_2_classLit = createForClass('java.util.', 'Vector'), Ljava_util_Stack_2_classLit = createForClass('java.util.', 'Stack'), Ljava_util_TreeMap_2_classLit = createForClass('java.util.', 'TreeMap'), Ljava_util_TreeMap$EntryIterator_2_classLit = createForClass('java.util.', 'TreeMap$EntryIterator'), Ljava_util_TreeMap$EntrySet_2_classLit = createForClass('java.util.', 'TreeMap$EntrySet'), Ljava_util_TreeMap$Node_2_classLit = createForClass('java.util.', 'TreeMap$Node'), _3Ljava_util_TreeMap$Node_2_classLit = createForArray('[Ljava.util.', 'TreeMap$Node;', Ljava_util_TreeMap$Node_2_classLit), Ljava_util_TreeMap$State_2_classLit = createForClass('java.util.', 'TreeMap$State'), Ljava_util_TreeMap$SubMapType_2_classLit = createForEnum('java.util.', 'TreeMap$SubMapType', values_10), _3Ljava_util_TreeMap$SubMapType_2_classLit = createForArray('[Ljava.util.', 'TreeMap$SubMapType;', Ljava_util_TreeMap$SubMapType_2_classLit), Ljava_util_TreeMap$SubMapType$1_2_classLit = createForEnum('java.util.', 'TreeMap$SubMapType$1', null), Ljava_util_TreeMap$SubMapType$2_2_classLit = createForEnum('java.util.', 'TreeMap$SubMapType$2', null), Ljava_util_TreeMap$SubMapType$3_2_classLit = createForEnum('java.util.', 'TreeMap$SubMapType$3', null), Ljava_util_TreeMap$1_2_classLit = createForClass('java.util.', 'TreeMap$1'), Ljava_util_TreeSet_2_classLit = createForClass('java.util.', 'TreeSet'), Lorg_waveprotocol_wave_client_clipboard_AnnotationSerializer$Builder_2_classLit = createForClass('org.waveprotocol.wave.client.clipboard.', 'AnnotationSerializer$Builder'), Lorg_waveprotocol_wave_client_clipboard_Clipboard_2_classLit = createForClass('org.waveprotocol.wave.client.clipboard.', 'Clipboard'), Lorg_waveprotocol_wave_client_clipboard_PasteBufferImpl_2_classLit = createForClass('org.waveprotocol.wave.client.clipboard.', 'PasteBufferImpl'), Lorg_waveprotocol_wave_client_common_util_ClientDebugException_2_classLit = createForClass('org.waveprotocol.wave.client.common.util.', 'ClientDebugException'), Lorg_waveprotocol_wave_client_common_util_DomHelper$ElementEditability_2_classLit = createForEnum('org.waveprotocol.wave.client.common.util.', 'DomHelper$ElementEditability', values_11), _3Lorg_waveprotocol_wave_client_common_util_DomHelper$ElementEditability_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.common.util.', 'DomHelper$ElementEditability;', Lorg_waveprotocol_wave_client_common_util_DomHelper$ElementEditability_2_classLit), Lorg_waveprotocol_wave_client_common_util_EventWrapper_2_classLit = createForClass('org.waveprotocol.wave.client.common.util.', 'EventWrapper'), Lorg_waveprotocol_wave_client_common_util_EventWrapper$1_2_classLit = createForClass('org.waveprotocol.wave.client.common.util.', 'EventWrapper$1'), Lorg_waveprotocol_wave_client_common_util_KeyCombo_2_classLit = createForEnum('org.waveprotocol.wave.client.common.util.', 'KeyCombo', values_12), _3Lorg_waveprotocol_wave_client_common_util_KeyCombo_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.common.util.', 'KeyCombo;', Lorg_waveprotocol_wave_client_common_util_KeyCombo_2_classLit), Lorg_waveprotocol_wave_client_common_util_LinkedPruningSequenceMap_2_classLit = createForClass('org.waveprotocol.wave.client.common.util.', 'LinkedPruningSequenceMap'), Lorg_waveprotocol_wave_client_common_util_LinkedPruningSequenceMap$Node_2_classLit = createForClass('org.waveprotocol.wave.client.common.util.', 'LinkedPruningSequenceMap$Node'), Lorg_waveprotocol_wave_client_common_util_LinkedPruningSequenceMap$1_2_classLit = createForClass('org.waveprotocol.wave.client.common.util.', 'LinkedPruningSequenceMap$1'), Lorg_waveprotocol_wave_client_common_util_LogicalPanel$Impl_2_classLit = createForClass('org.waveprotocol.wave.client.common.util.', 'LogicalPanel$Impl'), Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeySignalType_2_classLit = createForEnum('org.waveprotocol.wave.client.common.util.', 'SignalEvent$KeySignalType', values_14), _3Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeySignalType_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.common.util.', 'SignalEvent$KeySignalType;', Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeySignalType_2_classLit), Lorg_waveprotocol_wave_client_common_util_SignalEvent$MoveUnit_2_classLit = createForEnum('org.waveprotocol.wave.client.common.util.', 'SignalEvent$MoveUnit', values_15), _3Lorg_waveprotocol_wave_client_common_util_SignalEvent$MoveUnit_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.common.util.', 'SignalEvent$MoveUnit;', Lorg_waveprotocol_wave_client_common_util_SignalEvent$MoveUnit_2_classLit), Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeyModifier_2_classLit = createForEnum('org.waveprotocol.wave.client.common.util.', 'SignalEvent$KeyModifier', values_13), _3Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeyModifier_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.common.util.', 'SignalEvent$KeyModifier;', Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeyModifier_2_classLit), Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeyModifier$1_2_classLit = createForEnum('org.waveprotocol.wave.client.common.util.', 'SignalEvent$KeyModifier$1', null), Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeyModifier$2_2_classLit = createForEnum('org.waveprotocol.wave.client.common.util.', 'SignalEvent$KeyModifier$2', null), Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeyModifier$3_2_classLit = createForEnum('org.waveprotocol.wave.client.common.util.', 'SignalEvent$KeyModifier$3', null), Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeyModifier$4_2_classLit = createForEnum('org.waveprotocol.wave.client.common.util.', 'SignalEvent$KeyModifier$4', null), Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeyModifier$5_2_classLit = createForEnum('org.waveprotocol.wave.client.common.util.', 'SignalEvent$KeyModifier$5', null), Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeyModifier$6_2_classLit = createForEnum('org.waveprotocol.wave.client.common.util.', 'SignalEvent$KeyModifier$6', null), Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeyModifier$7_2_classLit = createForEnum('org.waveprotocol.wave.client.common.util.', 'SignalEvent$KeyModifier$7', null), Lorg_waveprotocol_wave_client_common_util_SignalEvent$KeyModifier$8_2_classLit = createForEnum('org.waveprotocol.wave.client.common.util.', 'SignalEvent$KeyModifier$8', null), Lorg_waveprotocol_wave_client_common_util_SignalEventImpl_2_classLit = createForClass('org.waveprotocol.wave.client.common.util.', 'SignalEventImpl'), Lorg_waveprotocol_wave_client_common_util_SignalEventImpl$1_2_classLit = createForClass('org.waveprotocol.wave.client.common.util.', 'SignalEventImpl$1'), Lorg_waveprotocol_wave_client_common_util_SignalKeyLogic_2_classLit = createForClass('org.waveprotocol.wave.client.common.util.', 'SignalKeyLogic'), Lorg_waveprotocol_wave_client_common_util_SignalKeyLogic$UserAgentType_2_classLit = createForEnum('org.waveprotocol.wave.client.common.util.', 'SignalKeyLogic$UserAgentType', values_17), _3Lorg_waveprotocol_wave_client_common_util_SignalKeyLogic$UserAgentType_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.common.util.', 'SignalKeyLogic$UserAgentType;', Lorg_waveprotocol_wave_client_common_util_SignalKeyLogic$UserAgentType_2_classLit), Lorg_waveprotocol_wave_client_common_util_SignalKeyLogic$OperatingSystem_2_classLit = createForEnum('org.waveprotocol.wave.client.common.util.', 'SignalKeyLogic$OperatingSystem', values_16), _3Lorg_waveprotocol_wave_client_common_util_SignalKeyLogic$OperatingSystem_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.common.util.', 'SignalKeyLogic$OperatingSystem;', Lorg_waveprotocol_wave_client_common_util_SignalKeyLogic$OperatingSystem_2_classLit), Lorg_waveprotocol_wave_client_common_util_SignalKeyLogic$Result_2_classLit = createForClass('org.waveprotocol.wave.client.common.util.', 'SignalKeyLogic$Result'), Lorg_waveprotocol_wave_client_common_util_SignalKeyLogic$1_2_classLit = createForClass('org.waveprotocol.wave.client.common.util.', 'SignalKeyLogic$1'), Lorg_waveprotocol_wave_client_common_util_UserAgentRuntimeProperties_2_classLit = createForClass('org.waveprotocol.wave.client.common.util.', 'UserAgentRuntimeProperties'), Lorg_waveprotocol_wave_common_logging_AbstractLogger_2_classLit = createForClass('org.waveprotocol.wave.common.logging.', 'AbstractLogger'), Lorg_waveprotocol_wave_client_debug_logger_DomLogger_2_classLit = createForClass('org.waveprotocol.wave.client.debug.logger.', 'DomLogger'), Lorg_waveprotocol_wave_client_debug_logger_BufferedLogger_2_classLit = createForClass('org.waveprotocol.wave.client.debug.logger.', 'BufferedLogger'), Lorg_waveprotocol_wave_common_logging_LogSink_2_classLit = createForClass('org.waveprotocol.wave.common.logging.', 'LogSink'), Lorg_waveprotocol_wave_client_debug_logger_BufferedLogger$BufferedLogSink_2_classLit = createForClass('org.waveprotocol.wave.client.debug.logger.', 'BufferedLogger$BufferedLogSink'), Lorg_waveprotocol_wave_client_debug_logger_BufferedLogger$BufferedLogSink$LogMessage_2_classLit = createForClass('org.waveprotocol.wave.client.debug.logger.', 'BufferedLogger$BufferedLogSink$LogMessage'), Lorg_waveprotocol_wave_client_debug_logger_BufferedLogger$BufferedLogSink$1_2_classLit = createForClass('org.waveprotocol.wave.client.debug.logger.', 'BufferedLogger$BufferedLogSink$1'), Lorg_waveprotocol_wave_client_debug_logger_DomLogger$GWTLogSink_2_classLit = createForClass('org.waveprotocol.wave.client.debug.logger.', 'DomLogger$GWTLogSink'), Lorg_waveprotocol_wave_client_debug_logger_DomLogger_1Resources_1en_1InlineClientBundleGenerator_2_classLit = createForClass('org.waveprotocol.wave.client.debug.logger.', 'DomLogger_Resources_en_InlineClientBundleGenerator'), Lorg_waveprotocol_wave_client_editor_NodeMutationHandlerImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'NodeMutationHandlerImpl'), Lorg_waveprotocol_wave_client_editor_RenderingMutationHandler_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'RenderingMutationHandler'), Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler_2_classLit = createForClass('org.waveprotocol.wave.client.editor.gwt.', 'GwtRenderingMutationHandler'), Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.attachment.render.', 'ImageThumbnailRenderer'), Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWidget_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.attachment.render.', 'ImageThumbnailWidget'), Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWidget$DoubleBufferImage_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.attachment.render.', 'ImageThumbnailWidget$DoubleBufferImage'), Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWidget$DoubleBufferImage$DoubleLoadHandler_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.attachment.render.', 'ImageThumbnailWidget$DoubleBufferImage$DoubleLoadHandler'), Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWidget$DoubleBufferImage$DoubleLoadHandler$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.attachment.render.', 'ImageThumbnailWidget$DoubleBufferImage$DoubleLoadHandler$1'), Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWidget$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.attachment.render.', 'ImageThumbnailWidget$1'), Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWidget$2_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.attachment.render.', 'ImageThumbnailWidget$2'), Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWidget$3_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.attachment.render.', 'ImageThumbnailWidget$3'), Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWidget$4_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.attachment.render.', 'ImageThumbnailWidget$4'), Lorg_waveprotocol_wave_client_widget_progress_ProgressWidget_2_classLit = createForClass('org.waveprotocol.wave.client.widget.progress.', 'ProgressWidget'), Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWidget_1BinderImpl$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.attachment.render.', 'ImageThumbnailWidget_BinderImpl$1'), Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWidget_1BinderImpl$2_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.attachment.render.', 'ImageThumbnailWidget_BinderImpl$2'), Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWidget_1BinderImpl$3_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.attachment.render.', 'ImageThumbnailWidget_BinderImpl$3'), Lorg_waveprotocol_wave_client_doodad_attachment_render_ImageThumbnailWrapper_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.attachment.render.', 'ImageThumbnailWrapper'), Lorg_waveprotocol_wave_client_doodad_attachment_testing_FakeAttachment_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.attachment.testing.', 'FakeAttachment'), Lorg_waveprotocol_wave_client_doodad_attachment_testing_FakeAttachment$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.attachment.testing.', 'FakeAttachment$1'), Lorg_waveprotocol_wave_client_doodad_attachment_testing_FakeAttachment$2_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.attachment.testing.', 'FakeAttachment$2'), Lorg_waveprotocol_wave_client_doodad_attachment_testing_FakeAttachmentsManager_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.attachment.testing.', 'FakeAttachmentsManager'), Lorg_waveprotocol_wave_client_doodad_attachment_ImageThumbnailAttachmentHandler_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.attachment.', 'ImageThumbnailAttachmentHandler'), Lorg_waveprotocol_wave_client_editor_NodeEventHandlerImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'NodeEventHandlerImpl'), Lorg_waveprotocol_wave_client_doodad_attachment_ImageThumbnailNodeEventHandler_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.attachment.', 'ImageThumbnailNodeEventHandler'), Lorg_waveprotocol_wave_client_doodad_attachment_ImageThumbnailNodeEventHandler$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.attachment.', 'ImageThumbnailNodeEventHandler$1'), Lorg_waveprotocol_wave_client_doodad_attachment_SimpleAttachmentManager$UploadStatusCode_2_classLit = createForEnum('org.waveprotocol.wave.client.doodad.attachment.', 'SimpleAttachmentManager$UploadStatusCode', values_18), _3Lorg_waveprotocol_wave_client_doodad_attachment_SimpleAttachmentManager$UploadStatusCode_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.doodad.attachment.', 'SimpleAttachmentManager$UploadStatusCode;', Lorg_waveprotocol_wave_client_doodad_attachment_SimpleAttachmentManager$UploadStatusCode_2_classLit), Lorg_waveprotocol_wave_client_doodad_diff_DiffAnnotationHandler_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.diff.', 'DiffAnnotationHandler'), Lorg_waveprotocol_wave_client_doodad_diff_DiffAnnotationHandler$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.diff.', 'DiffAnnotationHandler$1'), Lorg_waveprotocol_wave_client_doodad_diff_DiffAnnotationHandler$2_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.diff.', 'DiffAnnotationHandler$2'), Lorg_waveprotocol_wave_client_doodad_diff_DiffDeleteRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.diff.', 'DiffDeleteRenderer'), Lorg_waveprotocol_wave_client_doodad_form_button_Button$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.form.button.', 'Button$1'), Lorg_waveprotocol_wave_client_doodad_form_button_ButtonRenderingMutationHandler_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.form.button.', 'ButtonRenderingMutationHandler'), Lorg_waveprotocol_wave_client_doodad_form_button_ButtonRenderingMutationHandler_1Resources_1safari_1en_1InlineClientBundleGenerator$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.form.button.', 'ButtonRenderingMutationHandler_Resources_safari_en_InlineClientBundleGenerator$1'), Lorg_waveprotocol_wave_client_doodad_form_check_CheckBox$CheckBoxRendereringMutationHandler_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.form.check.', 'CheckBox$CheckBoxRendereringMutationHandler'), Lorg_waveprotocol_wave_client_doodad_form_check_CheckBox$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.form.check.', 'CheckBox$1'), Lorg_waveprotocol_wave_client_doodad_form_check_CheckConstants_1Resources_1en_1InlineClientBundleGenerator$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.form.check.', 'CheckConstants_Resources_en_InlineClientBundleGenerator$1'), Lorg_waveprotocol_wave_client_doodad_form_check_LabelRenderingMutationHandler_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.form.check.', 'LabelRenderingMutationHandler'), Lorg_waveprotocol_wave_client_doodad_form_check_LabelRenderingMutationHandler_1Resources_1en_1InlineClientBundleGenerator$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.form.check.', 'LabelRenderingMutationHandler_Resources_en_InlineClientBundleGenerator$1'), Lorg_waveprotocol_wave_client_doodad_form_check_RadioButton$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.form.check.', 'RadioButton$1'), Lorg_waveprotocol_wave_client_doodad_form_check_RadioButton$2_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.form.check.', 'RadioButton$2'), Lorg_waveprotocol_wave_client_doodad_form_check_RadioGroup$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.form.check.', 'RadioGroup$1'), Lorg_waveprotocol_wave_client_doodad_form_events_ContentEvents$ContentEventsNodeHandler_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.form.events.', 'ContentEvents$ContentEventsNodeHandler'), Lorg_waveprotocol_wave_client_doodad_form_events_ContentEvents$ContentEventsNodeMutationHandler_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.form.events.', 'ContentEvents$ContentEventsNodeMutationHandler'), Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphEventHandler_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'ParagraphEventHandler'), Lorg_waveprotocol_wave_client_editor_content_misc_LinoTextEventHandler_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'LinoTextEventHandler'), Lorg_waveprotocol_wave_client_doodad_form_input_Input_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.form.input.', 'Input'), Lorg_waveprotocol_wave_client_editor_content_paragraph_DefaultParagraphHtmlRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'DefaultParagraphHtmlRenderer'), Lorg_waveprotocol_wave_client_doodad_form_input_Input$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.form.input.', 'Input$1'), Lorg_waveprotocol_wave_client_doodad_form_input_Input$2_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.form.input.', 'Input$2'), Lorg_waveprotocol_wave_client_doodad_form_input_Input_1Resources_1en_1InlineClientBundleGenerator$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.form.input.', 'Input_Resources_en_InlineClientBundleGenerator$1'), Lorg_waveprotocol_wave_client_doodad_form_input_Password$PasswordEventHandler_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.form.input.', 'Password$PasswordEventHandler'), Lorg_waveprotocol_wave_client_doodad_form_input_Password$PasswordEventHandler$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.form.input.', 'Password$PasswordEventHandler$1'), Lorg_waveprotocol_wave_client_doodad_form_input_Password$PasswordRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.form.input.', 'Password$PasswordRenderer'), Lorg_waveprotocol_wave_client_doodad_form_input_Password_1Resources_1en_1InlineClientBundleGenerator$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.form.input.', 'Password_Resources_en_InlineClientBundleGenerator$1'), Lorg_waveprotocol_wave_client_doodad_link_Link$InvalidLinkException_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.link.', 'Link$InvalidLinkException'), Lorg_waveprotocol_wave_client_doodad_link_LinkAnnotationHandler_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.link.', 'LinkAnnotationHandler'), Lorg_waveprotocol_wave_client_doodad_link_LinkAnnotationHandler$RenderFunc_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.link.', 'LinkAnnotationHandler$RenderFunc'), Lorg_waveprotocol_wave_client_doodad_link_LinkAnnotationHandler$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.link.', 'LinkAnnotationHandler$1'), Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$DefaultAnnotationBehaviour_2_classLit = createForClass('org.waveprotocol.wave.model.document.', 'AnnotationBehaviour$DefaultAnnotationBehaviour'), Lorg_waveprotocol_wave_client_doodad_link_LinkAnnotationHandler$2_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.link.', 'LinkAnnotationHandler$2'), Lorg_waveprotocol_wave_client_doodad_link_LinkAnnotationHandler$2$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.link.', 'LinkAnnotationHandler$2$1'), Lorg_waveprotocol_wave_client_doodad_suggestion_Suggestion_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.suggestion.', 'Suggestion'), Lorg_waveprotocol_wave_client_doodad_suggestion_SuggestionButton_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.suggestion.', 'SuggestionButton'), Lorg_waveprotocol_wave_client_doodad_suggestion_SuggestionButton$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.suggestion.', 'SuggestionButton$1'), Lorg_waveprotocol_wave_client_doodad_suggestion_SuggestionRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.suggestion.', 'SuggestionRenderer'), Lorg_waveprotocol_wave_client_editor_content_img_ImgDoodad$ImgRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.img.', 'ImgDoodad$ImgRenderer'), Lorg_waveprotocol_wave_client_editor_content_misc_AnnotationBoundaryRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'AnnotationBoundaryRenderer'), Lorg_waveprotocol_wave_client_editor_content_misc_AnnotationBoundaryRenderer$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'AnnotationBoundaryRenderer$1'), Lorg_waveprotocol_wave_client_editor_content_misc_AnnotationSpreadRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'AnnotationSpreadRenderer'), Lorg_waveprotocol_wave_client_editor_content_misc_AnnotationSpreadRenderer$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'AnnotationSpreadRenderer$1'), Lorg_waveprotocol_wave_client_editor_content_misc_AnnotationSpreadRenderer$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'AnnotationSpreadRenderer$2'), Lorg_waveprotocol_wave_client_editor_content_misc_Caption$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'Caption$1'), Lorg_waveprotocol_wave_client_editor_content_misc_Caption$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'Caption$2'), Lorg_waveprotocol_wave_client_editor_content_misc_CaretAnnotations_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'CaretAnnotations'), Lorg_waveprotocol_wave_client_editor_content_misc_ChunkyElementHandler_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'ChunkyElementHandler'), Lorg_waveprotocol_wave_client_editor_content_misc_StyleAnnotationHandler_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'StyleAnnotationHandler'), Lorg_waveprotocol_wave_client_editor_content_misc_StyleAnnotationHandler$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'StyleAnnotationHandler$1'), Lorg_waveprotocol_wave_client_editor_content_misc_UpdateContentEditable_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'UpdateContentEditable'), Lorg_waveprotocol_wave_client_editor_content_paragraph_Line_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'Line'), Lorg_waveprotocol_wave_client_editor_content_paragraph_LineContainerParagraphiser_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'LineContainerParagraphiser'), Lorg_waveprotocol_wave_client_editor_content_paragraph_LineContainerParagraphiser$LineHandler_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'LineContainerParagraphiser$LineHandler'), Lorg_waveprotocol_wave_client_editor_content_paragraph_LineRendering$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'LineRendering$1'), Lorg_waveprotocol_wave_client_editor_content_paragraph_LocalParagraphEventHandler_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'LocalParagraphEventHandler'), Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'OrderedListRenumberer'), Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer$LevelNumbers_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'OrderedListRenumberer$LevelNumbers'), Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer$ComparableLine_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'OrderedListRenumberer$ComparableLine'), Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer$RelativeImportance_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.paragraph.', 'OrderedListRenumberer$RelativeImportance', values_24), _3Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer$RelativeImportance_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.content.paragraph.', 'OrderedListRenumberer$RelativeImportance;', Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer$RelativeImportance_2_classLit), Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'OrderedListRenumberer$1'), Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$Alignment_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.paragraph.', 'Paragraph$Alignment', values_25), _3Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$Alignment_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.content.paragraph.', 'Paragraph$Alignment;', Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$Alignment_2_classLit), Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$Direction_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.paragraph.', 'Paragraph$Direction', values_26), _3Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$Direction_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.content.paragraph.', 'Paragraph$Direction;', Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$Direction_2_classLit), Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$RegularStyler_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'Paragraph$RegularStyler'), Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$ListStyler_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'Paragraph$ListStyler'), Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'Paragraph$1'), Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'Paragraph$2'), Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$3_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'Paragraph$3'), Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$4_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'Paragraph$4'), Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphBehaviour_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.paragraph.', 'ParagraphBehaviour', values_27), _3Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphBehaviour_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.content.paragraph.', 'ParagraphBehaviour;', Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphBehaviour_2_classLit), Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphNiceHtmlRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'ParagraphNiceHtmlRenderer'), Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphNiceHtmlRenderer$IndentType_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.paragraph.', 'ParagraphNiceHtmlRenderer$IndentType', values_28), _3Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphNiceHtmlRenderer$IndentType_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.content.paragraph.', 'ParagraphNiceHtmlRenderer$IndentType;', Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphNiceHtmlRenderer$IndentType_2_classLit), Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphNiceHtmlRenderer$IndentType$1_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.paragraph.', 'ParagraphNiceHtmlRenderer$IndentType$1', null), Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphNiceHtmlRenderer$IndentType$2_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.paragraph.', 'ParagraphNiceHtmlRenderer$IndentType$2', null), Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphNiceHtmlRenderer$IndentType$3_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.paragraph.', 'ParagraphNiceHtmlRenderer$IndentType$3', null), Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphNiceHtmlRenderer$HtmlStack_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'ParagraphNiceHtmlRenderer$HtmlStack'), Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'ParagraphRenderer'), Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphRenderer$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'ParagraphRenderer$1'), Lorg_waveprotocol_wave_client_editor_content_ContentNode_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentNode'), Lorg_waveprotocol_wave_client_editor_content_ContentElement_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentElement'), Lorg_waveprotocol_wave_client_editor_content_AgentAdapter_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'AgentAdapter'), Lorg_waveprotocol_wave_client_editor_content_AgentAdapter$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'AgentAdapter$1'), Lorg_waveprotocol_wave_client_editor_content_AgentAdapter$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'AgentAdapter$2'), Lorg_waveprotocol_wave_client_editor_content_AgentAdapter_1Resources_1en_1InlineClientBundleGenerator$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'AgentAdapter_Resources_en_InlineClientBundleGenerator$1'), Lorg_waveprotocol_wave_client_editor_content_AnnotationPainter_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'AnnotationPainter'), Lorg_waveprotocol_wave_client_editor_content_AnnotationPainter$DocPainter_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'AnnotationPainter$DocPainter'), Lorg_waveprotocol_wave_client_editor_content_AnnotationPainter$DocPainter$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'AnnotationPainter$DocPainter$1'), Lorg_waveprotocol_wave_client_editor_content_AnnotationPainter$DocPainter$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'AnnotationPainter$DocPainter$2'), Lorg_waveprotocol_wave_model_document_MutableDocumentImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.', 'MutableDocumentImpl'), Lorg_waveprotocol_wave_client_editor_content_CMutableDocument_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'CMutableDocument'), Lorg_waveprotocol_wave_client_editor_content_ContentDocElement$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocElement$1'), Lorg_waveprotocol_wave_client_editor_content_ContentDocElement$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocElement$2'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$LocalOperationException_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$LocalOperationException'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$SchemaViolatingLocalOperationException_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$SchemaViolatingLocalOperationException'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$BadOpLocalOperationException_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$BadOpLocalOperationException'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$AnnotationImplFactory', values_21), _3Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.content.', 'ContentDocument$AnnotationImplFactory;', Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory_2_classLit), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory$1_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$AnnotationImplFactory$1', null), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory$2_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$AnnotationImplFactory$2', null), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory$3_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$AnnotationImplFactory$3', null), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$SourceNindoSink_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$SourceNindoSink'), Lorg_waveprotocol_wave_model_document_util_IdentityView_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'IdentityView'), Lorg_waveprotocol_wave_model_document_util_FilteredView_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'FilteredView'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$RenderedContent_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$RenderedContent'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$FullContent_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$FullContent'), Lorg_waveprotocol_wave_model_document_util_PersistentContent_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'PersistentContent'), Lorg_waveprotocol_wave_model_document_util_RepaintingPersistentContent_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'RepaintingPersistentContent'), Lorg_waveprotocol_wave_client_editor_content_PersistentContentView_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'PersistentContentView'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$PersistentContentDoc_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$PersistentContentDoc'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$FilteredHtml_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$FilteredHtml'), Lorg_waveprotocol_wave_model_document_util_LocalAnnotationSetImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'LocalAnnotationSetImpl'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$LocalAnnotationSet_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$LocalAnnotationSet'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$ContentIndexedDoc_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$ContentIndexedDoc'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$ContentIndexedDoc$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$ContentIndexedDoc$1'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$Level_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$Level', values_22), _3Lorg_waveprotocol_wave_client_editor_content_ContentDocument$Level_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.content.', 'ContentDocument$Level;', Lorg_waveprotocol_wave_client_editor_content_ContentDocument$Level_2_classLit), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$1'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$2'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$3_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$3'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$4_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$4'), Lorg_waveprotocol_wave_client_scheduler_FinalTaskRunnerImpl_2_classLit = createForClass('org.waveprotocol.wave.client.scheduler.', 'FinalTaskRunnerImpl'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$4$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$4$1'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$5_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$5'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$6_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$6'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$7_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$7'), Lorg_waveprotocol_wave_client_editor_content_ContentNode$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentNode$1'), Lorg_waveprotocol_wave_client_editor_content_ContentPoint_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentPoint'), Lorg_waveprotocol_wave_model_document_util_PointRange_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'PointRange'), Lorg_waveprotocol_wave_client_editor_content_ContentRange_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentRange'), Lorg_waveprotocol_wave_client_editor_content_FullContentView_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'FullContentView'), Lorg_waveprotocol_wave_client_editor_content_ContentRawDocument_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentRawDocument'), Lorg_waveprotocol_wave_client_editor_content_ContentTextNode_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentTextNode'), Lorg_waveprotocol_wave_client_editor_content_DiffHighlightingFilter_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'DiffHighlightingFilter'), Lorg_waveprotocol_wave_client_editor_content_DiffHighlightingFilter$DeleteInfo_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'DiffHighlightingFilter$DeleteInfo'), Lorg_waveprotocol_wave_client_editor_content_DiffOpWrapperBase_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'DiffOpWrapperBase'), Lorg_waveprotocol_wave_client_editor_content_DiffHighlightingFilter$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'DiffHighlightingFilter$1'), Lorg_waveprotocol_wave_client_editor_content_DiffHighlightingFilter$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'DiffHighlightingFilter$2'), Lorg_waveprotocol_wave_client_editor_content_DiffHighlightingFilter$3_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'DiffHighlightingFilter$3'), Lorg_waveprotocol_wave_client_editor_content_ExtendedClientDocumentContext$LowLevelEditingConcerns$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ExtendedClientDocumentContext$LowLevelEditingConcerns$1'), Lorg_waveprotocol_wave_model_document_util_FocusedPointRange_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'FocusedPointRange'), Lorg_waveprotocol_wave_client_editor_content_FocusedContentRange_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'FocusedContentRange'), Lorg_waveprotocol_wave_client_editor_content_HtmlPoint_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'HtmlPoint'), Lorg_waveprotocol_wave_client_editor_content_LazyPersistenceManager_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'LazyPersistenceManager'), Lorg_waveprotocol_wave_client_editor_content_LazyPersistenceManager$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'LazyPersistenceManager$1'), Lorg_waveprotocol_wave_client_editor_content_NodeEventRouter_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'NodeEventRouter'), Lorg_waveprotocol_wave_client_editor_content_NullRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'NullRenderer'), Lorg_waveprotocol_wave_client_editor_content_PainterRegistryImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'PainterRegistryImpl'), Lorg_waveprotocol_wave_client_editor_content_PainterRegistryImpl$PaintData_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'PainterRegistryImpl$PaintData'), Lorg_waveprotocol_wave_client_editor_content_PainterRegistryImpl$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'PainterRegistryImpl$1'), Lorg_waveprotocol_wave_client_editor_content_RegistriesImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'RegistriesImpl'), Lorg_waveprotocol_wave_client_editor_content_SelectionMaintainer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'SelectionMaintainer'), Lorg_waveprotocol_wave_client_editor_content_SelectionMaintainer$TextNodeChangeType_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.', 'SelectionMaintainer$TextNodeChangeType', values_23), _3Lorg_waveprotocol_wave_client_editor_content_SelectionMaintainer$TextNodeChangeType_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.content.', 'SelectionMaintainer$TextNodeChangeType;', Lorg_waveprotocol_wave_client_editor_content_SelectionMaintainer$TextNodeChangeType_2_classLit), Lorg_waveprotocol_wave_client_editor_debug_CursorDisplay_2_classLit = createForClass('org.waveprotocol.wave.client.editor.debug.', 'CursorDisplay'), Lorg_waveprotocol_wave_client_editor_debug_DebugDialog_2_classLit = createForClass('org.waveprotocol.wave.client.editor.debug.', 'DebugDialog'), Lorg_waveprotocol_wave_client_editor_debug_DebugDialog$Selection_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.debug.', 'DebugDialog$Selection', values_29), _3Lorg_waveprotocol_wave_client_editor_debug_DebugDialog$Selection_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.debug.', 'DebugDialog$Selection;', Lorg_waveprotocol_wave_client_editor_debug_DebugDialog$Selection_2_classLit), Lorg_waveprotocol_wave_client_editor_debug_DebugDialog$LogPanel_2_classLit = createForClass('org.waveprotocol.wave.client.editor.debug.', 'DebugDialog$LogPanel'), Lorg_waveprotocol_wave_client_editor_debug_DebugDialog$LogPanel$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.debug.', 'DebugDialog$LogPanel$1'), Lorg_waveprotocol_wave_client_editor_debug_DebugDialog$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.debug.', 'DebugDialog$1'), Lorg_waveprotocol_wave_client_editor_debug_DebugDialog$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.debug.', 'DebugDialog$2'), Lorg_waveprotocol_wave_client_editor_debug_DebugOptions_2_classLit = createForClass('org.waveprotocol.wave.client.editor.debug.', 'DebugOptions'), Lorg_waveprotocol_wave_client_editor_debug_DebugOptions$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.debug.', 'DebugOptions$1'), Lorg_waveprotocol_wave_client_editor_debug_DebugOptions$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.debug.', 'DebugOptions$2'), Lorg_waveprotocol_wave_client_editor_debug_DebugOptions$3_2_classLit = createForClass('org.waveprotocol.wave.client.editor.debug.', 'DebugOptions$3'), Lorg_waveprotocol_wave_client_editor_debug_DebugOptions$4_2_classLit = createForClass('org.waveprotocol.wave.client.editor.debug.', 'DebugOptions$4'), Lorg_waveprotocol_wave_client_editor_debug_DebugOptions$5_2_classLit = createForClass('org.waveprotocol.wave.client.editor.debug.', 'DebugOptions$5'), Lorg_waveprotocol_wave_client_editor_debug_DebugOptions$6_2_classLit = createForClass('org.waveprotocol.wave.client.editor.debug.', 'DebugOptions$6'), Lorg_waveprotocol_wave_client_editor_debug_DebugOptions$7_2_classLit = createForClass('org.waveprotocol.wave.client.editor.debug.', 'DebugOptions$7'), Lorg_waveprotocol_wave_client_editor_debug_DebugOptions$7$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.debug.', 'DebugOptions$7$1'), Lorg_waveprotocol_wave_client_editor_debug_DebugPopupFactory$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.debug.', 'DebugPopupFactory$1'), Lorg_waveprotocol_wave_client_editor_debug_DebugPopupFactory$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.debug.', 'DebugPopupFactory$2'), Lorg_waveprotocol_wave_client_editor_event_CompositionEventHandler_2_classLit = createForClass('org.waveprotocol.wave.client.editor.event.', 'CompositionEventHandler'), Lorg_waveprotocol_wave_client_editor_event_CompositionEventHandler$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.event.', 'CompositionEventHandler$1'), Lorg_waveprotocol_wave_client_editor_event_EditorEventHandler_2_classLit = createForClass('org.waveprotocol.wave.client.editor.event.', 'EditorEventHandler'), Lorg_waveprotocol_wave_client_editor_event_EditorEventHandler$State_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.event.', 'EditorEventHandler$State', values_30), _3Lorg_waveprotocol_wave_client_editor_event_EditorEventHandler$State_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.event.', 'EditorEventHandler$State;', Lorg_waveprotocol_wave_client_editor_event_EditorEventHandler$State_2_classLit), Lorg_waveprotocol_wave_client_editor_event_EditorEventHandler$SelectionLostException_2_classLit = createForClass('org.waveprotocol.wave.client.editor.event.', 'EditorEventHandler$SelectionLostException'), Lorg_waveprotocol_wave_client_editor_event_EditorEventHandler$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.event.', 'EditorEventHandler$1'), Lorg_waveprotocol_wave_client_editor_event_EditorEventImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.event.', 'EditorEventImpl'), Lorg_waveprotocol_wave_client_editor_event_EditorEventImpl$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.event.', 'EditorEventImpl$1'), Lorg_waveprotocol_wave_client_editor_extract_DomMutationReverter_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'DomMutationReverter'), Lorg_waveprotocol_wave_client_editor_extract_DomMutationReverter$RemovalEntry_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'DomMutationReverter$RemovalEntry'), Lorg_waveprotocol_wave_client_editor_extract_ImeExtractor_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'ImeExtractor'), Lorg_waveprotocol_wave_client_editor_extract_ImeExtractor$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'ImeExtractor$1'), Lorg_waveprotocol_wave_client_editor_extract_InconsistencyException_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'InconsistencyException'), Lorg_waveprotocol_wave_client_editor_extract_InconsistencyException$HtmlMissing_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'InconsistencyException$HtmlMissing'), Lorg_waveprotocol_wave_client_editor_extract_InconsistencyException$HtmlInserted_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'InconsistencyException$HtmlInserted'), Lorg_waveprotocol_wave_client_editor_extract_PasteAnnotationLogic_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'PasteAnnotationLogic'), Lorg_waveprotocol_wave_client_editor_extract_PasteAnnotationLogic$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'PasteAnnotationLogic$1'), Lorg_waveprotocol_wave_client_editor_extract_PasteAnnotationLogic$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'PasteAnnotationLogic$2'), Lorg_waveprotocol_wave_client_editor_extract_PasteAnnotationLogic$3_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'PasteAnnotationLogic$3'), Lorg_waveprotocol_wave_client_editor_extract_PasteAnnotationLogic$4_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'PasteAnnotationLogic$4'), Lorg_waveprotocol_wave_client_editor_extract_PasteExtractor_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'PasteExtractor'), Lorg_waveprotocol_wave_client_editor_extract_PasteExtractor$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'PasteExtractor$1'), Lorg_waveprotocol_wave_client_editor_extract_PasteExtractor$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'PasteExtractor$2'), Lorg_waveprotocol_wave_client_editor_extract_PasteFormatRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'PasteFormatRenderer'), Lorg_waveprotocol_wave_client_editor_extract_PasteFormatRenderers$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'PasteFormatRenderers$1'), Lorg_waveprotocol_wave_client_editor_extract_PasteFormatRenderers$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'PasteFormatRenderers$2'), Lorg_waveprotocol_wave_client_editor_extract_Repairer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'Repairer'), Lorg_waveprotocol_wave_client_scheduler_ScheduleTimer_2_classLit = createForClass('org.waveprotocol.wave.client.scheduler.', 'ScheduleTimer'), Lorg_waveprotocol_wave_client_editor_extract_Repairer$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'Repairer$1'), Lorg_waveprotocol_wave_client_editor_extract_SelectionMatcher_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'SelectionMatcher'), Lorg_waveprotocol_wave_client_editor_extract_SelectionMatcher$LazyPoint$Type_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.extract.', 'SelectionMatcher$LazyPoint$Type', values_31), _3Lorg_waveprotocol_wave_client_editor_extract_SelectionMatcher$LazyPoint$Type_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.extract.', 'SelectionMatcher$LazyPoint$Type;', Lorg_waveprotocol_wave_client_editor_extract_SelectionMatcher$LazyPoint$Type_2_classLit), Lorg_waveprotocol_wave_client_editor_extract_SelectionMatcher$EagerPoint_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'SelectionMatcher$EagerPoint'), Lorg_waveprotocol_wave_client_editor_extract_SelectionMatcher$LazyPointImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'SelectionMatcher$LazyPointImpl'), Lorg_waveprotocol_wave_client_editor_extract_SubTreeXmlRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'SubTreeXmlRenderer'), Lorg_waveprotocol_wave_client_editor_extract_TypingExtractor_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'TypingExtractor'), Lorg_waveprotocol_wave_client_editor_extract_TypingExtractor$TypingState_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'TypingExtractor$TypingState'), Lorg_waveprotocol_wave_client_editor_extract_TypingExtractor$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'TypingExtractor$1'), Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.gwt.', 'GwtRenderingMutationHandler$Flow', values_32), _3Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.gwt.', 'GwtRenderingMutationHandler$Flow;', Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow_2_classLit), Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow$1_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.gwt.', 'GwtRenderingMutationHandler$Flow$1', null), Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow$2_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.gwt.', 'GwtRenderingMutationHandler$Flow$2', null), Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow$3_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.gwt.', 'GwtRenderingMutationHandler$Flow$3', null), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness'), Lorg_waveprotocol_wave_client_editor_harness_DefaultTestHarness$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'DefaultTestHarness$1'), Lorg_waveprotocol_wave_client_editor_harness_DefaultTestHarness$1$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'DefaultTestHarness$1$2'), Lorg_waveprotocol_wave_client_editor_harness_DefaultTestHarness$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'DefaultTestHarness$2'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$EditorBundle_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$EditorBundle'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$1'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$2'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$3_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$3'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$4_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$4'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$5_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$5'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$6_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$6'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$7_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$7'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$8_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$8'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$9_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$9'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$10_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$10'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$11_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$11'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$12_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$12'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$13_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$13'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$14_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$14'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$15_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$15'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$16_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$16'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$17_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$17'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$18_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$18'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$19_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$19'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$20_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$20'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$21_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$21'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$22_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$22'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$23_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$23'), Lorg_waveprotocol_wave_client_editor_harness_EditorHarness$25_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'EditorHarness$25'), Lorg_waveprotocol_wave_client_editor_harness_HighlightingDiffState_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'HighlightingDiffState'), Lorg_waveprotocol_wave_client_editor_harness_SignalEventHarness_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'SignalEventHarness'), Lorg_waveprotocol_wave_client_editor_harness_SignalEventHarness$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'SignalEventHarness$1'), Lorg_waveprotocol_wave_client_editor_harness_SignalEventHarness$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.harness.', 'SignalEventHarness$2'), Lorg_waveprotocol_wave_client_editor_impl_DiffManager$DiffType_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.impl.', 'DiffManager$DiffType', values_33), _3Lorg_waveprotocol_wave_client_editor_impl_DiffManager$DiffType_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.impl.', 'DiffManager$DiffType;', Lorg_waveprotocol_wave_client_editor_impl_DiffManager$DiffType_2_classLit), Lorg_waveprotocol_wave_client_editor_impl_HtmlViewImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.impl.', 'HtmlViewImpl'), Lorg_waveprotocol_wave_client_editor_impl_NodeManager_2_classLit = createForClass('org.waveprotocol.wave.client.editor.impl.', 'NodeManager'), Lorg_waveprotocol_wave_client_editor_impl_StrippingHtmlView_2_classLit = createForClass('org.waveprotocol.wave.client.editor.impl.', 'StrippingHtmlView'), Lorg_waveprotocol_wave_client_editor_keys_KeyBindingRegistry_2_classLit = createForClass('org.waveprotocol.wave.client.editor.keys.', 'KeyBindingRegistry'), Lorg_waveprotocol_wave_client_editor_operation_EditorOperationSequencer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.operation.', 'EditorOperationSequencer'), Lorg_waveprotocol_wave_client_editor_selection_content_PassiveSelectionHelper_2_classLit = createForClass('org.waveprotocol.wave.client.editor.selection.content.', 'PassiveSelectionHelper'), Lorg_waveprotocol_wave_client_editor_selection_content_AggressiveSelectionHelper_2_classLit = createForClass('org.waveprotocol.wave.client.editor.selection.content.', 'AggressiveSelectionHelper'), Lorg_waveprotocol_wave_client_editor_selection_content_CaretMovementHelperWebkitImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.selection.content.', 'CaretMovementHelperWebkitImpl'), Lorg_waveprotocol_wave_client_editor_selection_content_PassiveSelectionHelper$ValidSelectionContainerView_2_classLit = createForClass('org.waveprotocol.wave.client.editor.selection.content.', 'PassiveSelectionHelper$ValidSelectionContainerView'), _3Lorg_waveprotocol_wave_model_document_util_FilteredView_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.util.', 'FilteredView;', Lorg_waveprotocol_wave_model_document_util_FilteredView_2_classLit), Lorg_waveprotocol_wave_client_editor_selection_html_SelectionWebkit$Direction_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.selection.html.', 'SelectionWebkit$Direction', values_34), _3Lorg_waveprotocol_wave_client_editor_selection_html_SelectionWebkit$Direction_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.selection.html.', 'SelectionWebkit$Direction;', Lorg_waveprotocol_wave_client_editor_selection_html_SelectionWebkit$Direction_2_classLit), Lorg_waveprotocol_wave_client_editor_selection_html_SelectionWebkit$MoveUnit_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.selection.html.', 'SelectionWebkit$MoveUnit', values_35), _3Lorg_waveprotocol_wave_client_editor_selection_html_SelectionWebkit$MoveUnit_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.selection.html.', 'SelectionWebkit$MoveUnit;', Lorg_waveprotocol_wave_client_editor_selection_html_SelectionWebkit$MoveUnit_2_classLit), Lorg_waveprotocol_wave_client_editor_sugg_InteractiveSuggestionsManager_2_classLit = createForClass('org.waveprotocol.wave.client.editor.sugg.', 'InteractiveSuggestionsManager'), Lorg_waveprotocol_wave_client_editor_sugg_InteractiveSuggestionsManager$PopupCloser_2_classLit = createForClass('org.waveprotocol.wave.client.editor.sugg.', 'InteractiveSuggestionsManager$PopupCloser'), Lorg_waveprotocol_wave_client_editor_sugg_InteractiveSuggestionsManager$PopupCloser$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.sugg.', 'InteractiveSuggestionsManager$PopupCloser$1'), Lorg_waveprotocol_wave_client_editor_sugg_InteractiveSuggestionsManager$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.sugg.', 'InteractiveSuggestionsManager$1'), Lorg_waveprotocol_wave_client_editor_sugg_SuggestionMenu_2_classLit = createForClass('org.waveprotocol.wave.client.editor.sugg.', 'SuggestionMenu'), Lorg_waveprotocol_wave_client_editor_testtools_TestConstants$EventInfo_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.testtools.', 'TestConstants$EventInfo', values_36), _3Lorg_waveprotocol_wave_client_editor_testtools_TestConstants$EventInfo_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.testtools.', 'TestConstants$EventInfo;', Lorg_waveprotocol_wave_client_editor_testtools_TestConstants$EventInfo_2_classLit), Lorg_waveprotocol_wave_client_editor_util_AnnotationBehaviourLogic_2_classLit = createForClass('org.waveprotocol.wave.client.editor.util.', 'AnnotationBehaviourLogic'), Lorg_waveprotocol_wave_client_editor_util_AnnotationBehaviourLogic$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.util.', 'AnnotationBehaviourLogic$1'), Lorg_waveprotocol_wave_client_editor_util_AnnotationBehaviourLogic$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.util.', 'AnnotationBehaviourLogic$2'), Lorg_waveprotocol_wave_client_editor_util_AnnotationBehaviourLogic$3_2_classLit = createForClass('org.waveprotocol.wave.client.editor.util.', 'AnnotationBehaviourLogic$3'), Lorg_waveprotocol_wave_client_editor_util_AnnotationBehaviourLogic$4_2_classLit = createForClass('org.waveprotocol.wave.client.editor.util.', 'AnnotationBehaviourLogic$4'), Lorg_waveprotocol_wave_client_editor_util_AnnotationBehaviourLogic$5_2_classLit = createForClass('org.waveprotocol.wave.client.editor.util.', 'AnnotationBehaviourLogic$5'), Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'AnnotationTree'), Lorg_waveprotocol_wave_client_editor_EditorAnnotationTree_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorAnnotationTree'), Lorg_waveprotocol_wave_client_editor_EditorImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl'), Lorg_waveprotocol_wave_client_editor_EditorImpl$ConsistentStateCommandRunner_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl$ConsistentStateCommandRunner'), Lorg_waveprotocol_wave_client_editor_EditorImpl$EditorEventsSubHandlerImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl$EditorEventsSubHandlerImpl'), Lorg_waveprotocol_wave_client_editor_EditorImpl$EditorInteractorImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl$EditorInteractorImpl'), Lorg_waveprotocol_wave_client_editor_EditorImpl$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl$1'), Lorg_waveprotocol_wave_client_editor_EditorImpl$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl$2'), Lorg_waveprotocol_wave_client_editor_EditorImpl$3_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl$3'), Lorg_waveprotocol_wave_client_editor_EditorImpl$4_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl$4'), Lorg_waveprotocol_wave_client_editor_EditorImpl$7_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl$7'), Lorg_waveprotocol_wave_client_editor_EditorImpl$8_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl$8'), Lorg_waveprotocol_wave_client_editor_EditorImpl$10_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl$10'), Lorg_waveprotocol_wave_client_editor_EditorImpl$12_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl$12'), Lorg_waveprotocol_wave_client_editor_EditorImpl$13_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl$13'), Lorg_waveprotocol_wave_client_editor_EditorImpl$14_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl$14'), Lorg_waveprotocol_wave_client_editor_EditorImpl$15_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl$15'), Lorg_waveprotocol_wave_client_editor_EditorImpl$16_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl$16'), Lorg_waveprotocol_wave_client_editor_EditorImpl$17_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl$17'), Lorg_waveprotocol_wave_client_editor_EditorImplWebkitMobile_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImplWebkitMobile'), Lorg_waveprotocol_wave_client_editor_EditorInstrumentor$Action_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.', 'EditorInstrumentor$Action', values_19), _3Lorg_waveprotocol_wave_client_editor_EditorInstrumentor$Action_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.', 'EditorInstrumentor$Action;', Lorg_waveprotocol_wave_client_editor_EditorInstrumentor$Action_2_classLit), Lorg_waveprotocol_wave_client_editor_EditorRuntimeException_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorRuntimeException'), Lorg_waveprotocol_wave_client_editor_EditorUndoManager$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorUndoManager$1'), Lorg_waveprotocol_wave_client_editor_EditorUndoManagerImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorUndoManagerImpl'), Lorg_waveprotocol_wave_client_editor_EditorUpdateEventImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorUpdateEventImpl'), Lorg_waveprotocol_wave_client_editor_EditorUpdateEventImpl$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorUpdateEventImpl$1'), Lorg_waveprotocol_wave_client_editor_ElementHandlerRegistry_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'ElementHandlerRegistry'), Lorg_waveprotocol_wave_client_editor_ElementHandlerRegistry$HandlerData_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'ElementHandlerRegistry$HandlerData'), Lorg_waveprotocol_wave_client_editor_ElementHandlerRegistry$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'ElementHandlerRegistry$1'), Lorg_waveprotocol_wave_client_editor_RenderingMutationHandler$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'RenderingMutationHandler$1'), Lorg_waveprotocol_wave_client_editor_ResponsibilityManagerImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'ResponsibilityManagerImpl'), Lorg_waveprotocol_wave_client_editor_ResponsibilityManagerImpl$SequenceType_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.', 'ResponsibilityManagerImpl$SequenceType', values_20), _3Lorg_waveprotocol_wave_client_editor_ResponsibilityManagerImpl$SequenceType_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.', 'ResponsibilityManagerImpl$SequenceType;', Lorg_waveprotocol_wave_client_editor_ResponsibilityManagerImpl$SequenceType_2_classLit), Lorg_waveprotocol_wave_client_editor_RestrictedRange_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'RestrictedRange'), Lorg_waveprotocol_wave_client_editor_UndoableSequencer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'UndoableSequencer'), Lorg_waveprotocol_wave_client_scheduler_BrowserBackedScheduler_2_classLit = createForClass('org.waveprotocol.wave.client.scheduler.', 'BrowserBackedScheduler'), Lorg_waveprotocol_wave_client_scheduler_BrowserBackedScheduler$1_2_classLit = createForClass('org.waveprotocol.wave.client.scheduler.', 'BrowserBackedScheduler$1'), Lorg_waveprotocol_wave_client_scheduler_BrowserBackedScheduler$2_2_classLit = createForClass('org.waveprotocol.wave.client.scheduler.', 'BrowserBackedScheduler$2'), Lorg_waveprotocol_wave_client_scheduler_CommandQueue$1$1_2_classLit = createForClass('org.waveprotocol.wave.client.scheduler.', 'CommandQueue$1$1'), Lorg_waveprotocol_wave_client_scheduler_DelayedJobRegistry_2_classLit = createForClass('org.waveprotocol.wave.client.scheduler.', 'DelayedJobRegistry'), Lorg_waveprotocol_wave_client_scheduler_FinalTaskRunnerImpl$1_2_classLit = createForClass('org.waveprotocol.wave.client.scheduler.', 'FinalTaskRunnerImpl$1'), Lorg_waveprotocol_wave_client_scheduler_GwtSimpleTimer_2_classLit = createForClass('org.waveprotocol.wave.client.scheduler.', 'GwtSimpleTimer'), Lorg_waveprotocol_wave_client_scheduler_GwtSimpleTimer$2_2_classLit = createForClass('org.waveprotocol.wave.client.scheduler.', 'GwtSimpleTimer$2'), Lorg_waveprotocol_wave_client_scheduler_JobRegistry_2_classLit = createForClass('org.waveprotocol.wave.client.scheduler.', 'JobRegistry'), Lorg_waveprotocol_wave_client_scheduler_Scheduler$Priority_2_classLit = createForEnum('org.waveprotocol.wave.client.scheduler.', 'Scheduler$Priority', values_37), _3Lorg_waveprotocol_wave_client_scheduler_Scheduler$Priority_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.scheduler.', 'Scheduler$Priority;', Lorg_waveprotocol_wave_client_scheduler_Scheduler$Priority_2_classLit), Lorg_waveprotocol_wave_client_scheduler_SchedulerTimerService_2_classLit = createForClass('org.waveprotocol.wave.client.scheduler.', 'SchedulerTimerService'), Lorg_waveprotocol_wave_client_scheduler_TaskInfo_2_classLit = createForClass('org.waveprotocol.wave.client.scheduler.', 'TaskInfo'), Lorg_waveprotocol_wave_client_widget_button_icon_IconButtonTemplate_2_classLit = createForClass('org.waveprotocol.wave.client.widget.button.icon.', 'IconButtonTemplate'), Lorg_waveprotocol_wave_client_widget_button_icon_IconButtonTemplate$IconButtonStyle_2_classLit = createForEnum('org.waveprotocol.wave.client.widget.button.icon.', 'IconButtonTemplate$IconButtonStyle', values_39), _3Lorg_waveprotocol_wave_client_widget_button_icon_IconButtonTemplate$IconButtonStyle_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.widget.button.icon.', 'IconButtonTemplate$IconButtonStyle;', Lorg_waveprotocol_wave_client_widget_button_icon_IconButtonTemplate$IconButtonStyle_2_classLit), Lorg_waveprotocol_wave_client_widget_button_text_TextButton_2_classLit = createForClass('org.waveprotocol.wave.client.widget.button.text.', 'TextButton'), Lorg_waveprotocol_wave_client_widget_button_text_TextButton$TextButtonStyle_2_classLit = createForEnum('org.waveprotocol.wave.client.widget.button.text.', 'TextButton$TextButtonStyle', values_40), _3Lorg_waveprotocol_wave_client_widget_button_text_TextButton$TextButtonStyle_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.widget.button.text.', 'TextButton$TextButtonStyle;', Lorg_waveprotocol_wave_client_widget_button_text_TextButton$TextButtonStyle_2_classLit), Lorg_waveprotocol_wave_client_widget_button_ButtonDisplay$ButtonState_2_classLit = createForEnum('org.waveprotocol.wave.client.widget.button.', 'ButtonDisplay$ButtonState', values_38), _3Lorg_waveprotocol_wave_client_widget_button_ButtonDisplay$ButtonState_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.widget.button.', 'ButtonDisplay$ButtonState;', Lorg_waveprotocol_wave_client_widget_button_ButtonDisplay$ButtonState_2_classLit), Lorg_waveprotocol_wave_client_widget_button_ClickButton_2_classLit = createForClass('org.waveprotocol.wave.client.widget.button.', 'ClickButton'), Lorg_waveprotocol_wave_client_widget_button_ClickButton$1_2_classLit = createForClass('org.waveprotocol.wave.client.widget.button.', 'ClickButton$1'), Lorg_waveprotocol_wave_client_widget_button_ClickButton$2_2_classLit = createForClass('org.waveprotocol.wave.client.widget.button.', 'ClickButton$2'), Lorg_waveprotocol_wave_client_widget_button_ClickButtonWidget_2_classLit = createForClass('org.waveprotocol.wave.client.widget.button.', 'ClickButtonWidget'), Lorg_waveprotocol_wave_client_widget_button_StyleAxis_2_classLit = createForClass('org.waveprotocol.wave.client.widget.button.', 'StyleAxis'), Lorg_waveprotocol_wave_client_widget_button_ToggleButton_2_classLit = createForClass('org.waveprotocol.wave.client.widget.button.', 'ToggleButton'), Lorg_waveprotocol_wave_client_widget_button_ToggleButton$1_2_classLit = createForClass('org.waveprotocol.wave.client.widget.button.', 'ToggleButton$1'), Lorg_waveprotocol_wave_client_widget_button_ToggleButton$2_2_classLit = createForClass('org.waveprotocol.wave.client.widget.button.', 'ToggleButton$2'), Lorg_waveprotocol_wave_client_widget_button_ToggleButtonWidget_2_classLit = createForClass('org.waveprotocol.wave.client.widget.button.', 'ToggleButtonWidget'), Lorg_waveprotocol_wave_client_widget_popup_simple_Popup_2_classLit = createForClass('org.waveprotocol.wave.client.widget.popup.simple.', 'Popup'), Lorg_waveprotocol_wave_client_widget_popup_simple_Popup$2_2_classLit = createForClass('org.waveprotocol.wave.client.widget.popup.simple.', 'Popup$2'), Lorg_waveprotocol_wave_client_widget_progress_ProgressWidget_1ProgressResources_1en_1InlineClientBundleGenerator$3_2_classLit = createForClass('org.waveprotocol.wave.client.widget.progress.', 'ProgressWidget_ProgressResources_en_InlineClientBundleGenerator$3'), Lorg_waveprotocol_wave_common_logging_AbstractLogger$Level_2_classLit = createForEnum('org.waveprotocol.wave.common.logging.', 'AbstractLogger$Level', values_41), _3Lorg_waveprotocol_wave_common_logging_AbstractLogger$Level_2_classLit = createForArray('[Lorg.waveprotocol.wave.common.logging.', 'AbstractLogger$Level;', Lorg_waveprotocol_wave_common_logging_AbstractLogger$Level_2_classLit), Lorg_waveprotocol_wave_common_logging_AbstractLogger$LevelLogger_2_classLit = createForClass('org.waveprotocol.wave.common.logging.', 'AbstractLogger$LevelLogger'), Lorg_waveprotocol_wave_common_logging_CircularBuffer_2_classLit = createForClass('org.waveprotocol.wave.common.logging.', 'CircularBuffer'), Lorg_waveprotocol_wave_common_logging_InMemoryLogSink_2_classLit = createForClass('org.waveprotocol.wave.common.logging.', 'InMemoryLogSink'), Lorg_waveprotocol_wave_common_logging_LogSink$1_2_classLit = createForClass('org.waveprotocol.wave.common.logging.', 'LogSink$1'), Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree$Notification_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'AnnotationTree$Notification'), Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree$OpenAnnotation_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'AnnotationTree$OpenAnnotation'), Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'AnnotationTree$1'), Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'AnnotationTree$2'), Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree$3_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'AnnotationTree$3'), Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'BasicAnnotationTree'), Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$NodeType_2_classLit = createForEnum('org.waveprotocol.wave.model.document.indexed.', 'BasicAnnotationTree$NodeType', values_47), _3Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$NodeType_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.indexed.', 'BasicAnnotationTree$NodeType;', Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$NodeType_2_classLit), Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$Node_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'BasicAnnotationTree$Node'), Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$Node$3_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'BasicAnnotationTree$Node$3'), Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'BasicAnnotationTree$1'), Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'BasicAnnotationTree$2'), Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$3_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'BasicAnnotationTree$3'), Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$6_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'BasicAnnotationTree$6'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$InvertibleCursor_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$InvertibleCursor'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$NonInvertibleCursor'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$NonInvertibleCursor$1'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$NonInvertibleCursor$2'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$3_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$NonInvertibleCursor$3'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$4_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$NonInvertibleCursor$4'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$5_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$NonInvertibleCursor$5'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$6_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$NonInvertibleCursor$6'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$7_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$NonInvertibleCursor$7'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$8_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$NonInvertibleCursor$8'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$9_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$NonInvertibleCursor$9'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$1'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$2'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$3_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$3'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$4_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$4'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$5_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$5'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$6_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$6'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$7_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$7'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$8_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$8'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$8$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$8$1'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$9_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$9'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$9$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$9$1'), Lorg_waveprotocol_wave_model_document_indexed_RawAnnotationSet$AnnotationEvent_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'RawAnnotationSet$AnnotationEvent'), Lorg_waveprotocol_wave_model_document_indexed_RawAnnotationSet$AnnotationStartEvent_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'RawAnnotationSet$AnnotationStartEvent'), Lorg_waveprotocol_wave_model_document_indexed_RawAnnotationSet$AnnotationEndEvent_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'RawAnnotationSet$AnnotationEndEvent'), Lorg_waveprotocol_wave_model_document_indexed_StubModifiableAnnotations_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'StubModifiableAnnotations'), Lorg_waveprotocol_wave_model_document_operation_algorithm_AnnotationsNormalizer_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'AnnotationsNormalizer'), Lorg_waveprotocol_wave_model_document_operation_algorithm_AnnotationsNormalizer$AnnotationChange_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'AnnotationsNormalizer$AnnotationChange'), Lorg_waveprotocol_wave_model_document_operation_algorithm_AnnotationsNormalizer$AnnotationChangeValues_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'AnnotationsNormalizer$AnnotationChangeValues'), Lorg_waveprotocol_wave_model_document_operation_algorithm_AnnotationsNormalizer$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'AnnotationsNormalizer$1'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$AnnotationQueue_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$AnnotationQueue'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$ComposeException_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$ComposeException'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$Target_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$Target'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$PreTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$PreTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$PostTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$PostTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$DefaultPreTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$DefaultPreTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$RetainPreTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$RetainPreTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$DeleteCharactersPreTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$DeleteCharactersPreTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$RetainPostTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$RetainPostTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$CharactersPostTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$CharactersPostTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$ElementStartPostTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$ElementStartPostTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$ElementEndPostTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$ElementEndPostTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$ReplaceAttributesPostTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$ReplaceAttributesPostTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$UpdateAttributesPostTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$UpdateAttributesPostTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$FinisherPostTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$FinisherPostTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$1'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$2'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Decomposer$Target_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Decomposer$Target'), Lorg_waveprotocol_wave_model_document_operation_algorithm_DocOpCollector_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'DocOpCollector'), Lorg_waveprotocol_wave_model_document_operation_algorithm_DocOpInverter_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'DocOpInverter'), Lorg_waveprotocol_wave_model_document_operation_algorithm_DocOpInverter$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'DocOpInverter$1'), Lorg_waveprotocol_wave_model_document_operation_algorithm_InsertionNoninsertionTransformer$RangeCache_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'InsertionNoninsertionTransformer$RangeCache'), Lorg_waveprotocol_wave_model_document_operation_algorithm_InsertionNoninsertionTransformer$Target_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'InsertionNoninsertionTransformer$Target'), Lorg_waveprotocol_wave_model_document_operation_algorithm_InsertionNoninsertionTransformer$InsertionTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'InsertionNoninsertionTransformer$InsertionTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_InsertionNoninsertionTransformer$NoninsertionTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'InsertionNoninsertionTransformer$NoninsertionTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_InsertionNoninsertionTransformer$NoninsertionTarget$DeleteCharactersCache_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'InsertionNoninsertionTransformer$NoninsertionTarget$DeleteCharactersCache'), Lorg_waveprotocol_wave_model_document_operation_algorithm_InsertionNoninsertionTransformer$NoninsertionTarget$DeleteElementStartCache_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'InsertionNoninsertionTransformer$NoninsertionTarget$DeleteElementStartCache'), Lorg_waveprotocol_wave_model_document_operation_algorithm_InsertionNoninsertionTransformer$NoninsertionTarget$ReplaceAttributesCache_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'InsertionNoninsertionTransformer$NoninsertionTarget$ReplaceAttributesCache'), Lorg_waveprotocol_wave_model_document_operation_algorithm_InsertionNoninsertionTransformer$NoninsertionTarget$UpdateAttributesCache_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'InsertionNoninsertionTransformer$NoninsertionTarget$UpdateAttributesCache'), Lorg_waveprotocol_wave_model_document_operation_algorithm_InsertionNoninsertionTransformer$NoninsertionTarget$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'InsertionNoninsertionTransformer$NoninsertionTarget$1'), Lorg_waveprotocol_wave_model_document_operation_algorithm_InsertionNoninsertionTransformer$NoninsertionTarget$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'InsertionNoninsertionTransformer$NoninsertionTarget$2'), Lorg_waveprotocol_wave_model_document_operation_algorithm_InsertionTransformer$Target_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'InsertionTransformer$Target'), Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'NoninsertionTransformer'), Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$InternalTransformException_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'NoninsertionTransformer$InternalTransformException'), Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$AnnotationTracker_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'NoninsertionTransformer$AnnotationTracker'), Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$RangeCache_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'NoninsertionTransformer$RangeCache'), Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$DeleteCharactersResolver_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'NoninsertionTransformer$DeleteCharactersResolver'), Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$DeleteElementStartResolver_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'NoninsertionTransformer$DeleteElementStartResolver'), Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$ReplaceAttributesResolver_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'NoninsertionTransformer$ReplaceAttributesResolver'), Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$UpdateAttributesResolver_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'NoninsertionTransformer$UpdateAttributesResolver'), Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$Target_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'NoninsertionTransformer$Target'), Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$Target$DeleteCharactersCache_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'NoninsertionTransformer$Target$DeleteCharactersCache'), Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$Target$DeleteElementStartCache_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'NoninsertionTransformer$Target$DeleteElementStartCache'), Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$Target$DeleteElementEndCache_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'NoninsertionTransformer$Target$DeleteElementEndCache'), Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$Target$ReplaceAttributesCache_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'NoninsertionTransformer$Target$ReplaceAttributesCache'), Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$Target$UpdateAttributesCache_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'NoninsertionTransformer$Target$UpdateAttributesCache'), Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$Target$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'NoninsertionTransformer$Target$1'), Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'NoninsertionTransformer$1'), Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'NoninsertionTransformer$2'), Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$3_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'NoninsertionTransformer$3'), Lorg_waveprotocol_wave_model_document_operation_algorithm_NoninsertionTransformer$4_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'NoninsertionTransformer$4'), Lorg_waveprotocol_wave_model_document_operation_algorithm_PositionTracker_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'PositionTracker'), Lorg_waveprotocol_wave_model_document_operation_algorithm_PositionTracker$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'PositionTracker$1'), Lorg_waveprotocol_wave_model_document_operation_algorithm_PositionTracker$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'PositionTracker$2'), Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'RangeNormalizer'), Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer$Cache_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'RangeNormalizer$Cache'), Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'RangeNormalizer$1'), Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'RangeNormalizer$2'), Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer$3_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'RangeNormalizer$3'), Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer$4_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'RangeNormalizer$4'), Lorg_waveprotocol_wave_model_document_operation_algorithm_ValueUpdate_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'ValueUpdate'), Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton'), Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$ValidationResult_2_classLit = createForEnum('org.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton$ValidationResult', values_50), _3Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$ValidationResult_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton$ValidationResult;', Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$ValidationResult_2_classLit), Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$Violation_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton$Violation'), Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$OperationIllFormed_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton$OperationIllFormed'), Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$OperationInvalid_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton$OperationInvalid'), Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$SchemaViolation_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton$SchemaViolation'), Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$ViolationCollector_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton$ViolationCollector'), Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$DocSymbol_2_classLit = createForEnum('org.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton$DocSymbol', values_49), _3Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$DocSymbol_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton$DocSymbol;', Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$DocSymbol_2_classLit), Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$InsertStart_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton$InsertStart'), Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton$1'), Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters_2_classLit = createForEnum('org.waveprotocol.wave.model.document.operation.automaton.', 'DocumentSchema$PermittedCharacters', values_51), _3Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.operation.automaton.', 'DocumentSchema$PermittedCharacters;', Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters_2_classLit), Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters$1_2_classLit = createForEnum('org.waveprotocol.wave.model.document.operation.automaton.', 'DocumentSchema$PermittedCharacters$1', null), Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters$2_2_classLit = createForEnum('org.waveprotocol.wave.model.document.operation.automaton.', 'DocumentSchema$PermittedCharacters$2', null), Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters$2$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.automaton.', 'DocumentSchema$PermittedCharacters$2$1'), Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters$3_2_classLit = createForEnum('org.waveprotocol.wave.model.document.operation.automaton.', 'DocumentSchema$PermittedCharacters$3', null), Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters$3$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.automaton.', 'DocumentSchema$PermittedCharacters$3$1'), Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.automaton.', 'DocumentSchema$1'), Lorg_waveprotocol_wave_model_document_operation_impl_AbstractDocInitialization_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'AbstractDocInitialization'), Lorg_waveprotocol_wave_model_document_operation_impl_AbstractBufferedDocInitialization_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'AbstractBufferedDocInitialization'), Lorg_waveprotocol_wave_model_document_operation_impl_AnnotationBoundaryMapImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'AnnotationBoundaryMapImpl'), Lorg_waveprotocol_wave_model_document_operation_impl_AnnotationBoundaryMapImpl$Builder_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'AnnotationBoundaryMapImpl$Builder'), Lorg_waveprotocol_wave_model_document_operation_util_ImmutableStateMap_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.util.', 'ImmutableStateMap'), Lorg_waveprotocol_wave_model_document_operation_impl_AnnotationMapImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'AnnotationMapImpl'), Lorg_waveprotocol_wave_model_document_operation_util_ImmutableUpdateMap_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.util.', 'ImmutableUpdateMap'), Lorg_waveprotocol_wave_model_document_operation_impl_AnnotationsUpdateImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'AnnotationsUpdateImpl'), Lorg_waveprotocol_wave_model_document_operation_impl_AttributesImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'AttributesImpl'), Lorg_waveprotocol_wave_model_document_operation_impl_AttributesImpl$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'AttributesImpl$1'), Lorg_waveprotocol_wave_model_document_operation_impl_AttributesUpdateImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'AttributesUpdateImpl'), Lorg_waveprotocol_wave_model_document_operation_impl_BufferedDocOpImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'BufferedDocOpImpl'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DocOpComponent_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$DocOpComponent'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DocInitializationComponent_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$DocInitializationComponent'), _3Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DocInitializationComponent_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$DocInitializationComponent;', Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DocInitializationComponent_2_classLit), Lorg_waveprotocol_wave_model_document_operation_impl_DocInitializationBuilder_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'DocInitializationBuilder'), Lorg_waveprotocol_wave_model_document_operation_impl_UncheckedDocOpBuffer_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'UncheckedDocOpBuffer'), Lorg_waveprotocol_wave_model_document_operation_impl_DocOpBuffer_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'DocOpBuffer'), _3Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DocOpComponent_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$DocOpComponent;', Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DocOpComponent_2_classLit), Lorg_waveprotocol_wave_model_document_operation_impl_DocOpBuilder_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'DocOpBuilder'), Lorg_waveprotocol_wave_model_document_operation_impl_DocOpUtil$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'DocOpUtil$1'), Lorg_waveprotocol_wave_model_document_operation_impl_DocOpUtil$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'DocOpUtil$2'), Lorg_waveprotocol_wave_model_document_operation_impl_DocOpUtil$3_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'DocOpUtil$3'), Lorg_waveprotocol_wave_model_document_operation_impl_DocOpUtil$4_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'DocOpUtil$4'), Lorg_waveprotocol_wave_model_document_operation_impl_DocOpUtil$5_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'DocOpUtil$5'), Lorg_waveprotocol_wave_model_document_operation_impl_DocOpValidator$IllFormed_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'DocOpValidator$IllFormed'), Lorg_waveprotocol_wave_model_document_operation_impl_DocOpValidator$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'DocOpValidator$1'), Lorg_waveprotocol_wave_model_document_operation_impl_InitializationCursorAdapter_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'InitializationCursorAdapter'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$AnnotationBoundary_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$AnnotationBoundary'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$Characters_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$Characters'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$ElementStart_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$ElementStart'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$ElementEnd_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$ElementEnd'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$Retain_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$Retain'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DeleteCharacters_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$DeleteCharacters'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DeleteElementStart_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$DeleteElementStart'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DeleteElementEnd_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$DeleteElementEnd'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$ReplaceAttributes_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$ReplaceAttributes'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$UpdateAttributes_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$UpdateAttributes'), Lorg_waveprotocol_wave_model_document_operation_util_ImmutableStateMap$Attribute_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.util.', 'ImmutableStateMap$Attribute'), Lorg_waveprotocol_wave_model_document_operation_util_ImmutableStateMap$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.util.', 'ImmutableStateMap$1'), Lorg_waveprotocol_wave_model_document_operation_util_ImmutableStateMap$1$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.util.', 'ImmutableStateMap$1$1'), Lorg_waveprotocol_wave_model_document_operation_util_ImmutableStateMap$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.util.', 'ImmutableStateMap$2'), Lorg_waveprotocol_wave_model_document_operation_util_ImmutableUpdateMap$AttributeUpdate_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.util.', 'ImmutableUpdateMap$AttributeUpdate'), Lorg_waveprotocol_wave_model_document_operation_util_ImmutableUpdateMap$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.util.', 'ImmutableUpdateMap$1'), Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$Triplet_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'AnnotationBoundaryMapBuilder$Triplet'), _3Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$Triplet_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.operation.', 'AnnotationBoundaryMapBuilder$Triplet;', Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$Triplet_2_classLit), Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'AnnotationBoundaryMapBuilder'), Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$AnnotationBoundaryMapImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'AnnotationBoundaryMapBuilder$AnnotationBoundaryMapImpl'), Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'AnnotationBoundaryMapBuilder$1'), Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'AnnotationBoundaryMapBuilder$2'), Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$3_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'AnnotationBoundaryMapBuilder$3'), Lorg_waveprotocol_wave_model_document_operation_Automatons$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Automatons$1'), Lorg_waveprotocol_wave_model_document_operation_Automatons$1$1AnnoMap_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Automatons$1$1AnnoMap'), Lorg_waveprotocol_wave_model_document_operation_Automatons$1$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Automatons$1$1'), Lorg_waveprotocol_wave_model_document_operation_LocationModifier_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'LocationModifier'), Lorg_waveprotocol_wave_model_document_operation_Nindo_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo'), Lorg_waveprotocol_wave_model_document_operation_Nindo$Builder_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$Builder'), Lorg_waveprotocol_wave_model_document_operation_Nindo$MutationComponent_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$MutationComponent'), Lorg_waveprotocol_wave_model_document_operation_Nindo$Skip_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$Skip'), Lorg_waveprotocol_wave_model_document_operation_Nindo$Characters_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$Characters'), Lorg_waveprotocol_wave_model_document_operation_Nindo$ElementStart_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$ElementStart'), Lorg_waveprotocol_wave_model_document_operation_Nindo$ElementEnd_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$ElementEnd'), Lorg_waveprotocol_wave_model_document_operation_Nindo$DeleteCharacters_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$DeleteCharacters'), Lorg_waveprotocol_wave_model_document_operation_Nindo$DeleteElementStart_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$DeleteElementStart'), Lorg_waveprotocol_wave_model_document_operation_Nindo$DeleteElementEnd_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$DeleteElementEnd'), Lorg_waveprotocol_wave_model_document_operation_Nindo$ReplaceAttributes_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$ReplaceAttributes'), Lorg_waveprotocol_wave_model_document_operation_Nindo$UpdateAttributes_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$UpdateAttributes'), Lorg_waveprotocol_wave_model_document_operation_Nindo$StartAnnotation_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$StartAnnotation'), Lorg_waveprotocol_wave_model_document_operation_Nindo$EndAnnotation_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$EndAnnotation'), Lorg_waveprotocol_wave_model_document_operation_Nindo$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$1'), Lorg_waveprotocol_wave_model_document_operation_Nindo$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$2'), Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'NindoAutomaton'), Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton$DocSymbol_2_classLit = createForEnum('org.waveprotocol.wave.model.document.operation.', 'NindoAutomaton$DocSymbol', values_48), _3Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton$DocSymbol_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.operation.', 'NindoAutomaton$DocSymbol;', Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton$DocSymbol_2_classLit), Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton$StackEntry_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'NindoAutomaton$StackEntry'), Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton$InsertElement_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'NindoAutomaton$InsertElement'), Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton$DeleteElement_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'NindoAutomaton$DeleteElement'), Lorg_waveprotocol_wave_model_document_operation_NindoValidator$IllFormed_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'NindoValidator$IllFormed'), Lorg_waveprotocol_wave_model_document_operation_NindoValidator$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'NindoValidator$1'), Lorg_waveprotocol_wave_model_document_parser_AnnotationParser_2_classLit = createForClass('org.waveprotocol.wave.model.document.parser.', 'AnnotationParser'), Lorg_waveprotocol_wave_model_document_parser_Item_2_classLit = createForClass('org.waveprotocol.wave.model.document.parser.', 'Item'), Lorg_waveprotocol_wave_model_document_parser_ItemType_2_classLit = createForEnum('org.waveprotocol.wave.model.document.parser.', 'ItemType', values_52), _3Lorg_waveprotocol_wave_model_document_parser_ItemType_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.parser.', 'ItemType;', Lorg_waveprotocol_wave_model_document_parser_ItemType_2_classLit), Lorg_waveprotocol_wave_model_document_parser_StreamingXmlParser_2_classLit = createForClass('org.waveprotocol.wave.model.document.parser.', 'StreamingXmlParser'), Lorg_waveprotocol_wave_model_document_parser_StreamingXmlParser$Buffer_2_classLit = createForClass('org.waveprotocol.wave.model.document.parser.', 'StreamingXmlParser$Buffer'), Lorg_waveprotocol_wave_model_document_parser_XmlParseException_2_classLit = createForClass('org.waveprotocol.wave.model.document.parser.', 'XmlParseException'), Lorg_waveprotocol_wave_model_document_raw_impl_Node_2_classLit = createForClass('org.waveprotocol.wave.model.document.raw.impl.', 'Node'), Lorg_waveprotocol_wave_model_document_raw_impl_Element_2_classLit = createForClass('org.waveprotocol.wave.model.document.raw.impl.', 'Element'), Lorg_waveprotocol_wave_model_document_raw_impl_RawDocumentImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.raw.impl.', 'RawDocumentImpl'), Lorg_waveprotocol_wave_model_document_raw_impl_Text_2_classLit = createForClass('org.waveprotocol.wave.model.document.raw.impl.', 'Text'), Lorg_waveprotocol_wave_model_document_util_AnnotationIntervalImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'AnnotationIntervalImpl'), Lorg_waveprotocol_wave_model_document_util_AnnotationIntervalImpl$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'AnnotationIntervalImpl$1'), Lorg_waveprotocol_wave_model_document_util_AnnotationRegistryImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'AnnotationRegistryImpl'), Lorg_waveprotocol_wave_model_document_util_AnnotationRegistryImpl$HandlerData_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'AnnotationRegistryImpl$HandlerData'), Lorg_waveprotocol_wave_model_document_util_AnnotationRegistryImpl$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'AnnotationRegistryImpl$1'), Lorg_waveprotocol_wave_model_document_util_AnnotationRegistryImpl$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'AnnotationRegistryImpl$2'), Lorg_waveprotocol_wave_model_document_util_AnnotationRegistryImpl$3_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'AnnotationRegistryImpl$3'), Lorg_waveprotocol_wave_model_document_util_DocHelper$NodeOffset_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DocHelper$NodeOffset'), Lorg_waveprotocol_wave_model_document_util_DocIterate$DeepIteratorFilter_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DocIterate$DeepIteratorFilter'), Lorg_waveprotocol_wave_model_document_util_DocIterate$ElementFilter_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DocIterate$ElementFilter'), Lorg_waveprotocol_wave_model_document_util_DocIterate$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DocIterate$1'), Lorg_waveprotocol_wave_model_document_util_DocIterate$1$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DocIterate$1$1'), Lorg_waveprotocol_wave_model_document_util_DocOpScrub$UncheckedAnnotationBoundary$Triplet_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DocOpScrub$UncheckedAnnotationBoundary$Triplet'), _3Lorg_waveprotocol_wave_model_document_util_DocOpScrub$UncheckedAnnotationBoundary$Triplet_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.util.', 'DocOpScrub$UncheckedAnnotationBoundary$Triplet;', Lorg_waveprotocol_wave_model_document_util_DocOpScrub$UncheckedAnnotationBoundary$Triplet_2_classLit), Lorg_waveprotocol_wave_model_document_util_DocOpScrub$UncheckedAnnotationBoundary_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DocOpScrub$UncheckedAnnotationBoundary'), Lorg_waveprotocol_wave_model_document_util_DocOpScrub$ScrubCache_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DocOpScrub$ScrubCache'), Lorg_waveprotocol_wave_model_document_util_DocOpScrub$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DocOpScrub$1'), Lorg_waveprotocol_wave_model_document_util_DocOpScrub$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DocOpScrub$2'), Lorg_waveprotocol_wave_model_document_util_DocOpScrub$3_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DocOpScrub$3'), Lorg_waveprotocol_wave_model_document_util_FilteredView$Skip_2_classLit = createForEnum('org.waveprotocol.wave.model.document.util.', 'FilteredView$Skip', values_53), _3Lorg_waveprotocol_wave_model_document_util_FilteredView$Skip_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.util.', 'FilteredView$Skip;', Lorg_waveprotocol_wave_model_document_util_FilteredView$Skip_2_classLit), Lorg_waveprotocol_wave_model_document_util_FilterProduct_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'FilterProduct'), Lorg_waveprotocol_wave_model_document_util_FocusedRange_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'FocusedRange'), Lorg_waveprotocol_wave_model_document_util_GenericAnnotationCursor_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'GenericAnnotationCursor'), Lorg_waveprotocol_wave_model_document_util_GenericAnnotationCursor$KeyLocation_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'GenericAnnotationCursor$KeyLocation'), Lorg_waveprotocol_wave_model_document_util_GenericAnnotationCursor$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'GenericAnnotationCursor$1'), Lorg_waveprotocol_wave_model_document_util_GenericAnnotationIntervalIterable_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'GenericAnnotationIntervalIterable'), Lorg_waveprotocol_wave_model_document_util_GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator'), Lorg_waveprotocol_wave_model_document_util_GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$KeyEntry_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$KeyEntry'), Lorg_waveprotocol_wave_model_document_util_GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$1'), Lorg_waveprotocol_wave_model_document_util_GenericRangedAnnotationIterable_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'GenericRangedAnnotationIterable'), Lorg_waveprotocol_wave_model_document_util_GenericRangedAnnotationIterable$GenericRangedAnnotationIterator_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'GenericRangedAnnotationIterable$GenericRangedAnnotationIterator'), Lorg_waveprotocol_wave_model_document_util_GenericRangedAnnotationIterable$GenericRangedAnnotationIterator$KeyEntry_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'GenericRangedAnnotationIterable$GenericRangedAnnotationIterator$KeyEntry'), Lorg_waveprotocol_wave_model_document_util_GenericRangedAnnotationIterable$GenericRangedAnnotationIterator$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'GenericRangedAnnotationIterable$GenericRangedAnnotationIterator$1'), Lorg_waveprotocol_wave_model_document_util_LineContainers$Rounding_2_classLit = createForEnum('org.waveprotocol.wave.model.document.util.', 'LineContainers$Rounding', values_55), _3Lorg_waveprotocol_wave_model_document_util_LineContainers$Rounding_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.util.', 'LineContainers$Rounding;', Lorg_waveprotocol_wave_model_document_util_LineContainers$Rounding_2_classLit), Lorg_waveprotocol_wave_model_document_util_LineContainers$RoundDirection_2_classLit = createForEnum('org.waveprotocol.wave.model.document.util.', 'LineContainers$RoundDirection', values_54), _3Lorg_waveprotocol_wave_model_document_util_LineContainers$RoundDirection_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.util.', 'LineContainers$RoundDirection;', Lorg_waveprotocol_wave_model_document_util_LineContainers$RoundDirection_2_classLit), Lorg_waveprotocol_wave_model_document_util_PersistentContent$HardContent_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'PersistentContent$HardContent'), Lorg_waveprotocol_wave_model_document_util_Point_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'Point'), Lorg_waveprotocol_wave_model_document_util_Point$El_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'Point$El'), Lorg_waveprotocol_wave_model_document_util_Point$Tx_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'Point$Tx'), Lorg_waveprotocol_wave_model_document_util_Pretty_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'Pretty'), Lorg_waveprotocol_wave_model_document_util_Property_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'Property'), Lorg_waveprotocol_wave_model_document_util_Property$ImmutableProperty_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'Property$ImmutableProperty'), Lorg_waveprotocol_wave_model_document_util_Property$MutableProperty_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'Property$MutableProperty'), Lorg_waveprotocol_wave_model_document_util_Range_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'Range'), Lorg_waveprotocol_wave_model_document_util_RangeTracker_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'RangeTracker'), Lorg_waveprotocol_wave_model_document_util_RangedAnnotationImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'RangedAnnotationImpl'), Lorg_waveprotocol_wave_model_document_util_ReadableTreeWalker_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'ReadableTreeWalker'), Lorg_waveprotocol_wave_model_document_util_XmlStringBuilder_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'XmlStringBuilder'), Lorg_waveprotocol_wave_model_document_util_XmlStringBuilder$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'XmlStringBuilder$1'), Lorg_waveprotocol_wave_model_document_util_XmlStringBuilderDoc_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'XmlStringBuilderDoc'), Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$CursorDirection_2_classLit = createForEnum('org.waveprotocol.wave.model.document.', 'AnnotationBehaviour$CursorDirection', values_45), _3Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$CursorDirection_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.', 'AnnotationBehaviour$CursorDirection;', Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$CursorDirection_2_classLit), Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$BiasDirection_2_classLit = createForEnum('org.waveprotocol.wave.model.document.', 'AnnotationBehaviour$BiasDirection', values_43), _3Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$BiasDirection_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.', 'AnnotationBehaviour$BiasDirection;', Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$BiasDirection_2_classLit), Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$InheritDirection_2_classLit = createForEnum('org.waveprotocol.wave.model.document.', 'AnnotationBehaviour$InheritDirection', values_46), _3Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$InheritDirection_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.', 'AnnotationBehaviour$InheritDirection;', Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$InheritDirection_2_classLit), Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$ContentType_2_classLit = createForEnum('org.waveprotocol.wave.model.document.', 'AnnotationBehaviour$ContentType', values_44), _3Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$ContentType_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.', 'AnnotationBehaviour$ContentType;', Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$ContentType_2_classLit), Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$AnnotationFamily_2_classLit = createForEnum('org.waveprotocol.wave.model.document.', 'AnnotationBehaviour$AnnotationFamily', values_42), _3Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$AnnotationFamily_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.', 'AnnotationBehaviour$AnnotationFamily;', Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$AnnotationFamily_2_classLit), Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.', 'AnnotationBehaviour$1'), Lorg_waveprotocol_wave_model_id_InvalidIdException_2_classLit = createForClass('org.waveprotocol.wave.model.id.', 'InvalidIdException'), Lorg_waveprotocol_wave_model_id_SimplePrefixEscaper_2_classLit = createForClass('org.waveprotocol.wave.model.id.', 'SimplePrefixEscaper'), Lorg_waveprotocol_wave_model_id_WaveId_2_classLit = createForClass('org.waveprotocol.wave.model.id.', 'WaveId'), Lorg_waveprotocol_wave_model_id_WaveIdentifiers$1_2_classLit = createForClass('org.waveprotocol.wave.model.id.', 'WaveIdentifiers$1'), Lorg_waveprotocol_wave_model_id_WaveletId_2_classLit = createForClass('org.waveprotocol.wave.model.id.', 'WaveletId'), Lorg_waveprotocol_wave_model_operation_OpCursorException_2_classLit = createForClass('org.waveprotocol.wave.model.operation.', 'OpCursorException'), Lorg_waveprotocol_wave_model_operation_OperationException_2_classLit = createForClass('org.waveprotocol.wave.model.operation.', 'OperationException'), Lorg_waveprotocol_wave_model_operation_OperationPair_2_classLit = createForClass('org.waveprotocol.wave.model.operation.', 'OperationPair'), Lorg_waveprotocol_wave_model_operation_OperationRuntimeException_2_classLit = createForClass('org.waveprotocol.wave.model.operation.', 'OperationRuntimeException'), Lorg_waveprotocol_wave_model_operation_SilentOperationSink$1_2_classLit = createForClass('org.waveprotocol.wave.model.operation.', 'SilentOperationSink$1'), Lorg_waveprotocol_wave_model_operation_TransformException_2_classLit = createForClass('org.waveprotocol.wave.model.operation.', 'TransformException'), Lorg_waveprotocol_wave_model_richtext_RichTextMutationBuilder_2_classLit = createForClass('org.waveprotocol.wave.model.richtext.', 'RichTextMutationBuilder'), Lorg_waveprotocol_wave_model_richtext_RichTextTokenizer$Type_2_classLit = createForEnum('org.waveprotocol.wave.model.richtext.', 'RichTextTokenizer$Type', values_56), _3Lorg_waveprotocol_wave_model_richtext_RichTextTokenizer$Type_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.richtext.', 'RichTextTokenizer$Type;', Lorg_waveprotocol_wave_model_richtext_RichTextTokenizer$Type_2_classLit), Lorg_waveprotocol_wave_model_richtext_RichTextTokenizer$Type$TypeGroup_2_classLit = createForEnum('org.waveprotocol.wave.model.richtext.', 'RichTextTokenizer$Type$TypeGroup', values_57), _3Lorg_waveprotocol_wave_model_richtext_RichTextTokenizer$Type$TypeGroup_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.richtext.', 'RichTextTokenizer$Type$TypeGroup;', Lorg_waveprotocol_wave_model_richtext_RichTextTokenizer$Type$TypeGroup_2_classLit), Lorg_waveprotocol_wave_model_richtext_RichTextTokenizerImpl_2_classLit = createForClass('org.waveprotocol.wave.model.richtext.', 'RichTextTokenizerImpl'), Lorg_waveprotocol_wave_model_richtext_RichTextTokenizerImpl$Token_2_classLit = createForClass('org.waveprotocol.wave.model.richtext.', 'RichTextTokenizerImpl$Token'), Lorg_waveprotocol_wave_model_richtext_RichTextTokenizerImpl$StyleTokenExtractor_2_classLit = createForClass('org.waveprotocol.wave.model.richtext.', 'RichTextTokenizerImpl$StyleTokenExtractor'), Lorg_waveprotocol_wave_model_schema_AbstractXmlSchemaConstraints_2_classLit = createForClass('org.waveprotocol.wave.model.schema.', 'AbstractXmlSchemaConstraints'), Lorg_waveprotocol_wave_model_schema_conversation_ConversationSchemas$DefaultDocumentSchema_2_classLit = createForClass('org.waveprotocol.wave.model.schema.conversation.', 'ConversationSchemas$DefaultDocumentSchema'), Lorg_waveprotocol_wave_model_schema_conversation_ConversationSchemas$1_2_classLit = createForClass('org.waveprotocol.wave.model.schema.conversation.', 'ConversationSchemas$1'), Lorg_waveprotocol_wave_model_undo_UndoManagerImpl_2_classLit = createForClass('org.waveprotocol.wave.model.undo.', 'UndoManagerImpl'), Lorg_waveprotocol_wave_model_undo_UndoManagerImpl$Checkpointer_2_classLit = createForClass('org.waveprotocol.wave.model.undo.', 'UndoManagerImpl$Checkpointer'), Lorg_waveprotocol_wave_model_undo_UndoStack_2_classLit = createForClass('org.waveprotocol.wave.model.undo.', 'UndoStack'), Lorg_waveprotocol_wave_model_undo_UndoStack$StackEntry_2_classLit = createForClass('org.waveprotocol.wave.model.undo.', 'UndoStack$StackEntry'), Lorg_waveprotocol_wave_model_util_Box_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'Box'), Lorg_waveprotocol_wave_model_util_ChainedData_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'ChainedData'), Lorg_waveprotocol_wave_model_util_CollectionUtils$StringMapAdapter_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'CollectionUtils$StringMapAdapter'), Lorg_waveprotocol_wave_model_util_CollectionUtils$NumberMapAdapter_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'CollectionUtils$NumberMapAdapter'), Lorg_waveprotocol_wave_model_util_CollectionUtils$IntMapAdapter_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'CollectionUtils$IntMapAdapter'), Lorg_waveprotocol_wave_model_util_CollectionUtils$StringSetAdapter_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'CollectionUtils$StringSetAdapter'), Lorg_waveprotocol_wave_model_util_CollectionUtils$IdentitySetAdapter_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'CollectionUtils$IdentitySetAdapter'), Lorg_waveprotocol_wave_model_util_CollectionUtils$NumberPriorityQueueAdapter_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'CollectionUtils$NumberPriorityQueueAdapter'), Lorg_waveprotocol_wave_model_util_CollectionUtils$IdentityHashMapAdapter_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'CollectionUtils$IdentityHashMapAdapter'), Lorg_waveprotocol_wave_model_util_CollectionUtils$EmptyStringMap_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'CollectionUtils$EmptyStringMap'), Lorg_waveprotocol_wave_model_util_CollectionUtils$6_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'CollectionUtils$6'), Lorg_waveprotocol_wave_model_util_ConcurrentSet_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'ConcurrentSet'), Lorg_waveprotocol_wave_model_util_CopyOnWriteSet_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'CopyOnWriteSet'), Lorg_waveprotocol_wave_model_util_CopyOnWriteSet$1_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'CopyOnWriteSet$1'), Lorg_waveprotocol_wave_model_util_CopyOnWriteSet$2_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'CopyOnWriteSet$2'), Lorg_waveprotocol_wave_model_util_EvaluableOffsetList_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'EvaluableOffsetList'), Lorg_waveprotocol_wave_model_util_EvaluableOffsetList$Node_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'EvaluableOffsetList$Node'), Lorg_waveprotocol_wave_model_util_EvaluableOffsetList$1_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'EvaluableOffsetList$1'), Lorg_waveprotocol_wave_model_util_Pair_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'Pair'), Lorg_waveprotocol_wave_model_util_Utf16Util$BlipCodePointResult_2_classLit = createForEnum('org.waveprotocol.wave.model.util.', 'Utf16Util$BlipCodePointResult', values_58), _3Lorg_waveprotocol_wave_model_util_Utf16Util$BlipCodePointResult_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.util.', 'Utf16Util$BlipCodePointResult;', Lorg_waveprotocol_wave_model_util_Utf16Util$BlipCodePointResult_2_classLit), Lorg_waveprotocol_wave_model_util_Utf16Util$2_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'Utf16Util$2'), Lorg_waveprotocol_wave_model_util_Utf16Util$3_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'Utf16Util$3'), Lorg_waveprotocol_wave_model_util_Utf16Util$5_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'Utf16Util$5'), Lorg_waveprotocol_wave_model_waveref_InvalidWaveRefException_2_classLit = createForClass('org.waveprotocol.wave.model.waveref.', 'InvalidWaveRefException'), Lorg_waveprotocol_wave_model_waveref_WaveRef_2_classLit = createForClass('org.waveprotocol.wave.model.waveref.', 'WaveRef'), Lorg_waveprotocol_wave_model_waveref_WaverefEncoder$EscaperType_2_classLit = createForEnum('org.waveprotocol.wave.model.waveref.', 'WaverefEncoder$EscaperType', values_59), _3Lorg_waveprotocol_wave_model_waveref_WaverefEncoder$EscaperType_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.waveref.', 'WaverefEncoder$EscaperType;', Lorg_waveprotocol_wave_model_waveref_WaverefEncoder$EscaperType_2_classLit), Lorg_waveprotocol_wave_util_escapers_UnicodeEscaper_2_classLit = createForClass('org.waveprotocol.wave.util.escapers.', 'UnicodeEscaper'), Lorg_waveprotocol_wave_util_escapers_PercentEscaper_2_classLit = createForClass('org.waveprotocol.wave.util.escapers.', 'PercentEscaper'), _3Lcom_google_gwt_core_client_JavaScriptObject_2_classLit = createForArray('[Lcom.google.gwt.core.client.', 'JavaScriptObject$;', Lcom_google_gwt_core_client_JavaScriptObject_2_classLit);
$stats && $stats({moduleName:'org.waveprotocol.wave.client.editor.harness.EditorTest',sessionId:$sessionId,subSystem:'startup',evtGroup:'moduleStartup',millis:(new Date()).getTime(),type:'moduleEvalEnd'});
if ($wnd.org_waveprotocol_wave_client_editor_harness_EditorTest) $wnd.org_waveprotocol_wave_client_editor_harness_EditorTest.onScriptLoad();
--></script></body></html>
