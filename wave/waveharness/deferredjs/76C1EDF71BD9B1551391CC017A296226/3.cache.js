function $appendTo(this$static, appendable, parts){
  checkNotNull(appendable);
  if (parts.i < parts.this$0_0.size_1()) {
    $append_12(appendable, $toString_0($next_4(parts)));
    while (parts.i < parts.this$0_0.size_1()) {
      $append_12(appendable, this$static.separator);
      $append_12(appendable, $toString_0($next_4(parts)));
    }
  }
  return appendable;
}

function $appendTo_0(this$static, builder, parts){
  $appendTo(this$static, builder, parts);
  return builder;
}

function $join(this$static, parts){
  return $appendTo_0(this$static, new StringBuilder_0, parts).impl.string;
}

function $toString_0(part){
  checkNotNull(part);
  return part != null && part.castableTypeMap$ && !!part.castableTypeMap$[2]?dynamicCast(part, 2):part.typeMarker$ == nullMethod || part.castableTypeMap$ && !!part.castableTypeMap$[1]?part.toString$():part.toString?part.toString():'[JavaScriptObject]';
}

function Joiner_0(){
  this.separator = dynamicCast(checkNotNull(' '), 1);
}

function Joiner(){
}

_ = Joiner_0.prototype = Joiner.prototype = new Object_0;
_.getClass$ = function getClass_1(){
  return Lcom_google_common_base_Joiner_2_classLit;
}
;
_.castableTypeMap$ = {};
_.separator = null;
function checkArgument_0(expression, errorMessage){
  if (!expression) {
    throw new IllegalArgumentException_1('' + errorMessage);
  }
}

function checkNotNull(reference){
  if (reference == null) {
    throw new NullPointerException_0;
  }
  return reference;
}

function checkState_1(expression, errorMessageArgs){
  if (!expression) {
    throw new IllegalStateException_1(format_0('bad diff scope: ', errorMessageArgs));
  }
}

function $getStackTrace(this$static){
  if (this$static.stackTrace == null) {
    return initDim(_3Ljava_lang_StackTraceElement_2_classLit, {9:1, 68:1}, 84, 0, 0);
  }
  return this$static.stackTrace;
}

function $initCause(this$static, cause){
  if (this$static.cause) {
    throw new IllegalStateException_1("Can't overwrite cause");
  }
  if (cause == this$static) {
    throw new IllegalArgumentException_1('Self-causation not permitted');
  }
  this$static.cause = cause;
  return this$static;
}

function $printStackTrace(this$static){
  var causeMessage, currentCause, msg;
  msg = new StringBuffer_0;
  currentCause = this$static;
  while (currentCause) {
    causeMessage = currentCause.getMessage();
    currentCause != this$static && (msg.impl.string += 'Caused by: ' , msg);
    $append_5(msg, currentCause.getClass$().typeName);
    msg.impl.string += ': ';
    msg.impl.string += causeMessage == null?'(No exception detail)':causeMessage;
    msg.impl.string += '\n';
    currentCause = currentCause.cause;
  }
}

function $clinit_16(){
  var out;
  $clinit_16 = nullMethod;
  escapeTable = (out = ['\\u0000', '\\u0001', '\\u0002', '\\u0003', '\\u0004', '\\u0005', '\\u0006', '\\u0007', '\\b', '\\t', '\\n', '\\u000B', '\\f', '\\r', '\\u000E', '\\u000F', '\\u0010', '\\u0011', '\\u0012', '\\u0013', '\\u0014', '\\u0015', '\\u0016', '\\u0017', '\\u0018', '\\u0019', '\\u001A', '\\u001B', '\\u001C', '\\u001D', '\\u001E', '\\u001F'] , out[34] = '\\"' , out[92] = '\\\\' , out[173] = '\\u00ad' , out[1536] = '\\u0600' , out[1537] = '\\u0601' , out[1538] = '\\u0602' , out[1539] = '\\u0603' , out[1757] = '\\u06dd' , out[1807] = '\\u070f' , out[6068] = '\\u17b4' , out[6069] = '\\u17b5' , out[8204] = '\\u200c' , out[8205] = '\\u200d' , out[8206] = '\\u200e' , out[8207] = '\\u200f' , out[8232] = '\\u2028' , out[8233] = '\\u2029' , out[8234] = '\\u202a' , out[8235] = '\\u202b' , out[8236] = '\\u202c' , out[8237] = '\\u202d' , out[8238] = '\\u202e' , out[8288] = '\\u2060' , out[8289] = '\\u2061' , out[8290] = '\\u2062' , out[8291] = '\\u2063' , out[8298] = '\\u206a' , out[8299] = '\\u206b' , out[8300] = '\\u206c' , out[8301] = '\\u206d' , out[8302] = '\\u206e' , out[8303] = '\\u206f' , out[65279] = '\\ufeff' , out[65529] = '\\ufff9' , out[65530] = '\\ufffa' , out[65531] = '\\ufffb' , out);
  hasJsonParse = typeof JSON == 'object' && typeof JSON.parse == 'function';
}

function escapeJsonForEval(toEscape){
  $clinit_16();
  var s = toEscape.replace(/[\xad\u0600-\u0603\u06dd\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202e\u2060-\u2063\u206a-\u206f\ufeff\ufff9-\ufffb]/g, function(x){
    var lookedUp;
    return lookedUp = escapeTable[x.charCodeAt(0)] , lookedUp == null?x:lookedUp;
  }
  );
  return s;
}

function escapeValue(toEscape){
  $clinit_16();
  var s = toEscape.replace(/[\x00-\x1f\xad\u0600-\u0603\u06dd\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202e\u2060-\u2063\u206a-\u206f\ufeff\ufff9-\ufffb"\\]/g, function(x){
    var lookedUp;
    return lookedUp = escapeTable[x.charCodeAt(0)] , lookedUp == null?x:lookedUp;
  }
  );
  return '"' + s + '"';
}

var escapeTable, hasJsonParse;
function $fragmentHasLoaded(this$static, fragment){
  var logGroup;
  logGroup = fragment == this$static.numEntries?'leftoversDownload':'download' + fragment;
  !!$stats && $stats($createStatsEvent(logGroup, 'end', fragment, -1));
  fragment < this$static.pendingDownloadErrorHandlers.length && setCheck(this$static.pendingDownloadErrorHandlers, fragment, null);
  $isInitial(this$static, fragment) && $remove(this$static.remainingInitialFragments);
  this$static.fragmentLoading = -1;
  this$static.isLoaded[fragment] = true;
  $startLoadingNextFragment(this$static);
}

function $leftoversFragmentHasLoaded(this$static){
  $fragmentHasLoaded(this$static, this$static.numEntries);
}

function browserLoaderLeftoversFragmentHasLoaded(){
  $leftoversFragmentHasLoaded(BROWSER_LOADER);
}

function $scheduleFinally(this$static, cmd){
  this$static.finallyCommands = push(this$static.finallyCommands, [cmd, false]);
}

function $replace(this$static, start, end, toInsert){
  this$static.string = this$static.string.substr(0, start - 0) + toInsert + $substring(this$static.string, end);
}

function $getAbsoluteLeft(elem){
  var rect;
  rect = elem.getBoundingClientRect && elem.getBoundingClientRect();
  return rect?rect.left + $getScrollLeft_0(elem.ownerDocument.body):getAbsoluteLeftUsingOffsets(elem);
}

function $getScrollLeft_0(elem){
  if (elem.ownerDocument.defaultView.getComputedStyle(elem, '').direction == 'rtl') {
    return (elem.scrollLeft || 0) - ((elem.scrollWidth || 0) - elem.clientWidth);
  }
  return elem.scrollLeft || 0;
}

function getAbsoluteLeftUsingOffsets(elem){
  if (elem.offsetLeft == null) {
    return 0;
  }
  var left = 0;
  var doc = elem.ownerDocument;
  var curr = elem.parentNode;
  if (curr) {
    while (curr.offsetParent) {
      left -= curr.scrollLeft;
      doc.defaultView.getComputedStyle(curr, '').getPropertyValue('direction') == 'rtl' && (left += curr.scrollWidth - curr.clientWidth);
      curr = curr.parentNode;
    }
  }
  while (elem) {
    left += elem.offsetLeft;
    if (doc.defaultView.getComputedStyle(elem, '')['position'] == 'fixed') {
      left += doc.body.scrollLeft;
      return left;
    }
    var parent_0 = elem.offsetParent;
    parent_0 && $wnd.devicePixelRatio && (left += parseInt(doc.defaultView.getComputedStyle(parent_0, '').getPropertyValue('border-left-width')));
    if (parent_0 && parent_0.tagName == 'BODY' && elem.style.position == 'absolute') {
      break;
    }
    elem = parent_0;
  }
  return left;
}

function $insertAfter(this$static, newChild, refChild){
  var next;
  next = !refChild?null:refChild.nextSibling;
  return !next?this$static.appendChild(newChild):this$static.insertBefore(newChild, next);
}

function $getClientHeight(this$static){
  return ($equals_3(this$static.compatMode, 'CSS1Compat')?this$static.documentElement:this$static.body).clientHeight;
}

function $getClientWidth(this$static){
  return ($equals_3(this$static.compatMode, 'CSS1Compat')?this$static.documentElement:this$static.body).clientWidth;
}

function $addClassName(this$static, className){
  var idx, last, lastPos, oldClassName;
  className = $trim(className);
  oldClassName = this$static.className;
  idx = oldClassName.indexOf(className);
  while (idx != -1) {
    if (idx == 0 || oldClassName.charCodeAt(idx - 1) == 32) {
      last = idx + className.length;
      lastPos = oldClassName.length;
      if (last == lastPos || last < lastPos && oldClassName.charCodeAt(last) == 32) {
        break;
      }
    }
    idx = oldClassName.indexOf(className, idx + 1);
  }
  if (idx == -1) {
    oldClassName.length > 0 && (oldClassName += ' ');
    this$static.className = oldClassName + className;
  }
}

function $getAbsoluteBottom(this$static){
  return $getAbsoluteTop(this$static) + (this$static.offsetHeight || 0);
}

function $getAbsoluteRight(this$static){
  return $getAbsoluteLeft(this$static) + (this$static.offsetWidth || 0);
}

function $getPropertyString(this$static, name_0){
  return this$static[name_0] == null?null:String(this$static[name_0]);
}

function $removeClassName(this$static, className){
  var begin, end, idx, last, lastPos, newClassName, oldStyle;
  className = $trim(className);
  oldStyle = this$static.className;
  idx = oldStyle.indexOf(className);
  while (idx != -1) {
    if (idx == 0 || oldStyle.charCodeAt(idx - 1) == 32) {
      last = idx + className.length;
      lastPos = oldStyle.length;
      if (last == lastPos || last < lastPos && oldStyle.charCodeAt(last) == 32) {
        break;
      }
    }
    idx = oldStyle.indexOf(className, idx + 1);
  }
  if (idx != -1) {
    begin = $trim(oldStyle.substr(0, idx - 0));
    end = $trim($substring(oldStyle, idx + className.length));
    begin.length == 0?(newClassName = end):end.length == 0?(newClassName = begin):(newClassName = begin + ' ' + end);
    this$static.className = newClassName;
  }
}

function $replaceClassName(this$static, oldClassName, newClassName){
  $removeClassName(this$static, oldClassName);
  $addClassName(this$static, newClassName);
}

function valueOf(enumType, name_0){
  var enumValueOfFunc;
  enumValueOfFunc = enumType.enumValueOfFunc;
  if (!enumValueOfFunc) {
    throw new IllegalArgumentException_0;
  }
  return enumValueOfFunc(name_0);
}

function $clinit_69(){
  $clinit_69 = nullMethod;
  NORMAL = new Style$FontWeight$1_0;
  BOLD = new Style$FontWeight$2_0;
  BOLDER = new Style$FontWeight$3_0;
  LIGHTER = new Style$FontWeight$4_0;
  $VALUES_0 = initValues(_3Lcom_google_gwt_dom_client_Style$FontWeight_2_classLit, {9:1, 68:1, 170:1}, 72, [NORMAL, BOLD, BOLDER, LIGHTER]);
}

function valueOf_2(name_0){
  $clinit_69();
  return valueOf_0(($clinit_74() , $MAP_0), name_0);
}

function values_1(){
  $clinit_69();
  return $VALUES_0;
}

function Style$FontWeight(){
}

_ = Style$FontWeight.prototype = new Enum;
_.getClass$ = function getClass_35(){
  return Lcom_google_gwt_dom_client_Style$FontWeight_2_classLit;
}
;
_.castableTypeMap$ = {4:1, 9:1, 10:1, 65:1, 72:1};
var $VALUES_0, BOLD, BOLDER, LIGHTER, NORMAL;
function Style$FontWeight$1_0(){
  this.name_1 = 'NORMAL';
  this.ordinal = 0;
}

function Style$FontWeight$1(){
}

_ = Style$FontWeight$1_0.prototype = Style$FontWeight$1.prototype = new Style$FontWeight;
_.getClass$ = function getClass_36(){
  return Lcom_google_gwt_dom_client_Style$FontWeight$1_2_classLit;
}
;
_.castableTypeMap$ = {4:1, 9:1, 10:1, 65:1, 72:1};
function Style$FontWeight$2_0(){
  this.name_1 = 'BOLD';
  this.ordinal = 1;
}

function Style$FontWeight$2(){
}

_ = Style$FontWeight$2_0.prototype = Style$FontWeight$2.prototype = new Style$FontWeight;
_.getClass$ = function getClass_37(){
  return Lcom_google_gwt_dom_client_Style$FontWeight$2_2_classLit;
}
;
_.castableTypeMap$ = {4:1, 9:1, 10:1, 65:1, 72:1};
function Style$FontWeight$3_0(){
  this.name_1 = 'BOLDER';
  this.ordinal = 2;
}

function Style$FontWeight$3(){
}

_ = Style$FontWeight$3_0.prototype = Style$FontWeight$3.prototype = new Style$FontWeight;
_.getClass$ = function getClass_38(){
  return Lcom_google_gwt_dom_client_Style$FontWeight$3_2_classLit;
}
;
_.castableTypeMap$ = {4:1, 9:1, 10:1, 65:1, 72:1};
function Style$FontWeight$4_0(){
  this.name_1 = 'LIGHTER';
  this.ordinal = 3;
}

function Style$FontWeight$4(){
}

_ = Style$FontWeight$4_0.prototype = Style$FontWeight$4.prototype = new Style$FontWeight;
_.getClass$ = function getClass_39(){
  return Lcom_google_gwt_dom_client_Style$FontWeight$4_2_classLit;
}
;
_.castableTypeMap$ = {4:1, 9:1, 10:1, 65:1, 72:1};
function $clinit_74(){
  $clinit_74 = nullMethod;
  $MAP_0 = createValueOfMap(($clinit_69() , $VALUES_0));
}

var $MAP_0;
function $clinit_76(){
  $clinit_76 = nullMethod;
  VISIBLE = new Style$Overflow$1_0;
  HIDDEN = new Style$Overflow$2_0;
  SCROLL = new Style$Overflow$3_0;
  AUTO = new Style$Overflow$4_0;
  $VALUES_1 = initValues(_3Lcom_google_gwt_dom_client_Style$Overflow_2_classLit, {9:1, 68:1, 170:1}, 73, [VISIBLE, HIDDEN, SCROLL, AUTO]);
}

function valueOf_3(name_0){
  $clinit_76();
  return valueOf_0(($clinit_81() , $MAP_1), name_0);
}

function values_2(){
  $clinit_76();
  return $VALUES_1;
}

function Style$Overflow(){
}

_ = Style$Overflow.prototype = new Enum;
_.getClass$ = function getClass_40(){
  return Lcom_google_gwt_dom_client_Style$Overflow_2_classLit;
}
;
_.castableTypeMap$ = {4:1, 9:1, 10:1, 65:1, 73:1};
var $VALUES_1, AUTO, HIDDEN, SCROLL, VISIBLE;
function Style$Overflow$1_0(){
  this.name_1 = 'VISIBLE';
  this.ordinal = 0;
}

function Style$Overflow$1(){
}

_ = Style$Overflow$1_0.prototype = Style$Overflow$1.prototype = new Style$Overflow;
_.getClass$ = function getClass_41(){
  return Lcom_google_gwt_dom_client_Style$Overflow$1_2_classLit;
}
;
_.castableTypeMap$ = {4:1, 9:1, 10:1, 65:1, 73:1};
function Style$Overflow$2_0(){
  this.name_1 = 'HIDDEN';
  this.ordinal = 1;
}

function Style$Overflow$2(){
}

_ = Style$Overflow$2_0.prototype = Style$Overflow$2.prototype = new Style$Overflow;
_.getClass$ = function getClass_42(){
  return Lcom_google_gwt_dom_client_Style$Overflow$2_2_classLit;
}
;
_.castableTypeMap$ = {4:1, 9:1, 10:1, 65:1, 73:1};
function Style$Overflow$3_0(){
  this.name_1 = 'SCROLL';
  this.ordinal = 2;
}

function Style$Overflow$3(){
}

_ = Style$Overflow$3_0.prototype = Style$Overflow$3.prototype = new Style$Overflow;
_.getClass$ = function getClass_43(){
  return Lcom_google_gwt_dom_client_Style$Overflow$3_2_classLit;
}
;
_.castableTypeMap$ = {4:1, 9:1, 10:1, 65:1, 73:1};
function Style$Overflow$4_0(){
  this.name_1 = 'AUTO';
  this.ordinal = 3;
}

function Style$Overflow$4(){
}

_ = Style$Overflow$4_0.prototype = Style$Overflow$4.prototype = new Style$Overflow;
_.getClass$ = function getClass_44(){
  return Lcom_google_gwt_dom_client_Style$Overflow$4_2_classLit;
}
;
_.castableTypeMap$ = {4:1, 9:1, 10:1, 65:1, 73:1};
function $clinit_81(){
  $clinit_81 = nullMethod;
  $MAP_1 = createValueOfMap(($clinit_76() , $VALUES_1));
}

var $MAP_1;
function $clinit_82(){
  $clinit_82 = nullMethod;
  STATIC = new Style$Position$1_0;
  RELATIVE = new Style$Position$2_0;
  ABSOLUTE = new Style$Position$3_0;
  FIXED = new Style$Position$4_0;
  $VALUES_2 = initValues(_3Lcom_google_gwt_dom_client_Style$Position_2_classLit, {9:1, 68:1, 170:1}, 74, [STATIC, RELATIVE, ABSOLUTE, FIXED]);
}

function valueOf_4(name_0){
  $clinit_82();
  return valueOf_0(($clinit_87() , $MAP_2), name_0);
}

function values_3(){
  $clinit_82();
  return $VALUES_2;
}

function Style$Position(){
}

_ = Style$Position.prototype = new Enum;
_.getClass$ = function getClass_45(){
  return Lcom_google_gwt_dom_client_Style$Position_2_classLit;
}
;
_.castableTypeMap$ = {4:1, 9:1, 10:1, 65:1, 74:1};
var $VALUES_2, ABSOLUTE, FIXED, RELATIVE, STATIC;
function Style$Position$1_0(){
  this.name_1 = 'STATIC';
  this.ordinal = 0;
}

function Style$Position$1(){
}

_ = Style$Position$1_0.prototype = Style$Position$1.prototype = new Style$Position;
_.getClass$ = function getClass_46(){
  return Lcom_google_gwt_dom_client_Style$Position$1_2_classLit;
}
;
_.castableTypeMap$ = {4:1, 9:1, 10:1, 65:1, 74:1};
function Style$Position$2_0(){
  this.name_1 = 'RELATIVE';
  this.ordinal = 1;
}

function Style$Position$2(){
}

_ = Style$Position$2_0.prototype = Style$Position$2.prototype = new Style$Position;
_.getClass$ = function getClass_47(){
  return Lcom_google_gwt_dom_client_Style$Position$2_2_classLit;
}
;
_.castableTypeMap$ = {4:1, 9:1, 10:1, 65:1, 74:1};
function Style$Position$3_0(){
  this.name_1 = 'ABSOLUTE';
  this.ordinal = 2;
}

function Style$Position$3(){
}

_ = Style$Position$3_0.prototype = Style$Position$3.prototype = new Style$Position;
_.getClass$ = function getClass_48(){
  return Lcom_google_gwt_dom_client_Style$Position$3_2_classLit;
}
;
_.castableTypeMap$ = {4:1, 9:1, 10:1, 65:1, 74:1};
function Style$Position$4_0(){
  this.name_1 = 'FIXED';
  this.ordinal = 3;
}

function Style$Position$4(){
}

_ = Style$Position$4_0.prototype = Style$Position$4.prototype = new Style$Position;
_.getClass$ = function getClass_49(){
  return Lcom_google_gwt_dom_client_Style$Position$4_2_classLit;
}
;
_.castableTypeMap$ = {4:1, 9:1, 10:1, 65:1, 74:1};
function $clinit_87(){
  $clinit_87 = nullMethod;
  $MAP_2 = createValueOfMap(($clinit_82() , $VALUES_2));
}

var $MAP_2;
function $clinit_88(){
  $clinit_88 = nullMethod;
  PX = new Style$Unit$1_0;
  PCT = new Style$Unit$2_0;
  EM = new Style$Unit$3_0;
  EX = new Style$Unit$4_0;
  PT = new Style$Unit$5_0;
  PC = new Style$Unit$6_0;
  IN = new Style$Unit$7_0;
  CM = new Style$Unit$8_0;
  MM = new Style$Unit$9_0;
  $VALUES_3 = initValues(_3Lcom_google_gwt_dom_client_Style$Unit_2_classLit, {9:1, 68:1, 170:1}, 75, [PX, PCT, EM, EX, PT, PC, IN, CM, MM]);
}

function valueOf_5(name_0){
  $clinit_88();
  return valueOf_0(($clinit_98() , $MAP_3), name_0);
}

function values_4(){
  $clinit_88();
  return $VALUES_3;
}

function Style$Unit(){
}

_ = Style$Unit.prototype = new Enum;
_.getClass$ = function getClass_50(){
  return Lcom_google_gwt_dom_client_Style$Unit_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 75:1};
var $VALUES_3, CM, EM, EX, IN, MM, PC, PCT, PT, PX;
function Style$Unit$1_0(){
  this.name_1 = 'PX';
  this.ordinal = 0;
}

function Style$Unit$1(){
}

_ = Style$Unit$1_0.prototype = Style$Unit$1.prototype = new Style$Unit;
_.getClass$ = function getClass_51(){
  return Lcom_google_gwt_dom_client_Style$Unit$1_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 75:1};
function Style$Unit$2_0(){
  this.name_1 = 'PCT';
  this.ordinal = 1;
}

function Style$Unit$2(){
}

_ = Style$Unit$2_0.prototype = Style$Unit$2.prototype = new Style$Unit;
_.getClass$ = function getClass_52(){
  return Lcom_google_gwt_dom_client_Style$Unit$2_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 75:1};
function Style$Unit$3_0(){
  this.name_1 = 'EM';
  this.ordinal = 2;
}

function Style$Unit$3(){
}

_ = Style$Unit$3_0.prototype = Style$Unit$3.prototype = new Style$Unit;
_.getClass$ = function getClass_53(){
  return Lcom_google_gwt_dom_client_Style$Unit$3_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 75:1};
function Style$Unit$4_0(){
  this.name_1 = 'EX';
  this.ordinal = 3;
}

function Style$Unit$4(){
}

_ = Style$Unit$4_0.prototype = Style$Unit$4.prototype = new Style$Unit;
_.getClass$ = function getClass_54(){
  return Lcom_google_gwt_dom_client_Style$Unit$4_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 75:1};
function Style$Unit$5_0(){
  this.name_1 = 'PT';
  this.ordinal = 4;
}

function Style$Unit$5(){
}

_ = Style$Unit$5_0.prototype = Style$Unit$5.prototype = new Style$Unit;
_.getClass$ = function getClass_55(){
  return Lcom_google_gwt_dom_client_Style$Unit$5_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 75:1};
function Style$Unit$6_0(){
  this.name_1 = 'PC';
  this.ordinal = 5;
}

function Style$Unit$6(){
}

_ = Style$Unit$6_0.prototype = Style$Unit$6.prototype = new Style$Unit;
_.getClass$ = function getClass_56(){
  return Lcom_google_gwt_dom_client_Style$Unit$6_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 75:1};
function Style$Unit$7_0(){
  this.name_1 = 'IN';
  this.ordinal = 6;
}

function Style$Unit$7(){
}

_ = Style$Unit$7_0.prototype = Style$Unit$7.prototype = new Style$Unit;
_.getClass$ = function getClass_57(){
  return Lcom_google_gwt_dom_client_Style$Unit$7_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 75:1};
function Style$Unit$8_0(){
  this.name_1 = 'CM';
  this.ordinal = 7;
}

function Style$Unit$8(){
}

_ = Style$Unit$8_0.prototype = Style$Unit$8.prototype = new Style$Unit;
_.getClass$ = function getClass_58(){
  return Lcom_google_gwt_dom_client_Style$Unit$8_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 75:1};
function Style$Unit$9_0(){
  this.name_1 = 'MM';
  this.ordinal = 8;
}

function Style$Unit$9(){
}

_ = Style$Unit$9_0.prototype = Style$Unit$9.prototype = new Style$Unit;
_.getClass$ = function getClass_59(){
  return Lcom_google_gwt_dom_client_Style$Unit$9_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 75:1};
function $clinit_98(){
  $clinit_98 = nullMethod;
  $MAP_3 = createValueOfMap(($clinit_88() , $VALUES_3));
}

var $MAP_3;
function $clinit_99(){
  $clinit_99 = nullMethod;
  VISIBLE_0 = new Style$Visibility$1_0;
  HIDDEN_0 = new Style$Visibility$2_0;
  $VALUES_4 = initValues(_3Lcom_google_gwt_dom_client_Style$Visibility_2_classLit, {9:1, 68:1, 170:1}, 76, [VISIBLE_0, HIDDEN_0]);
}

function valueOf_6(name_0){
  $clinit_99();
  return valueOf_0(($clinit_102() , $MAP_4), name_0);
}

function values_5(){
  $clinit_99();
  return $VALUES_4;
}

function Style$Visibility(){
}

_ = Style$Visibility.prototype = new Enum;
_.getClass$ = function getClass_60(){
  return Lcom_google_gwt_dom_client_Style$Visibility_2_classLit;
}
;
_.castableTypeMap$ = {4:1, 9:1, 10:1, 65:1, 76:1};
var $VALUES_4, HIDDEN_0, VISIBLE_0;
function Style$Visibility$1_0(){
  this.name_1 = 'VISIBLE';
  this.ordinal = 0;
}

function Style$Visibility$1(){
}

_ = Style$Visibility$1_0.prototype = Style$Visibility$1.prototype = new Style$Visibility;
_.getClass$ = function getClass_61(){
  return Lcom_google_gwt_dom_client_Style$Visibility$1_2_classLit;
}
;
_.castableTypeMap$ = {4:1, 9:1, 10:1, 65:1, 76:1};
function Style$Visibility$2_0(){
  this.name_1 = 'HIDDEN';
  this.ordinal = 1;
}

function Style$Visibility$2(){
}

_ = Style$Visibility$2_0.prototype = Style$Visibility$2.prototype = new Style$Visibility;
_.getClass$ = function getClass_62(){
  return Lcom_google_gwt_dom_client_Style$Visibility$2_2_classLit;
}
;
_.castableTypeMap$ = {4:1, 9:1, 10:1, 65:1, 76:1};
function $clinit_102(){
  $clinit_102 = nullMethod;
  $MAP_4 = createValueOfMap(($clinit_99() , $VALUES_4));
}

var $MAP_4;
function schedule(){
  if (!needsInjection) {
    needsInjection = true;
    $scheduleFinally(($clinit_30() , INSTANCE), flusher);
  }
}

function $setData(this$static, data){
  this$static.data = data;
}

function $clinit_111(){
  $clinit_111 = nullMethod;
  TYPE = new DomEvent$Type_0('blur', new BlurEvent_0);
}

function BlurEvent_0(){
}

function BlurEvent(){
}

_ = BlurEvent_0.prototype = BlurEvent.prototype = new DomEvent;
_.dispatch = function dispatch(handler){
  dynamicCast(handler, 22);
}
;
_.getAssociatedType_0 = function getAssociatedType_0(){
  return TYPE;
}
;
_.getClass$ = function getClass_67(){
  return Lcom_google_gwt_event_dom_client_BlurEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
var TYPE;
function $clinit_153(){
  $clinit_153 = nullMethod;
  TYPE_7 = new DomEvent$Type_0('mouseout', new MouseOutEvent_0);
}

function MouseOutEvent_0(){
}

function MouseOutEvent(){
}

_ = MouseOutEvent_0.prototype = MouseOutEvent.prototype = new MouseEvent_0;
_.dispatch = function dispatch_7(handler){
  dynamicCast(handler, 31).onMouseOut(this);
}
;
_.getAssociatedType_0 = function getAssociatedType_8(){
  return TYPE_7;
}
;
_.getClass$ = function getClass_80(){
  return Lcom_google_gwt_event_dom_client_MouseOutEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
var TYPE_7;
function $clinit_155(){
  $clinit_155 = nullMethod;
  TYPE_8 = new DomEvent$Type_0('mouseover', new MouseOverEvent_0);
}

function MouseOverEvent_0(){
}

function MouseOverEvent(){
}

_ = MouseOverEvent_0.prototype = MouseOverEvent.prototype = new MouseEvent_0;
_.dispatch = function dispatch_8(handler){
  dynamicCast(handler, 32).onMouseOver(this);
}
;
_.getAssociatedType_0 = function getAssociatedType_9(){
  return TYPE_8;
}
;
_.getClass$ = function getClass_81(){
  return Lcom_google_gwt_event_dom_client_MouseOverEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
var TYPE_8;
function $clinit_157(){
  $clinit_157 = nullMethod;
  TYPE_9 = new DomEvent$Type_0('mouseup', new MouseUpEvent_0);
}

function MouseUpEvent_0(){
}

function MouseUpEvent(){
}

_ = MouseUpEvent_0.prototype = MouseUpEvent.prototype = new MouseEvent_0;
_.dispatch = function dispatch_9(handler){
  $onClicked_0(dynamicCast(dynamicCast(handler, 33), 34).this$1);
}
;
_.getAssociatedType_0 = function getAssociatedType_10(){
  return TYPE_9;
}
;
_.getClass$ = function getClass_82(){
  return Lcom_google_gwt_event_dom_client_MouseUpEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
var TYPE_9;
function ResizeEvent_0(){
}

function fire_1(source){
  var event_0;
  if (TYPE_11) {
    event_0 = new ResizeEvent_0;
    $fireEvent(source, event_0);
  }
}

function ResizeEvent(){
}

_ = ResizeEvent_0.prototype = ResizeEvent.prototype = new GwtEvent;
_.dispatch = function dispatch_11(handler){
  $onResize(dynamicCast(handler, 36));
}
;
_.getAssociatedType = function getAssociatedType_12(){
  return TYPE_11;
}
;
_.getClass$ = function getClass_85(){
  return Lcom_google_gwt_event_logical_shared_ResizeEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
var TYPE_11 = null;
function ValueChangeEvent_0(value){
  this.value_0 = value;
}

function fire_2(source, value){
  var event_0;
  if (TYPE_12) {
    event_0 = new ValueChangeEvent_0(value);
    source.fireEvent(event_0);
  }
}

function ValueChangeEvent(){
}

_ = ValueChangeEvent_0.prototype = ValueChangeEvent.prototype = new GwtEvent;
_.dispatch = function dispatch_12(handler){
  dynamicCast(handler, 37).onValueChange(this);
}
;
_.getAssociatedType = function getAssociatedType_13(){
  return TYPE_12;
}
;
_.getClass$ = function getClass_86(){
  return Lcom_google_gwt_event_logical_shared_ValueChangeEvent_2_classLit;
}
;
_.castableTypeMap$ = {};
_.value_0 = null;
var TYPE_12 = null;
_ = HandlerManager.prototype;
_.fireEvent = function fireEvent_0(event_0){
  $fireEvent(this, event_0);
}
;
function $doRemove(this$static, type, source, handler){
  var l_0, removed;
  this$static.firingDepth > 0?$defer(this$static, new SimpleEventBus$3_0(this$static, type, source, handler)):(l_0 = $getHandlerList(this$static, type, source) , removed = l_0.remove_0(handler) , removed && l_0.isEmpty() && $prune(this$static, type, source) , undefined);
}

function $doRemoveNow(this$static, type, source, handler){
  var l_0, removed;
  l_0 = $getHandlerList(this$static, type, source);
  removed = l_0.remove_0(handler);
  removed && l_0.isEmpty() && $prune(this$static, type, source);
}

function $prune(this$static, type, source){
  var sourceMap;
  sourceMap = dynamicCast(this$static.map.get(type), 40);
  dynamicCast(sourceMap.remove_3(source), 41);
  sourceMap.isEmpty() && this$static.map.remove_3(type);
}

_ = SimpleEventBus.prototype;
_.fireEvent = function fireEvent_1(event_0){
  $fireEvent_0(this, event_0);
}
;
function $removeHandler(this$static){
  $doRemove(this$static.this$0, this$static.val$type, this$static.val$source, this$static.val$handler);
}

function SimpleEventBus$3_0(this$0, val$type, val$source, val$handler){
  this.this$0 = this$0;
  this.val$type = val$type;
  this.val$source = val$source;
  this.val$handler = val$handler;
}

function SimpleEventBus$3(){
}

_ = SimpleEventBus$3_0.prototype = SimpleEventBus$3.prototype = new Object_0;
_.execute_0 = function execute_4(){
  $doRemoveNow(this.this$0, this.val$type, this.val$source, this.val$handler);
}
;
_.getClass$ = function getClass_92(){
  return Lcom_google_gwt_event_shared_SimpleEventBus$3_2_classLit;
}
;
_.castableTypeMap$ = {42:1};
_.this$0 = null;
_.val$handler = null;
_.val$source = null;
_.val$type = null;
function $cancel_1(this$static){
  var xmlHttp;
  if (this$static.xmlHttpRequest) {
    xmlHttp = this$static.xmlHttpRequest;
    this$static.xmlHttpRequest = null;
    $clearOnReadyStateChange(xmlHttp);
    xmlHttp.abort();
    !!this$static.timer && $cancel_0(this$static.timer);
  }
}

function $fireOnResponseReceived(this$static, callback){
  var errorMsg, exception, response, xhr;
  if (!this$static.xmlHttpRequest) {
    return;
  }
  !!this$static.timer && $cancel_0(this$static.timer);
  xhr = this$static.xmlHttpRequest;
  this$static.xmlHttpRequest = null;
  errorMsg = $getBrowserSpecificFailure(xhr);
  if (errorMsg != null) {
    exception = new RuntimeException_1(errorMsg);
    callback.onError(this$static, exception);
  }
   else {
    response = new Request$1_0(xhr);
    callback.onResponseReceived(this$static, response);
  }
}

function $fireOnTimeout(this$static, callback){
  if (!this$static.xmlHttpRequest) {
    return;
  }
  $cancel_1(this$static);
  callback.onError(this$static, new RequestTimeoutException_0(this$static.timeoutMillis));
}

function $getBrowserSpecificFailure(xhr){
  try {
    if (xhr.status === undefined) {
      return 'XmlHttpRequest.status == undefined, please see Safari bug http://bugs.webkit.org/show_bug.cgi?id=3810 for more details';
    }
    return null;
  }
   catch (e) {
    return 'Unable to read XmlHttpRequest.status; likely causes are a networking error or bad cross-domain request. Please see https://bugzilla.mozilla.org/show_bug.cgi?id=238559 for more details';
  }
}

function Request_0(xmlHttpRequest, timeoutMillis, callback){
  if (!xmlHttpRequest) {
    throw new NullPointerException_0;
  }
  if (!callback) {
    throw new NullPointerException_0;
  }
  if (timeoutMillis < 0) {
    throw new IllegalArgumentException_0;
  }
  this.timeoutMillis = timeoutMillis;
  this.xmlHttpRequest = xmlHttpRequest;
  if (timeoutMillis > 0) {
    this.timer = new Request$3_0(this, callback);
    $schedule(this.timer, timeoutMillis);
  }
   else {
    this.timer = null;
  }
}

function Request(){
}

_ = Request_0.prototype = Request.prototype = new Object_0;
_.getClass$ = function getClass_94(){
  return Lcom_google_gwt_http_client_Request_2_classLit;
}
;
_.castableTypeMap$ = {};
_.timeoutMillis = 0;
_.timer = null;
_.xmlHttpRequest = null;
function Response(){
}

_ = Response.prototype = new Object_0;
_.getClass$ = function getClass_95(){
  return Lcom_google_gwt_http_client_Response_2_classLit;
}
;
_.castableTypeMap$ = {};
function Request$1_0(val$xmlHttpRequest){
  this.val$xmlHttpRequest = val$xmlHttpRequest;
}

function Request$1(){
}

_ = Request$1_0.prototype = Request$1.prototype = new Response;
_.getClass$ = function getClass_96(){
  return Lcom_google_gwt_http_client_Request$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$xmlHttpRequest = null;
function Request$3_0(this$0, val$callback){
  $clinit_3();
  this.this$0 = this$0;
  this.val$callback = val$callback;
}

function Request$3(){
}

_ = Request$3_0.prototype = Request$3.prototype = new Timer;
_.getClass$ = function getClass_97(){
  return Lcom_google_gwt_http_client_Request$3_2_classLit;
}
;
_.run = function run_0(){
  $fireOnTimeout(this.this$0, this.val$callback);
}
;
_.castableTypeMap$ = {54:1};
_.this$0 = null;
_.val$callback = null;
function $clinit_185(){
  $clinit_185 = nullMethod;
  new RequestBuilder$Method_0('DELETE');
  GET = new RequestBuilder$Method_0('GET');
  new RequestBuilder$Method_0('HEAD');
  POST = new RequestBuilder$Method_0('POST');
  new RequestBuilder$Method_0('PUT');
}

function $doSend(this$static, requestData, callback){
  var $e0, e, request, requestPermissionException, xmlHttpRequest;
  xmlHttpRequest = create_5();
  try {
    xmlHttpRequest.open(this$static.httpMethod, this$static.url, true);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 44)) {
      e = $e0;
      requestPermissionException = new RequestPermissionException_0(this$static.url);
      $initCause(requestPermissionException, new RequestException_0((e.message_0 == null && $init(e) , e.message_0)));
      throw requestPermissionException;
    }
     else 
      throw $e0;
  }
  xmlHttpRequest.setRequestHeader('Content-Type', 'text/plain; charset=utf-8');
  request = new Request_0(xmlHttpRequest, this$static.timeoutMillis, callback);
  $setOnReadyStateChange_0(xmlHttpRequest, new RequestBuilder$1_0(request, callback));
  try {
    xmlHttpRequest.send(requestData);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 44)) {
      e = $e0;
      throw new RequestException_0((e.message_0 == null && $init(e) , e.message_0));
    }
     else 
      throw $e0;
  }
  return request;
}

function $sendRequest(this$static, requestData, callback){
  throwIfNull('callback', callback);
  return $doSend(this$static, requestData, callback);
}

function RequestBuilder_0(httpMethod, url){
  $clinit_185();
  RequestBuilder_1.call(this, !httpMethod?null:httpMethod.name_0, url);
}

function RequestBuilder_1(httpMethod, url){
  throwIfEmptyOrNull('httpMethod', httpMethod);
  throwIfEmptyOrNull('url', url);
  this.httpMethod = httpMethod;
  this.url = url;
}

function RequestBuilder(){
}

_ = RequestBuilder_0.prototype = RequestBuilder.prototype = new Object_0;
_.getClass$ = function getClass_98(){
  return Lcom_google_gwt_http_client_RequestBuilder_2_classLit;
}
;
_.castableTypeMap$ = {};
_.httpMethod = null;
_.timeoutMillis = 0;
_.url = null;
var GET, POST;
function RequestBuilder$1_0(val$request, val$callback){
  this.val$request = val$request;
  this.val$callback = val$callback;
}

function RequestBuilder$1(){
}

_ = RequestBuilder$1_0.prototype = RequestBuilder$1.prototype = new Object_0;
_.getClass$ = function getClass_99(){
  return Lcom_google_gwt_http_client_RequestBuilder$1_2_classLit;
}
;
_.onReadyStateChange = function onReadyStateChange_0(xhr){
  if (xhr.readyState == 4) {
    $clearOnReadyStateChange(xhr);
    $fireOnResponseReceived(this.val$request, this.val$callback);
  }
}
;
_.castableTypeMap$ = {};
_.val$callback = null;
_.val$request = null;
function RequestBuilder$Method_0(name_0){
  this.name_0 = name_0;
}

function RequestBuilder$Method(){
}

_ = RequestBuilder$Method_0.prototype = RequestBuilder$Method.prototype = new Object_0;
_.getClass$ = function getClass_100(){
  return Lcom_google_gwt_http_client_RequestBuilder$Method_2_classLit;
}
;
_.toString$ = function toString_6(){
  return this.name_0;
}
;
_.castableTypeMap$ = {};
_.name_0 = null;
function RequestException_0(message){
  this.fillInStackTrace();
  this.detailMessage = message;
}

function RequestException(){
}

_ = RequestException_0.prototype = RequestException.prototype = new Exception;
_.getClass$ = function getClass_101(){
  return Lcom_google_gwt_http_client_RequestException_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 39:1, 183:1, 243:1};
function RequestPermissionException_0(url){
  this.fillInStackTrace();
  this.detailMessage = 'The URL ' + url + ' is invalid or violates the same-origin security restriction';
}

function RequestPermissionException(){
}

_ = RequestPermissionException_0.prototype = RequestPermissionException.prototype = new RequestException;
_.getClass$ = function getClass_102(){
  return Lcom_google_gwt_http_client_RequestPermissionException_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 39:1, 183:1, 243:1};
function RequestTimeoutException_0(timeoutMillis){
  this.fillInStackTrace();
  this.detailMessage = 'A request timeout has expired after ' + timeoutMillis + ' ms';
}

function RequestTimeoutException(){
}

_ = RequestTimeoutException_0.prototype = RequestTimeoutException.prototype = new RequestException;
_.getClass$ = function getClass_103(){
  return Lcom_google_gwt_http_client_RequestTimeoutException_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 39:1, 183:1, 243:1};
function throwIfEmptyOrNull(name_0, value){
  throwIfNull(name_0, value);
  if (0 == $trim(value).length) {
    throw new IllegalArgumentException_1(name_0 + ' cannot be empty');
  }
}

function throwIfNull(name_0, value){
  if (null == value) {
    throw new NullPointerException_1(name_0 + ' cannot be null');
  }
}

function encodeComponent(decodedURLComponent){
  var regexp;
  return throwIfNull('decodedURLComponent', decodedURLComponent) , regexp = /%20/g , encodeURIComponent(decodedURLComponent).replace(regexp, '+');
}

function encodeQueryString(decodedURLComponent){
  var regexp;
  throwIfNull('decodedURLComponent', decodedURLComponent);
  return regexp = /%20/g , encodeURIComponent(decodedURLComponent).replace(regexp, '+');
}

function getDirectionOnElement(elem){
  var dirPropertyValue;
  dirPropertyValue = elem['dir'] == null?null:String(elem['dir']);
  if ($equalsIgnoreCase('rtl', dirPropertyValue)) {
    return $clinit_209() , RTL;
  }
   else if ($equalsIgnoreCase('ltr', dirPropertyValue)) {
    return $clinit_209() , LTR;
  }
  return $clinit_209() , DEFAULT;
}

function setDirectionOnElement(elem, direction){
  switch (direction.ordinal) {
    case 0:
      {
        elem['dir'] = 'rtl';
        break;
      }

    case 1:
      {
        elem['dir'] = 'ltr';
        break;
      }

    case 2:
      {
        getDirectionOnElement(elem) != ($clinit_209() , DEFAULT) && (elem['dir'] = '' , undefined);
        break;
      }

  }
}

function $clinit_202(){
  $clinit_202 = nullMethod;
  cache_0 = new HashMap_0;
}

function $addPart(this$static, buf, count){
  var oldLength;
  if (buf.impl.string.length > 0) {
    $add_9(this$static.patternParts, new DateTimeFormat$PatternPart_0(buf.impl.string, count));
    oldLength = buf.impl.string.length;
    0 < oldLength?($replace(buf.impl, 0, oldLength, '') , buf):0 > oldLength && $append_3(buf, initDim(_3C_classLit, {9:1}, -1, -oldLength, 1));
  }
}

function $format(this$static, date){
  var timeZone;
  timeZone = createTimeZone(date.jsdate.getTimezoneOffset());
  return $format_0(this$static, date, timeZone);
}

function $format_0(this$static, date, timeZone){
  var ch, diff, i, j, keepDate, keepTime, n, toAppendTo, trailQuote;
  diff = (date.jsdate.getTimezoneOffset() - timeZone.standardOffset) * 60000;
  keepDate = new Date_2(add_1(fromDouble(date.jsdate.getTime()), fromInt(diff)));
  keepTime = keepDate;
  if (keepDate.jsdate.getTimezoneOffset() != date.jsdate.getTimezoneOffset()) {
    diff > 0?(diff -= 86400000):(diff += 86400000);
    keepTime = new Date_2(add_1(fromDouble(date.jsdate.getTime()), fromInt(diff)));
  }
  toAppendTo = new StringBuffer_1;
  n = this$static.pattern.length;
  for (i = 0; i < n;) {
    ch = this$static.pattern.charCodeAt(i);
    if (ch >= 97 && ch <= 122 || ch >= 65 && ch <= 90) {
      for (j = i + 1; j < n && this$static.pattern.charCodeAt(j) == ch; ++j) {
      }
      $subFormat(toAppendTo, ch, j - i, keepDate, keepTime, timeZone);
      i = j;
    }
     else if (ch == 39) {
      ++i;
      if (i < n && this$static.pattern.charCodeAt(i) == 39) {
        toAppendTo.impl.string += "'";
        ++i;
        continue;
      }
      trailQuote = false;
      while (!trailQuote) {
        j = i;
        while (j < n && this$static.pattern.charCodeAt(j) != 39) {
          ++j;
        }
        if (j >= n) {
          throw new IllegalArgumentException_1("Missing trailing '");
        }
        j + 1 < n && this$static.pattern.charCodeAt(j + 1) == 39?++j:(trailQuote = true);
        $append_5(toAppendTo, $substring_0(this$static.pattern, i, j));
        i = j + 1;
      }
    }
     else {
      toAppendTo.impl.string += String.fromCharCode(ch);
      ++i;
    }
  }
  return toAppendTo.impl.string;
}

function $formatFractionalSeconds(buf, count, date){
  var time, value;
  time = fromDouble(date.jsdate.getTime());
  if (!gte_0(time, P0_longLit)) {
    value = 1000 - toInt((divMod(neg(time), P3e8_longLit, true) , remainder_0));
    value == 1000 && (value = 0);
  }
   else {
    value = toInt((divMod(time, P3e8_longLit, true) , remainder_0));
  }
  if (count == 1) {
    value = ~~((value + 50) / 100) < 9?~~((value + 50) / 100):9;
    buf.impl.string += String.fromCharCode(48 + value & 65535);
  }
   else if (count == 2) {
    value = ~~((value + 5) / 10) < 99?~~((value + 5) / 10):99;
    $zeroPaddingNumber(buf, value, 2);
  }
   else {
    $zeroPaddingNumber(buf, value, 3);
    count > 3 && $zeroPaddingNumber(buf, 0, count - 3);
  }
}

function $formatMonth(buf, count, date){
  var value;
  value = date.jsdate.getMonth();
  switch (count) {
    case 5:
      $append_5(buf, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['J', 'F', 'M', 'A', 'M', 'J', 'J', 'A', 'S', 'O', 'N', 'D'])[value]);
      break;
    case 4:
      $append_5(buf, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'])[value]);
      break;
    case 3:
      $append_5(buf, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'])[value]);
      break;
    default:$zeroPaddingNumber(buf, value + 1, count);
  }
}

function $formatYear(buf, count, date){
  var value;
  value = date.jsdate.getFullYear() - 1900 + 1900;
  value < 0 && (value = -value);
  switch (count) {
    case 1:
      buf.impl.string += value;
      break;
    case 2:
      $zeroPaddingNumber(buf, value % 100, 2);
      break;
    default:$zeroPaddingNumber(buf, value, count);
  }
}

function $getNextCharCountInPattern(pattern, start){
  var ch, next;
  ch = pattern.charCodeAt(start);
  next = start + 1;
  while (next < pattern.length && pattern.charCodeAt(next) == ch) {
    ++next;
  }
  return next - start;
}

function $identifyAbutStart(this$static){
  var abut, i, len;
  abut = false;
  len = this$static.patternParts.size_0;
  for (i = 0; i < len; ++i) {
    if ($isNumeric(dynamicCast($get_7(this$static.patternParts, i), 46))) {
      if (!abut && i + 1 < len && $isNumeric(dynamicCast($get_7(this$static.patternParts, i + 1), 46))) {
        abut = true;
        dynamicCast($get_7(this$static.patternParts, i), 46).abutStart = true;
      }
    }
     else {
      abut = false;
    }
  }
}

function $isNumeric(part){
  var i;
  if (part.count <= 0) {
    return false;
  }
  i = 'MLydhHmsSDkK'.indexOf(fromCodePoint(part.text_0.charCodeAt(0)));
  return i > 1 || i >= 0 && part.count < 3;
}

function $parsePattern(this$static, pattern){
  var buf, ch, count, i, inQuote;
  buf = new StringBuffer_1;
  inQuote = false;
  for (i = 0; i < pattern.length; ++i) {
    ch = pattern.charCodeAt(i);
    if (ch == 32) {
      $addPart(this$static, buf, 0);
      buf.impl.string += ' ';
      $addPart(this$static, buf, 0);
      while (i + 1 < pattern.length && pattern.charCodeAt(i + 1) == 32) {
        ++i;
      }
      continue;
    }
    if (inQuote) {
      if (ch == 39) {
        if (i + 1 < pattern.length && pattern.charCodeAt(i + 1) == 39) {
          buf.impl.string += "'";
          ++i;
        }
         else {
          inQuote = false;
        }
      }
       else {
        buf.impl.string += String.fromCharCode(ch);
      }
      continue;
    }
    if ('GyMLdkHmsSEcDahKzZv'.indexOf(fromCodePoint(ch)) > 0) {
      $addPart(this$static, buf, 0);
      buf.impl.string += String.fromCharCode(ch);
      count = $getNextCharCountInPattern(pattern, i);
      $addPart(this$static, buf, count);
      i += count - 1;
      continue;
    }
    if (ch == 39) {
      if (i + 1 < pattern.length && pattern.charCodeAt(i + 1) == 39) {
        buf.impl.string += "'";
        ++i;
      }
       else {
        inQuote = true;
      }
    }
     else {
      buf.impl.string += String.fromCharCode(ch);
    }
  }
  $addPart(this$static, buf, 0);
  $identifyAbutStart(this$static);
}

function $subFormat(buf, ch, count, adjustedDate, adjustedTime, timezone){
  var value, value_0, value_1, value_2, value_3, value_4, value_5, value_6, value_7, value_8, value_9, value_10;
  switch (ch) {
    case 71:
      value = adjustedDate.jsdate.getFullYear() - 1900 >= -1900?1:0;
      count >= 4?$append_5(buf, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['Before Christ', 'Anno Domini'])[value]):$append_5(buf, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['BC', 'AD'])[value]);
      break;
    case 121:
      $formatYear(buf, count, adjustedDate);
      break;
    case 77:
      $formatMonth(buf, count, adjustedDate);
      break;
    case 107:
      value_0 = adjustedTime.jsdate.getHours();
      value_0 == 0?$zeroPaddingNumber(buf, 24, count):$zeroPaddingNumber(buf, value_0, count);
      break;
    case 83:
      $formatFractionalSeconds(buf, count, adjustedTime);
      break;
    case 69:
      value_1 = adjustedDate.jsdate.getDay();
      count == 5?$append_5(buf, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['S', 'M', 'T', 'W', 'T', 'F', 'S'])[value_1]):count == 4?$append_5(buf, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'])[value_1]):$append_5(buf, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'])[value_1]);
      break;
    case 97:
      adjustedTime.jsdate.getHours() >= 12 && adjustedTime.jsdate.getHours() < 24?$append_5(buf, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['AM', 'PM'])[1]):$append_5(buf, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['AM', 'PM'])[0]);
      break;
    case 104:
      value_2 = adjustedTime.jsdate.getHours() % 12;
      value_2 == 0?$zeroPaddingNumber(buf, 12, count):$zeroPaddingNumber(buf, value_2, count);
      break;
    case 75:
      value_3 = adjustedTime.jsdate.getHours() % 12;
      $zeroPaddingNumber(buf, value_3, count);
      break;
    case 72:
      value_4 = adjustedTime.jsdate.getHours();
      $zeroPaddingNumber(buf, value_4, count);
      break;
    case 99:
      value_5 = adjustedDate.jsdate.getDay();
      count == 5?$append_5(buf, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['S', 'M', 'T', 'W', 'T', 'F', 'S'])[value_5]):count == 4?$append_5(buf, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'])[value_5]):count == 3?$append_5(buf, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'])[value_5]):$zeroPaddingNumber(buf, value_5, 1);
      break;
    case 76:
      value_6 = adjustedDate.jsdate.getMonth();
      count == 5?$append_5(buf, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['J', 'F', 'M', 'A', 'M', 'J', 'J', 'A', 'S', 'O', 'N', 'D'])[value_6]):count == 4?$append_5(buf, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'])[value_6]):count == 3?$append_5(buf, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'])[value_6]):$zeroPaddingNumber(buf, value_6 + 1, count);
      break;
    case 81:
      value_7 = ~~(adjustedDate.jsdate.getMonth() / 3);
      count < 4?$append_5(buf, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['Q1', 'Q2', 'Q3', 'Q4'])[value_7]):$append_5(buf, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['1st quarter', '2nd quarter', '3rd quarter', '4th quarter'])[value_7]);
      break;
    case 100:
      value_8 = adjustedDate.jsdate.getDate();
      $zeroPaddingNumber(buf, value_8, count);
      break;
    case 109:
      value_9 = adjustedTime.jsdate.getMinutes();
      $zeroPaddingNumber(buf, value_9, count);
      break;
    case 115:
      value_10 = adjustedTime.jsdate.getSeconds();
      $zeroPaddingNumber(buf, value_10, count);
      break;
    case 122:
      count < 4?$append_5(buf, timezone.tzNames[0]):$append_5(buf, timezone.tzNames[1]);
      break;
    case 118:
      $append_5(buf, timezone.timezoneID);
      break;
    case 90:
      count < 3?$append_5(buf, $getRFCTimeZoneString(timezone)):count == 3?$append_5(buf, $getISOTimeZoneString(timezone)):$append_5(buf, composeGMTString(timezone.standardOffset));
      break;
    default:return false;
  }
  return true;
}

function $zeroPaddingNumber(buf, value, minWidth){
  var b, i;
  b = 10;
  for (i = 0; i < minWidth - 1; ++i) {
    value < b && (buf.impl.string += '0' , buf);
    b *= 10;
  }
  buf.impl.string += value;
}

function DateTimeFormat_0(pattern){
  this.patternParts = new ArrayList_0;
  this.pattern = pattern;
  $parsePattern(this, pattern);
}

function getFormat(predef){
  $clinit_202();
  var dtfi, pattern;
  if (usesFixedEnglishStrings(predef)) {
    switch (predef.ordinal) {
      case 1:
        pattern = 'EEE, d MMM yyyy HH:mm:ss Z';
        break;
      case 0:
        pattern = "yyyy-MM-dd'T'HH:mm:ss.SSSZZZ";
        break;
      default:throw new IllegalStateException_1('Unexpected predef type ' + predef);
    }
    return getFormat_0(pattern, new DateTimeFormatInfoImpl_en_0);
  }
  dtfi = $getDateTimeFormatInfo(($clinit_211() , $clinit_211() , instance_0));
  switch (predef.ordinal) {
    case 2:
      pattern = 'EEEE, MMMM d, y';
      break;
    case 3:
      pattern = 'MMMM d, y';
      break;
    case 4:
      pattern = 'MMM d, y';
      break;
    case 5:
      pattern = 'M/d/yy';
      break;
    case 10:
      pattern = $append_5($append_5($append_5(new StringBuffer_0, 'EEEE, MMMM d, y'), ' '), 'h:mm:ss a zzzz').impl.string;
      break;
    case 11:
      pattern = $append_5($append_5($append_5(new StringBuffer_0, 'MMMM d, y'), ' '), 'h:mm:ss a z').impl.string;
      break;
    case 12:
      pattern = $append_5($append_5($append_5(new StringBuffer_0, 'MMM d, y'), ' '), 'h:mm:ss a').impl.string;
      break;
    case 13:
      pattern = $append_5($append_5($append_5(new StringBuffer_0, 'M/d/yy'), ' '), 'h:mm a').impl.string;
      break;
    case 14:
      pattern = 'd';
      break;
    case 17:
      pattern = 'HH:mm';
      break;
    case 18:
      pattern = 'HH:mm:ss';
      break;
    case 15:
      pattern = 'h:mm a';
      break;
    case 16:
      pattern = 'h:mm:ss a';
      break;
    case 19:
      pattern = 'mm:ss';
      break;
    case 20:
      pattern = 'LLLL';
      break;
    case 21:
      pattern = 'LLL';
      break;
    case 22:
      pattern = 'MMM d';
      break;
    case 23:
      pattern = 'MMMM d';
      break;
    case 24:
      pattern = 'M/d';
      break;
    case 25:
      pattern = 'EEEE, MMMM d';
      break;
    case 6:
      pattern = 'h:mm:ss a zzzz';
      break;
    case 7:
      pattern = 'h:mm:ss a z';
      break;
    case 8:
      pattern = 'h:mm:ss a';
      break;
    case 9:
      pattern = 'h:mm a';
      break;
    case 26:
      pattern = 'y';
      break;
    case 27:
      pattern = 'MMMM y';
      break;
    case 28:
      pattern = 'MMM y';
      break;
    case 29:
      pattern = 'MMM d, y';
      break;
    case 30:
      pattern = 'MMMM d, y';
      break;
    case 31:
      pattern = 'M/y';
      break;
    case 32:
      pattern = 'M/d/y';
      break;
    case 33:
      pattern = 'QQQQ y';
      break;
    case 34:
      pattern = 'Q y';
      break;
    default:throw new IllegalArgumentException_1('Unexpected predefined format ' + predef);
  }
  return getFormat_0(pattern, dtfi);
}

function getFormat_0(pattern, dtfi){
  var defaultDtfi, dtf;
  defaultDtfi = $getDateTimeFormatInfo(($clinit_211() , $clinit_211() , instance_0));
  dtf = null;
  dtfi == defaultDtfi && (dtf = dynamicCast(cache_0.get(pattern), 45));
  if (!dtf) {
    dtf = new DateTimeFormat_0(pattern);
    dtfi == defaultDtfi && cache_0.put(pattern, dtf);
  }
  return dtf;
}

function usesFixedEnglishStrings(predef){
  switch (predef.ordinal) {
    case 1:
      return true;
    case 0:
      return true;
    default:return false;
  }
}

function DateTimeFormat(){
}

_ = DateTimeFormat_0.prototype = DateTimeFormat.prototype = new Object_0;
_.getClass$ = function getClass_105(){
  return Lcom_google_gwt_i18n_client_DateTimeFormat_2_classLit;
}
;
_.castableTypeMap$ = {45:1};
_.pattern = null;
var cache_0 = null;
function DateTimeFormat$PatternPart_0(txt, cnt){
  this.text_0 = txt;
  this.count = cnt;
  this.abutStart = false;
}

function DateTimeFormat$PatternPart(){
}

_ = DateTimeFormat$PatternPart_0.prototype = DateTimeFormat$PatternPart.prototype = new Object_0;
_.getClass$ = function getClass_106(){
  return Lcom_google_gwt_i18n_client_DateTimeFormat$PatternPart_2_classLit;
}
;
_.castableTypeMap$ = {46:1};
_.abutStart = false;
_.count = 0;
_.text_0 = null;
function $clinit_204(){
  $clinit_204 = nullMethod;
  ISO_8601 = new DateTimeFormat$PredefinedFormat_0('ISO_8601', 0);
  RFC_2822 = new DateTimeFormat$PredefinedFormat_0('RFC_2822', 1);
  DATE_FULL = new DateTimeFormat$PredefinedFormat_0('DATE_FULL', 2);
  DATE_LONG = new DateTimeFormat$PredefinedFormat_0('DATE_LONG', 3);
  DATE_MEDIUM = new DateTimeFormat$PredefinedFormat_0('DATE_MEDIUM', 4);
  DATE_SHORT = new DateTimeFormat$PredefinedFormat_0('DATE_SHORT', 5);
  TIME_FULL = new DateTimeFormat$PredefinedFormat_0('TIME_FULL', 6);
  TIME_LONG = new DateTimeFormat$PredefinedFormat_0('TIME_LONG', 7);
  TIME_MEDIUM = new DateTimeFormat$PredefinedFormat_0('TIME_MEDIUM', 8);
  TIME_SHORT = new DateTimeFormat$PredefinedFormat_0('TIME_SHORT', 9);
  DATE_TIME_FULL = new DateTimeFormat$PredefinedFormat_0('DATE_TIME_FULL', 10);
  DATE_TIME_LONG = new DateTimeFormat$PredefinedFormat_0('DATE_TIME_LONG', 11);
  DATE_TIME_MEDIUM = new DateTimeFormat$PredefinedFormat_0('DATE_TIME_MEDIUM', 12);
  DATE_TIME_SHORT = new DateTimeFormat$PredefinedFormat_0('DATE_TIME_SHORT', 13);
  DAY = new DateTimeFormat$PredefinedFormat_0('DAY', 14);
  HOUR_MINUTE = new DateTimeFormat$PredefinedFormat_0('HOUR_MINUTE', 15);
  HOUR_MINUTE_SECOND = new DateTimeFormat$PredefinedFormat_0('HOUR_MINUTE_SECOND', 16);
  HOUR24_MINUTE = new DateTimeFormat$PredefinedFormat_0('HOUR24_MINUTE', 17);
  HOUR24_MINUTE_SECOND = new DateTimeFormat$PredefinedFormat_0('HOUR24_MINUTE_SECOND', 18);
  MINUTE_SECOND = new DateTimeFormat$PredefinedFormat_0('MINUTE_SECOND', 19);
  MONTH = new DateTimeFormat$PredefinedFormat_0('MONTH', 20);
  MONTH_ABBR = new DateTimeFormat$PredefinedFormat_0('MONTH_ABBR', 21);
  MONTH_ABBR_DAY = new DateTimeFormat$PredefinedFormat_0('MONTH_ABBR_DAY', 22);
  MONTH_DAY = new DateTimeFormat$PredefinedFormat_0('MONTH_DAY', 23);
  MONTH_NUM_DAY = new DateTimeFormat$PredefinedFormat_0('MONTH_NUM_DAY', 24);
  MONTH_WEEKDAY_DAY = new DateTimeFormat$PredefinedFormat_0('MONTH_WEEKDAY_DAY', 25);
  YEAR = new DateTimeFormat$PredefinedFormat_0('YEAR', 26);
  YEAR_MONTH = new DateTimeFormat$PredefinedFormat_0('YEAR_MONTH', 27);
  YEAR_MONTH_ABBR = new DateTimeFormat$PredefinedFormat_0('YEAR_MONTH_ABBR', 28);
  YEAR_MONTH_ABBR_DAY = new DateTimeFormat$PredefinedFormat_0('YEAR_MONTH_ABBR_DAY', 29);
  YEAR_MONTH_DAY = new DateTimeFormat$PredefinedFormat_0('YEAR_MONTH_DAY', 30);
  YEAR_MONTH_NUM = new DateTimeFormat$PredefinedFormat_0('YEAR_MONTH_NUM', 31);
  YEAR_MONTH_NUM_DAY = new DateTimeFormat$PredefinedFormat_0('YEAR_MONTH_NUM_DAY', 32);
  YEAR_QUARTER = new DateTimeFormat$PredefinedFormat_0('YEAR_QUARTER', 33);
  YEAR_QUARTER_ABBR = new DateTimeFormat$PredefinedFormat_0('YEAR_QUARTER_ABBR', 34);
  $VALUES_5 = initValues(_3Lcom_google_gwt_i18n_client_DateTimeFormat$PredefinedFormat_2_classLit, {9:1, 68:1, 170:1}, 77, [ISO_8601, RFC_2822, DATE_FULL, DATE_LONG, DATE_MEDIUM, DATE_SHORT, TIME_FULL, TIME_LONG, TIME_MEDIUM, TIME_SHORT, DATE_TIME_FULL, DATE_TIME_LONG, DATE_TIME_MEDIUM, DATE_TIME_SHORT, DAY, HOUR_MINUTE, HOUR_MINUTE_SECOND, HOUR24_MINUTE, HOUR24_MINUTE_SECOND, MINUTE_SECOND, MONTH, MONTH_ABBR, MONTH_ABBR_DAY, MONTH_DAY, MONTH_NUM_DAY, MONTH_WEEKDAY_DAY, YEAR, YEAR_MONTH, YEAR_MONTH_ABBR, YEAR_MONTH_ABBR_DAY, YEAR_MONTH_DAY, YEAR_MONTH_NUM, YEAR_MONTH_NUM_DAY, YEAR_QUARTER, YEAR_QUARTER_ABBR]);
}

function DateTimeFormat$PredefinedFormat_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_7(name_0){
  $clinit_204();
  return valueOf_0(($clinit_205() , $MAP_5), name_0);
}

function values_6(){
  $clinit_204();
  return $VALUES_5;
}

function DateTimeFormat$PredefinedFormat(){
}

_ = DateTimeFormat$PredefinedFormat_0.prototype = DateTimeFormat$PredefinedFormat.prototype = new Enum;
_.getClass$ = function getClass_107(){
  return Lcom_google_gwt_i18n_client_DateTimeFormat$PredefinedFormat_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 77:1};
var $VALUES_5, DATE_FULL, DATE_LONG, DATE_MEDIUM, DATE_SHORT, DATE_TIME_FULL, DATE_TIME_LONG, DATE_TIME_MEDIUM, DATE_TIME_SHORT, DAY, HOUR24_MINUTE, HOUR24_MINUTE_SECOND, HOUR_MINUTE, HOUR_MINUTE_SECOND, ISO_8601, MINUTE_SECOND, MONTH, MONTH_ABBR, MONTH_ABBR_DAY, MONTH_DAY, MONTH_NUM_DAY, MONTH_WEEKDAY_DAY, RFC_2822, TIME_FULL, TIME_LONG, TIME_MEDIUM, TIME_SHORT, YEAR, YEAR_MONTH, YEAR_MONTH_ABBR, YEAR_MONTH_ABBR_DAY, YEAR_MONTH_DAY, YEAR_MONTH_NUM, YEAR_MONTH_NUM_DAY, YEAR_QUARTER, YEAR_QUARTER_ABBR;
function $clinit_205(){
  $clinit_205 = nullMethod;
  $MAP_5 = createValueOfMap(($clinit_204() , $VALUES_5));
}

var $MAP_5;
function DefaultDateTimeFormatInfo(){
}

_ = DefaultDateTimeFormatInfo.prototype = new Object_0;
_.getClass$ = function getClass_108(){
  return Lcom_google_gwt_i18n_client_DefaultDateTimeFormatInfo_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_209(){
  $clinit_209 = nullMethod;
  RTL = new HasDirection$Direction_0('RTL', 0);
  LTR = new HasDirection$Direction_0('LTR', 1);
  DEFAULT = new HasDirection$Direction_0('DEFAULT', 2);
  $VALUES_6 = initValues(_3Lcom_google_gwt_i18n_client_HasDirection$Direction_2_classLit, {9:1, 68:1, 170:1}, 78, [RTL, LTR, DEFAULT]);
}

function HasDirection$Direction_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_8(name_0){
  $clinit_209();
  return valueOf_0(($clinit_210() , $MAP_6), name_0);
}

function values_7(){
  $clinit_209();
  return $VALUES_6;
}

function HasDirection$Direction(){
}

_ = HasDirection$Direction_0.prototype = HasDirection$Direction.prototype = new Enum;
_.getClass$ = function getClass_109(){
  return Lcom_google_gwt_i18n_client_HasDirection$Direction_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 78:1};
var $VALUES_6, DEFAULT, LTR, RTL;
function $clinit_210(){
  $clinit_210 = nullMethod;
  $MAP_6 = createValueOfMap(($clinit_209() , $VALUES_6));
}

var $MAP_6;
function $getDateTimeFormatInfo(this$static){
  !this$static.dateTimeFormatInfo && (this$static.dateTimeFormatInfo = new DateTimeFormatInfoImpl_en_0);
  return this$static.dateTimeFormatInfo;
}

function $getNumberConstants(this$static){
  !this$static.numberConstants && (this$static.numberConstants = new NumberConstantsImpl_en_0);
  return this$static.numberConstants;
}

function $clinit_214(){
  $clinit_214 = nullMethod;
  $getNumberConstants(($clinit_211() , $clinit_211() , instance_0));
}

function $addExponent(this$static, digits){
  var exponentDigits, i;
  digits.impl.string += 'E';
  if (this$static.exponent < 0) {
    this$static.exponent = -this$static.exponent;
    digits.impl.string += '-';
  }
  exponentDigits = '' + this$static.exponent;
  for (i = exponentDigits.length; i < this$static.minExponentDigits; ++i) {
    digits.impl.string += '0';
  }
  digits.impl.string += exponentDigits;
}

function $addZeroAndDecimal(this$static, digits){
  if (this$static.digitsLength == 0) {
    $replace(digits.impl, 0, 0, '0');
    ++this$static.decimalPosition;
    ++this$static.digitsLength;
  }
  if (this$static.decimalPosition < this$static.digitsLength || this$static.decimalSeparatorAlwaysShown) {
    $insert_3(digits, this$static.decimalPosition, '.');
    ++this$static.digitsLength;
  }
}

function $adjustFractionDigits(this$static, digits){
  var requiredDigits, toRemove;
  requiredDigits = this$static.decimalPosition + this$static.minimumFractionDigits;
  if (this$static.digitsLength < requiredDigits) {
    while (this$static.digitsLength < requiredDigits) {
      digits.impl.string += '0';
      ++this$static.digitsLength;
    }
  }
   else {
    toRemove = this$static.decimalPosition + this$static.maximumFractionDigits;
    toRemove > this$static.digitsLength && (toRemove = this$static.digitsLength);
    while (toRemove > requiredDigits && digits.impl.string.charCodeAt(toRemove - 1) == 48) {
      --toRemove;
    }
    if (toRemove < this$static.digitsLength) {
      $replace_3(digits, toRemove, this$static.digitsLength, '');
      this$static.digitsLength = toRemove;
    }
  }
}

function $computeExponent(this$static, digits){
  var remainder, strip;
  strip = 0;
  while (strip < this$static.digitsLength - 1 && digits.impl.string.charCodeAt(strip) == 48) {
    ++strip;
  }
  if (strip > 0) {
    $replace(digits.impl, 0, strip, '');
    this$static.digitsLength -= strip;
    this$static.exponent -= strip;
  }
  if (this$static.maximumIntegerDigits > this$static.minimumIntegerDigits && this$static.maximumIntegerDigits > 0) {
    this$static.exponent += this$static.decimalPosition - 1;
    remainder = this$static.exponent % this$static.maximumIntegerDigits;
    remainder < 0 && (remainder += this$static.maximumIntegerDigits);
    this$static.decimalPosition = remainder + 1;
    this$static.exponent -= remainder;
  }
   else {
    this$static.exponent += this$static.decimalPosition - this$static.minimumIntegerDigits;
    this$static.decimalPosition = this$static.minimumIntegerDigits;
  }
  if (this$static.digitsLength == 1 && digits.impl.string.charCodeAt(0) == 48) {
    this$static.exponent = 0;
    this$static.decimalPosition = this$static.minimumIntegerDigits;
  }
}

function $format_1(this$static, number){
  var buf, isNegative, preRound, scale, currentGroupingSize, useExponent;
  if (isNaN(number)) {
    return 'NaN';
  }
  isNegative = number < 0 || number == 0 && 1 / number < 0;
  isNegative && (number = -number);
  buf = new StringBuilder_0;
  if (!isFinite(number)) {
    $append_11(buf, isNegative?this$static.negativePrefix:this$static.positivePrefix);
    buf.impl.string += '\u221E';
    $append_11(buf, isNegative?this$static.negativeSuffix:this$static.positiveSuffix);
    return buf.impl.string;
  }
  number *= this$static.multiplier;
  scale = toScaledString(buf, number);
  preRound = buf.impl.string.length + scale + this$static.maximumFractionDigits + 3;
  if (preRound > 0 && preRound < buf.impl.string.length && buf.impl.string.charCodeAt(preRound) == 57) {
    $propagateCarry(this$static, buf, preRound - 1);
    scale += buf.impl.string.length - preRound;
    $replace_3(buf, preRound, buf.impl.string.length, '');
  }
  this$static.exponent = 0;
  this$static.digitsLength = buf.impl.string.length;
  this$static.decimalPosition = this$static.digitsLength + scale;
  useExponent = this$static.useExponentialNotation;
  currentGroupingSize = this$static.groupingSize;
  this$static.decimalPosition > 1024 && (useExponent = true);
  useExponent && $computeExponent(this$static, buf);
  $processLeadingZeros(this$static, buf);
  $roundValue(this$static, buf);
  $insertGroupingSeparators(this$static, buf, currentGroupingSize);
  $adjustFractionDigits(this$static, buf);
  $addZeroAndDecimal(this$static, buf);
  useExponent && $addExponent(this$static, buf);
  $insert_3(buf, 0, isNegative?this$static.negativePrefix:this$static.positivePrefix);
  $append_11(buf, isNegative?this$static.negativeSuffix:this$static.positiveSuffix);
  return buf.impl.string;
}

function $insertGroupingSeparators(this$static, digits, g){
  var i;
  if (g > 0) {
    for (i = g; i < this$static.decimalPosition; i += g + 1) {
      $insert_3(digits, this$static.decimalPosition - i, ',');
      ++this$static.decimalPosition;
      ++this$static.digitsLength;
    }
  }
}

function $parseAffix(this$static, pattern, start, affix, inNegativePattern){
  var ch, inQuote, len, pos;
  $replace_2(affix, affix.impl.string.length);
  inQuote = false;
  len = pattern.length;
  for (pos = start; pos < len; ++pos) {
    ch = pattern.charCodeAt(pos);
    if (ch == 39) {
      if (pos + 1 < len && pattern.charCodeAt(pos + 1) == 39) {
        ++pos;
        affix.impl.string += "'";
      }
       else {
        inQuote = !inQuote;
      }
      continue;
    }
    if (inQuote) {
      affix.impl.string += String.fromCharCode(ch);
    }
     else {
      switch (ch) {
        case 35:
        case 48:
        case 44:
        case 46:
        case 59:
          return pos - start;
        case 164:
          this$static.isCurrencyFormat = true;
          if (pos + 1 < len && pattern.charCodeAt(pos + 1) == 164) {
            ++pos;
            $append_5(affix, this$static.currencyCode);
          }
           else {
            $append_5(affix, this$static.currencySymbol);
          }

          break;
        case 37:
          if (!inNegativePattern) {
            if (this$static.multiplier != 1) {
              throw new IllegalArgumentException_1('Too many percent/per mille characters in pattern "' + pattern + '"');
            }
            this$static.multiplier = 100;
          }

          affix.impl.string += '%';
          break;
        case 8240:
          if (!inNegativePattern) {
            if (this$static.multiplier != 1) {
              throw new IllegalArgumentException_1('Too many percent/per mille characters in pattern "' + pattern + '"');
            }
            this$static.multiplier = 1000;
          }

          affix.impl.string += '\u2030';
          break;
        case 45:
          affix.impl.string += '-';
          break;
        default:affix.impl.string += String.fromCharCode(ch);
      }
    }
  }
  return len - start;
}

function $parsePattern_0(this$static, pattern){
  var affix, pos;
  pos = 0;
  affix = new StringBuffer_0;
  pos += $parseAffix(this$static, pattern, 0, affix, false);
  this$static.positivePrefix = affix.impl.string;
  pos += $parseTrunk(this$static, pattern, pos, false);
  pos += $parseAffix(this$static, pattern, pos, affix, false);
  this$static.positiveSuffix = affix.impl.string;
  if (pos < pattern.length && pattern.charCodeAt(pos) == 59) {
    ++pos;
    pos += $parseAffix(this$static, pattern, pos, affix, true);
    this$static.negativePrefix = affix.impl.string;
    pos += $parseTrunk(this$static, pattern, pos, true);
    pos += $parseAffix(this$static, pattern, pos, affix, true);
    this$static.negativeSuffix = affix.impl.string;
  }
   else {
    this$static.negativePrefix = '-' + this$static.positivePrefix;
    this$static.negativeSuffix = this$static.positiveSuffix;
  }
}

function $parseTrunk(this$static, pattern, start, ignorePattern){
  var ch, decimalPos, digitLeftCount, digitRightCount, effectiveDecimalPos, groupingCount, len, loop, n, pos, totalDigits, zeroDigitCount;
  decimalPos = -1;
  digitLeftCount = 0;
  zeroDigitCount = 0;
  digitRightCount = 0;
  groupingCount = -1;
  len = pattern.length;
  pos = start;
  loop = true;
  for (; pos < len && loop; ++pos) {
    ch = pattern.charCodeAt(pos);
    switch (ch) {
      case 35:
        zeroDigitCount > 0?++digitRightCount:++digitLeftCount;
        groupingCount >= 0 && decimalPos < 0 && ++groupingCount;
        break;
      case 48:
        if (digitRightCount > 0) {
          throw new IllegalArgumentException_1("Unexpected '0' in pattern \"" + pattern + '"');
        }

        ++zeroDigitCount;
        groupingCount >= 0 && decimalPos < 0 && ++groupingCount;
        break;
      case 44:
        groupingCount = 0;
        break;
      case 46:
        if (decimalPos >= 0) {
          throw new IllegalArgumentException_1('Multiple decimal separators in pattern "' + pattern + '"');
        }

        decimalPos = digitLeftCount + zeroDigitCount + digitRightCount;
        break;
      case 69:
        if (!ignorePattern) {
          if (this$static.useExponentialNotation) {
            throw new IllegalArgumentException_1('Multiple exponential symbols in pattern "' + pattern + '"');
          }
          this$static.useExponentialNotation = true;
          this$static.minExponentDigits = 0;
        }

        while (pos + 1 < len && pattern.charCodeAt(pos + 1) == 48) {
          ++pos;
          ignorePattern || ++this$static.minExponentDigits;
        }

        if (!ignorePattern && digitLeftCount + zeroDigitCount < 1 || this$static.minExponentDigits < 1) {
          throw new IllegalArgumentException_1('Malformed exponential pattern "' + pattern + '"');
        }

        loop = false;
        break;
      default:--pos;
        loop = false;
    }
  }
  if (zeroDigitCount == 0 && digitLeftCount > 0 && decimalPos >= 0) {
    n = decimalPos;
    decimalPos == 0 && ++n;
    digitRightCount = digitLeftCount - n;
    digitLeftCount = n - 1;
    zeroDigitCount = 1;
  }
  if (decimalPos < 0 && digitRightCount > 0 || decimalPos >= 0 && (decimalPos < digitLeftCount || decimalPos > digitLeftCount + zeroDigitCount) || groupingCount == 0) {
    throw new IllegalArgumentException_1('Malformed pattern "' + pattern + '"');
  }
  if (ignorePattern) {
    return pos - start;
  }
  totalDigits = digitLeftCount + zeroDigitCount + digitRightCount;
  this$static.maximumFractionDigits = decimalPos >= 0?totalDigits - decimalPos:0;
  if (decimalPos >= 0) {
    this$static.minimumFractionDigits = digitLeftCount + zeroDigitCount - decimalPos;
    this$static.minimumFractionDigits < 0 && (this$static.minimumFractionDigits = 0);
  }
  effectiveDecimalPos = decimalPos >= 0?decimalPos:totalDigits;
  this$static.minimumIntegerDigits = effectiveDecimalPos - digitLeftCount;
  if (this$static.useExponentialNotation) {
    this$static.maximumIntegerDigits = digitLeftCount + this$static.minimumIntegerDigits;
    this$static.maximumFractionDigits == 0 && this$static.minimumIntegerDigits == 0 && (this$static.minimumIntegerDigits = 1);
  }
  this$static.groupingSize = groupingCount > 0?groupingCount:0;
  this$static.decimalSeparatorAlwaysShown = decimalPos == 0 || decimalPos == totalDigits;
  return pos - start;
}

function $processLeadingZeros(this$static, digits){
  var i, prefix, strip;
  if (this$static.decimalPosition > this$static.digitsLength) {
    while (this$static.digitsLength < this$static.decimalPosition) {
      digits.impl.string += '0';
      ++this$static.digitsLength;
    }
  }
  if (!this$static.useExponentialNotation) {
    if (this$static.decimalPosition < this$static.minimumIntegerDigits) {
      prefix = new StringBuilder_0;
      while (this$static.decimalPosition < this$static.minimumIntegerDigits) {
        prefix.impl.string += '0';
        ++this$static.decimalPosition;
        ++this$static.digitsLength;
      }
      $insert_3(digits, 0, prefix.impl.string);
    }
     else if (this$static.decimalPosition > this$static.minimumIntegerDigits) {
      strip = this$static.decimalPosition - this$static.minimumIntegerDigits;
      for (i = 0; i < strip; ++i) {
        if (digits.impl.string.charCodeAt(i) != 48) {
          strip = i;
          break;
        }
      }
      if (strip > 0) {
        $replace(digits.impl, 0, strip, '');
        this$static.digitsLength -= strip;
        this$static.decimalPosition -= strip;
      }
    }
  }
}

function $propagateCarry(this$static, digits, i){
  var carry, digit;
  carry = true;
  while (carry && i >= 0) {
    digit = digits.impl.string.charCodeAt(i);
    if (digit == 57) {
      $setCharAt(digits, i--, 48);
    }
     else {
      $replace_3(digits, i, i + 1, String.fromCharCode(digit + 1 & 65535));
      carry = false;
    }
  }
  if (carry) {
    $replace(digits.impl, 0, 0, '1');
    ++this$static.decimalPosition;
    ++this$static.digitsLength;
  }
}

function $roundValue(this$static, digits){
  var i;
  if (this$static.digitsLength > this$static.decimalPosition + this$static.maximumFractionDigits && digits.impl.string.charCodeAt(this$static.decimalPosition + this$static.maximumFractionDigits) >= 53) {
    i = this$static.decimalPosition + this$static.maximumFractionDigits - 1;
    $propagateCarry(this$static, digits, i);
  }
}

function NumberFormat_0(cdata, userSuppliedPattern){
  if (!cdata) {
    throw new IllegalArgumentException_1('Unknown currency code');
  }
  this.pattern = '0000000000.000';
  this.currencyCode = cdata.typeMarker$ == nullMethod?cdata.getCurrencyCode():cdata[0];
  this.currencySymbol = cdata.typeMarker$ == nullMethod?cdata.getCurrencySymbol():cdata[1];
  $parsePattern_0(this, this.pattern);
  if (!userSuppliedPattern && this.isCurrencyFormat) {
    this.minimumFractionDigits = cdata.typeMarker$ == nullMethod?cdata.getDefaultFractionDigits():dynamicCastJso(cdata)[2] & 7;
    this.maximumFractionDigits = this.minimumFractionDigits;
  }
}

function NumberFormat_1(cdata){
  $clinit_214();
  NumberFormat_0.call(this, cdata, true);
}

function toScaledString(buf, val){
  var dot, expDigits, expIdx, scale, startLen;
  startLen = buf.impl.string.length;
  $append_11(buf, val.toPrecision(20));
  scale = 0;
  expIdx = buf.impl.string.indexOf('e', startLen);
  expIdx < 0 && (expIdx = buf.impl.string.indexOf('E', startLen));
  if (expIdx >= 0) {
    expDigits = expIdx + 1;
    expDigits < buf.impl.string.length && buf.impl.string.charCodeAt(expDigits) == 43 && ++expDigits;
    expDigits < buf.impl.string.length && (scale = __parseAndValidateInt($substring(buf.impl.string, expDigits), 10));
    $replace_3(buf, expIdx, buf.impl.string.length, '');
  }
  dot = buf.impl.string.indexOf('.', startLen);
  if (dot >= 0) {
    $replace(buf.impl, dot, dot + 1, '');
    scale -= buf.impl.string.length - dot;
  }
  return scale;
}

function NumberFormat(){
}

_ = NumberFormat_1.prototype = NumberFormat.prototype = new Object_0;
_.getClass$ = function getClass_111(){
  return Lcom_google_gwt_i18n_client_NumberFormat_2_classLit;
}
;
_.castableTypeMap$ = {};
_.currencyCode = null;
_.currencySymbol = null;
_.decimalPosition = 0;
_.decimalSeparatorAlwaysShown = false;
_.digitsLength = 0;
_.exponent = 0;
_.groupingSize = 3;
_.isCurrencyFormat = false;
_.maximumFractionDigits = 3;
_.maximumIntegerDigits = 40;
_.minExponentDigits = 0;
_.minimumFractionDigits = 0;
_.minimumIntegerDigits = 1;
_.multiplier = 1;
_.negativePrefix = '-';
_.negativeSuffix = '';
_.pattern = null;
_.positivePrefix = '';
_.positiveSuffix = '';
_.useExponentialNotation = false;
function $getISOTimeZoneString(this$static){
  var data, offset;
  offset = -this$static.standardOffset;
  data = initValues(_3C_classLit, {9:1}, -1, [43, 48, 48, 58, 48, 48]);
  if (offset < 0) {
    data[0] = 45;
    offset = -offset;
  }
  data[1] += ~~(~~(offset / 60) / 10);
  data[2] += ~~(offset / 60) % 10;
  data[4] += ~~(offset % 60 / 10);
  data[5] += offset % 10;
  return String.fromCharCode.apply(null, data);
}

function $getRFCTimeZoneString(this$static){
  var data, offset;
  offset = -this$static.standardOffset;
  data = initValues(_3C_classLit, {9:1}, -1, [43, 48, 48, 48, 48]);
  if (offset < 0) {
    data[0] = 45;
    offset = -offset;
  }
  data[1] += ~~(~~(offset / 60) / 10);
  data[2] += ~~(offset / 60) % 10;
  data[3] += ~~(offset % 60 / 10);
  data[4] += offset % 10;
  return String.fromCharCode.apply(null, data);
}

function TimeZone_0(){
}

function composeGMTString(offset){
  var data;
  data = initValues(_3C_classLit, {9:1}, -1, [71, 77, 84, 45, 48, 48, 58, 48, 48]);
  if (offset <= 0) {
    data[3] = 43;
    offset = -offset;
  }
  data[4] += ~~(~~(offset / 60) / 10);
  data[5] += ~~(offset / 60) % 10;
  data[7] += ~~(offset % 60 / 10);
  data[8] += offset % 10;
  return String.fromCharCode.apply(null, data);
}

function composePOSIXTimeZoneID(offset){
  var str;
  if (offset == 0) {
    return 'Etc/GMT';
  }
  if (offset < 0) {
    offset = -offset;
    str = 'Etc/GMT-';
  }
   else {
    str = 'Etc/GMT+';
  }
  return str + offsetDisplay(offset);
}

function composeUTCString(offset){
  var str;
  if (offset == 0) {
    return 'UTC';
  }
  if (offset < 0) {
    offset = -offset;
    str = 'UTC+';
  }
   else {
    str = 'UTC-';
  }
  return str + offsetDisplay(offset);
}

function createTimeZone(timeZoneOffsetInMinutes){
  var tz;
  tz = new TimeZone_0;
  tz.standardOffset = timeZoneOffsetInMinutes;
  tz.timezoneID = composePOSIXTimeZoneID(timeZoneOffsetInMinutes);
  tz.tzNames = initDim(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, 2, 0);
  tz.tzNames[0] = composeUTCString(timeZoneOffsetInMinutes);
  tz.tzNames[1] = composeUTCString(timeZoneOffsetInMinutes);
  return tz;
}

function offsetDisplay(offset){
  var hour, mins;
  hour = ~~(offset / 60);
  mins = offset % 60;
  if (mins == 0) {
    return '' + hour;
  }
  return '' + hour + ':' + mins;
}

function TimeZone(){
}

_ = TimeZone_0.prototype = TimeZone.prototype = new Object_0;
_.getClass$ = function getClass_112(){
  return Lcom_google_gwt_i18n_client_TimeZone_2_classLit;
}
;
_.castableTypeMap$ = {};
_.standardOffset = 0;
_.timezoneID = null;
_.tzNames = null;
function NumberConstantsImpl_en_0(){
}

function NumberConstantsImpl_en(){
}

_ = NumberConstantsImpl_en_0.prototype = NumberConstantsImpl_en.prototype = new Object_0;
_.getClass$ = function getClass_113(){
  return Lcom_google_gwt_i18n_client_constants_NumberConstantsImpl_1en_2_classLit;
}
;
_.castableTypeMap$ = {};
function DateTimeFormatInfoImpl(){
}

_ = DateTimeFormatInfoImpl.prototype = new DefaultDateTimeFormatInfo;
_.getClass$ = function getClass_114(){
  return Lcom_google_gwt_i18n_client_impl_cldr_DateTimeFormatInfoImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
function DateTimeFormatInfoImpl_en_0(){
}

function DateTimeFormatInfoImpl_en(){
}

_ = DateTimeFormatInfoImpl_en_0.prototype = DateTimeFormatInfoImpl_en.prototype = new DateTimeFormatInfoImpl;
_.getClass$ = function getClass_115(){
  return Lcom_google_gwt_i18n_client_impl_cldr_DateTimeFormatInfoImpl_1en_2_classLit;
}
;
_.castableTypeMap$ = {};
function JSONValue(){
}

_ = JSONValue.prototype = new Object_0;
_.getClass$ = function getClass_116(){
  return Lcom_google_gwt_json_client_JSONValue_2_classLit;
}
;
_.isArray = function isArray(){
  return null;
}
;
_.isBoolean = function isBoolean(){
  return null;
}
;
_.isNumber = function isNumber(){
  return null;
}
;
_.isObject = function isObject(){
  return null;
}
;
_.isString = function isString(){
  return null;
}
;
_.castableTypeMap$ = {};
function $get_2(this$static, index){
  var v = this$static.jsArray[index];
  var func = ($clinit_233() , typeMap)[typeof v];
  return func?func(v):throwUnknownTypeException(typeof v);
}

function $set0(this$static, index, value){
  if (value) {
    var func = value.getUnwrapper();
    value = func(value);
  }
   else {
    value = undefined;
  }
  this$static.jsArray[index] = value;
}

function JSONArray_0(){
  this.jsArray = [];
}

function JSONArray_1(arr){
  this.jsArray = arr;
}

function unwrap(value){
  return value.jsArray;
}

function JSONArray(){
}

_ = JSONArray_1.prototype = JSONArray_0.prototype = JSONArray.prototype = new JSONValue;
_.equals$ = function equals_2(other){
  if (!(other != null && other.castableTypeMap$ && !!other.castableTypeMap$[47])) {
    return false;
  }
  return this.jsArray == dynamicCast(other, 47).jsArray;
}
;
_.getClass$ = function getClass_117(){
  return Lcom_google_gwt_json_client_JSONArray_2_classLit;
}
;
_.getUnwrapper = function getUnwrapper(){
  return unwrap;
}
;
_.hashCode$ = function hashCode_4(){
  return getHashCode(this.jsArray);
}
;
_.isArray = function isArray_0(){
  return this;
}
;
_.toString$ = function toString_7(){
  var c, i, sb;
  sb = new StringBuffer_0;
  sb.impl.string += '[';
  for (i = 0 , c = this.jsArray.length; i < c; ++i) {
    i > 0 && (sb.impl.string += ',' , sb);
    $append_4(sb, $get_2(this, i));
  }
  sb.impl.string += ']';
  return sb.impl.string;
}
;
_.castableTypeMap$ = {47:1};
_.jsArray = null;
function $clinit_225(){
  $clinit_225 = nullMethod;
  FALSE = new JSONBoolean_0(false);
  TRUE = new JSONBoolean_0(true);
}

function JSONBoolean_0(value){
  this.value_0 = value;
}

function unwrap_0(value){
  return value.value_0;
}

function JSONBoolean(){
}

_ = JSONBoolean_0.prototype = JSONBoolean.prototype = new JSONValue;
_.getClass$ = function getClass_118(){
  return Lcom_google_gwt_json_client_JSONBoolean_2_classLit;
}
;
_.getUnwrapper = function getUnwrapper_0(){
  return unwrap_0;
}
;
_.isBoolean = function isBoolean_0(){
  return this;
}
;
_.toString$ = function toString_8(){
  return $clinit_428() , '' + this.value_0;
}
;
_.castableTypeMap$ = {};
_.value_0 = false;
var FALSE, TRUE;
function JSONException_0(message){
  this.fillInStackTrace();
  this.detailMessage = message;
}

function JSONException_1(cause){
  Exception_3.call(this, cause);
}

function JSONException(){
}

_ = JSONException_1.prototype = JSONException_0.prototype = JSONException.prototype = new RuntimeException;
_.getClass$ = function getClass_119(){
  return Lcom_google_gwt_json_client_JSONException_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 21:1, 39:1, 183:1};
function $clinit_227(){
  $clinit_227 = nullMethod;
  instance_1 = new JSONNull_0;
}

function JSONNull_0(){
}

function unwrap_1(){
  return null;
}

function JSONNull(){
}

_ = JSONNull_0.prototype = JSONNull.prototype = new JSONValue;
_.getClass$ = function getClass_120(){
  return Lcom_google_gwt_json_client_JSONNull_2_classLit;
}
;
_.getUnwrapper = function getUnwrapper_1(){
  return unwrap_1;
}
;
_.toString$ = function toString_9(){
  return 'null';
}
;
_.castableTypeMap$ = {};
var instance_1;
function JSONNumber_0(value){
  this.value_0 = value;
}

function unwrap_2(value){
  return value.value_0;
}

function JSONNumber(){
}

_ = JSONNumber_0.prototype = JSONNumber.prototype = new JSONValue;
_.equals$ = function equals_3(other){
  if (!(other != null && other.castableTypeMap$ && !!other.castableTypeMap$[48])) {
    return false;
  }
  return this.value_0 == dynamicCast(other, 48).value_0;
}
;
_.getClass$ = function getClass_121(){
  return Lcom_google_gwt_json_client_JSONNumber_2_classLit;
}
;
_.getUnwrapper = function getUnwrapper_2(){
  return unwrap_2;
}
;
_.hashCode$ = function hashCode_5(){
  return ~~Math.max(Math.min((new Double_0(this.value_0)).value_0, 2147483647), -2147483648);
}
;
_.isNumber = function isNumber_0(){
  return this;
}
;
_.toString$ = function toString_10(){
  return this.value_0 + '';
}
;
_.castableTypeMap$ = {48:1};
_.value_0 = 0;
function $computeKeys0(this$static, result){
  var jsObject = this$static.jsObject;
  var i = 0;
  for (var key in jsObject) {
    jsObject.hasOwnProperty(key) && (result[i++] = key);
  }
  return result;
}

function $containsKey(this$static, key){
  return key in this$static.jsObject;
}

function $get_3(this$static, key){
  if (key == null) {
    throw new NullPointerException_0;
  }
  return $get0(this$static, key);
}

function $get0(this$static, key){
  var jsObject = this$static.jsObject;
  var v;
  key = String(key);
  jsObject.hasOwnProperty(key) && (v = jsObject[key]);
  var func = ($clinit_233() , typeMap)[typeof v];
  var ret = func?func(v):throwUnknownTypeException(typeof v);
  return ret;
}

function $keySet(this$static){
  var keys;
  keys = $computeKeys0(this$static, initDim(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, 0, 0));
  return new JSONObject$1_0(this$static, keys);
}

function $put(this$static, key, jsonValue){
  var previous;
  if (key == null) {
    throw new NullPointerException_0;
  }
  previous = $get_3(this$static, key);
  $put0(this$static, key, jsonValue);
  return previous;
}

function $put0(this$static, key, value){
  if (value) {
    var func = value.getUnwrapper();
    this$static.jsObject[key] = func(value);
  }
   else {
    delete this$static.jsObject[key];
  }
}

function $toString_6(this$static){
  var first, key, key$index, key$max, keys, sb;
  sb = new StringBuffer_0;
  sb.impl.string += '{';
  first = true;
  keys = $computeKeys0(this$static, initDim(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, 0, 0));
  for (key$index = 0 , key$max = keys.length; key$index < key$max; ++key$index) {
    key = keys[key$index];
    first?(first = false):(sb.impl.string += ', ' , sb);
    $append_5(sb, escapeValue(key));
    sb.impl.string += ':';
    $append_4(sb, $get_3(this$static, key));
  }
  sb.impl.string += '}';
  return sb.impl.string;
}

function JSONObject_0(){
  this.jsObject = {};
}

function JSONObject_1(jsValue){
  this.jsObject = jsValue;
}

function unwrap_3(value){
  return value.jsObject;
}

function JSONObject(){
}

_ = JSONObject_1.prototype = JSONObject_0.prototype = JSONObject.prototype = new JSONValue;
_.equals$ = function equals_4(other){
  if (!(other != null && other.castableTypeMap$ && !!other.castableTypeMap$[49])) {
    return false;
  }
  return this.jsObject == dynamicCast(other, 49).jsObject;
}
;
_.getClass$ = function getClass_122(){
  return Lcom_google_gwt_json_client_JSONObject_2_classLit;
}
;
_.getUnwrapper = function getUnwrapper_3(){
  return unwrap_3;
}
;
_.hashCode$ = function hashCode_6(){
  return getHashCode(this.jsObject);
}
;
_.isObject = function isObject_0(){
  return this;
}
;
_.toString$ = function toString_11(){
  return $toString_6(this);
}
;
_.castableTypeMap$ = {49:1};
_.jsObject = null;
function $clear_0(this$static){
  var iter;
  iter = this$static.iterator_0();
  while (iter.hasNext()) {
    iter.next_0();
    iter.remove_1();
  }
}

_ = AbstractCollection.prototype;
_.addAll = function addAll(c){
  return $addAll(this, c);
}
;
_.clear = function clear(){
  $clear_0(this);
}
;
_.toArray = function toArray(){
  return this.toArray_0(initDim(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, this.size_1(), 0));
}
;
_.toArray_0 = function toArray_0(a_0){
  return $toArray(this, a_0);
}
;
function $removeAll(this$static, c){
  var iter, o, size;
  size = this$static.size_1();
  if (size < c.size_1()) {
    for (iter = this$static.iterator_0(); iter.hasNext();) {
      o = iter.next_0();
      c.contains(o) && iter.remove_1();
    }
  }
   else {
    for (iter = c.iterator_0(); iter.hasNext();) {
      o = iter.next_0();
      this$static.remove_0(o);
    }
  }
  return size != this$static.size_1();
}

_ = AbstractSet.prototype;
_.removeAll = function removeAll(c){
  return $removeAll(this, c);
}
;
function JSONObject$1_0(this$0, val$keys){
  this.this$0 = this$0;
  this.val$keys = val$keys;
}

function JSONObject$1(){
}

_ = JSONObject$1_0.prototype = JSONObject$1.prototype = new AbstractSet;
_.contains = function contains_0(o){
  return o != null && o.castableTypeMap$ && !!o.castableTypeMap$[1] && $containsKey(this.this$0, dynamicCast(o, 1));
}
;
_.getClass$ = function getClass_125(){
  return Lcom_google_gwt_json_client_JSONObject$1_2_classLit;
}
;
_.iterator_0 = function iterator_0(){
  return new AbstractList$IteratorImpl_0(new Arrays$ArrayList_0(this.val$keys));
}
;
_.size_1 = function size_2(){
  return this.val$keys.length;
}
;
_.castableTypeMap$ = {168:1, 363:1};
_.this$0 = null;
_.val$keys = null;
function $clinit_233(){
  $clinit_233 = nullMethod;
  typeMap = {'boolean':createBoolean, number:createNumber, string:createString, object:createObject_0, 'function':createObject_0, undefined:createUndefined};
}

function createBoolean(v){
  return $clinit_225() , v?TRUE:FALSE;
}

function createNumber(v){
  return new JSONNumber_0(v);
}

function createObject_0(o){
  if (!o) {
    return $clinit_227() , instance_1;
  }
  var v = o.valueOf?o.valueOf():o;
  if (v !== o) {
    var func = typeMap[typeof v];
    return func?func(v):throwUnknownTypeException(typeof v);
  }
   else if (o instanceof Array || o instanceof $wnd.Array) {
    return new JSONArray_1(o);
  }
   else {
    return new JSONObject_1(o);
  }
}

function createString(v){
  return new JSONString_0(v);
}

function createUndefined(){
  return null;
}

function evaluate(json, strict){
  var v;
  if (strict && ($clinit_16() , hasJsonParse)) {
    try {
      v = JSON.parse(json);
    }
     catch (e) {
      return throwJSONException('Error parsing JSON: ' + e);
    }
  }
   else {
    if (strict) {
      if (!($clinit_16() , !/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/.test(json.replace(/"(\\.|[^"\\])*"/g, '')))) {
        return throwJSONException('Illegal character in JSON string');
      }
    }
    json = escapeJsonForEval(json);
    try {
      v = eval('(' + json + ')');
    }
     catch (e) {
      return throwJSONException('Error parsing JSON: ' + e);
    }
  }
  var func = typeMap[typeof v];
  return func?func(v):throwUnknownTypeException(typeof v);
}

function parse(jsonString, strict){
  $clinit_233();
  var $e0, ex;
  if (jsonString == null) {
    throw new NullPointerException_0;
  }
  if (jsonString.length == 0) {
    throw new IllegalArgumentException_1('empty argument');
  }
  try {
    return evaluate(jsonString, strict);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 44)) {
      ex = $e0;
      throw new JSONException_1(ex);
    }
     else 
      throw $e0;
  }
}

function throwJSONException(message){
  throw new JSONException_0(message);
}

function throwUnknownTypeException(typeString){
  $clinit_233();
  throw new JSONException_0("Unexpected typeof result '" + typeString + "'; please report this bug to the GWT team");
}

var typeMap;
function JSONString_0(value){
  if (value == null) {
    throw new NullPointerException_0;
  }
  this.value_0 = value;
}

function unwrap_4(value){
  return value.value_0;
}

function JSONString(){
}

_ = JSONString_0.prototype = JSONString.prototype = new JSONValue;
_.equals$ = function equals_6(other){
  if (!(other != null && other.castableTypeMap$ && !!other.castableTypeMap$[50])) {
    return false;
  }
  return $equals_3(this.value_0, dynamicCast(other, 50).value_0);
}
;
_.getClass$ = function getClass_126(){
  return Lcom_google_gwt_json_client_JSONString_2_classLit;
}
;
_.getUnwrapper = function getUnwrapper_4(){
  return unwrap_4;
}
;
_.hashCode$ = function hashCode_8(){
  return getHashCode_0(this.value_0);
}
;
_.isString = function isString_0(){
  return this;
}
;
_.toString$ = function toString_13(){
  return escapeValue(this.value_0);
}
;
_.castableTypeMap$ = {50:1};
_.value_0 = null;
function clone_0(array){
  var a_0, result;
  return a_0 = array , result = a_0.slice(0, array.length) , initValues(a_0.arrayClass$, a_0.castableTypeMap$, a_0.queryId$, result) , result;
}

function create_2(value){
  var a0, a1, a2;
  a0 = value & 4194303;
  a1 = ~~value >> 22 & 4194303;
  a2 = value < 0?1048575:0;
  return a = new LongLibBase$LongEmul_0 , a.l = a0 , a.m = a1 , a.h = a2 , a;
}

function create_3(a_0){
  return create0(a_0.l, a_0.m, a_0.h);
}

function create0(l_0, m_0, h_0){
  return a = new LongLibBase$LongEmul_0 , a.l = l_0 , a.m = m_0 , a.h = h_0 , a;
}

function divMod(a_0, b, computeRemainder){
  var aIsCopy, aIsMinValue, aIsNegative, bpower, c, negative;
  if (b.l == 0 && b.m == 0 && b.h == 0) {
    throw new ArithmeticException_0;
  }
  if (a_0.l == 0 && a_0.m == 0 && a_0.h == 0) {
    computeRemainder && (remainder_0 = create0(0, 0, 0));
    return create0(0, 0, 0);
  }
  if (b.h == 524288 && b.m == 0 && b.l == 0) {
    return divModByMinValue(a_0, computeRemainder);
  }
  negative = false;
  if (~~b.h >> 19 != 0) {
    b = neg(b);
    negative = true;
  }
  bpower = powerOfTwo(b);
  aIsNegative = false;
  aIsMinValue = false;
  aIsCopy = false;
  if (a_0.h == 524288 && a_0.m == 0 && a_0.l == 0) {
    aIsMinValue = true;
    aIsNegative = true;
    if (bpower == -1) {
      a_0 = create_3(($clinit_243() , MAX_VALUE));
      aIsCopy = true;
      negative = !negative;
    }
     else {
      c = shr(a_0, bpower);
      negative && negate(c);
      computeRemainder && (remainder_0 = create0(0, 0, 0));
      return c;
    }
  }
   else if (~~a_0.h >> 19 != 0) {
    aIsNegative = true;
    a_0 = neg(a_0);
    aIsCopy = true;
    negative = !negative;
  }
  if (bpower != -1) {
    return divModByShift(a_0, bpower, negative, aIsNegative, computeRemainder);
  }
  if (!gte_0(a_0, b)) {
    computeRemainder && (aIsNegative?(remainder_0 = neg(a_0)):(remainder_0 = create0(a_0.l, a_0.m, a_0.h)));
    return create0(0, 0, 0);
  }
  return divModHelper(aIsCopy?a_0:create0(a_0.l, a_0.m, a_0.h), b, negative, aIsNegative, aIsMinValue, computeRemainder);
}

function divModByMinValue(a_0, computeRemainder){
  if (a_0.h == 524288 && a_0.m == 0 && a_0.l == 0) {
    computeRemainder && (remainder_0 = create0(0, 0, 0));
    return create_3(($clinit_243() , ONE));
  }
  computeRemainder && (remainder_0 = create0(a_0.l, a_0.m, a_0.h));
  return create0(0, 0, 0);
}

function divModByShift(a_0, bpower, negative, aIsNegative, computeRemainder){
  var c;
  c = shr(a_0, bpower);
  negative && negate(c);
  if (computeRemainder) {
    a_0 = maskRight(a_0, bpower);
    aIsNegative?(remainder_0 = neg(a_0)):(remainder_0 = create0(a_0.l, a_0.m, a_0.h));
  }
  return c;
}

function divModHelper(a_0, b, negative, aIsNegative, aIsMinValue, computeRemainder){
  var bshift, gte, quotient, shift, a0, a1, a2;
  shift = numberOfLeadingZeros(b) - numberOfLeadingZeros(a_0);
  bshift = shl(b, shift);
  quotient = create0(0, 0, 0);
  while (shift >= 0) {
    gte = trialSubtract(a_0, bshift);
    if (gte) {
      shift < 22?(quotient.l |= 1 << shift , undefined):shift < 44?(quotient.m |= 1 << shift - 22 , undefined):(quotient.h |= 1 << shift - 44 , undefined);
      if (a_0.l == 0 && a_0.m == 0 && a_0.h == 0) {
        break;
      }
    }
    a1 = bshift.m;
    a2 = bshift.h;
    a0 = bshift.l;
    bshift.h = ~~a2 >>> 1;
    bshift.m = ~~a1 >>> 1 | (a2 & 1) << 21;
    bshift.l = ~~a0 >>> 1 | (a1 & 1) << 21;
    --shift;
  }
  negative && negate(quotient);
  if (computeRemainder) {
    if (aIsNegative) {
      remainder_0 = neg(a_0);
      aIsMinValue && (remainder_0 = sub(remainder_0, ($clinit_243() , ONE)));
    }
     else {
      remainder_0 = create0(a_0.l, a_0.m, a_0.h);
    }
  }
  return quotient;
}

function maskRight(a_0, bits){
  var b0, b1, b2;
  if (bits <= 22) {
    b0 = a_0.l & (1 << bits) - 1;
    b1 = b2 = 0;
  }
   else if (bits <= 44) {
    b0 = a_0.l;
    b1 = a_0.m & (1 << bits - 22) - 1;
    b2 = 0;
  }
   else {
    b0 = a_0.l;
    b1 = a_0.m;
    b2 = a_0.h & (1 << bits - 44) - 1;
  }
  return create0(b0, b1, b2);
}

function negate(a_0){
  var neg0, neg1, neg2;
  neg0 = ~a_0.l + 1 & 4194303;
  neg1 = ~a_0.m + (neg0 == 0?1:0) & 4194303;
  neg2 = ~a_0.h + (neg0 == 0 && neg1 == 0?1:0) & 1048575;
  a_0.l = neg0;
  a_0.m = neg1;
  a_0.h = neg2;
}

function numberOfLeadingZeros(a_0){
  var b1, b2;
  b2 = numberOfLeadingZeros_0(a_0.h);
  if (b2 == 32) {
    b1 = numberOfLeadingZeros_0(a_0.m);
    return b1 == 32?numberOfLeadingZeros_0(a_0.l) + 32:b1 + 20 - 10;
  }
   else {
    return b2 - 12;
  }
}

function powerOfTwo(a_0){
  var h_0, l_0, m_0;
  l_0 = a_0.l;
  if ((l_0 & l_0 - 1) != 0) {
    return -1;
  }
  m_0 = a_0.m;
  if ((m_0 & m_0 - 1) != 0) {
    return -1;
  }
  h_0 = a_0.h;
  if ((h_0 & h_0 - 1) != 0) {
    return -1;
  }
  if (h_0 == 0 && m_0 == 0 && l_0 == 0) {
    return -1;
  }
  if (h_0 == 0 && m_0 == 0 && l_0 != 0) {
    return numberOfTrailingZeros(l_0);
  }
  if (h_0 == 0 && m_0 != 0 && l_0 == 0) {
    return numberOfTrailingZeros(m_0) + 22;
  }
  if (h_0 != 0 && m_0 == 0 && l_0 == 0) {
    return numberOfTrailingZeros(h_0) + 44;
  }
  return -1;
}

function toDoubleHelper(a_0){
  return a_0.l + a_0.m * 4194304 + a_0.h * 17592186044416;
}

function trialSubtract(a_0, b){
  var sum0, sum1, sum2;
  sum2 = a_0.h - b.h;
  if (sum2 < 0) {
    return false;
  }
  sum0 = a_0.l - b.l;
  sum1 = a_0.m - b.m + (~~sum0 >> 22);
  sum2 += ~~sum1 >> 22;
  if (sum2 < 0) {
    return false;
  }
  a_0.l = sum0 & 4194303;
  a_0.m = sum1 & 4194303;
  a_0.h = sum2 & 1048575;
  return true;
}

var remainder_0 = null;
function add_1(a_0, b){
  var sum0, sum1, sum2;
  sum0 = a_0.l + b.l;
  sum1 = a_0.m + b.m + (~~sum0 >> 22);
  sum2 = a_0.h + b.h + (~~sum1 >> 22);
  return create0(sum0 & 4194303, sum1 & 4194303, sum2 & 1048575);
}

function and(a_0, b){
  return create0(a_0.l & b.l, a_0.m & b.m, a_0.h & b.h);
}

function eq(a_0, b){
  return a_0.l == b.l && a_0.m == b.m && a_0.h == b.h;
}

function fromDouble(value){
  var a0, a1, a2, negative, result;
  if (isNaN(value)) {
    return $clinit_243() , ZERO;
  }
  if (value < -9223372036854775808) {
    return $clinit_243() , MIN_VALUE;
  }
  if (value >= 9223372036854775807) {
    return $clinit_243() , MAX_VALUE;
  }
  negative = false;
  if (value < 0) {
    negative = true;
    value = -value;
  }
  a2 = 0;
  if (value >= 17592186044416) {
    a2 = ~~Math.max(Math.min(value / 17592186044416, 2147483647), -2147483648);
    value -= a2 * 17592186044416;
  }
  a1 = 0;
  if (value >= 4194304) {
    a1 = ~~Math.max(Math.min(value / 4194304, 2147483647), -2147483648);
    value -= a1 * 4194304;
  }
  a0 = ~~Math.max(Math.min(value, 2147483647), -2147483648);
  result = (a = new LongLibBase$LongEmul_0 , a.l = a0 , a.m = a1 , a.h = a2 , a);
  negative && negate(result);
  return result;
}

function fromInt(value){
  var rebase, result;
  if (value > -129 && value < 128) {
    rebase = value + 128;
    boxedValues == null && (boxedValues = initDim(_3Lcom_google_gwt_lang_LongLibBase$LongEmul_2_classLit, {9:1, 68:1}, 79, 256, 0));
    result = boxedValues[rebase];
    !result && (result = boxedValues[rebase] = create_2(value));
    return result;
  }
  return create_2(value);
}

function gt(a_0, b){
  var signa, signb;
  signa = ~~a_0.h >> 19;
  signb = ~~b.h >> 19;
  return signa == 0?signb != 0 || a_0.h > b.h || a_0.h == b.h && a_0.m > b.m || a_0.h == b.h && a_0.m == b.m && a_0.l > b.l:!(signb == 0 || a_0.h < b.h || a_0.h == b.h && a_0.m < b.m || a_0.h == b.h && a_0.m == b.m && a_0.l <= b.l);
}

function gte_0(a_0, b){
  var signa, signb;
  signa = ~~a_0.h >> 19;
  signb = ~~b.h >> 19;
  return signa == 0?signb != 0 || a_0.h > b.h || a_0.h == b.h && a_0.m > b.m || a_0.h == b.h && a_0.m == b.m && a_0.l >= b.l:!(signb == 0 || a_0.h < b.h || a_0.h == b.h && a_0.m < b.m || a_0.h == b.h && a_0.m == b.m && a_0.l < b.l);
}

function mul(a_0, b){
  var a0, a1, a2, a3, a4, b0, b1, b2, b3, b4, c0, c00, c01, c1, c10, c11, c12, c13, c2, c22, c23, c24, p0, p1, p2, p3, p4;
  a0 = a_0.l & 8191;
  a1 = ~~a_0.l >> 13 | (a_0.m & 15) << 9;
  a2 = ~~a_0.m >> 4 & 8191;
  a3 = ~~a_0.m >> 17 | (a_0.h & 255) << 5;
  a4 = ~~(a_0.h & 1048320) >> 8;
  b0 = b.l & 8191;
  b1 = ~~b.l >> 13 | (b.m & 15) << 9;
  b2 = ~~b.m >> 4 & 8191;
  b3 = ~~b.m >> 17 | (b.h & 255) << 5;
  b4 = ~~(b.h & 1048320) >> 8;
  p0 = a0 * b0;
  p1 = a1 * b0;
  p2 = a2 * b0;
  p3 = a3 * b0;
  p4 = a4 * b0;
  if (b1 != 0) {
    p1 += a0 * b1;
    p2 += a1 * b1;
    p3 += a2 * b1;
    p4 += a3 * b1;
  }
  if (b2 != 0) {
    p2 += a0 * b2;
    p3 += a1 * b2;
    p4 += a2 * b2;
  }
  if (b3 != 0) {
    p3 += a0 * b3;
    p4 += a1 * b3;
  }
  b4 != 0 && (p4 += a0 * b4);
  c00 = p0 & 4194303;
  c01 = (p1 & 511) << 13;
  c0 = c00 + c01;
  c10 = ~~p0 >> 22;
  c11 = ~~p1 >> 9;
  c12 = (p2 & 262143) << 4;
  c13 = (p3 & 31) << 17;
  c1 = c10 + c11 + c12 + c13;
  c22 = ~~p2 >> 18;
  c23 = ~~p3 >> 5;
  c24 = (p4 & 4095) << 8;
  c2 = c22 + c23 + c24;
  c1 += ~~c0 >> 22;
  c0 &= 4194303;
  c2 += ~~c1 >> 22;
  c1 &= 4194303;
  c2 &= 1048575;
  return create0(c0, c1, c2);
}

function neg(a_0){
  var neg0, neg1, neg2;
  neg0 = ~a_0.l + 1 & 4194303;
  neg1 = ~a_0.m + (neg0 == 0?1:0) & 4194303;
  neg2 = ~a_0.h + (neg0 == 0 && neg1 == 0?1:0) & 1048575;
  return create0(neg0, neg1, neg2);
}

function neq(a_0, b){
  return a_0.l != b.l || a_0.m != b.m || a_0.h != b.h;
}

function or(a_0, b){
  return create0(a_0.l | b.l, a_0.m | b.m, a_0.h | b.h);
}

function shl(a_0, n){
  var res0, res1, res2;
  n &= 63;
  if (n < 22) {
    res0 = a_0.l << n;
    res1 = a_0.m << n | ~~a_0.l >> 22 - n;
    res2 = a_0.h << n | ~~a_0.m >> 22 - n;
  }
   else if (n < 44) {
    res0 = 0;
    res1 = a_0.l << n - 22;
    res2 = a_0.m << n - 22 | ~~a_0.l >> 44 - n;
  }
   else {
    res0 = 0;
    res1 = 0;
    res2 = a_0.l << n - 44;
  }
  return create0(res0 & 4194303, res1 & 4194303, res2 & 1048575);
}

function shr(a_0, n){
  var a2, negative, res0, res1, res2;
  n &= 63;
  a2 = a_0.h;
  negative = (a2 & 524288) != 0;
  negative && (a2 |= -1048576);
  if (n < 22) {
    res2 = ~~a2 >> n;
    res1 = ~~a_0.m >> n | a2 << 22 - n;
    res0 = ~~a_0.l >> n | a_0.m << 22 - n;
  }
   else if (n < 44) {
    res2 = negative?1048575:0;
    res1 = ~~a2 >> n - 22;
    res0 = ~~a_0.m >> n - 22 | a2 << 44 - n;
  }
   else {
    res2 = negative?1048575:0;
    res1 = negative?4194303:0;
    res0 = ~~a2 >> n - 44;
  }
  return create0(res0 & 4194303, res1 & 4194303, res2 & 1048575);
}

function shru(a_0, n){
  var a2, res0, res1, res2;
  n &= 63;
  a2 = a_0.h & 1048575;
  if (n < 22) {
    res2 = ~~a2 >>> n;
    res1 = ~~a_0.m >> n | a2 << 22 - n;
    res0 = ~~a_0.l >> n | a_0.m << 22 - n;
  }
   else if (n < 44) {
    res2 = 0;
    res1 = ~~a2 >>> n - 22;
    res0 = ~~a_0.m >> n - 22 | a_0.h << 44 - n;
  }
   else {
    res2 = 0;
    res1 = 0;
    res0 = ~~a2 >>> n - 44;
  }
  return create0(res0 & 4194303, res1 & 4194303, res2 & 1048575);
}

function sub(a_0, b){
  var sum0, sum1, sum2;
  sum0 = a_0.l - b.l;
  sum1 = a_0.m - b.m + (~~sum0 >> 22);
  sum2 = a_0.h - b.h + (~~sum1 >> 22);
  return create0(sum0 & 4194303, sum1 & 4194303, sum2 & 1048575);
}

function toDouble(a_0){
  if (eq(a_0, ($clinit_243() , MIN_VALUE))) {
    return -9223372036854775808;
  }
  if (!gte_0(a_0, ZERO)) {
    return -toDoubleHelper(neg(a_0));
  }
  return a_0.l + a_0.m * 4194304 + a_0.h * 17592186044416;
}

function toInt(a_0){
  return a_0.l | a_0.m << 22;
}

function toString_14(a_0){
  var digits, rem, res, tenPowerLong, zeroesNeeded;
  if (a_0.l == 0 && a_0.m == 0 && a_0.h == 0) {
    return '0';
  }
  if (a_0.h == 524288 && a_0.m == 0 && a_0.l == 0) {
    return '-9223372036854775808';
  }
  if (~~a_0.h >> 19 != 0) {
    return '-' + toString_14(neg(a_0));
  }
  rem = a_0;
  res = '';
  while (!(rem.l == 0 && rem.m == 0 && rem.h == 0)) {
    tenPowerLong = fromInt(1000000000);
    rem = divMod(rem, tenPowerLong, true);
    digits = '' + toInt(remainder_0);
    if (!(rem.l == 0 && rem.m == 0 && rem.h == 0)) {
      zeroesNeeded = 9 - digits.length;
      for (; zeroesNeeded > 0; --zeroesNeeded) {
        digits = '0' + digits;
      }
    }
    res = digits + res;
  }
  return res;
}

function xor(a_0, b){
  return create0(a_0.l ^ b.l, a_0.m ^ b.m, a_0.h ^ b.h);
}

var boxedValues = null;
function $clinit_243(){
  $clinit_243 = nullMethod;
  MAX_VALUE = (a = new LongLibBase$LongEmul_0 , a.l = 4194303 , a.m = 4194303 , a.h = 524287 , a);
  MIN_VALUE = (a = new LongLibBase$LongEmul_0 , a.l = 0 , a.m = 0 , a.h = 524288 , a);
  ONE = fromInt(1);
  fromInt(2);
  ZERO = fromInt(0);
}

var MAX_VALUE, MIN_VALUE, ONE, ZERO;
function LongLibBase$LongEmul_0(){
}

function LongLibBase$LongEmul(){
}

_ = LongLibBase$LongEmul_0.prototype = LongLibBase$LongEmul.prototype = new Object_0;
_.getClass$ = function getClass_128(){
  return Lcom_google_gwt_lang_LongLibBase$LongEmul_2_classLit;
}
;
_.castableTypeMap$ = {79:1};
var callbacksHead_0 = null, callbacksTail_0 = null, instance_3 = null;
function CommandCanceledException_0(){
  this.fillInStackTrace();
}

function CommandCanceledException(){
}

_ = CommandCanceledException_0.prototype = CommandCanceledException.prototype = new RuntimeException;
_.getClass$ = function getClass_145(){
  return Lcom_google_gwt_user_client_CommandCanceledException_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 21:1, 39:1, 183:1};
function $doCommandCanceled(this$static){
  var cmd;
  cmd = $getLast(this$static.iterator);
  $remove_0(this$static.iterator);
  cmd != null && cmd.castableTypeMap$ && !!cmd.castableTypeMap$[52] && new CommandCanceledException_0(dynamicCast(cmd, 52));
  this$static.executing = false;
  $maybeStartExecutionTimer(this$static);
}

function $doExecuteCommands(this$static, startTimeMillis){
  var command, element, wasCanceled;
  wasCanceled = false;
  try {
    this$static.executing = true;
    this$static.iterator.end = this$static.commands.size_0;
    $schedule(this$static.cancellationTimer, 10000);
    while ($hasNext(this$static.iterator)) {
      element = $next(this$static.iterator);
      try {
        if (element == null) {
          return;
        }
        if (element != null && element.castableTypeMap$ && !!element.castableTypeMap$[52]) {
          command = dynamicCast(element, 52);
          command.execute_0();
        }
      }
       finally {
        wasCanceled = this$static.iterator.last == -1;
        wasCanceled || $remove_0(this$static.iterator);
      }
      if ((new Date).getTime() - startTimeMillis >= 100) {
        return;
      }
    }
  }
   finally {
    if (!wasCanceled) {
      $cancel_0(this$static.cancellationTimer);
      this$static.executing = false;
      $maybeStartExecutionTimer(this$static);
    }
  }
}

function $maybeStartExecutionTimer(this$static){
  if (this$static.commands.size_0 != 0 && !this$static.executionTimerPending && !this$static.executing) {
    this$static.executionTimerPending = true;
    $schedule(this$static.executionTimer, 1);
  }
}

function $submit(this$static, command){
  $add_9(this$static.commands, command);
  $maybeStartExecutionTimer(this$static);
}

function CommandExecutor_0(){
  this.cancellationTimer = new CommandExecutor$1_0(this);
  this.commands = new ArrayList_0;
  this.executionTimer = new CommandExecutor$2_0(this);
  this.iterator = new CommandExecutor$CircularIterator_0(this);
}

function CommandExecutor(){
}

_ = CommandExecutor_0.prototype = CommandExecutor.prototype = new Object_0;
_.getClass$ = function getClass_146(){
  return Lcom_google_gwt_user_client_CommandExecutor_2_classLit;
}
;
_.castableTypeMap$ = {};
_.executing = false;
_.executionTimerPending = false;
function CommandExecutor$1_0(this$0){
  $clinit_3();
  this.this$0 = this$0;
}

function CommandExecutor$1(){
}

_ = CommandExecutor$1_0.prototype = CommandExecutor$1.prototype = new Timer;
_.getClass$ = function getClass_147(){
  return Lcom_google_gwt_user_client_CommandExecutor$1_2_classLit;
}
;
_.run = function run_1(){
  if (!this.this$0.executing) {
    return;
  }
  $doCommandCanceled(this.this$0);
}
;
_.castableTypeMap$ = {54:1};
_.this$0 = null;
function CommandExecutor$2_0(this$0){
  $clinit_3();
  this.this$0 = this$0;
}

function CommandExecutor$2(){
}

_ = CommandExecutor$2_0.prototype = CommandExecutor$2.prototype = new Timer;
_.getClass$ = function getClass_148(){
  return Lcom_google_gwt_user_client_CommandExecutor$2_2_classLit;
}
;
_.run = function run_2(){
  this.this$0.executionTimerPending = false;
  $doExecuteCommands(this.this$0, (new Date).getTime());
}
;
_.castableTypeMap$ = {54:1};
_.this$0 = null;
function $getLast(this$static){
  return $get_7(this$static.this$0.commands, this$static.last);
}

function $hasNext(this$static){
  return this$static.next < this$static.end;
}

function $next(this$static){
  var command;
  this$static.last = this$static.next;
  command = $get_7(this$static.this$0.commands, this$static.next++);
  this$static.next >= this$static.end && (this$static.next = 0);
  return command;
}

function $remove_0(this$static){
  $remove_12(this$static.this$0.commands, this$static.last);
  --this$static.end;
  this$static.last <= this$static.next && --this$static.next < 0 && (this$static.next = 0);
  this$static.last = -1;
}

function CommandExecutor$CircularIterator_0(this$0){
  this.this$0 = this$0;
}

function CommandExecutor$CircularIterator(){
}

_ = CommandExecutor$CircularIterator_0.prototype = CommandExecutor$CircularIterator.prototype = new Object_0;
_.getClass$ = function getClass_149(){
  return Lcom_google_gwt_user_client_CommandExecutor$CircularIterator_2_classLit;
}
;
_.hasNext = function hasNext(){
  return this.next < this.end;
}
;
_.next_0 = function next_7(){
  return $next(this);
}
;
_.remove_1 = function remove_1(){
  $remove_0(this);
}
;
_.castableTypeMap$ = {};
_.end = 0;
_.last = -1;
_.next = 0;
_.this$0 = null;
function ensureCookies(){
  var newCachedCookies;
  if (!cachedCookies || needsRefresh()) {
    newCachedCookies = new HashMap_0;
    loadCookies(newCachedCookies);
    cachedCookies = newCachedCookies;
  }
  return cachedCookies;
}

function loadCookies(m_0){
  var docCookie = $doc.cookie;
  if (docCookie && docCookie != '') {
    var crumbs = docCookie.split('; ');
    for (var i = 0; i < crumbs.length; ++i) {
      var name_0, value;
      var eqIdx = crumbs[i].indexOf('=');
      if (eqIdx == -1) {
        name_0 = crumbs[i];
        value = '';
      }
       else {
        name_0 = crumbs[i].substring(0, eqIdx);
        value = crumbs[i].substring(eqIdx + 1);
      }
      if (uriEncoding) {
        try {
          name_0 = decodeURIComponent(name_0);
        }
         catch (e) {
        }
        try {
          value = decodeURIComponent(value);
        }
         catch (e) {
        }
      }
      m_0.put(name_0, value);
    }
  }
}

function needsRefresh(){
  var docCookie = $doc.cookie;
  if (docCookie != rawCookies) {
    rawCookies = docCookie;
    return true;
  }
   else {
    return false;
  }
}

var cachedCookies = null, rawCookies = null, uriEncoding = true;
function $clinit_281(){
  $clinit_281 = nullMethod;
  commandExecutor = new CommandExecutor_0;
}

function addCommand(cmd){
  $clinit_281();
  if (!cmd) {
    throw new NullPointerException_1('cmd cannot be null');
  }
  $submit(commandExecutor, cmd);
}

var commandExecutor;
function addNativePreviewHandler(handler){
  $maybeInitializeEventSystem();
  !TYPE_13 && (TYPE_13 = new GwtEvent$Type_0);
  if (!handlers_0) {
    handlers_0 = new HandlerManager_1(null, true);
    singleton_0 = new Event$NativePreviewEvent_0;
  }
  return $addHandler_0(handlers_0.eventBus, TYPE_13, handler);
}

function Event$NativePreviewEvent_0(){
}

function Event$NativePreviewEvent(){
}

_ = Event$NativePreviewEvent_0.prototype = Event$NativePreviewEvent.prototype = new GwtEvent;
_.dispatch = function dispatch_13(handler){
  $onPreviewNativeEvent(dynamicCast(handler, 53), this);
  singleton_0.isFirstHandler = false;
}
;
_.getAssociatedType = function getAssociatedType_14(){
  return TYPE_13;
}
;
_.getClass$ = function getClass_150(){
  return Lcom_google_gwt_user_client_Event$NativePreviewEvent_2_classLit;
}
;
_.isCanceled_0 = function isCanceled(){
  return this.isCanceled;
}
;
_.isConsumed_0 = function isConsumed(){
  return this.isConsumed;
}
;
_.revive = function revive_0(){
  this.dead = false;
  this.source = null;
  this.isCanceled = false;
  this.isConsumed = false;
  this.isFirstHandler = true;
  this.nativeEvent = null;
}
;
_.setNativeEvent = function setNativeEvent(nativeEvent){
  this.nativeEvent = nativeEvent;
}
;
_.castableTypeMap$ = {};
_.isCanceled = false;
_.isConsumed = false;
_.isFirstHandler = false;
_.nativeEvent = null;
function $clinit_286(){
  $clinit_286 = nullMethod;
  impl_0 = new HistoryImplSafari_0;
  $init_0(impl_0) || (impl_0 = null);
}

var impl_0 = null;
function nextInt(){
  return ~~(Math.floor(Math.random() * 4294967296) - 2147483648);
}

function maybeInitializeResizeHandlers(){
  if (!resizeHandlersInitialized) {
    $initWindowResizeHandler();
    resizeHandlersInitialized = true;
  }
}

function onResize(){
  var height, width;
  if (resizeHandlersInitialized) {
    width = $getClientWidth($doc);
    height = $getClientHeight($doc);
    if (lastResizeWidth != width || lastResizeHeight != height) {
      lastResizeWidth = width;
      lastResizeHeight = height;
      fire_1((!handlers_1 && (handlers_1 = new Window$WindowHandlers_0) , handlers_1));
    }
  }
}

var lastResizeHeight = 0, lastResizeWidth = 0, resizeHandlersInitialized = false;
function replace_0(newURL){
  $wnd.location.replace(newURL);
}

function $getChild(elem, index){
  var count = 0, child = elem.firstChild;
  while (child) {
    if (child.nodeType == 1) {
      if (index == count)
        return child;
      ++count;
    }
    child = child.nextSibling;
  }
  return null;
}

function $getChildCount(elem){
  var count = 0, child = elem.firstChild;
  while (child) {
    child.nodeType == 1 && ++count;
    child = child.nextSibling;
  }
  return count;
}

function $addValueChangeHandler(this$static, handler){
  return $addHandler_0(this$static.handlers.eventBus, (!TYPE_12 && (TYPE_12 = new GwtEvent$Type_0) , TYPE_12), handler);
}

function HistoryImpl(){
}

_ = HistoryImpl.prototype = new Object_0;
_.decodeFragment = function decodeFragment(encodedFragment){
  return decodeURI(encodedFragment.replace('%23', '#'));
}
;
_.fireEvent = function fireEvent_2(event_0){
  $fireEvent(this.handlers, event_0);
}
;
_.getClass$ = function getClass_154(){
  return Lcom_google_gwt_user_client_impl_HistoryImpl_2_classLit;
}
;
_.newItemOnEvent = function newItemOnEvent(historyToken){
  historyToken = historyToken == null?'':historyToken;
  if (!$equals_3(historyToken, $wnd.__gwt_historyToken || '')) {
    $wnd.__gwt_historyToken = historyToken;
    fire_2(this, historyToken);
  }
}
;
_.castableTypeMap$ = {6:1};
function $init_0(this$static){
  var token_0 = '';
  var hash_0 = $wnd.location.hash;
  hash_0.length > 0 && (token_0 = this$static.decodeFragment(hash_0.substring(1)));
  $wnd.__gwt_historyToken = token_0;
  var historyImpl = this$static;
  $wnd.__checkHistory = $entry(function(){
    $wnd.setTimeout($wnd.__checkHistory, 250);
    var token = '', hash = $wnd.location.hash;
    hash.length > 0 && (token = historyImpl.decodeFragment(hash.substring(1)));
    historyImpl.newItemOnEvent(token);
  }
  );
  $wnd.__checkHistory();
  return true;
}

function HistoryImplTimer(){
}

_ = HistoryImplTimer.prototype = new HistoryImpl;
_.getClass$ = function getClass_155(){
  return Lcom_google_gwt_user_client_impl_HistoryImplTimer_2_classLit;
}
;
_.castableTypeMap$ = {6:1};
function HistoryImplSafari_0(){
  this.handlers = new HandlerManager_0(null);
}

function HistoryImplSafari(){
}

_ = HistoryImplSafari_0.prototype = HistoryImplSafari.prototype = new HistoryImplTimer;
_.getClass$ = function getClass_156(){
  return Lcom_google_gwt_user_client_impl_HistoryImplSafari_2_classLit;
}
;
_.castableTypeMap$ = {6:1};
function $initWindowResizeHandler(){
  var oldOnResize = $wnd.onresize;
  $wnd.onresize = $entry(function(evt){
    try {
      onResize();
    }
     finally {
      oldOnResize && oldOnResize(evt);
    }
  }
  );
}

function $setElement_0(this$static, elem){
  this$static.element = elem;
}

function $setStyleName(this$static, style){
  setStyleName_0(this$static.element, style, true);
}

function getStylePrimaryName(elem){
  var fullClassName, spaceIdx;
  fullClassName = elem['className'] == null?null:String(elem['className']);
  spaceIdx = fullClassName.indexOf(fromCodePoint(32));
  if (spaceIdx >= 0) {
    return fullClassName.substr(0, spaceIdx - 0);
  }
  return fullClassName;
}

function setStyleName_0(elem, style, add){
  if (!elem) {
    throw new RuntimeException_1('Null widget handle. If you are creating a composite, ensure that initWidget() has been called.');
  }
  style = $trim(style);
  if (style.length == 0) {
    throw new IllegalArgumentException_1('Style names cannot be empty');
  }
  add?$addClassName(elem, style):$removeClassName(elem, style);
}

function $removeFromParent_0(this$static){
  if (!this$static.parent_0) {
    ($clinit_386() , widgetsToDetach.map.containsKey(this$static)) && detachNow(this$static);
  }
   else if (instanceOf(this$static.parent_0, 61)) {
    dynamicCast(this$static.parent_0, 61).remove_2(this$static);
  }
   else if (this$static.parent_0) {
    throw new IllegalStateException_1("This widget's parent does not implement HasWidgets");
  }
}

_ = Widget.prototype;
_.fireEvent = function fireEvent_3(event_0){
  !!this.handlerManager && $fireEvent(this.handlerManager, event_0);
}
;
function $add_0(this$static, child, container){
  $removeFromParent_0(child);
  $add_7(this$static.getChildren(), child);
  container.appendChild(child.element);
  $setParent(child, this$static);
}

function $add_1(this$static, w){
  $add_0(this$static, w, this$static.element);
}

function $remove_2(this$static, w){
  var removed;
  removed = $remove_1(this$static, w);
  removed && changeToStaticPositioning(w.element);
  return removed;
}

function changeToStaticPositioning(elem){
  elem.style['left'] = '';
  elem.style['top'] = '';
  elem.style['position'] = '';
}

function AbsolutePanel(){
}

_ = AbsolutePanel.prototype = new ComplexPanel;
_.getClass$ = function getClass_161(){
  return Lcom_google_gwt_user_client_ui_AbsolutePanel_2_classLit;
}
;
_.remove_2 = function remove_3(w){
  var removed;
  return removed = $remove_1(this, w) , removed && changeToStaticPositioning(w.element) , removed;
}
;
_.castableTypeMap$ = {5:1, 6:1, 7:1, 8:1, 55:1, 59:1, 61:1};
function AbstractImagePrototype(){
}

_ = AbstractImagePrototype.prototype = new Object_0;
_.getClass$ = function getClass_162(){
  return Lcom_google_gwt_user_client_ui_AbstractImagePrototype_2_classLit;
}
;
_.castableTypeMap$ = {};
function $initWidget(this$static, widget){
  if (this$static.widget) {
    throw new IllegalStateException_1('Composite.initWidget() may only be called once.');
  }
  $removeFromParent_0(widget);
  $setElement_0(this$static, widget.element);
  this$static.widget = widget;
  $setParent(widget, this$static);
}

function Composite(){
}

_ = Composite.prototype = new Widget;
_.getClass$ = function getClass_173(){
  return Lcom_google_gwt_user_client_ui_Composite_2_classLit;
}
;
_.isAttached = function isAttached_0(){
  if (this.widget) {
    return this.widget.attached;
  }
  return false;
}
;
_.onAttach = function onAttach_1(){
  if (this.eventsToSink != -1) {
    $sinkEvents(this.widget, this.eventsToSink);
    this.eventsToSink = -1;
  }
  this.widget.onAttach();
  this.element.__listener = this;
}
;
_.onBrowserEvent = function onBrowserEvent_0(event_0){
  $onBrowserEvent(this, event_0);
  this.widget.onBrowserEvent(event_0);
}
;
_.onDetach = function onDetach_0(){
  this.widget.onDetach();
}
;
_.castableTypeMap$ = {5:1, 6:1, 7:1, 8:1, 55:1, 59:1};
_.widget = null;
function $getTextOrHtml(this$static){
  var elem;
  elem = this$static.isSpanWrapped?$getFirstChildElement(this$static.element):this$static.element;
  return elem.textContent;
}

function $setTextOrHtml(this$static, content_0, isHtml){
  this$static.isSpanWrapped = false;
  isHtml?(this$static.element.innerHTML = content_0 || '' , undefined):(this$static.element.textContent = content_0 || '' , undefined);
  if (this$static.textDir != this$static.initialElementDir) {
    this$static.textDir = this$static.initialElementDir;
    setDirectionOnElement(this$static.element, this$static.initialElementDir);
  }
}

function DirectionalTextHelper_0(element){
  this.element = element;
  this.isSpanWrapped = false;
  this.initialElementDir = getDirectionOnElement(element);
  this.textDir = this.initialElementDir;
}

function DirectionalTextHelper(){
}

_ = DirectionalTextHelper_0.prototype = DirectionalTextHelper.prototype = new Object_0;
_.getClass$ = function getClass_174(){
  return Lcom_google_gwt_user_client_ui_DirectionalTextHelper_2_classLit;
}
;
_.castableTypeMap$ = {};
_.element = null;
_.initialElementDir = null;
_.isSpanWrapped = false;
_.textDir = null;
function $add_2(this$static, w){
  $add_0(this$static, w, this$static.element);
}

function FlowPanel_0(){
  this.children_0 = new WidgetCollection_0(this);
  this.element = $doc.createElement('div');
}

function FlowPanel(){
}

_ = FlowPanel_0.prototype = FlowPanel.prototype = new ComplexPanel;
_.getClass$ = function getClass_181(){
  return Lcom_google_gwt_user_client_ui_FlowPanel_2_classLit;
}
;
_.castableTypeMap$ = {5:1, 6:1, 7:1, 8:1, 55:1, 59:1, 61:1};
function SimplePanel(){
}

_ = SimplePanel.prototype = new Panel;
_.castableTypeMap$ = {5:1, 6:1, 7:1, 8:1, 55:1, 59:1, 61:1};
_.widget = null;
function $clinit_331(){
  $clinit_331 = nullMethod;
  impl_2 = ($clinit_414() , $clinit_414() , implPanel);
}

var impl_2;
function Frame_0(){
}

_ = Frame_0.prototype = new Widget;
_.getClass$ = function getClass_187(){
  return Lcom_google_gwt_user_client_ui_Frame_2_classLit;
}
;
_.castableTypeMap$ = {5:1, 6:1, 7:1, 8:1, 55:1, 59:1};
function LabelBase_2(element){
  this.element = element;
  this.directionalTextHelper = new DirectionalTextHelper_0(this.element);
}

function LabelBase(){
}

_ = LabelBase.prototype = new Widget;
_.getClass$ = function getClass_188(){
  return Lcom_google_gwt_user_client_ui_LabelBase_2_classLit;
}
;
_.castableTypeMap$ = {5:1, 6:1, 7:1, 8:1, 55:1, 59:1};
_.directionalTextHelper = null;
function Label_0(){
  this.element = $doc.createElement('div');
  this.directionalTextHelper = new DirectionalTextHelper_0(this.element);
  this.element['className'] = 'gwt-Label';
}

function Label_1(text){
  Label_0.call(this);
  $setTextOrHtml(this.directionalTextHelper, text, false);
}

function Label(){
}

_ = Label_1.prototype = Label_0.prototype = Label.prototype = new LabelBase;
_.getClass$ = function getClass_189(){
  return Lcom_google_gwt_user_client_ui_Label_2_classLit;
}
;
_.castableTypeMap$ = {5:1, 6:1, 7:1, 8:1, 55:1, 59:1};
function HTMLPanel_0(html){
  this.children_0 = new WidgetCollection_0(this);
  this.element = $doc.createElement('div');
  this.element.innerHTML = html || '';
}

function HTMLPanel(){
}

_ = HTMLPanel_0.prototype = HTMLPanel.prototype = new ComplexPanel;
_.getClass$ = function getClass_191(){
  return Lcom_google_gwt_user_client_ui_HTMLPanel_2_classLit;
}
;
_.castableTypeMap$ = {5:1, 6:1, 7:1, 8:1, 55:1, 59:1, 61:1};
function $clinit_353(){
  $clinit_353 = nullMethod;
  new HasHorizontalAlignment$HorizontalAlignmentConstant_0('center');
  new HasHorizontalAlignment$HorizontalAlignmentConstant_0('justify');
  ALIGN_LEFT = new HasHorizontalAlignment$HorizontalAlignmentConstant_0('left');
  ALIGN_RIGHT = new HasHorizontalAlignment$HorizontalAlignmentConstant_0('right');
  ALIGN_LOCALE_START = ($clinit_211() , ALIGN_LEFT);
  ALIGN_DEFAULT = ALIGN_LOCALE_START;
}

var ALIGN_DEFAULT, ALIGN_LEFT, ALIGN_LOCALE_START, ALIGN_RIGHT;
function HasHorizontalAlignment$AutoHorizontalAlignmentConstant(){
}

_ = HasHorizontalAlignment$AutoHorizontalAlignmentConstant.prototype = new Object_0;
_.getClass$ = function getClass_192(){
  return Lcom_google_gwt_user_client_ui_HasHorizontalAlignment$AutoHorizontalAlignmentConstant_2_classLit;
}
;
_.castableTypeMap$ = {};
function HasHorizontalAlignment$HorizontalAlignmentConstant_0(textAlignString){
  this.textAlignString = textAlignString;
}

function HasHorizontalAlignment$HorizontalAlignmentConstant(){
}

_ = HasHorizontalAlignment$HorizontalAlignmentConstant_0.prototype = HasHorizontalAlignment$HorizontalAlignmentConstant.prototype = new HasHorizontalAlignment$AutoHorizontalAlignmentConstant;
_.getClass$ = function getClass_193(){
  return Lcom_google_gwt_user_client_ui_HasHorizontalAlignment$HorizontalAlignmentConstant_2_classLit;
}
;
_.castableTypeMap$ = {};
_.textAlignString = null;
function $clearItems(this$static){
  var container, item, item$iterator;
  container = this$static.vertical?this$static.body_0:$getChild(this$static.body_0, 0);
  while ($getChildCount(container) > 0) {
    container.removeChild($getChild(container, 0));
  }
  for (item$iterator = new AbstractList$IteratorImpl_0(this$static.allItems); item$iterator.i < item$iterator.this$0_0.size_1();) {
    item = dynamicCast($next_4(item$iterator), 59);
    item.element['colSpan'] = 1;
    throwClassCastExceptionUnlessNull(item).nullMethod();
  }
  $clear_4(this$static.items);
  $clear_4(this$static.allItems);
}

function $doItemAction(){
  if (!null.nullMethod()) {
    return;
  }
}

function $findItem(this$static, hItem){
  var item, item$iterator;
  for (item$iterator = new AbstractList$IteratorImpl_0(this$static.items); item$iterator.i < item$iterator.this$0_0.size_1();) {
    item = throwClassCastExceptionUnlessNull($next_4(item$iterator));
    if ($isOrHasChild(null.nullMethod(), hItem)) {
      return item;
    }
  }
  return null;
}

function $init_1(this$static, vertical){
  var outer, table, tr;
  table = $doc.createElement('table');
  this$static.body_0 = $doc.createElement('tbody');
  table.appendChild(this$static.body_0);
  if (!vertical) {
    tr = $doc.createElement('tr');
    this$static.body_0.appendChild(tr);
  }
  this$static.vertical = vertical;
  outer = ($clinit_331() , createFocusable0(($clinit_414() , focusHandler_0)?focusHandler_0:(focusHandler_0 = $createFocusHandler())));
  outer.appendChild(table);
  this$static.element = outer;
  this$static.element.setAttribute('role', 'menubar');
  this$static.eventsToSink == -1?sinkEvents(this$static.element, 2225 | (this$static.element.__eventBits || 0)):(this$static.eventsToSink |= 2225);
  this$static.element['className'] = 'gwt-MenuBar';
  vertical?$setStyleName(this$static, getStylePrimaryName(this$static.element) + '-vertical'):$setStyleName(this$static, getStylePrimaryName(this$static.element) + '-horizontal');
  this$static.element.style['outline'] = '0px';
  this$static.element.setAttribute('hideFocus', 'true');
  $addDomHandler(this$static, new MenuBar$2_0, ($clinit_111() , $clinit_111() , TYPE));
}

function $moveSelectionDown(this$static){
  if ($selectFirstItemIfNoneSelected(this$static)) {
    return;
  }
  if (this$static.vertical)
  ;
  else {
    if (null.nullMethod() != null && !null.nullMethod().nullMethod().nullMethod()) {
      $doItemAction();
      null.nullMethod().nullMethod();
    }
  }
}

function $moveSelectionUp(this$static){
  if ($selectFirstItemIfNoneSelected(this$static)) {
    return;
  }
}

function $moveToNextItem(this$static){
  if ($selectFirstItemIfNoneSelected(this$static)) {
    return;
  }
  if (this$static.vertical) {
    if (null.nullMethod() != null && !null.nullMethod().nullMethod().nullMethod()) {
      $doItemAction();
      null.nullMethod().nullMethod();
    }
  }
}

function $moveToPrevItem(this$static){
  if ($selectFirstItemIfNoneSelected(this$static)) {
    return;
  }
}

function $onBrowserEvent_0(this$static, event_0){
  var keyCode;
  $findItem(this$static, event_0.target);
  switch ($eventGetTypeInt(event_0.type)) {
    case 1:
      {
        $focus_0(($clinit_331() , this$static.element));
        break;
      }

    case 2048:
      {
        $selectFirstItemIfNoneSelected(this$static);
        break;
      }

    case 128:
      {
        keyCode = event_0.keyCode || 0;
        switch (keyCode) {
          case 37:
            $clinit_211();
            $moveToPrevItem(this$static);
            event_0.cancelBubble = true;
            event_0.preventDefault();
            break;
          case 39:
            $clinit_211();
            $moveToNextItem(this$static);
            event_0.cancelBubble = true;
            event_0.preventDefault();
            break;
          case 38:
            $moveSelectionUp(this$static);
            event_0.cancelBubble = true;
            event_0.preventDefault();
            break;
          case 40:
            $moveSelectionDown(this$static);
            event_0.cancelBubble = true;
            event_0.preventDefault();
            break;
          case 27:
            event_0.cancelBubble = true;
            event_0.preventDefault();
            break;
          case 13:
            if (!$selectFirstItemIfNoneSelected(this$static)) {
              $doItemAction();
              event_0.cancelBubble = true;
              event_0.preventDefault();
            }

        }
        break;
      }

  }
  $onBrowserEvent(this$static, event_0);
}

function $selectFirstItemIfNoneSelected(this$static){
  var nextItem$iterator;
  for (nextItem$iterator = new AbstractList$IteratorImpl_0(this$static.items); nextItem$iterator.i < nextItem$iterator.this$0_0.size_1();) {
    throwClassCastExceptionUnlessNull($next_4(nextItem$iterator));
    if (null.nullMethod()) {
      break;
    }
  }
  return true;
}

function MenuBar_1(){
  this.allItems = new ArrayList_0;
  this.items = new ArrayList_0;
  $init_1(this, true, new ClippedImagePrototype_0(($clinit_380() , menuBarSubMenuIcon).height_0));
}

function MenuBar(){
}

_ = MenuBar.prototype = new Widget;
_.getClass$ = function getClass_203(){
  return Lcom_google_gwt_user_client_ui_MenuBar_2_classLit;
}
;
_.onBrowserEvent = function onBrowserEvent_3(event_0){
  $onBrowserEvent_0(this, event_0);
}
;
_.onDetach = function onDetach_2(){
  $onDetach(this);
}
;
_.castableTypeMap$ = {5:1, 6:1, 7:1, 8:1, 55:1, 59:1};
_.body_0 = null;
_.vertical = false;
function MenuBar$2_0(){
}

function MenuBar$2(){
}

_ = MenuBar$2_0.prototype = MenuBar$2.prototype = new Object_0;
_.getClass$ = function getClass_204(){
  return Lcom_google_gwt_user_client_ui_MenuBar$2_2_classLit;
}
;
_.castableTypeMap$ = {22:1, 38:1};
function $clinit_380(){
  $clinit_380 = nullMethod;
  menuBarSubMenuIcon = new ImageResourcePrototype_0(($clinit_211() , 'data:image/gif;base64,R0lGODlhBQAJAIAAAAAAAAAAACH5BAEAAAEALAAAAAAFAAkAAAIMRB5gp9v2YlJsJRQKADs='), 5, 9);
}

var menuBarSubMenuIcon = null;
function $clinit_381(){
  $clinit_381 = nullMethod;
  PATTERN_NAME = /^[^<>&\'\"]+$/;
}

function createIFrame(name_0){
  var div;
  if (name_0 == null || !PATTERN_NAME.test($trim(name_0))) {
    throw new IllegalArgumentException_1("expecting one or more non-whitespace chars with no '<', '>', or '&'");
  }
  div = $doc.createElement('div');
  div.innerHTML = "<iframe src=\"javascript:''\" name='" + name_0 + "'>" || '';
  return div.firstChild;
}

function NamedFrame(){
}

_ = NamedFrame.prototype = new Frame_0;
_.getClass$ = function getClass_205(){
  return Lcom_google_gwt_user_client_ui_NamedFrame_2_classLit;
}
;
_.castableTypeMap$ = {5:1, 6:1, 7:1, 8:1, 55:1, 59:1};
var PATTERN_NAME = null;
function RootPanel_0(elem){
  this.children_0 = new WidgetCollection_0(this);
  this.element = elem;
  $onAttach(this);
}

function detachNow(widget){
  $clinit_386();
  try {
    widget.onDetach();
  }
   finally {
    widgetsToDetach.map.remove_3(widget) != null;
  }
}

function detachWidgets(){
  $clinit_386();
  try {
    tryCommand(widgetsToDetach, maybeDetachCommand);
  }
   finally {
    widgetsToDetach.map.clear();
    rootPanels.clear();
  }
}

function get_0(){
  $clinit_386();
  var rp;
  rp = dynamicCast(rootPanels.get(null), 60);
  if (rp) {
    return rp;
  }
  rootPanels.size_1() == 0 && addCloseHandler(new RootPanel$2_0);
  rp = new RootPanel$DefaultRootPanel_0;
  rootPanels.put(null, rp);
  $add_13(widgetsToDetach, rp);
  return rp;
}

function RootPanel(){
}

_ = RootPanel.prototype = new AbsolutePanel;
_.getClass$ = function getClass_207(){
  return Lcom_google_gwt_user_client_ui_RootPanel_2_classLit;
}
;
_.castableTypeMap$ = {5:1, 6:1, 7:1, 8:1, 55:1, 59:1, 60:1, 61:1};
function RootPanel$2_0(){
}

function RootPanel$2(){
}

_ = RootPanel$2_0.prototype = RootPanel$2.prototype = new Object_0;
_.getClass$ = function getClass_209(){
  return Lcom_google_gwt_user_client_ui_RootPanel$2_2_classLit;
}
;
_.onClose = function onClose_0(closeEvent){
  detachWidgets();
}
;
_.castableTypeMap$ = {35:1, 38:1};
function RootPanel$DefaultRootPanel_0(){
  RootPanel_0.call(this, ($clinit_386() , $doc.body));
}

function RootPanel$DefaultRootPanel(){
}

_ = RootPanel$DefaultRootPanel_0.prototype = RootPanel$DefaultRootPanel.prototype = new RootPanel;
_.getClass$ = function getClass_210(){
  return Lcom_google_gwt_user_client_ui_RootPanel$DefaultRootPanel_2_classLit;
}
;
_.castableTypeMap$ = {5:1, 6:1, 7:1, 8:1, 55:1, 59:1, 60:1, 61:1};
function $add_7(this$static, w){
  $insert_2(this$static, w, this$static.size_0);
}

function $insert_2(this$static, w, beforeIndex){
  var i, newArray;
  if (beforeIndex < 0 || beforeIndex > this$static.size_0) {
    throw new IndexOutOfBoundsException_0;
  }
  if (this$static.size_0 == this$static.array.length) {
    newArray = initDim(_3Lcom_google_gwt_user_client_ui_Widget_2_classLit, {9:1, 68:1}, 55, this$static.array.length * 2, 0);
    for (i = 0; i < this$static.array.length; ++i) {
      setCheck(newArray, i, this$static.array[i]);
    }
    this$static.array = newArray;
  }
  ++this$static.size_0;
  for (i = this$static.size_0 - 1; i > beforeIndex; --i) {
    setCheck(this$static.array, i, this$static.array[i - 1]);
  }
  setCheck(this$static.array, beforeIndex, w);
}

function ClippedImagePrototype_0(){
}

function ClippedImagePrototype(){
}

_ = ClippedImagePrototype_0.prototype = ClippedImagePrototype.prototype = new AbstractImagePrototype;
_.getClass$ = function getClass_225(){
  return Lcom_google_gwt_user_client_ui_impl_ClippedImagePrototype_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_414(){
  $clinit_414 = nullMethod;
  implPanel = new FocusImplSafari_0;
  implWidget = implPanel?new FocusImpl_0:implPanel;
}

function FocusImpl_0(){
}

function FocusImpl(){
}

_ = FocusImpl_0.prototype = FocusImpl.prototype = new Object_0;
_.getClass$ = function getClass_226(){
  return Lcom_google_gwt_user_client_ui_impl_FocusImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
var implPanel, implWidget;
function $createFocusHandler(){
  return function(evt){
    var div = this.parentNode;
    div.onfocus && $wnd.setTimeout(function(){
      div.focus();
    }
    , 0);
  }
  ;
}

function createFocusable0(focusHandler){
  $clinit_414();
  var div = $doc.createElement('div');
  div.tabIndex = 0;
  var input = $doc.createElement('input');
  input.type = 'text';
  input.tabIndex = -1;
  var style = input.style;
  style.opacity = 0;
  style.height = '1px';
  style.width = '1px';
  style.zIndex = -1;
  style.overflow = 'hidden';
  style.position = 'absolute';
  input.addEventListener('focus', focusHandler, false);
  div.appendChild(input);
  return div;
}

function FocusImplStandard(){
}

_ = FocusImplStandard.prototype = new FocusImpl;
_.getClass$ = function getClass_227(){
  return Lcom_google_gwt_user_client_ui_impl_FocusImplStandard_2_classLit;
}
;
_.castableTypeMap$ = {};
var focusHandler_0 = null;
function $focus_0(elem){
  $wnd.setTimeout(function(){
    elem.focus();
  }
  , 0);
}

function FocusImplSafari_0(){
}

function FocusImplSafari(){
}

_ = FocusImplSafari_0.prototype = FocusImplSafari.prototype = new FocusImplStandard;
_.getClass$ = function getClass_228(){
  return Lcom_google_gwt_user_client_ui_impl_FocusImplSafari_2_classLit;
}
;
_.castableTypeMap$ = {};
function ArithmeticException_0(){
  this.fillInStackTrace();
  this.detailMessage = 'divide by zero';
}

function ArithmeticException(){
}

_ = ArithmeticException_0.prototype = ArithmeticException.prototype = new RuntimeException;
_.getClass$ = function getClass_229(){
  return Ljava_lang_ArithmeticException_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 21:1, 39:1, 183:1};
function ArrayStoreException_1(message){
  this.fillInStackTrace();
  this.detailMessage = message;
}

_ = ArrayStoreException_1.prototype = ArrayStoreException.prototype;
function $clinit_428(){
  $clinit_428 = nullMethod;
  FALSE_0 = new Boolean_1(false);
  TRUE_0 = new Boolean_1(true);
}

function $equals_2(this$static, o){
  return o != null && o.castableTypeMap$ && !!o.castableTypeMap$[62] && dynamicCast(o, 62).value_0 == this$static.value_0;
}

function Boolean_1(value){
  this.value_0 = value;
}

function Boolean_0(){
}

_ = Boolean_1.prototype = Boolean_0.prototype = new Object_0;
_.compareTo$ = function compareTo_0(other){
  return this.value_0 == dynamicCast(other, 62).value_0?0:this.value_0?1:-1;
}
;
_.equals$ = function equals_7(o){
  return o != null && o.castableTypeMap$ && !!o.castableTypeMap$[62] && dynamicCast(o, 62).value_0 == this.value_0;
}
;
_.getClass$ = function getClass_233(){
  return Ljava_lang_Boolean_2_classLit;
}
;
_.hashCode$ = function hashCode_9(){
  return this.value_0?1231:1237;
}
;
_.toString$ = function toString_16(){
  return this.value_0?'true':'false';
}
;
_.castableTypeMap$ = {9:1, 10:1, 62:1};
_.value_0 = false;
var FALSE_0, TRUE_0;
function Character_0(value){
  this.value_0 = value;
}

function codePointAt(cs, index, limit){
  var hiSurrogate, loSurrogate;
  hiSurrogate = cs.charCodeAt(index++);
  if (hiSurrogate >= 55296 && hiSurrogate <= 56319 && index < limit && isLowSurrogate(loSurrogate = cs.charCodeAt(index))) {
    return 65536 + ((hiSurrogate & 1023) << 10) + (loSurrogate & 1023);
  }
  return hiSurrogate;
}

function isLowSurrogate(ch){
  return ch >= 56320 && ch <= 57343;
}

function toChars(codePoint){
  if (codePoint < 0 || codePoint > 1114111) {
    throw new IllegalArgumentException_0;
  }
  return codePoint >= 65536?initValues(_3C_classLit, {9:1}, -1, [55296 + (~~(codePoint - 65536) >> 10 & 1023) & 65535, 56320 + (codePoint - 65536 & 1023) & 65535]):initValues(_3C_classLit, {9:1}, -1, [codePoint & 65535]);
}

function toUpperCase(c){
  return String.fromCharCode(c).toUpperCase().charCodeAt(0);
}

function valueOf_12(c){
  var result;
  if (c < 128) {
    result = ($clinit_431() , boxedValues_0)[c];
    !result && (result = boxedValues_0[c] = new Character_0(c));
    return result;
  }
  return new Character_0(c);
}

function Character(){
}

_ = Character_0.prototype = Character.prototype = new Object_0;
_.compareTo$ = function compareTo_1(c){
  return this.value_0 - dynamicCast(c, 63).value_0;
}
;
_.equals$ = function equals_8(o){
  return o != null && o.castableTypeMap$ && !!o.castableTypeMap$[63] && dynamicCast(o, 63).value_0 == this.value_0;
}
;
_.getClass$ = function getClass_234(){
  return Ljava_lang_Character_2_classLit;
}
;
_.hashCode$ = function hashCode_10(){
  return this.value_0;
}
;
_.toString$ = function toString_17(){
  return String.fromCharCode(this.value_0);
}
;
_.castableTypeMap$ = {9:1, 10:1, 63:1};
_.value_0 = 0;
function $clinit_431(){
  $clinit_431 = nullMethod;
  boxedValues_0 = initDim(_3Ljava_lang_Character_2_classLit, {9:1, 68:1}, 63, 128, 0);
}

var boxedValues_0;
function __parseAndValidateDouble(s){
  var toReturn;
  toReturn = __parseDouble(s);
  if (isNaN(toReturn)) {
    throw new NumberFormatException_0('For input string: "' + s + '"');
  }
  return toReturn;
}

function __parseAndValidateLong(s){
  var c, firstTime, head, i, length_0, maxDigits, maxValue, negative, radixPower, toReturn;
  if (s == null) {
    throw new NumberFormatException_0('null');
  }
  length_0 = s.length;
  negative = length_0 > 0 && s.charCodeAt(0) == 45;
  if (negative) {
    s = s.substr(1, s.length - 1);
    --length_0;
  }
  if (length_0 == 0) {
    throw new NumberFormatException_0('For input string: "' + s + '"');
  }
  while (s.length > 0 && s.charCodeAt(0) == 48) {
    s = s.substr(1, s.length - 1);
    --length_0;
  }
  if (length_0 > ($clinit_449() , maxLengthForRadix)[10]) {
    throw new NumberFormatException_0('For input string: "' + s + '"');
  }
  for (i = 0; i < length_0; ++i) {
    c = s.charCodeAt(i);
    if (c >= 48 && c < 58) {
      continue;
    }
    if (c >= 97 && c < 97) {
      continue;
    }
    if (c >= 65 && c < 65) {
      continue;
    }
    throw new NumberFormatException_0('For input string: "' + s + '"');
  }
  toReturn = P0_longLit;
  maxDigits = maxDigitsForRadix[10];
  radixPower = fromInt(maxDigitsRadixPower[10]);
  maxValue = maxValueForRadix[10];
  firstTime = true;
  head = length_0 % maxDigits;
  if (head > 0) {
    toReturn = fromInt(parseInt(s.substr(0, head - 0), 10));
    s = s.substr(head, s.length - head);
    length_0 -= head;
    firstTime = false;
  }
  while (length_0 >= maxDigits) {
    head = parseInt(s.substr(0, maxDigits - 0), 10);
    s = s.substr(maxDigits, s.length - maxDigits);
    length_0 -= maxDigits;
    if (firstTime) {
      firstTime = false;
    }
     else {
      if (gt(toReturn, maxValue)) {
        throw new NumberFormatException_0(s);
      }
      toReturn = mul(toReturn, radixPower);
    }
    toReturn = add_1(toReturn, fromInt(head));
  }
  if (!gte_0(toReturn, P0_longLit)) {
    throw new NumberFormatException_0('For input string: "' + s + '"');
  }
  negative && (toReturn = neg(toReturn));
  return toReturn;
}

function __parseDouble(str){
  var floatRegex = floatRegex_0;
  !floatRegex && (floatRegex = floatRegex_0 = /^\s*[+-]?((\d+\.?\d*)|(\.\d+))([eE][+-]?\d+)?[dDfF]?\s*$/i);
  if (floatRegex.test(str)) {
    return parseFloat(str);
  }
   else {
    return Number.NaN;
  }
}

var floatRegex_0 = null;
function IllegalArgumentException_2(message, cause){
  this.fillInStackTrace();
  this.cause = cause;
  this.detailMessage = message;
}

function IllegalArgumentException_3(cause){
  Exception_3.call(this, cause);
}

_ = IllegalArgumentException_3.prototype = IllegalArgumentException_2.prototype = IllegalArgumentException.prototype;
function IllegalStateException_2(message, cause){
  this.fillInStackTrace();
  this.cause = cause;
  this.detailMessage = message;
}

_ = IllegalStateException_2.prototype = IllegalStateException.prototype;
function numberOfLeadingZeros_0(i){
  var m_0, n, y;
  if (i < 0) {
    return 0;
  }
   else if (i == 0) {
    return 32;
  }
   else {
    y = -(~~i >> 16);
    m_0 = ~~y >> 16 & 16;
    n = 16 - m_0;
    i = ~~i >> m_0;
    y = i - 256;
    m_0 = ~~y >> 16 & 8;
    n += m_0;
    i <<= m_0;
    y = i - 4096;
    m_0 = ~~y >> 16 & 4;
    n += m_0;
    i <<= m_0;
    y = i - 16384;
    m_0 = ~~y >> 16 & 2;
    n += m_0;
    i <<= m_0;
    y = ~~i >> 14;
    m_0 = y & ~(~~y >> 1);
    return n + 2 - m_0;
  }
}

function numberOfTrailingZeros(i){
  var r, rtn;
  if (i == 0) {
    return 32;
  }
   else {
    rtn = 0;
    for (r = 1; (r & i) == 0; r <<= 1) {
      ++rtn;
    }
    return rtn;
  }
}

function signum(i){
  return i == 0?0:i < 0?-1:1;
}

function $compareTo_5(this$static, b){
  return !gte_0(this$static.value_0, b.value_0)?-1:gt(this$static.value_0, b.value_0)?1:0;
}

function Long_0(value){
  this.value_0 = value;
}

function signum_0(i){
  return eq(i, P0_longLit)?0:!gte_0(i, P0_longLit)?-1:1;
}

function toPowerOfTwoString_0(value){
  var buf, digits, pos;
  buf = initDim(_3C_classLit, {9:1}, -1, 16, 1);
  digits = ($clinit_448() , digits_0);
  pos = 15;
  if (gte_0(value, P0_longLit)) {
    while (gt(value, Pf_longLit)) {
      buf[pos--] = digits[toInt(and(value, Pf_longLit))];
      value = shr(value, 4);
    }
  }
   else {
    while (pos > 0) {
      buf[pos--] = digits[toInt(and(value, Pf_longLit))];
      value = shr(value, 4);
    }
  }
  buf[pos] = digits[toInt(and(value, Pf_longLit))];
  return __valueOf(buf, pos, 16);
}

function valueOf_14(i){
  var rebase, result;
  if (gt(i, N81_longLit) && !gte_0(i, P80_longLit)) {
    rebase = (i.l | i.m << 22) + 128;
    result = ($clinit_445() , boxedValues_2)[rebase];
    !result && (result = boxedValues_2[rebase] = new Long_0(i));
    return result;
  }
  return new Long_0(i);
}

function Long(){
}

_ = Long_0.prototype = Long.prototype = new Number_0;
_.compareTo$ = function compareTo_4(b){
  return $compareTo_5(this, dynamicCast(b, 67));
}
;
_.equals$ = function equals_11(o){
  return o != null && o.castableTypeMap$ && !!o.castableTypeMap$[67] && eq(dynamicCast(o, 67).value_0, this.value_0);
}
;
_.getClass$ = function getClass_243(){
  return Ljava_lang_Long_2_classLit;
}
;
_.hashCode$ = function hashCode_13(){
  return toInt(this.value_0);
}
;
_.toString$ = function toString_21(){
  return '' + toString_14(this.value_0);
}
;
_.castableTypeMap$ = {9:1, 10:1, 67:1, 83:1};
_.value_0 = P0_longLit;
function $clinit_445(){
  $clinit_445 = nullMethod;
  boxedValues_2 = initDim(_3Ljava_lang_Long_2_classLit, {9:1, 68:1}, 67, 256, 0);
}

var boxedValues_2;
function max_2(x, y){
  return gt(x, y)?x:y;
}

function min_1(x, y){
  return x < y?x:y;
}

function signum_1(d){
  return d > 0?1:d < 0?-1:0;
}

function $clinit_449(){
  $clinit_449 = nullMethod;
  var i;
  maxDigitsForRadix = initValues(_3I_classLit, {9:1}, -1, [-1, -1, 30, 19, 15, 13, 11, 11, 10, 9, 9, 8, 8, 8, 8, 7, 7, 7, 7, 7, 7, 7, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5]);
  maxDigitsRadixPower = initDim(_3I_classLit, {9:1}, -1, 37, 1);
  maxLengthForRadix = initValues(_3I_classLit, {9:1}, -1, [-1, -1, 63, 40, 32, 28, 25, 23, 21, 20, 19, 19, 18, 18, 17, 17, 16, 16, 16, 15, 15, 15, 15, 14, 14, 14, 14, 14, 14, 13, 13, 13, 13, 13, 13, 13, 13]);
  maxValueForRadix = initDim(_3J_classLit, {9:1}, -1, 37, 3);
  for (i = 2; i <= 36; ++i) {
    maxDigitsRadixPower[i] = round_int(Math.pow(i, maxDigitsForRadix[i]));
    maxValueForRadix[i] = divMod(P7fffffffffffffff_longLit, fromInt(maxDigitsRadixPower[i]), false);
  }
}

var maxDigitsForRadix, maxDigitsRadixPower, maxLengthForRadix, maxValueForRadix;
function $codePointAt(this$static, index){
  return codePointAt(this$static, index, this$static.length);
}

function $equalsIgnoreCase(this$static, other){
  if (other == null)
    return false;
  return this$static == other || this$static.toLowerCase() == other.toLowerCase();
}

function $getChars(this$static, srcBegin, srcEnd, dst, dstBegin){
  var srcIdx;
  for (srcIdx = srcBegin; srcIdx < srcEnd; ++srcIdx) {
    dst[dstBegin++] = this$static.charCodeAt(srcIdx);
  }
}

function $indexOf_0(this$static, codePoint, startIndex){
  return this$static.indexOf(fromCodePoint(codePoint), startIndex);
}

function $replace_0(this$static, from, to){
  var regex;
  if (from < 256) {
    regex = toPowerOfTwoString(from);
    regex = '\\x' + '00'.substring(regex.length) + regex;
  }
   else {
    regex = String.fromCharCode(from);
  }
  return this$static.replace(RegExp(regex, 'g'), String.fromCharCode(to));
}

function $replace_1(this$static, from, to){
  var regex, replacement;
  regex = $replaceAll(from, '([/\\\\\\.\\*\\+\\?\\|\\(\\)\\[\\]\\{\\}$^])', '\\\\$1');
  replacement = $replaceAll($replaceAll(to, '\\\\', '\\\\\\\\'), '\\$', '\\\\$');
  return $replaceAll(this$static, regex, replacement);
}

function $replaceFirst(this$static, regex, replace){
  replace = __translateReplaceString(replace);
  return this$static.replace(RegExp(regex), replace);
}

function $split(this$static, regex, maxMatch){
  var compiled = new RegExp(regex, 'g');
  var out = [];
  var count = 0;
  var trail = this$static;
  var lastTrail = null;
  while (true) {
    var matchObj = compiled.exec(trail);
    if (matchObj == null || trail == '' || count == maxMatch - 1 && maxMatch > 0) {
      out[count] = trail;
      break;
    }
     else {
      out[count] = trail.substring(0, matchObj.index);
      trail = trail.substring(matchObj.index + matchObj[0].length, trail.length);
      compiled.lastIndex = 0;
      if (lastTrail == trail) {
        out[count] = trail.substring(0, 1);
        trail = trail.substring(1);
      }
      lastTrail = trail;
      count++;
    }
  }
  if (maxMatch == 0 && this$static.length > 0) {
    var lastNonEmpty = out.length;
    while (lastNonEmpty > 0 && out[lastNonEmpty - 1] == '') {
      --lastNonEmpty;
    }
    lastNonEmpty < out.length && out.splice(lastNonEmpty, out.length - lastNonEmpty);
  }
  var jr = initDim(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, out.length, 0);
  for (var i = 0; i < out.length; ++i) {
    jr[i] = out[i];
  }
  return jr;
}

function $toCharArray(this$static){
  var charArr, n;
  n = this$static.length;
  charArr = initDim(_3C_classLit, {9:1}, -1, n, 1);
  $getChars(this$static, 0, n, charArr, 0);
  return charArr;
}

function __checkBounds(legalCount, end){
  if (end < 0) {
    throw new StringIndexOutOfBoundsException_0(end);
  }
  if (end > legalCount) {
    throw new StringIndexOutOfBoundsException_0(end);
  }
}

function $append_3(this$static, x){
  this$static.impl.string += String.fromCharCode.apply(null, x);
  return this$static;
}

function $append_4(this$static, x){
  this$static.impl.string += x;
  return this$static;
}

function $replace_2(this$static, end){
  $replace(this$static.impl, 0, end, '');
  return this$static;
}

function StringBuffer_1(){
  this.impl = new StringBufferImplAppend_0;
}

_ = StringBuffer_1.prototype = StringBuffer.prototype;
function $append_6(this$static, x){
  this$static.impl.string += String.fromCharCode(x);
  return this$static;
}

function $append_7(this$static, x){
  this$static.impl.string += String.fromCharCode.apply(null, x);
  return this$static;
}

function $append_8(this$static, x){
  this$static.impl.string += x;
  return this$static;
}

function $append_9(this$static, x){
  this$static.impl.string += x;
  return this$static;
}

function $append_12(this$static, x){
  return this$static.impl.string += x , this$static;
}

function $charAt_0(this$static, index){
  return this$static.impl.string.charCodeAt(index);
}

function $insert_3(this$static, index, x){
  return $replace(this$static.impl, index, index, x) , this$static;
}

function $replace_3(this$static, start, end, toInsert){
  $replace(this$static.impl, start, end, toInsert);
  return this$static;
}

function $setCharAt(this$static, index, x){
  $replace_3(this$static, index, index + 1, String.fromCharCode(x));
}

function $setLength_1(this$static, newLength){
  var oldLength;
  oldLength = this$static.impl.string.length;
  newLength < oldLength?($replace(this$static.impl, newLength, oldLength, '') , this$static):newLength > oldLength && $append_7(this$static, initDim(_3C_classLit, {9:1}, -1, newLength - oldLength, 1));
}

function StringIndexOutOfBoundsException_0(index){
  this.fillInStackTrace();
  this.detailMessage = 'String index out of range: ' + index;
}

function StringIndexOutOfBoundsException(){
}

_ = StringIndexOutOfBoundsException_0.prototype = StringIndexOutOfBoundsException.prototype = new IndexOutOfBoundsException;
_.getClass$ = function getClass_250(){
  return Ljava_lang_StringIndexOutOfBoundsException_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 21:1, 39:1, 183:1};
function arraycopy(src, srcOfs, dest, destOfs, len){
  var destArray, destComp, destEnd, destType, destlen, srcArray, srcComp, srcType, srclen;
  if (src == null || dest == null) {
    throw new NullPointerException_0;
  }
  srcType = getClass__devirtual$(src);
  destType = getClass__devirtual$(dest);
  if ((srcType.modifiers & 4) == 0 || (destType.modifiers & 4) == 0) {
    throw new ArrayStoreException_1('Must be array types');
  }
  srcComp = srcType.componentType;
  destComp = destType.componentType;
  if (!((srcComp.modifiers & 1) != 0?srcComp == destComp:(destComp.modifiers & 1) == 0)) {
    throw new ArrayStoreException_1('Array types must match');
  }
  srclen = src.length;
  destlen = dest.length;
  if (srcOfs < 0 || destOfs < 0 || len < 0 || srcOfs + len > srclen || destOfs + len > destlen) {
    throw new IndexOutOfBoundsException_0;
  }
  if (((srcComp.modifiers & 1) == 0 || (srcComp.modifiers & 4) != 0) && srcType != destType) {
    srcArray = dynamicCast(src, 68);
    destArray = dynamicCast(dest, 68);
    if (src === dest && srcOfs < destOfs) {
      srcOfs += len;
      for (destEnd = destOfs + len; destEnd-- > destOfs;) {
        setCheck(destArray, destEnd, srcArray[--srcOfs]);
      }
    }
     else {
      for (destEnd = destOfs + len; destOfs < destEnd;) {
        setCheck(destArray, destOfs++, srcArray[srcOfs++]);
      }
    }
  }
   else {
    Array.prototype.splice.apply(dest, [destOfs, len].concat(src.slice(srcOfs, srcOfs + len)));
  }
}

function $putAll(this$static, t){
  var e, iter;
  for (iter = t.entrySet_0().iterator_0(); iter.hasNext();) {
    e = dynamicCast(iter.next_0(), 11);
    this$static.put(e.getKey(), e.getValue());
  }
}

function $values(this$static){
  var entrySet;
  entrySet = this$static.entrySet_0();
  return new AbstractMap$2_0(this$static, entrySet);
}

_ = AbstractMap.prototype;
_.clear = function clear_1(){
  this.entrySet_0().clear();
}
;
_.isEmpty = function isEmpty_0(){
  return this.size_1() == 0;
}
;
_.keySet_0 = function keySet_0(){
  var entrySet;
  return entrySet = this.entrySet_0() , new AbstractMap$1_0(this, entrySet);
}
;
_.putAll = function putAll(t){
  $putAll(this, t);
}
;
function $containsHashValue(this$static, value){
  var hashCodeMap = this$static.hashCodeMap;
  for (var hashCode in hashCodeMap) {
    var hashCodeInt = parseInt(hashCode, 10);
    if (hashCode == hashCodeInt) {
      var array = hashCodeMap[hashCodeInt];
      for (var i = 0, c = array.length; i < c; ++i) {
        var entry = array[i];
        var entryValue = entry.getValue();
        if (this$static.equalsBridge(value, entryValue)) {
          return true;
        }
      }
    }
  }
  return false;
}

function $containsStringValue(this$static, value){
  var stringMap = this$static.stringMap;
  for (var key in stringMap) {
    if (key.charCodeAt(0) == 58) {
      var entryValue = stringMap[key];
      if (this$static.equalsBridge(value, entryValue)) {
        return true;
      }
    }
  }
  return false;
}

_ = AbstractHashMap.prototype;
_.clear = function clear_2(){
  $clearImpl(this);
}
;
_.containsValue = function containsValue(value){
  if (this.nullSlotLive && this.equals(this.nullSlot, value)) {
    return true;
  }
   else if ($containsStringValue(this, value)) {
    return true;
  }
   else if ($containsHashValue(this, value)) {
    return true;
  }
  return false;
}
;
_ = AbstractHashMap$EntrySet.prototype;
_.clear = function clear_3(){
  this.this$0.clear();
}
;
function $indexOf_3(this$static, toFind){
  var i, n;
  for (i = 0 , n = this$static.array.length; i < n; ++i) {
    if (toFind == null?(checkIndex(i, this$static.array.length) , this$static.array[i]) == null:equals__devirtual$(toFind, (checkIndex(i, this$static.array.length) , this$static.array[i]))) {
      return i;
    }
  }
  return -1;
}

_ = AbstractList.prototype;
_.clear = function clear_4(){
  this.removeRange(0, this.size_1());
}
;
_.removeRange = function removeRange(fromIndex, endIndex){
  var i, iter;
  iter = this.listIterator_0(fromIndex);
  for (i = fromIndex; i < endIndex; ++i) {
    iter.next_0();
    iter.remove_1();
  }
}
;
_.set_0 = function set_1(index, o){
  throw new UnsupportedOperationException_1('Set not supported on this list');
}
;
function $set_3(this$static, o){
  if (this$static.last == -1) {
    throw new IllegalStateException_0;
  }
  this$static.this$0.set_0(this$static.last, o);
}

function AbstractMap$2_0(this$0, val$entrySet){
  this.this$0 = this$0;
  this.val$entrySet = val$entrySet;
}

function AbstractMap$2(){
}

_ = AbstractMap$2_0.prototype = AbstractMap$2.prototype = new AbstractCollection;
_.contains = function contains_3(value){
  return this.this$0.containsValue(value);
}
;
_.getClass$ = function getClass_264(){
  return Ljava_util_AbstractMap$2_2_classLit;
}
;
_.iterator_0 = function iterator_7(){
  var outerIter;
  return outerIter = this.val$entrySet.iterator_0() , new AbstractMap$2$1_0(outerIter);
}
;
_.size_1 = function size_7(){
  return this.val$entrySet.size_1();
}
;
_.castableTypeMap$ = {363:1};
_.this$0 = null;
_.val$entrySet = null;
function AbstractMap$2$1_0(val$outerIter){
  this.val$outerIter = val$outerIter;
}

function AbstractMap$2$1(){
}

_ = AbstractMap$2$1_0.prototype = AbstractMap$2$1.prototype = new Object_0;
_.getClass$ = function getClass_265(){
  return Ljava_util_AbstractMap$2$1_2_classLit;
}
;
_.hasNext = function hasNext_5(){
  return this.val$outerIter.hasNext();
}
;
_.next_0 = function next_13(){
  return dynamicCast(this.val$outerIter.next_0(), 11).getValue();
}
;
_.remove_1 = function remove_17(){
  this.val$outerIter.remove_1();
}
;
_.castableTypeMap$ = {};
_.val$outerIter = null;
function $element(this$static){
  var e;
  e = $peek_0(this$static);
  if (e == null) {
    throw new NoSuchElementException_1('Queue is empty');
  }
  return e;
}

function $remove_11(this$static){
  var e;
  e = this$static.poll();
  if (e == null) {
    throw new NoSuchElementException_1('Queue is empty');
  }
  return e;
}

_ = AbstractQueue.prototype;
_.addAll = function addAll_0(c){
  var modified, val, val$iterator;
  if (c == this) {
    throw new IllegalArgumentException_1("Can't add a queue to itself");
  }
  modified = false;
  for (val$iterator = c.iterator_0(); val$iterator.hasNext();) {
    val = val$iterator.next_0();
    modified |= $add_8(this, val);
  }
  return modified;
}
;
_.clear = function clear_5(){
  while (this.poll() != null) {
  }
}
;
_.remove_5 = function remove_18(){
  return $remove_11(this);
}
;
_ = AbstractSequentialList.prototype;
_.set_0 = function set_2(index, element){
  var $e0, iter, old;
  iter = $listIterator_2(this, index);
  try {
    old = $next_11(iter);
    $verifyCurrentElement(iter);
    iter.lastNode.value_0 = element;
    return old;
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 167)) {
      throw new IndexOutOfBoundsException_1("Can't set element " + index);
    }
     else 
      throw $e0;
  }
}
;
function $addAll_0(this$static, c){
  var cArray, len;
  cArray = c.toArray();
  len = cArray.length;
  if (len == 0) {
    return false;
  }
  Array.prototype.splice.apply(this$static.array, [this$static.size_0, 0].concat(cArray));
  this$static.size_0 += len;
  return true;
}

function $clear_4(this$static){
  this$static.array = initDim(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, 0, 0);
  this$static.size_0 = 0;
}

function $removeRange(this$static, fromIndex, endIndex){
  var count;
  checkIndex(fromIndex, this$static.size_0);
  (endIndex < fromIndex || endIndex > this$static.size_0) && indexOutOfBounds(endIndex, this$static.size_0);
  count = endIndex - fromIndex;
  this$static.array.splice(fromIndex, count);
  this$static.size_0 -= count;
}

function $toArray_0(this$static){
  var a_0, result;
  return a_0 = this$static.array , result = a_0.slice(0, this$static.size_0) , initValues(a_0.arrayClass$, a_0.castableTypeMap$, a_0.queryId$, result) , result;
}

function $toArray_1(this$static, out){
  var i, a_0, result;
  out.length < this$static.size_0 && (out = (a_0 = out , result = createFromSeed(0, this$static.size_0) , initValues(a_0.arrayClass$, a_0.castableTypeMap$, a_0.queryId$, result) , result));
  for (i = 0; i < this$static.size_0; ++i) {
    setCheck(out, i, this$static.array[i]);
  }
  out.length > this$static.size_0 && setCheck(out, this$static.size_0, null);
  return out;
}

function ArrayList_1(c){
  var a_0, result;
  $$init_26(this);
  Array.prototype.splice.apply(this.array, [0, 0].concat((a_0 = c.array , result = a_0.slice(0, c.size_0) , initValues(a_0.arrayClass$, a_0.castableTypeMap$, a_0.queryId$, result) , result)));
  this.size_0 = this.array.length;
}

_ = ArrayList_1.prototype = ArrayList.prototype;
_.addAll = function addAll_1(c){
  return $addAll_0(this, c);
}
;
_.clear = function clear_6(){
  this.array = initDim(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, 0, 0);
  this.size_0 = 0;
}
;
_.removeRange = function removeRange_0(fromIndex, endIndex){
  $removeRange(this, fromIndex, endIndex);
}
;
_.set_0 = function set_3(index, o){
  var previous;
  return previous = (checkIndex(index, this.size_0) , this.array[index]) , setCheck(this.array, index, o) , previous;
}
;
_.toArray = function toArray_1(){
  var a_0, result;
  return a_0 = this.array , result = a_0.slice(0, this.size_0) , initValues(a_0.arrayClass$, a_0.castableTypeMap$, a_0.queryId$, result) , result;
}
;
_.toArray_0 = function toArray_2(out){
  return $toArray_1(this, out);
}
;
function equals_16(array1, array2){
  var i;
  if ((array1 == null?null:array1) === (array2 == null?null:array2)) {
    return true;
  }
  if (array1 == null || array2 == null) {
    return false;
  }
  if (array1.length != array2.length) {
    return false;
  }
  for (i = 0; i < array1.length; ++i) {
    if (array1[i] != array2[i]) {
      return false;
    }
  }
  return true;
}

function hashCode_18(a_0){
  var hashCode, i, n;
  if (a_0 == null) {
    return 0;
  }
  hashCode = 1;
  for (i = 0 , n = a_0.length; i < n; ++i) {
    hashCode = 31 * hashCode + a_0[i] | 0;
  }
  return hashCode;
}

function insertionSort(array, low, high, comp){
  var i, j, t;
  for (i = low + 1; i < high; ++i) {
    for (j = i; j > low && comp.compare(array[j - 1], array[j]) > 0; --j) {
      t = array[j];
      setCheck(array, j, array[j - 1]);
      setCheck(array, j - 1, t);
    }
  }
}

function merge(src, srcLow, srcMid, srcHigh, dest, destLow, destHigh, comp){
  var topIdx;
  topIdx = srcMid;
  while (destLow < destHigh) {
    topIdx >= srcHigh || srcLow < srcMid && comp.compare(src[srcLow], src[topIdx]) <= 0?setCheck(dest, destLow++, src[srcLow++]):setCheck(dest, destLow++, src[topIdx++]);
  }
}

function mergeSort(x, fromIndex, toIndex, comp){
  var temp, a_0, result;
  temp = (a_0 = x , result = a_0.slice(fromIndex, toIndex) , initValues(a_0.arrayClass$, a_0.castableTypeMap$, a_0.queryId$, result) , result);
  mergeSort_0(temp, x, fromIndex, toIndex, -fromIndex, comp);
}

function mergeSort_0(temp, array, low, high, ofs, comp){
  var length_0, tempHigh, tempLow, tempMid;
  length_0 = high - low;
  if (length_0 < 7) {
    insertionSort(array, low, high, comp);
    return;
  }
  tempLow = low + ofs;
  tempHigh = high + ofs;
  tempMid = tempLow + (~~(tempHigh - tempLow) >> 1);
  mergeSort_0(array, temp, tempLow, tempMid, -ofs, comp);
  mergeSort_0(array, temp, tempMid, tempHigh, -ofs, comp);
  if (comp.compare(temp[tempMid - 1], temp[tempMid]) <= 0) {
    while (low < high) {
      setCheck(array, low++, temp[tempLow++]);
    }
    return;
  }
  merge(temp, tempLow, tempMid, tempHigh, array, low, high, comp);
}

function sort(array){
  mergeSort(array, 0, array.length, ($clinit_497() , $clinit_497() , NATURAL));
}

function sort_0(x, c){
  mergeSort(x, 0, x.length, c?c:($clinit_497() , $clinit_497() , NATURAL));
}

function Arrays$ArrayList_0(array){
  this.array = array;
}

function Arrays$ArrayList(){
}

_ = Arrays$ArrayList_0.prototype = Arrays$ArrayList.prototype = new AbstractList;
_.contains = function contains_5(o){
  return $indexOf_3(this, o) != -1;
}
;
_.get_0 = function get_5(index){
  return checkIndex(index, this.array.length) , this.array[index];
}
;
_.getClass$ = function getClass_269(){
  return Ljava_util_Arrays$ArrayList_2_classLit;
}
;
_.set_0 = function set_4(index, value){
  var was;
  checkIndex(index, this.array.length);
  was = this.array[index];
  setCheck(this.array, index, value);
  return was;
}
;
_.size_1 = function size_9(){
  return this.array.length;
}
;
_.toArray = function toArray_3(){
  return clone_0(this.array);
}
;
_.toArray_0 = function toArray_4(out){
  var i, size;
  size = this.array.length;
  out.length < size && (out = createFrom(out, size));
  for (i = 0; i < size; ++i) {
    setCheck(out, i, this.array[i]);
  }
  out.length > size && setCheck(out, size, null);
  return out;
}
;
_.castableTypeMap$ = {9:1, 41:1, 363:1};
_.array = null;
function replaceContents(target, x){
  var i, size, previous;
  size = target.size_0;
  for (i = 0; i < size; ++i) {
    previous = (checkIndex(i, target.size_0) , target.array[i]);
    setCheck(target.array, i, x[i]);
  }
}

function singleton_1(o){
  var old;
  $clinit_480();
  var set;
  set = new HashSet_2(1);
  old = set.map.put(o, set);
  return new Collections$UnmodifiableSet_0(set);
}

function singletonMap(key, value){
  $clinit_480();
  var map;
  map = new HashMap_1(1);
  map.put(key, value);
  return new Collections$UnmodifiableMap_0(map);
}

function sort_2(target, c){
  var a_0, result;
  $clinit_480();
  var x;
  x = (a_0 = target.array , result = a_0.slice(0, target.size_0) , initValues(a_0.arrayClass$, a_0.castableTypeMap$, a_0.queryId$, result) , result);
  mergeSort(x, 0, x.length, c?c:($clinit_497() , $clinit_497() , NATURAL));
  replaceContents(target, x);
}

_ = Collections$EmptyMap.prototype;
_.keySet_0 = function keySet_1(){
  return $clinit_480() , EMPTY_SET;
}
;
function Collections$SingletonList_0(){
  this.element = 'line';
}

function Collections$SingletonList(){
}

_ = Collections$SingletonList_0.prototype = Collections$SingletonList.prototype = new AbstractList;
_.contains = function contains_8(item){
  return equalsWithNullCheck(this.element, item);
}
;
_.get_0 = function get_8(index){
  if (index == 0) {
    return this.element;
  }
   else {
    throw new IndexOutOfBoundsException_0;
  }
}
;
_.getClass$ = function getClass_274(){
  return Ljava_util_Collections$SingletonList_2_classLit;
}
;
_.size_1 = function size_13(){
  return 1;
}
;
_.castableTypeMap$ = {9:1, 41:1, 363:1};
_.element = null;
_ = Collections$UnmodifiableCollection.prototype;
_.addAll = function addAll_3(c){
  throw new UnsupportedOperationException_0;
}
;
_.clear = function clear_7(){
  throw new UnsupportedOperationException_0;
}
;
_.removeAll = function removeAll_0(c){
  throw new UnsupportedOperationException_0;
}
;
_.toArray = function toArray_5(){
  return this.coll.toArray();
}
;
_ = Collections$UnmodifiableList.prototype;
_.get_0 = function get_9(index){
  return this.list.get_0(index);
}
;
function Collections$UnmodifiableMap_0(map){
  this.map = map;
}

function Collections$UnmodifiableMap(){
}

_ = Collections$UnmodifiableMap_0.prototype = Collections$UnmodifiableMap.prototype = new Object_0;
_.clear = function clear_8(){
  throw new UnsupportedOperationException_0;
}
;
_.containsKey = function containsKey_2(key){
  return this.map.containsKey(key);
}
;
_.entrySet_0 = function entrySet_2(){
  !this.entrySet && (this.entrySet = new Collections$UnmodifiableMap$UnmodifiableEntrySet_0(this.map.entrySet_0()));
  return this.entrySet;
}
;
_.equals$ = function equals_18(o){
  return this.map.equals$(o);
}
;
_.get = function get_10(key){
  return this.map.get(key);
}
;
_.getClass$ = function getClass_279(){
  return Ljava_util_Collections$UnmodifiableMap_2_classLit;
}
;
_.hashCode$ = function hashCode_20(){
  return this.map.hashCode$();
}
;
_.isEmpty = function isEmpty_4(){
  return this.map.size_1() == 0;
}
;
_.keySet_0 = function keySet_2(){
  !this.keySet && (this.keySet = new Collections$UnmodifiableSet_0(this.map.keySet_0()));
  return this.keySet;
}
;
_.put = function put_1(key, value){
  throw new UnsupportedOperationException_0;
}
;
_.putAll = function putAll_0(t){
  throw new UnsupportedOperationException_0;
}
;
_.remove_3 = function remove_25(key){
  throw new UnsupportedOperationException_0;
}
;
_.size_1 = function size_15(){
  return this.map.size_1();
}
;
_.toString$ = function toString_29(){
  return $toString_15(this.map);
}
;
_.castableTypeMap$ = {40:1};
_.entrySet = null;
_.keySet = null;
_.map = null;
function Collections$UnmodifiableSet_0(set){
  this.coll = set;
}

function Collections$UnmodifiableSet(){
}

_ = Collections$UnmodifiableSet_0.prototype = Collections$UnmodifiableSet.prototype = new Collections$UnmodifiableCollection;
_.equals$ = function equals_19(o){
  return this.coll.equals$(o);
}
;
_.getClass$ = function getClass_280(){
  return Ljava_util_Collections$UnmodifiableSet_2_classLit;
}
;
_.hashCode$ = function hashCode_21(){
  return this.coll.hashCode$();
}
;
_.castableTypeMap$ = {168:1, 363:1};
function $wrap(array, size){
  var i;
  for (i = 0; i < size; ++i) {
    setCheck(array, i, new Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry_0(dynamicCast(array[i], 11)));
  }
}

function Collections$UnmodifiableMap$UnmodifiableEntrySet_0(s){
  this.coll = s;
}

function Collections$UnmodifiableMap$UnmodifiableEntrySet(){
}

_ = Collections$UnmodifiableMap$UnmodifiableEntrySet_0.prototype = Collections$UnmodifiableMap$UnmodifiableEntrySet.prototype = new Collections$UnmodifiableSet;
_.contains = function contains_10(o){
  return this.coll.contains(o);
}
;
_.getClass$ = function getClass_281(){
  return Ljava_util_Collections$UnmodifiableMap$UnmodifiableEntrySet_2_classLit;
}
;
_.iterator_0 = function iterator_11(){
  var it;
  it = this.coll.iterator_0();
  return new Collections$UnmodifiableMap$UnmodifiableEntrySet$1_0(it);
}
;
_.toArray = function toArray_6(){
  var array;
  array = this.coll.toArray();
  $wrap(array, array.length);
  return array;
}
;
_.castableTypeMap$ = {168:1, 363:1};
function Collections$UnmodifiableMap$UnmodifiableEntrySet$1_0(val$it){
  this.val$it = val$it;
}

function Collections$UnmodifiableMap$UnmodifiableEntrySet$1(){
}

_ = Collections$UnmodifiableMap$UnmodifiableEntrySet$1_0.prototype = Collections$UnmodifiableMap$UnmodifiableEntrySet$1.prototype = new Object_0;
_.getClass$ = function getClass_282(){
  return Ljava_util_Collections$UnmodifiableMap$UnmodifiableEntrySet$1_2_classLit;
}
;
_.hasNext = function hasNext_8(){
  return this.val$it.hasNext();
}
;
_.next_0 = function next_16(){
  return new Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry_0(dynamicCast(this.val$it.next_0(), 11));
}
;
_.remove_1 = function remove_26(){
  throw new UnsupportedOperationException_0;
}
;
_.castableTypeMap$ = {};
_.val$it = null;
function Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry_0(entry){
  this.entry = entry;
}

function Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry(){
}

_ = Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry_0.prototype = Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry.prototype = new Object_0;
_.equals$ = function equals_20(o){
  return this.entry.equals$(o);
}
;
_.getClass$ = function getClass_283(){
  return Ljava_util_Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry_2_classLit;
}
;
_.getKey = function getKey_1(){
  return this.entry.getKey();
}
;
_.getValue = function getValue_1(){
  return this.entry.getValue();
}
;
_.hashCode$ = function hashCode_22(){
  return this.entry.hashCode$();
}
;
_.setValue = function setValue_1(value){
  throw new UnsupportedOperationException_0;
}
;
_.toString$ = function toString_30(){
  return toString__devirtual$(this.entry);
}
;
_.castableTypeMap$ = {11:1};
_.entry = null;
function $compareTo_6(this$static, other){
  var otherTime, thisTime;
  thisTime = fromDouble(this$static.jsdate.getTime());
  otherTime = fromDouble(other.jsdate.getTime());
  return !gte_0(thisTime, otherTime)?-1:gt(thisTime, otherTime)?1:0;
}

function Date_1(){
  this.jsdate = new Date;
}

function Date_2(date){
  this.jsdate = new Date(toDouble(date));
}

function padTwo(number){
  return number < 10?'0' + number:'' + number;
}

function Date_0(){
}

_ = Date_2.prototype = Date_1.prototype = Date_0.prototype = new Object_0;
_.compareTo$ = function compareTo_7(other){
  return $compareTo_6(this, dynamicCast(other, 169));
}
;
_.equals$ = function equals_21(obj){
  return obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[169] && eq(fromDouble(this.jsdate.getTime()), fromDouble(dynamicCast(obj, 169).jsdate.getTime()));
}
;
_.getClass$ = function getClass_286(){
  return Ljava_util_Date_2_classLit;
}
;
_.hashCode$ = function hashCode_23(){
  var time_0;
  return time_0 = fromDouble(this.jsdate.getTime()) , toInt(xor(time_0, shru(time_0, 32)));
}
;
_.toString$ = function toString_31(){
  var hourOffset, minuteOffset, offset;
  offset = -this.jsdate.getTimezoneOffset();
  hourOffset = (offset >= 0?'+':'') + ~~(offset / 60);
  minuteOffset = (offset < 0?-offset:offset) % 60 < 10?'0' + (offset < 0?-offset:offset) % 60:'' + (offset < 0?-offset:offset) % 60;
  return ($clinit_500() , DAYS)[this.jsdate.getDay()] + ' ' + MONTHS[this.jsdate.getMonth()] + ' ' + padTwo(this.jsdate.getDate()) + ' ' + padTwo(this.jsdate.getHours()) + ':' + padTwo(this.jsdate.getMinutes()) + ':' + padTwo(this.jsdate.getSeconds()) + ' GMT' + hourOffset + minuteOffset + ' ' + this.jsdate.getFullYear();
}
;
_.castableTypeMap$ = {9:1, 10:1, 169:1};
_.jsdate = null;
function $clinit_500(){
  $clinit_500 = nullMethod;
  DAYS = initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']);
  MONTHS = initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']);
}

var DAYS, MONTHS;
function EmptyStackException_0(){
  this.fillInStackTrace();
}

function EmptyStackException(){
}

_ = EmptyStackException_0.prototype = EmptyStackException.prototype = new RuntimeException;
_.getClass$ = function getClass_287(){
  return Ljava_util_EmptyStackException_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 21:1, 39:1, 183:1};
function $clear_5(this$static){
  $clear_0(this$static.keySet);
  this$static.values = initDim(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, this$static.values.length, 0);
}

_ = EnumMap.prototype;
_.clear = function clear_9(){
  $clear_0(this.keySet);
  this.values = initDim(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, this.values.length, 0);
}
;
_ = EnumMap$EntrySet.prototype;
_.clear = function clear_10(){
  $clear_5(this.this$0);
}
;
function allOf(elementType){
  var all, set, a_0, result;
  all = dynamicCast(elementType.enumConstantsFunc && elementType.enumConstantsFunc(), 170);
  set = dynamicCast((a_0 = all , result = a_0.slice(0, all.length) , initValues(a_0.arrayClass$, a_0.castableTypeMap$, a_0.queryId$, result) , result), 170);
  return new EnumSet$EnumSetImpl_0(all, set, all.length);
}

function HashMap_1(ignored){
  AbstractHashMap_2.call(this, ignored, 0);
}

function HashMap_3(toBeCopied){
  $clearImpl(this);
  $putAll(this, toBeCopied);
}

_ = HashMap_3.prototype = HashMap_1.prototype = HashMap.prototype;
function HashSet_1(c){
  this.map = new HashMap_1(c.array.length);
  $addAll(this, c);
}

function HashSet_2(initialCapacity){
  this.map = new HashMap_1(initialCapacity);
}

_ = HashSet_2.prototype = HashSet_1.prototype = HashSet.prototype;
_.clear = function clear_11(){
  this.map.clear();
}
;
function $clear_7(this$static){
  this$static.map.clear();
  this$static.head.prev = this$static.head;
  this$static.head.next = this$static.head;
}

_ = LinkedHashMap.prototype;
_.clear = function clear_12(){
  $clear_7(this);
}
;
_.containsValue = function containsValue_0(value){
  var node;
  node = this.head.next;
  while (node != this.head) {
    if (equalsWithNullCheck(node.value_0, value)) {
      return true;
    }
    node = node.next;
  }
  return false;
}
;
_ = LinkedHashMap$EntrySet.prototype;
_.clear = function clear_13(){
  $clear_7(this.this$0);
}
;
function LinkedHashSet_0(){
  this.map = new LinkedHashMap_0;
}

_ = LinkedHashSet_0.prototype = LinkedHashSet.prototype;
function $addLast(this$static, o){
  new LinkedList$Node_2(o, this$static.header);
  ++this$static.size_0;
}

function $clear_8(this$static){
  this$static.header = new LinkedList$Node_0;
  this$static.size_0 = 0;
}

function $getLast_0(this$static){
  $throwEmptyException(this$static);
  return this$static.header.prev.value_0;
}

_ = LinkedList.prototype;
_.clear = function clear_14(){
  this.header = new LinkedList$Node_0;
  this.size_0 = 0;
}
;
_.remove_5 = function remove_35(){
  return $removeFirst(this);
}
;
function $makeHeap(this$static, node){
  var rightChild;
  if (node * 2 + 1 >= this$static.heap.size_0) {
    return;
  }
  $makeHeap(this$static, 2 * node + 1);
  rightChild = 2 * node + 2;
  rightChild < this$static.heap.size_0 && $makeHeap(this$static, rightChild);
  $mergeHeaps(this$static, node);
}

_ = PriorityQueue.prototype;
_.addAll = function addAll_4(c){
  var iter;
  if (c.isEmpty()) {
    return false;
  }
  iter = c.iterator_0();
  while (iter.hasNext()) {
    $add_9(this.heap, iter.next_0());
  }
  $makeHeap(this, 0);
  return true;
}
;
_.clear = function clear_15(){
  $clear_4(this.heap);
}
;
_.toArray = function toArray_7(){
  return $toArray_0(this.heap);
}
;
_.toArray_0 = function toArray_8(a_0){
  return $toArray_1(this.heap, a_0);
}
;
function Vector(){
}

_ = Vector.prototype = new AbstractList;
_.add_0 = function add_12(o){
  return $add_9(this.arrayList, o);
}
;
_.add_1 = function add_13(index, o){
  $add_10(this.arrayList, index, o);
}
;
_.addAll = function addAll_5(c){
  return $addAll_0(this.arrayList, c);
}
;
_.clear = function clear_16(){
  $clear_4(this.arrayList);
}
;
_.contains = function contains_16(elem){
  return $indexOf_4(this.arrayList, elem, 0) != -1;
}
;
_.get_0 = function get_13(index){
  return $get_7(this.arrayList, index);
}
;
_.getClass$ = function getClass_309(){
  return Ljava_util_Vector_2_classLit;
}
;
_.isEmpty = function isEmpty_7(){
  return this.arrayList.size_0 == 0;
}
;
_.iterator_0 = function iterator_17(){
  return new AbstractList$IteratorImpl_0(this.arrayList);
}
;
_.remove_4 = function remove_38(index){
  return $remove_12(this.arrayList, index);
}
;
_.removeRange = function removeRange_1(fromIndex, endIndex){
  $removeRange(this.arrayList, fromIndex, endIndex);
}
;
_.set_0 = function set_5(index, elem){
  return $set_4(this.arrayList, index, elem);
}
;
_.size_1 = function size_24(){
  return this.arrayList.size_0;
}
;
_.toArray = function toArray_9(){
  return $toArray_0(this.arrayList);
}
;
_.toArray_0 = function toArray_10(a_0){
  return $toArray_1(this.arrayList, a_0);
}
;
_.toString$ = function toString_34(){
  return $toString_7(this.arrayList);
}
;
_.castableTypeMap$ = {9:1, 41:1, 363:1};
_.arrayList = null;
function $peek_1(this$static){
  var sz;
  sz = this$static.arrayList.size_0;
  if (sz > 0) {
    return $get_7(this$static.arrayList, sz - 1);
  }
   else {
    throw new EmptyStackException_0;
  }
}

function $pop(this$static){
  var sz;
  sz = this$static.arrayList.size_0;
  if (sz > 0) {
    return $remove_12(this$static.arrayList, sz - 1);
  }
   else {
    throw new EmptyStackException_0;
  }
}

function $push_2(this$static, o){
  $add_9(this$static.arrayList, o);
  return o;
}

function Stack_0(){
  this.arrayList = new ArrayList_0;
}

function Stack(){
}

_ = Stack_0.prototype = Stack.prototype = new Vector;
_.getClass$ = function getClass_310(){
  return Ljava_util_Stack_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 41:1, 363:1, 454:1};
function $clinit_536(){
  $clinit_536 = nullMethod;
  DEFAULT_COMPARATOR = new TreeMap$1_0;
}

function $clear_10(this$static){
  this$static.root = null;
  this$static.size_0 = 0;
}

function $getEntry(this$static, key){
  var c, tree;
  tree = this$static.root;
  while (tree) {
    c = $compare_1(key, tree.key);
    if (c == 0) {
      return tree;
    }
    c < 0?(tree = tree.child[0]):(tree = tree.child[1]);
  }
  return null;
}

function $insert_4(this$static, tree, newNode, state){
  var c, childNum;
  if (!tree) {
    return newNode;
  }
   else {
    c = $compare_1(tree.key, newNode.key);
    if (c == 0) {
      state.value_0 = tree.value_0;
      state.found = true;
      tree.value_0 = newNode.value_0;
      return tree;
    }
    childNum = c > 0?0:1;
    tree.child[childNum] = $insert_4(this$static, tree.child[childNum], newNode, state);
    if ($isRed(tree.child[childNum])) {
      if ($isRed(tree.child[1 - childNum])) {
        tree.isRed = true;
        tree.child[0].isRed = false;
        tree.child[1].isRed = false;
      }
       else {
        $isRed(tree.child[childNum].child[childNum])?(tree = $rotateSingle(tree, 1 - childNum)):$isRed(tree.child[childNum].child[1 - childNum]) && (tree = (tree.child[1 - (1 - childNum)] = $rotateSingle(tree.child[1 - (1 - childNum)], 1 - (1 - childNum)) , $rotateSingle(tree, 1 - childNum)));
      }
    }
  }
  return tree;
}

function $isRed(node){
  return !!node && node.isRed;
}

function $put_3(this$static, key, value){
  var node, state;
  node = new TreeMap$Node_0(key, value);
  state = new TreeMap$State_0;
  this$static.root = $insert_4(this$static, this$static.root, node, state);
  state.found || ++this$static.size_0;
  this$static.root.isRed = false;
  return state.value_0;
}

function $remove_23(this$static, keyObj){
  var state;
  state = new TreeMap$State_0;
  $removeWithState(this$static, keyObj, state);
  return state.value_0;
}

function $removeWithState(this$static, key, state){
  var c, dir, dir2, found, grandparent, head, last, newNode, node, parent_0, sibling;
  if (!this$static.root) {
    return false;
  }
  found = null;
  parent_0 = null;
  head = new TreeMap$Node_0(null, null);
  dir = 1;
  head.child[1] = this$static.root;
  node = head;
  while (node.child[dir]) {
    last = dir;
    grandparent = parent_0;
    parent_0 = node;
    node = node.child[dir];
    c = $compare_1(node.key, key);
    dir = c < 0?1:0;
    c == 0 && (!state.matchValue || equals__devirtual$(node.value_0, state.value_0)) && (found = node);
    if (!(!!node && node.isRed) && !$isRed(node.child[dir])) {
      if ($isRed(node.child[1 - dir])) {
        parent_0 = parent_0.child[last] = $rotateSingle(node, dir);
      }
       else if (!$isRed(node.child[1 - dir])) {
        sibling = parent_0.child[1 - last];
        if (sibling) {
          if (!$isRed(sibling.child[1 - last]) && !$isRed(sibling.child[last])) {
            parent_0.isRed = false;
            sibling.isRed = true;
            node.isRed = true;
          }
           else {
            dir2 = grandparent.child[1] == parent_0?1:0;
            $isRed(sibling.child[last])?(grandparent.child[dir2] = (parent_0.child[1 - last] = $rotateSingle(parent_0.child[1 - last], 1 - last) , $rotateSingle(parent_0, last))):$isRed(sibling.child[1 - last]) && (grandparent.child[dir2] = $rotateSingle(parent_0, last));
            node.isRed = grandparent.child[dir2].isRed = true;
            grandparent.child[dir2].child[0].isRed = false;
            grandparent.child[dir2].child[1].isRed = false;
          }
        }
      }
    }
  }
  if (found) {
    state.found = true;
    state.value_0 = found.value_0;
    if (node != found) {
      newNode = new TreeMap$Node_0(node.key, node.value_0);
      $replaceNode_0(head, found, newNode);
      parent_0 == found && (parent_0 = newNode);
    }
    parent_0.child[parent_0.child[1] == node?1:0] = node.child[!node.child[0]?1:0];
    --this$static.size_0;
  }
  this$static.root = head.child[1];
  !!this$static.root && (this$static.root.isRed = false);
  return state.found;
}

function $replaceNode_0(head, node, newNode){
  var direction, parent_0;
  parent_0 = head;
  direction = head.key == null || $compare_1(node.key, head.key) > 0?1:0;
  while (parent_0.child[direction] != node) {
    parent_0 = parent_0.child[direction];
    direction = $compare_1(node.key, parent_0.key) > 0?1:0;
  }
  parent_0.child[direction] = newNode;
  newNode.isRed = node.isRed;
  newNode.child[0] = node.child[0];
  newNode.child[1] = node.child[1];
  node.child[0] = null;
  node.child[1] = null;
}

function $rotateSingle(tree, rotateDirection){
  var save;
  save = tree.child[1 - rotateDirection];
  tree.child[1 - rotateDirection] = save.child[rotateDirection];
  save.child[rotateDirection] = tree;
  tree.isRed = true;
  save.isRed = false;
  return save;
}

function TreeMap_0(){
  $clinit_536();
  TreeMap_1.call(this, null);
}

function TreeMap_1(c){
  this.root = null;
  !c && (c = DEFAULT_COMPARATOR);
}

function TreeMap(){
}

_ = TreeMap_0.prototype = TreeMap.prototype = new AbstractMap;
_.clear = function clear_17(){
  this.root = null;
  this.size_0 = 0;
}
;
_.containsKey = function containsKey_5(key){
  return !!$getEntry(this, key);
}
;
_.entrySet_0 = function entrySet_5(){
  return new TreeMap$EntrySet_0(this);
}
;
_.get = function get_14(k){
  var entry;
  return entry = $getEntry(this, k) , entry?entry.value_0:null;
}
;
_.getClass$ = function getClass_311(){
  return Ljava_util_TreeMap_2_classLit;
}
;
_.put = function put_4(key, value){
  return $put_3(this, key, value);
}
;
_.remove_3 = function remove_39(keyObj){
  var state;
  return state = new TreeMap$State_0 , $removeWithState(this, keyObj, state) , state.value_0;
}
;
_.size_1 = function size_25(){
  return this.size_0;
}
;
_.castableTypeMap$ = {9:1, 40:1};
_.root = null;
_.size_0 = 0;
var DEFAULT_COMPARATOR;
function $compare_0(a_0, b){
  if (a_0 == null || b == null) {
    throw new NullPointerException_0;
  }
  return a_0.compareTo$(b);
}

function $compare_1(a_0, b){
  return $compare_0(dynamicCast(a_0, 10), dynamicCast(b, 10));
}

function TreeMap$1_0(){
}

function TreeMap$1(){
}

_ = TreeMap$1_0.prototype = TreeMap$1.prototype = new Object_0;
_.compare = function compare_2(a_0, b){
  return $compare_0(dynamicCast(a_0, 10), dynamicCast(b, 10));
}
;
_.getClass$ = function getClass_312(){
  return Ljava_util_TreeMap$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function $inOrderAdd(this$static, list, type, current, fromKey, toKey){
  if (!current) {
    return;
  }
  !!current.child[0] && $inOrderAdd(this$static, list, type, current.child[0], fromKey, toKey);
  $inRange(type, current.key, fromKey, toKey) && list.add_0(current);
  !!current.child[1] && $inOrderAdd(this$static, list, type, current.child[1], fromKey, toKey);
}

function $inRange(type, key, fromKey, toKey){
  if (type.toKeyValid()) {
    if ($compare_0(dynamicCast(key, 10), dynamicCast(toKey, 10)) >= 0) {
      return false;
    }
  }
  if (type.fromKeyValid()) {
    if ($compare_0(dynamicCast(key, 10), dynamicCast(fromKey, 10)) < 0) {
      return false;
    }
  }
  return true;
}

function TreeMap$EntryIterator_0(this$0){
  TreeMap$EntryIterator_1.call(this, this$0, ($clinit_542() , All));
}

function TreeMap$EntryIterator_1(this$0, type){
  var list;
  this.this$0 = this$0;
  list = new ArrayList_0;
  $inOrderAdd(this, list, type, this$0.root, null, null);
  this.iter = new AbstractList$IteratorImpl_0(list);
}

function TreeMap$EntryIterator(){
}

_ = TreeMap$EntryIterator_0.prototype = TreeMap$EntryIterator.prototype = new Object_0;
_.getClass$ = function getClass_313(){
  return Ljava_util_TreeMap$EntryIterator_2_classLit;
}
;
_.hasNext = function hasNext_13(){
  return $hasNext_2(this.iter);
}
;
_.next_0 = function next_21(){
  return this.last = dynamicCast($next_4(this.iter), 11);
}
;
_.remove_1 = function remove_40(){
  $remove_8(this.iter);
  $remove_23(this.this$0, this.last.getKey());
}
;
_.castableTypeMap$ = {};
_.iter = null;
_.last = null;
_.this$0 = null;
function TreeMap$EntrySet_0(this$0){
  this.this$0 = this$0;
}

function TreeMap$EntrySet(){
}

_ = TreeMap$EntrySet_0.prototype = TreeMap$EntrySet.prototype = new AbstractSet;
_.clear = function clear_18(){
  $clear_10(this.this$0);
}
;
_.contains = function contains_17(o){
  var entry, lookupEntry;
  if (!(o != null && o.castableTypeMap$ && !!o.castableTypeMap$[11])) {
    return false;
  }
  entry = dynamicCast(o, 11);
  lookupEntry = $getEntry(this.this$0, entry.getKey());
  return !!lookupEntry && equalsWithNullCheck(lookupEntry.value_0, entry.getValue());
}
;
_.getClass$ = function getClass_314(){
  return Ljava_util_TreeMap$EntrySet_2_classLit;
}
;
_.iterator_0 = function iterator_18(){
  return new TreeMap$EntryIterator_0(this.this$0);
}
;
_.remove_0 = function remove_41(o){
  var entry, state;
  if (!(o != null && o.castableTypeMap$ && !!o.castableTypeMap$[11])) {
    return false;
  }
  entry = dynamicCast(o, 11);
  state = new TreeMap$State_0;
  state.matchValue = true;
  state.value_0 = entry.getValue();
  return $removeWithState(this.this$0, entry.getKey(), state);
}
;
_.size_1 = function size_26(){
  return this.this$0.size_0;
}
;
_.castableTypeMap$ = {168:1, 363:1};
_.this$0 = null;
function TreeMap$Node_0(key, value){
  this.key = key;
  this.value_0 = value;
  this.child = initDim(_3Ljava_util_TreeMap$Node_2_classLit, {9:1, 68:1}, 85, 2, 0);
  this.isRed = true;
}

function TreeMap$Node(){
}

_ = TreeMap$Node_0.prototype = TreeMap$Node.prototype = new Object_0;
_.equals$ = function equals_25(o){
  var other;
  if (!(o != null && o.castableTypeMap$ && !!o.castableTypeMap$[85])) {
    return false;
  }
  other = dynamicCast(o, 85);
  return equalsWithNullCheck(this.key, other.key) && equalsWithNullCheck(this.value_0, other.value_0);
}
;
_.getClass$ = function getClass_315(){
  return Ljava_util_TreeMap$Node_2_classLit;
}
;
_.getKey = function getKey_4(){
  return this.key;
}
;
_.getValue = function getValue_4(){
  return this.value_0;
}
;
_.hashCode$ = function hashCode_25(){
  var keyHash, valueHash;
  keyHash = this.key != null?hashCode__devirtual$(this.key):0;
  valueHash = this.value_0 != null?hashCode__devirtual$(this.value_0):0;
  return keyHash ^ valueHash;
}
;
_.setValue = function setValue_4(value){
  var old;
  old = this.value_0;
  this.value_0 = value;
  return old;
}
;
_.toString$ = function toString_35(){
  return this.key + '=' + this.value_0;
}
;
_.castableTypeMap$ = {11:1, 85:1};
_.child = null;
_.isRed = false;
_.key = null;
_.value_0 = null;
function TreeMap$State_0(){
}

function TreeMap$State(){
}

_ = TreeMap$State_0.prototype = TreeMap$State.prototype = new Object_0;
_.getClass$ = function getClass_316(){
  return Ljava_util_TreeMap$State_2_classLit;
}
;
_.toString$ = function toString_36(){
  return 'State: mv=' + this.matchValue + ' value=' + this.value_0 + ' done=' + this.done + ' found=' + this.found;
}
;
_.castableTypeMap$ = {};
_.done = false;
_.found = false;
_.matchValue = false;
_.value_0 = null;
function $clinit_542(){
  $clinit_542 = nullMethod;
  All = new TreeMap$SubMapType_0('All', 0);
  Head = new TreeMap$SubMapType$1_0;
  Range_0 = new TreeMap$SubMapType$2_0;
  Tail = new TreeMap$SubMapType$3_0;
  $VALUES_10 = initValues(_3Ljava_util_TreeMap$SubMapType_2_classLit, {9:1, 68:1, 170:1}, 86, [All, Head, Range_0, Tail]);
}

function TreeMap$SubMapType_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_17(name_0){
  $clinit_542();
  return valueOf_0(($clinit_546() , $MAP_10), name_0);
}

function values_11(){
  $clinit_542();
  return $VALUES_10;
}

function TreeMap$SubMapType(){
}

_ = TreeMap$SubMapType_0.prototype = TreeMap$SubMapType.prototype = new Enum;
_.fromKeyValid = function fromKeyValid(){
  return false;
}
;
_.getClass$ = function getClass_317(){
  return Ljava_util_TreeMap$SubMapType_2_classLit;
}
;
_.toKeyValid = function toKeyValid(){
  return false;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 86:1};
var $VALUES_10, All, Head, Range_0, Tail;
function TreeMap$SubMapType$1_0(){
  this.name_1 = 'Head';
  this.ordinal = 1;
}

function TreeMap$SubMapType$1(){
}

_ = TreeMap$SubMapType$1_0.prototype = TreeMap$SubMapType$1.prototype = new TreeMap$SubMapType;
_.getClass$ = function getClass_318(){
  return Ljava_util_TreeMap$SubMapType$1_2_classLit;
}
;
_.toKeyValid = function toKeyValid_0(){
  return true;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 86:1};
function TreeMap$SubMapType$2_0(){
  this.name_1 = 'Range';
  this.ordinal = 2;
}

function TreeMap$SubMapType$2(){
}

_ = TreeMap$SubMapType$2_0.prototype = TreeMap$SubMapType$2.prototype = new TreeMap$SubMapType;
_.fromKeyValid = function fromKeyValid_0(){
  return true;
}
;
_.getClass$ = function getClass_319(){
  return Ljava_util_TreeMap$SubMapType$2_2_classLit;
}
;
_.toKeyValid = function toKeyValid_1(){
  return true;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 86:1};
function TreeMap$SubMapType$3_0(){
  this.name_1 = 'Tail';
  this.ordinal = 3;
}

function TreeMap$SubMapType$3(){
}

_ = TreeMap$SubMapType$3_0.prototype = TreeMap$SubMapType$3.prototype = new TreeMap$SubMapType;
_.fromKeyValid = function fromKeyValid_1(){
  return true;
}
;
_.getClass$ = function getClass_320(){
  return Ljava_util_TreeMap$SubMapType$3_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 86:1};
function $clinit_546(){
  $clinit_546 = nullMethod;
  $MAP_10 = createValueOfMap(($clinit_542() , $VALUES_10));
}

var $MAP_10;
function TreeSet_0(){
  this.map = new TreeMap_0;
}

function TreeSet(){
}

_ = TreeSet_0.prototype = TreeSet.prototype = new AbstractSet;
_.add_0 = function add_14(o){
  return $put_3(this.map, o, ($clinit_428() , FALSE_0)) == null;
}
;
_.clear = function clear_19(){
  $clear_10(this.map);
}
;
_.contains = function contains_18(o){
  return !!$getEntry(this.map, o);
}
;
_.getClass$ = function getClass_321(){
  return Ljava_util_TreeSet_2_classLit;
}
;
_.iterator_0 = function iterator_19(){
  var outerIter;
  return outerIter = $keySet_0(this.map).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter);
}
;
_.remove_0 = function remove_42(o){
  return $remove_23(this.map, o) != null;
}
;
_.size_1 = function size_27(){
  return this.map.size_0;
}
;
_.castableTypeMap$ = {9:1, 168:1, 363:1};
_.map = null;
_ = StageOne$DefaultProvider.prototype;
_.getDomAsViewProvider = function getDomAsViewProvider(){
  return !this.views?(this.views = new FullStructure_0(($clinit_1533() , new CssProvider_0))):this.views;
}
;
_.getFocusFrame = function getFocusFrame(){
  return !this.focus_0?(this.focus_0 = $createFocusPresenter(this)):this.focus_0;
}
;
_.getWavePanel = function getWavePanel(){
  return !this.wavePanel?(this.wavePanel = create_36(!this.views?(this.views = new FullStructure_0(($clinit_1533() , new CssProvider_0(null)))):this.views, this.createWaveHolder())):this.wavePanel;
}
;
function $createBlipQueueRenderer(this$static){
  var domAsView, doodads, live, pager, pagingHandler, replyManager, monitor;
  domAsView = this$static.stageOne.getDomAsViewProvider();
  replyManager = new ReplyManager_0(!this$static.modelAsView?(this$static.modelAsView = new ModelAsViewProviderImpl_0(!this$static.viewIdMapper?(this$static.viewIdMapper = new ViewIdMapper_0(new ModelIdMapperImpl_0(!this$static.conversations?(this$static.conversations = create_55(!this$static.wave?(this$static.wave = $createWave(this$static)):this$static.wave, !this$static.idGenerator?(this$static.idGenerator = $createIdGenerator(this$static)):this$static.idGenerator)):this$static.conversations))):this$static.viewIdMapper, this$static.stageOne.getDomAsViewProvider())):this$static.modelAsView);
  doodads = $build($use_6($use_6($installDoodads(this$static, new DocumentRegistries$Builder_0), ($clinit_1402() , new InlineAnchorLiveRenderer$2_0(!this$static.viewIdMapper?(this$static.viewIdMapper = new ViewIdMapper_0(new ModelIdMapperImpl_0(!this$static.conversations?(this$static.conversations = create_55(!this$static.wave?(this$static.wave = $createWave(this$static)):this$static.wave, !this$static.idGenerator?(this$static.idGenerator = $createIdGenerator(this$static)):this$static.idGenerator)):this$static.conversations))):this$static.viewIdMapper, replyManager, domAsView))), install(!this$static.profileManager?(this$static.profileManager = new ProfileManagerImpl_0):this$static.profileManager, !this$static.supplement?(this$static.supplement = $createSupplement(this$static)):this$static.supplement, !this$static.signedInuser?(this$static.signedInuser = ofUnsafe('nobody@example.com')):this$static.signedInuser)));
  live = create_40((!instance_7 && (instance_7 = new BrowserBackedScheduler_0 , setDefaultTimerService() , undefined) , low_0), !this$static.conversations?(this$static.conversations = create_55(!this$static.wave?(this$static.wave = $createWave(this$static)):this$static.wave, !this$static.idGenerator?(this$static.idGenerator = $createIdGenerator(this$static)):this$static.idGenerator)):this$static.conversations, !this$static.modelAsView?(this$static.modelAsView = new ModelAsViewProviderImpl_0(!this$static.viewIdMapper?(this$static.viewIdMapper = new ViewIdMapper_0(new ModelIdMapperImpl_0(!this$static.conversations?(this$static.conversations = create_55(!this$static.wave?(this$static.wave = $createWave(this$static)):this$static.wave, !this$static.idGenerator?(this$static.idGenerator = $createIdGenerator(this$static)):this$static.idGenerator)):this$static.conversations))):this$static.viewIdMapper, this$static.stageOne.getDomAsViewProvider())):this$static.modelAsView, !this$static.blipDetailer?(this$static.blipDetailer = new UndercurrentShallowBlipRenderer_0(!this$static.profileManager?(this$static.profileManager = new ProfileManagerImpl_0):this$static.profileManager, !this$static.supplement?(this$static.supplement = $createSupplement(this$static)):this$static.supplement)):this$static.blipDetailer, replyManager, !this$static.threadReadStateMonitor?(this$static.threadReadStateMonitor = (monitor = new ThreadReadStateMonitorImpl_0(!this$static.supplement?(this$static.supplement = $createSupplement(this$static)):this$static.supplement, !this$static.conversations?(this$static.conversations = create_55(!this$static.wave?(this$static.wave = $createWave(this$static)):this$static.wave, !this$static.idGenerator?(this$static.idGenerator = $createIdGenerator(this$static)):this$static.idGenerator)):this$static.conversations) , $init_4(monitor) , monitor)):this$static.threadReadStateMonitor, !this$static.profileManager?(this$static.profileManager = new ProfileManagerImpl_0):this$static.profileManager, !this$static.supplement?(this$static.supplement = $createSupplement(this$static)):this$static.supplement);
  $init_12(live);
  pager = create_39(!this$static.documentRegistry?(this$static.documentRegistry = $createDocumentRegistry()):this$static.documentRegistry, doodads, domAsView, !this$static.modelAsView?(this$static.modelAsView = new ModelAsViewProviderImpl_0(!this$static.viewIdMapper?(this$static.viewIdMapper = new ViewIdMapper_0(new ModelIdMapperImpl_0(!this$static.conversations?(this$static.conversations = create_55(!this$static.wave?(this$static.wave = $createWave(this$static)):this$static.wave, !this$static.idGenerator?(this$static.idGenerator = $createIdGenerator(this$static)):this$static.idGenerator)):this$static.conversations))):this$static.viewIdMapper, this$static.stageOne.getDomAsViewProvider())):this$static.modelAsView, !this$static.blipDetailer?(this$static.blipDetailer = new UndercurrentShallowBlipRenderer_0(!this$static.profileManager?(this$static.profileManager = new ProfileManagerImpl_0):this$static.profileManager, !this$static.supplement?(this$static.supplement = $createSupplement(this$static)):this$static.supplement)):this$static.blipDetailer, this$static.stageOne.getWavePanel().panel);
  pagingHandler = new PagingHandlerProxy_0(initValues(_3Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_BlipQueueRenderer$PagingHandler_2_classLit, {9:1, 68:1}, 17, [pager, live]));
  return new BlipQueueRenderer_0(pagingHandler, (!instance_7 && (instance_7 = new BrowserBackedScheduler_0 , setDefaultTimerService() , undefined) , high_0));
}

function $createDocumentRegistry(){
  var blipDocFactory, dataDocFactory;
  performValidation = false;
  dataDocFactory = new ObservablePluggableMutableDocument$1_0(new ConversationSchemas_0);
  blipDocFactory = new StageTwo$DefaultProvider$6_0;
  return new WaveDocuments_0(blipDocFactory, dataDocFactory);
}

function $createIdGenerator(this$static){
  var seed, parts;
  seed = this$static.sessionId == null?(this$static.sessionId = 'session'):this$static.sessionId;
  return new IdGeneratorImpl_0((parts = $split((!this$static.signedInuser?(this$static.signedInuser = ofUnsafe('nobody@example.com')):this$static.signedInuser).address, '@', 0) , parts[parts.length - 1]), new StageTwo$DefaultProvider$4_0(seed));
}

function $createSupplement(this$static){
  var live, state, udw;
  udw = $getUserData(!this$static.wave?(this$static.wave = $createWave(this$static)):this$static.wave);
  !udw && (udw = $createUserData(!this$static.wave?(this$static.wave = $createWave(this$static)):this$static.wave));
  state = new WaveletBasedSupplement_0(udw);
  live = new LiveSupplementedWaveImpl_0(state, !this$static.wave?(this$static.wave = $createWave(this$static)):this$static.wave, (!this$static.signedInuser?(this$static.signedInuser = ofUnsafe('nobody@example.com')):this$static.signedInuser , !this$static.conversations?(this$static.conversations = create_55(!this$static.wave?(this$static.wave = $createWave(this$static)):this$static.wave, !this$static.idGenerator?(this$static.idGenerator = $createIdGenerator(this$static)):this$static.idGenerator)):this$static.conversations));
  return create_33(!this$static.wave?(this$static.wave = $createWave(this$static)):this$static.wave, live);
}

function $createWave(this$static){
  var operationalizer, snapshot, wave, waveletData, waveletData$iterator, waveletFactory;
  snapshot = (checkState_0(!!this$static.waveData, 'wave not ready') , this$static.waveData);
  operationalizer = !this$static.wavelets?(this$static.wavelets = create_19((checkState_0(!!this$static.waveData, 'wave not ready') , this$static.waveData.id_0), !this$static.signedInuser?(this$static.signedInuser = ofUnsafe('nobody@example.com')):this$static.signedInuser)):this$static.wavelets;
  waveletFactory = new StageTwo$DefaultProvider$5_0(this$static, operationalizer);
  wave = new WaveViewImpl_0(waveletFactory, (checkState_0(!!this$static.waveData, 'wave not ready') , this$static.waveData.id_0), !this$static.idGenerator?(this$static.idGenerator = $createIdGenerator(this$static)):this$static.idGenerator, !this$static.signedInuser?(this$static.signedInuser = ofUnsafe('nobody@example.com')):this$static.signedInuser, $clinit_2432());
  for (waveletData$iterator = ($clinit_480() , new Collections$UnmodifiableCollection_0($values(snapshot.wavelets))).iterator_0(); waveletData$iterator.hasNext();) {
    waveletData = dynamicCast(waveletData$iterator.next_0(), 172);
    $addWavelet_0(wave, $operationalize(operationalizer, waveletData));
  }
  return wave;
}

function $getDocumentRegistry(this$static){
  return !this$static.documentRegistry?(this$static.documentRegistry = $createDocumentRegistry()):this$static.documentRegistry;
}

function $getProfileManager(this$static){
  return !this$static.profileManager?(this$static.profileManager = new ProfileManagerImpl_0):this$static.profileManager;
}

function $getSessionId(this$static){
  return this$static.sessionId == null?(this$static.sessionId = 'session'):this$static.sessionId;
}

function $installDoodads(this$static, doodads){
  return $use_7(doodads, new StageTwo$DefaultProvider$10_0(this$static));
}

function StageTwo$DefaultProvider$10_0(this$1){
  this.this$1 = this$1;
}

function StageTwo$DefaultProvider$10(){
}

_ = StageTwo$DefaultProvider$10_0.prototype = StageTwo$DefaultProvider$10.prototype = new Object_0;
_.getClass$ = function getClass_327(){
  return Lorg_waveprotocol_wave_client_StageTwo$DefaultProvider$10_2_classLit;
}
;
_.castableTypeMap$ = {318:1};
_.this$1 = null;
function StageTwo$DefaultProvider$4_0(val$seed){
  this.val$seed = val$seed;
}

function StageTwo$DefaultProvider$4(){
}

_ = StageTwo$DefaultProvider$4_0.prototype = StageTwo$DefaultProvider$4.prototype = new Object_0;
_.get_1 = function get_15(){
  return this.val$seed;
}
;
_.getClass$ = function getClass_330(){
  return Lorg_waveprotocol_wave_client_StageTwo$DefaultProvider$4_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$seed = null;
function StageTwo$DefaultProvider$5_0(this$1, val$operationalizer){
  this.this$1 = this$1;
  this.val$operationalizer = val$operationalizer;
}

function StageTwo$DefaultProvider$5(){
}

_ = StageTwo$DefaultProvider$5_0.prototype = StageTwo$DefaultProvider$5.prototype = new Object_0;
_.create_0 = function create_9(waveId, id, creator){
  var data, now;
  return now = fromDouble((new Date).getTime()) , data = new WaveletDataImpl_0(id, creator, now, new HashedVersion_0(P0_longLit, initDim(_3B_classLit, {9:1}, -1, 0, 1)), now, waveId, $getDocumentRegistry(this.this$1)) , $operationalize(this.val$operationalizer, data);
}
;
_.getClass$ = function getClass_331(){
  return Lorg_waveprotocol_wave_client_StageTwo$DefaultProvider$5_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
_.val$operationalizer = null;
function $create_1(this$static, content_0){
  var noDiff;
  return noDiff = (checkNotNull(content_0) , new SimpleDiffDoc_0(content_0)) , create_32(this$static.registries, noDiff);
}

function StageTwo$DefaultProvider$6_0(){
  this.registries = ($clinit_1277() , $clinit_1277() , REGISTRIES);
}

function StageTwo$DefaultProvider$6(){
}

_ = StageTwo$DefaultProvider$6_0.prototype = StageTwo$DefaultProvider$6.prototype = new Object_0;
_.create_1 = function create_10(waveletId, docId, content_0){
  var noDiff;
  return noDiff = (checkNotNull(content_0) , new SimpleDiffDoc_0(content_0)) , create_32(this.registries, noDiff);
}
;
_.getClass$ = function getClass_332(){
  return Lorg_waveprotocol_wave_client_StageTwo$DefaultProvider$6_2_classLit;
}
;
_.castableTypeMap$ = {};
function AbstractProfileManager(){
}

_ = AbstractProfileManager.prototype = new Object_0;
_.addListener = function addListener(listener){
  $add_31(this.listeners, dynamicCast(listener, 178));
}
;
_.getClass$ = function getClass_343(){
  return Lorg_waveprotocol_wave_client_account_impl_AbstractProfileManager_2_classLit;
}
;
_.removeListener = function removeListener(listener){
  $remove_42(this.listeners, dynamicCast(listener, 178));
}
;
_.castableTypeMap$ = {};
function $buildNames(this$static){
  var fragment, fragment$array, fragment$index, fragment$max, nameWithoutDomain, names;
  names = ($clinit_2309() , new ArrayList_0);
  nameWithoutDomain = $split(this$static.id_0.address, '@', 0)[0];
  if (nameWithoutDomain != null && !!nameWithoutDomain.length) {
    for (fragment$array = $split(nameWithoutDomain, '[._]', -1) , fragment$index = 0 , fragment$max = fragment$array.length; fragment$index < fragment$max; ++fragment$index) {
      fragment = fragment$array[fragment$index];
      !fragment.length || $add_9(names, !fragment.length?fragment:String.fromCharCode(toUpperCase(fragment.charCodeAt(0))) + fragment.substr(1, fragment.length - 1));
    }
    this$static.firstName = dynamicCast((checkIndex(0, names.size_0) , names.array[0]), 1);
    this$static.fullName = $join(new Joiner_0, new AbstractList$IteratorImpl_0(names));
  }
   else {
    this$static.fullName = this$static.id_0.address;
  }
}

function $getFirstName(this$static){
  this$static.firstName == null && $buildNames(this$static);
  return this$static.firstName;
}

function $getImageUrl(this$static){
  this$static.imageUrl == null && (this$static.imageUrl = 'static/images/unknown.jpg');
  return this$static.imageUrl;
}

function ProfileImpl_0(id){
  this.id_0 = id;
}

function ProfileImpl(){
}

_ = ProfileImpl_0.prototype = ProfileImpl.prototype = new Object_0;
_.getClass$ = function getClass_344(){
  return Lorg_waveprotocol_wave_client_account_impl_ProfileImpl_2_classLit;
}
;
_.toString$ = function toString_37(){
  return 'ProfileImpl [id=' + this.id_0 + ', firstName=' + this.firstName + ', fullName=' + this.fullName + ', imageUrl=' + this.imageUrl + ']';
}
;
_.castableTypeMap$ = {179:1};
_.firstName = null;
_.fullName = null;
_.id_0 = null;
_.imageUrl = null;
function $getProfile(this$static, participantId){
  var profile;
  profile = dynamicCast(this$static.profiles.get_4(participantId.address), 179);
  if (!profile) {
    profile = new ProfileImpl_0(participantId);
    this$static.profiles.put_3(participantId.address, profile);
  }
  return profile;
}

function ProfileManagerImpl_0(){
  this.profiles = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  this.listeners = ($clinit_2326() , $clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
}

function ProfileManagerImpl(){
}

_ = ProfileManagerImpl_0.prototype = ProfileManagerImpl.prototype = new AbstractProfileManager;
_.getClass$ = function getClass_345(){
  return Lorg_waveprotocol_wave_client_account_impl_ProfileManagerImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
function $doesContain(this$static, target){
  var element, element$iterator;
  for (element$iterator = new AbstractList$IteratorImpl_0(this$static.insideElements); element$iterator.i < element$iterator.this$0_0.size_1();) {
    element = dynamicCastJso($next_4(element$iterator));
    if ($isOrHasChild(element, target)) {
      return true;
    }
  }
  return false;
}

function AutoHider_0(hideable, keyBehavior){
  this.insideElements = new ArrayList_0;
  this.hideable = hideable;
  this.hideOnWindowResize = true;
  this.hideOnHistoryEvent = true;
  this.keyBehavior = keyBehavior;
}

function AutoHider(){
}

_ = AutoHider_0.prototype = AutoHider.prototype = new Object_0;
_.getClass$ = function getClass_346(){
  return Lorg_waveprotocol_wave_client_autohide_AutoHider_2_classLit;
}
;
_.castableTypeMap$ = {180:1};
_.hideOnHistoryEvent = false;
_.hideOnWindowResize = false;
_.hideable = null;
_.keyBehavior = null;
function $clinit_581(){
  $clinit_581 = nullMethod;
  DO_NOT_HIDE_ON_ANY_KEY = new AutoHider$KeyBehavior_0('DO_NOT_HIDE_ON_ANY_KEY', 0);
  HIDE_ON_ESCAPE = new AutoHider$KeyBehavior_0('HIDE_ON_ESCAPE', 1);
  HIDE_ON_ANY_KEY = new AutoHider$KeyBehavior_0('HIDE_ON_ANY_KEY', 2);
  $VALUES_11 = initValues(_3Lorg_waveprotocol_wave_client_autohide_AutoHider$KeyBehavior_2_classLit, {9:1, 68:1, 170:1}, 87, [DO_NOT_HIDE_ON_ANY_KEY, HIDE_ON_ESCAPE, HIDE_ON_ANY_KEY]);
}

function AutoHider$KeyBehavior_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_18(name_0){
  $clinit_581();
  return valueOf_0(($clinit_582() , $MAP_11), name_0);
}

function values_12(){
  $clinit_581();
  return $VALUES_11;
}

function AutoHider$KeyBehavior(){
}

_ = AutoHider$KeyBehavior_0.prototype = AutoHider$KeyBehavior.prototype = new Enum;
_.getClass$ = function getClass_347(){
  return Lorg_waveprotocol_wave_client_autohide_AutoHider$KeyBehavior_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 87:1};
var $VALUES_11, DO_NOT_HIDE_ON_ANY_KEY, HIDE_ON_ANY_KEY, HIDE_ON_ESCAPE;
function $clinit_582(){
  $clinit_582 = nullMethod;
  $MAP_11 = createValueOfMap(($clinit_581() , $VALUES_11));
}

var $MAP_11;
function $clinit_584(){
  $clinit_584 = nullMethod;
  autoHideRegistrar = new EventPreviewAutoHiderRegistrar_0;
}

var autoHideRegistrar;
function $deregisterAutoHider(this$static, autoHider){
  $remove_13(this$static.autoHiders, autoHider);
  if (this$static.autoHiders.size_0 == 0) {
    if (this$static.eventPreviewRegistration) {
      $removeHandler(this$static.eventPreviewRegistration);
      this$static.eventPreviewRegistration = null;
    }
    if (this$static.onResizeRegistration) {
      $removeHandler(this$static.onResizeRegistration);
      this$static.onResizeRegistration = null;
    }
    if (this$static.onHistoryRegistration) {
      $removeHandler(this$static.onHistoryRegistration);
      this$static.onHistoryRegistration = null;
    }
  }
}

function $hideAllAfter(this$static, target){
  var autoHider, autoHider$iterator, i, toHide;
  toHide = new ArrayList_0;
  for (i = this$static.autoHiders.size_0 - 1; i >= 0; --i) {
    autoHider = dynamicCast($get_7(this$static.autoHiders, i), 180);
    if ($doesContain(autoHider, target)) {
      break;
    }
    setCheck(toHide.array, toHide.size_0++, autoHider);
  }
  for (autoHider$iterator = new AbstractList$IteratorImpl_0(toHide); autoHider$iterator.i < autoHider$iterator.this$0_0.size_1();) {
    autoHider = dynamicCast($next_4(autoHider$iterator), 180);
    $hide(autoHider.hideable);
  }
}

function $hideTopmostAutoHiderForKeyEvent(this$static, keyIsEscape){
  var autoHider, i;
  for (i = this$static.autoHiders.size_0 - 1; i >= 0; --i) {
    autoHider = dynamicCast($get_7(this$static.autoHiders, i), 180);
    if (autoHider.keyBehavior == ($clinit_581() , HIDE_ON_ANY_KEY) || keyIsEscape && (autoHider.keyBehavior == HIDE_ON_ESCAPE || autoHider.keyBehavior == HIDE_ON_ANY_KEY)) {
      $hide(autoHider.hideable);
      return true;
    }
  }
  return false;
}

function $onPreviewNativeEvent(this$static, previewEvent){
  var event_0, lowLevelType, signal;
  if (this$static.autoHiders.size_0 == 0) {
    return;
  }
  event_0 = previewEvent.nativeEvent;
  lowLevelType = $eventGetTypeInt(event_0.type);
  signal = ($clinit_669() , create_16(DEFAULT_FACTORY, event_0, false));
  if (!signal) {
    return;
  }
  if (lowLevelType == 131072 || KEY_EVENTS.contains_0(signal.nativeEvent.type)) {
    if ($hideTopmostAutoHiderForKeyEvent(this$static, false)) {
      return;
    }
  }
  if (signal.keySignalType == ($clinit_665() , NOEFFECT) && (event_0.keyCode || 0) == 27) {
    if ($hideTopmostAutoHiderForKeyEvent(this$static, true)) {
      previewEvent.isCanceled = true;
      return;
    }
  }
  (lowLevelType == 4 || lowLevelType == 131072) && $hideAllAfter(this$static, signal.nativeEvent.target);
}

function $onResize(this$static){
  var autoHider, autoHider$iterator, toHide;
  toHide = new ArrayList_0;
  for (autoHider$iterator = new AbstractList$IteratorImpl_0(this$static.autoHiders); autoHider$iterator.i < autoHider$iterator.this$0_0.size_1();) {
    autoHider = dynamicCast($next_4(autoHider$iterator), 180);
    autoHider.hideOnWindowResize && (setCheck(toHide.array, toHide.size_0++, autoHider) , true);
  }
  for (autoHider$iterator = new AbstractList$IteratorImpl_0(toHide); autoHider$iterator.i < autoHider$iterator.this$0_0.size_1();) {
    autoHider = dynamicCast($next_4(autoHider$iterator), 180);
    $hide(autoHider.hideable);
  }
}

function $registerAutoHider(this$static, autoHider){
  $add_9(this$static.autoHiders, autoHider);
  !this$static.eventPreviewRegistration && (this$static.eventPreviewRegistration = addNativePreviewHandler(this$static));
  !this$static.onResizeRegistration && (this$static.onResizeRegistration = (maybeInitializeCloseHandlers() , maybeInitializeResizeHandlers() , addHandler((!TYPE_11 && (TYPE_11 = new GwtEvent$Type_0) , TYPE_11), this$static)));
  !this$static.onHistoryRegistration && (this$static.onHistoryRegistration = ($clinit_286() , impl_0?$addValueChangeHandler(impl_0, this$static):null));
}

function EventPreviewAutoHiderRegistrar_0(){
  this.autoHiders = new ArrayList_0;
}

function EventPreviewAutoHiderRegistrar(){
}

_ = EventPreviewAutoHiderRegistrar_0.prototype = EventPreviewAutoHiderRegistrar.prototype = new Object_0;
_.getClass$ = function getClass_348(){
  return Lorg_waveprotocol_wave_client_autohide_EventPreviewAutoHiderRegistrar_2_classLit;
}
;
_.onValueChange = function onValueChange(event_0){
  var autoHider, autoHider$iterator, toHide;
  toHide = new ArrayList_0;
  for (autoHider$iterator = new AbstractList$IteratorImpl_0(this.autoHiders); autoHider$iterator.i < autoHider$iterator.this$0_0.size_1();) {
    autoHider = dynamicCast($next_4(autoHider$iterator), 180);
    autoHider.hideOnHistoryEvent && (setCheck(toHide.array, toHide.size_0++, autoHider) , true);
  }
  for (autoHider$iterator = new AbstractList$IteratorImpl_0(toHide); autoHider$iterator.i < autoHider$iterator.this$0_0.size_1();) {
    autoHider = dynamicCast($next_4(autoHider$iterator), 180);
    $hide(autoHider.hideable);
  }
}
;
_.castableTypeMap$ = {36:1, 37:1, 38:1, 53:1};
_.eventPreviewRegistration = null;
_.onHistoryRegistration = null;
_.onResizeRegistration = null;
function $clinit_589(){
  var pasteBuffer;
  $clinit_589 = nullMethod;
  LOG = new DomLogger_0('clipboard');
  INSTANCE_2 = new Clipboard_0((pasteBuffer = new PasteBufferImplSafari_0 , pasteBuffer.element = $doc.createElement('div') , pasteBuffer.element.setAttribute('contentEditable', 'true') , pasteBuffer.element.style['white-space'] = 'pre-wrap' , pasteBuffer.element.style['overflow'] = ($clinit_76() , 'hidden') , $positionPasteBuffer(pasteBuffer.element) , $doc.body.appendChild(pasteBuffer.element) , pasteBuffer));
}

function Clipboard_0(pasteBuffer){
  this.pasteBuffer = pasteBuffer;
}

function Clipboard(){
}

_ = Clipboard_0.prototype = Clipboard.prototype = new Object_0;
_.getClass$ = function getClass_350(){
  return Lorg_waveprotocol_wave_client_clipboard_Clipboard_2_classLit;
}
;
_.castableTypeMap$ = {};
_.pasteBuffer = null;
var INSTANCE_2, LOG;
function $positionPasteBuffer(element){
  element.style['position'] = ($clinit_82() , 'absolute');
  element.style['top'] = -100 + ($clinit_88() , 'px');
  element.style['height'] = '50px';
}

function PasteBufferImpl(){
}

_ = PasteBufferImpl.prototype = new Object_0;
_.getClass$ = function getClass_351(){
  return Lorg_waveprotocol_wave_client_clipboard_PasteBufferImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.element = null;
function PasteBufferImplSafari_0(){
}

function PasteBufferImplSafari(){
}

_ = PasteBufferImplSafari_0.prototype = PasteBufferImplSafari.prototype = new PasteBufferImpl;
_.getClass$ = function getClass_352(){
  return Lorg_waveprotocol_wave_client_clipboard_PasteBufferImplSafari_2_classLit;
}
;
_.castableTypeMap$ = {};
_.markersStripped = false;
function extractScheme(uri){
  $clinit_592();
  var colonPos, scheme;
  colonPos = uri.indexOf(fromCodePoint(58));
  if (colonPos < 0) {
    return null;
  }
  scheme = uri.substr(0, colonPos - 0);
  if (scheme.indexOf(fromCodePoint(47)) >= 0 || scheme.indexOf(fromCodePoint(35)) >= 0) {
    return null;
  }
  return scheme;
}

function isSafeUri(uri){
  $clinit_592();
  var scheme;
  scheme = extractScheme(uri);
  return scheme == null || $equalsIgnoreCase('http', scheme) || $equalsIgnoreCase('https', scheme) || $equalsIgnoreCase('mailto', scheme) || $equalsIgnoreCase('ftp', scheme);
}

function sanitizeUri(uri){
  $clinit_592();
  return isSafeUri(uri)?uri:'#';
}

function $append_13(this$static, html){
  $append_11(this$static.sb, html.html);
  return this$static;
}

function $append_14(this$static, num){
  $append_9(this$static.sb, num);
  return this$static;
}

function $formatPastDate(date, now){
  var diff;
  (diff = sub(add_1(fromDouble(now.jsdate.getTime()), Pea60_longLit), fromDouble(date.jsdate.getTime())) , gte_0(diff, P0_longLit)) || undefined;
  return !gte_0(sub(fromDouble(now.jsdate.getTime()), fromDouble(date.jsdate.getTime())), P1499700_longLit) || date.jsdate.getDate() == now.jsdate.getDate() && date.jsdate.getMonth() == now.jsdate.getMonth() && date.jsdate.getFullYear() - 1900 == now.jsdate.getFullYear() - 1900?$format(($clinit_202() , getFormat(($clinit_204() , TIME_SHORT))), date).toLowerCase():!gte_0(sub(fromDouble(now.jsdate.getTime()), fromDouble(date.jsdate.getTime())), P9a7ec800_longLit)?$format((!monthDayFormat && (monthDayFormat = getFormat(($clinit_204() , MONTH_ABBR_DAY))) , monthDayFormat), date) + ' ' + $format(($clinit_202() , getFormat(($clinit_204() , TIME_SHORT))), date).toLowerCase():date.jsdate.getFullYear() - 1900 == now.jsdate.getFullYear() - 1900?$format((!monthDayFormat && (monthDayFormat = getFormat(($clinit_204() , MONTH_ABBR_DAY))) , monthDayFormat), date):$format(($clinit_202() , getFormat(($clinit_204() , DATE_MEDIUM))), date);
}

var monthDayFormat = null;
function emptyElement(element){
  while (element.firstChild) {
    element.removeChild(element.firstChild);
  }
}

function isUnreadable(n){
  var $e0;
  try {
    n.nodeType;
    return false;
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 21)) {
      return true;
    }
     else 
      throw $e0;
  }
}

function moveNodes(parent_0, from, toExcl){
  var m_0, n;
  for (n = from; n != toExcl;) {
    m_0 = n;
    n = n.nextSibling;
    parent_0.insertBefore(m_0, null);
  }
}

function nodeOffsetToNodeletPoint(node, offset){
  var container;
  if (node.nodeType == 3) {
    return new Point$Tx_0(node, offset);
  }
   else {
    container = node;
    return new Point$El_0(container, offset >= container.childNodes.length?null:container.childNodes[offset]);
  }
}

function registerEventHandler(el, eventName, capture, listener){
  var func = $entry(function(e){
    var evt = e || $wnd.event;
    listener.onJavaScriptEvent(eventName, evt);
  }
  );
  el.addEventListener?el.addEventListener(eventName, func, capture):el.attachEvent?el.attachEvent('on' + eventName, func):(el['on' + eventName.toLowerCase()] = func);
  func.$ev = eventName;
  func.$cp = capture;
  func.$el = el;
  return func;
}

function replaceElement(oldElement, newElement){
  if ($getParentElement(oldElement)) {
    $getParentElement(oldElement).insertBefore(newElement, oldElement);
    $removeFromParent(oldElement);
  }
  moveNodes(newElement, oldElement.firstChild, null);
}

function setContentEditable(element, isEditable, whiteSpacePreWrap){
  element.style['-webkit-user-modify'] = isEditable?'read-write-plaintext-only':'read-only';
  whiteSpacePreWrap && (element.style['white-space'] = 'pre-wrap' , undefined);
  return element;
}

function $unregister(this$static){
  var el = this$static.$el;
  if (el == null) {
    return false;
  }
  el.removeEventListener?el.removeEventListener(this$static.$ev, this$static, this$static.$cp):el.detachEvent?el.detachEvent('on' + this$static.$ev, this$static):(el['on' + this$static.$ev] = null);
  this$static.$ev = null;
  return true;
}

_ = FastQueue.prototype;
_.clear = function clear_20(){
  this.currentPutIndex = 0;
  this.currentGetIndex = 0;
  this.numEntry = 0;
  $clear_11(this.contents);
}
;
_.remove_5 = function remove_43(){
  if (this.numEntry == 0) {
    throw new NoSuchElementException_0;
  }
  return $poll_0(this);
}
;
function $clear_11(this$static){
  for (var key in this$static) {
    delete this$static[key];
  }
}

function $someValue(this$static){
  for (var k in this$static) {
    return this$static[k];
  }
  return null;
}

_ = JsIdentityMap.prototype;
_.clear = function clear_21(){
  $clear_11(this.keys);
  $clear_11(this.values);
}
;
_.remove_6 = function remove_45(key){
  var id, prefixer, prefixer_0;
  id = key.x$h || (key.x$h = ++sNextHashId);
  prefixer = prefixer_2;
  delete this.keys[prefixer(id)];
  prefixer_0 = prefixer_2;
  delete this.values[prefixer_0(id)];
}
;
function $eachInner_0(elements, proc){
  for (var k in elements) {
    proc.apply_7(elements[k]);
  }
}

function JsIdentitySet_0(){
  this.elements = ($clinit_612() , {});
}

function JsIdentitySet(){
}

_ = JsIdentitySet_0.prototype = JsIdentitySet.prototype = new Object_0;
_.add_2 = function add_15(key){
  $put_4(this.elements, key.x$h || (key.x$h = ++sNextHashId), key);
}
;
_.clear = function clear_22(){
  $clear_11(this.elements);
}
;
_.contains = function contains_19(key){
  var prefixer;
  return prefixer = prefixer_2 , this.elements[prefixer(key.x$h || (key.x$h = ++sNextHashId))] !== undefined;
}
;
_.each_0 = function each_0(proc){
  $eachInner_0(this.elements, proc);
}
;
_.getClass$ = function getClass_363(){
  return Lorg_waveprotocol_wave_client_common_util_JsIdentitySet_2_classLit;
}
;
_.isEmpty = function isEmpty_9(){
  return $isEmpty_8(this.elements);
}
;
_.remove_6 = function remove_46(key){
  var prefixer;
  prefixer = prefixer_2;
  delete this.elements[prefixer(key.x$h || (key.x$h = ++sNextHashId))];
}
;
_.someElement = function someElement(){
  return $someValue(this.elements);
}
;
_.toString$ = function toString_41(){
  return $toSource(this.elements);
}
;
_.castableTypeMap$ = {324:1};
_ = JsoCollectionFactory.prototype;
_.createIdentitySet = function createIdentitySet(){
  return new JsIdentitySet_0;
}
;
_ = JsoIntMap.prototype;
_.each_1 = function each_1(callback){
  $each(this.backend, new JsoIntMap$1_0(callback));
}
;
function JsoIntMap$1_0(val$callback){
  this.val$callback = val$callback;
}

function JsoIntMap$1(){
}

_ = JsoIntMap$1_0.prototype = JsoIntMap$1.prototype = new Object_0;
_.apply_0 = function apply_0(key, item){
  $apply_2(this.val$callback, key, item);
}
;
_.getClass$ = function getClass_366(){
  return Lorg_waveprotocol_wave_client_common_util_JsoIntMap$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$callback = null;
_ = JsoStringMap.prototype;
_.clear = function clear_23(){
  $clear_12(this.backend);
}
;
_.countEntries = function countEntries(){
  return $countEntries(this.backend);
}
;
_.filter_0 = function filter_0(filter){
  $each_2(this.backend, new JsoStringMap$2_0(this, filter));
}
;
_.get_3 = function get_19(key, defaultValue){
  key = (checkNotNull_1(key, 'StringMap/StringSet cannot contain null keys') , key.indexOf('__') == 0?'_' + key:key);
  return this.backend[key] !== undefined?this.backend[key]:defaultValue;
}
;
_.getExisting = function getExisting(key){
  key = (checkNotNull_1(key, 'StringMap/StringSet cannot contain null keys') , key.indexOf('__') == 0?'_' + key:key);
  if (!(this.backend[key] !== undefined)) {
    throw new IllegalStateException_1("getExisting: Key '" + key + "' is not in map");
  }
  return this.backend[key];
}
;
_.isEmpty = function isEmpty_10(){
  return $isEmpty_9(this.backend);
}
;
_.keySet_1 = function keySet_3(){
  return new JsoStringSet_0(this.backend);
}
;
_.putAll_0 = function putAll_1(pairsToAdd){
  $putAll_0(this.backend, dynamicCast(pairsToAdd, 184).backend);
}
;
function JsoStringMap$2_0(this$0, val$filter){
  this.this$0 = this$0;
  this.val$filter = val$filter;
}

function JsoStringMap$2(){
}

_ = JsoStringMap$2_0.prototype = JsoStringMap$2.prototype = new Object_0;
_.apply_1 = function apply_6(key, item){
  if ($apply_30(this.val$filter, key.indexOf('__') == 0?key.substr(1, key.length - 1):key, item))
  ;
  else {
    delete this.this$0.backend[key];
  }
}
;
_.getClass$ = function getClass_371(){
  return Lorg_waveprotocol_wave_client_common_util_JsoStringMap$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$filter = null;
function $remove_25(this$static, s){
  delete this$static.backend[checkNotNull_1(s, 'StringMap/StringSet cannot contain null keys') , s.indexOf('__') == 0?'_' + s:s];
}

_ = JsoStringSet.prototype;
_.addAll_0 = function addAll_6(set){
  set.each_3(new JsoStringSet$4_0(this));
}
;
_.clear = function clear_24(){
  $clear_12(this.backend);
}
;
_.countEntries = function countEntries_0(){
  return $countEntries(this.backend);
}
;
_.each_3 = function each_3(callback){
  $each_2(this.backend, new JsoStringSet$1_0(callback));
}
;
_.filter_1 = function filter_1(filter){
  $each_2(this.backend, new JsoStringSet$2_0(this, filter));
}
;
_.isEmpty = function isEmpty_11(){
  return $isEmpty_9(this.backend);
}
;
_.isSubsetOf = function isSubsetOf(other){
  var $e0, e;
  try {
    $each_2(this.backend, new JsoStringSet$1_0(new JsoStringSet$6_0(other)));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 21)) {
      e = $e0;
      if (e != FALSE_1) {
        throw e;
      }
      return false;
    }
     else 
      throw $e0;
  }
  return true;
}
;
_.remove_8 = function remove_49(s){
  delete this.backend[checkNotNull_1(s, 'StringMap/StringSet cannot contain null keys') , s.indexOf('__') == 0?'_' + s:s];
}
;
_.removeAll_0 = function removeAll_1(set){
  set.each_3(new JsoStringSet$5_0(this));
}
;
_.someElement_0 = function someElement_0(){
  return $firstKey(this.backend);
}
;
function JsoStringSet$2_0(this$0, val$filter){
  this.this$0 = this$0;
  this.val$filter = val$filter;
}

function JsoStringSet$2(){
}

_ = JsoStringSet$2_0.prototype = JsoStringSet$2.prototype = new Object_0;
_.apply_1 = function apply_9(key, item){
  if ($apply_31(this.val$filter, key.indexOf('__') == 0?key.substr(1, key.length - 1):key))
  ;
  else {
    delete this.this$0.backend[key];
  }
}
;
_.getClass$ = function getClass_375(){
  return Lorg_waveprotocol_wave_client_common_util_JsoStringSet$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$filter = null;
function JsoStringSet$4_0(this$0){
  this.this$0 = this$0;
}

function JsoStringSet$4(){
}

_ = JsoStringSet$4_0.prototype = JsoStringSet$4.prototype = new Object_0;
_.apply_4 = function apply_10(element){
  $add_18(this.this$0, element);
}
;
_.getClass$ = function getClass_376(){
  return Lorg_waveprotocol_wave_client_common_util_JsoStringSet$4_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function JsoStringSet$5_0(this$0){
  this.this$0 = this$0;
}

function JsoStringSet$5(){
}

_ = JsoStringSet$5_0.prototype = JsoStringSet$5.prototype = new Object_0;
_.apply_4 = function apply_11(element){
  $remove_25(this.this$0, element);
}
;
_.getClass$ = function getClass_377(){
  return Lorg_waveprotocol_wave_client_common_util_JsoStringSet$5_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function JsoStringSet$6_0(val$other){
  this.val$other = val$other;
}

function JsoStringSet$6(){
}

_ = JsoStringSet$6_0.prototype = JsoStringSet$6.prototype = new Object_0;
_.apply_4 = function apply_12(element){
  if (!this.val$other.contains_0(element)) {
    throw $clinit_624() , FALSE_1;
  }
}
;
_.getClass$ = function getClass_378(){
  return Lorg_waveprotocol_wave_client_common_util_JsoStringSet$6_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$other = null;
function $clear_12(this$static){
  for (var key in this$static) {
    delete this$static[key];
  }
}

function $countEntries(this$static){
  var n = 0;
  for (var k in this$static) {
    n++;
  }
  return n;
}

function $firstKey(this$static){
  for (var k in this$static) {
    return k;
  }
  return null;
}

function $isEmpty_9(this$static){
  for (var k in this$static) {
    return false;
  }
  return true;
}

function $putAll_0(this$static, source){
  for (var k in source) {
    this$static[k] = source[k];
  }
}

function $clear_13(this$static){
  while ($getUsable(this$static, this$static.first)) {
    $remove_27(this$static, this$static.first.key);
  }
}

function $emptyPut(this$static, key, value){
  var node;
  node = new LinkedPruningSequenceMap$Node_0(this$static, key, value);
  this$static.first = this$static.last = this$static.recent = node;
  this$static.recent.next = this$static.recent;
  this$static.recent.prev = this$static.recent;
  ++this$static.size_0;
}

function $findBefore(this$static, key){
  var cmpNext, cmpPrev, next, search;
  if (!key) {
    throw new IllegalArgumentException_1('key is null');
  }
  search = $getUsable(this$static, this$static.recent);
  if (!search) {
    return null;
  }
  while (true) {
    cmpPrev = $compare_2(search.key, key);
    if (cmpPrev <= 0) {
      if (this$static.last == search || cmpPrev == 0) {
        return search;
      }
      next = $getNext(search);
      cmpNext = $compare_2(next.key, key);
      if (cmpNext > 0) {
        return search;
      }
      search = $getNext(search);
    }
     else {
      if (this$static.first == search) {
        return null;
      }
      search = $getPrev(search);
    }
  }
}

function $getElement(this$static, key){
  var prev;
  prev = $findBefore(this$static, key);
  if (!prev) {
    return this$static.first;
  }
  return $compare_2(prev.key, key) == 0?prev:null;
}

function $getFirst(this$static){
  return $getUsable(this$static, this$static.first);
}

function $getUsable(this$static, node){
  if (!!node && !$isContentAttached(node.key.el)) {
    if (node == this$static.last) {
      node = $getNext(node);
      !!node && (node = $getPrev(node));
    }
     else {
      node = $getPrev(node);
      !!node && (node = $getNext(node));
    }
  }
  return node;
}

function $put_5(this$static, key, value){
  var node, old, prev, next;
  old = null;
  if (this$static.size_0 == 0) {
    $emptyPut(this$static, key, value);
  }
   else {
    prev = $findBefore(this$static, key);
    if (this$static.size_0 == 0) {
      $emptyPut(this$static, key, value);
    }
     else {
      if (!prev || $compare_2(key, prev.key) != 0) {
        node = new LinkedPruningSequenceMap$Node_0(this$static, key, value);
        prev == this$static.last && (this$static.last = node);
        if (!prev) {
          prev = this$static.last;
          this$static.first = node;
        }
        next = $getNext(prev);
        node.prev = prev;
        node.next = next;
        prev.next = node;
        next.prev = node;
        ++this$static.size_0;
      }
       else {
        old = prev.value_0;
        prev.value_0 = value;
      }
    }
  }
  return old;
}

function $remove_27(this$static, key){
  var node, val;
  val = null;
  if (!$isContentAttached(key.el)) {
    return null;
  }
  node = $findBefore(this$static, key);
  if (!!node && $compare_2(key, node.key) == 0) {
    val = node.value_0;
    $remove_28(this$static, node);
  }
  return val;
}

function $remove_28(this$static, node){
  var next, prev;
  prev = node.prev;
  next = node.next;
  prev.next = next;
  next.prev = prev;
  node.next = node.prev = null;
  this$static.recent == node && (this$static.recent = prev);
  if (this$static.first == node && this$static.last == node) {
    this$static.first = null;
    this$static.last = null;
    this$static.recent = null;
  }
   else {
    this$static.first == node && (this$static.first = next);
    this$static.last == node && (this$static.last = prev);
  }
  --this$static.size_0;
}

function LinkedPruningSequenceMap_0(cmp){
}

function LinkedPruningSequenceMap(){
}

_ = LinkedPruningSequenceMap_0.prototype = LinkedPruningSequenceMap.prototype = new Object_0;
_.getClass$ = function getClass_382(){
  return Lorg_waveprotocol_wave_client_common_util_LinkedPruningSequenceMap_2_classLit;
}
;
_.castableTypeMap$ = {};
_.first = null;
_.last = null;
_.recent = null;
_.size_0 = 0;
function $compare_2(o1, o2){
  return dynamicCast(o1, 185).compareTo$(dynamicCast(o2, 185));
}

function LinkedPruningSequenceMap$1_0(){
}

function LinkedPruningSequenceMap$1(){
}

_ = LinkedPruningSequenceMap$1_0.prototype = LinkedPruningSequenceMap$1.prototype = new Object_0;
_.compare = function compare_3(o1, o2){
  return dynamicCast(o1, 185).compareTo$(dynamicCast(o2, 185));
}
;
_.getClass$ = function getClass_383(){
  return Lorg_waveprotocol_wave_client_common_util_LinkedPruningSequenceMap$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function $getNext(this$static){
  while (!!this$static.next && !$isContentAttached(this$static.next.key.el)) {
    $remove_28(this$static.this$0, this$static.next);
  }
  return this$static.next;
}

function $getPrev(this$static){
  while (!!this$static.prev && !$isContentAttached(this$static.prev.key.el)) {
    $remove_28(this$static.this$0, this$static.prev);
  }
  return this$static.prev;
}

function LinkedPruningSequenceMap$Node_0(this$0, key, value){
  this.this$0 = this$0;
  this.key = key;
  this.value_0 = value;
}

function LinkedPruningSequenceMap$Node(){
}

_ = LinkedPruningSequenceMap$Node_0.prototype = LinkedPruningSequenceMap$Node.prototype = new Object_0;
_.getClass$ = function getClass_384(){
  return Lorg_waveprotocol_wave_client_common_util_LinkedPruningSequenceMap$Node_2_classLit;
}
;
_.castableTypeMap$ = {};
_.key = null;
_.next = null;
_.prev = null;
_.this$0 = null;
_.value_0 = null;
function $clear_14(this$static){
  this$static.data_0 = ',';
  this$static.recentIndex = 0;
}

function $insertBefore_0(this$static, ref, x){
  var codedRef, refIndex;
  checkArgument_0(x != null, 'null item');
  if (ref == null) {
    this$static.data_0 += x.replace(/&/g, '&&').replace(/,/g, '&c') + ',';
  }
   else {
    codedRef = concat(ref.replace(/&/g, '&&').replace(/,/g, '&c'));
    refIndex = $find(this$static, codedRef, false);
    this$static.data_0 = concat_0(this$static.data_0.substr(0, refIndex - 0), x.replace(/&/g, '&&').replace(/,/g, '&c'), $substring(this$static.data_0, refIndex));
  }
}

function $remove_30(this$static, x){
  var coded, index;
  checkArgument_0(x != null, 'null item');
  coded = concat(x.replace(/&/g, '&&').replace(/,/g, '&c'));
  index = $find(this$static, coded, false);
  this$static.data_0 = this$static.data_0.substr(0, index - 0) + $substring(this$static.data_0, index + coded.length - 1);
}

function concat_0(s1, s3, s4){
  var s;
  s = new StringBuilder_0;
  s.impl.string += s1;
  s.impl.string += ',';
  s.impl.string += s3;
  s.impl.string += s4;
  return s.impl.string;
}

function LiveTarget_0(executor, output){
  this.executor = executor;
  this.output = output;
}

function LiveTarget(){
}

_ = LiveTarget_0.prototype = LiveTarget.prototype = new Object_0;
_.getClass$ = function getClass_411(){
  return Lorg_waveprotocol_wave_client_concurrencycontrol_LiveTarget_2_classLit;
}
;
_.castableTypeMap$ = {};
_.executor = null;
_.output = null;
function LiveTarget$1_0(val$data){
  this.val$data = val$data;
}

function LiveTarget$1(){
}

_ = LiveTarget$1_0.prototype = LiveTarget$1.prototype = new Object_0;
_.consume = function consume(operation){
  var $e0, e;
  try {
    operation.apply_7(this.val$data);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 189)) {
      e = $e0;
      throw new OperationRuntimeException_0('Error applying op', e);
    }
     else 
      throw $e0;
  }
}
;
_.getClass$ = function getClass_412(){
  return Lorg_waveprotocol_wave_client_concurrencycontrol_LiveTarget$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$data = null;
function ProxyOperationSink_0(){
}

function ProxyOperationSink(){
}

_ = ProxyOperationSink_0.prototype = ProxyOperationSink.prototype = new Object_0;
_.consume = function consume_0(op){
  !this.queue && (this.queue = ($clinit_2309() , defaultCollectionFactory.createQueue()));
  this.queue.add_0(op);
}
;
_.getClass$ = function getClass_413(){
  return Lorg_waveprotocol_wave_client_concurrencycontrol_ProxyOperationSink_2_classLit;
}
;
_.castableTypeMap$ = {};
_.queue = null;
function $operationalize(this$static, data){
  var target, executor, output;
  target = putAndReturn(this$static.wavelets, $serialiseWaveletId(data.id_0), (output = new ProxyOperationSink_0 , executor = new LiveTarget$1_0(data) , new LiveTarget_0(executor, output)));
  return new OpBasedWavelet_0(this$static.waveId, data, this$static.opContextFactory, ($clinit_2392() , DEFAULT_2), target.executor, target.output);
}

function WaveletOperationalizer_0(waveId, opContextFactory){
  this.wavelets = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  this.waveId = waveId;
  this.opContextFactory = opContextFactory;
}

function create_19(wave, user){
  var opContexts;
  opContexts = new BasicWaveletOperationContextFactory_0(user);
  return new WaveletOperationalizer_0(wave, opContexts);
}

function putAndReturn(map, key, value){
  checkState(!map.containsKey_1(key));
  map.put_3(key, value);
  return value;
}

function WaveletOperationalizer(){
}

_ = WaveletOperationalizer_0.prototype = WaveletOperationalizer.prototype = new Object_0;
_.getClass$ = function getClass_414(){
  return Lorg_waveprotocol_wave_client_concurrencycontrol_WaveletOperationalizer_2_classLit;
}
;
_.castableTypeMap$ = {};
_.opContextFactory = null;
_.waveId = null;
function AbstractLogger(){
}

_ = AbstractLogger.prototype = new Object_0;
_.getClass$ = function getClass_415(){
  return Lorg_waveprotocol_wave_common_logging_AbstractLogger_2_classLit;
}
;
_.handleClientErrors = function handleClientErrors(level, t, messages){
  return;
}
;
_.logPlainTextInner = function logPlainTextInner(level, msg){
  this.sink.lazyLog(level, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ["<pre style='display:inline'>", $replaceAll($replaceAll($replaceAll($replaceAll($replaceAll(msg, '&', '&amp;'), '<', '&lt;'), '>', '&gt;'), '"', '&quot;'), "'", '&#39;'), '<\/pre>']));
}
;
_.castableTypeMap$ = {};
_.errorLogger = null;
_.fatalLogger = null;
_.sink = null;
_.traceLogger = null;
function $clinit_691(){
  var cookiesMap;
  $clinit_691 = nullMethod;
  var cookie, cookies, i;
  nativeSetupWebDriverTestPins('webdriverGetFatalError');
  modules = new TreeSet_0;
  enabledModulesBuffer = new HashSet_0;
  logbuffer = new InMemoryLogSink_0;
  enabledModules = new HashSet_0;
  listeners_0 = new ArrayList_0;
  $clinit_1659();
  $clinit_103();
  $push_1(toInject, ($clinit_211() , '.C-NF-org-waveprotocol-wave-client-debug-logger-DomLogger-Resources-Css-panel {\n  text-align : left;\n  overflow : auto;\n  width : 100%;\n  height : 100%;\n}\n.C-IF-org-waveprotocol-wave-client-debug-logger-DomLogger-Resources-Css-entry {\n  border-bottom : 1px dotted silver;\n  font-family : monospace;\n}\n.C-LF-org-waveprotocol-wave-client-debug-logger-DomLogger-Resources-Css-module {\n  font-weight : bold;\n}\n.C-JF-org-waveprotocol-wave-client-debug-logger-DomLogger-Resources-Css-error {\n  color : red;\n}\n.C-KF-org-waveprotocol-wave-client-debug-logger-DomLogger-Resources-Css-fatal {\n  color : red;\n  font-weight : bold;\n}\n'));
  schedule();
  cookie = (cookiesMap = ensureCookies() , dynamicCast(cookiesMap.get('wdm'), 1));
  if (cookie != null) {
    cookies = $split(cookie, '\\|', 0);
    for (i = 1; i < cookies.length; ++i) {
      $add_13(enabledModules, cookies[i]);
    }
  }
  outputCache = new ArrayList_0;
  TIMESTAMP_FORMAT = ($clinit_214() , new NumberFormat_1(['USD', '$', 2, 'US$']));
}

function $setupNativeLogging(module){
  if (typeof window[module + 'Log'] == 'undefined') {
    window[module + 'Log'] = function(msg){
      nativeLog(module, msg);
    }
    ;
    window[module + 'LogXml'] = function(xml){
      nativeLogXml(module, xml);
    }
    ;
    window[module + 'LogJava'] = function(label, javaObject){
      nativeLog_0(module, label, javaObject);
    }
    ;
    window[module + 'LogObject'] = function(object){
      var msg = '';
      for (a in object) {
        msg += a + ': ' + object[a] + '<br/>';
      }
      nativeLog(module, msg);
    }
    ;
  }
}

function $triggerOnNewLogger(){
  var l$iterator;
  for (l$iterator = new AbstractList$IteratorImpl_0(listeners_0); l$iterator.i < l$iterator.this$0_0.size_1();) {
    throwClassCastExceptionUnlessNull($next_4(l$iterator));
    null.nullMethod();
  }
}

function DomLogger_0(module){
  $clinit_691();
  DomLogger_1.call(this, module, new DomLogger$GWTLogSink_0(module));
}

function DomLogger_1(module, logSink){
  this.sink = logSink;
  this.errorLogger = new AbstractLogger$LevelLogger_0(this, ($clinit_1659() , ERROR));
  this.fatalLogger = new AbstractLogger$LevelLogger_0(this, FATAL);
  this.traceLogger = new AbstractLogger$LevelLogger_0(this, TRACE);
  if (!$getEntry(modules.map, module)) {
    $put_3(modules.map, module, ($clinit_428() , FALSE_0)) == null;
    $triggerOnNewLogger();
  }
  this.module = module;
  $setupNativeLogging(module);
}

function appendEntry(formatted, level){
  $clinit_691();
  var entry;
  entry = $doc.createElement('div');
  entry.className = 'C-IF-org-waveprotocol-wave-client-debug-logger-DomLogger-Resources-Css-entry';
  entry.innerHTML = formatted || '';
  switch (level.ordinal) {
    case 1:
      $addClassName(entry, 'C-JF-org-waveprotocol-wave-client-debug-logger-DomLogger-Resources-Css-error');
      break;
    case 0:
      $addClassName(entry, 'C-KF-org-waveprotocol-wave-client-debug-logger-DomLogger-Resources-Css-fatal');
      break;
    case 2:
      $addClassName(entry, 'C-PF-org-waveprotocol-wave-client-debug-logger-DomLogger-Resources-Css-trace');
  }
  level == ($clinit_1659() , FATAL) && (latestFatalError = formatted);
  $add_9(outputCache, entry);
}

function formatLogEntry(module, msg){
  $clinit_691();
  return "<span class='C-LF-org-waveprotocol-wave-client-debug-logger-DomLogger-Resources-Css-module'>" + module + "<\/span> <span class='C-OF-org-waveprotocol-wave-client-debug-logger-DomLogger-Resources-Css-time'>(" + timeStamp_0() + "):<\/span> <span class='C-MF-org-waveprotocol-wave-client-debug-logger-DomLogger-Resources-Css-msg'>" + msg + '<\/span>';
}

function nativeLog(module, msg){
  $log_0((new DomLogger_0(module)).traceLogger, msg);
}

function nativeLog_0(module, label, javaObject){
  $log_2((new DomLogger_0(module)).traceLogger, label, javaObject);
}

function nativeLogXml(module, xml){
  $logXml((new DomLogger_0(module)).traceLogger, xml);
}

function nativeSetupWebDriverTestPins(hookName){
  $wnd[hookName] = function(){
    return latestFatalError;
  }
  ;
}

function notifyLoggerListenersIfErrorOrFatal(level){
  $clinit_691();
  var l$iterator;
  if (level == ($clinit_1659() , ERROR)) {
    for (l$iterator = new AbstractList$IteratorImpl_0(listeners_0); l$iterator.i < l$iterator.this$0_0.size_1();) {
      throwClassCastExceptionUnlessNull($next_4(l$iterator));
      null.nullMethod();
    }
  }
   else if (level == FATAL) {
    for (l$iterator = new AbstractList$IteratorImpl_0(listeners_0); l$iterator.i < l$iterator.this$0_0.size_1();) {
      throwClassCastExceptionUnlessNull($next_4(l$iterator));
      null.nullMethod();
    }
  }
}

function shouldLogToBuffer_0(module, level){
  $clinit_691();
  return enabledModulesBuffer.map.containsKey(module) || level.value_0 <= ($clinit_1659() , ERROR).value_0;
}

function shouldLogToPanel_0(level){
  $clinit_691();
  if (level.value_0 == ($clinit_1659() , FATAL).value_0) {
    return true;
  }
  return false;
}

function showOutput(){
  $clinit_691();
  var l$iterator;
  for (l$iterator = new AbstractList$IteratorImpl_0(listeners_0); l$iterator.i < l$iterator.this$0_0.size_1();) {
    throwClassCastExceptionUnlessNull($next_4(l$iterator));
    null.nullMethod();
  }
}

function timeStamp_0(){
  $clinit_691();
  var ts;
  ts = (new Date).getTime() / 1000;
  return TIMESTAMP_FORMAT?$format_1(TIMESTAMP_FORMAT, ts):'' + ts;
}

function DomLogger(){
}

_ = DomLogger_0.prototype = DomLogger.prototype = new AbstractLogger;
_.getClass$ = function getClass_416(){
  return Lorg_waveprotocol_wave_client_debug_logger_DomLogger_2_classLit;
}
;
_.handleClientErrors = function handleClientErrors_0(level, t, messages){
}
;
_.logPlainTextInner = function logPlainTextInner_0(level, msg){
  this.sink.lazyLog(level, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ["<pre style='display:inline'>", $replaceAll($replaceAll($replaceAll($replaceAll($replaceAll(msg, '&', '&amp;'), '<', '&lt;'), '>', '&gt;'), '"', '&quot;'), "'", '&#39;'), '<\/pre>']));
}
;
_.shouldLog = function shouldLog(level){
  return false;
}
;
_.castableTypeMap$ = {};
_.module = null;
var TIMESTAMP_FORMAT, enabledModules, enabledModulesBuffer, latestFatalError = '', listeners_0, logbuffer, modules, outputCache;
function BufferedLogger_0(){
  $clinit_691();
  DomLogger_1.call(this, 'selection', new BufferedLogger$BufferedLogSink_0(new DomLogger$GWTLogSink_0('selection')));
}

function BufferedLogger(){
}

_ = BufferedLogger_0.prototype = BufferedLogger.prototype = new DomLogger;
_.getClass$ = function getClass_417(){
  return Lorg_waveprotocol_wave_client_debug_logger_BufferedLogger_2_classLit;
}
;
_.castableTypeMap$ = {};
function LogSink(){
}

_ = LogSink.prototype = new Object_0;
_.getClass$ = function getClass_418(){
  return Lorg_waveprotocol_wave_common_logging_LogSink_2_classLit;
}
;
_.castableTypeMap$ = {351:1};
function BufferedLogger$BufferedLogSink_0(outputSink){
  this.buffer = new ArrayList_0;
  this.flush = new BufferedLogger$BufferedLogSink$1_0(this);
  this.outputSink = outputSink;
}

function BufferedLogger$BufferedLogSink(){
}

_ = BufferedLogger$BufferedLogSink_0.prototype = BufferedLogger$BufferedLogSink.prototype = new LogSink;
_.getClass$ = function getClass_419(){
  return Lorg_waveprotocol_wave_client_debug_logger_BufferedLogger$BufferedLogSink_2_classLit;
}
;
_.lazyLog = function lazyLog(level, messages){
  var doFlush;
  doFlush = this.buffer.size_0 == 0;
  $add_9(this.buffer, new BufferedLogger$BufferedLogSink$LogMessage_0(messages, level));
  doFlush && addCommand(this.flush);
}
;
_.castableTypeMap$ = {351:1};
_.outputSink = null;
function BufferedLogger$BufferedLogSink$1_0(this$1){
  this.this$1 = this$1;
}

function BufferedLogger$BufferedLogSink$1(){
}

_ = BufferedLogger$BufferedLogSink$1_0.prototype = BufferedLogger$BufferedLogSink$1.prototype = new Object_0;
_.execute_0 = function execute_14(){
  var m_0, m$iterator;
  for (m$iterator = new AbstractList$IteratorImpl_0(this.this$1.buffer); m$iterator.i < m$iterator.this$0_0.size_1();) {
    m_0 = dynamicCast($next_4(m$iterator), 190);
    $logToSink(m_0, this.this$1.outputSink);
  }
  $clear_4(this.this$1.buffer);
}
;
_.getClass$ = function getClass_420(){
  return Lorg_waveprotocol_wave_client_debug_logger_BufferedLogger$BufferedLogSink$1_2_classLit;
}
;
_.castableTypeMap$ = {42:1, 52:1};
_.this$1 = null;
function $logToSink(this$static, logSink){
  $lazyLog_0(logSink, this$static.level, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [stringifyLogObject(this$static.message_0)]));
}

function BufferedLogger$BufferedLogSink$LogMessage_0(message, level){
  this.message_0 = message;
  this.level = level;
}

function BufferedLogger$BufferedLogSink$LogMessage(){
}

_ = BufferedLogger$BufferedLogSink$LogMessage_0.prototype = BufferedLogger$BufferedLogSink$LogMessage.prototype = new Object_0;
_.getClass$ = function getClass_421(){
  return Lorg_waveprotocol_wave_client_debug_logger_BufferedLogger$BufferedLogSink$LogMessage_2_classLit;
}
;
_.castableTypeMap$ = {190:1};
_.level = null;
_.message_0 = null;
function $lazyLog_0(this$static, level, messages){
  var formatted, shouldLogToBuffer, shouldLogToPanel;
  shouldLogToBuffer = shouldLogToBuffer_0(this$static.module, level);
  shouldLogToPanel = shouldLogToPanel_0(level);
  shouldLogToBuffer && $lazyLog_1(($clinit_691() , logbuffer), level, messages);
  if (shouldLogToPanel) {
    formatted = formatLogEntry(this$static.module, stringifyLogObject(messages), timeStamp_0());
    $clinit_691();
    showOutput();
    appendEntry(formatted, level);
  }
  notifyLoggerListenersIfErrorOrFatal(level);
}

function DomLogger$GWTLogSink_0(module){
  this.module = module;
}

function DomLogger$GWTLogSink(){
}

_ = DomLogger$GWTLogSink_0.prototype = DomLogger$GWTLogSink.prototype = new LogSink;
_.getClass$ = function getClass_422(){
  return Lorg_waveprotocol_wave_client_debug_logger_DomLogger$GWTLogSink_2_classLit;
}
;
_.lazyLog = function lazyLog_0(level, messages){
  $lazyLog_0(this, level, messages);
}
;
_.castableTypeMap$ = {351:1};
_.module = null;
function $clinit_700(){
  var map;
  $clinit_700 = nullMethod;
  PREFIX = ($clinit_858() , DIFF_KEY);
  PAINT_KEYS = newStringSet(initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, [DIFF_INSERT_KEY]));
  BOUNDARY_KEYS = newStringSet(initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, [DIFF_DELETE_KEY]));
  PAINT_PROPERTIES = ($clinit_480() , map = new HashMap_1(1) , map.put('backgroundColor', 'yellow') , new Collections$UnmodifiableMap_0(map));
  paintFunc = new DiffAnnotationHandler$1_0;
  boundaryFunc = new DiffAnnotationHandler$2_0;
}

function DiffAnnotationHandler_0(painter){
  this.painter = painter;
}

function register(annotationRegistry, painterRegistry){
  $clinit_700();
  $registerPaintFunction(painterRegistry, PAINT_KEYS, paintFunc);
  $registerBoundaryFunction(painterRegistry, BOUNDARY_KEYS, boundaryFunc);
  $registerHandler(annotationRegistry, PREFIX, new DiffAnnotationHandler_0(painterRegistry.painter));
}

function DiffAnnotationHandler(){
}

_ = DiffAnnotationHandler_0.prototype = DiffAnnotationHandler.prototype = new Object_0;
_.getClass$ = function getClass_423(){
  return Lorg_waveprotocol_wave_client_doodad_diff_DiffAnnotationHandler_2_classLit;
}
;
_.handleAnnotationChange = function handleAnnotationChange(bundle, start, end, key, newValue){
  $scheduleRepaint(this.painter, bundle, start, end);
}
;
_.castableTypeMap$ = {429:1};
_.painter = null;
var BOUNDARY_KEYS, PAINT_KEYS, PAINT_PROPERTIES, PREFIX, boundaryFunc, paintFunc;
function DiffAnnotationHandler$1_0(){
}

function DiffAnnotationHandler$1(){
}

_ = DiffAnnotationHandler$1_0.prototype = DiffAnnotationHandler$1.prototype = new Object_0;
_.apply_5 = function apply_15(from, isEditing){
  return from.get(($clinit_858() , DIFF_INSERT_KEY)) != null?($clinit_700() , PAINT_PROPERTIES):($clinit_480() , $clinit_480() , EMPTY_MAP);
}
;
_.getClass$ = function getClass_424(){
  return Lorg_waveprotocol_wave_client_doodad_diff_DiffAnnotationHandler$1_2_classLit;
}
;
_.castableTypeMap$ = {221:1};
function DiffAnnotationHandler$2_0(){
}

function DiffAnnotationHandler$2(){
}

_ = DiffAnnotationHandler$2_0.prototype = DiffAnnotationHandler$2.prototype = new Object_0;
_.apply_6 = function apply_16(localDoc, parent_0, nodeAfter, before, after, isEditing){
  var elt, obj;
  obj = after.get(($clinit_858() , DIFF_DELETE_KEY));
  if (obj != null) {
    elt = $transparentCreate_0(localDoc, 'l:diffdel', ($clinit_480() , $clinit_480() , EMPTY_MAP), parent_0, nodeAfter);
    $setInnards((!instance_4 && (instance_4 = new DiffDeleteRenderer_0) , elt), dynamicCast(obj, 191).htmlElements);
    return elt;
  }
   else {
    return null;
  }
}
;
_.getClass$ = function getClass_425(){
  return Lorg_waveprotocol_wave_client_doodad_diff_DiffAnnotationHandler$2_2_classLit;
}
;
_.castableTypeMap$ = {222:1};
function $setInnards(element, deletedStuff){
  var e, e$iterator, nodelet;
  nodelet = element.containerNodelet;
  for (e$iterator = new AbstractList$IteratorImpl_0(deletedStuff); e$iterator.i < e$iterator.this$0_0.size_1();) {
    e = dynamicCastJso($next_4(e$iterator));
    nodelet.appendChild(e);
  }
}

function DiffDeleteRenderer_0(){
}

function DiffDeleteRenderer(){
}

_ = DiffDeleteRenderer_0.prototype = DiffDeleteRenderer.prototype = new Object_0;
_.createDomImpl = function createDomImpl(element){
  var nodelet;
  nodelet = $doc.createElement('span');
  nodelet.style['-webkit-user-modify'] = 'read-only';
  nodelet.style['white-space'] = 'pre-wrap';
  return $setContainerNodelet(element, nodelet) , nodelet;
}
;
_.getClass$ = function getClass_426(){
  return Lorg_waveprotocol_wave_client_doodad_diff_DiffDeleteRenderer_2_classLit;
}
;
_.castableTypeMap$ = {212:1};
var instance_4 = null;
function $clinit_705(){
  $clinit_705 = nullMethod;
  WEB_SCHEMES = newStringSet(initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['http', 'https', 'ftp', 'mailto']));
  LINK_KEYS = initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['link', 'link/auto', 'link/manual', 'link/wave']);
}

function inferWaveRef(rawString){
  var $e0, $e1, e;
  try {
    return $clinit_2443() , $decodeWaveRefFromPath(rawString);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 193)) {
      e = $e0;
      try {
        return of_11($deserialiseWaveId(rawString));
      }
       catch ($e1) {
        $e1 = caught_0($e1);
        if (instanceOf($e1, 194)) {
          throw e;
        }
         else 
          throw $e1;
      }
    }
     else 
      throw $e0;
  }
}

function normalizeLink(rawLinkValue){
  var matchObj;
  $clinit_705();
  var $e0, e, parts, ref, scheme;
  checkNotNull(rawLinkValue);
  rawLinkValue = $trim(rawLinkValue);
  parts = splitUri(rawLinkValue);
  scheme = parts != null?parts[0]:null;
  if ((matchObj = (new RegExp("(\\?[\\w\\-:@!\\$&'\\(\\)\\*\\+,;=\\/\\?\\.]+|)($|#([\\w\\-:@!\\$&'\\(\\)\\*\\+,;=\\/\\?\\.]+|$))")).exec(rawLinkValue) , matchObj == null?false:rawLinkValue == matchObj[0]) || scheme != null && WEB_SCHEMES.contains_0(scheme)) {
    return rawLinkValue;
  }
  try {
    if ($equals_3('wave', scheme)) {
      ref = ($clinit_2443() , $decodeWaveRefFromPath(parts[1]));
    }
     else if (scheme == null) {
      ref = inferWaveRef(rawLinkValue);
    }
     else if ($equals_3('waveid', scheme)) {
      ref = inferWaveRef(parts[1]);
    }
     else {
      throw new Link$InvalidLinkException_1('Unsupported URL scheme: ' + scheme);
    }
    return 'wave://' + ($clinit_2443() , $encode_0(ref, ($clinit_2441() , PATH)));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 193)) {
      e = $e0;
      throw new Link$InvalidLinkException_0(e);
    }
     else 
      throw $e0;
  }
}

function splitUri(uri){
  var scheme;
  scheme = extractScheme(uri);
  if (scheme == null || uri.length <= scheme.length + 3) {
    return null;
  }
  return initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, [scheme, $substring(uri, scheme.length + 3)]);
}

function toHrefFromUri(uri){
  $clinit_705();
  var $e0, ref;
  try {
    uri = normalizeLink(uri);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 192)) {
      return null;
    }
     else 
      throw $e0;
  }
  if (uri.indexOf('wave://') == 0) {
    try {
      ref = ($clinit_2443() , $decodeWaveRefFromPath(uri.substr(7, uri.length - 7)));
      return '#' + $encode_0(ref, ($clinit_2441() , PATH));
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 193)) {
        return null;
      }
       else 
        throw $e0;
    }
  }
  return uri;
}

var LINK_KEYS, WEB_SCHEMES;
function Link$InvalidLinkException_0(cause){
  this.fillInStackTrace();
  this.cause = cause;
  this.detailMessage = 'Invalid link. Should either be a web url\nor, a Wave ref in the form: wave://example.com/w+1234/~/conv+root/b+abcd\nor be a valid serialized wave id';
}

function Link$InvalidLinkException_1(message){
  this.fillInStackTrace();
  this.detailMessage = message;
}

function Link$InvalidLinkException(){
}

_ = Link$InvalidLinkException_1.prototype = Link$InvalidLinkException_0.prototype = Link$InvalidLinkException.prototype = new Exception;
_.getClass$ = function getClass_427(){
  return Lorg_waveprotocol_wave_client_doodad_link_Link$InvalidLinkException_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 39:1, 183:1, 192:1};
function $clinit_707(){
  $clinit_707 = nullMethod;
  KEYS = newStringSet(($clinit_705() , LINK_KEYS));
  BOUNDARY_KEYS_0 = KEYS;
  boundaryFunc_0 = new LinkAnnotationHandler$1_0;
}

function LinkAnnotationHandler_0(painter){
  this.painter = painter;
}

function register_0(registries){
  $clinit_707();
  var annotationRegistry, handler, painterRegistry;
  painterRegistry = registries.paintRegistry;
  handler = new LinkAnnotationHandler_0(painterRegistry.painter);
  annotationRegistry = registries.annotationHandlerRegistry;
  validatePrefix('link');
  dynamicCast($modify_0(annotationRegistry.data_0), 195).handlers.put_3('link', handler);
  $registerBehaviour(annotationRegistry, 'link', new LinkAnnotationHandler$2_0(($clinit_1778() , CONTENT_0)));
  $registerBehaviour(annotationRegistry, 'link/manual', new LinkAnnotationHandler$2_0(CONTENT_0));
  $registerBehaviour(annotationRegistry, 'link/wave', new LinkAnnotationHandler$2_0(CONTENT_0));
  $registerPaintFunction(painterRegistry, KEYS, new LinkAnnotationHandler$RenderFunc_0);
  $registerBoundaryFunction(painterRegistry, BOUNDARY_KEYS_0, boundaryFunc_0);
}

function LinkAnnotationHandler(){
}

_ = LinkAnnotationHandler_0.prototype = LinkAnnotationHandler.prototype = new Object_0;
_.getClass$ = function getClass_428(){
  return Lorg_waveprotocol_wave_client_doodad_link_LinkAnnotationHandler_2_classLit;
}
;
_.handleAnnotationChange = function handleAnnotationChange_0(bundle, start, end, key, newValue){
  $scheduleRepaint(this.painter, bundle, start, end);
}
;
_.castableTypeMap$ = {429:1};
_.painter = null;
var BOUNDARY_KEYS_0, KEYS, boundaryFunc_0;
function LinkAnnotationHandler$1_0(){
}

function LinkAnnotationHandler$1(){
}

_ = LinkAnnotationHandler$1_0.prototype = LinkAnnotationHandler$1.prototype = new Object_0;
_.apply_6 = function apply_17(localDoc, parent_0, nodeAfter, before, after, isEditing){
  var attributes, e, suggestion;
  if (!isEditing) {
    return null;
  }
  attributes = maybeCreateSuggestions();
  if (!attributes || attributes.entrySet.this$0.attributes.size_1() == 0) {
    return null;
  }
  e = $transparentCreate(localDoc, 'l:suggestion', attributes, dynamicCast(parent_0, 196), dynamicCast(nodeAfter, 197));
  if (!e) {
    return null;
  }
  suggestion = throwClassCastExceptionUnlessNull(e.transientData.get_0(($clinit_726() , HAS_SUGGESTIONS_PROP).id_0));
  $registerElement(e.context.this$0.editingConcerns.getSuggestionsManager(), suggestion);
  return e;
}
;
_.getClass$ = function getClass_429(){
  return Lorg_waveprotocol_wave_client_doodad_link_LinkAnnotationHandler$1_2_classLit;
}
;
_.castableTypeMap$ = {222:1};
function AnnotationBehaviour$DefaultAnnotationBehaviour_0(family){
  this.family = family;
}

function AnnotationBehaviour$DefaultAnnotationBehaviour(){
}

_ = AnnotationBehaviour$DefaultAnnotationBehaviour_0.prototype = AnnotationBehaviour$DefaultAnnotationBehaviour.prototype = new Object_0;
_.getClass$ = function getClass_430(){
  return Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$DefaultAnnotationBehaviour_2_classLit;
}
;
_.replace_0 = function replace_1(inside, outside, type){
  return type == ($clinit_1782() , RICH_TEXT)?($clinit_1786() , NEITHER_0):($clinit_1786() , INSIDE);
}
;
_.castableTypeMap$ = {430:1};
_.family = null;
function LinkAnnotationHandler$2_0($anonymous0){
  this.family = $anonymous0;
}

function LinkAnnotationHandler$2(){
}

_ = LinkAnnotationHandler$2_0.prototype = LinkAnnotationHandler$2.prototype = new AnnotationBehaviour$DefaultAnnotationBehaviour;
_.getClass$ = function getClass_431(){
  return Lorg_waveprotocol_wave_client_doodad_link_LinkAnnotationHandler$2_2_classLit;
}
;
_.castableTypeMap$ = {430:1};
function LinkAnnotationHandler$RenderFunc_0(){
}

function LinkAnnotationHandler$RenderFunc(){
}

_ = LinkAnnotationHandler$RenderFunc_0.prototype = LinkAnnotationHandler$RenderFunc.prototype = new Object_0;
_.apply_5 = function apply_19(from, isEditing){
  var content_0, ret, ret_0, map;
  content_0 = ($clinit_707() , ret_0 = null , from.containsKey('link')?(ret_0 = toHrefFromUri(dynamicCast(from.get('link'), 1))):from.containsKey('link/manual')?(ret_0 = toHrefFromUri(dynamicCast(from.get('link/manual'), 1))):from.containsKey('link/wave')?(ret_0 = toHrefFromUri(dynamicCast(from.get('link/wave'), 1))):from.containsKey('link/auto') && (ret_0 = toHrefFromUri(dynamicCast(from.get('link/auto'), 1))) , ret_0 != null?ret_0:null);
  content_0 != null?(ret = ($clinit_480() , map = new HashMap_1(1) , map.put('link', content_0) , new Collections$UnmodifiableMap_0(map))):(ret = ($clinit_480() , $clinit_480() , EMPTY_MAP));
  return ret;
}
;
_.getClass$ = function getClass_433(){
  return Lorg_waveprotocol_wave_client_doodad_link_LinkAnnotationHandler$RenderFunc_2_classLit;
}
;
_.castableTypeMap$ = {221:1};
function $clinit_713(){
  $clinit_713 = nullMethod;
  instance_5 = new CaretMarkerRenderer_0;
}

function $setMarker(element, marker){
  var impl;
  impl = element.implNodelet;
  !!impl && impl.appendChild(marker.caretMarkerElement);
}

function CaretMarkerRenderer_0(){
}

function CaretMarkerRenderer(){
}

_ = CaretMarkerRenderer_0.prototype = CaretMarkerRenderer.prototype = new Object_0;
_.createDomImpl = function createDomImpl_0(element){
  var renderSpan;
  renderSpan = $doc.createElement('span');
  $clinit_1033();
  renderSpan[TRANSPARENCY] = ($clinit_2121() , DEEP);
  return renderSpan;
}
;
_.getClass$ = function getClass_434(){
  return Lorg_waveprotocol_wave_client_doodad_selection_CaretMarkerRenderer_2_classLit;
}
;
_.castableTypeMap$ = {212:1};
var instance_5;
function $clinit_715(){
  $clinit_715 = nullMethod;
  $clinit_103();
  $push_1(toInject, ($clinit_211() , '.C-NG-org-waveprotocol-wave-client-doodad-selection-CaretMarkerResources-Css-compositionState {\n  opacity : 0.4;\n  filter : "alpha(opacity = 40)";\n  border-bottom : 2px solid;\n}\n.C-PG-org-waveprotocol-wave-client-doodad-selection-CaretMarkerResources-Css-outer {\n  color : white;\n  position : relative;\n  padding-left : 3px;\n  padding-right : 3px;\n}\n.C-OG-org-waveprotocol-wave-client-doodad-selection-CaretMarkerResources-Css-inner {\n  border : 1px solid;\n  position : absolute;\n  top : -1px;\n  bottom : -1px;\n  left : 1px;\n  right : 1px;\n}\n'));
  schedule();
}

function CaretWidget_0(){
  $clinit_715();
  this.caretMarkerElement = $doc.createElement('span');
  this.compositionStateSpan = $doc.createElement('span');
  this.caretMarkerElement.appendChild(this.compositionStateSpan);
  this.compositionStateSpan.className = 'C-NG-org-waveprotocol-wave-client-doodad-selection-CaretMarkerResources-Css-compositionState';
  this.outerSpan = $doc.createElement('span');
  this.innerSpan = $doc.createElement('span');
  this.caretMarkerElement.appendChild(this.outerSpan);
  this.nameTextNode = $doc.createTextNode('?');
  this.outerSpan.appendChild(this.nameTextNode);
  this.outerSpan.appendChild(this.innerSpan);
  this.outerSpan.className = 'C-PG-org-waveprotocol-wave-client-doodad-selection-CaretMarkerResources-Css-outer';
  this.innerSpan.className = 'C-OG-org-waveprotocol-wave-client-doodad-selection-CaretMarkerResources-Css-inner';
  $clinit_1033();
  this.caretMarkerElement[TRANSPARENCY] = ($clinit_2121() , DEEP);
}

function CaretWidget(){
}

_ = CaretWidget_0.prototype = CaretWidget.prototype = new Object_0;
_.getClass$ = function getClass_435(){
  return Lorg_waveprotocol_wave_client_doodad_selection_CaretWidget_2_classLit;
}
;
_.castableTypeMap$ = {};
_.caretMarkerElement = null;
_.compositionStateSpan = null;
_.innerSpan = null;
_.nameTextNode = null;
_.outerSpan = null;
function $clinit_716(){
  $clinit_716 = nullMethod;
  BLACK = new RgbColor_0(0, 0, 0);
  WHITE = new RgbColor_0(255, 255, 255);
}

function RgbColor_0(red, green, blue){
  $clinit_716();
  this.red = red;
  this.green = green;
  this.blue = blue;
}

function RgbColor(){
}

_ = RgbColor_0.prototype = RgbColor.prototype = new Object_0;
_.equals$ = function equals_26(o){
  var color;
  if (this === o) {
    return true;
  }
   else if (o != null && o.castableTypeMap$ && !!o.castableTypeMap$[95]) {
    color = dynamicCast(o, 95);
    return this.red == color.red && this.green == color.green && this.blue == color.blue;
  }
   else {
    return false;
  }
}
;
_.getClass$ = function getClass_436(){
  return Lorg_waveprotocol_wave_client_doodad_selection_RgbColor_2_classLit;
}
;
_.hashCode$ = function hashCode_26(){
  return this.red << 16 | this.green << 8 | this.blue;
}
;
_.castableTypeMap$ = {95:1};
_.blue = 0;
_.green = 0;
_.red = 0;
var BLACK, WHITE;
function $clinit_717(){
  $clinit_717 = nullMethod;
  COLOURS = initValues(_3Lorg_waveprotocol_wave_client_doodad_selection_RgbColor_2_classLit, {9:1, 68:1}, 95, [new RgbColor_0(252, 146, 41), new RgbColor_0(81, 209, 63), new RgbColor_0(183, 68, 209), new RgbColor_0(59, 201, 209), new RgbColor_0(209, 59, 69), new RgbColor_0(70, 95, 230), new RgbColor_0(244, 27, 219), new RgbColor_0(183, 172, 74), new RgbColor_0(114, 50, 38)]);
}

function $activate(this$static, data, expiry, doc){
  var $e0, profile;
  data.expiry = expiry;
  data.originallyScheduledExpiry = expiry;
  if (!data.bundle) {
    try {
      profile = $getProfile(this$static.profileManager, of_10(data.address));
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 199)) {
        profile = null;
      }
       else 
        throw $e0;
    }
    !!profile && $replaceName(data, profile);
    $add_8(this$static.expiries, data);
  }
  data.bundle = doc;
  this$static.scheduler.scheduler.taskInfos.get(this$static.expiryTask) != null || $scheduleRepeating_2(this$static.scheduler, this$static.expiryTask, 5000, 5000);
}

function $expire(this$static, data){
  var bundle, document_0, hotSpot, rangeEnd, rangeStart, size;
  bundle = data.bundle;
  document_0 = bundle.this$0.mutableContent;
  data.bundle = null;
  $unregisterBoundaryFunction(this$static.painterRegistry, newStringSet(initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['user/e/' + data.sessionId])));
  $unregisterPaintFunction(this$static.painterRegistry, newStringSet(initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['user/r/' + data.sessionId])));
  size = $size_15(document_0.doc);
  rangeStart = $firstAnnotationChange_2(document_0.doc, 0, size, 'user/r/' + data.sessionId, null);
  rangeEnd = $lastAnnotationChange_2(document_0.doc, 0, size, 'user/r/' + data.sessionId, null);
  hotSpot = $firstAnnotationChange_2(document_0.doc, 0, size, 'user/e/' + data.sessionId, null);
  rangeStart == -1 && (rangeStart = rangeEnd = hotSpot);
  hotSpot >= 0 && maybeScheduleRepaint(bundle, rangeStart, rangeEnd);
}

function $getActiveSessionData(this$static, sessionId){
  var data;
  data = dynamicCast(this$static.sessions.get_4(sessionId), 198);
  return !!data && (new Date).getTime() <= data.expiry?data:null;
}

function $getSessionColour(this$static, sessionId){
  if (!this$static.sessions.containsKey_1(sessionId)) {
    return this$static.grey;
  }
  return dynamicCast(this$static.sessions.get_4(sessionId), 198).color;
}

function $getUsersHighlight(this$static, sessions){
  var colours, id, id$index, id$max, lighter, sessionIDs;
  if (!this$static.highlightCache.containsKey_1(sessions)) {
    sessionIDs = $split(sessions, ',', 0);
    colours = new ArrayList_0;
    for (id$index = 0 , id$max = sessionIDs.length; id$index < id$max; ++id$index) {
      id = sessionIDs[id$index];
      $equals_3('', id) || $add_9(colours, $getSessionColour(this$static, id));
    }
    lighter = average(new Arrays$ArrayList_0(initValues(_3Lorg_waveprotocol_wave_client_doodad_selection_RgbColor_2_classLit, {9:1, 68:1}, 95, [average(colours), ($clinit_716() , WHITE)])));
    this$static.highlightCache.put_3(sessions, 'rgb(' + lighter.red + ',' + lighter.green + ',' + lighter.blue + ')');
  }
  return dynamicCast(this$static.highlightCache.get_4(sessions), 1);
}

function $updateCaretData(this$static, sessionId, value, doc){
  var $e0, address, components, data, expiry, timeStamp, colour;
  components = $split(value, ',', 0);
  if (components.length < 2) {
    return;
  }
  try {
    timeStamp = __parseAndValidateDouble(components[1]);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 188)) {
      return;
    }
     else 
      throw $e0;
  }
  address = components[0];
  data = dynamicCast(this$static.sessions.get_4(sessionId), 198);
  !data && (data = new SelectionAnnotationHandler$SessionData_0(this$static, new CaretWidget_0, address, sessionId, (colour = COLOURS[this$static.currentColourIndex] , this$static.currentColourIndex = (this$static.currentColourIndex + 1) % COLOURS.length , colour)));
  expiry = min_0(timeStamp, (new Date).getTime()) + 15000;
  $activate(this$static, data, expiry, doc);
  data.ui.compositionStateSpan.textContent = (components.length >= 3?components[2]:'') || '';
}

function SelectionAnnotationHandler_0(registry, ignoreSessionId, profileManager, timer){
  this.grey = new RgbColor_0(128, 128, 128);
  this.highlightCache = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  this.spreadFunc = new SelectionAnnotationHandler$1_0(this);
  this.boundaryFunc = new SelectionAnnotationHandler$2_0(this);
  this.expiryTask = new SelectionAnnotationHandler$3_0(this);
  this.sessions = defaultCollectionFactory.createStringMap();
  this.expiries = new PriorityQueue_2(10, new SelectionAnnotationHandler$4_0);
  this.painterRegistry = registry;
  this.ignoreSessionId = ignoreSessionId;
  this.profileManager = profileManager;
  this.scheduler = timer;
}

function average(colors){
  var blue, color, color$iterator, green, red, size;
  size = colors.size_1();
  red = 0;
  green = 0;
  blue = 0;
  for (color$iterator = colors.iterator_0(); color$iterator.hasNext();) {
    color = dynamicCast(color$iterator.next_0(), 95);
    red += color.red;
    green += color.green;
    blue += color.blue;
  }
  return size == 0?($clinit_716() , BLACK):new RgbColor_0(~~(red / size), ~~(green / size), ~~(blue / size));
}

function register_1(registries, sessionId, profiles){
  $clinit_717();
  var carets;
  carets = ($clinit_713() , $clinit_713() , instance_5);
  $registerRenderer(registries.elementHandlerRegistry, 'l:uname', carets);
  register_2(registries, (!instance_7 && (instance_7 = new BrowserBackedScheduler_0 , setDefaultTimerService() , undefined) , low_0), sessionId, profiles);
}

function register_2(registries, timer, sessionId, profiles){
  var selection;
  checkNotNull_0(sessionId, 'Session Id to ignore must not be null');
  selection = new SelectionAnnotationHandler_0(registries.paintRegistry, sessionId, profiles, timer);
  $registerHandler(registries.annotationHandlerRegistry, 'user', selection);
  $add_31(profiles.listeners, selection);
  return selection;
}

function SelectionAnnotationHandler(){
}

_ = SelectionAnnotationHandler_0.prototype = SelectionAnnotationHandler.prototype = new Object_0;
_.getClass$ = function getClass_437(){
  return Lorg_waveprotocol_wave_client_doodad_selection_SelectionAnnotationHandler_2_classLit;
}
;
_.handleAnnotationChange = function handleAnnotationChange_1(bundle, start, end, key, newValue){
  if ($endsWith(key, '/' + this.ignoreSessionId)) {
    return;
  }
  if (key.indexOf('user/d/') == 0 && newValue != null) {
    $updateCaretData(this, key.substr(7, key.length - 7), dynamicCast(newValue, 1), bundle);
  }
   else if (key.indexOf('user/r/') == 0) {
    $registerPaintFunction(this.painterRegistry, newStringSet(initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, [key])), this.spreadFunc);
    $scheduleRepaint(this.painterRegistry.painter, bundle, start, end);
  }
   else {
    $registerBoundaryFunction(this.painterRegistry, newStringSet(initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, [key])), this.boundaryFunc);
    $scheduleRepaint(this.painterRegistry.painter, bundle, start, start + 1);
    end == $size_15(bundle.this$0.mutableContent.doc) && --end;
    $scheduleRepaint(this.painterRegistry.painter, bundle, end, end + 1);
  }
}
;
_.castableTypeMap$ = {178:1, 429:1};
_.currentColourIndex = 0;
_.ignoreSessionId = null;
_.painterRegistry = null;
_.profileManager = null;
_.scheduler = null;
var COLOURS;
function SelectionAnnotationHandler$1_0(this$0){
  this.this$0 = this$0;
}

function SelectionAnnotationHandler$1(){
}

_ = SelectionAnnotationHandler$1_0.prototype = SelectionAnnotationHandler$1.prototype = new Object_0;
_.apply_5 = function apply_20(from, isEditing){
  var address, entry, entry$iterator, sessionId, sessions;
  sessions = '';
  for (entry$iterator = from.entrySet_0().iterator_0(); entry$iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.next_0(), 11);
    if (dynamicCast(entry.getKey(), 1).indexOf('user/r/') == 0) {
      sessionId = ($clinit_717() , $substring(dynamicCast(entry.getKey(), 1), 7));
      address = dynamicCast(entry.getValue(), 1);
      if (address == null || !$getActiveSessionData(this.this$0, sessionId)) {
        continue;
      }
      sessions += sessionId + ',';
    }
  }
  return $equals_3(sessions, '')?($clinit_480() , $clinit_480() , EMPTY_MAP):singletonMap('backgroundColor', $getUsersHighlight(this.this$0, sessions));
}
;
_.getClass$ = function getClass_438(){
  return Lorg_waveprotocol_wave_client_doodad_selection_SelectionAnnotationHandler$1_2_classLit;
}
;
_.castableTypeMap$ = {221:1};
_.this$0 = null;
function SelectionAnnotationHandler$2_0(this$0){
  this.this$0 = this$0;
}

function SelectionAnnotationHandler$2(){
}

_ = SelectionAnnotationHandler$2_0.prototype = SelectionAnnotationHandler$2.prototype = new Object_0;
_.apply_6 = function apply_21(localDoc, parent_0, nodeAfter, before, after, isEditing){
  var address, data, entry, entry$iterator, ret, sessionId, usersContainer;
  ret = null;
  usersContainer = null;
  for (entry$iterator = after.entrySet_0().iterator_0(); entry$iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.next_0(), 11);
    if (dynamicCast(entry.getKey(), 1).indexOf('user/e/') == 0) {
      address = dynamicCast(entry.getValue(), 1);
      if (address == null) {
        continue;
      }
      sessionId = ($clinit_717() , $substring(dynamicCast(entry.getKey(), 1), 7));
      data = $getActiveSessionData(this.this$0, sessionId);
      if (!data) {
        continue;
      }
      if (!usersContainer) {
        ret = $transparentCreate_0(localDoc, 'l:uname', ($clinit_480() , $clinit_480() , EMPTY_MAP), parent_0, nodeAfter);
        usersContainer = ret;
      }
      $setMarker(usersContainer, data.ui);
    }
  }
  return ret;
}
;
_.getClass$ = function getClass_439(){
  return Lorg_waveprotocol_wave_client_doodad_selection_SelectionAnnotationHandler$2_2_classLit;
}
;
_.castableTypeMap$ = {222:1};
_.this$0 = null;
function SelectionAnnotationHandler$3_0(this$0){
  this.this$0 = this$0;
}

function SelectionAnnotationHandler$3(){
}

_ = SelectionAnnotationHandler$3_0.prototype = SelectionAnnotationHandler$3.prototype = new Object_0;
_.execute = function execute_15(){
  var data;
  while (this.this$0.expiries.heap.size_0 != 0) {
    data = dynamicCast($element(this.this$0.expiries), 198);
    if (data.originallyScheduledExpiry > (new Date).getTime()) {
      return true;
    }
    $remove_11(this.this$0.expiries);
    if (data.expiry > (new Date).getTime()) {
      data.originallyScheduledExpiry = data.expiry;
      $add_8(this.this$0.expiries, data);
    }
     else {
      $expire(this.this$0, data);
    }
  }
  return false;
}
;
_.getClass$ = function getClass_440(){
  return Lorg_waveprotocol_wave_client_doodad_selection_SelectionAnnotationHandler$3_2_classLit;
}
;
_.castableTypeMap$ = {251:1, 253:1};
_.this$0 = null;
function SelectionAnnotationHandler$4_0(){
}

function SelectionAnnotationHandler$4(){
}

_ = SelectionAnnotationHandler$4_0.prototype = SelectionAnnotationHandler$4.prototype = new Object_0;
_.compare = function compare_4(o1, o2){
  return ~~Math.max(Math.min(signum_1(dynamicCast(o1, 198).originallyScheduledExpiry - dynamicCast(o2, 198).originallyScheduledExpiry), 2147483647), -2147483648);
}
;
_.getClass$ = function getClass_441(){
  return Lorg_waveprotocol_wave_client_doodad_selection_SelectionAnnotationHandler$4_2_classLit;
}
;
_.castableTypeMap$ = {};
function $replaceName(this$static, profile){
  var newName;
  newName = $replace_0((profile.firstName == null && $buildNames(profile) , profile.firstName), 32, 160);
  if (!$equals_3(newName, this$static.name_0)) {
    this$static.name_0 = newName;
    this$static.ui.nameTextNode.data = this$static.name_0;
  }
}

function SelectionAnnotationHandler$SessionData_0(this$0, ui, address, sessionId, color){
  var cssColour;
  if (this$0.sessions.containsKey_1(sessionId)) {
    throw new IllegalArgumentException_1('Session data already exists');
  }
  this.address = address;
  this$0.sessions.put_3(sessionId, this);
  this.ui = ui;
  this.sessionId = sessionId;
  this.color = color;
  cssColour = 'rgb(' + color.red + ',' + color.green + ',' + color.blue + ')';
  ui.compositionStateSpan.style['borderColor'] = cssColour;
  ui.outerSpan.style['backgroundColor'] = cssColour;
  ui.innerSpan.style['borderColor'] = cssColour;
}

function SelectionAnnotationHandler$SessionData(){
}

_ = SelectionAnnotationHandler$SessionData_0.prototype = SelectionAnnotationHandler$SessionData.prototype = new Object_0;
_.getClass$ = function getClass_442(){
  return Lorg_waveprotocol_wave_client_doodad_selection_SelectionAnnotationHandler$SessionData_2_classLit;
}
;
_.castableTypeMap$ = {198:1};
_.address = null;
_.bundle = null;
_.color = null;
_.expiry = 0;
_.name_0 = null;
_.originallyScheduledExpiry = 0;
_.sessionId = null;
_.ui = null;
function $clinit_725(){
  $clinit_725 = nullMethod;
  new Property$ImmutableProperty_0('link_rangetracker');
  plugins = new ArrayList_0;
  $clinit_592();
  new SafeHtmlString_0("<a class='C-LH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-sugg'><span>");
  new SafeHtmlString_0('<\/span><\/a>');
  $clinit_103();
  $push_1(toInject, ($clinit_211() , "/* CssUrl */\n/* CssUrl */\na.C-LH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-sugg, a.C-IH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-orig, a.C-GH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-cmd {\n  display : block;\n  color : #003ea8;\n  background-color : white;\n  cursor : pointer;\n  padding : 3px 20px 4px 20px;\n  margin : 0 -2px !important;\n  text-decoration : none;\n}\n.C-HH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-hover a.C-LH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-sugg, .C-HH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-hover a.C-IH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-orig, .C-HH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-hover a.C-GH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-cmd {\n  color : white;\n  background-color : #4086ff;\n  text-decoration : none;\n}\n.C-HH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-hover a.C-LH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-sugg label, .C-HH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-hover a.C-IH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-orig label {\n  color : #c0d4ff;\n}\n.C-LH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-sugg label, .C-IH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-orig label {\n  margin-right : 5px;\n  text-decoration : underline;\n  color : #7295cf;\n}\n.C-LH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-sugg span {\n  font-weight : bold;\n  text-decoration : none;\n}\n.C-IH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-orig span {\n  font-style : italic;\n  text-decoration : none;\n}\n.C-IH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-orig {\n  background-image : url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHRJREFUeNpiYIABuxX/GQgAJmIVggAjEQo3AnEDw6GIC4woJh+KYERRZreCH0gmgBUzMDgyorgZXTFCrh5IKjDBBXAphIANQGzAxEAcEECEBmHgAMQXGPEqsVuhAPVgPsgZLDgUwYLzARAfACkE+ukhQIABAKZuHUYsPLRcAAAAAElFTkSuQmCC');\n  background-repeat : no-repeat;\n  background-position : 5px 50%;\n}\n.C-HH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-hover a.C-IH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-orig {\n  background-image : url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAGZJREFUeNpiYICC/0DAQAAwEasQrBhZ4X/sYAMQGzCgK0I3CSjED8T5QPwepIERWQMjEGCzHihVD6QUiHEqSLE+EJ9nYiAOCMBDgwjgAMQXCFmvAMQNUA/K41IEA/eBeD5MIUCAAQCexWwv78dj0QAAAABJRU5ErkJggg==');\n  background-repeat : no-repeat;\n  background-position : 5px 50%;\n}\n.C-GH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-cmd span {\n  margin-left : 12px;\n  text-decoration : none;\n}\n.C-KH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-sep {\n  width : 100%;\n  margin-top : 1px;\n  height : 1px;\n  border-top : 1px solid #e3e8f2;\n}\n.C-JH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-selected {\n  background : #d0e8ff;\n}\n"));
  schedule();
}

function maybeCreateSuggestions(){
  $clinit_725();
  var attributes, plugin$iterator;
  attributes = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  for (plugin$iterator = new AbstractList$IteratorImpl_0(plugins); plugin$iterator.i < plugin$iterator.this$0_0.size_1();) {
    throwClassCastExceptionUnlessNull($next_4(plugin$iterator));
    null.nullMethod();
  }
  return new AttributesImpl_1(copyToJavaMap(attributes, new HashMap_0));
}

var plugins;
function $clinit_726(){
  $clinit_726 = nullMethod;
  HAS_SUGGESTIONS_PROP = new Property$ImmutableProperty_0('has-suggestions');
}

var HAS_SUGGESTIONS_PROP;
function $clinit_727(){
  var map;
  $clinit_727 = nullMethod;
  PAINT_PROPERTIES_0 = ($clinit_480() , map = new HashMap_1(1) , map.put('fontWeight', 'bold') , new Collections$UnmodifiableMap_0(map));
  KEYS_0 = newStringSet(initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['conv/title']));
  renderFunc = new TitleAnnotationHandler$1_0;
}

function TitleAnnotationHandler_0(painter){
  this.painter = painter;
}

function TitleAnnotationHandler(){
}

_ = TitleAnnotationHandler_0.prototype = TitleAnnotationHandler.prototype = new Object_0;
_.getClass$ = function getClass_444(){
  return Lorg_waveprotocol_wave_client_doodad_title_TitleAnnotationHandler_2_classLit;
}
;
_.handleAnnotationChange = function handleAnnotationChange_2(bundle, start, end, key, newValue){
  $scheduleRepaint(this.painter, bundle, start, end);
}
;
_.castableTypeMap$ = {429:1};
_.painter = null;
var KEYS_0, PAINT_PROPERTIES_0, renderFunc;
function TitleAnnotationHandler$1_0(){
}

function TitleAnnotationHandler$1(){
}

_ = TitleAnnotationHandler$1_0.prototype = TitleAnnotationHandler$1.prototype = new Object_0;
_.apply_5 = function apply_22(from, isEditing){
  return from.get('conv/title') != null?($clinit_727() , PAINT_PROPERTIES_0):($clinit_480() , $clinit_480() , EMPTY_MAP);
}
;
_.getClass$ = function getClass_445(){
  return Lorg_waveprotocol_wave_client_doodad_title_TitleAnnotationHandler$1_2_classLit;
}
;
_.castableTypeMap$ = {221:1};
function $clinit_729(){
  $clinit_729 = nullMethod;
  ROOT_HANDLER_REGISTRY = ($clinit_770() , ROOT);
  ROOT_ANNOTATION_REGISTRY = ($clinit_2084() , ROOT_1);
  ROOT_PAINT_REGISTRY = new PainterRegistryImpl_0(new AnnotationPainter_0((!instance_7 && (instance_7 = new BrowserBackedScheduler_0 , setDefaultTimerService() , undefined) , medium)));
  ROOT_REGISTRIES = new RegistriesImpl_0(ROOT_HANDLER_REGISTRY, ROOT_ANNOTATION_REGISTRY, ROOT_PAINT_REGISTRY);
  TAB_TARGETS = newStringSet(initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, []));
}

var ROOT_ANNOTATION_REGISTRY, ROOT_HANDLER_REGISTRY, ROOT_PAINT_REGISTRY, ROOT_REGISTRIES, TAB_TARGETS;
function $annotationIntervals(this$static, start, end, keys){
  checkPositionIndexesInRange(start, end, this$static.tree.sentinel.left_0.subtreeLength - 1);
  return !keys || this$static.tree.knownKeys.isSubsetOf(keys)?new GenericAnnotationIntervalIterable_0(this$static, start, end, this$static.tree.knownKeys):new GenericAnnotationIntervalIterable_0(this$static, start, end, keys);
}

function $begin(this$static){
  if (this$static.cursor != -1) {
    throw new IllegalStateException_1('begin() called twice with no finish() in between');
  }
  this$static.openAnnotations.clear();
  this$static.currentlyNotifying || $clear_8(this$static.queuedNotifications);
  this$static.cursor = 0;
  this$static.inheritedAnnotationsForInsertion = this$static.factory.createStringMap();
}

function $collectAllAnnotationsAt(this$static, position, accu){
  checkElementIndex(position, this$static.tree.sentinel.left_0.subtreeLength - 1);
  $collectAllAnnotationsAtRaw(this$static.tree, position + 1, accu);
}

function $endAnnotationUnchecked(this$static, key){
  var a_0, end;
  a_0 = dynamicCast(this$static.openAnnotations.getExisting(key), 382);
  this$static.openAnnotations.remove_8(key);
  end = this$static.cursor;
  $setAnnotation_2(this$static.tree, a_0.start, end, a_0.key, a_0.value_0);
  $queueNotification(this$static, a_0.start, end, a_0.key, a_0.value_0);
}

function $finish_0(this$static){
  var n;
  this$static.openAnnotations.isEmpty() || this$static.openAnnotations.each_2(new AnnotationTree$1_0);
  if (this$static.cursor == -1) {
    throw new IllegalStateException_1('finish() called with no matching begin()');
  }
  this$static.cursor = -1;
  this$static.inheritedAnnotationsForInsertion = null;
  $cleanupKnownKeys(this$static.tree);
  if (!this$static.currentlyNotifying) {
    try {
      this$static.currentlyNotifying = true;
      while (this$static.queuedNotifications.size_0 != 0) {
        n = dynamicCast($removeFirst(this$static.queuedNotifications), 381);
        !!n.this$0.listener && n.this$0.listener.onAnnotationChange(n.start, n.end, n.key, n.value_0);
      }
    }
     finally {
      $clear_8(this$static.queuedNotifications);
      this$static.currentlyNotifying = false;
    }
  }
}

function $firstAnnotationChange(this$static, start, end, key, fromValue){
  checkPositionIndexesInRange(start, end, this$static.tree.sentinel.left_0.subtreeLength - 1);
  checkNotNull_1(key, 'Key must not be null');
  return $firstAnnotationChange_6(this$static.tree, start, end, key, fromValue);
}

function $getAnnotation(this$static, location_0, key){
  checkElementIndex(location_0, this$static.tree.sentinel.left_0.subtreeLength - 1);
  checkNotNull_1(key, 'Key must not be null');
  return $getAnnotation_5(this$static.tree, location_0, key);
}

function $lastAnnotationChange(this$static, start, end, key, fromValue){
  checkPositionIndexesInRange(start, end, this$static.tree.sentinel.left_0.subtreeLength - 1);
  checkNotNull_1(key, 'Key must not be null');
  return $lastAnnotationChange_5(this$static.tree, start, end, key, fromValue);
}

function $queueNotification(this$static, start, end, key, value){
  var n, p;
  if (this$static.queuedNotifications.size_0 != 0) {
    p = dynamicCast($getLast_0(this$static.queuedNotifications), 381);
    if (p.end == start && $equals_3(p.key, key) && equal_0(p.value_0, value)) {
      p.end = end;
      return;
    }
  }
  n = new AnnotationTree$Notification_0(this$static, start, end, key, value);
  $add_14(this$static.queuedNotifications, n);
}

function $skip(this$static, distance){
  if (distance > this$static.tree.sentinel.left_0.subtreeLength - 1 - this$static.cursor) {
    throw new OpCursorException_0('Attempt to skip beyond end of document (cursor at ' + this$static.cursor + ', size is ' + (this$static.tree.sentinel.left_0.subtreeLength - 1) + ', distance is ' + distance + ')');
  }
  this$static.cursor += distance;
  $updateInheritedAnnotationsFromPosition(this$static, this$static.cursor - 1);
}

function $startAnnotation(this$static, key, value){
  if (key.charCodeAt(0) != 64 && value != null && !(value != null && value.castableTypeMap$ && !!value.castableTypeMap$[1])) {
    throw new IllegalArgumentException_1('Attempt to store a non-string object in a non-local annotation: ' + key + '=' + value);
  }
  if (this$static.openAnnotations.containsKey_1(key)) {
    if (equal_0(value, dynamicCast(this$static.openAnnotations.getExisting(key), 382).value_0)) {
      return;
    }
    $endAnnotationUnchecked(this$static, key);
  }
  this$static.openAnnotations.put_3(key, new AnnotationTree$OpenAnnotation_0(this$static.cursor, key, value));
}

function $updateInheritedAnnotationsFromPosition(this$static, position){
  $collectAllAnnotationsAt(this$static, position, this$static.inheritedAnnotationsForInsertion);
}

function AnnotationTree_0(oneValue, anotherValue, listener){
  this.factory = ($clinit_2309() , $clinit_2309() , defaultCollectionFactory);
  this.openAnnotations = defaultCollectionFactory.createStringMap();
  this.queuedNotifications = new LinkedList_0;
  checkNotNull_1(oneValue, 'The argument oneValue must not be null');
  checkNotNull_1(anotherValue, 'The argument anotherValue must not be null');
  checkArgument_2(!equals__devirtual$(oneValue, anotherValue), 'The arguments oneValue and anotherValue must not be equal');
  this.tree = new BasicAnnotationTree_0(oneValue, anotherValue);
  this.listener = listener;
}

function AnnotationTree(){
}

_ = AnnotationTree_0.prototype = AnnotationTree.prototype = new Object_0;
_.annotationIntervals = function annotationIntervals(start, end, keys){
  return checkPositionIndexesInRange(start, end, this.tree.sentinel.left_0.subtreeLength - 1) , !keys || this.tree.knownKeys.isSubsetOf(keys)?new GenericAnnotationIntervalIterable_0(this, start, end, this.tree.knownKeys):new GenericAnnotationIntervalIterable_0(this, start, end, keys);
}
;
_.begin = function begin_0(){
  $begin(this);
}
;
_.delete_$ = function delete_$(deleteSize){
  if (deleteSize > this.tree.sentinel.left_0.subtreeLength - 1 - this.cursor) {
    throw new OpCursorException_0('Attempt to delete beyond end of document (cursor at ' + this.cursor + ', size is ' + (this.tree.sentinel.left_0.subtreeLength - 1) + ', deleteSize is ' + deleteSize + ')');
  }
  $collectAllAnnotationsAt(this, this.cursor + deleteSize - 1, this.inheritedAnnotationsForInsertion);
  $delete_3(this.tree, this.cursor, this.cursor + deleteSize);
}
;
_.endAnnotation = function endAnnotation(key){
  $endAnnotationUnchecked(this, key);
}
;
_.finish = function finish(){
  $finish_0(this);
}
;
_.firstAnnotationChange = function firstAnnotationChange(start, end, key, fromValue){
  return checkPositionIndexesInRange(start, end, this.tree.sentinel.left_0.subtreeLength - 1) , checkNotNull_1(key, 'Key must not be null') , $firstAnnotationChange_6(this.tree, start, end, key, fromValue);
}
;
_.forEachAnnotationAt = function forEachAnnotationAt(index, callback){
  checkElementIndex(index, this.tree.sentinel.left_0.subtreeLength - 1);
  $forEachAnnotationAtRaw(this.tree, index + 1, callback);
}
;
_.getAnnotation = function getAnnotation(location_0, key){
  return checkElementIndex(location_0, this.tree.sentinel.left_0.subtreeLength - 1) , checkNotNull_1(key, 'Key must not be null') , $getAnnotation_5(this.tree, location_0, key);
}
;
_.getClass$ = function getClass_446(){
  return Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree_2_classLit;
}
;
_.getInherited = function getInherited(key){
  return key.charCodeAt(0) != 64?dynamicCast(this.inheritedAnnotationsForInsertion.get_3(key, null), 1):null;
}
;
_.insert = function insert(insertSize){
  var end, start;
  $insertRaw(this.tree, this.cursor + 1, insertSize);
  start = this.cursor;
  end = this.cursor + insertSize;
  this.inheritedAnnotationsForInsertion.each_2(new AnnotationTree$2_0(this, start, end));
  this.tree.knownKeys.each_3(new AnnotationTree$3_0(this, start, end));
  this.cursor += insertSize;
}
;
_.knownKeysLive = function knownKeysLive(){
  return this.tree.knownKeys;
}
;
_.lastAnnotationChange = function lastAnnotationChange(start, end, key, fromValue){
  return checkPositionIndexesInRange(start, end, this.tree.sentinel.left_0.subtreeLength - 1) , checkNotNull_1(key, 'Key must not be null') , $lastAnnotationChange_5(this.tree, start, end, key, fromValue);
}
;
_.size_1 = function size_30(){
  return this.tree.sentinel.left_0.subtreeLength - 1;
}
;
_.skip = function skip(distance){
  $skip(this, distance);
}
;
_.startAnnotation = function startAnnotation(key, value){
  $startAnnotation(this, key, value);
}
;
_.castableTypeMap$ = {};
_.currentlyNotifying = false;
_.cursor = -1;
_.inheritedAnnotationsForInsertion = null;
_.listener = null;
_.tree = null;
function $clinit_732(){
  $clinit_732 = nullMethod;
  ONE_OBJECT = new Object_1;
  ANOTHER_OBJECT = new Object_1;
}

function EditorAnnotationTree_0(listener){
  $clinit_732();
  AnnotationTree_0.call(this, ONE_OBJECT, ANOTHER_OBJECT, listener);
}

function EditorAnnotationTree(){
}

_ = EditorAnnotationTree_0.prototype = EditorAnnotationTree.prototype = new AnnotationTree;
_.getClass$ = function getClass_447(){
  return Lorg_waveprotocol_wave_client_editor_EditorAnnotationTree_2_classLit;
}
;
_.castableTypeMap$ = {};
var ANOTHER_OBJECT, ONE_OBJECT;
function $clinit_735(){
  $clinit_735 = nullMethod;
  $clinit_103();
  $push_1(toInject, ($clinit_211() , '/*@noflip { */\n.editor {\n  position : relative;\n  line-height : 1.35;\n  z-index : 0;\n  text-align : left;\n  direction : ltr;\n}\n.oldBlipUi.editor {\n  min-height : 33px;\n}\n.newBlipUi.editor {\n  margin-left : 36px;\n  margin-top : 4px;\n}\n.document {\n  text-align : left;\n  direction : ltr;\n  white-space : pre-wrap;\n}\n/*} @noflip */\n.document p {\n  margin : 0 0 0 0;\n}\n.document:focus {\n  outline : 0;\n}\n.simulated-li {\n  display : list-item;\n  list-style-type : disc;\n  list-style-position : outside;\n}\n.numbered {\n  list-style-type : decimal;\n}\n.bullet-type-0 {\n  list-style-type : disc;\n}\n.bullet-type-1 {\n  list-style-type : circle;\n}\n.bullet-type-2 {\n  list-style-type : square;\n}\n'));
  flush();
  nativeSetupWebDriverTestPins_0();
  setTransientMutationListener(new EditorImpl$7_0);
}

function $checkContextConsistency(this$static){
  if (!(!(!!this$static.pasteExtractor && this$static.pasteExtractor.busy) && !(!!this$static.typing && ($isBusy(this$static.typing) || this$static.domMutationReverter.entries.size_0 != 0)))) {
    !!this$static.content_0 && $flush_1(this$static.typing);
    $log_0(($clinit_761() , logger_1).errorLogger, 'Editor context methods called while editor is not consistent.');
  }
}

function $clearContent(this$static){
  var oldSink;
  if (this$static.content_0) {
    $updateDocumentEditState(this$static, false);
    $clinit_761();
    ++ignoreMutations;
    try {
      this$static.domHandlers.each_0(new EditorImpl$11_0);
      this$static.domHandlers.clear();
      if (this$static.ownsDocument) {
        this$static.div.removeChild(dynamicCast(this$static.content_0.fullContentView.inner_0.getDocumentElement(), 196).implNodelet);
      }
       else {
        oldSink = $replaceOutgoingSink(this$static.content_0, this$static.innerOutputSink);
        if (oldSink != this$static.outgoingOperationSink) {
          throw new RuntimeException_1('Document had a mysterious sink.  Restoration is unsafe');
        }
        $removeClassName(this$static.div, 'editor');
      }
    }
     finally {
      --ignoreMutations;
    }
  }
  this$static.content_0 = null;
}

function $flushSynchronous(this$static){
  !!this$static.content_0 && $flush_1(this$static.typing);
}

function $generateReplaceTextOp(this$static, at, deletionSize, text){
  var builder;
  builder = new Nindo$Builder_0;
  $add_9(builder.mutationList, new Nindo$Skip_0(at));
  if (deletionSize > 0) {
    $supplementAnnotations(this$static.annotationLogic, at, ($clinit_1780() , RIGHT_4), ($clinit_1782() , PLAIN_TEXT));
    $add_9(builder.mutationList, new Nindo$DeleteCharacters_0(deletionSize));
  }
  if (text.length > 0) {
    $buildAnnotationStarts(this$static.caretStyles, builder);
    !text.length || $add_9(builder.mutationList, new Nindo$Characters_0(text));
    $buildAnnotationEnds(this$static.caretStyles, builder);
  }
  return new Nindo_0(builder.mutationList);
}

function $getHtmlSelection(this$static){
  return this$static.content_0?$getHtmlSelection_0(this$static.htmlSelectionHelper):null;
}

function $getSelectionHelper_0(this$static){
  checkState_2(!!this$static.passiveSelectionHelper, 'Using the selection helper of an editor not set up.');
  $checkContextConsistency(this$static);
  return this$static.passiveSelectionHelper;
}

function $onIncomingOp(this$static, operation){
  $logLazyObjects(($clinit_761() , logger_1).traceLogger, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Incoming operation', operation]));
  if (!this$static.content_0) {
    throw new IllegalStateException_1('Cannot apply op to uninitialized editor');
  }
  try {
    this$static.editorUndoManager.nonUndoableOp(operation);
  }
   finally {
    $scheduleUpdateNotification_0(this$static.updateEvent, false, false, true, false);
  }
}

function $registerDomEventHandling(this$static){
  var event_0, event$array, event$index, event$max;
  for (event$array = ($clinit_788() , HANDLED_EVENTS) , event$index = 0 , event$max = event$array.length; event$index < event$max; ++event$index) {
    event_0 = event$array[event$index];
    this$static.domHandlers.add_2(registerEventHandler(dynamicCast(this$static.content_0.fullContentView.inner_0.getDocumentElement(), 196).implNodelet, event_0, false, this$static));
  }
}

function $setContent_0(this$static, op){
  checkState_2(this$static.ownsDocument, 'Can not replace content not owned');
  $setContent_1(this$static, new ContentDocument_0(this$static.registries, op));
}

function $setContent_1(this$static, newDoc){
  var docDiv, revertTask, sequencer, undoableDocument, undoingSequencer, docElement, docPainter;
  !!this$static.content_0 && $flush_1(this$static.typing);
  $clinit_761();
  ++ignoreMutations;
  try {
    !!this$static.suggestionsManager && $clear_13(this$static.suggestionsManager.suggestables);
    $clear_20(this$static.elementsWithDisplayEditModes);
    $clearContent(this$static);
    this$static.content_0 = newDoc;
    this$static.ownsDocument?$replaceOutgoingSink(this$static.content_0, this$static.outgoingOperationSink):(this$static.innerOutputSink = $replaceOutgoingSink(this$static.content_0, this$static.outgoingOperationSink));
    this$static.content_0.level.ordinal - ($clinit_835() , RENDERED).ordinal >= 0 || $setRendering(this$static.content_0);
    this$static.repairer = this$static.content_0.repairer;
    this$static.nodeManager = this$static.content_0.nodeManager;
    this$static.htmlSelectionHelper = new HtmlSelectionHelperImpl_0(dynamicCast(this$static.content_0.fullContentView.inner_0.getDocumentElement(), 196).implNodelet);
    this$static.passiveSelectionHelper = new PassiveSelectionHelper_0(this$static.htmlSelectionHelper, this$static.content_0.nodeManager, this$static.content_0.renderedContentView, this$static.content_0.indexedDoc);
    this$static.suggestionsManager = new InteractiveSuggestionsManager_0(this$static.passiveSelectionHelper, this$static.settings.closeSuggestionsMenuDelayMs);
    this$static.aggressiveSelectionHelper = new EditorImpl$12_0(this$static, this$static.htmlSelectionHelper, this$static.nodeManager, this$static.content_0.renderedContentView, this$static.content_0.indexedDoc, this$static.content_0.mutableContent);
    this$static.caretMoveHelper = new CaretMovementHelperWebkitImpl_0(this$static.nodeManager);
    sequencer = this$static.content_0.sequencer;
    this$static.typing = new TypingExtractor_0(this$static.typingSink, this$static.nodeManager, this$static.content_0.filteredHtmlView, this$static.content_0.renderedContentView, this$static.repairer, new EditorImpl$13_0(this$static));
    this$static.responsibility = new ResponsibilityManagerImpl_0;
    this$static.settings.undoEnabled?(this$static.editorUndoManager = new EditorUndoManagerImpl_0(new UndoManagerImpl_0, new EditorImpl$14_0(this$static), this$static.passiveSelectionHelper)):(this$static.editorUndoManager = ($clinit_762() , NOP_IMPL));
    undoingSequencer = new UndoableSequencer_0(sequencer, this$static.responsibility);
    undoableDocument = $createSequencedDocumentWrapper(this$static.content_0, undoingSequencer);
    this$static.pasteExtractor = new PasteExtractor_0(this$static.aggressiveSelectionHelper, undoableDocument, this$static.content_0.renderedContentView, this$static.content_0.persistentContentView, this$static.content_0.registries.annotationHandlerRegistry, undoingSequencer, this$static.content_0.indexedDoc, (this$static.settings , this$static.settings.useSemanticCopyPaste));
    revertTask = new EditorImpl$15_0(this$static);
    this$static.domMutationReverter = new DomMutationReverter_0(new EditorImpl$16_0(this$static, revertTask));
    dynamicCast(this$static.content_0.fullContentView.inner_0.getDocumentElement(), 196);
    this$static.caretStyles = new CaretAnnotations_0;
    this$static.caretStyles.resolver = this$static.annotationResolver;
    $clinit_797();
    docElement = this$static.content_0.context.this$0.mutableContent.doc.substrate.getDocumentElement();
    docPainter = dynamicCast($getProperty_2(($clinit_790() , DOC_PAINTER_PROP), dynamicCast(docElement, 196)), 219);
    !!docPainter && $doRun(docPainter, 80);
    this$static.savedSelection = new RangeTracker_0(this$static.content_0.localAnnotations);
    this$static.passiveSelectionHelper.savedSelection = this$static.savedSelection;
    this$static.annotationLogic = new AnnotationBehaviourLogic_0(($clinit_729() , ROOT_ANNOTATION_REGISTRY), this$static.content_0.mutableContent, this$static.caretStyles);
    $attachEditor(this$static.content_0, this$static.editorPackage, this$static.ownsDocument?this$static:null);
    docDiv = dynamicCast(this$static.content_0.fullContentView.inner_0.getDocumentElement(), 196).implNodelet;
    if (this$static.ownsDocument) {
      this$static.div.appendChild(docDiv);
      $addClassName(docDiv, 'document');
    }
     else {
      checkArgument_2(this$static.div == $getParentElement(docDiv), 'wrong content document');
    }
    docDiv.setAttribute('editableDocMarker', 'true');
    docDiv.setAttribute('spellcheck', 'false');
    $registerDomEventHandling(this$static);
    $setEditing(this$static, this$static.editing);
  }
   finally {
    --ignoreMutations;
  }
}

function $setEditing(this$static, editing){
  this$static.editing = editing;
  if (this$static.content_0) {
    $updateDocumentEditState(this$static, editing);
    this$static.editorUndoManager.maybeCheckpoint();
    if (editing) {
      !this$static.innerOutputSink && $log_0(($clinit_761() , logger_1).errorLogger, 'Scheduling update with no inner output sink...');
      $scheduleUpdateNotification_0(this$static.updateEvent, false, true, false, false);
    }
  }
}

function $updateDocumentEditState(this$static, editing){
  var element, element$iterator, topLevel;
  topLevel = dynamicCast(this$static.content_0.fullContentView.inner_0.getDocumentElement(), 196).implNodelet;
  dynamicCast(this$static.content_0.fullContentView.inner_0.getDocumentElement(), 196).transientData.put_1(($clinit_797() , DOCUMENT_MODE).id_0, ($clinit_428() , editing?TRUE_0:FALSE_0));
  $removeClassName(topLevel, 'wave-editor-on');
  $removeClassName(topLevel, 'wave-editor-off');
  $addClassName(topLevel, editing?'wave-editor-on':'wave-editor-off');
  maybeScheduleRepaint(this$static.content_0.context, 0, $size_15(this$static.content_0.mutableContent.doc));
  topLevel.style['-webkit-user-modify'] = editing?'read-write-plaintext-only':'read-only';
  topLevel.style['white-space'] = 'pre-wrap';
  for (element$iterator = $iterator_20(this$static.elementsWithDisplayEditModes); element$iterator.hasNext();) {
    element = dynamicCast(element$iterator.next_0(), 196);
    element.parent_0?onEditModeChange(element, editing):$remove_42(this$static.elementsWithDisplayEditModes, element);
  }
}

function EditorImpl$11_0(){
}

function EditorImpl$11(){
}

_ = EditorImpl$11_0.prototype = EditorImpl$11.prototype = new Object_0;
_.apply_7 = function apply_23(handler){
  $unregister(dynamicCastJso(handler));
}
;
_.getClass$ = function getClass_452(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl$11_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_739(){
  $clinit_739 = nullMethod;
  logger_0 = ($clinit_761() , logger_1);
}

function $findOrCreateValidSelectionPoint(this$static, point){
  var container, newContainer, nodeAfter, validContainerView, find_0;
  validContainerView = new PassiveSelectionHelper$ValidSelectionContainerView_0(this$static.renderedContentView);
  container = dynamicCast(point.container, 196);
  if (!isKnownInvalidTopContainerForCursor(container)) {
    return point;
  }
  nodeAfter = dynamicCast($getNodeAfter(point), 197);
  if (!nodeAfter) {
    newContainer = dynamicCast((find_0 = validContainerView.inner_0.getLastChild_0(container) , $getPreviousVisibleNodeDepthFirst(validContainerView, find_0, container, true)), 197);
  }
   else {
    newContainer = dynamicCast($getPreviousVisibleNodeDepthFirst(validContainerView, nodeAfter, null, false), 197);
    if (newContainer) {
      if (newContainer == nodeAfter) {
        newContainer = dynamicCast($getPreviousVisibleNodeDepthFirst(validContainerView, nodeAfter.parent_0, null, false), 197);
        if (newContainer == nodeAfter.parent_0) {
          return new Point$El_0($getParentElement_3(validContainerView, nodeAfter), nodeAfter);
        }
      }
      if (newContainer) {
        return new Point$El_0(newContainer, null);
      }
    }
    newContainer = dynamicCast($getNextVisibleNodeDepthFirst(validContainerView, nodeAfter, null), 197);
    if (newContainer) {
      return new Point$El_0(newContainer, dynamicCast($getFirstChild_4(this$static.renderedContentView, newContainer), 197));
    }
  }
  !newContainer && (newContainer = this$static.maybePlaceMissingCursorContainer(point));
  return newContainer?new Point$El_0(newContainer, null):null;
}

function $getSelectionPoints(this$static){
  var anchor, focus_0, range, ret;
  range = $getHtmlSelection_0(this$static.htmlHelper);
  try {
    this$static.needsCorrection = false;
    range = filterNonContentSelection(range);
    if (!range) {
      return null;
    }
    anchor = $nodeletPointToFixedContentPoint(this$static, range.anchor);
    focus_0 = range.isCollapsed?anchor:$nodeletPointToFixedContentPoint(this$static, range.focus_0);
    if (!anchor || !focus_0) {
      return null;
    }
    ret = range.isCollapsed?new FocusedContentRange_1(anchor):new FocusedContentRange_0(anchor, focus_0);
    this$static.needsCorrection && !!ret && $setSelectionPoints(this$static, ret.anchor, ret.focus_0);
    return ret;
  }
   finally {
    this$static.needsCorrection = false;
  }
}

function $getSelectionRange(this$static){
  var contentRange;
  contentRange = $getSelectionPoints(this$static);
  if (!contentRange) {
    return null;
  }
  return new FocusedRange_0($getLocation_4(this$static.mapper, contentRange.anchor), $getLocation_4(this$static.mapper, contentRange.focus_0));
}

function $nodeletPointToFixedContentPoint(this$static, point){
  var $e0, $e1, e, ret, textNodeLength;
  try {
    try {
      ret = $nodeletPointToWrapperPoint(this$static.nodeManager, point);
    }
     catch ($e1) {
      $e1 = caught_0($e1);
      if (instanceOf($e1, 21)) {
        e = $e1;
        $log_0(logger_0.errorLogger, 'CAUGHT RUNTIME EXCEPTION in nodeletPointToFixedContentPoint ' + e);
        ret = this$static.nodeletPointToWrapperPointAttempt2(point);
      }
       else 
        throw $e1;
    }
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 206)) {
      e = $e0;
      ret = e.contentPoint;
      this$static.needsCorrection = true;
    }
     else if (instanceOf($e0, 205)) {
      e = $e0;
      ret = before_0(this$static.renderedContentView, e.brokenNode);
      this$static.needsCorrection = true;
    }
     else 
      throw $e0;
  }
  if (!ret || ret.container == null) {
    return null;
  }
  if (ret.offset >= 0) {
    textNodeLength = dynamicCast(ret.container, 197).asText().data_0.length;
    if ($getTextOffset(ret) > textNodeLength) {
      $log_0(logger_0.errorLogger, "Text offset too big for text node, editor consistency: '(no editor available)'");
      ret = new Point$Tx_0(dynamicCast(ret.container, 197), textNodeLength);
    }
  }
   else if (isKnownInvalidTopContainerForCursor(dynamicCast(ret.container, 197))) {
    ret = $findOrCreateValidSelectionPoint(this$static, ret.asElementPoint());
    this$static.needsCorrection = true;
  }
  return ret;
}

function $setSelectionPoints(this$static, anchor, focus_0){
  var collapsed, nodeletAnchor, nodeletFocus, range, asElementPoint, asElementPoint_0;
  collapsed = anchor == focus_0;
  anchor = (asElementPoint = anchor.asElementPoint() , !asElementPoint?anchor:$findOrCreateValidSelectionPoint(this$static, asElementPoint));
  focus_0 = collapsed?anchor:(asElementPoint_0 = focus_0.asElementPoint() , !asElementPoint_0?focus_0:$findOrCreateValidSelectionPoint(this$static, asElementPoint_0));
  nodeletAnchor = anchor?$wrapperPointToNodeletPoint(this$static.nodeManager, anchor):null;
  if (nodeletAnchor) {
    nodeletFocus = anchor == focus_0?nodeletAnchor:$wrapperPointToNodeletPoint(this$static.nodeManager, focus_0);
    if (nodeletFocus) {
      range = new FocusedPointRange_1(nodeletAnchor, nodeletFocus);
      !!range && ($clinit_1046() , $clinit_1046() , cache_1 = null , $set_8(range.anchor, range.focus_0));
    }
  }
  if (this$static.savedSelection) {
    range = new FocusedRange_0($getLocation_4(this$static.mapper, anchor), $getLocation_4(this$static.mapper, focus_0));
    $trackRange(this$static.savedSelection, range);
  }
}

function $setSelectionRange_1(this$static, selection){
  var anchor, focus_0;
  if (selection) {
    anchor = $locate_0(this$static.mapper, selection.anchor);
    focus_0 = selection.anchor == selection.focus_0?anchor:$locate_0(this$static.mapper, selection.focus_0);
    $setSelectionPoints(this$static, anchor, focus_0);
  }
}

function PassiveSelectionHelper_0(htmlHelper, nodeManager, renderedContentView, locationMapper){
  $clinit_739();
  this.htmlHelper = htmlHelper;
  this.mapper = locationMapper;
  this.nodeManager = nodeManager;
  this.renderedContentView = renderedContentView;
}

function isKnownInvalidTopContainerForCursor(node){
  $clinit_739();
  if (!node) {
    return true;
  }
  return !node.parent_0 || ($clinit_916() , isLineContainer(($clinit_853() , INSTANCE_6), node));
}

function PassiveSelectionHelper(){
}

_ = PassiveSelectionHelper_0.prototype = PassiveSelectionHelper.prototype = new Object_0;
_.getClass$ = function getClass_453(){
  return Lorg_waveprotocol_wave_client_editor_selection_content_PassiveSelectionHelper_2_classLit;
}
;
_.maybePlaceMissingCursorContainer = function maybePlaceMissingCursorContainer(at){
  return null;
}
;
_.nodeletPointToWrapperPointAttempt2 = function nodeletPointToWrapperPointAttempt2(point){
  return null;
}
;
_.castableTypeMap$ = {};
_.htmlHelper = null;
_.mapper = null;
_.needsCorrection = false;
_.nodeManager = null;
_.renderedContentView = null;
_.savedSelection = null;
var logger_0;
function AggressiveSelectionHelper(){
}

_ = AggressiveSelectionHelper.prototype = new PassiveSelectionHelper;
_.getClass$ = function getClass_454(){
  return Lorg_waveprotocol_wave_client_editor_selection_content_AggressiveSelectionHelper_2_classLit;
}
;
_.maybePlaceMissingCursorContainer = function maybePlaceMissingCursorContainer_0(at){
  var inserted, line;
  $log_0(logger_0.errorLogger, 'PROBLEM: Had to create a line container to accommodate the cursor!');
  isLineContainer(($clinit_853() , INSTANCE_6), dynamicCast(at.container, 197))?(line = dynamicCast(($clinit_2135() , appendLine_0(this.mutableDocument, dynamicCast(at.container, 196), null, ($clinit_1880() , EMPTY_MAP_0))), 196)):(line = dynamicCast(appendLine(this.mutableDocument, null, ($clinit_1880() , EMPTY_MAP_0)), 196));
  inserted = ($clinit_913() , dynamicCast(line.transientData.get_0(LINE_0.id_0), 230)).paragraph;
  this.needsCorrection = true;
  return inserted;
}
;
_.nodeletPointToWrapperPointAttempt2 = function nodeletPointToWrapperPointAttempt2_0(nodelet){
  $flushSynchronous(this.this$0);
  this.needsCorrection = true;
  return $nodeletPointToWrapperPoint(this.nodeManager, nodelet);
}
;
_.castableTypeMap$ = {};
_.mutableDocument = null;
function EditorImpl$12_0(this$0, $anonymous0, $anonymous1, $anonymous2, $anonymous3, $anonymous4){
  $clinit_739();
  this.this$0 = this$0;
  this.htmlHelper = $anonymous0;
  this.mapper = $anonymous3;
  this.nodeManager = $anonymous1;
  this.renderedContentView = $anonymous2;
  this.mutableDocument = $anonymous4;
}

function EditorImpl$12(){
}

_ = EditorImpl$12_0.prototype = EditorImpl$12.prototype = new AggressiveSelectionHelper;
_.getClass$ = function getClass_455(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl$12_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function EditorImpl$13_0(this$0){
  this.this$0 = this$0;
}

function EditorImpl$13(){
}

_ = EditorImpl$13_0.prototype = EditorImpl$13.prototype = new Object_0;
_.getClass$ = function getClass_456(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl$13_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $consume(this$static, op){
  var b, size_1;
  $consumeAndReturnInvertible_0(this$static.this$0.content_0.nindoSink, (b = new Nindo$Builder_0 , op.apply_8(new Nindo$2_0(b)) , size_1 = b.mutationList.size_0 , size_1 > 0 && instanceOf($get_7(b.mutationList, size_1 - 1), 401) && $remove_12(b.mutationList, size_1 - 1) , new Nindo_0(b.mutationList)));
}

function EditorImpl$14_0(this$0){
  this.this$0 = this$0;
}

function EditorImpl$14(){
}

_ = EditorImpl$14_0.prototype = EditorImpl$14.prototype = new Object_0;
_.consume = function consume_1(op){
  $consume(this, dynamicCast(op, 207));
}
;
_.getClass$ = function getClass_457(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl$14_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function EditorImpl$15_0(this$0){
  this.this$0 = this$0;
}

function EditorImpl$15(){
}

_ = EditorImpl$15_0.prototype = EditorImpl$15.prototype = new Object_0;
_.execute_0 = function execute_17(){
  $flush_0(this.this$0.domMutationReverter);
}
;
_.getClass$ = function getClass_458(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl$15_2_classLit;
}
;
_.castableTypeMap$ = {252:1, 253:1};
_.this$0 = null;
function EditorImpl$16_0(this$0, val$revertTask){
  this.this$0 = this$0;
  this.val$revertTask = val$revertTask;
}

function EditorImpl$16(){
}

_ = EditorImpl$16_0.prototype = EditorImpl$16.prototype = new Object_0;
_.getClass$ = function getClass_459(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl$16_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$revertTask = null;
function $aboutToFlush(this$static){
  var anchor, caret, hackedTextNode, link, nodeAfter;
  $flush_0(this$static.this$0.domMutationReverter);
  if (this$static.this$0.webkitEndOfLinkHackTextNode) {
    $clinit_761();
    ++ignoreMutations;
    try {
      caret = $getHtmlSelection(this$static.this$0).focus_0;
      if (caret.offset >= 0) {
        hackedTextNode = dynamicCastJso(caret.container);
        link = hackedTextNode.previousSibling;
        while (!!link && link.nodeType == 3) {
          link = link.previousSibling;
        }
        if (!link) {
          $log_0(logger_1.errorLogger, 'No link before the link hack?');
          return;
        }
        anchor = link;
        $equalsIgnoreCase(anchor.tagName, 'a') || $log_0(logger_1.errorLogger, 'Some other element before the link hack? (' + anchor.tagName + ')');
        $getTextOffset(caret) == hackedTextNode.length?(nodeAfter = hackedTextNode.nextSibling):(nodeAfter = hackedTextNode.splitText($getTextOffset(caret)));
        moveNodes(anchor, anchor.nextSibling, nodeAfter);
        setCaret(new Point$Tx_0(hackedTextNode, hackedTextNode.length));
      }
       else {
        $log_0(logger_1.errorLogger, 'End of link hack caret not in text node!?');
      }
    }
     finally {
      this$static.this$0.webkitEndOfLinkHackTextNode = null;
      --ignoreMutations;
    }
  }
}

function $applyRepairingOperation(this$static, op){
  $push_2(this$static.this$0.responsibility.sequenceType, ($clinit_784() , DIRECT));
  try {
    $sourceNindoWithoutModifyingHtml(this$static.this$0.content_0, op);
  }
   finally {
    $endDirectSequence(this$static.this$0.responsibility);
  }
}

function $typingFinished(this$static, range){
  var n, newTextNode, newTextOffset, selection, selectionAffected;
  selection = $getHtmlSelection(this$static.this$0);
  selectionAffected = $zipRange(this$static.this$0.repairer, range, !selection?null:dynamicCastJso(selection.focus_0.container));
  if (selectionAffected) {
    n = dynamicCastJso(selection.focus_0.container);
    newTextNode = n;
    newTextOffset = $getTextOffset(selection.focus_0);
    while (n.nodeType == 3 && n.length < newTextOffset) {
      newTextOffset -= n.length;
      newTextNode = n.nextSibling;
    }
    setCaret(new Point$Tx_0(newTextNode, newTextOffset));
  }
}

function $typingReplace(this$static, start, deletionSize, text, range){
  var $e0, e, location_0, op;
  location_0 = $getLocation_4(this$static.this$0.content_0.indexedDoc, start);
  op = $generateReplaceTextOp(this$static.this$0, location_0, deletionSize, text);
  try {
    $applyRepairingOperation(this$static, op);
    $typingFinished(this$static, range);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 202)) {
      e = $e0;
      $log_0(($clinit_761() , logger_1).errorLogger, 'Swallowing Error: Invalid operation sent to TypingSink (' + e + ')');
    }
     else 
      throw $e0;
  }
  this$static.this$0.currentSelectionBias = ($clinit_1780() , LEFT_4);
}

function EditorImpl$7_0(){
}

function EditorImpl$7(){
}

_ = EditorImpl$7_0.prototype = EditorImpl$7.prototype = new Object_0;
_.getClass$ = function getClass_464(){
  return Lorg_waveprotocol_wave_client_editor_EditorImpl$7_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_756(){
  $clinit_756 = nullMethod;
  FULL_REPAIR = new EditorInstrumentor$Action_0('FULL_REPAIR', 0);
  PARTIAL_REPAIR = new EditorInstrumentor$Action_0('PARTIAL_REPAIR', 1);
  SHORTCUT_BOLD = new EditorInstrumentor$Action_0('SHORTCUT_BOLD', 2);
  SHORTCUT_ITALIC = new EditorInstrumentor$Action_0('SHORTCUT_ITALIC', 3);
  SHORTCUT_UNDERLINE = new EditorInstrumentor$Action_0('SHORTCUT_UNDERLINE', 4);
  SHORTCUT_TABINDENT = new EditorInstrumentor$Action_0('SHORTCUT_TABINDENT', 5);
  SHORTCUT_TABOUTDENT = new EditorInstrumentor$Action_0('SHORTCUT_TABOUTDENT', 6);
  SHORTCUT_TABFIELDS = new EditorInstrumentor$Action_0('SHORTCUT_TABFIELDS', 7);
  SHORTCUT_OPENNEARBYPOPUP = new EditorInstrumentor$Action_0('SHORTCUT_OPENNEARBYPOPUP', 8);
  SHORTCUT_HEADINGSTYLE = new EditorInstrumentor$Action_0('SHORTCUT_HEADINGSTYLE', 9);
  SHORTCUT_ALIGNMENT = new EditorInstrumentor$Action_0('SHORTCUT_ALIGNMENT', 10);
  CLIPBOARD_COPY = new EditorInstrumentor$Action_0('CLIPBOARD_COPY', 11);
  CLIPBOARD_PASTE_FROM_WAVE = new EditorInstrumentor$Action_0('CLIPBOARD_PASTE_FROM_WAVE', 12);
  CLIPBOARD_PASTE_FROM_OUTSIDE = new EditorInstrumentor$Action_0('CLIPBOARD_PASTE_FROM_OUTSIDE', 13);
  CLIPBOARD_CUT = new EditorInstrumentor$Action_0('CLIPBOARD_CUT', 14);
  UNDO = new EditorInstrumentor$Action_0('UNDO', 15);
  REDO = new EditorInstrumentor$Action_0('REDO', 16);
  $VALUES_19 = initValues(_3Lorg_waveprotocol_wave_client_editor_EditorInstrumentor$Action_2_classLit, {9:1, 68:1, 170:1}, 96, [FULL_REPAIR, PARTIAL_REPAIR, SHORTCUT_BOLD, SHORTCUT_ITALIC, SHORTCUT_UNDERLINE, SHORTCUT_TABINDENT, SHORTCUT_TABOUTDENT, SHORTCUT_TABFIELDS, SHORTCUT_OPENNEARBYPOPUP, SHORTCUT_HEADINGSTYLE, SHORTCUT_ALIGNMENT, CLIPBOARD_COPY, CLIPBOARD_PASTE_FROM_WAVE, CLIPBOARD_PASTE_FROM_OUTSIDE, CLIPBOARD_CUT, UNDO, REDO]);
}

function EditorInstrumentor$Action_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_26(name_0){
  $clinit_756();
  return valueOf_0(($clinit_757() , $MAP_19), name_0);
}

function values_20(){
  $clinit_756();
  return $VALUES_19;
}

function EditorInstrumentor$Action(){
}

_ = EditorInstrumentor$Action_0.prototype = EditorInstrumentor$Action.prototype = new Enum;
_.getClass$ = function getClass_469(){
  return Lorg_waveprotocol_wave_client_editor_EditorInstrumentor$Action_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 96:1};
var $VALUES_19, CLIPBOARD_COPY, CLIPBOARD_CUT, CLIPBOARD_PASTE_FROM_OUTSIDE, CLIPBOARD_PASTE_FROM_WAVE, FULL_REPAIR, PARTIAL_REPAIR, REDO, SHORTCUT_ALIGNMENT, SHORTCUT_BOLD, SHORTCUT_HEADINGSTYLE, SHORTCUT_ITALIC, SHORTCUT_OPENNEARBYPOPUP, SHORTCUT_TABFIELDS, SHORTCUT_TABINDENT, SHORTCUT_TABOUTDENT, SHORTCUT_UNDERLINE, UNDO;
function $clinit_757(){
  $clinit_757 = nullMethod;
  $MAP_19 = createValueOfMap(($clinit_756() , $VALUES_19));
}

var $MAP_19;
function EditorRuntimeException_0(reason){
  this.fillInStackTrace();
  this.detailMessage = reason;
}

function EditorRuntimeException(){
}

_ = EditorRuntimeException_0.prototype = EditorRuntimeException.prototype = new RuntimeException;
_.getClass$ = function getClass_470(){
  return Lorg_waveprotocol_wave_client_editor_EditorRuntimeException_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 21:1, 39:1, 183:1};
function $clinit_761(){
  var l_0;
  $clinit_761 = nullMethod;
  logger_1 = (l_0 = new DomLogger_0('editor') , $clinit_691() , $add_13(enabledModulesBuffer, l_0.module) , l_0);
}

function createPopup_0(positioner, autoHide, content_0, listener){
  $clinit_761();
  var popup;
  popup = new DesktopUniversalPopup_0(null, positioner, !popupChromeProvider?null:new DesktopPopupChrome_0, autoHide);
  $add_0(popup, content_0, popup.element);
  $add_31(popup.listeners, listener);
  return popup;
}

var ignoreMutations = 0, logger_1, popupChromeProvider = null;
function $clinit_762(){
  $clinit_762 = nullMethod;
  NOP_IMPL = new EditorUndoManager$1_0;
}

var NOP_IMPL;
function EditorUndoManager$1_0(){
  $clinit_761();
}

function EditorUndoManager$1(){
}

_ = EditorUndoManager$1_0.prototype = EditorUndoManager$1.prototype = new Object_0;
_.getClass$ = function getClass_473(){
  return Lorg_waveprotocol_wave_client_editor_EditorUndoManager$1_2_classLit;
}
;
_.maybeCheckpoint = function maybeCheckpoint(){
}
;
_.nonUndoableOp = function nonUndoableOp(op){
}
;
_.castableTypeMap$ = {};
function $clinit_764(){
  $clinit_764 = nullMethod;
  logger_2 = new DomLogger_0('undo');
  UNKNOWN_SELECTION = new FocusedRange_0(0, 0);
}

function EditorUndoManagerImpl_0(undoManager, sink, selectionHelper){
  $clinit_764();
  this.undoSelectionStack = new Stack_0;
  this.redoSelectionStack = new Stack_0;
  checkNotNull_1(undoManager, 'UndoManager must not be null');
  checkNotNull_1(sink, 'Op sink must not be null');
  checkNotNull_1(selectionHelper, 'Selection helper must not be null');
  this.sink = sink;
  this.undoManager = undoManager;
  this.selectionHelper = selectionHelper;
}

function EditorUndoManagerImpl(){
}

_ = EditorUndoManagerImpl_0.prototype = EditorUndoManagerImpl.prototype = new Object_0;
_.getClass$ = function getClass_474(){
  return Lorg_waveprotocol_wave_client_editor_EditorUndoManagerImpl_2_classLit;
}
;
_.maybeCheckpoint = function maybeCheckpoint_1(){
  !this.pendingCheckpoint && (this.pendingCheckpoint = UNKNOWN_SELECTION);
}
;
_.nonUndoableOp = function nonUndoableOp_0(op){
  if (this.bypass) {
    return;
  }
  $nonUndoableOp(this.undoManager, op);
}
;
_.castableTypeMap$ = {};
_.bypass = false;
_.pendingCheckpoint = null;
_.selectionHelper = null;
_.sink = null;
_.undoManager = null;
var UNKNOWN_SELECTION, logger_2;
function $scheduleUpdateNotification_0(this$static, selectionCoordsChanged, selectionLocationChanged, contentChanged, userDirectlyChangedContent){
  var scheduler;
  this$static.notedSelectionCoordsChanged |= selectionCoordsChanged;
  this$static.notedSelectionLocationChanged |= selectionLocationChanged;
  this$static.notedContentChanged |= contentChanged;
  this$static.notedUserDirectlyChangedContent |= userDirectlyChangedContent;
  scheduler = (!instance_7 && (instance_7 = new BrowserBackedScheduler_0 , setDefaultTimerService() , undefined) , instance_7);
  scheduler.taskInfos.get(this$static.notificationTask) != null?(this$static.notifyAgain = true):$scheduleRepeating_1(scheduler, ($clinit_1200() , MEDIUM), this$static.notificationTask, 20, 500);
}

function $clinit_769(){
  $clinit_769 = nullMethod;
  initRootRegistries();
}

function initRootRegistries(){
  $clinit_769();
  if (rootRegistriesInitialised) {
    return;
  }
  rootRegistriesInitialised = true;
  ($clinit_729() , TAB_TARGETS).addAll_0(newStringSet(initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['caption', 'profile-field', 'text-setting'])));
  $registerRenderer(ROOT_HANDLER_REGISTRY, 'l:ime', new ImeExtractor$1_0);
  register_4(ROOT_HANDLER_REGISTRY);
  $clinit_925();
  register_9(ROOT_HANDLER_REGISTRY);
  registerLines(ROOT_HANDLER_REGISTRY);
  register_7(ROOT_HANDLER_REGISTRY);
  $clinit_907();
  $registerEventHandler(ROOT_HANDLER_REGISTRY, 'br', INSTANCE_8);
  register_6(ROOT_HANDLER_REGISTRY);
  register_5(ROOT_HANDLER_REGISTRY);
  registerTagForSelections('l:p', false, ($clinit_2121() , NONE_5));
  registerTagForSelections('l:s', false, SHALLOW);
  registerTagForSelections('line', true, DEEP);
}

var rootRegistriesInitialised = false;
function $clinit_770(){
  $clinit_770 = nullMethod;
  handlerDataDomain = new ElementHandlerRegistry$1_0;
  ROOT = new ElementHandlerRegistry_0;
}

function $getRenderer(this$static, target){
  return dynamicCast(dynamicCast($inspect(this$static.data_0), 211).renderers.get_4(target.tagName_0), 212);
}

function $registerEventHandler(this$static, tag, eventHandler){
  dynamicCast($modify_0(this$static.data_0), 211).eventHandlers.put_3(tag, eventHandler);
}

function $registerMutationHandler(this$static, mutationHandler){
  dynamicCast($modify_0(this$static.data_0), 211).mutationHandlers.put_3('body', mutationHandler);
}

function $registerNiceHtmlRenderer(this$static, tag, renderer){
  dynamicCast($modify_0(this$static.data_0), 211).niceHtmlRenderers.put_3(tag, renderer);
}

function $registerRenderer(this$static, tag, renderer){
  dynamicCast($modify_0(this$static.data_0), 211).renderers.put_3(tag, renderer);
}

function $registerRenderingMutationHandler(this$static, tag, handler){
  var mutable;
  mutable = dynamicCast($modify_0(this$static.data_0), 211);
  mutable.renderers.put_3(tag, handler);
  mutable.mutationHandlers.put_3(tag, handler);
}

function ElementHandlerRegistry_0(){
  this.data_0 = new ChainedData_0(handlerDataDomain);
}

function ElementHandlerRegistry_1(parent_0){
  $clinit_770();
  this.data_0 = new ChainedData_1(parent_0.data_0);
}

function ElementHandlerRegistry(){
}

_ = ElementHandlerRegistry_1.prototype = ElementHandlerRegistry_0.prototype = ElementHandlerRegistry.prototype = new Object_0;
_.getClass$ = function getClass_477(){
  return Lorg_waveprotocol_wave_client_editor_ElementHandlerRegistry_2_classLit;
}
;
_.castableTypeMap$ = {};
_.data_0 = null;
var ROOT, handlerDataDomain;
function $compose(target, changes, base){
  target.renderers.clear();
  target.eventHandlers.clear();
  target.mutationHandlers.clear();
  target.niceHtmlRenderers.clear();
  $copyInto(target, base);
  $copyInto(target, changes);
}

function $copyInto(target, source){
  target.renderers.putAll_0(source.renderers);
  target.eventHandlers.putAll_0(source.eventHandlers);
  target.mutationHandlers.putAll_0(source.mutationHandlers);
  target.niceHtmlRenderers.putAll_0(source.niceHtmlRenderers);
}

function ElementHandlerRegistry$1_0(){
}

function ElementHandlerRegistry$1(){
}

_ = ElementHandlerRegistry$1_0.prototype = ElementHandlerRegistry$1.prototype = new Object_0;
_.compose = function compose(target, changes, base){
  $compose(dynamicCast(target, 211), dynamicCast(changes, 211), dynamicCast(base, 211));
}
;
_.empty = function empty(){
  return new ElementHandlerRegistry$HandlerData_0;
}
;
_.getClass$ = function getClass_478(){
  return Lorg_waveprotocol_wave_client_editor_ElementHandlerRegistry$1_2_classLit;
}
;
_.readOnlyView = function readOnlyView(modifiable){
  return dynamicCast(modifiable, 211);
}
;
_.castableTypeMap$ = {};
function ElementHandlerRegistry$HandlerData_0(){
  this.renderers = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  this.eventHandlers = defaultCollectionFactory.createStringMap();
  this.mutationHandlers = defaultCollectionFactory.createStringMap();
  this.niceHtmlRenderers = defaultCollectionFactory.createStringMap();
}

function ElementHandlerRegistry$HandlerData(){
}

_ = ElementHandlerRegistry$HandlerData_0.prototype = ElementHandlerRegistry$HandlerData.prototype = new Object_0;
_.getClass$ = function getClass_479(){
  return Lorg_waveprotocol_wave_client_editor_ElementHandlerRegistry$HandlerData_2_classLit;
}
;
_.castableTypeMap$ = {211:1};
function $getHtmlSelection_0(this$static){
  var selection;
  selection = get_21();
  if (!selection || !$isFullyInside(selection, this$static.doc) || (selection.isCollapsed?$isInChildEditor(this$static, selection.anchor):$isInChildEditor(this$static, selection.anchor) || $isInChildEditor(this$static, selection.focus_0))) {
    return null;
  }
  return selection;
}

function $getOrderedHtmlSelection(this$static){
  var jsRange;
  if (!$getHtmlSelection_0(this$static)) {
    return null;
  }
  return $clinit_1046() , jsRange = $getSelectionRange_0() , toOrderedPointRange(jsRange);
}

function $isFullyInside(selection, node){
  return $isOrHasChild(node, dynamicCastJso(selection.anchor.container)) && $isOrHasChild(node, dynamicCastJso(selection.focus_0.container));
}

function $isInChildEditor(this$static, point){
  var e, n;
  n = dynamicCastJso(point.container);
  e = n.nodeType == 3?$getParentElement(n):n;
  while (!!e && e != this$static.doc) {
    if (e.hasAttribute('editableDocMarker')) {
      return true;
    }
    e = $getParentElement(e);
  }
  return false;
}

function HtmlSelectionHelperImpl_0(doc){
  this.doc = doc;
}

function HtmlSelectionHelperImpl(){
}

_ = HtmlSelectionHelperImpl_0.prototype = HtmlSelectionHelperImpl.prototype = new Object_0;
_.getClass$ = function getClass_480(){
  return Lorg_waveprotocol_wave_client_editor_HtmlSelectionHelperImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.doc = null;
function $clinit_776(){
  $clinit_776 = nullMethod;
  INSTANCE_5 = new NodeEventHandlerImpl_0;
}

function NodeEventHandlerImpl_0(){
}

function NodeEventHandlerImpl(){
}

_ = NodeEventHandlerImpl_0.prototype = NodeEventHandlerImpl.prototype = new Object_0;
_.getClass$ = function getClass_481(){
  return Lorg_waveprotocol_wave_client_editor_NodeEventHandlerImpl_2_classLit;
}
;
_.onActivated = function onActivated(element){
}
;
_.onDeactivated = function onDeactivated(element){
}
;
_.castableTypeMap$ = {216:1};
var INSTANCE_5;
function NodeMutationHandlerImpl_0(){
}

function NodeMutationHandlerImpl(){
}

_ = NodeMutationHandlerImpl_0.prototype = NodeMutationHandlerImpl.prototype = new Object_0;
_.getClass$ = function getClass_482(){
  return Lorg_waveprotocol_wave_client_editor_NodeMutationHandlerImpl_2_classLit;
}
;
_.onActivatedSubtree = function onActivatedSubtree(element){
}
;
_.onActivationStart = function onActivationStart(element){
}
;
_.onAddedToParent = function onAddedToParent(element, oldParent){
}
;
_.onAttributeModified = function onAttributeModified(element, name_0, oldValue, newValue){
}
;
_.onChildAdded = function onChildAdded(element, child){
}
;
_.onChildRemoved = function onChildRemoved(element, child){
}
;
_.onDeactivated_0 = function onDeactivated_0(element){
}
;
_.onDescendantsMutated = function onDescendantsMutated(element){
}
;
_.onEmptied = function onEmptied(element){
}
;
_.onRemovedFromParent = function onRemovedFromParent(element, newParent){
}
;
_.castableTypeMap$ = {215:1};
function fanoutChildren(element){
  var child, child$iterator, children, node;
  children = new ArrayList_0;
  for (node = element.firstChild_0; node; node = node.next) {
    setCheck(children.array, children.size_0++, node);
  }
  for (child$iterator = new AbstractList$IteratorImpl_0(children); child$iterator.i < child$iterator.this$0_0.size_1();) {
    child = dynamicCast($next_4(child$iterator), 197);
    $run_0(dynamicCast(element.transientData.get_0(($clinit_1126() , GADGET_WIDGET).id_0), 214).childAddedTask, child);
    child.onAddedToParent_0(null);
  }
}

function RenderingMutationHandler(){
}

_ = RenderingMutationHandler.prototype = new NodeMutationHandlerImpl;
_.getClass$ = function getClass_483(){
  return Lorg_waveprotocol_wave_client_editor_RenderingMutationHandler_2_classLit;
}
;
_.castableTypeMap$ = {212:1, 215:1};
function RenderingMutationHandler$1_0(val$handler, val$element){
  this.val$handler = val$handler;
  this.val$element = val$element;
}

function RenderingMutationHandler$1(){
}

_ = RenderingMutationHandler$1_0.prototype = RenderingMutationHandler$1.prototype = new Object_0;
_.apply_1 = function apply_25(key, item){
  this.val$handler.onAttributeModified(this.val$element, key, null, dynamicCast(item, 1));
}
;
_.getClass$ = function getClass_484(){
  return Lorg_waveprotocol_wave_client_editor_RenderingMutationHandler$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$element = null;
_.val$handler = null;
function $endDirectSequence(this$static){
  checkState_2(this$static.sequenceType.arrayList.size_0 != 0 && $peek_1(this$static.sequenceType) === ($clinit_784() , DIRECT), 'end undoable sequence without begin');
  $pop(this$static.sequenceType);
}

function ResponsibilityManagerImpl_0(){
  this.sequenceType = new Stack_0;
}

function ResponsibilityManagerImpl(){
}

_ = ResponsibilityManagerImpl_0.prototype = ResponsibilityManagerImpl.prototype = new Object_0;
_.getClass$ = function getClass_485(){
  return Lorg_waveprotocol_wave_client_editor_ResponsibilityManagerImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_784(){
  $clinit_784 = nullMethod;
  DIRECT = new ResponsibilityManagerImpl$SequenceType_0('DIRECT', 0);
  INDIRECT = new ResponsibilityManagerImpl$SequenceType_0('INDIRECT', 1);
  $VALUES_20 = initValues(_3Lorg_waveprotocol_wave_client_editor_ResponsibilityManagerImpl$SequenceType_2_classLit, {9:1, 68:1, 170:1}, 97, [DIRECT, INDIRECT]);
}

function ResponsibilityManagerImpl$SequenceType_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_27(name_0){
  $clinit_784();
  return valueOf_0(($clinit_785() , $MAP_20), name_0);
}

function values_21(){
  $clinit_784();
  return $VALUES_20;
}

function ResponsibilityManagerImpl$SequenceType(){
}

_ = ResponsibilityManagerImpl$SequenceType_0.prototype = ResponsibilityManagerImpl$SequenceType.prototype = new Enum;
_.getClass$ = function getClass_486(){
  return Lorg_waveprotocol_wave_client_editor_ResponsibilityManagerImpl$SequenceType_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 97:1};
var $VALUES_20, DIRECT, INDIRECT;
function $clinit_785(){
  $clinit_785 = nullMethod;
  $MAP_20 = createValueOfMap(($clinit_784() , $VALUES_20));
}

var $MAP_20;
function $contains_7(this$static, doc, node){
  var fromIncl, toExcl;
  fromIncl = this$static.nodeBefore == null?$getFirstChild_4(doc, this$static.after.container):$getNextSibling_3(doc, this$static.nodeBefore);
  toExcl = $getNodeAfter(this$static.after);
  return isBetween(doc, node, fromIncl, toExcl);
}

function $getPointBefore(this$static, doc){
  return new Point$El_0(this$static.after.container, this$static.nodeBefore == null?$getFirstChild_4(doc, this$static.after.container):$getNextSibling_3(doc, this$static.nodeBefore));
}

function $getStartNode(this$static, doc){
  var firstNode;
  firstNode = this$static.nodeBefore == null?$getFirstChild_4(doc, this$static.after.container):$getNextSibling_3(doc, this$static.nodeBefore);
  return firstNode;
}

function isBetween(doc, node, fromIncl, toExcl){
  var n;
  for (n = fromIncl; n != null && (n == null?null:n) !== (toExcl == null?null:toExcl); n = $getNextSibling_3(doc, n)) {
    if ((n == null?null:n) === (node == null?null:node)) {
      return true;
    }
  }
  return false;
}

function UndoableSequencer_0(chainedSequencer, responsibility){
  this.responsibility = responsibility;
  this.sequencer = chainedSequencer;
}

function UndoableSequencer(){
}

_ = UndoableSequencer_0.prototype = UndoableSequencer.prototype = new Object_0;
_.begin = function begin_1(){
  $push_2(this.responsibility.sequenceType, ($clinit_784() , DIRECT));
}
;
_.consume_0 = function consume_3(op){
  $consumeAndReturnInvertible_0(this.sequencer.sink, op);
}
;
_.end_0 = function end_4(){
  $endDirectSequence(this.responsibility);
}
;
_.getClass$ = function getClass_488(){
  return Lorg_waveprotocol_wave_client_editor_UndoableSequencer_2_classLit;
}
;
_.castableTypeMap$ = {};
_.responsibility = null;
_.sequencer = null;
function $clinit_788(){
  $clinit_788 = nullMethod;
  HANDLED_EVENTS = initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['click', 'dblclick', 'mousedown', 'contextmenu', 'keypress', 'keydown', 'keyup', 'compositionstart', 'compositionend', 'compositionupdate', 'text', 'textInput', 'DOMSubtreeModified', 'DOMNodeInserted', 'DOMNodeRemoved', 'DOMNodeRemovedFromDocument', 'DOMNodeInsertedIntoDocument', 'DOMAttrModified', 'DOMCharacterDataModified', 'DOMElementNameChanged', 'DOMAttributeNameChanged', 'DOMMouseScroll', 'change', 'submit', 'reset', 'domfocusin', 'domfocusout', 'domactivate', 'cut', 'copy', 'paste', 'beforecut', 'beforecopy', 'beforepaste', 'afterupdate', 'beforeupdate', 'cellchange', 'dataavailable', 'datasetchanged', 'datasetcomplete', 'errorupdate', 'rowenter', 'rowexit', 'rowsdelete', 'rowinserted']);
}

var HANDLED_EVENTS;
function $clinit_789(){
  $clinit_789 = nullMethod;
  logger_3 = new DomLogger_0('editor-node');
}

function $compareTo_7(this$static, other){
  var ancestors, mine, minePrev, nca, search, theirs, theirsPrev;
  if (!$isContentAttached(this$static) || !$isContentAttached(other)) {
    throw new IllegalArgumentException_1('Cannot compare unattached nodes');
  }
  ancestors = new HashMap_0;
  minePrev = null;
  theirsPrev = null;
  mine = this$static;
  theirs = other;
  if (this$static == other || this$static == other) {
    return 0;
  }
  if (this$static != null && this$static.castableTypeMap$ && !!this$static.castableTypeMap$[225]) {
    minePrev = this$static;
    mine = this$static.parent_0;
  }
  if (other != null && other.castableTypeMap$ && !!other.castableTypeMap$[225]) {
    theirsPrev = other;
    theirs = other.parent_0;
  }
  while (mine) {
    ancestors.put(mine, minePrev);
    minePrev = mine;
    mine = mine.parent_0;
  }
  nca = theirs;
  while (!ancestors.containsKey(nca)) {
    theirsPrev = nca;
    nca = nca.parent_0;
  }
  minePrev = dynamicCast(ancestors.get(nca), 197);
  if (!minePrev) {
    return -1;
  }
  if (!theirsPrev) {
    return 1;
  }
  for (search = minePrev; search; search = search.prev) {
    if (search == theirsPrev) {
      return 1;
    }
  }
  return -1;
}

function $getImplNodeletRightwards(this$static){
  var node, nodelet, renderedContent;
  node = this$static;
  nodelet = null;
  renderedContent = this$static.context.this$0.renderingConcerns.this$0.renderedContentView;
  while (node) {
    nodelet = node.getImplNodelet();
    if (nodelet) {
      break;
    }
    node = dynamicCast($getNextSibling_3(renderedContent, node), 197);
  }
  return nodelet;
}

function $implInsertBefore(this$static, parent_0, from, to, refChild, oldContainerNodelet){
  var $e0, e;
  try {
    staticImplInsertBefore(parent_0, from, to, refChild, oldContainerNodelet);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 21)) {
      e = $e0;
      $printStackTrace(e);
      $log_0(logger_3.errorLogger, e + ' Scheduling revert.');
      $clinit_1197();
      $schedule_2(scheduler_0, ($clinit_1200() , LOW), new ContentNode$1_0(this$static));
    }
     else 
      throw $e0;
  }
}

function $isContentAttached(this$static){
  var e, root;
  e = this$static.isTextNode()?this$static.parent_0:dynamicCast(this$static, 196);
  root = dynamicCast(this$static.context.this$0.mutableContent.doc.substrate.getDocumentElement(), 196);
  while (e != root) {
    if (!e) {
      return false;
    }
    e = e.parent_0;
  }
  return true;
}

function $isOrIsAncestorOf(this$static, other){
  while (other) {
    if (this$static == other) {
      return true;
    }
    other = other.parent_0;
  }
  return false;
}

function $isRendered(this$static){
  return !!this$static.getImplNodelet() || this$static.isTextNode() && $isRendered(this$static.parent_0);
}

function $notifyAddedToParent(this$static, oldParent){
  var $e0, e, parent_0;
  try {
    this$static.onAddedToParent_0(oldParent);
    parent_0 = this$static.parent_0;
    parent_0.onChildAdded_0(this$static);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 21)) {
      e = $e0;
      $log_0(logger_3.errorLogger, 'noteErrorOnMutationEvent: ' + e);
    }
     else 
      throw $e0;
  }
}

function $notifyRemovedFromParent(this$static, oldParent, newParent){
  var $e0, e;
  try {
    this$static.onRemovedFromParent_0(newParent);
    oldParent.onChildRemoved_0(this$static);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 21)) {
      e = $e0;
      $log_0(logger_3.errorLogger, 'noteErrorOnMutationEvent: ' + e);
    }
     else 
      throw $e0;
  }
}

function $toString_17(this$static){
  var $e0, contentString, name_0, nodeletString;
  name_0 = this$static.getClass$().typeName;
  name_0 = $substring(name_0, name_0.lastIndexOf(fromCodePoint(46)) + 1);
  nodeletString = 'destroyed';
  try {
    nodeletString = !this$static.getImplNodelet()?'null':$print_0(new Pretty_0, this$static.context.this$0.renderingConcerns.this$0.rawHtmlView, this$static.getImplNodelet());
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (!instanceOf($e0, 39))
      throw $e0;
  }
  contentString = $print_0(new Pretty_0, ($clinit_853() , INSTANCE_6), this$static);
  return name_0 + ': ' + contentString + ' / ' + nodeletString;
}

function staticImplInsertBefore(parent_0, from, toExcl, refChild, oldContainerNodelet){
  var containerNodelet, implRef, node, nodelet, parent_1;
  checkArgument_2(!toExcl || toExcl.parent_0 == from.parent_0, 'invalid toExcl');
  containerNodelet = parent_0.containerNodelet;
  if (containerNodelet) {
    implRef = null;
    for (node = refChild; node; node = node.next) {
      if (node.getImplNodelet()) {
        checkState_2(!!(parent_1 = node.getImplNodelet().parentNode , (!parent_1 || parent_1.nodeType != 1) && (parent_1 = null) , parent_1), 'implNodelet not attached');
        implRef = node.getImplNodelet();
        break;
      }
    }
    if (implRef) {
      containerNodelet = $getParentElement(implRef);
      if (!containerNodelet) {
        return;
      }
    }
    for (node = from; node != toExcl; node = node.next) {
      node.isTextNode() && $normaliseImpl(dynamicCast(node, 225));
      nodelet = node.getImplNodelet();
      !!nodelet && containerNodelet.insertBefore(nodelet, implRef);
    }
  }
   else {
    if (oldContainerNodelet) {
      for (node = from; node != toExcl; node = node.next) {
        nodelet = node.getImplNodelet();
        !!nodelet && $removeFromParent(nodelet);
      }
    }
  }
}

function ContentNode(){
}

_ = ContentNode.prototype = new Object_0;
_.breakBackRef = function breakBackRef(recurse){
}
;
_.compareTo$ = function compareTo_8(other){
  return $compareTo_7(this, dynamicCast(other, 197));
}
;
_.getClass$ = function getClass_489(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentNode_2_classLit;
}
;
_.getFirstChild = function getFirstChild(){
  return null;
}
;
_.getImplNodelet = function getImplNodelet(){
  return this.implNodelet;
}
;
_.getLastChild = function getLastChild(){
  return null;
}
;
_.normaliseImpl = function normaliseImpl(){
  return this.getImplNodelet();
}
;
_.onAddedToParent_0 = function onAddedToParent_0(previousParent){
}
;
_.onAttributeModified_0 = function onAttributeModified_0(name_0, oldValue, newValue){
}
;
_.onChildAdded_0 = function onChildAdded_0(child){
}
;
_.onChildRemoved_0 = function onChildRemoved_0(child){
}
;
_.onDescendantsMutated_0 = function onDescendantsMutated_0(){
}
;
_.onEmptied_0 = function onEmptied_0(){
}
;
_.onRemovedFromParent_0 = function onRemovedFromParent_0(newParent){
}
;
_.setImplNodelet = function setImplNodelet(nodelet){
  this.implNodelet = nodelet;
}
;
_.toString$ = function toString_53(){
  return $toString_17(this);
}
;
_.castableTypeMap$ = {10:1, 185:1, 197:1, 376:1};
_.context = null;
_.implNodelet = null;
_.indexingContainer = null;
_.next = null;
_.parent_0 = null;
_.prev = null;
var logger_3;
function $clinit_790(){
  $clinit_790 = nullMethod;
  $clinit_789();
  COMPLEX_IMPLEMENTATION_MARKER = ($clinit_1033() , $clinit_1033() , ++markerIndex , '_x' + markerIndex);
  ELEMENT_MANAGER = new ContentElement$1_0;
}

function $init_3(this$static, attributes){
  var entry, entry$iterator;
  for (entry$iterator = attributes.entrySet_0().iterator_0(); entry$iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.next_0(), 11);
    this$static.attributes.put_3(dynamicCast(entry.getKey(), 1), dynamicCast(entry.getValue(), 1));
  }
}

function $insertBefore_1(this$static, newChild, refChild, affectImpl){
  return $insertBefore_2(this$static, newChild, newChild.next, refChild, affectImpl, null);
}

function $insertBefore_2(this$static, fromIncl, toExcl, refChild, affectImpl, factory){
  var movedNodes, newChild, next, node, node$iterator, oldContainerNodelet, oldParent, prev;
  if (fromIncl == toExcl) {
    return fromIncl;
  }
  if (!!refChild && refChild.parent_0 != this$static) {
    throw new IllegalArgumentException_1('insertBefore: refChild is not child of parent');
  }
  if ($isOrIsAncestorOf(fromIncl, this$static)) {
    throw new IllegalArgumentException_1('insertBefore: fromIncl is or is an ancestor of parent!');
  }
  if (!!toExcl && toExcl.parent_0 != fromIncl.parent_0) {
    throw new IllegalArgumentException_1('insertBefore: toExcl does not have the same parent as fromIncl!');
  }
  oldParent = fromIncl.parent_0;
  oldContainerNodelet = oldParent?oldParent.containerNodelet:null;
  newChild = fromIncl;
  if (!refChild) {
    prev = this$static.lastChild_0;
    this$static.lastChild_0 = fromIncl;
  }
   else {
    prev = refChild.prev;
    refChild.prev = fromIncl;
  }
  movedNodes = new ArrayList_0;
  while (true) {
    setCheck(movedNodes.array, movedNodes.size_0++, newChild);
    next = newChild.next;
    !newChild.prev?!!newChild.parent_0 && (newChild.parent_0.firstChild_0 = newChild.next , undefined):(newChild.prev.next = newChild.next);
    !newChild.next?!!newChild.parent_0 && (newChild.parent_0.lastChild_0 = newChild.prev , undefined):(newChild.next.prev = newChild.prev);
    !prev?(this$static.firstChild_0 = newChild):(prev.next = newChild);
    newChild.next = refChild;
    newChild.prev = prev;
    newChild.parent_0 = this$static;
    prev = newChild;
    if (next == toExcl) {
      !refChild?(this$static.lastChild_0 = newChild):(refChild.prev = newChild);
      break;
    }
    newChild = next;
  }
  !!factory && ($setupBehaviour(factory.this$0, fromIncl.asElement(), null) , undefined);
  affectImpl && $implInsertBefore(this$static, this$static, fromIncl, prev.next, refChild, oldContainerNodelet);
  if (oldParent) {
    $notifyChildrenMutated(oldParent);
    for (node$iterator = new AbstractList$IteratorImpl_0(movedNodes); node$iterator.i < node$iterator.this$0_0.size_1();) {
      node = dynamicCast($next_4(node$iterator), 197);
      $notifyRemovedFromParent(node, oldParent, this$static);
    }
  }
  for (node$iterator = new AbstractList$IteratorImpl_0(movedNodes); node$iterator.i < node$iterator.this$0_0.size_1();) {
    node = dynamicCast($next_4(node$iterator), 197);
    $notifyAddedToParent(node, oldParent);
  }
  $notifyChildrenMutated(this$static);
  return fromIncl;
}

function $notifyAttributeModified(this$static, name_0, oldValue, newValue){
  var $e0, e;
  try {
    this$static.onAttributeModified_0(name_0, oldValue, newValue);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 21)) {
      e = $e0;
      $log_0(($clinit_789() , logger_3).errorLogger, 'noteErrorOnMutationEvent: ' + e);
    }
     else 
      throw $e0;
  }
  !!this$static.parent_0 && $notifyChildrenMutated(this$static.parent_0);
}

function $notifyChildrenMutated(this$static){
  var $e0, e, element;
  element = this$static;
  while (element) {
    try {
      element.onDescendantsMutated_0();
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 21)) {
        e = $e0;
        $log_0(($clinit_789() , logger_3).errorLogger, 'noteErrorOnMutationEvent: ' + e);
      }
       else 
        throw $e0;
    }
    element = element.parent_0;
  }
}

function $notifyEmptied(this$static){
  var $e0, e;
  try {
    this$static.onEmptied_0();
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 21)) {
      e = $e0;
      $log_0(($clinit_789() , logger_3).errorLogger, 'noteErrorOnMutationEvent: ' + e);
    }
     else 
      throw $e0;
  }
}

function $reattachImplChildren(this$static){
  var container, node, renderedContent, find_0;
  renderedContent = this$static.context.this$0.renderingConcerns.this$0.renderedContentView;
  container = this$static.containerNodelet;
  if (container) {
    while (container.firstChild) {
      $removeFromParent(container.firstChild);
    }
    for (node = dynamicCast((find_0 = renderedContent.inner_0.getFirstChild_0(this$static) , $getNextVisibleNodeDepthFirst(renderedContent, find_0, this$static)), 197); node; node = dynamicCast($getNextSibling_3(renderedContent, node), 197)) {
      container.appendChild(node.getImplNodelet());
    }
  }
   else {
    $log_0(($clinit_761() , logger_1).errorLogger, 'You need to override this method for your doodad: ' + this$static.tagName_0);
  }
}

function $removeChild_2(this$static, oldChild, affectImpl){
  $removeChildren(this$static, oldChild, oldChild.next, affectImpl);
}

function $removeChildren(this$static, fromIncl, toExcl, affectImpl){
  if (fromIncl.parent_0 != this$static) {
    throw new IllegalArgumentException_1('removeChild: fromIncl is not child of parent');
  }
  if (!!toExcl && toExcl.parent_0 != this$static) {
    throw new IllegalArgumentException_1('removeChild: toExcl is not child of parent');
  }
  $removeChildrenInner(this$static, fromIncl, toExcl, affectImpl);
  $notifyChildrenMutated(this$static);
  !this$static.firstChild_0 && $notifyEmptied(this$static);
}

function $removeChildrenInner(this$static, fromIncl, toExcl, affectImpl){
  var node, node$iterator, nodeFirstChild, nodelet, oldChild, removedNodes;
  removedNodes = new ArrayList_0;
  for (node = fromIncl; node != toExcl;) {
    nodeFirstChild = node.getFirstChild();
    !!nodeFirstChild && $removeChildrenInner(node.asElement(), nodeFirstChild, null, affectImpl);
    oldChild = node;
    node = node.next;
    if (affectImpl) {
      nodelet = oldChild.normaliseImpl();
      !!nodelet && $removeFromParent(nodelet);
    }
    setCheck(removedNodes.array, removedNodes.size_0++, oldChild);
    !oldChild.prev?!!oldChild.parent_0 && (oldChild.parent_0.firstChild_0 = oldChild.next , undefined):(oldChild.prev.next = oldChild.next);
    !oldChild.next?!!oldChild.parent_0 && (oldChild.parent_0.lastChild_0 = oldChild.prev , undefined):(oldChild.next.prev = oldChild.prev);
    oldChild.prev = oldChild.next = oldChild.parent_0 = null;
    oldChild.breakBackRef(true);
  }
  for (node$iterator = new AbstractList$IteratorImpl_0(removedNodes); node$iterator.i < node$iterator.this$0_0.size_1();) {
    node = dynamicCast($next_4(node$iterator), 197);
    $notifyRemovedFromParent(node, this$static, null);
  }
}

function $setAutoAppendContainer(this$static, containerNodelet){
  $setContainerNodelet(this$static, containerNodelet);
  return containerNodelet;
}

function $setContainerNodelet(this$static, newNodelet){
  var implNodelet, node;
  if (newNodelet == this$static.containerNodelet) {
    return;
  }
  if (newNodelet) {
    emptyElement(newNodelet);
    for (node = this$static.firstChild_0; node; node = node.next) {
      node.isTextNode() && node.normaliseImpl();
      implNodelet = node.getImplNodelet();
      !!implNodelet && newNodelet.appendChild(implNodelet);
    }
  }
  $swapNodelet(this$static, this$static.containerNodelet == this$static.implNodelet?null:this$static.containerNodelet, newNodelet);
  this$static.containerNodelet = newNodelet;
}

function $setImplNodelets(this$static, domImplNodelet, containerNodelet){
  $swapNodelet(this$static, this$static.implNodelet, domImplNodelet);
  this$static.implNodelet = domImplNodelet;
  $setContainerNodelet(this$static, containerNodelet);
  if (domImplNodelet) {
    walkImpl(domImplNodelet);
    if (containerNodelet != domImplNodelet) {
      domImplNodelet.style['white-space'] = 'normal';
      if (containerNodelet) {
        domImplNodelet.style['white-space'] = 'prewrap';
        containerNodelet.innerHTML = '';
      }
    }
  }
}

function $swapNodelet(this$static, oldNodelet, newNodelet){
  !!oldNodelet && ($clinit_1033() , oldNodelet[BACKREF_NAME] = null , undefined);
  !!newNodelet && ($clinit_1033() , newNodelet[BACKREF_NAME] = this$static , undefined);
}

function $zipChildrenExcludingFrom(this$static, from, to, notifyIfSplit){
  var filteredHtml, left, node, nodelet, nodeletData, renderedContent, ret, target, txt, find_0;
  $clinit_761();
  ++ignoreMutations;
  try {
    ret = false;
    renderedContent = this$static.context.this$0.renderingConcerns.this$0.renderedContentView;
    filteredHtml = this$static.context.this$0.renderingConcerns.this$0.filteredHtmlView;
    node = from;
    if (!from) {
      node = dynamicCast((find_0 = renderedContent.inner_0.getFirstChild_0(this$static) , $getNextVisibleNodeDepthFirst(renderedContent, find_0, this$static)), 197);
      nodelet = dynamicCastJso($getFirstChild_4(filteredHtml, this$static.implNodelet));
    }
     else {
      nodelet = from.getImplNodelet();
    }
    while (node) {
      node.getImplNodelet() != nodelet && node.setImplNodelet(nodelet);
      if (nodelet.nodeType == 3) {
        target = dynamicCast(node, 225).data_0;
        txt = nodelet.data;
        nodeletData = txt;
        left = target.length - txt.length;
        while (left > 0) {
          nodelet = dynamicCastJso($getNextSibling_3(filteredHtml, nodelet));
          nodeletData = nodelet.data;
          txt += nodeletData;
          left -= nodeletData.length;
        }
        if (left < 0) {
          nodelet == notifyIfSplit && (ret = true);
          nodelet.splitText(nodeletData.length + left);
        }
      }
      nodelet = dynamicCastJso($getNextSibling_3(filteredHtml, nodelet));
      node = dynamicCast($getNextSibling_3(renderedContent, node), 197);
      if (node == to) {
        break;
      }
    }
    !!node && node.isTextNode() && node.setImplNodelet(nodelet);
    return ret;
  }
   finally {
    --ignoreMutations;
  }
}

function walkImpl(element){
  var e, n;
  for (n = element.firstChild; n;) {
    if (n.nodeType == 3) {
      n = n.nextSibling;
    }
     else {
      e = n;
      ($clinit_1033() , (e[TRANSPARENCY] || null) != null) || (e[COMPLEX_IMPLEMENTATION_MARKER] = true , undefined);
      walkImpl(e);
      n = n.nextSibling;
    }
  }
}

function ContentElement(){
}

_ = ContentElement.prototype = new ContentNode;
_.asElement = function asElement_0(){
  return this;
}
;
_.asText = function asText_0(){
  return null;
}
;
_.breakBackRef = function breakBackRef_0(recurse){
  var n;
  $swapNodelet(this, this.implNodelet, null);
  $swapNodelet(this, this.containerNodelet, null);
  if (recurse) {
    for (n = this.firstChild_0; n; n = n.next) {
      n.breakBackRef(true);
    }
  }
}
;
_.getClass$ = function getClass_490(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentElement_2_classLit;
}
;
_.getFirstChild = function getFirstChild_0(){
  return this.firstChild_0;
}
;
_.getImplNodelet = function getImplNodelet_0(){
  return this.implNodelet;
}
;
_.getLastChild = function getLastChild_0(){
  return this.lastChild_0;
}
;
_.getNodeType = function getNodeType(){
  return 1;
}
;
_.isConsistent_0 = function isConsistent_0(){
  var nodelet;
  return !this.implNodelet || (nodelet = this.getImplNodelet() , !!nodelet && !!$getParentElement(nodelet));
}
;
_.isElement = function isElement(){
  return true;
}
;
_.isTextNode = function isTextNode(){
  return false;
}
;
_.onRepair = function onRepair(){
}
;
_.revertImplementation = function revertImplementation(){
  var node, renderedContent, find_0;
  $clinit_761();
  ++ignoreMutations;
  try {
    renderedContent = this.context.this$0.renderingConcerns.this$0.renderedContentView;
    for (node = dynamicCast((find_0 = renderedContent.inner_0.getFirstChild_0(this) , $getNextVisibleNodeDepthFirst(renderedContent, find_0, this)), 197); node; node = dynamicCast($getNextSibling_3(renderedContent, node), 197)) {
      node.revertImplementation();
    }
    $reattachImplChildren(this);
    this.onRepair();
  }
   finally {
    --ignoreMutations;
  }
}
;
_.setImplNodelet = function setImplNodelet_0(nodelet){
  var element;
  checkNotNull_1(nodelet, 'Null nodelet not supported with this deprecated method, use setImplNodelets instead');
  checkState_2(!this.containerNodelet || this.containerNodelet == this.implNodelet, 'Cannot set only the impl nodelet if the container nodelet is different');
  checkArgument_2(nodelet.nodeType != 3, 'element cannot have text implnodelet');
  element = nodelet;
  !!this.containerNodelet && $setContainerNodelet(this, element);
  $swapNodelet(this, this.implNodelet, element);
  this.implNodelet = element;
}
;
_.castableTypeMap$ = {10:1, 185:1, 196:1, 197:1, 260:1, 376:1};
_.containerNodelet = null;
_.firstChild_0 = null;
_.lastChild_0 = null;
_.tagName_0 = null;
var COMPLEX_IMPLEMENTATION_MARKER, ELEMENT_MANAGER;
function $clinit_791(){
  $clinit_791 = nullMethod;
  $clinit_790();
  css_1 = ($clinit_795() , $clinit_795() , css_2);
  !!css_1 && ($clinit_103() , $push_1(toInject, ($clinit_211() , '.C-AH-org-waveprotocol-wave-client-editor-content-AgentAdapter-Css-unknown {\n  display : inline-block;\n  border : 1px solid gray;\n  background : silver;\n  font-weight : bold;\n  padding-left : 1em;\n  padding-right : 1em;\n}\n')) , flush() , undefined);
  defaultMutationHandler = new NodeMutationHandlerImpl_0;
  defaultEventHandler = ($clinit_776() , $clinit_776() , INSTANCE_5);
  defaultRenderer = new AgentAdapter$1_0;
  noRenderer = new AgentAdapter$2_0;
}

function $setLogicalParent(this$static, parent_0){
  instanceOf(this$static.renderer, 217) && $setLogicalPanel((dynamicCast(this$static.renderer, 217) , this$static), parent_0);
}

function $setNodeEventHandler(this$static, newHandler){
  newHandler = dynamicCast(valueOrDefault(newHandler, defaultEventHandler), 216);
  if (this$static.nodeEventHandler == newHandler) {
    return;
  }
  this$static.nodeEventHandler.onDeactivated(this$static);
  this$static.nodeEventHandler = newHandler;
  this$static.nodeEventHandler.onActivated(this$static);
}

function $setNodeMutationHandler(this$static, handler){
  handler = dynamicCast(valueOrDefault(handler, defaultMutationHandler), 215);
  if (this$static.nodeMutationHandler == handler) {
    return;
  }
  this$static.nodeMutationHandler.onDeactivated_0(this$static);
  this$static.nodeMutationHandler = handler;
  this$static.nodeMutationHandler.onActivationStart(this$static);
}

function $setRenderer(this$static, renderer){
  var oldNodelet;
  checkNotNull_0(renderer, 'Null renderer');
  if (this$static.renderer == renderer) {
    return;
  }
  this$static.renderer = renderer;
  oldNodelet = this$static.implNodelet;
  $setContainerNodelet(this$static, null);
  $setImplNodelets(this$static, renderer.createDomImpl(this$static), this$static.containerNodelet);
  !!oldNodelet && $removeFromParent(oldNodelet);
}

function AgentAdapter_0(tagName, attributes, bundle, registry){
  $clinit_791();
  this.context = bundle;
  this.implNodelet = null;
  this.attributes = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  this.transientData = defaultCollectionFactory.createIntMap();
  this.tagName_0 = tagName;
  this.nodeEventHandler = defaultEventHandler;
  this.nodeMutationHandler = defaultMutationHandler;
  this.renderer = noRenderer;
  this.element = this;
  this.registry = registry;
  $init_3(this, attributes);
}

function AgentAdapter(){
}

_ = AgentAdapter_0.prototype = AgentAdapter.prototype = new ContentElement;
_.getClass$ = function getClass_491(){
  return Lorg_waveprotocol_wave_client_editor_content_AgentAdapter_2_classLit;
}
;
_.onAddedToParent_0 = function onAddedToParent_1(oldParent){
  this.nodeMutationHandler.onAddedToParent(this.element, oldParent);
}
;
_.onAttributeModified_0 = function onAttributeModified_1(name_0, oldValue, newValue){
  this.nodeMutationHandler.onAttributeModified(this.element, name_0, oldValue, newValue);
}
;
_.onChildAdded_0 = function onChildAdded_1(child){
  this.nodeMutationHandler.onChildAdded(this.element, child);
}
;
_.onChildRemoved_0 = function onChildRemoved_1(child){
  this.nodeMutationHandler.onChildRemoved(this.element, child);
}
;
_.onDescendantsMutated_0 = function onDescendantsMutated_1(){
  this.nodeMutationHandler.onDescendantsMutated(this.element);
}
;
_.onEmptied_0 = function onEmptied_1(){
  this.nodeMutationHandler.onEmptied(this.element);
}
;
_.onRemovedFromParent_0 = function onRemovedFromParent_1(newParent){
  this.nodeMutationHandler.onRemovedFromParent(this.element, newParent);
  if (!newParent) {
    this.nodeEventHandler.onDeactivated(this);
    this.nodeMutationHandler.onDeactivated_0(this);
    this.renderer = null;
    this.nodeMutationHandler = null;
    this.nodeEventHandler = null;
  }
}
;
_.onRepair = function onRepair_0(){
  this.nodeMutationHandler.onActivationStart(this);
}
;
_.castableTypeMap$ = {10:1, 185:1, 196:1, 197:1, 223:1, 260:1, 376:1};
_.registry = null;
var css_1, defaultEventHandler, defaultMutationHandler, defaultRenderer, noRenderer;
function AgentAdapter$1_0(){
}

function AgentAdapter$1(){
}

_ = AgentAdapter$1_0.prototype = AgentAdapter$1.prototype = new Object_0;
_.createDomImpl = function createDomImpl_1(element){
  var unknown;
  unknown = $doc.createElement('div');
  unknown.className = ($clinit_791() , 'C-AH-org-waveprotocol-wave-client-editor-content-AgentAdapter-Css-unknown');
  unknown.textContent = '<' + element.tagName_0 + '>' || '';
  unknown.style['-webkit-user-modify'] = 'read-only';
  return unknown;
}
;
_.getClass$ = function getClass_492(){
  return Lorg_waveprotocol_wave_client_editor_content_AgentAdapter$1_2_classLit;
}
;
_.castableTypeMap$ = {212:1};
function AgentAdapter$2_0(){
}

function AgentAdapter$2(){
}

_ = AgentAdapter$2_0.prototype = AgentAdapter$2.prototype = new Object_0;
_.createDomImpl = function createDomImpl_2(element){
  return null;
}
;
_.getClass$ = function getClass_493(){
  return Lorg_waveprotocol_wave_client_editor_content_AgentAdapter$2_2_classLit;
}
;
_.castableTypeMap$ = {212:1};
function $clinit_795(){
  $clinit_795 = nullMethod;
  css_2 = new AgentAdapter_Resources_en_InlineClientBundleGenerator$1_0;
}

var css_2 = null;
function AgentAdapter_Resources_en_InlineClientBundleGenerator$1_0(){
}

function AgentAdapter_Resources_en_InlineClientBundleGenerator$1(){
}

_ = AgentAdapter_Resources_en_InlineClientBundleGenerator$1_0.prototype = AgentAdapter_Resources_en_InlineClientBundleGenerator$1.prototype = new Object_0;
_.getClass$ = function getClass_494(){
  return Lorg_waveprotocol_wave_client_editor_content_AgentAdapter_1Resources_1en_1InlineClientBundleGenerator$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_797(){
  $clinit_797 = nullMethod;
  DOCUMENT_MODE = new Property$ImmutableProperty_0('doc_mode');
  PAINTER_PROP = new Property$MutableProperty_0('annotation-painter');
  REPAINT_KEY = '@' + prefixIncrementor++ + '/paint';
  DOC_PAINTER_PROP = new Property$MutableProperty_0('doc-annotation-painter');
  maybeScheduledPainters = new ConcurrentSet_0;
}

function $scheduleRepaint(this$static, bundle, start, end){
  var docPainter, size, docElement;
  docElement = bundle.this$0.mutableContent.doc.substrate.getDocumentElement();
  $setProperty_1(($clinit_790() , PAINTER_PROP), docElement, this$static);
  size = $size_15(bundle.this$0.mutableContent.doc);
  end = size < end + 3?size:end + 3;
  start = 0 > start - 3?0:start - 3;
  start == end && (start == 0?end < size && ++end:--start);
  $setAnnotation_0(bundle.this$0.localAnnotations, start, end, REPAINT_KEY, 'y');
  docPainter = getDocPainter(bundle);
  $schedule_6(this$static.scheduler, docPainter.task);
  $add_13(maybeScheduledPainters.set, docPainter);
}

function AnnotationPainter_0(scheduler){
  $clinit_797();
  this.scheduler = scheduler;
}

function clearDocPainter(bundle){
  $clinit_797();
  var existing;
  existing = dynamicCast($getProperty_2(($clinit_790() , DOC_PAINTER_PROP), dynamicCast(bundle.this$0.mutableContent.doc.substrate.getDocumentElement(), 196)), 219);
  !!existing && (existing.dead = true);
}

function createAndSetDocPainter(bundle, painterRegistry){
  $clinit_797();
  var docElement, docPainter, existing;
  docElement = bundle.this$0.mutableContent.doc.substrate.getDocumentElement();
  existing = dynamicCast($getProperty_2(($clinit_790() , DOC_PAINTER_PROP), dynamicCast(docElement, 196)), 219);
  !!existing && (existing.dead = true);
  docPainter = new AnnotationPainter$DocPainter_0(bundle, painterRegistry);
  $setProperty_1(DOC_PAINTER_PROP, docElement, docPainter);
}

function flush_0(painter){
  $clinit_797();
  while ($doRun(painter, 2000)) {
  }
}

function getDocPainter(bundle){
  $clinit_797();
  var docElement, docPainter;
  docElement = bundle.this$0.mutableContent.doc.substrate.getDocumentElement();
  docPainter = dynamicCast($getProperty_2(($clinit_790() , DOC_PAINTER_PROP), dynamicCast(docElement, 196)), 219);
  if (!docPainter) {
    docPainter = new AnnotationPainter$DocPainter_0(bundle, ($clinit_729() , ROOT_PAINT_REGISTRY));
    $setProperty_1(DOC_PAINTER_PROP, docElement, docPainter);
  }
  return docPainter;
}

function isEditing_0(doc){
  $clinit_797();
  return $equals_2(($clinit_428() , TRUE_0), doc.getProperty(DOCUMENT_MODE, doc.inner_0.getDocumentElement()));
}

function maybeScheduleRepaint(bundle, start, end){
  $clinit_797();
  var painter;
  painter = dynamicCast($getProperty_2(($clinit_790() , PAINTER_PROP), dynamicCast(bundle.this$0.mutableContent.doc.substrate.getDocumentElement(), 196)), 218);
  !!painter && $scheduleRepaint(painter, bundle, start, end);
}

function AnnotationPainter(){
}

_ = AnnotationPainter_0.prototype = AnnotationPainter.prototype = new Object_0;
_.getClass$ = function getClass_495(){
  return Lorg_waveprotocol_wave_client_editor_content_AnnotationPainter_2_classLit;
}
;
_.castableTypeMap$ = {218:1};
_.scheduler = null;
var DOCUMENT_MODE, DOC_PAINTER_PROP, PAINTER_PROP, REPAINT_KEY, maybeScheduledPainters;
function $computeRenderAttrs(this$static){
  var func, func$iterator, isEditing, outerIter, entry;
  this$static.renderAttrs = new HashMap_0;
  isEditing = isEditing_0(this$static.localDoc);
  for (func$iterator = (outerIter = $keySet_0(dynamicCast($inspect(this$static.paintRegistry.data_0), 220).paintFuncs.map).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter)); func$iterator.val$outerIter.hasNext();) {
    func = dynamicCast((entry = dynamicCast(func$iterator.val$outerIter.next_0(), 11) , entry.getKey()), 221);
    $putAll(this$static.renderAttrs, func.apply_5(this$static.currentValues, isEditing));
  }
}

function $doRun(this$static, maxIterations){
  var allKeys, annotatorEnd, boundaryNodeAfter, boundaryParent, boundaryPoint, chunkEndNode, containingAnnotator, currentLocation, currentNode, docSize, element, first, firstPersistentChild, fromIncl, isAtStartOfTextNode, last, lastBoundaryElement, lastPersistentChild, maybeLocation, next, point, remainingIterations, startNode, textNode, toExcl;
  if (this$static.dead) {
    return false;
  }
  docSize = $size_15(this$static.mapper);
  maybeLocation = $firstAnnotationChange(this$static.localAnnotations.fullAnnotationSet, 0, docSize, ($clinit_797() , REPAINT_KEY), null);
  if (maybeLocation == -1) {
    maybeScheduledPainters.set.map.remove_3(this$static) != null;
    return false;
  }
  point = $locate_0(this$static.mapper, maybeLocation);
  containingAnnotator = $getAnnotatingElement(this$static, point.offset >= 0 || point.nodeAfter == null?point.container:point.nodeAfter);
  if (containingAnnotator != null) {
    first = $getFirstChild_4(this$static.persistentView, containingAnnotator);
    last = $getLastChild_4(this$static.persistentView, containingAnnotator);
    this$static.startLocation = $getLocation_3(this$static.mapper, dynamicCast(first, 197));
    $setAnnotation_0(this$static.localAnnotations, this$static.startLocation, $getLocation_4(this$static.mapper, after_1(this$static.persistentView, last)), REPAINT_KEY, 'y');
    startNode = containingAnnotator;
  }
   else {
    startNode = ensureNodeBoundaryReturnNextNode(point, this$static.localDoc, this$static.textNodeOrganiser);
    this$static.startLocation = maybeLocation;
  }
  currentNode = startNode;
  remainingIterations = maxIterations;
  this$static.endLocation = $getEnd(this$static, this$static.startLocation, docSize, REPAINT_KEY);
  allKeys = dynamicCast($inspect(this$static.paintRegistry.data_0), 220).keys;
  this$static.nextChangingKeys = allKeys;
  this$static.chunkEnd = this$static.startLocation;
  this$static.currentValues = new HashMap_0;
  this$static.cursor = new GenericAnnotationCursor_0(this$static.localAnnotations, this$static.startLocation, this$static.endLocation, allKeys);
  $progress(this$static);
  chunkEndNode = $ensureNodeBoundary(this$static, $locate_0(this$static.mapper, this$static.chunkEnd));
  lastBoundaryElement = null;
  while (true) {
    currentLocation = currentNode == null?docSize:$getLocation_4(this$static.mapper, getFilteredPoint(this$static.persistentView, before_0(this$static.localDoc, currentNode)));
    while (this$static.chunkEnd <= currentLocation && this$static.chunkEnd < this$static.endLocation) {
      boundaryPoint = $locate_0(this$static.mapper, this$static.chunkEnd);
      $progress(this$static);
      chunkEndNode = $ensureNodeBoundary(this$static, $locate_0(this$static.mapper, this$static.chunkEnd));
      if (boundaryPoint.offset >= 0) {
        textNode = this$static.hardView.inner_0.asText_0(boundaryPoint.container);
        isAtStartOfTextNode = $getTextOffset(boundaryPoint) == 0;
        boundaryNodeAfter = $transparentSlice(this$static.localDoc, dynamicCast(isAtStartOfTextNode?textNode:$getNextSibling_3(this$static.hardView, textNode), 197));
        boundaryParent = boundaryNodeAfter != null?this$static.localDoc.inner_0.getParentElement(boundaryNodeAfter):$getParentElement_3(this$static.hardView, textNode);
      }
       else {
        boundaryNodeAfter = $getNodeAfter(boundaryPoint);
        boundaryNodeAfter != null && (boundaryNodeAfter = $transparentSlice(this$static.localDoc, dynamicCast(boundaryNodeAfter, 197)));
        boundaryParent = boundaryNodeAfter != null?this$static.localDoc.inner_0.getParentElement(boundaryNodeAfter):this$static.localDoc.inner_0.asElement_0(boundaryPoint.container);
      }
      lastBoundaryElement = $getBoundaryElement(this$static, boundaryParent, boundaryNodeAfter);
      if (this$static.chunkEnd == currentLocation) {
        break;
      }
    }
    if (currentLocation >= this$static.endLocation || remainingIterations <= 0) {
      $setAnnotation_0(this$static.localAnnotations, this$static.startLocation, currentLocation, REPAINT_KEY, null);
      break;
    }
    element = this$static.localDoc.inner_0.asElement_0(currentNode);
    if (element == null) {
      fromIncl = currentNode;
      toExcl = currentNode;
      while ($asText_1(this$static.localDoc, toExcl = this$static.localDoc.inner_0.getNextSibling(toExcl)) != null) {
        if (this$static.localDoc.inner_0.isSameNode(chunkEndNode, toExcl)) {
          break;
        }
      }
      this$static.renderAttrs.size_1() > 0?(next = getNextOrPrevNodeDepthFirst_1(this$static.localDoc, $wrap_0(this$static, this$static.renderAttrs, fromIncl, toExcl), null, false, true)):(next = toExcl != null?toExcl:$getNextNode(this$static, this$static.localDoc.inner_0.getParentElement(currentNode)));
    }
     else if ($equals_3(this$static.localDoc.inner_0.getTagName(element), this$static.paintRegistry.paintTagName)) {
      firstPersistentChild = $getFirstChild_4(this$static.hardView, element);
      if (firstPersistentChild == null) {
        next = getNextOrPrevNodeDepthFirst_1(this$static.localDoc, element, null, true, true);
        $transparentUnwrap(this$static.localDoc, dynamicCast(element, 196));
      }
       else {
        lastPersistentChild = $getLastChild_4(this$static.hardView, element);
        annotatorEnd = $getLocation_4(this$static.mapper, after_1(this$static.persistentView, lastPersistentChild));
        if (annotatorEnd > this$static.chunkEnd || !$rendersSame(this$static, this$static.renderAttrs, element)) {
          next = getNextOrPrevNodeDepthFirst_1(this$static.localDoc, element, null, true, true);
          $transparentUnwrap(this$static.localDoc, dynamicCast(element, 196));
          $setAnnotation_0(this$static.localAnnotations, currentLocation, annotatorEnd, REPAINT_KEY, 'y');
        }
         else {
          next = getNextOrPrevNodeDepthFirst_1(this$static.localDoc, element, null, false, true);
        }
      }
    }
     else if ($equals_3(this$static.localDoc.inner_0.getTagName(element), this$static.paintRegistry.boundaryTagName)) {
      next = getNextOrPrevNodeDepthFirst_1(this$static.localDoc, element, null, false, true);
      (element == null?null:element) !== (lastBoundaryElement == null?null:lastBoundaryElement) && $transparentDeepRemove(this$static.localDoc, dynamicCast(element, 197));
    }
     else {
      next = getNextOrPrevNodeDepthFirst_1(this$static.localDoc, element, null, true, true);
    }
    currentNode = next;
    --remainingIterations;
  }
  return true;
}

function $ensureNodeBoundary(this$static, point){
  return ensureNodeBoundaryReturnNextNode(point, this$static.localDoc, this$static.textNodeOrganiser);
}

function $getAnnotatingElement(this$static, node){
  var parent_0;
  for (parent_0 = this$static.localDoc.inner_0.getParentElement(node); parent_0 != null; parent_0 = this$static.localDoc.inner_0.getParentElement(parent_0)) {
    if ($equals_3(this$static.localDoc.inner_0.getTagName(parent_0), this$static.paintRegistry.paintTagName)) {
      return parent_0;
    }
  }
  return null;
}

function $getBoundaryElement(this$static, parent_0, nodeAfter){
  var boundaryContainerElement, currentParent, func, func$iterator, isEditing, result, outerIter, entry;
  currentParent = parent_0;
  boundaryContainerElement = null;
  isEditing = isEditing_0(this$static.localDoc);
  for (func$iterator = (outerIter = $keySet_0(dynamicCast($inspect(this$static.paintRegistry.data_0), 220).boundaryFuncs.map).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter)); func$iterator.val$outerIter.hasNext();) {
    func = dynamicCast((entry = dynamicCast(func$iterator.val$outerIter.next_0(), 11) , entry.getKey()), 222);
    result = func.apply_6(this$static.localDoc, currentParent, nodeAfter, this$static.boundaryBefore, this$static.boundaryAfter, isEditing);
    if (!!result && !boundaryContainerElement) {
      boundaryContainerElement = $transparentCreate_0(this$static.localDoc, this$static.paintRegistry.boundaryTagName, ($clinit_480() , $clinit_480() , EMPTY_MAP), currentParent, nodeAfter);
      currentParent = boundaryContainerElement;
      nodeAfter = null;
      $transparentMove_0(this$static.localDoc, boundaryContainerElement, result, this$static.localDoc.inner_0.getNextSibling(result), null);
      $clinit_840();
      $setProperty_1(DEEP_TRANSPARENT, boundaryContainerElement, DEEP_TRANSPARENT_MARKER);
    }
  }
  return boundaryContainerElement;
}

function $getEnd(this$static, start, end, key){
  var ret;
  ret = $firstAnnotationChange(this$static.localAnnotations.fullAnnotationSet, start, end, key, 'y');
  return ret == -1?end:ret;
}

function $getNextNode(this$static, node){
  return getNextOrPrevNodeDepthFirst_1(this$static.localDoc, node, null, false, true);
}

function $progress(this$static){
  var changingKeys, start;
  start = this$static.chunkEnd;
  if (this$static.cursor.locations.heap.size_0 == 0) {
    this$static.chunkEnd = this$static.endLocation;
    changingKeys = null;
  }
   else {
    changingKeys = $nextLocation(this$static.cursor);
    this$static.chunkEnd = this$static.cursor.currentLocation;
  }
  this$static.boundaryBefore = new HashMap_0;
  this$static.boundaryAfter = new HashMap_0;
  this$static.nextChangingKeys.each_3(new AnnotationPainter$DocPainter$2_0(this$static, start));
  this$static.nextChangingKeys = changingKeys;
  $computeRenderAttrs(this$static);
}

function $rendersSame(this$static, attrs, annotatingElement){
  return !!attrs && $equals_4(attrs, this$static.localDoc.inner_0.getAttributes(annotatingElement));
}

function $wrap_0(this$static, attrs, fromIncl, toExcl){
  var el;
  el = $transparentCreate_0(this$static.localDoc, this$static.paintRegistry.paintTagName, attrs, this$static.localDoc.inner_0.getParentElement(fromIncl), fromIncl);
  $transparentMove_0(this$static.localDoc, el, fromIncl, toExcl, null);
  return el;
}

function AnnotationPainter$DocPainter_0(bundle, paintRegistry){
  this.task = new AnnotationPainter$DocPainter$1_0(this);
  this.localDoc = bundle.this$0.fullContentView;
  this.mapper = bundle.this$0.indexedDoc;
  this.textNodeOrganiser = bundle.this$0.indexedDoc;
  this.persistentView = bundle.this$0.persistentContentView;
  this.hardView = bundle.this$0.persistentContentView.hardDoc;
  this.localAnnotations = bundle.this$0.localAnnotations;
  this.paintRegistry = paintRegistry;
}

function AnnotationPainter$DocPainter(){
}

_ = AnnotationPainter$DocPainter_0.prototype = AnnotationPainter$DocPainter.prototype = new Object_0;
_.getClass$ = function getClass_496(){
  return Lorg_waveprotocol_wave_client_editor_content_AnnotationPainter$DocPainter_2_classLit;
}
;
_.castableTypeMap$ = {219:1};
_.boundaryAfter = null;
_.boundaryBefore = null;
_.chunkEnd = 0;
_.currentValues = null;
_.cursor = null;
_.dead = false;
_.endLocation = 0;
_.hardView = null;
_.localAnnotations = null;
_.localDoc = null;
_.mapper = null;
_.nextChangingKeys = null;
_.paintRegistry = null;
_.persistentView = null;
_.renderAttrs = null;
_.startLocation = 0;
_.textNodeOrganiser = null;
function AnnotationPainter$DocPainter$1_0(this$1){
  this.this$1 = this$1;
}

function AnnotationPainter$DocPainter$1(){
}

_ = AnnotationPainter$DocPainter$1_0.prototype = AnnotationPainter$DocPainter$1.prototype = new Object_0;
_.execute = function execute_21(){
  return $doRun(this.this$1, 80);
}
;
_.getClass$ = function getClass_497(){
  return Lorg_waveprotocol_wave_client_editor_content_AnnotationPainter$DocPainter$1_2_classLit;
}
;
_.castableTypeMap$ = {251:1, 253:1};
_.this$1 = null;
function AnnotationPainter$DocPainter$2_0(this$1, val$start){
  this.this$1 = this$1;
  this.val$start = val$start;
}

function AnnotationPainter$DocPainter$2(){
}

_ = AnnotationPainter$DocPainter$2_0.prototype = AnnotationPainter$DocPainter$2.prototype = new Object_0;
_.apply_4 = function apply_26(key){
  var newValue;
  newValue = $getAnnotation(this.this$1.localAnnotations.fullAnnotationSet, this.val$start, key);
  this.this$1.boundaryBefore.put(key, this.this$1.currentValues.get(key));
  this.this$1.boundaryAfter.put(key, newValue);
  newValue == null?this.this$1.currentValues.remove_3(key):this.this$1.currentValues.put(key, newValue);
}
;
_.getClass$ = function getClass_498(){
  return Lorg_waveprotocol_wave_client_editor_content_AnnotationPainter$DocPainter$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
_.val$start = 0;
function $appendXml(this$static, xml){
  return $insertXml(this$static, new Point$El_0(this$static.doc.substrate.getDocumentElement(), null), xml);
}

function $asElement_0(this$static, node){
  return this$static.doc.substrate.asElement_0(node);
}

function $asText(this$static, node){
  return this$static.doc.substrate.asText_0(node);
}

function $at(location_0){
  var b;
  b = new Nindo$Builder_0;
  location_0 > 0 && $add_9(b.mutationList, new Nindo$Skip_0(location_0));
  return b;
}

function $createChildElement(this$static, parent_0, tag, attrs){
  return $createElement_1(this$static, new Point$El_0(parent_0, null), tag, attrs);
}

function $createElement_1(this$static, point, tagName, attributes){
  var location_0, result;
  checkNotNull_1(tagName, 'createElement: tagName must not be null');
  point.offset >= 0?checkOffset(this$static, this$static.doc.substrate.asText_0(point.container), $getTextOffset(point), 'MutableDocumentImpl.createElement'):checkRelationship(this$static, this$static.doc.substrate.asElement_0(point.container), $getNodeAfter(point), 'MutableDocumentImpl.createElement');
  try {
    this$static.sequencer.begin();
    location_0 = this$static.doc.getLocation_0(point);
    this$static.sequencer.consume_0(new Nindo_0($createElement_2(tagName, new AttributesImpl_1(attributes), $at(location_0)).mutationList));
    result = $locate_0(this$static.doc, location_0);
    return $asElement_1(this$static.doc, result.offset >= 0?this$static.doc.substrate.getNextSibling(result.container):$getNodeAfter(result));
  }
   finally {
    this$static.sequencer.end_0();
  }
}

function $createElement_2(tagName, attributes, builder){
  $add_9(builder.mutationList, new Nindo$ElementStart_0(tagName, attributes));
  $add_9(builder.mutationList, ($clinit_1904() , INSTANCE_14));
  return builder;
}

function $deleteElement(this$static, element, builder){
  $add_9(builder.mutationList, ($clinit_1903() , INSTANCE_13));
  $emptyElement_0(this$static, element, builder);
  $add_9(builder.mutationList, ($clinit_1902() , INSTANCE_12));
  return builder;
}

function $deleteNode(this$static, element){
  try {
    this$static.sequencer.begin();
    this$static.sequencer.consume_0(new Nindo_0($deleteElement(this$static, element, $at(this$static.doc.getLocation(element))).mutationList));
  }
   finally {
    this$static.sequencer.end_0();
  }
}

function $emptyElement(this$static, element){
  try {
    this$static.sequencer.begin();
    this$static.sequencer.consume_0(new Nindo_0($emptyElement_0(this$static, element, $at(start_4(this$static.doc, element))).mutationList));
  }
   finally {
    this$static.sequencer.end_0();
  }
}

function $emptyElement_0(this$static, element, builder){
  var elChild, node;
  for (node = this$static.doc.substrate.getFirstChild_0(element); node != null; node = this$static.doc.substrate.getNextSibling(node)) {
    elChild = this$static.doc.substrate.asElement_0(node);
    elChild != null?($add_9(builder.mutationList, ($clinit_1903() , INSTANCE_13)) , $emptyElement_0(this$static, elChild, builder) , $add_9(builder.mutationList, ($clinit_1902() , INSTANCE_12)) , builder):($add_9(builder.mutationList, new Nindo$DeleteCharacters_0($getData_1(this$static.doc, this$static.doc.substrate.asText_0(node)).length)) , undefined);
  }
  return builder;
}

function $firstAnnotationChange_0(this$static, start, end, key, fromValue){
  return $firstAnnotationChange_2(this$static.doc, start, end, key, fromValue);
}

function $getData_0(this$static, textNode){
  return this$static.doc.substrate.getData(textNode);
}

function $getFirstChild_1(this$static, node){
  return this$static.doc.substrate.getFirstChild_0(node);
}

function $getLength_1(this$static, textNode){
  return this$static.doc.substrate.getLength(textNode);
}

function $insertXml(this$static, point, xml){
  var builder, where;
  point.offset >= 0?checkOffset(this$static, this$static.doc.substrate.asText_0(point.container), $getTextOffset(point), 'MutableDocumentImpl.insertXml'):checkRelationship(this$static, this$static.doc.substrate.asElement_0(point.container), $getNodeAfter(point), 'MutableDocumentImpl.insertXml');
  try {
    this$static.sequencer.begin();
    where = this$static.doc.getLocation_0(point);
    builder = $at(where);
    appendXmlToBuilder(xml, builder);
    this$static.sequencer.consume_0(new Nindo_0(builder.mutationList));
    return elementAfter(this$static, $locate_0(this$static.doc, where));
  }
   finally {
    this$static.sequencer.end_0();
  }
}

function $locate(this$static, location_0){
  return $locate_0(this$static.doc, location_0);
}

function $resetAnnotation(this$static, start, end, key, value){
  var b;
  checkPersistentKey(key);
  checkPositionIndexesInRange(start, end, $size_15(this$static.doc));
  try {
    this$static.sequencer.begin();
    b = new Nindo$Builder_0;
    if (start > 0) {
      $add_9(b.mutationList, new Nindo$StartAnnotation_0(key, null));
      $add_9(b.mutationList, new Nindo$Skip_0(start));
    }
    if (start != end) {
      $add_9(b.mutationList, new Nindo$StartAnnotation_0(key, value));
      $add_9(b.mutationList, new Nindo$Skip_0(end - start));
    }
    if ($size_15(this$static.doc) != end) {
      $add_9(b.mutationList, new Nindo$StartAnnotation_0(key, null));
      $add_9(b.mutationList, new Nindo$Skip_0($size_15(this$static.doc) - end));
    }
    $add_9(b.mutationList, new Nindo$EndAnnotation_0(key));
    this$static.sequencer.consume_0(new Nindo_0(b.mutationList));
  }
   finally {
    this$static.sequencer.end_0();
  }
}

function $setAttribute_1(name_0, value, builder){
  var map;
  $add_9(builder.mutationList, new Nindo$UpdateAttributes_0(($clinit_480() , map = new HashMap_1(1) , map.put(name_0, value) , new Collections$UnmodifiableMap_0(map))));
  return builder;
}

function $setAttributes(attrs, builder){
  $add_9(builder.mutationList, new Nindo$ReplaceAttributes_0(attrs));
  return builder;
}

function $setElementAttribute(this$static, element, name_0, value){
  var currentValue;
  currentValue = this$static.doc.substrate.getAttribute_0(element, name_0);
  if (value == null && currentValue == null || value != null && $equals_3(value, currentValue)) {
    return;
  }
  try {
    this$static.sequencer.begin();
    this$static.sequencer.consume_0(new Nindo_0($setAttribute_1(name_0, value, $at(this$static.doc.getLocation(element))).mutationList));
  }
   finally {
    this$static.sequencer.end_0();
  }
}

function $setElementAttributes(this$static, element, attrs){
  checkArgument_2((element == null?null:element) !== maskUndefined(this$static.doc.substrate.getDocumentElement()), 'Cannot touch root element');
  try {
    this$static.sequencer.begin();
    this$static.sequencer.consume_0(new Nindo_0($setAttributes(attrs, $at(this$static.doc.getLocation(element))).mutationList));
  }
   finally {
    this$static.sequencer.end_0();
  }
}

function $toString_18(this$static){
  return 'MutableDI@' + toPowerOfTwoString(!this$static?0:this$static.$H || (this$static.$H = ++sNextHashId)) + '[' + $toDebugString(this$static.doc) + ']';
}

function $with(this$static, actionToRunWithDocument){
  actionToRunWithDocument.exec_0(this$static);
}

function appendXmlToBuilder(xml, builder){
  var $e0, e, parser, xmlString;
  xmlString = xml.builder.impl.string;
  try {
    parser = new StreamingXmlParser_0(xmlString);
    while ($hasMore(parser.buffer) || parser.atSelfClosingStart) {
      $next_19(parser);
      switch ((!parser.current?null:parser.current.type_0).ordinal) {
        case 2:
          $characters(builder, $getText(parser.current));
          break;
        case 0:
          $add_9(builder.mutationList, new Nindo$ElementStart_0($getTagName_5(parser.current), new AttributesImpl_1(($clinit_2309() , copyToJavaMap($getAttributes_4(parser.current), new HashMap_0)))));
          break;
        case 1:
          $add_9(builder.mutationList, ($clinit_1904() , INSTANCE_14));
      }
    }
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 380)) {
      e = $e0;
      throw new IllegalArgumentException_2('Ill-formed xml: ' + xmlString, e);
    }
     else 
      throw $e0;
  }
}

function MutableDocumentImpl(){
}

_ = MutableDocumentImpl.prototype = new Object_0;
_.annotationIntervals = function annotationIntervals_0(start, end, keys){
  return $annotationIntervals_1(this.doc, start, end, keys);
}
;
_.asElement_0 = function asElement_1(node){
  return this.doc.substrate.asElement_0(node);
}
;
_.asText_0 = function asText_1(node){
  return this.doc.substrate.asText_0(node);
}
;
_.createChildElement = function createChildElement(parent_0, tag, attrs){
  return $createElement_1(this, new Point$El_0(parent_0, null), tag, attrs);
}
;
_.createElement_0 = function createElement(point, tagName, attributes){
  return $createElement_1(this, point, tagName, attributes);
}
;
_.deleteNode = function deleteNode(element){
  $deleteNode(this, element);
}
;
_.emptyElement = function emptyElement_0(element){
  $emptyElement(this, element);
}
;
_.firstAnnotationChange = function firstAnnotationChange_0(start, end, key, fromValue){
  return $firstAnnotationChange_2(this.doc, start, end, key, dynamicCast(fromValue, 1));
}
;
_.forEachAnnotationAt = function forEachAnnotationAt_0(location_0, callback){
  this.doc.annotations.forEachAnnotationAt(location_0, new IndexedDocumentImpl$7_0(callback));
}
;
_.getAnnotation = function getAnnotation_0(start, key){
  return $getAnnotation_2(this.doc, start, key);
}
;
_.getAttribute_0 = function getAttribute(element, name_0){
  return this.doc.substrate.getAttribute_0(element, name_0);
}
;
_.getAttributes = function getAttributes(element){
  return this.doc.substrate.getAttributes(element);
}
;
_.getClass$ = function getClass_499(){
  return Lorg_waveprotocol_wave_model_document_MutableDocumentImpl_2_classLit;
}
;
_.getData = function getData(textNode){
  return this.doc.substrate.getData(textNode);
}
;
_.getDocumentElement = function getDocumentElement(){
  return this.doc.substrate.getDocumentElement();
}
;
_.getFirstChild_0 = function getFirstChild_1(node){
  return this.doc.substrate.getFirstChild_0(node);
}
;
_.getLastChild_0 = function getLastChild_1(node){
  return this.doc.substrate.getLastChild_0(node);
}
;
_.getLength = function getLength(textNode){
  return this.doc.substrate.getLength(textNode);
}
;
_.getLocation = function getLocation(node){
  return this.doc.getLocation(node);
}
;
_.getNextSibling = function getNextSibling(node){
  return this.doc.substrate.getNextSibling(node);
}
;
_.getNodeType_0 = function getNodeType_0(node){
  return this.doc.substrate.getNodeType_0(node);
}
;
_.getParentElement = function getParentElement(node){
  return this.doc.substrate.getParentElement(node);
}
;
_.getPreviousSibling = function getPreviousSibling(node){
  return this.doc.substrate.getPreviousSibling(node);
}
;
_.getTagName = function getTagName(element){
  return this.doc.substrate.getTagName(element);
}
;
_.insertXml = function insertXml(point, xml){
  return $insertXml(this, point, xml);
}
;
_.isSameNode = function isSameNode(node, other){
  return this.doc.substrate.isSameNode(node, other);
}
;
_.lastAnnotationChange = function lastAnnotationChange_0(start, end, key, fromValue){
  return $lastAnnotationChange_2(this.doc, start, end, key, dynamicCast(fromValue, 1));
}
;
_.locate = function locate(location_0){
  return $locate_0(this.doc, location_0);
}
;
_.resetAnnotation = function resetAnnotation(start, end, key, value){
  $resetAnnotation(this, start, end, key, value);
}
;
_.size_1 = function size_31(){
  return $size_15(this.doc);
}
;
_.toString$ = function toString_54(){
  return 'MutableDI@' + toPowerOfTwoString(this.$H || (this.$H = ++sNextHashId)) + '[' + $toDebugString(this.doc) + ']';
}
;
_.with_$ = function with_$(actionToRunWithDocument){
  actionToRunWithDocument.exec_0(this);
}
;
_.castableTypeMap$ = {19:1};
_.doc = null;
_.sequencer = null;
function CMutableDocument_0(sequencer, document_0){
  this.sequencer = sequencer;
  this.doc = document_0;
}

function CMutableDocument(){
}

_ = CMutableDocument_0.prototype = CMutableDocument.prototype = new MutableDocumentImpl;
_.getClass$ = function getClass_500(){
  return Lorg_waveprotocol_wave_client_editor_content_CMutableDocument_2_classLit;
}
;
_.castableTypeMap$ = {19:1};
function register_4(registry){
  $registerRenderer(registry, 'doc', new ContentDocElement$1_0);
  $registerEventHandler(registry, 'doc', new ContentDocElement$2_0);
}

function ContentDocElement$1_0(){
}

function ContentDocElement$1(){
}

_ = ContentDocElement$1_0.prototype = ContentDocElement$1.prototype = new Object_0;
_.createDomImpl = function createDomImpl_3(element){
  return $setAutoAppendContainer(element, $doc.createElement('div'));
}
;
_.getClass$ = function getClass_501(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocElement$1_2_classLit;
}
;
_.castableTypeMap$ = {212:1};
function ContentDocElement$2_0(){
  $clinit_776();
}

function ContentDocElement$2(){
}

_ = ContentDocElement$2_0.prototype = ContentDocElement$2.prototype = new NodeEventHandlerImpl;
_.getClass$ = function getClass_502(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocElement$2_2_classLit;
}
;
_.castableTypeMap$ = {216:1};
function $clinit_811(){
  $clinit_811 = nullMethod;
  $clinit_821();
}

function $adjustLevel(this$static, newLevel){
  var currentLevel, i, old;
  old = this$static.level;
  for (i = this$static.level.ordinal + 1; i <= newLevel.ordinal; ++i) {
    currentLevel = ($clinit_835() , $clinit_835() , $VALUES_22)[i];
    switch (currentLevel.ordinal) {
      case 1:
        this$static.fullRawSubstrate.affectImpl || $setAffectHtml(this$static.fullRawSubstrate);
        break;
      case 2:
        checkState_2(this$static.fullRawSubstrate.affectImpl, 'rendered or higher state should imply affectHtml');
        break;
      case 3:
        break;
      default:throw new AssertionError_1('Unknown level ' + currentLevel);
    }
  }
  for (i = this$static.level.ordinal - 1; i >= newLevel.ordinal; --i) {
    currentLevel = ($clinit_835() , $clinit_835() , $VALUES_22)[i];
    switch (currentLevel.ordinal) {
      case 2:
        this$static.editingConcerns = ($clinit_866() , STUB_0);
        this$static.editorPackage = null;
        this$static.selectionMaintainer.editingConcerns = null;
        break;
      case 1:
        this$static.logicalPanel = null;
        break;
      case 0:
        this$static.fullRawSubstrate.affectImpl && $clearAffectHtml(this$static.fullRawSubstrate);
        clearDocPainter(this$static.context);
        break;
      default:throw new AssertionError_1('Unknown level ' + currentLevel);
    }
  }
  this$static.level = newLevel;
  return old;
}

function $attachEditor(this$static, editorBundle, panel){
  var oldLevel;
  checkNotNull_1(editorBundle, 'editorBundle must not be null');
  checkState_2(this$static.level != ($clinit_835() , EDITING), 'Cannot attach editor to a document already with an editor');
  !panel?checkState_2(!!this$static.logicalPanel, 'Must either already have a logical panel, or one must be provided'):(this$static.logicalPanel = panel);
  oldLevel = $adjustLevel(this$static, EDITING);
  this$static.editorPackage = editorBundle;
  this$static.editingConcerns = new ContentDocument$7_0(this$static);
  this$static.selectionMaintainer.editingConcerns = this$static.editingConcerns;
  $setupBehaviour(this$static, this$static.fullRawSubstrate.rootElement, oldLevel);
}

function $beginConsume(this$static, saveSelection){
  if (this$static.selectionMaintainer.savedSelectionDepth > 0) {
    $log_0(($clinit_761() , logger_1).errorLogger, 'Selection save/restore imbalance!');
    this$static.selectionMaintainer.savedSelectionDepth = 0;
  }
  saveSelection?$saveSelection_0(this$static.selectionMaintainer):++this$static.selectionMaintainer.savedSelectionDepth;
}

function $consume_6(this$static, operation){
  $consume_7(this$static, operation);
  !!this$static.editorPackage && ($onIncomingOp(this$static.editorPackage.this$0, operation) , undefined);
}

function $consume_7(this$static, operation){
  var $e0, e;
  if (!this$static.isConsistent) {
    throw new IllegalStateException_1('Document is not in a consistent state - must have died during a previous bad op');
  }
  this$static.isConsistent = false;
  $beginConsume(this$static, true);
  try {
    this$static.applyingToDocument = true;
    try {
      $consume_10(this$static.indexedDoc, operation, false);
    }
     finally {
      this$static.applyingToDocument = false;
    }
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 189)) {
      e = $e0;
      $dealWithBadOp(this$static, false, operation, e, true);
    }
     else if (instanceOf($e0, 21)) {
      e = $e0;
      $dealWithBadOp(this$static, false, operation, e, true);
    }
     else 
      throw $e0;
  }
  $flushNodeRepaint(this$static);
  $restoreSelection(this$static.selectionMaintainer, operation);
  this$static.isConsistent = true;
}

function $consumeLocal(this$static, nindo, saveSelection){
  var $e0, e, e1, op;
  if (!this$static.isConsistent) {
    throw new IllegalStateException_1('Document is not in a consistent state - must have died during a previous bad op');
  }
  if (validateLocalOps) {
    try {
      $maybeThrowOperationExceptionFor_0(this$static.indexedDoc, nindo);
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 189)) {
        e1 = $e0;
        $dealWithBadOp(this$static, true, nindo, e1, false);
      }
       else 
        throw $e0;
    }
  }
  this$static.isConsistent = false;
  $beginConsume(this$static, saveSelection);
  op = null;
  try {
    op = $consumeAndReturnInvertible(this$static.indexedDoc, nindo, false);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 189)) {
      e = $e0;
      $dealWithBadOp(this$static, true, nindo, e, true);
    }
     else if (instanceOf($e0, 21)) {
      e = $e0;
      $dealWithBadOp(this$static, true, nindo, e, true);
    }
     else 
      throw $e0;
  }
  $flushNodeRepaint(this$static);
  saveSelection?$restoreSelection(this$static.selectionMaintainer, op):--this$static.selectionMaintainer.savedSelectionDepth;
  this$static.isConsistent = true;
  return op;
}

function $createSequencedDocumentWrapper(this$static, sequencer){
  return new CMutableDocument_0(sequencer, this$static.indexedDoc);
}

function $dealWithBadOp(this$static, isLocal, operation, e, probableCorruption){
  var $e0, death, msg, oe, re;
  if (e != null && e.castableTypeMap$ && !!e.castableTypeMap$[189]) {
    oe = dynamicCast(e, 189);
    re = null;
  }
   else {
    oe = null;
    re = dynamicCast(e, 21);
  }
  msg = (probableCorruption?'DEATH: ':'') + 'Invalid ' + (isLocal?'LOCAL':'REMOTE') + ' operation: ' + operation + (!!oe && !!oe.violations?' Violation: ' + $firstDescription(oe.violations):' <No violation information!> ') + 'Exception: ' + e + ' IndexedDoc: ' + $toString_19(this$static.indexedDoc);
  $logPlainText(($clinit_761() , logger_1).errorLogger, msg);
  !oe?(death = re):isLocal && !probableCorruption?$getValidationResult(oe.violations) == ($clinit_2006() , INVALID_SCHEMA)?(death = new ContentDocument$SchemaViolatingLocalOperationException_0(oe.violations)):(death = new ContentDocument$BadOpLocalOperationException_0(oe.violations)):(death = new OperationRuntimeException_0('Invalid for current document', oe));
  if (this$static.repairer) {
    try {
      $revert_0(this$static.repairer, this$static.fullContentView, dynamicCast(this$static.fullContentView.inner_0.getDocumentElement(), 196));
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (!instanceOf($e0, 21))
        throw $e0;
    }
  }
  throw death;
}

function $flushNodeRepaint(this$static){
  var n, n$iterator;
  for (n$iterator = new AbstractList$IteratorImpl_0(this$static.nodesToRepaint); n$iterator.i < n$iterator.this$0_0.size_1();) {
    n = dynamicCast($next_4(n$iterator), 197);
    $repaintNode(this$static, n);
  }
  $clear_4(this$static.nodesToRepaint);
}

function $initRootElementRendering(this$static, isRendering){
  var root;
  if (!!this$static.rootElement == isRendering) {
    return;
  }
  root = this$static.fullRawSubstrate.rootElement;
  if (isRendering) {
    this$static.rootElement = root.implNodelet;
    this$static.rawHtmlView = new HtmlViewImpl_0(this$static.rootElement);
    this$static.filteredHtmlView = new ContentDocument$FilteredHtml_0(this$static, this$static.rawHtmlView);
    this$static.strippingHtmlView = new StrippingHtmlView_0(this$static.rootElement);
    this$static.repairer = new Repairer_0(this$static.persistentContentView, this$static.renderedContentView, this$static.strippingHtmlView, this$static.repairListener);
    this$static.nodeManager = new NodeManager_0(this$static.filteredHtmlView, this$static.renderedContentView, this$static.repairer);
  }
   else {
    this$static.rootElement = null;
    this$static.rawHtmlView = null;
    this$static.filteredHtmlView = null;
    this$static.strippingHtmlView = null;
    this$static.repairer = null;
    this$static.nodeManager = null;
  }
}

function $maybeSetupModeNotifications(this$static, element){
  if (!!this$static.editorPackage && ($clinit_908() , !!getListener(element))) {
    onEditModeChange(element, this$static.editorPackage.this$0.editing);
    $add_31(this$static.editorPackage.this$0.elementsWithDisplayEditModes, element);
  }
}

function $postCreation(this$static, element){
  element.attributes.containsKey_1('name') && this$static.nameMap.put_3(dynamicCast(element.attributes.get_4('name'), 1), element);
}

function $repaintNode(this$static, node){
  var element, end, start, textNode;
  if (node.isTextNode()) {
    textNode = node.asText();
    if (textNode.parent_0) {
      start = $getLocation_3(this$static.indexedDoc, textNode);
      maybeScheduleRepaint(this$static.context, start, start + textNode.data_0.length);
    }
  }
   else {
    element = node.asElement();
    start = $getLocation_4(this$static.indexedDoc, start_5(this$static.indexedDoc, element));
    end = $getLocation_4(this$static.indexedDoc, new Point$El_0(element, null));
    maybeScheduleRepaint(this$static.context, start, end);
  }
}

function $replaceOutgoingSink(this$static, newSink){
  var oldSink;
  checkState_2(!!this$static.outgoingOperationSink, '');
  oldSink = this$static.outgoingOperationSink;
  this$static.outgoingOperationSink = newSink;
  return oldSink;
}

function $setInteractive(this$static, logicalPanel){
  var oldLevel;
  checkNotNull_1(logicalPanel, 'Null logicalPanel');
  if (this$static.logicalPanel == logicalPanel) {
    checkState_2(!!this$static.logicalPanel, "Don't have a logicalPanel");
    $adjustLevel(this$static, ($clinit_835() , INTERACTIVE));
    return;
  }
  this$static.logicalPanel = logicalPanel;
  oldLevel = $adjustLevel(this$static, ($clinit_835() , INTERACTIVE));
  $setupBehaviour(this$static, this$static.fullRawSubstrate.rootElement, oldLevel);
}

function $setOutgoingSink(this$static, outgoingOperationSink){
  checkNotNull_1(outgoingOperationSink, 'Outgoing operation sink cannot be null');
  checkState_2(this$static.outgoingOperationSink == ($clinit_2195() , VOID), 'Already has a sink');
  this$static.outgoingOperationSink = outgoingOperationSink;
}

function $setRendering(this$static){
  var oldLevel;
  if (this$static.level == ($clinit_835() , RENDERED)) {
    return;
  }
  oldLevel = $adjustLevel(this$static, RENDERED);
  $setupBehaviour(this$static, this$static.fullRawSubstrate.rootElement, oldLevel);
}

function $setupBehaviour(this$static, element, oldLevel){
  var e, elementRegistry, mutationHandler, n, notRendered, shouldBeRendered;
  e = dynamicCast(element, 223);
  elementRegistry = this$static.registries.elementHandlerRegistry;
  if (!oldLevel) {
    mutationHandler = dynamicCast(dynamicCast($inspect(elementRegistry.data_0), 211).mutationHandlers.get_4(e.tagName_0), 215);
    mutationHandler != null && mutationHandler.castableTypeMap$ && !!mutationHandler.castableTypeMap$[224] && $setNodeMutationHandler(e, mutationHandler);
    oldLevel = ($clinit_835() , SHELVED);
  }
  notRendered = e.renderer == ($clinit_791() , noRenderer);
  shouldBeRendered = this$static.level.ordinal - ($clinit_835() , RENDERED).ordinal >= 0;
  switch (oldLevel.ordinal) {
    case 0:
      if (this$static.level.ordinal - SHELVED.ordinal <= 0)
        break;
      $setupRenderer(this$static, e, true);
      e == this$static.fullRawSubstrate.rootElement && $initRootElementRendering(this$static, true);
      $setNodeMutationHandler(e, dynamicCast(dynamicCast($inspect(elementRegistry.data_0), 211).mutationHandlers.get_4(e.tagName_0), 215));
    case 1:
      if (this$static.level.ordinal - RENDERED.ordinal <= 0)
        break;
      $setNodeEventHandler(e, dynamicCast(dynamicCast($inspect(elementRegistry.data_0), 211).eventHandlers.get_4(e.tagName_0), 216));
      !!e && $setLogicalParent(e, this$static.logicalPanel);
    case 2:
      if (this$static.level.ordinal - INTERACTIVE.ordinal <= 0)
        break;
      $maybeSetupModeNotifications(this$static, e);
  }
  switch (oldLevel.ordinal) {
    case 3:
      if (this$static.level.ordinal - EDITING.ordinal >= 0)
        break;
    case 2:
      if (this$static.level.ordinal - INTERACTIVE.ordinal >= 0)
        break;
      !!e && $setLogicalParent(e, this$static.logicalPanel);
      $setNodeEventHandler(e, null);
    case 1:
      if (this$static.level.ordinal - RENDERED.ordinal >= 0)
        break;
      mutationHandler = dynamicCast(dynamicCast($inspect(elementRegistry.data_0), 211).mutationHandlers.get_4(e.tagName_0), 215);
      mutationHandler != null && mutationHandler.castableTypeMap$ && !!mutationHandler.castableTypeMap$[224]?$setNodeMutationHandler(e, mutationHandler):$setNodeMutationHandler(e, null);
      $setupRenderer(this$static, e, false);
      e == this$static.fullRawSubstrate.rootElement && $initRootElementRendering(this$static, false);
  }
  for (n = e.firstChild_0; n; n = n.next) {
    n != null && n.castableTypeMap$ && !!n.castableTypeMap$[196]?$setupBehaviour(this$static, dynamicCast(n, 223), oldLevel):$setRendering_0(n.asText(), shouldBeRendered);
  }
  notRendered && shouldBeRendered && $implInsertBefore(e, e, e.firstChild_0, null, null, e.containerNodelet);
  oldLevel.ordinal - RENDERED.ordinal < 0 && this$static.level.ordinal - RENDERED.ordinal >= 0 && e.nodeMutationHandler.onActivatedSubtree(e);
}

function $setupRenderer(this$static, e, isRendering){
  var renderer;
  if (isRendering) {
    renderer = $getRenderer(this$static.registries.elementHandlerRegistry, e);
    $setRenderer(e, renderer?renderer:($clinit_791() , defaultRenderer));
  }
   else {
    $setRenderer(e, ($clinit_791() , noRenderer));
  }
}

function $sourceNindoWithoutModifyingHtml(this$static, nindo){
  $clearAffectHtml(this$static.persistentContentView.inner);
  try {
    $consumeAndReturnInvertible_0(this$static.dontSaveSelectionNindoSink, nindo);
  }
   finally {
    $setAffectHtml(this$static.persistentContentView.inner);
  }
}

function ContentDocument_0(initialRegistries, initialState){
  $clinit_811();
  ContentDocument_1.call(this, null);
  this.registries = initialRegistries;
  this.registries?createAndSetDocPainter(this.context, this.registries.paintRegistry):clearDocPainter(this.context);
  $consume_7(this, initialState);
  !!this.editorPackage && ($onIncomingOp(this.editorPackage.this$0, initialState) , undefined);
}

function ContentDocument_1(documentSchema){
  $clinit_811();
  var annotationListener, contentRoot;
  this.outgoingOperationSink = ($clinit_2195() , VOID);
  this.outgoingRepaintSink = new ContentDocument$1_0(this);
  this.nindoSink = new ContentDocument$SourceNindoSink_0(this, true);
  this.dontSaveSelectionNindoSink = new ContentDocument$SourceNindoSink_0(this, false);
  this.renderingConcerns = new ContentDocument$2_0(this);
  this.editingConcerns = ($clinit_866() , STUB_0);
  'ed' + counter_0++ + '_';
  this.nameMap = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  this.nodesToRepaint = new ArrayList_0;
  this.factory = new ContentDocument$3_0(this);
  this.context = new ContentDocument$4_0(this);
  this.repairListener = new ContentDocument$5_0(this);
  this.level = ($clinit_835() , SHELVED);
  annotationListener = new ContentDocument$6_0(this);
  contentRoot = new AgentAdapter_0('doc', ($clinit_1880() , EMPTY_MAP_0), this.context, ($clinit_729() , ROOT_HANDLER_REGISTRY));
  this.sequencer = new EditorOperationSequencer_0(this.nindoSink);
  this.fullAnnotationSet = new EditorAnnotationTree_0(annotationListener);
  this.localAnnotations = new ContentDocument$LocalAnnotationSet_0(this, this.fullAnnotationSet);
  this.fullRawSubstrate = new ContentRawDocument_0(contentRoot, this.factory);
  this.fullContentView = new ContentDocument$FullContent_0(this, this.fullRawSubstrate);
  this.renderedContentView = new ContentDocument$RenderedContent_0(this.fullRawSubstrate);
  this.persistentContentView = new ContentDocument$PersistentContentDoc_0(this, this.fullRawSubstrate);
  this.indexedDoc = new ContentDocument$ContentIndexedDoc_0(this, this.persistentContentView, this.fullAnnotationSet, documentSchema);
  this.lazyPersistenceManager = new LazyPersistenceManager_0(this.outgoingRepaintSink, this.fullContentView, this.indexedDoc, this.persistentContentView, this.indexedDoc);
  $setPersistenceManager(this.persistentContentView, this.lazyPersistenceManager);
  this.selectionMaintainer = new SelectionMaintainer_0(this.indexedDoc);
  this.mutableContent = new CMutableDocument_0(this.sequencer, this.indexedDoc);
  this.selectionContent = ($clinit_1043() , new FilterProduct_0(initValues(_3Lorg_waveprotocol_wave_model_document_util_FilteredView_2_classLit, {9:1, 68:1}, 155, [this.persistentContentView, this.renderedContentView])));
}

function ContentDocument(){
}

_ = ContentDocument_1.prototype = ContentDocument_0.prototype = ContentDocument.prototype = new Object_0;
_.getClass$ = function getClass_503(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument_2_classLit;
}
;
_.toString$ = function toString_55(){
  return $toString_19(this.indexedDoc);
}
;
_.castableTypeMap$ = {};
_.applyingToDocument = false;
_.editorPackage = null;
_.filteredHtmlView = null;
_.fullAnnotationSet = null;
_.fullContentView = null;
_.fullRawSubstrate = null;
_.indexedDoc = null;
_.isConsistent = true;
_.lazyPersistenceManager = null;
_.localAnnotations = null;
_.logicalPanel = null;
_.mutableContent = null;
_.nodeManager = null;
_.persistentContentView = null;
_.rawHtmlView = null;
_.registries = null;
_.renderedContentView = null;
_.repairer = null;
_.rootElement = null;
_.selectionContent = null;
_.selectionMaintainer = null;
_.sequencer = null;
_.strippingHtmlView = null;
var counter_0 = 1, validateLocalOps = true;
function $consume_8(this$static, op){
  this$static.this$0.outgoingOperationSink.consume(op);
  $flushNodeRepaint(this$static.this$0);
}

function ContentDocument$1_0(this$0){
  this.this$0 = this$0;
}

function ContentDocument$1(){
}

_ = ContentDocument$1_0.prototype = ContentDocument$1.prototype = new Object_0;
_.consume = function consume_4(op){
  this.this$0.outgoingOperationSink.consume(dynamicCast(op, 207));
  $flushNodeRepaint(this.this$0);
}
;
_.getClass$ = function getClass_504(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function ContentDocument$2_0(this$0){
  this.this$0 = this$0;
}

function ContentDocument$2(){
}

_ = ContentDocument$2_0.prototype = ContentDocument$2.prototype = new Object_0;
_.getClass$ = function getClass_505(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $createElement_3(this$static, tagName, attributes){
  var el;
  el = new AgentAdapter_0(tagName, attributes, this$static.this$0.context, this$static.this$0.registries.elementHandlerRegistry);
  $postCreation(this$static.this$0, el);
  return el;
}

function $createText(this$static, text){
  return new ContentTextNode_0(text, this$static.this$0.context);
}

function ContentDocument$3_0(this$0){
  this.this$0 = this$0;
}

function ContentDocument$3(){
}

_ = ContentDocument$3_0.prototype = ContentDocument$3.prototype = new Object_0;
_.getClass$ = function getClass_506(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function ContentDocument$4_0(this$0){
  this.this$0 = this$0;
  new ContentDocument$4$1_0(this);
}

function ContentDocument$4(){
}

_ = ContentDocument$4_0.prototype = ContentDocument$4.prototype = new Object_0;
_.getClass$ = function getClass_507(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$4_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $scheduleFinally_0(this$static, task){
  this$static.tasks.isEmpty() && !this$static.isExecuting && $scheduleFinally(($clinit_30() , INSTANCE), this$static.command);
  this$static.tasks.add_2(task);
}

function FinalTaskRunnerImpl_0(){
  this.tasks = ($clinit_2309() , defaultCollectionFactory.createIdentitySet());
  this.command = new FinalTaskRunnerImpl$1_0(this);
}

function FinalTaskRunnerImpl(){
}

_ = FinalTaskRunnerImpl_0.prototype = FinalTaskRunnerImpl.prototype = new Object_0;
_.begin = function begin_2(){
}
;
_.end_0 = function end_5(){
}
;
_.getClass$ = function getClass_508(){
  return Lorg_waveprotocol_wave_client_scheduler_FinalTaskRunnerImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.isExecuting = false;
function ContentDocument$4$1_0(this$1){
  this.this$1 = this$1;
  FinalTaskRunnerImpl_0.call(this);
}

function ContentDocument$4$1(){
}

_ = ContentDocument$4$1_0.prototype = ContentDocument$4$1.prototype = new FinalTaskRunnerImpl;
_.begin = function begin_3(){
  $clinit_761();
  ++ignoreMutations;
  $saveSelection_0(this.this$1.this$0.selectionMaintainer);
}
;
_.end_0 = function end_6(){
  $restoreSelection(this.this$1.this$0.selectionMaintainer, null);
  $clinit_761();
  --ignoreMutations;
}
;
_.getClass$ = function getClass_509(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$4$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
function $onFullDocumentRevert(this$static){
  !!this$static.this$0.editorPackage && (this$static.this$0.editorPackage , $clinit_756() , undefined);
}

function $onRangeRevert(this$static){
  !!this$static.this$0.editorPackage && (this$static.this$0.editorPackage , $clinit_756() , undefined);
}

function ContentDocument$5_0(this$0){
  this.this$0 = this$0;
}

function ContentDocument$5(){
}

_ = ContentDocument$5_0.prototype = ContentDocument$5.prototype = new Object_0;
_.getClass$ = function getClass_510(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$5_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function ContentDocument$6_0(this$0){
  this.this$0 = this$0;
}

function ContentDocument$6(){
}

_ = ContentDocument$6_0.prototype = ContentDocument$6.prototype = new Object_0;
_.getClass$ = function getClass_511(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$6_2_classLit;
}
;
_.onAnnotationChange = function onAnnotationChange(start, end, key, newValue){
  var $e0, e, handlers, ret;
  $clinit_761();
  ++ignoreMutations;
  try {
    handlers = $getHandlers(this.this$0.registries.annotationHandlerRegistry, key);
    while (handlers.next) {
      try {
        (ret = handlers.next , $getNext_4(handlers) , ret).handleAnnotationChange(this.this$0.context, start, end, key, newValue);
      }
       catch ($e0) {
        $e0 = caught_0($e0);
        if (instanceOf($e0, 183)) {
          e = $e0;
          $log_4(logger_1.errorLogger, 'Exception from annotation change handler', e);
        }
         else 
          throw $e0;
      }
    }
  }
   finally {
    --ignoreMutations;
  }
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function ContentDocument$7_0(this$0){
  this.this$0 = this$0;
}

function ContentDocument$7(){
}

_ = ContentDocument$7_0.prototype = ContentDocument$7.prototype = new Object_0;
_.getClass$ = function getClass_512(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$7_2_classLit;
}
;
_.getSelectionHelper = function getSelectionHelper_1(){
  return this.this$0.editorPackage.this$0.passiveSelectionHelper;
}
;
_.getSuggestionsManager = function getSuggestionsManager(){
  return this.this$0.editorPackage.this$0.suggestionsManager;
}
;
_.hasEditor = function hasEditor(){
  return true;
}
;
_.textNodeletAffected = function textNodeletAffected(nodelet, affectedAfterOffset, insertionAmount, changeType){
  $textNodeletAffected(this.this$0.selectionMaintainer, nodelet, affectedAfterOffset, insertionAmount, changeType);
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $clinit_821(){
  $clinit_821 = nullMethod;
  SIMPLE = new ContentDocument$AnnotationImplFactory$1_0;
  TREE = new ContentDocument$AnnotationImplFactory$2_0;
  STUB = new ContentDocument$AnnotationImplFactory$3_0;
  $VALUES_21 = initValues(_3Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory_2_classLit, {9:1, 68:1, 170:1}, 98, [SIMPLE, TREE, STUB]);
}

function valueOf_28(name_0){
  $clinit_821();
  return valueOf_0(($clinit_825() , $MAP_21), name_0);
}

function values_22(){
  $clinit_821();
  return $VALUES_21;
}

function ContentDocument$AnnotationImplFactory(){
}

_ = ContentDocument$AnnotationImplFactory.prototype = new Enum;
_.getClass$ = function getClass_513(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 98:1};
var $VALUES_21, SIMPLE, STUB, TREE;
function ContentDocument$AnnotationImplFactory$1_0(){
  this.name_1 = 'SIMPLE';
  this.ordinal = 0;
}

function ContentDocument$AnnotationImplFactory$1(){
}

_ = ContentDocument$AnnotationImplFactory$1_0.prototype = ContentDocument$AnnotationImplFactory$1.prototype = new ContentDocument$AnnotationImplFactory;
_.getClass$ = function getClass_514(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory$1_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 98:1};
function ContentDocument$AnnotationImplFactory$2_0(){
  this.name_1 = 'TREE';
  this.ordinal = 1;
}

function ContentDocument$AnnotationImplFactory$2(){
}

_ = ContentDocument$AnnotationImplFactory$2_0.prototype = ContentDocument$AnnotationImplFactory$2.prototype = new ContentDocument$AnnotationImplFactory;
_.getClass$ = function getClass_515(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory$2_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 98:1};
function ContentDocument$AnnotationImplFactory$3_0(){
  this.name_1 = 'STUB';
  this.ordinal = 2;
}

function ContentDocument$AnnotationImplFactory$3(){
}

_ = ContentDocument$AnnotationImplFactory$3_0.prototype = ContentDocument$AnnotationImplFactory$3.prototype = new ContentDocument$AnnotationImplFactory;
_.getClass$ = function getClass_516(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory$3_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 98:1};
function $clinit_825(){
  $clinit_825 = nullMethod;
  $MAP_21 = createValueOfMap(($clinit_821() , $VALUES_21));
}

var $MAP_21;
function ContentDocument$LocalOperationException_0(violation){
  this.fillInStackTrace();
  this.detailMessage = '' + violation;
  checkNotNull_1(violation, 'Missing violation information');
  this.violation = violation;
}

function ContentDocument$LocalOperationException(){
}

_ = ContentDocument$LocalOperationException.prototype = new RuntimeException;
_.getClass$ = function getClass_517(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$LocalOperationException_2_classLit;
}
;
_.toString$ = function toString_56(){
  return 'LocalOperationException: ' + this.violation;
}
;
_.castableTypeMap$ = {9:1, 21:1, 39:1, 183:1, 202:1};
_.violation = null;
function ContentDocument$BadOpLocalOperationException_0(violation){
  ContentDocument$LocalOperationException_0.call(this, violation);
  checkArgument_2((violation.operationIllFormed.size_0 == 0?violation.operationInvalid.size_0 == 0?violation.schemaViolations.size_0 == 0?($clinit_2006() , VALID):($clinit_2006() , INVALID_SCHEMA):($clinit_2006() , INVALID_DOCUMENT):($clinit_2006() , ILL_FORMED)) != ($clinit_2006() , INVALID_SCHEMA), 'Not a low level violation');
}

function ContentDocument$BadOpLocalOperationException(){
}

_ = ContentDocument$BadOpLocalOperationException_0.prototype = ContentDocument$BadOpLocalOperationException.prototype = new ContentDocument$LocalOperationException;
_.getClass$ = function getClass_518(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$BadOpLocalOperationException_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 21:1, 39:1, 183:1, 202:1};
function $annotationIntervals_1(this$static, start, end, keys){
  var iterable;
  !keys?(keys = $knownKeys(this$static)):keys.each_3(new IndexedDocumentImpl$3_0);
  iterable = this$static.annotations.annotationIntervals(start, end, keys);
  return new IndexedDocumentImpl$8_0(iterable);
}

function $asElement_1(this$static, node){
  return this$static.substrate.asElement_0(node);
}

function $asOperation(this$static){
  var $e0, annotationsOp, bothOps, domOp, e, initialisation;
  if (($checkSizeConsistency(this$static, 'size') , this$static.offsetList.root.offset) == 0) {
    return $clinit_2119() , EMPTY_DOCUMENT_0;
  }
  domOp = $serializeDom(this$static);
  annotationsOp = $serializeAnnotations(this$static);
  try {
    performValidation?(bothOps = compose_2(domOp, annotationsOp)):(bothOps = composeUnchecked(domOp, annotationsOp));
    initialisation = bothOps != null && bothOps.castableTypeMap$ && !!bothOps.castableTypeMap$[392]?dynamicCast(bothOps, 392):new DocOpUtil$1_0(bothOps);
    return initialisation;
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 189)) {
      e = $e0;
      throw new OperationRuntimeException_0('Bug either in indexed document or the composer', e);
    }
     else 
      throw $e0;
  }
}

function $beginChange(this$static){
  this$static.beforeBegin();
  this$static.inconsistent = true;
  $resetLocation(this$static);
  this$static.annotations.begin();
}

function $checkRetain(this$static, count){
  if (this$static.currentLocation + count > ($checkSizeConsistency(this$static, 'size') , this$static.offsetList.root.offset)) {
    throw new OpCursorException_0('Retain past end of document [location:' + (this$static.currentLocation + count) + '] [doc size:' + ($checkSizeConsistency(this$static, 'size') , this$static.offsetList.root.offset) + ']');
  }
}

function $checkSizeConsistency(this$static, msgPrefix){
  if (!!this$static.annotations && !!this$static.offsetList && this$static.offsetList.root.offset != this$static.annotations.size_1()) {
    throw new RuntimeException_1(msgPrefix + ': Document and annotations have inconsistent size: ' + this$static.offsetList.root.offset + ' vs ' + this$static.annotations.size_1() + ', respectively');
  }
}

function $consume_10(this$static, op, validate){
  var $e0, e;
  checkState_2(!this$static.inconsistent, 'The document is not in a consistent state');
  validate && $maybeThrowOperationExceptionFor(this$static, op);
  $beginChange(this$static);
  try {
    op.apply_8(this$static.invertibleCursor);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 391)) {
      e = $e0;
      throw new OperationException_1(e.detailMessage, e);
    }
     else 
      throw $e0;
  }
  $endChange(this$static);
}

function $consumeAndReturnInvertible(this$static, op, validate){
  var $e0, e;
  checkState_2(!this$static.inconsistent, 'The document is not in a consistent state');
  validate && $maybeThrowOperationExceptionFor_0(this$static, op);
  $begin2(this$static.nindoCursor);
  try {
    $apply_39(op, this$static.nindoCursor);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 391)) {
      e = $e0;
      throw new OperationException_1(e.detailMessage, e);
    }
     else 
      throw $e0;
  }
  return $finish2(this$static.nindoCursor);
}

function $deleteCurrentContainer(this$static){
  var nextContainer;
  nextContainer = this$static.currentContainer.nextContainer;
  $remove_43(this$static.currentContainer);
  this$static.currentContainer = nextContainer;
}

function $doCharacters(this$static, characters){
  var domNode, newTextNode, previousNode, previousTextNode, textNode;
  this$static.annotations.insert(characters.length);
  previousNode = null;
  previousTextNode = null;
  if (this$static.currentOffset == 0) {
    previousNode = this$static.currentContainer.previousContainer;
    previousTextNode = this$static.substrate.asText_0(previousNode.value_0);
  }
  if (previousTextNode != null) {
    this$static.substrate.appendData(previousTextNode, characters);
    $increaseSize(previousNode, characters.length);
  }
   else {
    domNode = this$static.currentContainer.value_0;
    textNode = this$static.substrate.asText_0(domNode);
    if (textNode != null) {
      this$static.substrate.insertData_0(textNode, this$static.currentOffset, characters);
      $increaseSize(this$static.currentContainer, characters.length);
      this$static.currentOffset += characters.length;
    }
     else {
      newTextNode = this$static.substrate.createTextNode_0(characters, this$static.currentParent, this$static.currentContainer.value_0);
      $insertBefore_3(this$static, this$static.currentContainer, newTextNode, characters.length);
    }
  }
  this$static.onCharacters(this$static.currentLocation, characters);
  this$static.currentLocation += characters.length;
}

function $doDeleteCharacters(this$static, deletionSize){
  var amountToDelete, currentLength, textBuilder, textNode;
  textBuilder = new StringBuilder_0;
  if (this$static.deletionDepth <= 0) {
    textNode = this$static.substrate.asText_0(this$static.currentContainer.value_0);
    currentLength = this$static.substrate.getLength(textNode);
    if (this$static.currentOffset + deletionSize < currentLength) {
      $append_11(textBuilder, $substring_0(this$static.substrate.getData(textNode), this$static.currentOffset, this$static.currentOffset + deletionSize));
      this$static.substrate.deleteData_0(textNode, this$static.currentOffset, deletionSize);
      $increaseSize(this$static.currentContainer, -deletionSize);
    }
     else {
      if (this$static.currentOffset > 0) {
        amountToDelete = currentLength - this$static.currentOffset;
        $append_11(textBuilder, $substring(this$static.substrate.getData(textNode), this$static.currentOffset));
        this$static.substrate.deleteData_0(textNode, this$static.currentOffset, amountToDelete);
        $increaseSize(this$static.currentContainer, -amountToDelete);
        deletionSize -= amountToDelete;
        this$static.currentContainer = this$static.currentContainer.nextContainer;
        this$static.currentOffset = 0;
      }
      while (deletionSize > 0) {
        textNode = this$static.substrate.asText_0(this$static.currentContainer.value_0);
        currentLength = this$static.substrate.getLength(textNode);
        if (currentLength <= deletionSize) {
          $append_11(textBuilder, this$static.substrate.getData(textNode));
          this$static.substrate.removeChild_0(this$static.currentParent, textNode);
          $deleteCurrentContainer(this$static);
          deletionSize -= currentLength;
        }
         else {
          $append_11(textBuilder, this$static.substrate.getData(textNode).substr(0, deletionSize - 0));
          this$static.substrate.deleteData_0(textNode, 0, deletionSize);
          $increaseSize(this$static.currentContainer, -deletionSize);
          break;
        }
      }
    }
  }
   else {
    while (deletionSize > 0) {
      textNode = this$static.substrate.asText_0(this$static.currentContainer.value_0);
      if (deletionSize < this$static.substrate.getLength(textNode)) {
        $append_11(textBuilder, this$static.substrate.getData(textNode).substr(0, deletionSize - 0));
        this$static.substrate.deleteData_0(textNode, 0, deletionSize);
        $increaseSize(this$static.currentContainer, -deletionSize);
        break;
      }
       else {
        $append_11(textBuilder, this$static.substrate.getData(textNode));
        deletionSize -= this$static.currentContainer.size_0;
        $deleteCurrentContainer(this$static);
      }
    }
  }
  return textBuilder.impl.string;
}

function $doElementEnd(this$static){
  this$static.onElementEnd();
  this$static.annotations.insert(1);
  ++this$static.currentLocation;
  this$static.currentContainer = this$static.currentContainer.nextContainer;
  this$static.currentParent = this$static.substrate.getParentElement(this$static.currentParent);
}

function $doElementStart(this$static, tagName, attributes){
  var newElement;
  $splitCurrent(this$static);
  newElement = this$static.substrate.createElement_1(tagName, attributes, this$static.currentParent, this$static.currentContainer.value_0);
  $insertBefore_3(this$static, this$static.currentContainer, newElement, 1);
  $insertBefore_9(this$static.currentContainer, null, 1);
  this$static.annotations.insert(1);
  this$static.currentContainer = this$static.currentContainer.previousContainer;
  this$static.currentParent = newElement;
  ++this$static.currentLocation;
  this$static.onElementStart(newElement);
}

function $doEndAnnotation(this$static, key){
  if (key.charCodeAt(0) == 64) {
    throw new IllegalArgumentException_1('Cannot access local annotations');
  }
  this$static.annotations.endAnnotation(key);
}

function $doStartAnnotation(this$static, key, value){
  if (key.charCodeAt(0) == 64) {
    throw new IllegalArgumentException_1('Cannot access local annotations');
  }
  this$static.annotations.startAnnotation(key, value);
}

function $endChange(this$static){
  if (this$static.currentLocation != ($checkSizeConsistency(this$static, 'size') , this$static.offsetList.root.offset)) {
    throw new OperationException_0('Operation size does not match document size [operation size:' + this$static.currentLocation + '] [doc size:' + ($checkSizeConsistency(this$static, 'size') , this$static.offsetList.root.offset) + ']');
  }
  this$static.annotations.finish();
  $checkSizeConsistency(this$static, 'finish');
  this$static.inconsistent = false;
  this$static.afterFinish();
}

function $firstAnnotationChange_2(this$static, start, end, key, fromValue){
  if (key.charCodeAt(0) == 64) {
    throw new IllegalArgumentException_1('Cannot access local annotations');
  }
  return this$static.annotations.firstAnnotationChange(start, end, key, fromValue);
}

function $getAnnotation_2(this$static, start, key){
  if (key.charCodeAt(0) == 64) {
    throw new IllegalArgumentException_1('Cannot access local annotations');
  }
  return dynamicCast(this$static.annotations.getAnnotation(start, key), 1);
}

function $getData_1(this$static, textNode){
  return this$static.substrate.getData(textNode);
}

function $getLastLocationIn(this$static, node){
  var indexingContainer, lastChild;
  lastChild = this$static.substrate.getLastChild_0(node);
  if (lastChild != null) {
    if (this$static.substrate.asElement_0(lastChild) != null) {
      return $getLastLocationIn(this$static, lastChild) + 1;
    }
     else {
      indexingContainer = this$static.substrate.getIndexingContainer(lastChild);
      return $offset(indexingContainer) + indexingContainer.size_0;
    }
  }
   else 
    return (node == null?null:node) === maskUndefined(this$static.substrate.getDocumentElement())?($checkSizeConsistency(this$static, 'size') , this$static.offsetList.root.offset):$offset(this$static.substrate.getIndexingContainer(node)) + 1;
}

function $getLength_2(this$static, textNode){
  return this$static.substrate.getLength(textNode);
}

function $getLocation_1(this$static, node){
  var indexingContainer;
  checkNotNull_1(node, 'Cannot get the location of a null node');
  indexingContainer = this$static.substrate.getIndexingContainer(node);
  if (!indexingContainer) {
    throw new IllegalArgumentException_1('getLocation: node has no indexing container - ' + node);
  }
  if (!indexingContainer.nextContainer) {
    throw new IllegalArgumentException_1('getLocation: node probably removed from DOM - ' + node);
  }
  return $offset(indexingContainer);
}

function $getLocation_2(this$static, point){
  var nodeAfter;
  checkNotNull_1(point, 'Cannot get the location of a null point');
  point.offset >= 0?checkOffset(this$static, this$static.substrate.asText_0(point.container), $getTextOffset(point), 'IndexedDocumentImpl#getLocation'):checkRelationship(this$static, this$static.substrate.asElement_0(point.container), $getNodeAfter(point), 'IndexedDocumentImpl#getLocation');
  if (point.offset >= 0) {
    return this$static.getLocation(point.container) + $getTextOffset(point);
  }
   else {
    nodeAfter = $getNodeAfter(point);
    return nodeAfter == null?$getLastLocationIn(this$static, point.container):this$static.getLocation(nodeAfter);
  }
}

function $getParentOf(this$static, container){
  var counter, domNode, i, parent_0;
  domNode = container.value_0;
  if (domNode != null) {
    return this$static.substrate.getParentElement(domNode);
  }
  counter = 0;
  container = container.previousContainer;
  while (container.value_0 == null) {
    ++counter;
    container = container.previousContainer;
  }
  domNode = container.value_0;
  parent_0 = this$static.substrate.asElement_0(domNode);
  parent_0 == null && (parent_0 = this$static.substrate.getParentElement(domNode));
  for (i = 0; i < counter; ++i) {
    parent_0 = this$static.substrate.getParentElement(parent_0);
  }
  return parent_0;
}

function $indexChildren(this$static, element){
  var child, childElement, childText, sentinel, sentinel_0;
  sentinel = this$static.offsetList.root;
  for (child = this$static.substrate.getFirstChild_0(element); child != null; child = this$static.substrate.getNextSibling(child)) {
    childElement = this$static.substrate.asElement_0(child);
    if (childElement != null) {
      sentinel_0 = this$static.offsetList.root;
      this$static.substrate.setIndexingContainer(childElement, $insertBefore_9(sentinel_0, childElement, 1));
      $indexChildren(this$static, childElement);
      $insertBefore_9(sentinel_0, null, 1);
    }
     else {
      childText = this$static.substrate.asText_0(child);
      $insertBefore_3(this$static, sentinel, childText, this$static.substrate.getLength(childText));
    }
  }
}

function $insertBefore_3(this$static, container, domNode, size){
  this$static.substrate.setIndexingContainer(domNode, $insertBefore_9(container, domNode, size));
}

function $knownKeys(this$static){
  var knownKeys;
  knownKeys = ($clinit_2309() , defaultCollectionFactory.createStringSet());
  this$static.annotations.knownKeysLive().each_3(new IndexedDocumentImpl$6_0(knownKeys));
  return knownKeys;
}

function $lastAnnotationChange_2(this$static, start, end, key, fromValue){
  if (key.charCodeAt(0) == 64) {
    throw new IllegalArgumentException_1('Cannot access local annotations');
  }
  return this$static.annotations.lastAnnotationChange(start, end, key, fromValue);
}

function $locate_0(this$static, location_0){
  checkPositionIndex(location_0, this$static.offsetList.root.offset);
  return $performActionAt(this$static.offsetList, location_0, this$static.pointFinder);
}

function $maybeThrowOperationExceptionFor(this$static, op){
  var vc;
  if (validate_1(null, this$static.schemaConstraints, this$static.autoDoc, op) != ($clinit_2006() , VALID)) {
    vc = new DocOpAutomaton$ViolationCollector_0;
    validate_1(vc, this$static.schemaConstraints, this$static.autoDoc, op);
    throw new OperationException_2(vc);
  }
}

function $maybeThrowOperationExceptionFor_0(this$static, op){
  var vc;
  vc = validate_0(this$static, op, this$static.schemaConstraints);
  if ((vc.operationIllFormed.size_0 == 0?vc.operationInvalid.size_0 == 0?vc.schemaViolations.size_0 == 0?($clinit_2006() , VALID):($clinit_2006() , INVALID_SCHEMA):($clinit_2006() , INVALID_DOCUMENT):($clinit_2006() , ILL_FORMED)) != ($clinit_2006() , VALID)) {
    throw new OperationException_2(vc);
  }
}

function $moveToCurrentLocation(this$static){
  $performActionAt(this$static.offsetList, this$static.currentLocation, this$static.locationUpdater);
}

function $resetLocation(this$static){
  this$static.currentLocation = 0;
  this$static.currentOffset = 0;
  this$static.currentParent = this$static.substrate.getDocumentElement();
  this$static.currentContainer = this$static.offsetList.root.nextContainer;
}

function $serializeAnnotations(this$static){
  var annotationsOp, b, i, i$iterator, last;
  b = new AnnotationsNormalizer_0(new UncheckedDocOpBuffer_0);
  last = null;
  for (i$iterator = this$static.annotations.annotationIntervals(0, ($checkSizeConsistency(this$static, 'size') , this$static.offsetList.root.offset), $knownKeys(this$static)).iterator_0(); i$iterator.hasNext();) {
    i = dynamicCast(i$iterator.next_0(), 393);
    i.diffFromLeft.each_2(new IndexedDocumentImpl$4_0(b));
    $retain_0(b, i.end - i.start);
    last = i;
  }
  ($checkSizeConsistency(this$static, 'size') , this$static.offsetList.root.offset) > 0 && last.annotations.each_2(new IndexedDocumentImpl$5_0(b));
  annotationsOp = dynamicCast(($flushAnnotations(b) , b.target_0.finish_0()), 207);
  return annotationsOp;
}

function $serializeDom(this$static){
  var b, depth, domOp, elementNode, node, node$iterator, textNode, returnValue_0;
  b = new DocOpBuilder_0;
  depth = 0;
  for (node$iterator = new EvaluableOffsetList$1_0(this$static.offsetList); node$iterator.nextContainer != node$iterator.this$0.root;) {
    node = (returnValue_0 = node$iterator.nextContainer.value_0 , node$iterator.nextContainer = node$iterator.nextContainer.nextContainer , returnValue_0);
    if (node != null) {
      textNode = this$static.substrate.asText_0(node);
      if (textNode != null) {
        $characters_3(b, this$static.substrate.getData(textNode));
      }
       else {
        elementNode = this$static.substrate.asElement_0(node);
        $elementStart_4(b, this$static.substrate.getTagName(elementNode), new AttributesImpl_1(this$static.substrate.getAttributes(elementNode)));
        ++depth;
      }
    }
     else {
      --depth;
      depth >= 0 && ($add_9(b.accu, ($clinit_2053() , INSTANCE_16)) , b);
    }
  }
  domOp = new BufferedDocOpImpl_0(dynamicCast($toArray_1(b.accu, ($clinit_2035() , EMPTY_ARRAY_2)), 228));
  return domOp;
}

function $size_15(this$static){
  $checkSizeConsistency(this$static, 'size');
  return this$static.offsetList.root.offset;
}

function $splitCurrent(this$static){
  var domNode, newDomNode;
  if (this$static.currentOffset != 0) {
    domNode = this$static.substrate.asText_0(this$static.currentContainer.value_0);
    newDomNode = this$static.substrate.splitText_0(domNode, this$static.currentOffset);
    this$static.currentContainer = $split_1(this$static.currentContainer, this$static.currentOffset, newDomNode);
    this$static.substrate.setIndexingContainer(newDomNode, this$static.currentContainer);
    this$static.currentOffset = 0;
  }
}

function $splitText_0(this$static, textNode, offset){
  if (this$static.inconsistent) {
    throw new IllegalStateException_1('Cannot splitText() during a modification');
  }
  if (offset == 0) {
    return textNode;
  }
   else if (offset >= this$static.substrate.getLength(textNode)) {
    return null;
  }
  this$static.currentLocation = this$static.getLocation(textNode) + offset;
  $performActionAt(this$static.offsetList, this$static.currentLocation, this$static.locationUpdater);
  $splitCurrent(this$static);
  return this$static.substrate.asText_0(this$static.currentContainer.value_0);
}

function $toDebugString(this$static){
  var $e0, e;
  try {
    return toPrettyXmlString(($clinit_2104() , $clinit_2104() , asInitialization(scrub_0($asOperation(this$static)))));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 21)) {
      e = $e0;
      $clinit_2104();
      return '#<!BROKEN># (' + e + ')';
    }
     else 
      throw $e0;
  }
}

function $toString_19(this$static){
  return 'IndexedDI@' + toPowerOfTwoString(!this$static?0:this$static.$H || (this$static.$H = ++sNextHashId)) + '[' + $toDebugString(this$static) + ']';
}

function IndexedDocumentImpl_0(substrate, rawAnnotations, constraints){
  this.pointFinder = new IndexedDocumentImpl$1_0(this);
  this.locationUpdater = new IndexedDocumentImpl$2_0(this);
  this.autoDoc = new Automatons$1_0(this);
  this.invertibleCursor = new IndexedDocumentImpl$InvertibleCursor_0(this);
  this.nindoCursor = new IndexedDocumentImpl$NonInvertibleCursor_0(this);
  checkNotNull_1(constraints, 'Null schema not allowed, use DocumentSchema.NO_SCHEMA_CONSTRAINTS');
  this.schemaConstraints = constraints;
  this.annotations = rawAnnotations?rawAnnotations:new StubModifiableAnnotations_0;
  this.substrate = substrate;
  this.offsetList = new EvaluableOffsetList_0;
  $indexChildren(this, substrate.getDocumentElement());
  $resetLocation(this);
  if (this.offsetList.root.offset > 0) {
    this.annotations.begin();
    this.annotations.insert(this.offsetList.root.offset);
    this.annotations.finish();
  }
}

function IndexedDocumentImpl(){
}

_ = IndexedDocumentImpl_0.prototype = IndexedDocumentImpl.prototype = new Object_0;
_.afterFinish = function afterFinish(){
}
;
_.annotationIntervals = function annotationIntervals_1(start, end, keys){
  return $annotationIntervals_1(this, start, end, keys);
}
;
_.asElement_0 = function asElement_2(node){
  return this.substrate.asElement_0(node);
}
;
_.asText_0 = function asText_2(node){
  return this.substrate.asText_0(node);
}
;
_.beforeBegin = function beforeBegin(){
}
;
_.firstAnnotationChange = function firstAnnotationChange_1(start, end, key, fromValue){
  return $firstAnnotationChange_2(this, start, end, key, dynamicCast(fromValue, 1));
}
;
_.forEachAnnotationAt = function forEachAnnotationAt_1(location_0, callback){
  this.annotations.forEachAnnotationAt(location_0, new IndexedDocumentImpl$7_0(callback));
}
;
_.getAnnotation = function getAnnotation_1(start, key){
  return $getAnnotation_2(this, start, key);
}
;
_.getAttribute_0 = function getAttribute_0(element, name_0){
  return this.substrate.getAttribute_0(element, name_0);
}
;
_.getAttributes = function getAttributes_0(element){
  return this.substrate.getAttributes(element);
}
;
_.getClass$ = function getClass_519(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl_2_classLit;
}
;
_.getData = function getData_0(textNode){
  return this.substrate.getData(textNode);
}
;
_.getDocumentElement = function getDocumentElement_0(){
  return this.substrate.getDocumentElement();
}
;
_.getFirstChild_0 = function getFirstChild_2(node){
  return this.substrate.getFirstChild_0(node);
}
;
_.getLastChild_0 = function getLastChild_2(node){
  return this.substrate.getLastChild_0(node);
}
;
_.getLength = function getLength_0(textNode){
  return this.substrate.getLength(textNode);
}
;
_.getLocation = function getLocation_0(node){
  return $getLocation_1(this, node);
}
;
_.getLocation_0 = function getLocation_1(point){
  return $getLocation_2(this, point);
}
;
_.getNextSibling = function getNextSibling_0(node){
  return this.substrate.getNextSibling(node);
}
;
_.getNodeType_0 = function getNodeType_1(node){
  return this.substrate.getNodeType_0(node);
}
;
_.getParentElement = function getParentElement_0(node){
  return this.substrate.getParentElement(node);
}
;
_.getPreviousSibling = function getPreviousSibling_0(node){
  return this.substrate.getPreviousSibling(node);
}
;
_.getTagName = function getTagName_0(element){
  return this.substrate.getTagName(element);
}
;
_.isSameNode = function isSameNode_0(node, other){
  return this.substrate.isSameNode(node, other);
}
;
_.lastAnnotationChange = function lastAnnotationChange_1(start, end, key, fromValue){
  return $lastAnnotationChange_2(this, start, end, key, dynamicCast(fromValue, 1));
}
;
_.locate = function locate_0(location_0){
  return checkPositionIndex(location_0, this.offsetList.root.offset) , $performActionAt(this.offsetList, location_0, this.pointFinder);
}
;
_.onCharacters = function onCharacters(location_0, characters){
}
;
_.onDeleteCharacters = function onDeleteCharacters(location_0, characters){
}
;
_.onDeleteElementEnd = function onDeleteElementEnd(){
}
;
_.onDeleteElementStart = function onDeleteElementStart(location_0, element){
}
;
_.onElementEnd = function onElementEnd(){
}
;
_.onElementStart = function onElementStart(element){
}
;
_.onModifyAttributes = function onModifyAttributes(element, oldAttributes, newAttributes){
}
;
_.onModifyAttributes_0 = function onModifyAttributes_0(element, update){
}
;
_.size_1 = function size_32(){
  return $checkSizeConsistency(this, 'size') , this.offsetList.root.offset;
}
;
_.splitText_0 = function splitText(textNode, offset){
  return $splitText_0(this, textNode, offset);
}
;
_.toString$ = function toString_57(){
  return 'IndexedDI@' + toPowerOfTwoString(this.$H || (this.$H = ++sNextHashId)) + '[' + $toDebugString(this) + ']';
}
;
_.castableTypeMap$ = {19:1};
_.annotations = null;
_.currentContainer = null;
_.currentLocation = 0;
_.currentOffset = 0;
_.currentParent = null;
_.deletionDepth = 0;
_.inconsistent = false;
_.offsetList = null;
_.schemaConstraints = null;
_.substrate = null;
var performValidation = true;
function $getLocation_3(this$static, node){
  node = dynamicCast($getNextVisibleNodeDepthFirst(this$static.this$0.persistentContentView, node, null), 197);
  return !node?($checkSizeConsistency(this$static, 'size') , this$static.offsetList.root.offset):$getLocation_1(this$static, node);
}

function $getLocation_4(this$static, point){
  return $getLocation_2(this$static.indexedDocLocationMapper.this$1, getFilteredPoint(this$static.this$0.persistentContentView, point));
}

function $splitText_1(this$static, textNode, offset){
  $saveSelection_0(this$static.this$0.selectionMaintainer);
  try {
    return dynamicCast($splitText_0(this$static, textNode, offset), 225);
  }
   finally {
    $restoreSelection(this$static.this$0.selectionMaintainer, null);
  }
}

function $splitText_2(this$static, textNode, offset){
  return $splitText_1(this$static, dynamicCast(textNode, 225), offset);
}

function ContentDocument$ContentIndexedDoc_0(this$0, doc, annotations, schema){
  this.this$0 = this$0;
  IndexedDocumentImpl_0.call(this, doc, annotations, schema);
  this.indexedDocLocationMapper = new ContentDocument$ContentIndexedDoc$1_0(this);
}

function ContentDocument$ContentIndexedDoc(){
}

_ = ContentDocument$ContentIndexedDoc_0.prototype = ContentDocument$ContentIndexedDoc.prototype = new IndexedDocumentImpl;
_.getClass$ = function getClass_520(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$ContentIndexedDoc_2_classLit;
}
;
_.getLocation_0 = function getLocation_2(point){
  return $getLocation_2(this.indexedDocLocationMapper.this$1, getFilteredPoint(this.this$0.persistentContentView, point));
}
;
_.getLocation = function getLocation_3(node){
  return $getLocation_3(this, dynamicCast(node, 197));
}
;
_.splitText_0 = function splitText_0(textNode, offset){
  return $splitText_1(this, dynamicCast(textNode, 225), offset);
}
;
_.castableTypeMap$ = {19:1};
_.this$0 = null;
function ContentDocument$ContentIndexedDoc$1_0(this$1){
  this.this$1 = this$1;
}

function ContentDocument$ContentIndexedDoc$1(){
}

_ = ContentDocument$ContentIndexedDoc$1_0.prototype = ContentDocument$ContentIndexedDoc$1.prototype = new Object_0;
_.getClass$ = function getClass_521(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$ContentIndexedDoc$1_2_classLit;
}
;
_.getLocation = function getLocation_4(node){
  return $getLocation_1(this.this$1, dynamicCast(node, 197));
}
;
_.locate = function locate_1(location_0){
  return $locate_0(this.this$1, location_0);
}
;
_.size_1 = function size_33(){
  return $size_15(this.this$1);
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
function $asText_1(this$static, node){
  return this$static.inner_0.asText_0(node);
}

function $isSameNode_1(this$static, node, other){
  return this$static.inner_0.isSameNode(node, other);
}

function IdentityView(){
}

_ = IdentityView.prototype = new Object_0;
_.asElement_0 = function asElement_3(node){
  return this.inner_0.asElement_0(node);
}
;
_.asText_0 = function asText_3(node){
  return this.inner_0.asText_0(node);
}
;
_.getAttribute_0 = function getAttribute_1(element, name_0){
  return this.inner_0.getAttribute_0(element, name_0);
}
;
_.getAttributes = function getAttributes_1(element){
  return this.inner_0.getAttributes(element);
}
;
_.getClass$ = function getClass_522(){
  return Lorg_waveprotocol_wave_model_document_util_IdentityView_2_classLit;
}
;
_.getData = function getData_1(textNode){
  return this.inner_0.getData(textNode);
}
;
_.getDocumentElement = function getDocumentElement_1(){
  return this.inner_0.getDocumentElement();
}
;
_.getFirstChild_0 = function getFirstChild_3(node){
  return this.inner_0.getFirstChild_0(node);
}
;
_.getLastChild_0 = function getLastChild_3(node){
  return this.inner_0.getLastChild_0(node);
}
;
_.getLength = function getLength_1(textNode){
  return this.inner_0.getLength(textNode);
}
;
_.getNextSibling = function getNextSibling_1(node){
  return this.inner_0.getNextSibling(node);
}
;
_.getNodeType_0 = function getNodeType_2(node){
  return this.inner_0.getNodeType_0(node);
}
;
_.getParentElement = function getParentElement_1(node){
  return this.inner_0.getParentElement(node);
}
;
_.getPreviousSibling = function getPreviousSibling_1(node){
  return this.inner_0.getPreviousSibling(node);
}
;
_.getTagName = function getTagName_1(element){
  return this.inner_0.getTagName(element);
}
;
_.isSameNode = function isSameNode_1(node, other){
  return this.inner_0.isSameNode(node, other);
}
;
_.castableTypeMap$ = {19:1, 20:1, 156:1};
_.inner_0 = null;
function $getFirstChild_4(this$static, node){
  var find_0;
  find_0 = this$static.inner_0.getFirstChild_0(node);
  return $getNextVisibleNodeDepthFirst(this$static, find_0, node);
}

function $getLastChild_4(this$static, node){
  var find_0;
  find_0 = this$static.inner_0.getLastChild_0(node);
  return $getPreviousVisibleNodeDepthFirst(this$static, find_0, node, true);
}

function $getNextSibling_3(this$static, node){
  var find_0, parent_0;
  parent_0 = $getParentElement_3(this$static, node);
  find_0 = this$static.getNextOrPrevNodeDepthFirst(this$static.inner_0, node, parent_0, false, true);
  return $getNextVisibleNodeDepthFirst(this$static, find_0, parent_0);
}

function $getNextVisibleNodeDepthFirst(this$static, find_0, stopAt){
  while (find_0 != null) {
    switch (this$static.getSkipLevel(find_0).ordinal) {
      case 0:
        return find_0;
      case 1:
        find_0 = this$static.getNextOrPrevNodeDepthFirst(this$static.inner_0, find_0, stopAt, true, true);
        break;
      case 2:
        find_0 = this$static.getNextOrPrevNodeDepthFirst(this$static.inner_0, find_0, stopAt, false, true);
        break;
      case 3:
        return null;
      default:throw new RuntimeException_1('Unimplemented');
    }
  }
  return null;
}

function $getParentElement_3(this$static, node){
  var element;
  element = this$static.inner_0.getParentElement(node);
  while (element != null) {
    switch (this$static.getSkipLevel(element).ordinal) {
      case 0:
        return element;
      case 1:
        element = this$static.inner_0.getParentElement(element);
        break;
      case 2:
        element = this$static.inner_0.getParentElement(element);
        break;
      case 3:
        return null;
      default:throw new RuntimeException_1('Unimplemented');
    }
  }
  return null;
}

function $getPreviousSibling_3(this$static, node){
  var find_0, parent_0;
  parent_0 = $getParentElement_3(this$static, node);
  find_0 = this$static.getNextOrPrevNodeDepthFirst(this$static.inner_0, node, parent_0, false, false);
  return $getPreviousVisibleNodeDepthFirst(this$static, find_0, parent_0, true);
}

function $getPreviousVisibleNodeDepthFirst(this$static, find_0, stopAt, enterFirst){
  var enter;
  enter = enterFirst;
  while (find_0 != null) {
    switch (this$static.getSkipLevel(find_0).ordinal) {
      case 0:
        return find_0;
      case 1:
        find_0 = this$static.getNextOrPrevNodeDepthFirst(this$static.inner_0, find_0, stopAt, enter, false);
        break;
      case 2:
        find_0 = this$static.getNextOrPrevNodeDepthFirst(this$static.inner_0, find_0, stopAt, false, false);
        break;
      case 3:
        return null;
      default:throw new RuntimeException_1('Unimplemented');
    }
    enter = true;
  }
  return null;
}

function $getVisibleNode(this$static, node){
  if (node == null) {
    return null;
  }
  switch (this$static.getSkipLevel(node).ordinal) {
    case 0:
      return node;
    case 1:
    case 2:
      return $getParentElement_3(this$static, node);
    case 3:
      return null;
    default:throw new RuntimeException_1('Unimplemented');
  }
}

function FilteredView_0(innerView){
  checkNotNull_1(innerView, 'IdentityView (or subclass): Inner document may not be null!');
  this.inner_0 = innerView;
}

function FilteredView(){
}

_ = FilteredView.prototype = new IdentityView;
_.getClass$ = function getClass_523(){
  return Lorg_waveprotocol_wave_model_document_util_FilteredView_2_classLit;
}
;
_.getFirstChild_0 = function getFirstChild_4(node){
  var find_0;
  return find_0 = this.inner_0.getFirstChild_0(node) , $getNextVisibleNodeDepthFirst(this, find_0, node);
}
;
_.getLastChild_0 = function getLastChild_4(node){
  var find_0;
  return find_0 = this.inner_0.getLastChild_0(node) , $getPreviousVisibleNodeDepthFirst(this, find_0, node, true);
}
;
_.getNextOrPrevNodeDepthFirst = function getNextOrPrevNodeDepthFirst(doc, start, stopAt, enter, rightwards){
  return getNextOrPrevNodeDepthFirst_1(doc, start, stopAt, enter, rightwards);
}
;
_.getNextSibling = function getNextSibling_2(node){
  return $getNextSibling_3(this, node);
}
;
_.getParentElement = function getParentElement_2(node){
  return $getParentElement_3(this, node);
}
;
_.getPreviousSibling = function getPreviousSibling_2(node){
  return $getPreviousSibling_3(this, node);
}
;
_.onBeforeFilter = function onBeforeFilter(at){
}
;
_.castableTypeMap$ = {19:1, 20:1, 155:1, 156:1};
function $getNextOrPrevNodeDepthFirst_0(this$static, doc, start, stopAt, enter, rightwards){
  var $e0, e, next, stopAtWrapper, tries;
  if (start.nodeType != 3 && !!start[$clinit_790() , COMPLEX_IMPLEMENTATION_MARKER]) {
    e = start;
    while ($clinit_1033() , !(!!e && (e[BACKREF_NAME] || null) != null)) {
      e = $getParentElement(e);
    }
    stopAtWrapper = null;
    for (tries = 1; tries <= 3; ++tries) {
      try {
        stopAtWrapper = $findNodeWrapper(this$static.this$0.nodeManager, stopAt);
        break;
      }
       catch ($e0) {
        $e0 = caught_0($e0);
        if (instanceOf($e0, 226)) {
          stopAt = $getParentElement(stopAt);
        }
         else 
          throw $e0;
      }
    }
    next = dynamicCast(getNextOrPrevNodeDepthFirst_1(this$static.this$0.renderedContentView, !e?null:dynamicCast(e[BACKREF_NAME] || null, 196), stopAtWrapper, enter, rightwards), 197);
    return next?next.getImplNodelet():null;
  }
   else {
    return dynamicCastJso(getNextOrPrevNodeDepthFirst_1(doc, start, stopAt, enter, rightwards));
  }
}

function $getSkipLevel(this$static, node){
  var element, level;
  if (node.nodeType == 3 || ($clinit_1033() , !!node && (node[BACKREF_NAME] || null) != null)) {
    return $clinit_2121() , NONE_5;
  }
   else {
    element = node;
    level = ($clinit_1033() , dynamicCast(element[TRANSPARENCY] || null, 154));
    if (!level) {
      if (!$isOrHasChild(dynamicCastJso(this$static.inner_0.getDocumentElement()), element)) {
        return $clinit_2121() , INVALID;
      }
      element[TRANSPARENCY] = ($clinit_2121() , SHALLOW);
      element[TRANSPARENT_BACKREF] = this$static;
      $add_9(this$static.invadingElements, element);
    }
    return !level?($clinit_2121() , SHALLOW):level;
  }
}

function ContentDocument$FilteredHtml_0(this$0, rawView){
  this.this$0 = this$0;
  checkNotNull_1(rawView, 'IdentityView (or subclass): Inner document may not be null!');
  this.inner_0 = rawView;
  this.invadingElements = new ArrayList_0;
}

function ContentDocument$FilteredHtml(){
}

_ = ContentDocument$FilteredHtml_0.prototype = ContentDocument$FilteredHtml.prototype = new FilteredView;
_.getClass$ = function getClass_524(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$FilteredHtml_2_classLit;
}
;
_.getNextOrPrevNodeDepthFirst = function getNextOrPrevNodeDepthFirst_0(doc, start, stopAt, enter, rightwards){
  return $getNextOrPrevNodeDepthFirst_0(this, doc, dynamicCastJso(start), dynamicCastJso(stopAt), enter, rightwards);
}
;
_.getSkipLevel = function getSkipLevel(node){
  return $getSkipLevel(this, dynamicCastJso(node));
}
;
_.castableTypeMap$ = {19:1, 20:1, 155:1, 156:1};
_.this$0 = null;
function $getProperty_0(property, element){
  return $getProperty_2(property, dynamicCast(element, 196));
}

function $transparentCreate(this$static, tagName, attributes, parent_0, nodeAfter){
  $saveSelection_0(this$static.this$0.selectionMaintainer);
  try {
    return $transparentCreate_1(this$static.this$0.persistentContentView, tagName, attributes, parent_0, nodeAfter);
  }
   finally {
    $restoreSelection(this$static.this$0.selectionMaintainer, null);
  }
}

function $transparentCreate_0(this$static, tagName, attributes, parent_0, nodeAfter){
  return $transparentCreate(this$static, tagName, attributes, dynamicCast(parent_0, 196), dynamicCast(nodeAfter, 197));
}

function $transparentDeepRemove(this$static, node){
  $saveSelection_0(this$static.this$0.selectionMaintainer);
  try {
    $transparentDeepRemove_0(this$static.this$0.persistentContentView, node);
  }
   finally {
    $restoreSelection(this$static.this$0.selectionMaintainer, null);
  }
}

function $transparentMove(this$static, newParent, fromIncl, toExcl, refChild){
  $saveSelection_0(this$static.this$0.selectionMaintainer);
  try {
    $transparentMove_1(this$static.this$0.persistentContentView, newParent, fromIncl, toExcl, refChild);
  }
   finally {
    $restoreSelection(this$static.this$0.selectionMaintainer, null);
  }
}

function $transparentMove_0(this$static, newParent, fromIncl, toExcl, refChild){
  $transparentMove(this$static, newParent, dynamicCast(fromIncl, 197), dynamicCast(toExcl, 197), refChild);
}

function $transparentSlice(this$static, splitAt){
  return dynamicCast($transparentSlice_0(this$static.this$0.persistentContentView, splitAt), 197);
}

function $transparentUnwrap(this$static, element){
  $saveSelection_0(this$static.this$0.selectionMaintainer);
  try {
    $transparentUnwrap_0(this$static.this$0.persistentContentView, element);
  }
   finally {
    $restoreSelection(this$static.this$0.selectionMaintainer, null);
  }
}

function ContentDocument$FullContent_0(this$0, inner){
  this.this$0 = this$0;
  checkNotNull_1(inner, 'IdentityView (or subclass): Inner document may not be null!');
  this.inner_0 = inner;
}

function ContentDocument$FullContent(){
}

_ = ContentDocument$FullContent_0.prototype = ContentDocument$FullContent.prototype = new IdentityView;
_.getClass$ = function getClass_525(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$FullContent_2_classLit;
}
;
_.getProperty = function getProperty(property, element){
  return $getProperty_0(property, dynamicCast(element, 196));
}
;
_.toString$ = function toString_58(){
  return 'FullContentView: ' + $toString_17(dynamicCast(this.inner_0.getDocumentElement(), 196));
}
;
_.castableTypeMap$ = {19:1, 20:1, 156:1};
_.this$0 = null;
function $clinit_835(){
  $clinit_835 = nullMethod;
  SHELVED = new ContentDocument$Level_0('SHELVED', 0);
  RENDERED = new ContentDocument$Level_0('RENDERED', 1);
  INTERACTIVE = new ContentDocument$Level_0('INTERACTIVE', 2);
  EDITING = new ContentDocument$Level_0('EDITING', 3);
  $VALUES_22 = initValues(_3Lorg_waveprotocol_wave_client_editor_content_ContentDocument$Level_2_classLit, {9:1, 68:1, 170:1}, 99, [SHELVED, RENDERED, INTERACTIVE, EDITING]);
}

function ContentDocument$Level_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_29(name_0){
  $clinit_835();
  return valueOf_0(($clinit_836() , $MAP_22), name_0);
}

function values_23(){
  $clinit_835();
  return $VALUES_22;
}

function ContentDocument$Level(){
}

_ = ContentDocument$Level_0.prototype = ContentDocument$Level.prototype = new Enum;
_.getClass$ = function getClass_526(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$Level_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 99:1};
var $VALUES_22, EDITING, INTERACTIVE, RENDERED, SHELVED;
function $clinit_836(){
  $clinit_836 = nullMethod;
  $MAP_22 = createValueOfMap(($clinit_835() , $VALUES_22));
}

var $MAP_22;
function $annotationIntervals_2(this$static, start, end, keys){
  return $annotationIntervals(this$static.fullAnnotationSet, start, end, keys);
}

function $checkLocalKey(key){
  if (key.charCodeAt(0) != 64) {
    throw new IllegalArgumentException_1('Not a local annotation key: ' + key);
  }
}

function $resetAnnotation_1(this$static, start, end, key, value){
  checkPositionIndexesInRange(start, end, this$static.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1);
  $checkLocalKey(key);
  if (end - start > 0) {
    $begin(this$static.fullAnnotationSet);
    $startAnnotation(this$static.fullAnnotationSet, key, null);
    start > 0 && $skip(this$static.fullAnnotationSet, start);
    $startAnnotation(this$static.fullAnnotationSet, key, value);
    $skip(this$static.fullAnnotationSet, end - start);
    $startAnnotation(this$static.fullAnnotationSet, key, null);
    this$static.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1 - end > 0 && $skip(this$static.fullAnnotationSet, this$static.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1 - end);
    $endAnnotationUnchecked(this$static.fullAnnotationSet, key);
    $finish_0(this$static.fullAnnotationSet);
  }
}

function $setAnnotation_0(this$static, start, end, key, value){
  checkPositionIndexesInRange(start, end, this$static.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1);
  $checkLocalKey(key);
  if (end - start > 0) {
    $begin(this$static.fullAnnotationSet);
    start > 0 && $skip(this$static.fullAnnotationSet, start);
    $startAnnotation(this$static.fullAnnotationSet, key, value);
    end - start > 0 && $skip(this$static.fullAnnotationSet, end - start);
    $endAnnotationUnchecked(this$static.fullAnnotationSet, key);
    $finish_0(this$static.fullAnnotationSet);
  }
}

function LocalAnnotationSetImpl(){
}

_ = LocalAnnotationSetImpl.prototype = new Object_0;
_.annotationIntervals = function annotationIntervals_2(start, end, keys){
  return $annotationIntervals(this.fullAnnotationSet, start, end, keys);
}
;
_.firstAnnotationChange = function firstAnnotationChange_2(start, end, key, fromValue){
  return $firstAnnotationChange(this.fullAnnotationSet, start, end, key, fromValue);
}
;
_.forEachAnnotationAt = function forEachAnnotationAt_2(location_0, callback){
  throw new RuntimeException_1('not implemented');
}
;
_.getAnnotation = function getAnnotation_2(start, key){
  return $getAnnotation(this.fullAnnotationSet, start, key);
}
;
_.getClass$ = function getClass_527(){
  return Lorg_waveprotocol_wave_model_document_util_LocalAnnotationSetImpl_2_classLit;
}
;
_.lastAnnotationChange = function lastAnnotationChange_2(start, end, key, fromValue){
  return $lastAnnotationChange(this.fullAnnotationSet, start, end, key, fromValue);
}
;
_.resetAnnotation = function resetAnnotation_0(start, end, key, value){
  $resetAnnotation_1(this, start, end, key, value);
}
;
_.size_1 = function size_34(){
  return this.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1;
}
;
_.castableTypeMap$ = {};
_.fullAnnotationSet = null;
function $consume_11(this$static, op){
  var $e0, e;
  try {
    $consume_7(this$static.this$0, op);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 201)) {
      e = $e0;
      throw e.opException;
    }
     else 
      throw $e0;
  }
}

function $endLocalAnnotation(this$static, key){
  $checkLocalKey(key);
  $endAnnotationUnchecked(this$static.fullAnnotationSet, key);
}

function $startLocalAnnotation(this$static, key, value){
  $checkLocalKey(key);
  $startAnnotation(this$static.fullAnnotationSet, key, value);
}

function ContentDocument$LocalAnnotationSet_0(this$0, fullAnnotationSet){
  this.this$0 = this$0;
  this.fullAnnotationSet = fullAnnotationSet;
}

function ContentDocument$LocalAnnotationSet(){
}

_ = ContentDocument$LocalAnnotationSet_0.prototype = ContentDocument$LocalAnnotationSet.prototype = new LocalAnnotationSetImpl;
_.getClass$ = function getClass_528(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$LocalAnnotationSet_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $clinit_840(){
  $clinit_840 = nullMethod;
  DEEP_TRANSPARENT_MARKER = new Object_1;
  DEEP_TRANSPARENT = new Property$ImmutableProperty_0('p_deep_transparent');
  HARD = new Property$ImmutableProperty_0('p_hard');
}

function $createElement_4(this$static, tagName, attributes, parent_0, nodeAfter){
  nodeAfter = $transparentSlice_0(this$static, nodeAfter);
  nodeAfter != null && (parent_0 = dynamicCast(nodeAfter, 197).parent_0);
  return $createElement_7(this$static.fullDoc, tagName, attributes, parent_0, nodeAfter);
}

function $createTextNode_0(this$static, data, parent_0, nodeAfter){
  nodeAfter = $transparentSlice_0(this$static, nodeAfter);
  nodeAfter != null && (parent_0 = dynamicCast(nodeAfter, 197).parent_0);
  return $createTextNode_4(this$static.fullDoc, data, parent_0, nodeAfter);
}

function $getSkipLevel_0(this$static, node){
  var element;
  return !!dynamicCast(node, 197).indexingContainer || (node == null?null:node) === maskUndefined(this$static.fullDoc.getDocumentElement_0())?($clinit_2121() , NONE_5):(element = this$static.inner_0.asElement_0(node) , element == null || $getProperty_2(DEEP_TRANSPARENT, dynamicCast(element, 196)) != null)?($clinit_2121() , DEEP):($clinit_2121() , SHALLOW);
}

function $isHard(this$static, node){
  var element;
  element = this$static.inner_0.asElement_0(node);
  return element == null || !!dynamicCast(element, 197).indexingContainer || $getProperty_2(HARD, dynamicCast(element, 196)) != null;
}

function $transparentCreate_1(this$static, tagName, attributes, parent_0, nodeAfter){
  var el;
  checkRelationship(this$static.fullDoc, parent_0, nodeAfter, 'transparentCreate');
  el = $createElement_7(this$static.fullDoc, tagName, attributes, parent_0, nodeAfter);
  return el;
}

function $transparentDeepRemove_0(this$static, node){
  if (!!dynamicCast(node, 197).indexingContainer || $getFirstChild_4(this$static.filteredDoc, node) != null) {
    throw new IllegalArgumentException_1('transparentDeepRemove: Cannot directly manipulate persistent elements');
  }
  $removeChild_5(this$static.fullDoc, dynamicCast(node, 197).parent_0, node);
}

function $transparentMove_1(this$static, newParent, fromIncl, toExcl, refChild){
  var node;
  if (!!refChild && dynamicCast(refChild, 197).parent_0 != newParent) {
    throw new IllegalArgumentException_1('refChild must be a child of newParent');
  }
  if (toExcl) {
    for (node = fromIncl; node != toExcl; node = dynamicCast(node, 197).next) {
      if (!node) {
        throw new IllegalArgumentException_1('toExcl must be null or be an indirect, following sibling of fromIncl');
      }
    }
  }
  $insertBefore_6(this$static.fullDoc, newParent, fromIncl, toExcl, refChild);
}

function $transparentSetAttribute_0(element, name_0, value){
  if (dynamicCast(element, 197).indexingContainer) {
    throw new IllegalArgumentException_1('transparentSetAttribute: node must not be persistent');
  }
  value != null?($setAttribute_2(dynamicCast(element, 196), name_0, value) , undefined):($removeAttribute_1(dynamicCast(element, 196), name_0) , undefined);
}

function $transparentSlice_0(this$static, splitAt){
  var newParent, newSibling, nodeAfter, parent_0;
  if (splitAt == null) {
    return null;
  }
  parent_0 = dynamicCast(splitAt, 197).parent_0;
  if (!parent_0) {
    throw new IllegalArgumentException_1('transparentSlice: Cannot split before the root element');
  }
  while (!$isHard(this$static, parent_0)) {
    newParent = dynamicCast(parent_0, 197).parent_0;
    if (!newParent) {
      throw new RuntimeException_1('The root node is not persistent!?!?');
    }
    if ((splitAt == null?null:splitAt) === maskUndefined(dynamicCast(parent_0, 197).getFirstChild())) {
      splitAt = parent_0;
    }
     else {
      nodeAfter = dynamicCast(parent_0, 197).next;
      newSibling = $createElement_7(this$static.fullDoc, dynamicCast(parent_0, 196).tagName_0, ($clinit_2309() , copyToJavaMap(dynamicCast(parent_0, 196).attributes, new HashMap_0)), newParent, nodeAfter);
      $insertBefore_5(this$static.fullDoc, newSibling, dynamicCast(splitAt, 197), null, null, null);
      splitAt = newSibling;
    }
    parent_0 = newParent;
  }
  return splitAt;
}

function $transparentUnwrap_0(this$static, element){
  var parent_0;
  if (dynamicCast(element, 197).indexingContainer) {
    throw new IllegalArgumentException_1('transparentUnwrap: Cannot directly manipulate persistent elements');
  }
  parent_0 = dynamicCast(element, 197).parent_0;
  $insertBefore_6(this$static.fullDoc, parent_0, dynamicCast(element, 197).getFirstChild(), null, element);
  $removeChild_5(this$static.fullDoc, parent_0, element);
}

function PersistentContent(){
}

_ = PersistentContent.prototype = new FilteredView;
_.appendData = function appendData(textNode, arg){
  $appendData_0(this.fullDoc, textNode, arg);
}
;
_.createElement_1 = function createElement_0(tagName, attributes, parent_0, nodeAfter){
  return $createElement_4(this, tagName, attributes, parent_0, nodeAfter);
}
;
_.createTextNode_0 = function createTextNode(data, parent_0, nodeAfter){
  return $createTextNode_0(this, data, parent_0, nodeAfter);
}
;
_.deleteData_0 = function deleteData(textNode, offset, count){
  $deleteData_1(this.fullDoc, textNode, offset, count);
}
;
_.getClass$ = function getClass_529(){
  return Lorg_waveprotocol_wave_model_document_util_PersistentContent_2_classLit;
}
;
_.getIndexingContainer = function getIndexingContainer(domNode){
  return dynamicCast(domNode, 197).indexingContainer;
}
;
_.getProperty = function getProperty_0(property, element){
  return $getProperty_2(property, dynamicCast(element, 196));
}
;
_.getSkipLevel = function getSkipLevel_0(node){
  var element;
  return !!dynamicCast(node, 197).indexingContainer || (node == null?null:node) === maskUndefined(this.fullDoc.getDocumentElement_0())?($clinit_2121() , NONE_5):(element = this.inner_0.asElement_0(node) , element == null || $getProperty_2(DEEP_TRANSPARENT, dynamicCast(element, 196)) != null)?($clinit_2121() , DEEP):($clinit_2121() , SHALLOW);
}
;
_.insertData_0 = function insertData(textNode, offset, arg){
  $insertData_2(this.fullDoc, textNode, offset, arg);
}
;
_.onBeforeFilter = function onBeforeFilter_0(at){
}
;
_.removeAttribute_0 = function removeAttribute(element, name_0){
  $removeAttribute_1(dynamicCast(element, 196), name_0);
}
;
_.removeChild_0 = function removeChild(parent_0, oldChild){
  $removeChild_5(this.fullDoc, dynamicCast(oldChild, 197).parent_0, oldChild);
}
;
_.setAttribute_0 = function setAttribute(element, name_0, value){
  $setAttribute_2(dynamicCast(element, 196), name_0, value);
}
;
_.setIndexingContainer = function setIndexingContainer(domNode, indexingNode){
  dynamicCast(domNode, 197).indexingContainer = indexingNode;
}
;
_.splitText_0 = function splitText_1(textNode, offset){
  return $splitText_4(this.fullDoc, textNode, offset);
}
;
_.toString$ = function toString_59(){
  return 'PersistentContent ' + createChildren(this, this.inner_0.getDocumentElement());
}
;
_.castableTypeMap$ = {19:1, 20:1, 155:1, 156:1};
_.fullDoc = null;
_.hardDoc = null;
var DEEP_TRANSPARENT, DEEP_TRANSPARENT_MARKER, HARD;
function RepaintingPersistentContent_0(fullDoc, elementManager){
  checkNotNull_1(fullDoc, 'IdentityView (or subclass): Inner document may not be null!');
  this.inner_0 = fullDoc;
  this.filteredDoc = this;
  this.fullDoc = fullDoc;
  $clinit_840();
  $setProperty_1(HARD, fullDoc.getDocumentElement_0(), HARD);
  this.hardDoc = new PersistentContent$HardContent_0(this);
}

function RepaintingPersistentContent(){
}

_ = RepaintingPersistentContent.prototype = new PersistentContent;
_.createTextNode_0 = function createTextNode_0(data, parent_0, nodeAfter){
  var textNode;
  return textNode = $createTextNode_0(this, data, parent_0, nodeAfter) , $add_9(this.this$0.nodesToRepaint, textNode) , textNode;
}
;
_.getClass$ = function getClass_530(){
  return Lorg_waveprotocol_wave_model_document_util_RepaintingPersistentContent_2_classLit;
}
;
_.insertData_0 = function insertData_0(textNode, offset, arg){
  $insertData_2(this.fullDoc, textNode, offset, arg);
  offset == 0 && ($add_9(this.this$0.nodesToRepaint, dynamicCast(textNode, 197)) , undefined);
}
;
_.removeChild_0 = function removeChild_0(parent_0, oldChild){
  var fullViewParent;
  fullViewParent = dynamicCast(oldChild, 197).parent_0;
  $removeChild_5(this.fullDoc, dynamicCast(oldChild, 197).parent_0, oldChild);
  !dynamicCast(fullViewParent, 197).getFirstChild() && $add_9(this.this$0.nodesToRepaint, fullViewParent);
}
;
_.castableTypeMap$ = {19:1, 20:1, 155:1, 156:1};
function PersistentContentView(){
}

_ = PersistentContentView.prototype = new RepaintingPersistentContent;
_.getClass$ = function getClass_531(){
  return Lorg_waveprotocol_wave_client_editor_content_PersistentContentView_2_classLit;
}
;
_.castableTypeMap$ = {19:1, 20:1, 155:1, 156:1};
_.inner = null;
function $createElement_5(this$static, tagName, attributes, parent_0, nodeAfter){
  var node;
  if (this$static.persistenceManager.nodeCreationDelegate) {
    node = $createElement_8(this$static.persistenceManager, tagName, attributes);
    $add_9(this$static.this$0.nodesToRepaint, node);
    return node;
  }
  return $createElement_4(this$static, tagName, attributes, parent_0, nodeAfter);
}

function $createTextNode_2(this$static, data, parent_0, nodeAfter){
  var node, textNode;
  if (this$static.persistenceManager.nodeCreationDelegate) {
    node = $createTextNode_5(this$static.persistenceManager, data);
    $add_9(this$static.this$0.nodesToRepaint, node);
    return node;
  }
  return textNode = $createTextNode_0(this$static, data, parent_0, nodeAfter) , $add_9(this$static.this$0.nodesToRepaint, textNode) , textNode;
}

function $onBeforeFilter(this$static, at){
  if (this$static.this$0.isConsistent && !this$static.isInsideFilter) {
    this$static.isInsideFilter = true;
    $updateLazyNodes(this$static.persistenceManager, dynamicCast(at.container, 197));
    this$static.isInsideFilter = false;
  }
}

function $setPersistenceManager(this$static, persistenceManager){
  checkArgument_2(!!persistenceManager, "Can't use a null persistence manager.");
  checkState_2(!this$static.persistenceManager, "Can't set persistence manager twice.");
  this$static.persistenceManager = persistenceManager;
}

function ContentDocument$PersistentContentDoc_0(this$0, fullRawSubstrate){
  $clinit_840();
  this.this$0 = this$0;
  RepaintingPersistentContent_0.call(this, fullRawSubstrate, ($clinit_790() , ELEMENT_MANAGER));
  this.inner = fullRawSubstrate;
}

function ContentDocument$PersistentContentDoc(){
}

_ = ContentDocument$PersistentContentDoc_0.prototype = ContentDocument$PersistentContentDoc.prototype = new PersistentContentView;
_.createElement_1 = function createElement_1(tagName, attributes, parent_0, nodeAfter){
  return $createElement_5(this, tagName, attributes, dynamicCast(parent_0, 196), dynamicCast(nodeAfter, 197));
}
;
_.createTextNode_0 = function createTextNode_1(data, parent_0, nodeAfter){
  return $createTextNode_2(this, data, dynamicCast(parent_0, 196), dynamicCast(nodeAfter, 197));
}
;
_.getClass$ = function getClass_532(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$PersistentContentDoc_2_classLit;
}
;
_.onBeforeFilter = function onBeforeFilter_1(at){
  $onBeforeFilter(this, at);
}
;
_.castableTypeMap$ = {19:1, 20:1, 155:1, 156:1};
_.isInsideFilter = false;
_.persistenceManager = null;
_.this$0 = null;
function ContentDocument$RenderedContent_0(rawView){
  checkNotNull_1(rawView, 'IdentityView (or subclass): Inner document may not be null!');
  this.inner_0 = rawView;
}

function ContentDocument$RenderedContent(){
}

_ = ContentDocument$RenderedContent_0.prototype = ContentDocument$RenderedContent.prototype = new FilteredView;
_.getClass$ = function getClass_533(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$RenderedContent_2_classLit;
}
;
_.getSkipLevel = function getSkipLevel_1(node){
  return $isRendered(dynamicCast(node, 197))?($clinit_2121() , NONE_5):($clinit_2121() , SHALLOW);
}
;
_.castableTypeMap$ = {19:1, 20:1, 155:1, 156:1};
function ContentDocument$SchemaViolatingLocalOperationException_0(violation){
  ContentDocument$LocalOperationException_0.call(this, violation);
  checkArgument_2((violation.operationIllFormed.size_0 == 0?violation.operationInvalid.size_0 == 0?violation.schemaViolations.size_0 == 0?($clinit_2006() , VALID):($clinit_2006() , INVALID_SCHEMA):($clinit_2006() , INVALID_DOCUMENT):($clinit_2006() , ILL_FORMED)) == ($clinit_2006() , INVALID_SCHEMA), 'Not a schema violation');
}

function ContentDocument$SchemaViolatingLocalOperationException(){
}

_ = ContentDocument$SchemaViolatingLocalOperationException_0.prototype = ContentDocument$SchemaViolatingLocalOperationException.prototype = new ContentDocument$LocalOperationException;
_.getClass$ = function getClass_534(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$SchemaViolatingLocalOperationException_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 21:1, 39:1, 183:1, 202:1};
function $consumeAndReturnInvertible_0(this$static, op){
  var docOp;
  docOp = $consumeLocal(this$static.this$0, op, this$static.saveSelection);
  this$static.this$0.outgoingOperationSink.consume(docOp);
  return docOp;
}

function ContentDocument$SourceNindoSink_0(this$0, saveSelection){
  this.this$0 = this$0;
  this.saveSelection = saveSelection;
}

function ContentDocument$SourceNindoSink(){
}

_ = ContentDocument$SourceNindoSink_0.prototype = ContentDocument$SourceNindoSink.prototype = new Object_0;
_.getClass$ = function getClass_535(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentDocument$SourceNindoSink_2_classLit;
}
;
_.castableTypeMap$ = {};
_.saveSelection = false;
_.this$0 = null;
function $getProperty_2(property, element){
  return element.transientData.get_0(property.id_0);
}

function $setProperty_0(property, element, value){
  element.transientData.put_1(property.id_0, value);
}

function $setProperty_1(property, element, value){
  $setProperty_0(property, dynamicCast(element, 196), value);
}

function ContentElement$1_0(){
}

function ContentElement$1(){
}

_ = ContentElement$1_0.prototype = ContentElement$1.prototype = new Object_0;
_.getClass$ = function getClass_536(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentElement$1_2_classLit;
}
;
_.getProperty = function getProperty_1(property, element){
  return $getProperty_2(property, dynamicCast(element, 196));
}
;
_.castableTypeMap$ = {};
function ContentNode$1_0(this$0){
  this.this$0 = this$0;
}

function ContentNode$1(){
}

_ = ContentNode$1_0.prototype = ContentNode$1.prototype = new Object_0;
_.execute_0 = function execute_22(){
  $revert(this.this$0.context.this$0.renderingConcerns.this$0.repairer, new Point$El_0(this.this$0.parent_0, this.this$0), null);
}
;
_.getClass$ = function getClass_537(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentNode$1_2_classLit;
}
;
_.castableTypeMap$ = {252:1, 253:1};
_.this$0 = null;
function PointRange_0(collapsedAt){
  this.first = collapsedAt;
  this.second = collapsedAt;
  this.isCollapsed = true;
}

function PointRange_1(first, second){
  this.first = first;
  this.second = second;
  this.isCollapsed = $equals_11(first, second);
}

function PointRange(){
}

_ = PointRange_1.prototype = PointRange_0.prototype = PointRange.prototype = new Object_0;
_.equals$ = function equals_28(obj){
  var other;
  if (this === obj) {
    return true;
  }
  if (obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[441]) {
    other = dynamicCast(obj, 441);
    return $equals_11(this.first, other.first) && $equals_11(this.second, other.second);
  }
  return false;
}
;
_.getClass$ = function getClass_539(){
  return Lorg_waveprotocol_wave_model_document_util_PointRange_2_classLit;
}
;
_.hashCode$ = function hashCode_28(){
  var result;
  result = 31 + (!this.first?0:$hashCode_9(this.first));
  result = 31 * result + (!this.second?0:$hashCode_9(this.second));
  return result;
}
;
_.toString$ = function toString_61(){
  return this.isCollapsed?'Collapsed:[' + this.first + ']':'Range:[' + this.first + ', ' + this.second + ']';
}
;
_.castableTypeMap$ = {441:1};
_.first = null;
_.isCollapsed = false;
_.second = null;
function $clinit_853(){
  $clinit_853 = nullMethod;
  INSTANCE_6 = new FullContentView_0;
}

function $asElement_3(node){
  return node?node.asElement():null;
}

function $asText_2(node){
  return node?node.asText():null;
}

function $getAttribute_3(element, name_0){
  return dynamicCast(element.attributes.get_4(name_0), 1);
}

function FullContentView_0(){
}

function FullContentView(){
}

_ = FullContentView_0.prototype = FullContentView.prototype = new Object_0;
_.asElement_0 = function asElement_4(node){
  return $asElement_3(dynamicCast(node, 197));
}
;
_.asText_0 = function asText_4(node){
  return $asText_2(dynamicCast(node, 197));
}
;
_.getAttribute_0 = function getAttribute_2(element, name_0){
  return $getAttribute_3(dynamicCast(element, 196), name_0);
}
;
_.getAttributes = function getAttributes_2(element){
  return $clinit_2309() , copyToJavaMap(dynamicCast(element, 196).attributes, new HashMap_0);
}
;
_.getClass$ = function getClass_541(){
  return Lorg_waveprotocol_wave_client_editor_content_FullContentView_2_classLit;
}
;
_.getData = function getData_2(textNode){
  return dynamicCast(textNode, 225).data_0;
}
;
_.getDocumentElement_0 = function getDocumentElement_2(){
  throw new RuntimeException_1('This is not implemented because the view is meant as a generic singleton');
}
;
_.getDocumentElement = function getDocumentElement_3(){
  return this.getDocumentElement_0();
}
;
_.getFirstChild_0 = function getFirstChild_5(node){
  return dynamicCast(node, 197).getFirstChild();
}
;
_.getLastChild_0 = function getLastChild_5(node){
  return dynamicCast(node, 197).getLastChild();
}
;
_.getLength = function getLength_2(textNode){
  return dynamicCast(textNode, 225).data_0.length;
}
;
_.getNextSibling = function getNextSibling_3(node){
  return dynamicCast(node, 197).next;
}
;
_.getNodeType_0 = function getNodeType_3(node){
  return dynamicCast(node, 197).getNodeType();
}
;
_.getParentElement = function getParentElement_3(node){
  return dynamicCast(node, 197).parent_0;
}
;
_.getPreviousSibling = function getPreviousSibling_3(node){
  return dynamicCast(node, 197).prev;
}
;
_.getTagName = function getTagName_2(element){
  return dynamicCast(element, 196).tagName_0;
}
;
_.isSameNode = function isSameNode_2(node, other){
  return dynamicCast(node, 197) == dynamicCast(other, 197);
}
;
_.castableTypeMap$ = {19:1, 20:1};
var INSTANCE_6;
function $appendData(this$static, textNode, arg){
  $clinit_761();
  ++ignoreMutations;
  try {
    $insertData_1(this$static, textNode, textNode.data_0.length, arg);
  }
   finally {
    --ignoreMutations;
  }
}

function $appendData_0(this$static, textNode, arg){
  $appendData(this$static, dynamicCast(textNode, 225), arg);
}

function $clearAffectHtml(this$static){
  checkState_2(this$static.affectImpl, 'Already not affectImpl');
  this$static.affectImpl = false;
}

function $createElement_6(this$static, tagName, attributes, parent_0, nodeAfter){
  var newElement;
  newElement = $createElement_3(this$static.factory, tagName, attributes);
  $clinit_761();
  ++ignoreMutations;
  try {
    $insertBefore_5(this$static, parent_0, newElement, null, nodeAfter, this$static.factory);
    return newElement;
  }
   finally {
    --ignoreMutations;
  }
}

function $createElement_7(this$static, tagName, attributes, parent_0, nodeAfter){
  return $createElement_6(this$static, tagName, attributes, dynamicCast(parent_0, 196), dynamicCast(nodeAfter, 197));
}

function $createTextNode_3(this$static, data, parent_0, nodeAfter){
  var newTextNode;
  newTextNode = $createText(this$static.factory, data);
  $clinit_761();
  ++ignoreMutations;
  try {
    $insertBefore_4(this$static, parent_0, newTextNode, nodeAfter);
    return newTextNode;
  }
   finally {
    --ignoreMutations;
  }
}

function $createTextNode_4(this$static, data, parent_0, nodeAfter){
  return $createTextNode_3(this$static, data, dynamicCast(parent_0, 196), dynamicCast(nodeAfter, 197));
}

function $deleteData_0(this$static, textNode, offset, count){
  $clinit_761();
  ++ignoreMutations;
  try {
    $deleteData_2(textNode, offset, count, this$static.affectImpl);
  }
   finally {
    --ignoreMutations;
  }
}

function $deleteData_1(this$static, textNode, offset, count){
  $deleteData_0(this$static, dynamicCast(textNode, 225), offset, count);
}

function $insertBefore_4(this$static, parent_0, newChild, refChild){
  $clinit_761();
  ++ignoreMutations;
  try {
    return $insertBefore_1(parent_0, newChild, refChild, this$static.affectImpl);
  }
   finally {
    --ignoreMutations;
  }
}

function $insertBefore_5(this$static, parent_0, from, to, refChild, factory){
  $clinit_761();
  ++ignoreMutations;
  try {
    return $insertBefore_2(parent_0, from, to, refChild, this$static.affectImpl, factory);
  }
   finally {
    --ignoreMutations;
  }
}

function $insertBefore_6(this$static, parent_0, from, to, refChild){
  return $insertBefore_5(this$static, parent_0, dynamicCast(from, 197), to, refChild, null);
}

function $insertData_1(this$static, textNode, offset, arg){
  $clinit_761();
  ++ignoreMutations;
  try {
    $insertData_3(textNode, offset, arg, this$static.affectImpl);
  }
   finally {
    --ignoreMutations;
  }
}

function $insertData_2(this$static, textNode, offset, arg){
  $insertData_1(this$static, dynamicCast(textNode, 225), offset, arg);
}

function $removeAttribute_1(element, name_0){
  var old;
  $clinit_761();
  ++ignoreMutations;
  try {
    old = dynamicCast(element.attributes.get_4(name_0), 1);
    element.attributes.remove_8(name_0);
    $notifyAttributeModified(element, name_0, old, null);
  }
   finally {
    --ignoreMutations;
  }
}

function $removeChild_4(this$static, parent_0, oldChild){
  $clinit_761();
  ++ignoreMutations;
  try {
    $removeChild_2(parent_0, oldChild, this$static.affectImpl);
  }
   finally {
    --ignoreMutations;
  }
}

function $removeChild_5(this$static, parent_0, oldChild){
  $removeChild_4(this$static, dynamicCast(parent_0, 196), dynamicCast(oldChild, 197));
}

function $setAffectHtml(this$static){
  checkState_2(!this$static.affectImpl, 'Already affectImpl is true');
  this$static.affectImpl = true;
}

function $setAttribute_2(element, name_0, value){
  var old;
  $clinit_761();
  ++ignoreMutations;
  try {
    old = dynamicCast(element.attributes.get_4(name_0), 1);
    element.attributes.put_3(name_0, value);
    $notifyAttributeModified(element, name_0, old, value);
  }
   finally {
    --ignoreMutations;
  }
}

function $splitText_3(this$static, textNode, offset){
  $clinit_761();
  ++ignoreMutations;
  try {
    return $splitText_5(textNode, offset, this$static.affectImpl);
  }
   finally {
    --ignoreMutations;
  }
}

function $splitText_4(this$static, textNode, offset){
  return $splitText_3(this$static, dynamicCast(textNode, 225), offset);
}

function ContentRawDocument_0(rootElement, factory){
  $clinit_853();
  this.rootElement = rootElement;
  this.factory = factory;
}

function ContentRawDocument(){
}

_ = ContentRawDocument_0.prototype = ContentRawDocument.prototype = new FullContentView;
_.appendData = function appendData_0(textNode, arg){
  $appendData(this, dynamicCast(textNode, 225), arg);
}
;
_.createElement_1 = function createElement_2(tagName, attributes, parent_0, nodeAfter){
  return $createElement_6(this, tagName, attributes, dynamicCast(parent_0, 196), dynamicCast(nodeAfter, 197));
}
;
_.createTextNode_0 = function createTextNode_2(data, parent_0, nodeAfter){
  return $createTextNode_3(this, data, dynamicCast(parent_0, 196), dynamicCast(nodeAfter, 197));
}
;
_.deleteData_0 = function deleteData_0(textNode, offset, count){
  $deleteData_0(this, dynamicCast(textNode, 225), offset, count);
}
;
_.getClass$ = function getClass_542(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentRawDocument_2_classLit;
}
;
_.getDocumentElement_0 = function getDocumentElement_4(){
  return this.rootElement;
}
;
_.getIndexingContainer = function getIndexingContainer_0(domNode){
  return dynamicCast(domNode, 197).indexingContainer;
}
;
_.insertData_0 = function insertData_1(textNode, offset, arg){
  $insertData_1(this, dynamicCast(textNode, 225), offset, arg);
}
;
_.removeAttribute_0 = function removeAttribute_0(element, name_0){
  $removeAttribute_1(dynamicCast(element, 196), name_0);
}
;
_.removeChild_0 = function removeChild_1(parent_0, oldChild){
  $removeChild_4(this, dynamicCast(parent_0, 196), dynamicCast(oldChild, 197));
}
;
_.setAttribute_0 = function setAttribute_0(element, name_0, value){
  $setAttribute_2(dynamicCast(element, 196), name_0, value);
}
;
_.setIndexingContainer = function setIndexingContainer_0(domNode, indexingContainer){
  dynamicCast(domNode, 197).indexingContainer = indexingContainer;
}
;
_.splitText_0 = function splitText_2(textNode, offset){
  return $splitText_3(this, dynamicCast(textNode, 225), offset);
}
;
_.castableTypeMap$ = {19:1, 20:1};
_.affectImpl = false;
_.factory = null;
_.rootElement = null;
function $clinit_856(){
  $clinit_856 = nullMethod;
  $clinit_789();
  nodeletOffsetOutput = new HtmlPoint_0;
}

function $deleteData_2(this$static, offset, count, affectImpl){
  var data, filteredHtml, fromIncl, next, node, nodelet, subOffset, toExcl, nodelet_0;
  data = this$static.data_0;
  $setContentData(this$static, data.substr(0, offset - 0) + $substring_0(data, offset + count, data.length));
  if (affectImpl) {
    if (nodelet_0 = this$static.getImplNodelet() , !!nodelet_0 && !!$getParentElement(nodelet_0)) {
      $findNodeletWithOffset_0(this$static, offset, nodeletOffsetOutput, this$static.context);
      nodelet = nodeletOffsetOutput.node;
      subOffset = nodeletOffsetOutput.offset;
      if (nodelet.length - subOffset >= count) {
        nodelet.deleteData(subOffset, count);
        this$static.context.this$0.editingConcerns.textNodeletAffected(nodelet, subOffset, -count, ($clinit_888() , DATA));
      }
       else {
        toExcl = $implSplitText(this$static, offset + count);
        fromIncl = $implSplitText(this$static, offset);
        filteredHtml = this$static.context.this$0.renderingConcerns.this$0.filteredHtmlView;
        for (node = fromIncl; node != toExcl && !!node;) {
          next = dynamicCastJso($getNextSibling_3(filteredHtml, node));
          $removeFromParent(node);
          node = next;
        }
      }
    }
     else {
      this$static.implNodelet.deleteData(offset, count);
    }
  }
}

function $findNodeletWithOffset(this$static, offset, output){
  var next;
  $findNodeletWithOffset_1(this$static, offset, output, (next = checkNodeAndNeighbour(this$static) , !next?null:next.getImplNodelet()));
}

function $findNodeletWithOffset_0(this$static, offset, output){
  var $e0, e, tries, next;
  for (tries = 0; tries < 3; ++tries) {
    try {
      $findNodeletWithOffset_1(this$static, offset, output, (next = checkNodeAndNeighbour(this$static) , !next?null:next.getImplNodelet()));
      return;
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 205)) {
        e = $e0;
        $handleMissing(this$static.context.this$0.renderingConcerns.this$0.repairer, e);
      }
       else 
        throw $e0;
    }
  }
  throw new EditorRuntimeException_0("Tried to repair and it just wouldn't work");
}

function $findNodeletWithOffset_1(this$static, offset, output, nextImpl){
  var filteredHtml, nodelet, prevSum, sum;
  filteredHtml = this$static.context.this$0.renderingConcerns.this$0.filteredHtmlView;
  sum = 0;
  for (nodelet = this$static.implNodelet; nodelet != nextImpl; nodelet = dynamicCastJso($getNextSibling_3(filteredHtml, nodelet))) {
    prevSum = sum;
    sum += nodelet.length;
    if (sum >= offset) {
      output.node = nodelet;
      output.offset = offset - prevSum;
      return;
    }
  }
  output.node = null;
}

function $getOffset(this$static, textNodelet){
  var $e0, next;
  try {
    return $getOffset_0(this$static, textNodelet, (next = checkNodeAndNeighbour(this$static) , !next?null:next.getImplNodelet()));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 183)) {
      throw new InconsistencyException$HtmlMissing_0(this$static, dynamicCast($getParentElement_3(this$static.context.this$0.renderingConcerns.this$0.renderedContentView, this$static), 196).implNodelet);
    }
     else 
      throw $e0;
  }
}

function $getOffset_0(this$static, textNodelet, nextImpl){
  return getOffset(textNodelet, this$static.implNodelet, nextImpl, this$static.context.this$0.renderingConcerns.this$0.filteredHtmlView);
}

function $implSplitText(this$static, offset){
  var nodeletOffset, ret, text;
  $findNodeletWithOffset_0(this$static, offset, nodeletOffsetOutput, this$static.context);
  text = nodeletOffsetOutput.node;
  if (text.length == nodeletOffsetOutput.offset) {
    return text.nextSibling;
  }
   else if (nodeletOffsetOutput.offset == 0) {
    return text;
  }
   else {
    nodeletOffset = nodeletOffsetOutput.offset;
    ret = text.splitText(nodeletOffset);
    this$static.context.this$0.editingConcerns.textNodeletAffected(text, nodeletOffset, -10000, ($clinit_888() , SPLIT));
    return ret;
  }
}

function $insertData_3(this$static, offset, arg, affectImpl){
  var data, nodelet, nodeletOffset;
  data = this$static.data_0;
  $setContentData(this$static, data.substr(0, offset - 0) + arg + $substring_0(data, offset, data.length));
  if (affectImpl) {
    $findNodeletWithOffset_0(this$static, offset, nodeletOffsetOutput, this$static.context);
    nodelet = nodeletOffsetOutput.node;
    nodeletOffset = nodeletOffsetOutput.offset;
    nodelet.insertData(nodeletOffset, arg);
    this$static.context.this$0.editingConcerns.textNodeletAffected(nodelet, nodeletOffset, arg.length, ($clinit_888() , DATA));
  }
}

function $normaliseImpl(this$static){
  var $e0, e, i, nodelet, repairer;
  repairer = this$static.context.this$0.renderingConcerns.this$0.repairer;
  for (i = 0; i < 50; ++i) {
    try {
      $normaliseImplThrow(this$static);
      return this$static.implNodelet;
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 205)) {
        e = $e0;
        $handleMissing(repairer, e);
      }
       else if (instanceOf($e0, 21)) {
        $revert(repairer, before_0(this$static.context.this$0.renderingConcerns.this$0.renderedContentView, this$static), null);
      }
       else 
        throw $e0;
    }
  }
  nodelet = this$static.implNodelet;
  this$static.context.this$0.editingConcerns.textNodeletAffected(nodelet, -1000, -1000, ($clinit_888() , REPLACE_DATA));
  nodelet.data = this$static.data_0;
  return nodelet;
}

function $normaliseImplThrow(this$static){
  var filteredHtml, first, next, nextImpl, nodelet, nodelet_0;
  (!$isContentAttached(this$static) || !(nodelet_0 = this$static.getImplNodelet() , !!nodelet_0 && !!$getParentElement(nodelet_0))) && (!this$static.implNodelet || this$static.implNodelet.length != this$static.data_0.length) && (this$static.implNodelet = $doc.createTextNode(this$static.data_0) , undefined);
  first = this$static.implNodelet;
  if (first.length == this$static.data_0.length) {
    return;
  }
  next = checkNodeAndNeighbour(this$static);
  filteredHtml = this$static.context.this$0.renderingConcerns.this$0.filteredHtmlView;
  nextImpl = !next?null:next.getImplNodelet();
  for (nodelet = first; nodelet != nextImpl && !!nodelet; nodelet = dynamicCastJso($getNextSibling_3(filteredHtml, first))) {
    if (nodelet != first) {
      this$static.context.this$0.editingConcerns.textNodeletAffected(nodelet, -1000, -1000, ($clinit_888() , REMOVE));
      $removeFromParent(nodelet);
    }
  }
  this$static.context.this$0.editingConcerns.textNodeletAffected(first, -1000, -1000, ($clinit_888() , REPLACE_DATA));
  first.data = this$static.data_0;
}

function $setContentData(this$static, newData){
  var parent_0;
  if (!$equals_3(newData, this$static.data_0)) {
    this$static.data_0 = newData;
    parent_0 = this$static.parent_0;
    !!parent_0 && $notifyChildrenMutated(parent_0);
  }
}

function $setRendering_0(this$static, isRendering){
  if (!!this$static.implNodelet == isRendering) {
    return;
  }
  isRendering?(this$static.implNodelet = $doc.createTextNode(this$static.data_0) , undefined):(this$static.implNodelet = null);
}

function $splitText_5(this$static, offset, affectImpl){
  var first, nodelet, second, sibling;
  if (offset == 0) {
    return this$static;
  }
   else if (offset >= this$static.data_0.length) {
    return null;
  }
  affectImpl?(nodelet = $implSplitText(this$static, offset)):(nodelet = $doc.createTextNode(''));
  first = this$static.data_0.substr(0, offset - 0);
  second = $substring(this$static.data_0, offset);
  sibling = new ContentTextNode_1(second, nodelet, this$static.context);
  $setContentData(this$static, first);
  $insertBefore_1(this$static.parent_0, sibling, this$static.next, false);
  return sibling;
}

function ContentTextNode_0(data, bundle){
  $clinit_856();
  this.context = bundle;
  this.implNodelet = null;
  this.data_0 = data;
}

function ContentTextNode_1(data, wrapped, bundle){
  $clinit_789();
  this.context = bundle;
  this.implNodelet = wrapped;
  this.data_0 = data;
}

function checkNodeAndNeighbour(node){
  var next, parentElement, renderedContent, nodelet, nodelet_0;
  renderedContent = node.context.this$0.renderingConcerns.this$0.renderedContentView;
  if (!(nodelet = node.getImplNodelet() , !!nodelet && !!$getParentElement(nodelet))) {
    parentElement = dynamicCast($getParentElement_3(renderedContent, node), 196).implNodelet;
    throw new InconsistencyException$HtmlMissing_0(node, parentElement);
  }
  next = dynamicCast($getNextSibling_3(renderedContent, node), 197);
  if (!!next && !(nodelet_0 = next.getImplNodelet() , !!nodelet_0 && !!$getParentElement(nodelet_0))) {
    parentElement = dynamicCast($getParentElement_3(renderedContent, node), 196).implNodelet;
    throw new InconsistencyException$HtmlMissing_0(next, parentElement);
  }
  return next;
}

function getOffset(textNodelet, startNode, nextImpl, view){
  $clinit_856();
  var nodelet, offset;
  offset = 0;
  for (nodelet = startNode; nodelet != nextImpl; nodelet = dynamicCastJso($getNextSibling_3(view, nodelet))) {
    if (nodelet == textNodelet) {
      return offset;
    }
    offset += nodelet.length;
  }
  throw new EditorRuntimeException_0("Didn't find text nodelet to get offset for");
}

function sumTextNodes(fromIncl, toExcl, filteredHtml){
  $clinit_856();
  var data, n;
  data = '';
  for (n = fromIncl; n != toExcl && !!n; n = dynamicCastJso($getNextSibling_3(filteredHtml, n))) {
    data += n.data;
  }
  return $replace_0(data, 160, 32);
}

function ContentTextNode(){
}

_ = ContentTextNode_1.prototype = ContentTextNode_0.prototype = ContentTextNode.prototype = new ContentNode;
_.asElement = function asElement_5(){
  return null;
}
;
_.asText = function asText_5(){
  return this;
}
;
_.getClass$ = function getClass_543(){
  return Lorg_waveprotocol_wave_client_editor_content_ContentTextNode_2_classLit;
}
;
_.getImplNodelet = function getImplNodelet_1(){
  return this.implNodelet;
}
;
_.getNodeType = function getNodeType_4(){
  return 3;
}
;
_.isConsistent_0 = function isConsistent_1(){
  var $e0, nodelet, filteredHtml, next, next_0;
  try {
    return (nodelet = this.getImplNodelet() , !!nodelet && !!$getParentElement(nodelet)) && $equals_3((next = (next_0 = checkNodeAndNeighbour(this) , !next_0?null:next_0.getImplNodelet()) , filteredHtml = this.context.this$0.renderingConcerns.this$0.filteredHtmlView , sumTextNodes(this.implNodelet, next, filteredHtml)), this.data_0);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 205)) {
      return false;
    }
     else if (instanceOf($e0, 39)) {
      return false;
    }
     else 
      throw $e0;
  }
}
;
_.isElement = function isElement_0(){
  return false;
}
;
_.isTextNode = function isTextNode_0(){
  return true;
}
;
_.normaliseImpl = function normaliseImpl_0(){
  return $normaliseImpl(this);
}
;
_.onAddedToParent_0 = function onAddedToParent_2(previousParent){
  var nodelet;
  (nodelet = this.getImplNodelet() , !!nodelet && !!$getParentElement(nodelet)) || (!this.implNodelet || this.implNodelet.length != this.data_0.length) && (this.implNodelet = $doc.createTextNode(this.data_0) , undefined);
}
;
_.revertImplementation = function revertImplementation_0(){
  this.implNodelet = $doc.createTextNode(this.data_0);
}
;
_.castableTypeMap$ = {10:1, 185:1, 197:1, 225:1, 376:1};
_.data_0 = '';
var nodeletOffsetOutput;
function $clinit_858(){
  $clinit_858 = nullMethod;
  DIFF_KEY = '@' + prefixIncrementor++ + '/diff';
  DIFF_INSERT_KEY = DIFF_KEY + '/ins';
  DIFF_DELETE_KEY = DIFF_KEY + '/del';
  INSERT_MARKER = new Object_1;
}

function $consume_12(this$static, op){
  var size;
  checkState_2(!this$static.target_0, 'Diff inner target not initialised');
  this$static.operation = op;
  $consume_11(this$static.inner, this$static.opWrapper);
  size = this$static.inner.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1;
  this$static.deleteInfos.each_1(new DiffHighlightingFilter$3_0(this$static, size));
}

function $maybeSavePreviousDeleteInfo(this$static){
  !!this$static.currentDeleteInfo && this$static.deleteInfos.put_1(this$static.currentDeleteLocation, this$static.currentDeleteInfo);
}

function DiffHighlightingFilter_0(contentDocument){
  $clinit_858();
  this.opWrapper = new DiffHighlightingFilter$1_0(this);
  this.filter = new DiffHighlightingFilter$2_0(this);
  this.inner = contentDocument;
}

function clearDiffs(target){
  $clinit_858();
  guardedResetAnnotation(target, 0, target.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1, DIFF_INSERT_KEY, null);
  guardedResetAnnotation(target, 0, target.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1, DIFF_DELETE_KEY, null);
}

function DiffHighlightingFilter(){
}

_ = DiffHighlightingFilter_0.prototype = DiffHighlightingFilter.prototype = new Object_0;
_.getClass$ = function getClass_544(){
  return Lorg_waveprotocol_wave_client_editor_content_DiffHighlightingFilter_2_classLit;
}
;
_.castableTypeMap$ = {};
_.currentDeleteInfo = null;
_.currentDeleteLocation = 0;
_.currentLocation = 0;
_.deleteInfos = null;
_.diffDepth = 0;
_.inner = null;
_.operation = null;
_.target_0 = null;
var DIFF_DELETE_KEY, DIFF_INSERT_KEY, DIFF_KEY, INSERT_MARKER;
function DiffOpWrapperBase(){
}

_ = DiffOpWrapperBase.prototype = new Object_0;
_.applyComponent = function applyComponent(i, c){
  throw new UnsupportedOperationException_1(this.exceptionMessage);
}
;
_.getAnnotationBoundary = function getAnnotationBoundary(i){
  throw new UnsupportedOperationException_1(this.exceptionMessage);
}
;
_.getCharactersString = function getCharactersString(i){
  throw new UnsupportedOperationException_1(this.exceptionMessage);
}
;
_.getClass$ = function getClass_545(){
  return Lorg_waveprotocol_wave_client_editor_content_DiffOpWrapperBase_2_classLit;
}
;
_.getDeleteCharactersString = function getDeleteCharactersString(i){
  throw new UnsupportedOperationException_1(this.exceptionMessage);
}
;
_.getDeleteElementStartAttributes = function getDeleteElementStartAttributes(i){
  throw new UnsupportedOperationException_1(this.exceptionMessage);
}
;
_.getDeleteElementStartTag = function getDeleteElementStartTag(i){
  throw new UnsupportedOperationException_1(this.exceptionMessage);
}
;
_.getElementStartAttributes = function getElementStartAttributes(i){
  throw new UnsupportedOperationException_1(this.exceptionMessage);
}
;
_.getElementStartTag = function getElementStartTag(i){
  throw new UnsupportedOperationException_1(this.exceptionMessage);
}
;
_.getReplaceAttributesNewAttributes = function getReplaceAttributesNewAttributes(i){
  throw new UnsupportedOperationException_1(this.exceptionMessage);
}
;
_.getReplaceAttributesOldAttributes = function getReplaceAttributesOldAttributes(i){
  throw new UnsupportedOperationException_1(this.exceptionMessage);
}
;
_.getRetainItemCount = function getRetainItemCount(i){
  throw new UnsupportedOperationException_1(this.exceptionMessage);
}
;
_.getType_0 = function getType_8(i){
  throw new UnsupportedOperationException_1(this.exceptionMessage);
}
;
_.getUpdateAttributesUpdate = function getUpdateAttributesUpdate(i){
  throw new UnsupportedOperationException_1(this.exceptionMessage);
}
;
_.size_1 = function size_35(){
  throw new UnsupportedOperationException_1(this.exceptionMessage);
}
;
_.castableTypeMap$ = {207:1};
_.exceptionMessage = null;
function $apply_1(this$static, innerCursor){
  if (!this$static.this$0.inner.this$0.applyingToDocument) {
    this$static.this$0.operation.apply_8(innerCursor);
    return;
  }
  this$static.this$0.target_0 = innerCursor;
  this$static.this$0.deleteInfos = ($clinit_2309() , defaultCollectionFactory.createIntMap());
  this$static.this$0.currentDeleteInfo = null;
  this$static.this$0.currentDeleteLocation = -1;
  this$static.this$0.currentLocation = 0;
  this$static.this$0.operation.apply_8(this$static.this$0.filter);
  $maybeSavePreviousDeleteInfo(this$static.this$0);
  this$static.this$0.target_0 = null;
}

function DiffHighlightingFilter$1_0(this$0){
  this.this$0 = this$0;
  this.exceptionMessage = "The document isn't expected to call this method";
}

function DiffHighlightingFilter$1(){
}

_ = DiffHighlightingFilter$1_0.prototype = DiffHighlightingFilter$1.prototype = new DiffOpWrapperBase;
_.apply_8 = function apply_27(innerCursor){
  $apply_1(this, innerCursor);
}
;
_.apply_7 = function apply_28(innerCursor){
  $apply_1(this, throwClassCastExceptionUnlessNull(innerCursor));
}
;
_.getClass$ = function getClass_546(){
  return Lorg_waveprotocol_wave_client_editor_content_DiffHighlightingFilter$1_2_classLit;
}
;
_.toString$ = function toString_62(){
  return 'DiffOpWrapper(' + this.this$0.operation + ')';
}
;
_.castableTypeMap$ = {207:1};
_.this$0 = null;
function $deletify(this$static, element){
  var n;
  if (!element) {
    return;
  }
  styleElement(element, ($clinit_1029() , DELETE_1));
  for (n = element.firstChild; n; n = n.nextSibling) {
    n.nodeType == 3 || $deletify(this$static, n);
  }
}

function $isOutsideInsertionAnnotation(this$static){
  var location_0;
  location_0 = this$static.this$0.currentLocation;
  return $firstAnnotationChange(this$static.this$0.inner.fullAnnotationSet, location_0, location_0 + 1, ($clinit_858() , DIFF_INSERT_KEY), null) == -1;
}

function $updateDeleteInfo(this$static){
  if (this$static.this$0.currentLocation != this$static.this$0.currentDeleteLocation || !this$static.this$0.currentDeleteInfo) {
    $maybeSavePreviousDeleteInfo(this$static.this$0);
    this$static.this$0.currentDeleteInfo = dynamicCast($getAnnotation(this$static.this$0.inner.fullAnnotationSet, this$static.this$0.currentLocation, ($clinit_858() , DIFF_DELETE_KEY)), 191);
    !this$static.this$0.currentDeleteInfo && (this$static.this$0.currentDeleteInfo = new DiffHighlightingFilter$DeleteInfo_0);
  }
  this$static.this$0.currentDeleteLocation = this$static.this$0.currentLocation;
}

function DiffHighlightingFilter$2_0(this$0){
  this.this$0 = this$0;
}

function DiffHighlightingFilter$2(){
}

_ = DiffHighlightingFilter$2_0.prototype = DiffHighlightingFilter$2.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary(map){
  this.this$0.target_0.annotationBoundary(map);
}
;
_.characters_0 = function characters_0(characters){
  this.this$0.diffDepth == 0 && $startLocalAnnotation(this.this$0.inner, ($clinit_858() , DIFF_INSERT_KEY), INSERT_MARKER);
  this.this$0.target_0.characters_0(characters);
  this.this$0.currentLocation += characters.length;
  this.this$0.diffDepth == 0 && $endLocalAnnotation(this.this$0.inner, ($clinit_858() , DIFF_INSERT_KEY));
}
;
_.deleteCharacters = function deleteCharacters(text){
  var e, endLocation, index, location_0, nextIndex, nextScanLocation, scanLocation, surroundedInfo;
  if (this.this$0.diffDepth == 0 && $isOutsideInsertionAnnotation(this)) {
    location_0 = this.this$0.currentLocation;
    endLocation = location_0 + text.length;
    $updateDeleteInfo(this);
    scanLocation = location_0;
    do {
      surroundedInfo = dynamicCast($getAnnotation(this.this$0.inner.fullAnnotationSet, scanLocation, ($clinit_858() , DIFF_DELETE_KEY)), 191);
      nextScanLocation = $firstAnnotationChange(this.this$0.inner.fullAnnotationSet, scanLocation, endLocation, DIFF_DELETE_KEY, surroundedInfo);
      nextScanLocation == -1 && (nextScanLocation = endLocation);
      index = scanLocation - location_0;
      nextIndex = nextScanLocation - location_0;
      e = $doc.createElement('span');
      styleElement(e, ($clinit_1029() , DELETE_1));
      e.textContent = text.substr(index, nextIndex - index) || '';
      $add_9(this.this$0.currentDeleteInfo.htmlElements, e);
      !!surroundedInfo && $addAll_0(this.this$0.currentDeleteInfo.htmlElements, surroundedInfo.htmlElements);
      scanLocation = nextScanLocation;
    }
     while (nextScanLocation < endLocation);
  }
  this.this$0.target_0.deleteCharacters(text);
}
;
_.deleteElementEnd = function deleteElementEnd(){
  this.this$0.target_0.deleteElementEnd();
  --this.this$0.diffDepth;
}
;
_.deleteElementStart = function deleteElementStart(type, attrs){
  var currentElement, e;
  if (this.this$0.diffDepth == 0 && $isOutsideInsertionAnnotation(this)) {
    currentElement = dynamicCast(dynamicCast(this.this$0.inner.this$0.indexedDoc.currentContainer.value_0, 197), 196);
    e = currentElement.implNodelet;
    ($clinit_916() , $equals_3('line', currentElement.tagName_0)) && (e = $doc.createElement('br'));
    if (e) {
      e = e.cloneNode(true);
      $deletify(this, e);
      $updateDeleteInfo(this);
      $add_9(this.this$0.currentDeleteInfo.htmlElements, e);
    }
  }
  ++this.this$0.diffDepth;
  this.this$0.target_0.deleteElementStart(type, attrs);
}
;
_.elementEnd = function elementEnd(){
  this.this$0.target_0.elementEnd();
  ++this.this$0.currentLocation;
  --this.this$0.diffDepth;
  this.this$0.diffDepth == 0 && $endLocalAnnotation(this.this$0.inner, ($clinit_858() , DIFF_INSERT_KEY));
}
;
_.elementStart = function elementStart(tagName, attributes){
  this.this$0.diffDepth == 0 && $startLocalAnnotation(this.this$0.inner, ($clinit_858() , DIFF_INSERT_KEY), INSERT_MARKER);
  ++this.this$0.diffDepth;
  this.this$0.target_0.elementStart(tagName, attributes);
  ++this.this$0.currentLocation;
}
;
_.getClass$ = function getClass_547(){
  return Lorg_waveprotocol_wave_client_editor_content_DiffHighlightingFilter$2_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes(oldAttrs, newAttrs){
  ++this.this$0.currentLocation;
  this.this$0.target_0.replaceAttributes(oldAttrs, newAttrs);
}
;
_.retain = function retain(itemCount){
  this.this$0.currentLocation += itemCount;
  this.this$0.target_0.retain(itemCount);
}
;
_.updateAttributes = function updateAttributes(attrUpdate){
  ++this.this$0.currentLocation;
  this.this$0.target_0.updateAttributes(attrUpdate);
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $apply_2(this$static, location_0, _item){
  var existing, item;
  if (location_0 == this$static.val$size) {
    return;
  }
  if (_item != null && _item.castableTypeMap$ && !!_item.castableTypeMap$[191]) {
    item = dynamicCast(_item, 191);
    existing = dynamicCast($getAnnotation(this$static.this$0.inner.fullAnnotationSet, location_0, ($clinit_858() , DIFF_DELETE_KEY)), 191);
    !!existing && $addAll_0(item.htmlElements, existing.htmlElements);
    $setAnnotation_0(this$static.this$0.inner, location_0, location_0 + 1, DIFF_DELETE_KEY, item);
  }
}

function DiffHighlightingFilter$3_0(this$0, val$size){
  this.this$0 = this$0;
  this.val$size = val$size;
}

function DiffHighlightingFilter$3(){
}

_ = DiffHighlightingFilter$3_0.prototype = DiffHighlightingFilter$3.prototype = new Object_0;
_.apply_0 = function apply_29(location_0, _item){
  $apply_2(this, location_0, _item);
}
;
_.getClass$ = function getClass_548(){
  return Lorg_waveprotocol_wave_client_editor_content_DiffHighlightingFilter$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$size = 0;
function DiffHighlightingFilter$DeleteInfo_0(){
  this.htmlElements = new ArrayList_0;
}

function DiffHighlightingFilter$DeleteInfo(){
}

_ = DiffHighlightingFilter$DeleteInfo_0.prototype = DiffHighlightingFilter$DeleteInfo.prototype = new Object_0;
_.getClass$ = function getClass_549(){
  return Lorg_waveprotocol_wave_client_editor_content_DiffHighlightingFilter$DeleteInfo_2_classLit;
}
;
_.castableTypeMap$ = {191:1};
function $clinit_866(){
  $clinit_866 = nullMethod;
  STUB_0 = new ExtendedClientDocumentContext$LowLevelEditingConcerns$1_0;
}

var STUB_0;
function ExtendedClientDocumentContext$LowLevelEditingConcerns$1_0(){
}

function ExtendedClientDocumentContext$LowLevelEditingConcerns$1(){
}

_ = ExtendedClientDocumentContext$LowLevelEditingConcerns$1_0.prototype = ExtendedClientDocumentContext$LowLevelEditingConcerns$1.prototype = new Object_0;
_.getClass$ = function getClass_550(){
  return Lorg_waveprotocol_wave_client_editor_content_ExtendedClientDocumentContext$LowLevelEditingConcerns$1_2_classLit;
}
;
_.getSelectionHelper = function getSelectionHelper_2(){
  throw new IllegalStateException_1('Not in an editing context');
}
;
_.getSuggestionsManager = function getSuggestionsManager_0(){
  throw new IllegalStateException_1('Not in an editing context');
}
;
_.hasEditor = function hasEditor_0(){
  return false;
}
;
_.textNodeletAffected = function textNodeletAffected_0(nodelet, affectedAfterOffset, insertionAmount, changeType){
}
;
_.castableTypeMap$ = {};
function FocusedPointRange_1(anchor, focus_0){
  this.anchor = dynamicCast(checkNotNull_1(anchor, 'anchor'), 436);
  this.focus_0 = dynamicCast(checkNotNull_1(focus_0, 'focus'), 436);
  this.isCollapsed = $equals_11(anchor, focus_0);
}

function FocusedPointRange(){
}

_ = FocusedPointRange_1.prototype = FocusedPointRange.prototype = new Object_0;
_.equals$ = function equals_29(obj){
  var other;
  if (this === obj)
    return true;
  if (obj == null)
    return false;
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[437]))
    return false;
  other = dynamicCast(obj, 437);
  if (!$equals_11(this.anchor, other.anchor))
    return false;
  if (!$equals_11(this.focus_0, other.focus_0))
    return false;
  return true;
}
;
_.getClass$ = function getClass_551(){
  return Lorg_waveprotocol_wave_model_document_util_FocusedPointRange_2_classLit;
}
;
_.hashCode$ = function hashCode_29(){
  var result;
  result = 31 + $hashCode_9(this.anchor);
  result = 31 * result + $hashCode_9(this.focus_0);
  return result;
}
;
_.toString$ = function toString_63(){
  return 'FocusedPointRange(' + this.anchor + ' -> ' + this.focus_0 + ')';
}
;
_.castableTypeMap$ = {437:1};
_.anchor = null;
_.focus_0 = null;
_.isCollapsed = false;
function FocusedContentRange_0(anchor, focus_0){
  FocusedPointRange_1.call(this, anchor, focus_0);
}

function FocusedContentRange_1(collapsedAt){
  this.anchor = collapsedAt;
  this.focus_0 = collapsedAt;
  this.isCollapsed = true;
}

function FocusedContentRange(){
}

_ = FocusedContentRange_1.prototype = FocusedContentRange_0.prototype = FocusedContentRange.prototype = new FocusedPointRange;
_.getClass$ = function getClass_552(){
  return Lorg_waveprotocol_wave_client_editor_content_FocusedContentRange_2_classLit;
}
;
_.castableTypeMap$ = {437:1};
_.isOrdered = false;
_.orderedRange = null;
function attribute_2(e, attribute, attributeDisplayString){
  var value;
  value = e.getAttribute(attribute) || '';
  return value != null && !($equals_3(attribute, 'contentEditable') && $equals_3(value, 'inherit'))?' ' + attributeDisplayString + "='" + value + "'":'';
}

function newLine(indent){
  var i, res;
  res = '<br/>';
  for (i = 0; i < indent; ++i) {
    res += '&nbsp;&nbsp';
  }
  return res;
}

function print_0(n, selection, indent, multiLine){
  var child, collapsed, e, endMarker, endNodeAfter, endOffset, pretty, printEndMarker, printStartMarker, ret, singleLineHtml, startMarker, startNodeAfter, startOffset, value;
  collapsed = !!selection && selection.isCollapsed;
  printStartMarker = !!selection && dynamicCastJso(selection.first.container) == n;
  printEndMarker = !!selection && !collapsed && dynamicCastJso(selection.second.container) == n;
  startMarker = printStartMarker?collapsed?'|':'[':'';
  endMarker = printEndMarker?']':'';
  if (n.nodeType == 3) {
    value = $replaceAll($replaceAll(n.nodeValue, '\xA0', '\u25AA'), ' ', '\u25AB');
    startOffset = printStartMarker?$getTextOffset(selection.first):0;
    endOffset = printEndMarker?$getTextOffset(selection.second):value.length;
    ret = "'" + value.substr(0, startOffset - 0) + startMarker + value.substr(startOffset, endOffset - startOffset) + endMarker + $substring_0(value, endOffset, value.length) + "'";
    return multiLine?$replaceAll($replaceAll($replaceAll(ret, '&', '&amp;'), '<', '&lt;'), '>', '&gt;'):ret;
  }
   else {
    e = n;
    if (e.childNodes.length == 0) {
      return (multiLine?'&lt;':'<') + e.tagName.toLowerCase() + (styleName_0(e) + attribute_2(e, 'src', 'src') + attribute_2(e, 'contentEditable', 'editable') + attribute_2(e, 'sp', 'sp')) + '/' + (multiLine?'&gt;':'>');
    }
     else {
      singleLineHtml = multiLine && e.childNodes.length == 1 && e.firstChild.childNodes.length == 0;
      pretty = (multiLine?'&lt;':'<') + e.tagName.toLowerCase() + (styleName_0(e) + attribute_2(e, 'src', 'src') + attribute_2(e, 'contentEditable', 'editable') + attribute_2(e, 'sp', 'sp')) + '' + (multiLine?'&gt;':'>');
      child = e.firstChild;
      startNodeAfter = dynamicCastJso($getNodeAfter(selection.first));
      endNodeAfter = dynamicCastJso($getNodeAfter(selection.second));
      while (child) {
        pretty += (multiLine && !singleLineHtml?newLine(indent + 1):'') + (printStartMarker && child == startNodeAfter?startMarker:'') + (printEndMarker && child == endNodeAfter?endMarker:'') + print_0(child, selection, indent + 1, multiLine);
        child = child.nextSibling;
      }
      printEndMarker && !endNodeAfter && (pretty += endMarker);
      return pretty + (multiLine && !singleLineHtml?newLine(indent):'') + ((multiLine?'&lt;/':'<\/') + e.tagName.toLowerCase() + (multiLine?'&gt;':'>'));
    }
  }
}

function styleName_0(e){
  var name_0;
  name_0 = e.className;
  return name_0.length > 0?" class='" + e.className + "'":'';
}

function HtmlPoint_0(){
  this.node = null;
  this.offset = 0;
}

function HtmlPoint(){
}

_ = HtmlPoint_0.prototype = HtmlPoint.prototype = new Object_0;
_.getClass$ = function getClass_553(){
  return Lorg_waveprotocol_wave_client_editor_content_HtmlPoint_2_classLit;
}
;
_.toString$ = function toString_64(){
  return print_0(this.node, new PointRange_0(nodeOffsetToNodeletPoint(this.node, this.offset)), 0, false);
}
;
_.castableTypeMap$ = {};
_.node = null;
_.offset = 0;
function $actuallyPersist(this$static, localNode){
  var op, opBuffer, position, remainder, op_0;
  if (this$static.persistedView.inner_0.isSameNode(localNode, dynamicCast($getVisibleNode(this$static.persistedView, localNode), 197))) {
    throw new IllegalArgumentException_1('opaquePersist: element must not be persistent');
  }
  position = $getLocation_4(this$static.persistedLocations, getFilteredPoint(this$static.persistedView, new Point$El_0(localNode, null)));
  remainder = $size_15(this$static.persistedLocations) - position;
  opBuffer = new DocOpBuffer_0;
  position > 0 && $add_9(opBuffer.accu, new OperationComponents$Retain_0(position));
  buildDomInitializationFromSubtree(this$static.localDoc, localNode, opBuffer);
  remainder > 0 && $add_9(opBuffer.accu, new OperationComponents$Retain_0(remainder));
  op = (op_0 = new BufferedDocOpImpl_0(dynamicCast($toArray_1(opBuffer.accu, ($clinit_2033() , EMPTY_ARRAY_1)), 228)) , checkWellformedness(op_0) , op_0);
  this$static.nodeCreationDelegate = new ReadableTreeWalker_0(this$static.localDoc, localNode);
  $consume_13(this$static.sink, op);
  checkState_2($checkComplete(this$static.nodeCreationDelegate), 'Walk of tree did not match up...');
  this$static.nodeCreationDelegate = null;
}

function $createElement_8(this$static, tagName, attributes){
  checkState_2(!!this$static.nodeCreationDelegate, 'Lazy persistence delegated an element creation when not a delegate.');
  return dynamicCast($checkElement(this$static.nodeCreationDelegate, tagName, attributes), 196);
}

function $createTextNode_5(this$static, data){
  checkState_2(!!this$static.nodeCreationDelegate, 'Lazy persistence delegated a text node creationgwhen not a delegate.');
  return dynamicCast($checkTextNode(this$static.nodeCreationDelegate, data), 225);
}

function $updateLazyNodes(this$static, at){
  for (; !dynamicCast(at, 197).indexingContainer; at = dynamicCast(this$static.localDoc.inner_0.getParentElement(at), 197)) {
    if (this$static.lazilyPersistedNodes.has(at)) {
      this$static.lazilyPersistedNodes.remove_6(at);
      $actuallyPersist(this$static, at);
      break;
    }
    if ($isSameNode_1(this$static.localDoc, at, dynamicCast(this$static.localDoc.inner_0.getDocumentElement(), 197))) {
      break;
    }
  }
}

function LazyPersistenceManager_0(outgoingSink, localDoc, persistedLocations, persistedView, localCorrectionSink){
  this.lazilyPersistedNodes = ($clinit_2309() , defaultCollectionFactory.createIdentityMap());
  this.sink = new LazyPersistenceManager$1_0(localCorrectionSink, outgoingSink);
  this.localDoc = localDoc;
  this.persistedLocations = persistedLocations;
  this.persistedView = persistedView;
}

function LazyPersistenceManager(){
}

_ = LazyPersistenceManager_0.prototype = LazyPersistenceManager.prototype = new Object_0;
_.getClass$ = function getClass_554(){
  return Lorg_waveprotocol_wave_client_editor_content_LazyPersistenceManager_2_classLit;
}
;
_.castableTypeMap$ = {};
_.localDoc = null;
_.nodeCreationDelegate = null;
_.persistedLocations = null;
_.persistedView = null;
_.sink = null;
function $consume_13(this$static, op){
  var $e0, e;
  try {
    $consume_10(this$static.val$localCorrectionSink, op, performValidation);
    $consume_8(this$static.val$outgoingSink, op);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 189)) {
      e = $e0;
      $log_3(($clinit_761() , logger_1).fatalLogger, e);
    }
     else 
      throw $e0;
  }
}

function LazyPersistenceManager$1_0(val$localCorrectionSink, val$outgoingSink){
  this.val$localCorrectionSink = val$localCorrectionSink;
  this.val$outgoingSink = val$outgoingSink;
}

function LazyPersistenceManager$1(){
}

_ = LazyPersistenceManager$1_0.prototype = LazyPersistenceManager$1.prototype = new Object_0;
_.consume = function consume_5(op){
  $consume_13(this, dynamicCast(op, 207));
}
;
_.getClass$ = function getClass_555(){
  return Lorg_waveprotocol_wave_client_editor_content_LazyPersistenceManager$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$localCorrectionSink = null;
_.val$outgoingSink = null;
function $clinit_879(){
  $clinit_879 = nullMethod;
  paintDataDomain = new PainterRegistryImpl$1_0;
}

function $registerBoundaryFunction(this$static, dependentKeys, function_$){
  var modifying;
  modifying = dynamicCast($modify_0(this$static.data_0), 220);
  modifying.keys.addAll_0(dependentKeys);
  $add_13(modifying.boundaryFuncs, function_$);
}

function $registerPaintFunction(this$static, dependentKeys, function_$){
  var modifying;
  modifying = dynamicCast($modify_0(this$static.data_0), 220);
  modifying.keys.addAll_0(dependentKeys);
  $add_13(modifying.paintFuncs, function_$);
}

function $unregisterBoundaryFunction(this$static, dependentKeys){
  dynamicCast($modify_0(this$static.data_0), 220).keys.removeAll_0(dependentKeys);
}

function $unregisterPaintFunction(this$static, dependentKeys){
  dynamicCast($modify_0(this$static.data_0), 220).keys.removeAll_0(dependentKeys);
}

function PainterRegistryImpl_0(painter){
  $clinit_879();
  checkNotNull_1(painter, 'Null painter');
  this.data_0 = new ChainedData_0(paintDataDomain);
  this.painter = painter;
  this.paintTagName = 'l:s';
  this.boundaryTagName = 'l:b';
}

function PainterRegistryImpl_1(parent_0){
  $clinit_879();
  checkNotNull_1(parent_0, 'Use the other constructor for the root');
  this.data_0 = new ChainedData_1(parent_0.data_0);
  this.paintTagName = parent_0.paintTagName;
  this.boundaryTagName = parent_0.boundaryTagName;
  this.painter = parent_0.painter;
}

function PainterRegistryImpl(){
}

_ = PainterRegistryImpl_1.prototype = PainterRegistryImpl_0.prototype = PainterRegistryImpl.prototype = new Object_0;
_.getClass$ = function getClass_557(){
  return Lorg_waveprotocol_wave_client_editor_content_PainterRegistryImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.boundaryTagName = null;
_.data_0 = null;
_.paintTagName = null;
_.painter = null;
var paintDataDomain;
function $compose_0(target, changes, base){
  $compose_4(($clinit_2309() , target.keys), changes.keys, base.keys);
  $compose_6(target.paintFuncs, changes.paintFuncs, base.paintFuncs);
  $compose_6(target.boundaryFuncs, changes.boundaryFuncs, base.boundaryFuncs);
}

function PainterRegistryImpl$1_0(){
}

function PainterRegistryImpl$1(){
}

_ = PainterRegistryImpl$1_0.prototype = PainterRegistryImpl$1.prototype = new Object_0;
_.compose = function compose_0(target, changes, base){
  $compose_0(dynamicCast(target, 220), dynamicCast(changes, 220), dynamicCast(base, 220));
}
;
_.empty = function empty_0(){
  return new PainterRegistryImpl$PaintData_0;
}
;
_.getClass$ = function getClass_558(){
  return Lorg_waveprotocol_wave_client_editor_content_PainterRegistryImpl$1_2_classLit;
}
;
_.readOnlyView = function readOnlyView_0(modifiable){
  return dynamicCast(modifiable, 220);
}
;
_.castableTypeMap$ = {};
function PainterRegistryImpl$PaintData_0(){
  this.boundaryFuncs = new HashSet_0;
  this.paintFuncs = new HashSet_0;
  this.keys = ($clinit_2309() , defaultCollectionFactory.createStringSet());
}

function PainterRegistryImpl$PaintData(){
}

_ = PainterRegistryImpl$PaintData_0.prototype = PainterRegistryImpl$PaintData.prototype = new Object_0;
_.getClass$ = function getClass_559(){
  return Lorg_waveprotocol_wave_client_editor_content_PainterRegistryImpl$PaintData_2_classLit;
}
;
_.castableTypeMap$ = {220:1};
function applyModifier(range, modifier){
  var anchor, focus_0;
  return anchor = transformLocation(modifier, range.anchor) , focus_0 = transformLocation(modifier, range.focus_0) , new FocusedRange_0(anchor, focus_0);
}

function $createExtension(this$static){
  return new RegistriesImpl_0(new ElementHandlerRegistry_1(this$static.elementHandlerRegistry), new AnnotationRegistryImpl_1(this$static.annotationHandlerRegistry), new PainterRegistryImpl_1(this$static.paintRegistry));
}

function RegistriesImpl_0(elementHandlerRegistry, annotationHandlerRegistry, paintRegistry){
  this.elementHandlerRegistry = elementHandlerRegistry;
  this.annotationHandlerRegistry = annotationHandlerRegistry;
  this.paintRegistry = paintRegistry;
}

function RegistriesImpl(){
}

_ = RegistriesImpl_0.prototype = RegistriesImpl.prototype = new Object_0;
_.getClass$ = function getClass_560(){
  return Lorg_waveprotocol_wave_client_editor_content_RegistriesImpl_2_classLit;
}
;
_.castableTypeMap$ = {320:1};
_.annotationHandlerRegistry = null;
_.elementHandlerRegistry = null;
_.paintRegistry = null;
function $matchesSelectionTextNodes(this$static, nodelet, affectedAfterOffset){
  if (!this$static.savedSelection) {
    return false;
  }
  if ($isOrdered_0(this$static.savedSelection)) {
    if (nodelet == this$static.savedSelectionAnchorTextNodelet) {
      return this$static.savedSelectionAnchorOffset > affectedAfterOffset;
    }
     else if (nodelet == this$static.savedSelectionFocusTextNodelet) {
      return true;
    }
  }
   else {
    if (nodelet == this$static.savedSelectionFocusTextNodelet) {
      return this$static.savedSelectionFocusOffset > affectedAfterOffset;
    }
     else if (nodelet == this$static.savedSelectionAnchorTextNodelet) {
      return true;
    }
  }
  return false;
}

function $maybeUpdateNodeOffsets(this$static, nodelet, affectedAfterOffset, newNodelet, offsetDifference){
  if (nodelet == this$static.savedSelectionAnchorTextNodelet && this$static.savedSelectionAnchorOffset > affectedAfterOffset) {
    this$static.savedSelectionAnchorOffset += offsetDifference;
    this$static.savedSelectionAnchorTextNodelet = newNodelet;
  }
  if (nodelet == this$static.savedSelectionFocusTextNodelet && this$static.savedSelectionFocusOffset > affectedAfterOffset) {
    this$static.savedSelectionFocusOffset += offsetDifference;
    this$static.savedSelectionFocusTextNodelet = newNodelet;
  }
}

function $restoreSelection(this$static, modifier){
  --this$static.savedSelectionDepth;
  if (!!this$static.editingConcerns && this$static.savedSelectionDepth == 0) {
    try {
      if (this$static.savedSelection) {
        this$static.needToRestoreSelection |= false;
        if (this$static.needToRestoreSelection || $selectionChangedInappropriately(this$static)) {
          !!modifier && (this$static.savedSelection = applyModifier(this$static.savedSelection, modifier));
          $log_0(($clinit_761() , logger_1).traceLogger, 'Restoring selection');
          $size_15(this$static.document_0) >= 4 && $setSelectionRange_1(this$static.editingConcerns.getSelectionHelper(), this$static.savedSelection);
        }
         else {
          $log_0(($clinit_761() , logger_1).traceLogger, 'Not restoring selection');
        }
      }
    }
     finally {
      this$static.savedSelection = null;
      this$static.savedSelectionAnchor = null;
      this$static.savedSelectionAnchorTextNodelet = null;
      this$static.savedSelectionAnchorOffset = 0;
      this$static.savedSelectionFocus = null;
      this$static.savedSelectionFocusTextNodelet = null;
      this$static.savedSelectionFocusOffset = 0;
    }
  }
}

function $saveSelection_0(this$static){
  var helper, htmlSelection;
  if (!!this$static.editingConcerns && this$static.savedSelectionDepth == 0) {
    this$static.needToRestoreSelection = false;
    helper = this$static.editingConcerns.getSelectionHelper();
    if (helper) {
      htmlSelection = get_21();
      if (htmlSelection) {
        this$static.savedSelectionAnchor = htmlSelection.anchor;
        if (this$static.savedSelectionAnchor.offset >= 0) {
          this$static.savedSelectionAnchorTextNodelet = dynamicCastJso(this$static.savedSelectionAnchor.container);
          this$static.savedSelectionAnchorOffset = $getTextOffset(this$static.savedSelectionAnchor);
        }
        this$static.savedSelectionFocus = htmlSelection.focus_0;
        if (this$static.savedSelectionFocus.offset >= 0) {
          this$static.savedSelectionFocusTextNodelet = dynamicCastJso(this$static.savedSelectionFocus.container);
          this$static.savedSelectionFocusOffset = $getTextOffset(this$static.savedSelectionFocus);
        }
        this$static.savedSelection = $getSelectionRange(helper);
      }
    }
  }
  ++this$static.savedSelectionDepth;
}

function $selectionChangedInappropriately(this$static){
  var htmlSelection, newAnchor, newFocus, selection;
  $clinit_1046();
  if (!($clinit_1051() , selection = $wnd.getSelection() , selection.rangeCount > 0)) {
    return true;
  }
  cache_1 = null;
  htmlSelection = get_21();
  newAnchor = htmlSelection.anchor;
  if (this$static.savedSelectionAnchor.offset >= 0) {
    if (maskUndefined(this$static.savedSelectionAnchorTextNodelet) !== maskUndefined(newAnchor.container) || this$static.savedSelectionAnchorOffset != $getTextOffset(newAnchor)) {
      return true;
    }
  }
   else {
    if (maskUndefined(this$static.savedSelectionAnchor.container) !== maskUndefined(newAnchor.container)) {
      return true;
    }
  }
  newFocus = htmlSelection.focus_0;
  if (this$static.savedSelectionFocus.offset >= 0) {
    if (maskUndefined(this$static.savedSelectionFocusTextNodelet) !== maskUndefined(newFocus.container) || this$static.savedSelectionFocusOffset != $getTextOffset(newFocus)) {
      return true;
    }
  }
   else {
    if (maskUndefined(this$static.savedSelectionFocus.container) !== maskUndefined(newFocus.container)) {
      return true;
    }
  }
  return false;
}

function $textNodeletAffected(this$static, nodelet, affectedAfterOffset, insertionAmount, changeType){
  if (this$static.needToRestoreSelection) {
    return;
  }
  switch (changeType.ordinal) {
    case 0:
      $matchesSelectionTextNodes(this$static, nodelet, affectedAfterOffset)?(this$static.needToRestoreSelection = true):$maybeUpdateNodeOffsets(this$static, nodelet, affectedAfterOffset, nodelet, insertionAmount);
      return;
    case 1:
      $matchesSelectionTextNodes(this$static, nodelet, affectedAfterOffset) && ($clinit_649() , this$static.needToRestoreSelection = true);
      return;
    case 3:
      return;
    case 2:
    case 4:
      (nodelet == this$static.savedSelectionAnchorTextNodelet || nodelet == this$static.savedSelectionFocusTextNodelet) && (this$static.needToRestoreSelection = true);
      return;
  }
}

function SelectionMaintainer_0(document_0){
  this.document_0 = document_0;
}

function SelectionMaintainer(){
}

_ = SelectionMaintainer_0.prototype = SelectionMaintainer.prototype = new Object_0;
_.getClass$ = function getClass_561(){
  return Lorg_waveprotocol_wave_client_editor_content_SelectionMaintainer_2_classLit;
}
;
_.castableTypeMap$ = {};
_.document_0 = null;
_.editingConcerns = null;
_.needToRestoreSelection = false;
_.savedSelection = null;
_.savedSelectionAnchor = null;
_.savedSelectionAnchorOffset = 0;
_.savedSelectionAnchorTextNodelet = null;
_.savedSelectionDepth = 0;
_.savedSelectionFocus = null;
_.savedSelectionFocusOffset = 0;
_.savedSelectionFocusTextNodelet = null;
function $clinit_888(){
  $clinit_888 = nullMethod;
  DATA = new SelectionMaintainer$TextNodeChangeType_0('DATA', 0);
  SPLIT = new SelectionMaintainer$TextNodeChangeType_0('SPLIT', 1);
  MOVE = new SelectionMaintainer$TextNodeChangeType_0('MOVE', 2);
  REMOVE = new SelectionMaintainer$TextNodeChangeType_0('REMOVE', 3);
  REPLACE_DATA = new SelectionMaintainer$TextNodeChangeType_0('REPLACE_DATA', 4);
  $VALUES_23 = initValues(_3Lorg_waveprotocol_wave_client_editor_content_SelectionMaintainer$TextNodeChangeType_2_classLit, {9:1, 68:1, 170:1}, 100, [DATA, SPLIT, MOVE, REMOVE, REPLACE_DATA]);
}

function SelectionMaintainer$TextNodeChangeType_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_30(name_0){
  $clinit_888();
  return valueOf_0(($clinit_889() , $MAP_23), name_0);
}

function values_24(){
  $clinit_888();
  return $VALUES_23;
}

function SelectionMaintainer$TextNodeChangeType(){
}

_ = SelectionMaintainer$TextNodeChangeType_0.prototype = SelectionMaintainer$TextNodeChangeType.prototype = new Enum;
_.getClass$ = function getClass_562(){
  return Lorg_waveprotocol_wave_client_editor_content_SelectionMaintainer$TextNodeChangeType_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 100:1};
var $VALUES_23, DATA, MOVE, REMOVE, REPLACE_DATA, SPLIT;
function $clinit_889(){
  $clinit_889 = nullMethod;
  $MAP_23 = createValueOfMap(($clinit_888() , $VALUES_23));
}

var $MAP_23;
function $clinit_891(){
  $clinit_891 = nullMethod;
  PERMITTED_ATTRIBUTES = newStringSet(initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['alt', 'height', 'width', 'src']));
  RENDERER = new ImgDoodad$ImgRenderer_0;
}

function register_5(registry){
  $clinit_891();
  $registerRenderingMutationHandler(registry, 'img', RENDERER);
  $registerEventHandler(registry, 'img', ($clinit_776() , $clinit_776() , INSTANCE_5));
}

var PERMITTED_ATTRIBUTES, RENDERER;
function ImgDoodad$ImgRenderer_0(){
}

function ImgDoodad$ImgRenderer(){
}

_ = ImgDoodad$ImgRenderer_0.prototype = ImgDoodad$ImgRenderer.prototype = new RenderingMutationHandler;
_.createDomImpl = function createDomImpl_4(element){
  var imgTag;
  imgTag = $doc.createElement('img');
  imgTag.style['-webkit-user-modify'] = 'read-only';
  return imgTag;
}
;
_.getClass$ = function getClass_563(){
  return Lorg_waveprotocol_wave_client_editor_content_img_ImgDoodad$ImgRenderer_2_classLit;
}
;
_.onActivationStart = function onActivationStart_0(element){
  element.attributes.each_2(new RenderingMutationHandler$1_0(this, element));
}
;
_.onAttributeModified = function onAttributeModified_2(element, name_0, oldValue, newValue){
  ($clinit_891() , PERMITTED_ATTRIBUTES).contains_0(name_0) && (newValue == null?(element.implNodelet.removeAttribute(name_0) , undefined):(element.implNodelet.setAttribute(name_0, newValue) , undefined));
}
;
_.castableTypeMap$ = {212:1, 215:1};
function $clinit_893(){
  $clinit_893 = nullMethod;
  EVENT_HANDLER = new AnnotationBoundaryRenderer$1_0;
}

function AnnotationBoundaryRenderer_0(){
  $clinit_893();
}

function AnnotationBoundaryRenderer(){
}

_ = AnnotationBoundaryRenderer_0.prototype = AnnotationBoundaryRenderer.prototype = new Object_0;
_.createDomImpl = function createDomImpl_5(element){
  var nodelet;
  nodelet = $doc.createElement('span');
  nodelet.style['-webkit-user-modify'] = 'read-only';
  $setContainerNodelet(element, nodelet);
  return nodelet;
}
;
_.getClass$ = function getClass_564(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_AnnotationBoundaryRenderer_2_classLit;
}
;
_.castableTypeMap$ = {212:1};
var EVENT_HANDLER;
function AnnotationBoundaryRenderer$1_0(){
  $clinit_776();
}

function AnnotationBoundaryRenderer$1(){
}

_ = AnnotationBoundaryRenderer$1_0.prototype = AnnotationBoundaryRenderer$1.prototype = new NodeEventHandlerImpl;
_.getClass$ = function getClass_565(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_AnnotationBoundaryRenderer$1_2_classLit;
}
;
_.castableTypeMap$ = {216:1};
function $clinit_895(){
  $clinit_895 = nullMethod;
  mutationHandlerRegistry = new HashMap_0;
  eventHandlerRegistry = new HashMap_0;
}

function register_6(registry){
  var mutable;
  $clinit_895();
  var boundaryRenderer, paintRenderer;
  paintRenderer = new AnnotationSpreadRenderer_0;
  mutable = dynamicCast($modify_0(registry.data_0), 211);
  mutable.renderers.put_3('l:s', paintRenderer);
  mutable.mutationHandlers.put_3('l:s', paintRenderer);
  $registerNiceHtmlRenderer(registry, 'l:s', ($clinit_1004() , SHALLOW_CLONE_RENDERER));
  boundaryRenderer = new AnnotationBoundaryRenderer_0;
  dynamicCast($modify_0(registry.data_0), 211).renderers.put_3('l:b', boundaryRenderer);
  $registerEventHandler(registry, 'l:b', ($clinit_893() , EVENT_HANDLER));
}

var eventHandlerRegistry, mutationHandlerRegistry;
function $applyAttribute(element, name_0, newValue){
  var $e0, implNodelet, scrubbedValue, implNodelet_0;
  implNodelet = element.implNodelet;
  if ($equals_3(name_0, 'link')) {
    if (newValue != null) {
      scrubbedValue = ($clinit_592() , isSafeUri(newValue)?newValue:'#');
      implNodelet.setAttribute('href', scrubbedValue);
      scrubbedValue.indexOf('#') == 0?(implNodelet.removeAttribute('target') , undefined):(implNodelet.setAttribute('target', '_blank') , undefined);
    }
     else {
      implNodelet.removeAttribute('href');
    }
  }
   else if ($equals_3(name_0, 'mouseListener')) {
    implNodelet_0 = element.implNodelet;
    newValue == null?null:throwClassCastExceptionUnlessNull(($clinit_895() , eventHandlerRegistry).get(newValue));
    implNodelet_0.__listener = null;
    sinkEvents(implNodelet_0, (implNodelet_0.__eventBits || 0) & -126);
  }
   else {
    try {
      implNodelet.style[name_0] = newValue;
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 21)) {
        $log_0(($clinit_761() , logger_1).errorLogger, 'Failed to set CSS property ' + name_0 + ' -> ' + newValue);
      }
       else 
        throw $e0;
    }
  }
}

function $maybeConvertToAnchor(element, toAnchor){
  var isAnchor, newNodelet, nodelet;
  nodelet = element.implNodelet;
  isAnchor = $equalsIgnoreCase(nodelet.tagName, 'a');
  if (isAnchor != toAnchor) {
    nodelet.__listener = null;
    sinkEvents(nodelet, (nodelet.__eventBits || 0) & -126);
    newNodelet = createHtml(toAnchor);
    replaceElement(nodelet, newNodelet);
    $setImplNodelets(element, newNodelet, newNodelet);
  }
}

function $onAttributeModified_0(element, name_0, newValue){
  if ($equals_3(name_0, 'link')) {
    $maybeConvertToAnchor(element, newValue != null);
    element.attributes.each_2(new AnnotationSpreadRenderer$2_0(element));
  }
   else {
    $applyAttribute(element, name_0, newValue);
  }
}

function $onRemovedFromParent_0(element, newParent){
  if (newParent) {
    return;
  }
  $removeListener_1(element.implNodelet);
}

function $removeListener_1(implNodelet){
  implNodelet.__listener = null;
  sinkEvents(implNodelet, (implNodelet.__eventBits || 0) & -126);
}

function AnnotationSpreadRenderer_0(){
  this.mutatedElements = new HashSet_0;
  this.mutationNotificationTask = new AnnotationSpreadRenderer$1_0(this);
}

function createHtml(isAnchor){
  var e;
  e = isAnchor?$doc.createElement('a'):$doc.createElement('span');
  e.setAttribute('x', 'y');
  return e;
}

function getMutationHandler(element){
  var handlerId;
  handlerId = dynamicCast(element.attributes.get_4('mutationListener'), 1);
  return handlerId == null?null:throwClassCastExceptionUnlessNull(($clinit_895() , mutationHandlerRegistry).get(handlerId));
}

function AnnotationSpreadRenderer(){
}

_ = AnnotationSpreadRenderer_0.prototype = AnnotationSpreadRenderer.prototype = new RenderingMutationHandler;
_.createDomImpl = function createDomImpl_6(element){
  return $setAutoAppendContainer(element, createHtml(false));
}
;
_.getClass$ = function getClass_566(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_AnnotationSpreadRenderer_2_classLit;
}
;
_.onActivationStart = function onActivationStart_1(element){
  element.attributes.each_2(new RenderingMutationHandler$1_0(this, element));
}
;
_.onAttributeModified = function onAttributeModified_3(element, name_0, oldValue, newValue){
  $onAttributeModified_0(element, name_0, newValue);
}
;
_.onDescendantsMutated = function onDescendantsMutated_2(element){
  var scheduler;
  getMutationHandler(element);
  scheduler = (!instance_7 && (instance_7 = new BrowserBackedScheduler_0 , setDefaultTimerService() , undefined) , instance_7);
  scheduler.taskInfos.get(this.mutationNotificationTask) != null || $scheduleDelayed(scheduler, ($clinit_1200() , MEDIUM), this.mutationNotificationTask, 200);
}
;
_.onRemovedFromParent = function onRemovedFromParent_2(element, newParent){
  $onRemovedFromParent_0(element, newParent);
}
;
_.castableTypeMap$ = {212:1, 215:1};
function AnnotationSpreadRenderer$1_0(this$0){
  this.this$0 = this$0;
}

function AnnotationSpreadRenderer$1(){
}

_ = AnnotationSpreadRenderer$1_0.prototype = AnnotationSpreadRenderer$1.prototype = new Object_0;
_.execute_0 = function execute_23(){
  var context, element, element$iterator, outerIter, entry;
  for (element$iterator = (outerIter = $keySet_0(this.this$0.mutatedElements.map).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter)); element$iterator.val$outerIter.hasNext();) {
    element = dynamicCast((entry = dynamicCast(element$iterator.val$outerIter.next_0(), 11) , entry.getKey()), 196);
    context = element.context;
    if (!context.this$0.editingConcerns.hasEditor()) {
      continue;
    }
    getMutationHandler(element);
  }
  this.this$0.mutatedElements.map.clear();
}
;
_.getClass$ = function getClass_567(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_AnnotationSpreadRenderer$1_2_classLit;
}
;
_.castableTypeMap$ = {252:1, 253:1};
_.this$0 = null;
function AnnotationSpreadRenderer$2_0(val$element){
  this.val$element = val$element;
}

function AnnotationSpreadRenderer$2(){
}

_ = AnnotationSpreadRenderer$2_0.prototype = AnnotationSpreadRenderer$2.prototype = new Object_0;
_.apply_1 = function apply_30(key, value){
  $applyAttribute(this.val$element, key, dynamicCast(value, 1));
}
;
_.getClass$ = function getClass_568(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_AnnotationSpreadRenderer$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$element = null;
function $clinit_899(){
  $clinit_899 = nullMethod;
  CAPTION_EVENT_HANDLER = new Caption$1_0;
}

function register_7(registry){
  $clinit_899();
  var renderer;
  $registerEventHandler(registry, 'caption', CAPTION_EVENT_HANDLER);
  renderer = new ParagraphRenderer_0(new Caption$2_0);
  dynamicCast($modify_0(registry.data_0), 211).mutationHandlers.put_3('caption', renderer);
  dynamicCast($modify_0(registry.data_0), 211).renderers.put_3('caption', renderer);
}

var CAPTION_EVENT_HANDLER;
function ParagraphEventHandler_0(){
  $clinit_776();
}

function ParagraphEventHandler(){
}

_ = ParagraphEventHandler_0.prototype = ParagraphEventHandler.prototype = new NodeEventHandlerImpl;
_.getClass$ = function getClass_569(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphEventHandler_2_classLit;
}
;
_.castableTypeMap$ = {216:1};
function LinoTextEventHandler(){
}

_ = LinoTextEventHandler.prototype = new ParagraphEventHandler;
_.getClass$ = function getClass_570(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_LinoTextEventHandler_2_classLit;
}
;
_.castableTypeMap$ = {216:1};
function Caption$1_0(){
  $clinit_776();
}

function Caption$1(){
}

_ = Caption$1_0.prototype = Caption$1.prototype = new LinoTextEventHandler;
_.getClass$ = function getClass_571(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_Caption$1_2_classLit;
}
;
_.onActivated = function onActivated_0(element){
  $clinit_908();
  element.transientData.put_1(EDIT_MODE_LISTENER_PROP.id_0, ($clinit_912() , $clinit_912() , INSTANCE_9));
}
;
_.castableTypeMap$ = {216:1};
function $clinit_903(){
  $clinit_903 = nullMethod;
  BULLET_CLASSNAMES = initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['bullet-type-0', 'bullet-type-1', 'bullet-type-2']);
}

function $createDomImpl(this$static, element){
  var nodelet;
  nodelet = this$static.createNodelet(element);
  $appendSpacer(($clinit_939() , nodelet));
  return $setContainerNodelet(element, nodelet) , nodelet;
}

function $updateRendering(this$static, element, type, listStyle, indent, alignment, direction){
  var behaviour, bulletType, bulletType$array, bulletType$index, bulletType$max, factor, fontSize, fontWeight, headingNum, implNodelet, isListItem, margin, newNodelet, style, toListItem;
  implNodelet = element.implNodelet;
  behaviour = of_0(type);
  toListItem = behaviour == ($clinit_937() , LIST);
  isListItem = $equalsIgnoreCase(implNodelet.tagName, 'li');
  if (isListItem != toListItem) {
    newNodelet = $doc.createElement(toListItem?'li':this$static.implTagName);
    replaceElement(implNodelet, newNodelet);
    $setImplNodelets(element, newNodelet, newNodelet);
    $ensureSpacerIfDoesntEndWithText(($clinit_939() , element).implNodelet);
    implNodelet = newNodelet;
  }
  fontSize = -1;
  fontWeight = null;
  $removeClassName(implNodelet, 'numbered');
  switch (behaviour.ordinal) {
    case 2:
      $equals_3('decimal', listStyle) && $addClassName(implNodelet, 'numbered');
      break;
    case 1:
      fontWeight = ($clinit_69() , BOLD);
      headingNum = __parseAndValidateInt(type.substr(1, type.length - 1), 10);
      factor = 1 - (headingNum - 1) / 3;
      fontSize = 1 + factor * 0.75;
  }
  for (bulletType$array = BULLET_CLASSNAMES , bulletType$index = 0 , bulletType$max = bulletType$array.length; bulletType$index < bulletType$max; ++bulletType$index) {
    bulletType = bulletType$array[bulletType$index];
    $removeClassName(implNodelet, bulletType);
  }
  if (behaviour == LIST) {
    listStyle == null && $addClassName(implNodelet, BULLET_CLASSNAMES[indent % 3]);
    ++indent;
  }
  margin = indent * 22;
  style = implNodelet.style;
  fontSize != -1?(style['fontSize'] = fontSize + ($clinit_88() , 'em') , undefined):(style['fontSize'] = '' , undefined);
  fontWeight?(style['fontWeight'] = 'bold' , undefined):(style['fontWeight'] = '' , undefined);
  alignment?(style['textAlign'] = alignment.css_0 , undefined):(style['textAlign'] = '' , undefined);
  direction?(style['direction'] = direction.css_0 , undefined):(style['direction'] = '' , undefined);
  if (margin == 0) {
    style['marginLeft'] = '';
    style['marginRight'] = '';
  }
   else {
    if (direction == ($clinit_932() , RTL_0)) {
      style['marginRight'] = margin + ($clinit_88() , 'px');
      style['marginLeft'] = '';
    }
     else {
      style['marginLeft'] = margin + ($clinit_88() , 'px');
      style['marginRight'] = '';
    }
  }
}

function DefaultParagraphHtmlRenderer_0(){
  $clinit_903();
  this.implTagName = 'div';
}

function DefaultParagraphHtmlRenderer(){
}

_ = DefaultParagraphHtmlRenderer_0.prototype = DefaultParagraphHtmlRenderer.prototype = new Object_0;
_.createDomImpl = function createDomImpl_7(element){
  var nodelet;
  return nodelet = this.createNodelet(element) , $appendSpacer(($clinit_939() , nodelet)) , $setContainerNodelet(element, nodelet) , nodelet;
}
;
_.createNodelet = function createNodelet(element){
  return $doc.createElement(this.implTagName);
}
;
_.getClass$ = function getClass_572(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_DefaultParagraphHtmlRenderer_2_classLit;
}
;
_.castableTypeMap$ = {212:1};
_.implTagName = null;
var BULLET_CLASSNAMES;
function Caption$2_0(){
  $clinit_903();
  this.implTagName = 'div';
}

function Caption$2(){
}

_ = Caption$2_0.prototype = Caption$2.prototype = new DefaultParagraphHtmlRenderer;
_.createNodelet = function createNodelet_0(element){
  var e;
  e = $doc.createElement(this.implTagName);
  e.className = 'w-caption';
  return e;
}
;
_.getClass$ = function getClass_573(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_Caption$2_2_classLit;
}
;
_.castableTypeMap$ = {212:1};
function $buildAnnotationEnds(this$static, b){
  var key, key$iterator, outerIter, entry;
  for (key$iterator = (outerIter = $keySet_0(this$static.annotations).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter)); key$iterator.val$outerIter.hasNext();) {
    key = dynamicCast((entry = dynamicCast(key$iterator.val$outerIter.next_0(), 11) , entry.getKey()), 1);
    $add_9(b.mutationList, new Nindo$EndAnnotation_0(key));
  }
  this$static.annotations.clear();
}

function $buildAnnotationStarts(this$static, b){
  var entry, entry$iterator;
  for (entry$iterator = this$static.annotations.entrySet_0().iterator_0(); entry$iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.next_0(), 11);
    $add_9(b.mutationList, new Nindo$StartAnnotation_0(dynamicCast(entry.getKey(), 1), dynamicCast(entry.getValue(), 1)));
  }
}

function CaretAnnotations_0(){
  this.annotations = new HashMap_0;
}

function CaretAnnotations(){
}

_ = CaretAnnotations_0.prototype = CaretAnnotations.prototype = new Object_0;
_.getClass$ = function getClass_574(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_CaretAnnotations_2_classLit;
}
;
_.castableTypeMap$ = {};
_.resolver = null;
function $clinit_907(){
  $clinit_907 = nullMethod;
  $clinit_776();
  INSTANCE_8 = new ChunkyElementHandler_0;
}

function ChunkyElementHandler_0(){
}

function ChunkyElementHandler(){
}

_ = ChunkyElementHandler_0.prototype = ChunkyElementHandler.prototype = new NodeEventHandlerImpl;
_.getClass$ = function getClass_575(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_ChunkyElementHandler_2_classLit;
}
;
_.castableTypeMap$ = {216:1};
var INSTANCE_8;
function $clinit_908(){
  $clinit_908 = nullMethod;
  EDIT_MODE_LISTENER_PROP = new Property$ImmutableProperty_0('display_edit_mode');
}

function getListener(node){
  $clinit_908();
  var e;
  e = node;
  return e?dynamicCast(e.transientData.get_0(EDIT_MODE_LISTENER_PROP.id_0), 229):null;
}

function onEditModeChange(node, isEditing){
  var implNodelet;
  $clinit_908();
  var listener;
  listener = getListener(node);
  !!node && !!listener && (implNodelet = node.containerNodelet , !!implNodelet && (implNodelet.style['-webkit-user-modify'] = isEditing?'read-write-plaintext-only':'read-only' , implNodelet.style['white-space'] = 'pre-wrap' , implNodelet) , undefined);
}

var EDIT_MODE_LISTENER_PROP;
function $clinit_910(){
  $clinit_910 = nullMethod;
  renderFunc_0 = new StyleAnnotationHandler$1_0;
  KEYS_1 = newStringSet(initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['style/backgroundColor', 'style/color', 'style/fontFamily', 'style/fontSize', 'style/fontStyle', 'style/fontWeight', 'style/textDecoration', 'style/verticalAlign']));
}

function StyleAnnotationHandler_0(painter){
  this.painter = painter;
}

function StyleAnnotationHandler(){
}

_ = StyleAnnotationHandler_0.prototype = StyleAnnotationHandler.prototype = new Object_0;
_.getClass$ = function getClass_576(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_StyleAnnotationHandler_2_classLit;
}
;
_.handleAnnotationChange = function handleAnnotationChange_3(bundle, start, end, key, newValue){
  $scheduleRepaint(this.painter, bundle, start, end);
}
;
_.castableTypeMap$ = {429:1};
_.painter = null;
var KEYS_1, renderFunc_0;
function StyleAnnotationHandler$1_0(){
}

function StyleAnnotationHandler$1(){
}

_ = StyleAnnotationHandler$1_0.prototype = StyleAnnotationHandler$1.prototype = new Object_0;
_.apply_5 = function apply_31(from, isEditing){
  var entry, entry$iterator, map;
  map = new HashMap_0;
  for (entry$iterator = from.entrySet_0().iterator_0(); entry$iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.next_0(), 11);
    dynamicCast(entry.getKey(), 1).indexOf('style/') == 0 && map.put(($clinit_910() , $substring(dynamicCast(entry.getKey(), 1), 6)), dynamicCast(entry.getValue(), 1));
  }
  return map;
}
;
_.getClass$ = function getClass_577(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_StyleAnnotationHandler$1_2_classLit;
}
;
_.castableTypeMap$ = {221:1};
function $clinit_912(){
  $clinit_912 = nullMethod;
  INSTANCE_9 = new UpdateContentEditable_0;
}

function UpdateContentEditable_0(){
}

function UpdateContentEditable(){
}

_ = UpdateContentEditable_0.prototype = UpdateContentEditable.prototype = new Object_0;
_.getClass$ = function getClass_578(){
  return Lorg_waveprotocol_wave_client_editor_content_misc_UpdateContentEditable_2_classLit;
}
;
_.castableTypeMap$ = {229:1};
var INSTANCE_9;
function $clinit_913(){
  $clinit_913 = nullMethod;
  LINE_0 = new Property$ImmutableProperty_0('line');
  FIRST_LINE = new Property$MutableProperty_0('fline');
}

function Line_0(cxt, lineElement){
  $clinit_913();
  this.cxt = cxt;
  this.lineElement = lineElement;
  this.paragraph = $transparentCreate_0(cxt.this$0.fullContentView, 'l:p', cxt.this$0.mutableContent.doc.substrate.getAttributes(lineElement), lineElement.parent_0, lineElement.next);
  $clinit_840();
  $setProperty_1(HARD, ($clinit_790() , this.paragraph), HARD);
  lineElement.transientData.put_1(LINE_0.id_0, this);
  this.paragraph.transientData.put_1(LINE_0.id_0, this);
}

function Line(){
}

_ = Line_0.prototype = Line.prototype = new Object_0;
_.getClass$ = function getClass_579(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_Line_2_classLit;
}
;
_.toString$ = function toString_65(){
  return 'Line(' + createNode(($clinit_853() , INSTANCE_6), this.lineElement).builder.impl.string + ', ' + this.cachedNumberValue + ')';
}
;
_.castableTypeMap$ = {230:1};
_.cachedNumberValue = -1;
_.cxt = null;
_.lineElement = null;
_.next = null;
_.paragraph = null;
_.previous = null;
var FIRST_LINE, LINE_0;
function $handleNewChild(this$static, container, child){
  var before, cxt, element, line, paragraph, previousDirectSibling, previousLine, previousPersistentSibling, previousFirst, e;
  if (this$static.nested) {
    return;
  }
  this$static.nested = true;
  try {
    cxt = container.context;
    element = child.asElement();
    if (!!element && ($clinit_916() , $equals_3('line', element.tagName_0))) {
      line = new Line_0(cxt, element);
      previousDirectSibling = child.prev;
      previousPersistentSibling = dynamicCast(container.context.this$0.mutableContent.doc.substrate.getPreviousSibling(child), 197);
      if (!previousPersistentSibling) {
        previousFirst = ($clinit_913() , dynamicCast(container.transientData.get_0(FIRST_LINE.id_0), 230));
        !!previousFirst && (checkNotNull_1(previousFirst, 'Next line must not be null') , line.next = previousFirst , line.previous = line.next.previous , line.next.previous = line , !!line.previous && (line.previous.next = line) , undefined);
        container.transientData.put_1(FIRST_LINE.id_0, line);
      }
       else {
        element.parent_0 == container?(previousLine = ($clinit_913() , dynamicCast(previousDirectSibling.asElement().transientData.get_0(LINE_0.id_0), 230))):(previousLine = ($clinit_913() , dynamicCast(element.parent_0.transientData.get_0(LINE_0.id_0), 230)));
        checkNotNull_1(previousLine, 'Previous line must not be null');
        line.previous = previousLine;
        line.next = line.previous.next;
        line.previous.next = line;
        !!line.next && (line.next.previous = line);
      }
      paragraph = line.paragraph;
      if (element.parent_0 != container) {
        $transparentMove(cxt.this$0.fullContentView, paragraph, dynamicCast(paragraph.next, 197), dynamicCast(null, 197), null);
        $transparentMove_0(cxt.this$0.fullContentView, container, paragraph, null, element.parent_0.next);
        $transparentMove_0(cxt.this$0.fullContentView, container, element, null, paragraph);
      }
    }
     else {
      before = child.prev;
      paragraph = !before?null:(e = before.asElement() , !!e && $equals_3(e.tagName_0, 'l:p')?e:null);
      !!paragraph && $transparentMove_0(cxt.this$0.fullContentView, paragraph, child, child.next, null);
    }
  }
   finally {
    this$static.nested = false;
  }
}

function $handleRemovedChild(this$static, container, child){
  var cxt, element, line, previousLine;
  if (this$static.nested) {
    return;
  }
  if ($isContentAttached(child)) {
    $log_0(($clinit_761() , logger_1).errorLogger, 'Node was moved and not removed?');
    return;
  }
  this$static.nested = true;
  try {
    cxt = container.context;
    element = child.asElement();
    if (!!element && ($clinit_916() , $equals_3('line', element.tagName_0))) {
      line = ($clinit_913() , dynamicCast(element.transientData.get_0(LINE_0.id_0), 230));
      if (line.paragraph.firstChild_0) {
        previousLine = line.previous;
        previousLine?($transparentMove(cxt.this$0.fullContentView, previousLine.paragraph, dynamicCast(line.paragraph.firstChild_0, 197), dynamicCast(null, 197), null) , undefined):$transparentUnwrap(cxt.this$0.fullContentView, line.paragraph);
      }
      !!line.paragraph.parent_0 && $transparentDeepRemove(line.cxt.this$0.fullContentView, line.paragraph);
      !!line.next && (line.next.previous = line.previous);
      !!line.previous && (line.previous.next = line.next);
      line.previous = line.next = null;
    }
  }
   finally {
    this$static.nested = false;
  }
}

function LineContainerParagraphiser_0(){
  this.lineHandler = new LineContainerParagraphiser$LineHandler_0(this);
}

function LineContainerParagraphiser(){
}

_ = LineContainerParagraphiser_0.prototype = LineContainerParagraphiser.prototype = new NodeMutationHandlerImpl;
_.getClass$ = function getClass_580(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_LineContainerParagraphiser_2_classLit;
}
;
_.onChildAdded = function onChildAdded_2(container, child){
  ($clinit_916() , !child.isTextNode() && $equals_3(dynamicCast(child, 196).tagName_0, 'line')) || $handleNewChild(this, container, child);
}
;
_.onChildRemoved = function onChildRemoved_2(element, child){
  $handleRemovedChild(this, element, child);
}
;
_.castableTypeMap$ = {215:1, 224:1};
_.nested = false;
function $onAttributeModified_1(element, name_0, newValue){
  if (!($clinit_913() , dynamicCast(element.transientData.get_0(LINE_0.id_0), 230))) {
    return;
  }
  $transparentSetAttribute_0(dynamicCast(element.transientData.get_0(LINE_0.id_0), 230).paragraph, name_0, newValue);
}

function LineContainerParagraphiser$LineHandler_0(this$0){
  this.this$0 = this$0;
}

function LineContainerParagraphiser$LineHandler(){
}

_ = LineContainerParagraphiser$LineHandler_0.prototype = LineContainerParagraphiser$LineHandler.prototype = new RenderingMutationHandler;
_.createDomImpl = function createDomImpl_8(element){
  return null;
}
;
_.getClass$ = function getClass_581(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_LineContainerParagraphiser$LineHandler_2_classLit;
}
;
_.onActivationStart = function onActivationStart_2(element){
  element.attributes.each_2(new RenderingMutationHandler$1_0(this, element));
}
;
_.onAddedToParent = function onAddedToParent_3(element, oldParent){
  $handleNewChild(this.this$0, dynamicCast(element.context.this$0.mutableContent.doc.substrate.getParentElement(element), 196), element);
}
;
_.onAttributeModified = function onAttributeModified_4(element, name_0, oldValue, newValue){
  $onAttributeModified_1(element, name_0, newValue);
}
;
_.castableTypeMap$ = {212:1, 215:1, 224:1};
_.this$0 = null;
function $clinit_916(){
  $clinit_916 = nullMethod;
  DEFAULT_PARAGRAPHISER = new LineContainerParagraphiser_0;
  DEFAULT_RENDERER = new LineRendering$1_0;
  DEFAULT_PARAGRAPH_EVENT_HANDLER = new LocalParagraphEventHandler_0;
}

function registerContainer(registry){
  $clinit_916();
  $clinit_2135();
  $add_13(lineContainerTagnames, 'body');
  $registerMutationHandler(registry, DEFAULT_PARAGRAPHISER);
  $registerRenderer(registry, 'body', DEFAULT_RENDERER);
  $registerNiceHtmlRenderer(registry, 'body', ($clinit_1004() , SHALLOW_CLONE_RENDERER));
}

function registerLines(registry){
  $clinit_916();
  $registerRenderingMutationHandler(registry, 'l:p', ($clinit_925() , DEFAULT_RENDERER_0));
  $registerEventHandler(registry, 'l:p', DEFAULT_PARAGRAPH_EVENT_HANDLER);
  $registerNiceHtmlRenderer(registry, 'l:p', DEFAULT_NICE_HTML_RENDERER);
  $registerRenderingMutationHandler(registry, 'line', DEFAULT_PARAGRAPHISER.lineHandler);
}

var DEFAULT_PARAGRAPHISER, DEFAULT_PARAGRAPH_EVENT_HANDLER, DEFAULT_RENDERER;
function LineRendering$1_0(){
}

function LineRendering$1(){
}

_ = LineRendering$1_0.prototype = LineRendering$1.prototype = new Object_0;
_.createDomImpl = function createDomImpl_9(element){
  var e;
  e = $doc.createElement('ul');
  e.style['padding'] = 0 + ($clinit_88() , 'px');
  e.style['margin'] = '0px';
  return $setContainerNodelet(element, e) , e;
}
;
_.getClass$ = function getClass_582(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_LineRendering$1_2_classLit;
}
;
_.castableTypeMap$ = {212:1};
function LocalParagraphEventHandler_0(){
  $clinit_776();
}

function LocalParagraphEventHandler(){
}

_ = LocalParagraphEventHandler_0.prototype = LocalParagraphEventHandler.prototype = new NodeEventHandlerImpl;
_.getClass$ = function getClass_583(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_LocalParagraphEventHandler_2_classLit;
}
;
_.castableTypeMap$ = {216:1};
function $markDirty(this$static, paraElement, oldIndent){
  var indent;
  indent = getIndent(oldIndent);
  (!this$static.dirtyElements.has(paraElement) || dynamicCast(this$static.dirtyElements.get(paraElement), 66).value_0 > indent) && this$static.dirtyElements.put_0(paraElement, valueOf_13(indent));
}

function $markDirty_0(this$static, paraElement, indent){
  (!this$static.dirtyElements.has(paraElement) || dynamicCast(this$static.dirtyElements.get(paraElement), 66).value_0 > indent) && this$static.dirtyElements.put_0(paraElement, valueOf_13(indent));
}

function $markRemoved(this$static, elem){
  var line, next;
  line = ($clinit_913() , dynamicCast(elem.transientData.get_0(LINE_0.id_0), 230));
  if (!line) {
    return;
  }
  next = line.next;
  !!next && $markDirty_0(this$static, next.paragraph, this$static.dirtyElements.has(line.paragraph)?min_1(!line.lineElement?0:getIndent(dynamicCast(line.lineElement.attributes.get_4('i'), 1)), dynamicCast(this$static.dirtyElements.get(line.paragraph), 66).value_0):!line.lineElement?0:getIndent(dynamicCast(line.lineElement.attributes.get_4('i'), 1)));
}

function $minIndent(this$static, line){
  return min_1(!line.lineElement?0:getIndent(dynamicCast(line.lineElement.attributes.get_4('i'), 1)), dynamicCast(this$static.dirtyElements.get(line.paragraph), 66).value_0);
}

function $renumber(this$static, aroundLine){
  var importance, line, minimumIndent, startingLine, startingNumber;
  if (!aroundLine.paragraph.implNodelet) {
    this$static.dirtyElements.remove_6(aroundLine.paragraph);
    return;
  }
  minimumIndent = min_1(!aroundLine.lineElement?0:getIndent(dynamicCast(aroundLine.lineElement.attributes.get_4('i'), 1)), dynamicCast(this$static.dirtyElements.get(aroundLine.paragraph), 66).value_0);
  startingLine = aroundLine;
  startingNumber = 1;
  line = aroundLine;
  while (line) {
    importance = importance_0(minimumIndent, isDecimalListItem(line.paragraph), !line.lineElement?0:getIndent(dynamicCast(line.lineElement.attributes.get_4('i'), 1)));
    if (importance == ($clinit_923() , MATCH)) {
      if (line.cachedNumberValue != -1) {
        startingLine = line;
        startingNumber = line.cachedNumberValue;
        break;
      }
    }
     else if (importance == SUPERIOR) {
      break;
    }
    startingLine = line;
    line = line.previous;
  }
  $renumberRange(this$static, startingLine, minimumIndent, startingNumber);
}

function $renumberAll(this$static){
  var data, data$iterator, line, lines, docIds, list, nextDocId, a_1, result_0, x_0;
  lines = (list = new ArrayList_0 , nextDocId = initDim(_3I_classLit, {9:1}, -1, 1, 1) , docIds = ($clinit_2309() , defaultCollectionFactory.createIdentityMap()) , this$static.dirtyElements.each(new OrderedListRenumberer$1_0(this$static, docIds, nextDocId, list)) , $clinit_480() , x_0 = (a_1 = list.array , result_0 = a_1.slice(0, list.size_0) , initValues(a_1.arrayClass$, a_1.castableTypeMap$, a_1.queryId$, result_0) , result_0) , mergeSort(x_0, 0, x_0.length, ($clinit_497() , $clinit_497() , NATURAL)) , replaceContents(list, x_0) , list);
  for (data$iterator = new AbstractList$IteratorImpl_0(lines); data$iterator.i < data$iterator.this$0_0.size_1();) {
    data = dynamicCast($next_4(data$iterator), 231);
    line = data.line;
    this$static.dirtyElements.has(line.paragraph) && $renumber(this$static, line);
  }
  this$static.dirtyElements.clear();
}

function $renumberRange(this$static, startingLine, minimumIndent, startingNumber){
  var currentIndent, isNumbered, line, num, numbers;
  line = startingLine;
  currentIndent = !startingLine.lineElement?0:getIndent(dynamicCast(startingLine.lineElement.attributes.get_4('i'), 1));
  numbers = new OrderedListRenumberer$LevelNumbers_0(currentIndent, startingNumber);
  while (line) {
    currentIndent = !line.lineElement?0:getIndent(dynamicCast(line.lineElement.attributes.get_4('i'), 1));
    isNumbered = isDecimalListItem(line.paragraph);
    $setLevel(numbers, currentIndent);
    if (importance_0(minimumIndent, isNumbered, currentIndent) == ($clinit_923() , SUPERIOR) && line != startingLine) {
      break;
    }
    if (isNumbered) {
      num = numbers.numbers[numbers.currentLevel]++;
      if (line.cachedNumberValue != num) {
        line.cachedNumberValue = num;
        line.paragraph.implNodelet.setAttribute('value', '' + num);
      }
    }
     else {
      numbers.numbers[numbers.currentLevel] = 1;
    }
    this$static.dirtyElements.remove_6(line.paragraph);
    line = line.next;
  }
}

function OrderedListRenumberer_0(){
  this.dirtyElements = ($clinit_2309() , defaultCollectionFactory.createIdentityMap());
}

function importance_0(relativeToIndent, isNumberedItem, indent){
  if (indent == relativeToIndent && isNumberedItem) {
    return $clinit_923() , MATCH;
  }
  if (indent <= relativeToIndent) {
    return $clinit_923() , SUPERIOR;
  }
  return $clinit_923() , INFERIOR;
}

function OrderedListRenumberer(){
}

_ = OrderedListRenumberer_0.prototype = OrderedListRenumberer.prototype = new Object_0;
_.getClass$ = function getClass_584(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer_2_classLit;
}
;
_.castableTypeMap$ = {};
function $apply_4(this$static, paraElement){
  var docId, line, mapper;
  line = $isContentAttached(paraElement)?($clinit_913() , dynamicCast(paraElement.transientData.get_0(LINE_0.id_0), 230)):null;
  if (line) {
    line.cachedNumberValue = -1;
    mapper = paraElement.context.this$0.indexedDoc;
    if (this$static.val$docIds.has(mapper)) {
      docId = dynamicCast(this$static.val$docIds.get(mapper), 66).value_0;
    }
     else {
      docId = this$static.val$nextDocId[0]++;
      this$static.val$docIds.put_0(mapper, valueOf_13(docId));
    }
    $add_9(this$static.val$list, new OrderedListRenumberer$ComparableLine_0(line, docId, $minIndent(this$static.this$0, line), $getLocation_3(mapper, line.lineElement)));
  }
}

function OrderedListRenumberer$1_0(this$0, val$docIds, val$nextDocId, val$list){
  this.this$0 = this$0;
  this.val$docIds = val$docIds;
  this.val$nextDocId = val$nextDocId;
  this.val$list = val$list;
}

function OrderedListRenumberer$1(){
}

_ = OrderedListRenumberer$1_0.prototype = OrderedListRenumberer$1.prototype = new Object_0;
_.apply_3 = function apply_32(paraElement, oldIndent){
  $apply_4(this, dynamicCast(paraElement, 196), dynamicCast(oldIndent, 66));
}
;
_.getClass$ = function getClass_585(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$docIds = null;
_.val$list = null;
_.val$nextDocId = null;
function $compareTo_8(this$static, d2){
  if (this$static.docId != d2.docId) {
    return this$static.docId - d2.docId;
  }
  if (this$static.minIndent != d2.minIndent) {
    return this$static.minIndent - d2.minIndent;
  }
  return this$static.location_0 - d2.location_0;
}

function OrderedListRenumberer$ComparableLine_0(line, docId, minIndent, location_0){
  this.line = line;
  this.docId = docId;
  this.minIndent = minIndent;
  this.location_0 = location_0;
}

function OrderedListRenumberer$ComparableLine(){
}

_ = OrderedListRenumberer$ComparableLine_0.prototype = OrderedListRenumberer$ComparableLine.prototype = new Object_0;
_.compareTo$ = function compareTo_9(d2){
  return $compareTo_8(this, dynamicCast(d2, 231));
}
;
_.getClass$ = function getClass_586(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer$ComparableLine_2_classLit;
}
;
_.castableTypeMap$ = {10:1, 231:1};
_.docId = 0;
_.line = null;
_.location_0 = 0;
_.minIndent = 0;
function $$init_87(this$static){
  var i;
  this$static.numbers = initDim(_3I_classLit, {9:1}, -1, 51, 1);
  for (i = 0; i < this$static.numbers.length; ++i) {
    this$static.numbers[i] = 1;
  }
}

function $setLevel(this$static, level){
  var i;
  for (i = this$static.currentLevel + 1; i <= level; ++i) {
    this$static.numbers[i] = 1;
  }
  this$static.currentLevel = level;
}

function OrderedListRenumberer$LevelNumbers_0(initialLevel, initialNumber){
  $$init_87(this);
  $setLevel(this, initialLevel);
  this.numbers[this.currentLevel] = initialNumber;
}

function OrderedListRenumberer$LevelNumbers(){
}

_ = OrderedListRenumberer$LevelNumbers_0.prototype = OrderedListRenumberer$LevelNumbers.prototype = new Object_0;
_.getClass$ = function getClass_587(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer$LevelNumbers_2_classLit;
}
;
_.toString$ = function toString_66(){
  return 'current=' + this.currentLevel + ', ' + toString__devirtual$(this.numbers);
}
;
_.castableTypeMap$ = {};
_.currentLevel = 0;
function $clinit_923(){
  $clinit_923 = nullMethod;
  SUPERIOR = new OrderedListRenumberer$RelativeImportance_0('SUPERIOR', 0);
  INFERIOR = new OrderedListRenumberer$RelativeImportance_0('INFERIOR', 1);
  MATCH = new OrderedListRenumberer$RelativeImportance_0('MATCH', 2);
  $VALUES_24 = initValues(_3Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer$RelativeImportance_2_classLit, {9:1, 68:1, 170:1}, 101, [SUPERIOR, INFERIOR, MATCH]);
}

function OrderedListRenumberer$RelativeImportance_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_31(name_0){
  $clinit_923();
  return valueOf_0(($clinit_924() , $MAP_24), name_0);
}

function values_25(){
  $clinit_923();
  return $VALUES_24;
}

function OrderedListRenumberer$RelativeImportance(){
}

_ = OrderedListRenumberer$RelativeImportance_0.prototype = OrderedListRenumberer$RelativeImportance.prototype = new Enum;
_.getClass$ = function getClass_588(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer$RelativeImportance_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 101:1};
var $VALUES_24, INFERIOR, MATCH, SUPERIOR;
function $clinit_924(){
  $clinit_924 = nullMethod;
  $MAP_24 = createValueOfMap(($clinit_923() , $VALUES_24));
}

var $MAP_24;
function $clinit_925(){
  $clinit_925 = nullMethod;
  DEFAULT_RENDERER_0 = new ParagraphRenderer_0(new DefaultParagraphHtmlRenderer_0);
  DEFAULT_NICE_HTML_RENDERER = new ParagraphNiceHtmlRenderer_0;
  DEFAULT_EVENT_HANDLER = new ParagraphEventHandler_0;
  INDENTER = new Paragraph$1_0;
  OUTDENTER = new Paragraph$2_0;
}

function getIndent(str){
  $clinit_925();
  var $e0;
  if (str == null) {
    return 0;
  }
  try {
    return min_1(max_1(0, __parseAndValidateInt(str, 10)), 50);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 188)) {
      return 0;
    }
     else 
      throw $e0;
  }
}

function isDecimalListItem(e){
  $clinit_925();
  return $equals_3('li', dynamicCast(e.attributes.get_4('t'), 1)) && $equals_3('decimal', dynamicCast(e.attributes.get_4('listyle'), 1));
}

function register_9(registry){
  $clinit_925();
  $registerEventHandler(registry, 'p', DEFAULT_EVENT_HANDLER);
  $registerRenderingMutationHandler(registry, 'p', DEFAULT_RENDERER_0);
}

var DEFAULT_EVENT_HANDLER, DEFAULT_NICE_HTML_RENDERER, DEFAULT_RENDERER_0, INDENTER, OUTDENTER;
function Paragraph$1_0(){
}

function Paragraph$1(){
}

_ = Paragraph$1_0.prototype = Paragraph$1.prototype = new Object_0;
_.getClass$ = function getClass_589(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$1_2_classLit;
}
;
_.castableTypeMap$ = {12:1};
function Paragraph$2_0(){
}

function Paragraph$2(){
}

_ = Paragraph$2_0.prototype = Paragraph$2.prototype = new Object_0;
_.getClass$ = function getClass_590(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$2_2_classLit;
}
;
_.castableTypeMap$ = {12:1};
function $clinit_930(){
  $clinit_930 = nullMethod;
  var a_0, a$array, a$index, a$max;
  LEFT_1 = new Paragraph$Alignment_0('LEFT', 0, 'l', 'left');
  RIGHT_1 = new Paragraph$Alignment_0('RIGHT', 1, 'r', 'right');
  CENTER_1 = new Paragraph$Alignment_0('CENTER', 2, 'c', 'center');
  JUSTIFY_0 = new Paragraph$Alignment_0('JUSTIFY', 3, 'j', 'justify');
  $VALUES_25 = initValues(_3Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$Alignment_2_classLit, {9:1, 68:1, 170:1}, 102, [LEFT_1, RIGHT_1, CENTER_1, JUSTIFY_0]);
  map_0 = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  for (a$array = $VALUES_25 , a$index = 0 , a$max = a$array.length; a$index < a$max; ++a$index) {
    a_0 = a$array[a$index];
    map_0.put_3(a_0.value_0, a_0);
  }
}

function Paragraph$Alignment_0(enum$name, enum$ordinal, value, css_0){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
  this.value_0 = value;
  this.css_0 = css_0;
}

function fromValue_0(v){
  $clinit_930();
  return v != null?dynamicCast(map_0.get_4(v), 102):null;
}

function valueOf_32(name_0){
  $clinit_930();
  return valueOf_0(($clinit_931() , $MAP_25), name_0);
}

function values_26(){
  $clinit_930();
  return $VALUES_25;
}

function Paragraph$Alignment(){
}

_ = Paragraph$Alignment_0.prototype = Paragraph$Alignment.prototype = new Enum;
_.getClass$ = function getClass_593(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$Alignment_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 12:1, 13:1, 65:1, 102:1};
_.css_0 = null;
_.value_0 = null;
var $VALUES_25, CENTER_1, JUSTIFY_0, LEFT_1, RIGHT_1, map_0;
function $clinit_931(){
  $clinit_931 = nullMethod;
  $MAP_25 = createValueOfMap(($clinit_930() , $VALUES_25));
}

var $MAP_25;
function $clinit_932(){
  $clinit_932 = nullMethod;
  var a_0, a$array, a$index, a$max;
  LTR_0 = new Paragraph$Direction_0('LTR', 0, 'l', 'ltr', ($clinit_930() , LEFT_1), RIGHT_1);
  RTL_0 = new Paragraph$Direction_0('RTL', 1, 'r', 'rtl', RIGHT_1, LEFT_1);
  $VALUES_26 = initValues(_3Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$Direction_2_classLit, {9:1, 68:1, 170:1}, 103, [LTR_0, RTL_0]);
  map_1 = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  for (a$array = $VALUES_26 , a$index = 0 , a$max = a$array.length; a$index < a$max; ++a$index) {
    a_0 = a$array[a$index];
    map_1.put_3(a_0.value_0, a_0);
  }
}

function Paragraph$Direction_0(enum$name, enum$ordinal, value, css_0, alignment, oppositeAlignment){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
  this.value_0 = value;
  this.css_0 = css_0;
  this.alignment = alignment;
  this.oppositeAlignment = oppositeAlignment;
}

function fromValue_1(v){
  $clinit_932();
  return v != null?dynamicCast(map_1.get_4(v), 103):null;
}

function valueOf_33(name_0){
  $clinit_932();
  return valueOf_0(($clinit_933() , $MAP_26), name_0);
}

function values_27(){
  $clinit_932();
  return $VALUES_26;
}

function Paragraph$Direction(){
}

_ = Paragraph$Direction_0.prototype = Paragraph$Direction.prototype = new Enum;
_.getClass$ = function getClass_594(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$Direction_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 12:1, 13:1, 65:1, 103:1};
_.alignment = null;
_.css_0 = null;
_.oppositeAlignment = null;
_.value_0 = null;
var $VALUES_26, LTR_0, RTL_0, map_1;
function $clinit_933(){
  $clinit_933 = nullMethod;
  $MAP_26 = createValueOfMap(($clinit_932() , $VALUES_26));
}

var $MAP_26;
function $clinit_937(){
  $clinit_937 = nullMethod;
  var i;
  DEFAULT_1 = new ParagraphBehaviour_0('DEFAULT', 0);
  HEADING = new ParagraphBehaviour_0('HEADING', 1);
  LIST = new ParagraphBehaviour_0('LIST', 2);
  $VALUES_27 = initValues(_3Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphBehaviour_2_classLit, {9:1, 68:1, 170:1}, 104, [DEFAULT_1, HEADING, LIST]);
  subtypeMappings = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  subtypeMappings.put_3('p', DEFAULT_1);
  for (i = 1; i <= 4; ++i) {
    subtypeMappings.put_3('h' + i, HEADING);
  }
  subtypeMappings.put_3('li', LIST);
}

function ParagraphBehaviour_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function of_0(subtype){
  $clinit_937();
  var b;
  b = dynamicCast(subtypeMappings.get_4(subtype != null?subtype:''), 104);
  return dynamicCast(valueOrDefault(b, DEFAULT_1), 104);
}

function valueOf_34(name_0){
  $clinit_937();
  return valueOf_0(($clinit_938() , $MAP_27), name_0);
}

function values_28(){
  $clinit_937();
  return $VALUES_27;
}

function ParagraphBehaviour(){
}

_ = ParagraphBehaviour_0.prototype = ParagraphBehaviour.prototype = new Enum;
_.getClass$ = function getClass_597(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphBehaviour_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 104:1};
var $VALUES_27, DEFAULT_1, HEADING, LIST, subtypeMappings;
function $clinit_938(){
  $clinit_938 = nullMethod;
  $MAP_27 = createValueOfMap(($clinit_937() , $VALUES_27));
}

var $MAP_27;
function $clinit_939(){
  $clinit_939 = nullMethod;
  $clinit_940();
  $clinit_761();
}

function $clinit_940(){
  $clinit_940 = nullMethod;
  $clinit_939();
  BR_REF = ($clinit_1033() , $clinit_1033() , ++markerIndex , '_x' + markerIndex);
}

function $appendSpacer(paragraph){
  var spacer;
  spacer = $getSpacer(paragraph);
  paragraph.appendChild(spacer);
}

function $getSpacer(paragraph){
  var last, spacer;
  last = paragraph.lastChild;
  spacer = paragraph[BR_REF] || null;
  if (!spacer) {
    spacer = $isSpacer(last)?last:$doc.createElement('br');
    $clinit_1033();
    spacer[TRANSPARENCY] = ($clinit_2121() , DEEP);
    paragraph[BR_REF] = spacer;
  }
   else if ($isSpacer(last) && last != spacer) {
    !!$getParentElement(spacer) && $removeFromParent(spacer);
    spacer = last;
    $clinit_1033();
    spacer[TRANSPARENCY] = ($clinit_2121() , DEEP);
    paragraph[BR_REF] = spacer;
  }
  return spacer;
}

function $isSpacer(n){
  var e;
  if (!n) {
    return false;
  }
  if (n.nodeType == 3) {
    return false;
  }
  e = n;
  return $equals_3(e.tagName.toLowerCase(), 'br') && ($clinit_1033() , !(!!e && (e[BACKREF_NAME] || null) != null));
}

var BR_REF;
function $ensureSpacerIfDoesntEndWithText(paragraph){
  var last, spacer;
  last = paragraph.lastChild;
  spacer = $getSpacer(paragraph);
  last == spacer && (last = last.previousSibling);
  !last || last.nodeType == 1?paragraph.appendChild(spacer):$removeFromParent(spacer);
}

function ParagraphNiceHtmlRenderer_0(){
}

function ParagraphNiceHtmlRenderer(){
}

_ = ParagraphNiceHtmlRenderer_0.prototype = ParagraphNiceHtmlRenderer.prototype = new Object_0;
_.getClass$ = function getClass_598(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphNiceHtmlRenderer_2_classLit;
}
;
_.castableTypeMap$ = {213:1};
function $onAttributeModified_2(this$static, p, name_0, oldValue, newValue){
  if (!p.implNodelet) {
    return;
  }
  if ($equals_3('t', name_0) || $equals_3('listyle', name_0)) {
    of_0(newValue);
    this$static.elementsToRender.add_2(p);
    $scheduleFinally_0(this$static.runner, this$static.batchRenderCommand);
    $scheduleRenumber(this$static, p, dynamicCast(p.attributes.get_4('i'), 1));
  }
   else if ($equals_3('i', name_0)) {
    this$static.elementsToRender.add_2(p);
    $scheduleFinally_0(this$static.runner, this$static.batchRenderCommand);
    $markDirty(this$static.renumberer, p, oldValue);
    !this$static.renumberer.dirtyElements.isEmpty() && $scheduleFinally_0(this$static.runner, this$static.batchRenderCommand);
  }
   else 
    $equals_3('a', name_0)?(this$static.elementsToRender.add_2(p) , $scheduleFinally_0(this$static.runner, this$static.batchRenderCommand)):$equals_3('d', name_0) && (this$static.elementsToRender.add_2(p) , $scheduleFinally_0(this$static.runner, this$static.batchRenderCommand));
}

function $scheduleRenumber(this$static, p, oldIndent){
  $markDirty(this$static.renumberer, p, oldIndent);
  !this$static.renumberer.dirtyElements.isEmpty() && $scheduleFinally_0(this$static.runner, this$static.batchRenderCommand);
}

function ParagraphRenderer_0(htmlRenderer){
  ParagraphRenderer_1.call(this, htmlRenderer, new OrderedListRenumberer_0, new FinalTaskRunnerImpl_0);
}

function ParagraphRenderer_1(htmlRenderer, renumberer, finalTaskRunner){
  this.elementsToRender = ($clinit_2309() , defaultCollectionFactory.createIdentitySet());
  this.batchRenderCommand = new ParagraphRenderer$1_0(this);
  checkNotNull_1(htmlRenderer, 'Null html renderer');
  this.htmlRenderer = htmlRenderer;
  this.renumberer = renumberer;
  this.runner = finalTaskRunner;
}

function ParagraphRenderer(){
}

_ = ParagraphRenderer_0.prototype = ParagraphRenderer.prototype = new RenderingMutationHandler;
_.createDomImpl = function createDomImpl_10(element){
  return $createDomImpl(this.htmlRenderer, element);
}
;
_.getClass$ = function getClass_604(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphRenderer_2_classLit;
}
;
_.onActivatedSubtree = function onActivatedSubtree_0(p){
  p.attributes.each_2(new RenderingMutationHandler$1_0(this, p));
  !!p.implNodelet && $ensureSpacerIfDoesntEndWithText(($clinit_939() , p).implNodelet);
}
;
_.onAddedToParent = function onAddedToParent_4(element, oldParent){
  $markDirty(this.renumberer, element, dynamicCast(element.attributes.get_4('i'), 1));
  !this.renumberer.dirtyElements.isEmpty() && $scheduleFinally_0(this.runner, this.batchRenderCommand);
}
;
_.onAttributeModified = function onAttributeModified_5(p, name_0, oldValue, newValue){
  $onAttributeModified_2(this, p, name_0, oldValue, newValue);
}
;
_.onChildAdded = function onChildAdded_3(p, child){
  $ensureSpacerIfDoesntEndWithText(($clinit_939() , child.getImplNodelet() , p.implNodelet));
}
;
_.onChildRemoved = function onChildRemoved_3(p, child){
  $ensureSpacerIfDoesntEndWithText(($clinit_939() , child.getImplNodelet() , p.implNodelet));
}
;
_.onEmptied = function onEmptied_2(p){
  p.implNodelet.childNodes.length == 0 && $appendSpacer(($clinit_939() , p.implNodelet));
}
;
_.onRemovedFromParent = function onRemovedFromParent_3(element, newParent){
  $markRemoved(this.renumberer, element);
  !this.renumberer.dirtyElements.isEmpty() && $scheduleFinally_0(this.runner, this.batchRenderCommand);
}
;
_.castableTypeMap$ = {212:1, 215:1};
_.htmlRenderer = null;
_.renumberer = null;
_.runner = null;
function $render_0(this$static, p){
  var indent;
  if (!p.implNodelet) {
    return;
  }
  indent = getIndent(dynamicCast(p.attributes.get_4('i'), 1));
  $clinit_761();
  ++ignoreMutations;
  $saveSelection_0(p.context.this$0.selectionMaintainer);
  $updateRendering(this$static.this$0.htmlRenderer, p, dynamicCast(p.attributes.get_4('t'), 1), dynamicCast(p.attributes.get_4('listyle'), 1), indent, fromValue_0(dynamicCast(p.attributes.get_4('a'), 1)), fromValue_1(dynamicCast(p.attributes.get_4('d'), 1)));
  $restoreSelection(p.context.this$0.selectionMaintainer, null);
  --ignoreMutations;
}

function ParagraphRenderer$1_0(this$0){
  this.this$0 = this$0;
}

function ParagraphRenderer$1(){
}

_ = ParagraphRenderer$1_0.prototype = ParagraphRenderer$1.prototype = new Object_0;
_.execute_0 = function execute_30(){
  var e;
  while (!this.this$0.elementsToRender.isEmpty()) {
    e = dynamicCast(this.this$0.elementsToRender.someElement(), 196);
    this.this$0.elementsToRender.remove_6(e);
    $render_0(this, e);
  }
  $renumberAll(this.this$0.renumberer);
}
;
_.getClass$ = function getClass_605(){
  return Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphRenderer$1_2_classLit;
}
;
_.castableTypeMap$ = {252:1, 253:1};
_.this$0 = null;
function $flush_0(this$static){
  var i;
  this$static.entries.size_0 > 0 && $log_0(($clinit_761() , logger_1).traceLogger, 'DomMutation Flush of ' + this$static.entries.size_0 + ' mutations.');
  for (i = this$static.entries.size_0 - 1; i >= 0; --i) {
    $undo(dynamicCast($get_7(this$static.entries, i), 234));
  }
  for (i = 0; i < this$static.entries.size_0; ++i) {
    $cleanup(dynamicCast($get_7(this$static.entries, i), 234));
  }
  $clear_4(this$static.entries);
}

function DomMutationReverter_0(listener){
  this.entries = new ArrayList_0;
  this.listener = listener;
}

function DomMutationReverter(){
}

_ = DomMutationReverter_0.prototype = DomMutationReverter.prototype = new Object_0;
_.getClass$ = function getClass_633(){
  return Lorg_waveprotocol_wave_client_editor_extract_DomMutationReverter_2_classLit;
}
;
_.castableTypeMap$ = {};
_.listener = null;
function $cleanup(this$static){
  if (this$static.removeAfter) {
    $log_0(($clinit_761() , logger_1).traceLogger, 'REVERT CLEANUP: ' + (this$static.removedNode.nodeType == 3?this$static.removedNode.data:this$static.removedNode.tagName));
    $removeFromParent(this$static.removedNode);
  }
}

function $undo(this$static){
  this$static.oldParent.insertBefore(this$static.removedNode, this$static.oldNodeAfter);
}

function ImeExtractor$1_0(){
}

function ImeExtractor$1(){
}

_ = ImeExtractor$1_0.prototype = ImeExtractor$1.prototype = new Object_0;
_.createDomImpl = function createDomImpl_11(element){
  return $setAutoAppendContainer(element, $doc.createElement('span'));
}
;
_.getClass$ = function getClass_636(){
  return Lorg_waveprotocol_wave_client_editor_extract_ImeExtractor$1_2_classLit;
}
;
_.castableTypeMap$ = {212:1};
function InconsistencyException_0(where){
  this.fillInStackTrace();
  this.where = where;
}

function InconsistencyException(){
}

_ = InconsistencyException.prototype = new Exception;
_.getClass$ = function getClass_637(){
  return Lorg_waveprotocol_wave_client_editor_extract_InconsistencyException_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 39:1, 183:1, 226:1};
_.where = null;
function InconsistencyException$HtmlInserted_0(contentPoint, htmlPoint){
  InconsistencyException_0.call(this, dynamicCastJso(htmlPoint.container));
  this.contentPoint = contentPoint;
  this.htmlPoint = htmlPoint;
}

function InconsistencyException$HtmlInserted(){
}

_ = InconsistencyException$HtmlInserted_0.prototype = InconsistencyException$HtmlInserted.prototype = new InconsistencyException;
_.getClass$ = function getClass_638(){
  return Lorg_waveprotocol_wave_client_editor_extract_InconsistencyException$HtmlInserted_2_classLit;
}
;
_.toString$ = function toString_68(){
  return 'HtmlInserted: ' + this.contentPoint;
}
;
_.castableTypeMap$ = {9:1, 39:1, 183:1, 206:1, 226:1};
_.contentPoint = null;
_.htmlPoint = null;
function InconsistencyException$HtmlMissing_0(brokenNode, where){
  this.fillInStackTrace();
  this.where = where;
  checkNotNull_1(brokenNode, 'Broken node is unspecified');
  this.brokenNode = brokenNode;
}

function InconsistencyException$HtmlMissing(){
}

_ = InconsistencyException$HtmlMissing_0.prototype = InconsistencyException$HtmlMissing.prototype = new InconsistencyException;
_.getClass$ = function getClass_639(){
  return Lorg_waveprotocol_wave_client_editor_extract_InconsistencyException$HtmlMissing_2_classLit;
}
;
_.toString$ = function toString_69(){
  return 'HtmlMissing: ' + this.brokenNode + ' in ' + this.where;
}
;
_.castableTypeMap$ = {9:1, 39:1, 183:1, 205:1, 226:1};
_.brokenNode = null;
function PasteAnnotationLogic_0(doc, annotationLogic){
  this.doc = doc;
  this.annotationLogic = annotationLogic;
}

function PasteAnnotationLogic(){
}

_ = PasteAnnotationLogic_0.prototype = PasteAnnotationLogic.prototype = new Object_0;
_.getClass$ = function getClass_640(){
  return Lorg_waveprotocol_wave_client_editor_extract_PasteAnnotationLogic_2_classLit;
}
;
_.castableTypeMap$ = {};
_.annotationLogic = null;
_.doc = null;
function $clinit_1000(){
  $clinit_1000 = nullMethod;
  LOG_1 = new DomLogger_0('paste');
  clipboard = ($clinit_589() , $clinit_589() , INSTANCE_2);
  pasteBuffer_0 = clipboard.pasteBuffer;
  !INSTANCE_10 && (INSTANCE_10 = new PasteFormatRenderer_0);
}

function PasteExtractor_0(aggressiveSelectionHelper, mutableDocument, renderedContent, persistentContent, annotationRegistry, operationSequencer, validator, useSemanticCopyPaste){
  $clinit_1000();
  this.aggressiveSelectionHelper = aggressiveSelectionHelper;
  this.mutableDocument = mutableDocument;
  this.operationSequencer = operationSequencer;
  this.renderedContent = renderedContent;
  this.persistentContent = persistentContent;
  this.validator = validator;
  this.subtreeRenderer = new SubTreeXmlRenderer_0(mutableDocument);
  this.annotationLogic = new PasteAnnotationLogic_0(mutableDocument, annotationRegistry);
  this.useSemanticCopyPaste = useSemanticCopyPaste;
}

function PasteExtractor(){
}

_ = PasteExtractor_0.prototype = PasteExtractor.prototype = new Object_0;
_.getClass$ = function getClass_645(){
  return Lorg_waveprotocol_wave_client_editor_extract_PasteExtractor_2_classLit;
}
;
_.castableTypeMap$ = {};
_.aggressiveSelectionHelper = null;
_.annotationLogic = null;
_.busy = false;
_.mutableDocument = null;
_.operationSequencer = null;
_.persistentContent = null;
_.renderedContent = null;
_.subtreeRenderer = null;
_.useSemanticCopyPaste = false;
_.validator = null;
var LOG_1, clipboard, pasteBuffer_0;
function PasteFormatRenderer_0(){
}

function PasteFormatRenderer(){
}

_ = PasteFormatRenderer_0.prototype = PasteFormatRenderer.prototype = new Object_0;
_.getClass$ = function getClass_648(){
  return Lorg_waveprotocol_wave_client_editor_extract_PasteFormatRenderer_2_classLit;
}
;
_.castableTypeMap$ = {};
var INSTANCE_10 = null;
function $clinit_1004(){
  $clinit_1004 = nullMethod;
  DEEP_CLONE_RENDERER = new PasteFormatRenderers$1_0;
  SHALLOW_CLONE_RENDERER = new PasteFormatRenderers$2_0;
}

var DEEP_CLONE_RENDERER, SHALLOW_CLONE_RENDERER;
function PasteFormatRenderers$1_0(){
}

function PasteFormatRenderers$1(){
}

_ = PasteFormatRenderers$1_0.prototype = PasteFormatRenderers$1.prototype = new Object_0;
_.getClass$ = function getClass_649(){
  return Lorg_waveprotocol_wave_client_editor_extract_PasteFormatRenderers$1_2_classLit;
}
;
_.castableTypeMap$ = {213:1};
function PasteFormatRenderers$2_0(){
}

function PasteFormatRenderers$2(){
}

_ = PasteFormatRenderers$2_0.prototype = PasteFormatRenderers$2.prototype = new Object_0;
_.getClass$ = function getClass_650(){
  return Lorg_waveprotocol_wave_client_editor_extract_PasteFormatRenderers$2_2_classLit;
}
;
_.castableTypeMap$ = {213:1};
function $clinit_1008(){
  $clinit_1008 = nullMethod;
  $clinit_103();
  $push_1(toInject, ($clinit_211() , '.C-DH-org-waveprotocol-wave-client-editor-extract-ExtractResources-Css-repaired {\n  border : 1px solid red;\n  background-color : #ffc0c0;\n}\n.C-BH-org-waveprotocol-wave-client-editor-extract-ExtractResources-Css-dead {\n  border : 2px solid red;\n  background-color : #ffc0c0;\n  color : #c00;\n  text-decoration : line-through;\n}\n.C-CH-org-waveprotocol-wave-client-editor-extract-ExtractResources-Css-problem {\n  background-color : #ccc;\n  text-decoration : line-through;\n}\n'));
  flush();
}

function $handle(this$static, error){
  $log_4(($clinit_761() , logger_1).errorLogger, 'handleMissing: ', error);
  $revert(this$static, before_0(this$static.renderedView, error.brokenNode), null);
}

function $handleMissing(this$static, error){
  $log_4(($clinit_761() , logger_1).errorLogger, 'handleMissing: ', error);
  $revert(this$static, before_0(this$static.renderedView, error.brokenNode), null);
}

function $reattachImplChildren_0(this$static, parentNodelet, nodeletBefore, nodeletAfter, first, last){
  var node, nodelet;
  while (true) {
    nodelet = !nodeletBefore?this$static.strippingView.getFirstChild_1(parentNodelet):this$static.strippingView.getNextSibling_0(nodeletBefore);
    if (!nodelet || nodelet == nodeletAfter) {
      break;
    }
    !!$getParentElement(nodelet) && $removeFromParent(nodelet);
  }
  for (node = first; node != last; node = dynamicCast($getNextSibling_3(this$static.renderedView, node), 197)) {
    parentNodelet.insertBefore(node.getImplNodelet(), nodeletAfter);
  }
}

function $revert(this$static, start, end){
  $onRangeRevert(this$static.listener);
  $revertWithoutNotification(this$static, start, end);
}

function $revert_0(this$static, doc, element){
  var end, start;
  start = new Point$El_0(element, doc.getFirstChild_0(element));
  end = new Point$El_0(element, null);
  (element == null?null:element) === maskUndefined(doc.inner_0.getDocumentElement())?$onFullDocumentRevert(this$static.listener):$onRangeRevert(this$static.listener);
  $revertWithoutNotification(this$static, start, end);
}

function $revertInner(this$static, start, end){
  var before, first, last, node, nodeletAfter, nodeletBefore, parentNodelet, renderedContent, node_0;
  renderedContent = this$static.renderedView;
  before = dynamicCast((node_0 = $getNodeAfter(start) , node_0 == null?renderedContent.getLastChild_0(start.container):renderedContent.getPreviousSibling(node_0)), 197);
  nodeletBefore = !before?null:before.getImplNodelet();
  !nodeletBefore?(parentNodelet = dynamicCast($getVisibleNode(renderedContent, dynamicCast(start.container, 197)), 197).getImplNodelet()):(parentNodelet = $getParentElement(nodeletBefore));
  first = dynamicCast($getNodeAfter(start), 197);
  last = !end?null:dynamicCast($getNodeAfter(end), 197);
  for (node = first; node != last; node = dynamicCast($getNextSibling_3(renderedContent, node), 197)) {
    if (!end && node.isConsistent_0()) {
      break;
    }
    node.revertImplementation();
  }
  nodeletAfter = !node?null:node.getImplNodelet();
  $reattachImplChildren_0(this$static, parentNodelet, nodeletBefore, nodeletAfter, first, node);
}

function $revertWithoutNotification(this$static, start, end){
  var $e0, $e1, attempt, t1, t2;
  if (start.container == null) {
    $revert_0(this$static, this$static.renderedView, dynamicCast(this$static.renderedView.inner_0.getDocumentElement(), 196));
    return;
  }
  $clinit_761();
  ++ignoreMutations;
  try {
    $logPlainText(logger_1.errorLogger, 'REPAIRING!! ' + start.container);
    $log_0(logger_1.errorLogger, 'repairing region: ' + dynamicCast(start.container, 196));
    try {
      $revertInner(this$static, start, end);
      return;
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 21)) {
        t1 = $e0;
        $logPlainText(logger_1.errorLogger, 'exception while revertInner: ' + t1);
        for (attempt = dynamicCast(start.container, 197); attempt; attempt = attempt.parent_0) {
          try {
            attempt.revertImplementation();
            return;
          }
           catch ($e1) {
            $e1 = caught_0($e1);
            if (instanceOf($e1, 21)) {
              t2 = $e1;
              $logPlainText(logger_1.errorLogger, 'Exception while revertImplementation: ' + t2);
              if ((attempt == null?null:attempt) === maskUndefined(this$static.persistentView.inner_0.getDocumentElement())) {
                throw t1;
              }
            }
             else 
              throw $e1;
          }
        }
      }
       else 
        throw $e0;
    }
  }
   finally {
    --ignoreMutations;
  }
  $logPlainText(logger_1.traceLogger, 'Revert successful');
}

function $zipRange(this$static, range, userSelection){
  var $e0;
  try {
    return $zipChildrenExcludingFrom(dynamicCast(range.after.container, 196), dynamicCast(range.nodeBefore, 197), dynamicCast($getNodeAfter(range.after), 197), userSelection);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 21)) {
      $revert(this$static, $getPointBefore(range, this$static.persistentView), range.after);
      return true;
    }
     else 
      throw $e0;
  }
}

function Repairer_0(persistentView, renderedView, strippingView, listener){
  $clinit_1008();
  this.persistentView = persistentView;
  this.renderedView = renderedView;
  this.strippingView = strippingView;
  this.listener = listener;
}

function Repairer(){
}

_ = Repairer_0.prototype = Repairer.prototype = new Object_0;
_.getClass$ = function getClass_651(){
  return Lorg_waveprotocol_wave_client_editor_extract_Repairer_2_classLit;
}
;
_.castableTypeMap$ = {};
_.listener = null;
_.persistentView = null;
_.renderedView = null;
_.strippingView = null;
function SubTreeXmlRenderer_0(doc){
  this.doc = doc;
}

function SubTreeXmlRenderer(){
}

_ = SubTreeXmlRenderer_0.prototype = SubTreeXmlRenderer.prototype = new Object_0;
_.getClass$ = function getClass_656(){
  return Lorg_waveprotocol_wave_client_editor_extract_SubTreeXmlRenderer_2_classLit;
}
;
_.castableTypeMap$ = {};
_.doc = null;
function $flush_1(this$static){
  var i, t;
  $aboutToFlush(this$static.sink);
  for (i = 0; i < this$static.numStates; ++i) {
    t = dynamicCast($get_7(this$static.statePool, i), 235);
    if (!t.contentRange) {
      continue;
    }
    $flush_2(t);
  }
  this$static.numStates = 0;
}

function $isBusy(this$static){
  var i, t;
  for (i = 0; i < this$static.numStates; ++i) {
    t = dynamicCast($get_7(this$static.statePool, i), 235);
    if (!t.contentRange) {
      continue;
    }
    return true;
  }
  return false;
}

function TypingExtractor_0(sink, manager, filteredHtmlView, renderedContentView, repairer, selectionSource){
  TypingExtractor_1.call(this, sink, manager, new SchedulerTimerService_1((!instance_7 && (instance_7 = new BrowserBackedScheduler_0 , setDefaultTimerService() , undefined) , instance_7), ($clinit_1200() , CRITICAL)), filteredHtmlView, renderedContentView, repairer, selectionSource);
}

function TypingExtractor_1(sink, manager, service, filteredHtmlView, renderedContentView, repairer, selectionSource){
  this.statePool = new ArrayList_0;
  this.sink = sink;
  this.manager = manager;
  this.selectionSource = selectionSource;
  this.timerService = service;
  this.filteredHtmlView = filteredHtmlView;
  this.renderedContentView = renderedContentView;
  this.repairer = repairer;
  this.flushCmd = new TypingExtractor$1_0(this);
}

function TypingExtractor(){
}

_ = TypingExtractor_0.prototype = TypingExtractor.prototype = new Object_0;
_.getClass$ = function getClass_657(){
  return Lorg_waveprotocol_wave_client_editor_extract_TypingExtractor_2_classLit;
}
;
_.castableTypeMap$ = {};
_.filteredHtmlView = null;
_.flushCmd = null;
_.manager = null;
_.numStates = 0;
_.renderedContentView = null;
_.repairer = null;
_.searchingForAdjacentArea = false;
_.selectionSource = null;
_.sink = null;
_.timerService = null;
function TypingExtractor$1_0(this$0){
  this.this$0 = this$0;
}

function TypingExtractor$1(){
}

_ = TypingExtractor$1_0.prototype = TypingExtractor$1.prototype = new Object_0;
_.execute_0 = function execute_34(){
  $flush_1(this.this$0);
}
;
_.getClass$ = function getClass_658(){
  return Lorg_waveprotocol_wave_client_editor_extract_TypingExtractor$1_2_classLit;
}
;
_.castableTypeMap$ = {252:1, 253:1};
_.this$0 = null;
function $clear_17(this$static){
  this$static.contentRange = null;
  this$static.firstWrapper = null;
  this$static.lastWrapper = null;
  this$static.htmlRange = null;
  this$static.minpre = 0;
  this$static.lastTextNode = null;
}

function $flush_2(this$static){
  var $e0, deleteEndIndex, deleteSize, deleting, e, endOffset, insertEndIndex, inserting, minpost, minpostLeft, newValue, originalValue, selectionEnd, selectionStart, start, startIndex, startNode, filteredHtml, fromIncl, toExcl, range, range_0;
  try {
    if (!this$static.contentRange) {
      return;
    }
    newValue = (filteredHtml = this$static.this$0.filteredHtmlView , fromIncl = dynamicCastJso($getStartNode(this$static.htmlRange, filteredHtml)) , toExcl = dynamicCastJso($getNodeAfter(this$static.htmlRange.after)) , sumTextNodes(fromIncl, toExcl, filteredHtml));
    if (!this$static.firstWrapper) {
      newValue.length > 0 && $typingReplace(this$static.this$0.sink, this$static.contentRange.after, 0, newValue, this$static.contentRange);
    }
     else {
      originalValue = this$static.firstWrapper.data_0 + (this$static.firstWrapper != this$static.lastWrapper?this$static.lastWrapper.data_0:'');
      selectionStart = (range = $getOrderedHtmlSelection(this$static.this$0.selectionSource.this$0.htmlSelectionHelper) , !range?null:range.first);
      selectionEnd = (range_0 = $getOrderedHtmlSelection(this$static.this$0.selectionSource.this$0.htmlSelectionHelper) , !range_0?null:range_0.second);
      selectionStart?$updateMinPre(this$static, selectionStart):(this$static.minpre = 0);
      if (selectionEnd) {
        endOffset = $getAbsoluteOffset(this$static, selectionEnd);
        minpost = endOffset == -1?0:newValue.length - endOffset;
      }
       else {
        minpost = 0;
      }
      this$static.minpre < 0 && (this$static.minpre = 0);
      minpost < 0 && (minpost = 0);
      deleteEndIndex = originalValue.length - minpost;
      insertEndIndex = newValue.length - minpost;
      startIndex = min_1(this$static.minpre, deleteEndIndex);
      while (startIndex > 0 && originalValue.charCodeAt(startIndex - 1) != newValue.charCodeAt(startIndex - 1)) {
        --startIndex;
      }
      while (startIndex < deleteEndIndex && startIndex < insertEndIndex && originalValue.charCodeAt(startIndex) == newValue.charCodeAt(startIndex)) {
        ++startIndex;
      }
      minpostLeft = minpost;
      while (minpostLeft > 0 && originalValue.charCodeAt(deleteEndIndex) != newValue.charCodeAt(insertEndIndex)) {
        ++deleteEndIndex;
        ++insertEndIndex;
        --minpostLeft;
      }
      while (startIndex < deleteEndIndex && startIndex < insertEndIndex && originalValue.charCodeAt(deleteEndIndex - 1) == newValue.charCodeAt(insertEndIndex - 1)) {
        --deleteEndIndex;
        --insertEndIndex;
      }
      deleting = startIndex < deleteEndIndex;
      inserting = startIndex < insertEndIndex;
      deleteSize = deleteEndIndex - startIndex;
      startNode = this$static.firstWrapper;
      if (this$static.firstWrapper.data_0.length < startIndex) {
        startIndex -= this$static.firstWrapper.data_0.length;
        startNode = this$static.lastWrapper;
      }
      start = new Point$Tx_0(startNode, startIndex);
      (deleting || inserting) && $typingReplace(this$static.this$0.sink, start, deleteSize, newValue.substr(startIndex, insertEndIndex - startIndex), this$static.contentRange);
    }
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 21)) {
      e = $e0;
      $log_3(($clinit_761() , logger_1).errorLogger, e);
      !this$static.contentRange?$revert_0(this$static.this$0.repairer, this$static.this$0.renderedContentView, dynamicCast(this$static.this$0.renderedContentView.inner_0.getDocumentElement(), 196)):$revert(this$static.this$0.repairer, $getPointBefore(this$static.contentRange, this$static.this$0.renderedContentView), this$static.contentRange.after);
      $clear_17(this$static);
    }
     else 
      throw $e0;
  }
   finally {
    $clear_17(this$static);
  }
}

function $getAbsoluteOffset(this$static, point){
  var filteredHtml, toFind;
  if ($partOfMutatingRange(this$static, dynamicCastJso(point.container))) {
    toFind = dynamicCastJso(point.container);
    filteredHtml = this$static.this$0.filteredHtmlView;
    return getOffset(toFind, dynamicCastJso($getStartNode(this$static.htmlRange, filteredHtml)), dynamicCastJso($getNodeAfter(this$static.htmlRange.after)), filteredHtml) + $getTextOffset(point);
  }
  return -1;
}

function $partOfMutatingRange(this$static, node){
  return $contains_7(this$static.htmlRange, this$static.this$0.filteredHtmlView, node);
}

function $updateMinPre(this$static, selectionStart){
  var newVal;
  if (!selectionStart) {
    this$static.minpre = 0;
    return;
  }
  newVal = $getAbsoluteOffset(this$static, selectionStart);
  newVal == -1 && (newVal = 0);
  this$static.minpre = min_1(this$static.minpre, newVal);
}

function $clinit_1021(){
  $clinit_1021 = nullMethod;
  WIDGET = new Property$ImmutableProperty_0('widget');
  LOGICAL_PANEL = new Property$ImmutableProperty_0('parent');
}

function $disassociateWidget(element){
  var old;
  old = dynamicCast(element.transientData.get_0(WIDGET.id_0), 55);
  if (old) {
    $removeFromParent(old.element);
    element.transientData.put_1(WIDGET.id_0, null);
  }
}

function $maybeLogicalDetach(element){
  var p, w;
  w = dynamicCast(element.transientData.get_0(WIDGET.id_0), 55);
  p = dynamicCast(element.transientData.get_0(LOGICAL_PANEL.id_0), 236);
  !!p && !!w && !!w.parent_0 && p.doOrphan(w);
}

function $setLogicalPanel(element, parent_0){
  var existingParent, p_0, w_0;
  existingParent = dynamicCast(element.transientData.get_0(LOGICAL_PANEL.id_0), 236);
  if (!existingParent && !parent_0) {
    return;
  }
  checkState_2(!existingParent || !parent_0, 'setLogicalPanel called for an element that already has it');
  if ($isContentAttached(element)) {
    if (!parent_0) {
      $maybeLogicalDetach(element);
      element.transientData.put_1(LOGICAL_PANEL.id_0, null);
    }
     else {
      element.transientData.put_1(LOGICAL_PANEL.id_0, parent_0);
      w_0 = dynamicCast(element.transientData.get_0(WIDGET.id_0), 55);
      p_0 = dynamicCast(element.transientData.get_0(LOGICAL_PANEL.id_0), 236);
      !!p_0 && !!w_0 && p_0.doAdopt(w_0);
    }
  }
}

function GwtRenderingMutationHandler(){
}

_ = GwtRenderingMutationHandler.prototype = new RenderingMutationHandler;
_.createDomImpl = function createDomImpl_12(element){
  var attachNodelet, implNodelet, w, widget;
  w = ($clinit_1086() , $log_0(LOG_3.traceLogger, 'GadgetRenderer createGwtWidget') , widget = createGadgetWidget(element, this.waveletName, this.blip, this.supplement, this.profileManager, CURRENT_LOCALE, this.loginName) , element.transientData.put_1(GADGET_WIDGET.id_0, widget) , widget.ui);
  if (this.flow == ($clinit_1022() , USE_WIDGET)) {
    checkState_2(!!w, 'Cannot have null widget with USE_WIDGET');
    implNodelet = w.element;
    attachNodelet = null;
  }
   else {
    implNodelet = $createContainer();
    attachNodelet = implNodelet;
  }
  implNodelet.style['-webkit-user-modify'] = 'read-only';
  !!w && (element.transientData.put_1(WIDGET.id_0, w) , !!attachNodelet && attachNodelet.appendChild(w.element) , $setContainerNodelet(element, null) , undefined);
  return implNodelet;
}
;
_.getClass$ = function getClass_660(){
  return Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler_2_classLit;
}
;
_.onActivationStart = function onActivationStart_3(element){
  $createWidget(dynamicCast(element.transientData.get_0(GADGET_WIDGET.id_0), 214));
  fanoutChildren(element);
  $onDescendantsMutated_0(dynamicCast(element.transientData.get_0(GADGET_WIDGET.id_0), 214));
}
;
_.onDeactivated_0 = function onDeactivated_1(element){
  var nodelet;
  nodelet = element.implNodelet;
  this.flow == ($clinit_1022() , USE_WIDGET)?null:nodelet;
  $maybeLogicalDetach(element);
  $disassociateWidget(element);
  $setLogicalPanel(element, null);
}
;
_.castableTypeMap$ = {212:1, 215:1, 217:1};
_.flow = null;
var LOGICAL_PANEL, WIDGET;
function $clinit_1022(){
  $clinit_1022 = nullMethod;
  INLINE_0 = new GwtRenderingMutationHandler$Flow$1_0;
  BLOCK_0 = new GwtRenderingMutationHandler$Flow$2_0;
  USE_WIDGET = new GwtRenderingMutationHandler$Flow$3_0;
  $VALUES_32 = initValues(_3Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow_2_classLit, {9:1, 68:1, 170:1}, 109, [INLINE_0, BLOCK_0, USE_WIDGET]);
}

function valueOf_39(name_0){
  $clinit_1022();
  return valueOf_0(($clinit_1026() , $MAP_32), name_0);
}

function values_33(){
  $clinit_1022();
  return $VALUES_32;
}

function GwtRenderingMutationHandler$Flow(){
}

_ = GwtRenderingMutationHandler$Flow.prototype = new Enum;
_.getClass$ = function getClass_661(){
  return Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 109:1};
var $VALUES_32, BLOCK_0, INLINE_0, USE_WIDGET;
function GwtRenderingMutationHandler$Flow$1_0(){
  this.name_1 = 'INLINE';
  this.ordinal = 0;
}

function GwtRenderingMutationHandler$Flow$1(){
}

_ = GwtRenderingMutationHandler$Flow$1_0.prototype = GwtRenderingMutationHandler$Flow$1.prototype = new GwtRenderingMutationHandler$Flow;
_.getClass$ = function getClass_662(){
  return Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow$1_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 109:1};
function GwtRenderingMutationHandler$Flow$2_0(){
  this.name_1 = 'BLOCK';
  this.ordinal = 1;
}

function GwtRenderingMutationHandler$Flow$2(){
}

_ = GwtRenderingMutationHandler$Flow$2_0.prototype = GwtRenderingMutationHandler$Flow$2.prototype = new GwtRenderingMutationHandler$Flow;
_.getClass$ = function getClass_663(){
  return Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow$2_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 109:1};
function $createContainer(){
  throw new AssertionError_1('No container for Replace');
}

function GwtRenderingMutationHandler$Flow$3_0(){
  this.name_1 = 'USE_WIDGET';
  this.ordinal = 2;
}

function GwtRenderingMutationHandler$Flow$3(){
}

_ = GwtRenderingMutationHandler$Flow$3_0.prototype = GwtRenderingMutationHandler$Flow$3.prototype = new GwtRenderingMutationHandler$Flow;
_.getClass$ = function getClass_664(){
  return Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow$3_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 109:1};
function $clinit_1026(){
  $clinit_1026 = nullMethod;
  $MAP_32 = createValueOfMap(($clinit_1022() , $VALUES_32));
}

var $MAP_32;
function $clinit_1028(){
  $clinit_1028 = nullMethod;
  $clinit_103();
  $push_1(toInject, ($clinit_211() , '.C-FH-org-waveprotocol-wave-client-editor-impl-DiffManagerResources-Css-insert {\n  background-color : #ff0;\n}\n.C-EH-org-waveprotocol-wave-client-editor-impl-DiffManagerResources-Css-delete {\n  background-color : #ffd0d0;\n  text-decoration : line-through;\n}\n'));
  flush();
  $clinit_1033();
  ++markerIndex;
}

function styleElement(element, type){
  $clinit_1028();
  switch (type.ordinal) {
    case 0:
      $addClassName(element, 'C-FH-org-waveprotocol-wave-client-editor-impl-DiffManagerResources-Css-insert');
      break;
    case 1:
      $addClassName(element, 'C-EH-org-waveprotocol-wave-client-editor-impl-DiffManagerResources-Css-delete');
      $clinit_1033();
      element[TRANSPARENCY] = ($clinit_2121() , DEEP);
      element.setAttribute('contentEditable', 'false');
  }
}

function $clinit_1029(){
  $clinit_1029 = nullMethod;
  INSERT_0 = new DiffManager$DiffType_0('INSERT', 0);
  DELETE_1 = new DiffManager$DiffType_0('DELETE', 1);
  $VALUES_33 = initValues(_3Lorg_waveprotocol_wave_client_editor_impl_DiffManager$DiffType_2_classLit, {9:1, 68:1, 170:1}, 110, [INSERT_0, DELETE_1]);
}

function DiffManager$DiffType_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_40(name_0){
  $clinit_1029();
  return valueOf_0(($clinit_1030() , $MAP_33), name_0);
}

function values_34(){
  $clinit_1029();
  return $VALUES_33;
}

function DiffManager$DiffType(){
}

_ = DiffManager$DiffType_0.prototype = DiffManager$DiffType.prototype = new Enum;
_.getClass$ = function getClass_665(){
  return Lorg_waveprotocol_wave_client_editor_impl_DiffManager$DiffType_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 110:1};
var $VALUES_33, DELETE_1, INSERT_0;
function $clinit_1030(){
  $clinit_1030 = nullMethod;
  $MAP_33 = createValueOfMap(($clinit_1029() , $VALUES_33));
}

var $MAP_33;
function $clinit_1032(){
  $clinit_1032 = nullMethod;
  new HtmlViewImpl_0(null);
}

function $asElement_4(node){
  return node.nodeType == 1?node:null;
}

function $asText_3(node){
  return node.nodeType == 3?node:null;
}

function $getAttribute_4(element, name_0){
  return $equals_3(name_0, 'class')?element.className:element.getAttribute(name_0) || '';
}

function $getParentElement_5(node){
  var parent_0;
  return parent_0 = dynamicCastJso(node).parentNode , (!parent_0 || parent_0.nodeType != 1) && (parent_0 = null) , parent_0;
}

function $isSameNode_2(node, other){
  return node == other || !!node && node == other;
}

function HtmlViewImpl_0(documentElement){
  $clinit_1032();
  this.documentElement_0 = documentElement;
}

function HtmlViewImpl(){
}

_ = HtmlViewImpl_0.prototype = HtmlViewImpl.prototype = new Object_0;
_.asElement_0 = function asElement_6(node){
  return $asElement_4(dynamicCastJso(node));
}
;
_.asText_0 = function asText_6(node){
  return $asText_3(dynamicCastJso(node));
}
;
_.getAttribute_0 = function getAttribute_3(element, name_0){
  return $getAttribute_4(dynamicCastJso(element), name_0);
}
;
_.getAttributes = function getAttributes_3(element){
  return dynamicCastJso(element) , $clinit_480() , $clinit_480() , EMPTY_MAP;
}
;
_.getClass$ = function getClass_666(){
  return Lorg_waveprotocol_wave_client_editor_impl_HtmlViewImpl_2_classLit;
}
;
_.getData = function getData_3(textNode){
  return dynamicCastJso(textNode).data;
}
;
_.getDocumentElement = function getDocumentElement_5(){
  return this.documentElement_0;
}
;
_.getFirstChild_1 = function getFirstChild_6(node){
  return node.firstChild;
}
;
_.getFirstChild_0 = function getFirstChild_7(node){
  return this.getFirstChild_1(dynamicCastJso(node));
}
;
_.getLastChild_1 = function getLastChild_6(node){
  return node.lastChild;
}
;
_.getLastChild_0 = function getLastChild_7(node){
  return this.getLastChild_1(dynamicCastJso(node));
}
;
_.getLength = function getLength_3(textNode){
  return dynamicCastJso(textNode).length;
}
;
_.getNextSibling_0 = function getNextSibling_4(node){
  return node.nextSibling;
}
;
_.getNextSibling = function getNextSibling_5(node){
  return this.getNextSibling_0(dynamicCastJso(node));
}
;
_.getNodeType_0 = function getNodeType_5(node){
  return dynamicCastJso(node).nodeType;
}
;
_.getParentElement = function getParentElement_4(node){
  var parent_0;
  return parent_0 = dynamicCastJso(node).parentNode , (!parent_0 || parent_0.nodeType != 1) && (parent_0 = null) , parent_0;
}
;
_.getPreviousSibling_0 = function getPreviousSibling_4(node){
  return node.previousSibling;
}
;
_.getPreviousSibling = function getPreviousSibling_5(node){
  return this.getPreviousSibling_0(dynamicCastJso(node));
}
;
_.getTagName = function getTagName_3(element){
  return dynamicCastJso(element).tagName;
}
;
_.isSameNode = function isSameNode_3(node, other){
  return $isSameNode_2(dynamicCastJso(node), dynamicCastJso(other));
}
;
_.castableTypeMap$ = {19:1, 20:1};
_.documentElement_0 = null;
function $clinit_1033(){
  $clinit_1033 = nullMethod;
  BACKREF_NAME = (++markerIndex , '_x' + markerIndex);
  TRANSPARENCY = (++markerIndex , '_x' + markerIndex);
  TRANSPARENT_BACKREF = (++markerIndex , '_x' + markerIndex);
  MAY_CONTAIN_SELECTION = (++markerIndex , '_x' + markerIndex);
}

function $elementNodeToWrapperPoint(this$static, container, nodeAfter){
  var filteredHtml;
  filteredHtml = this$static.filteredHtmlView;
  if (maskUndefined($getVisibleNode(filteredHtml, nodeAfter)) !== (nodeAfter == null?null:nodeAfter)) {
    nodeAfter = dynamicCastJso($getNextSibling_3(filteredHtml, nodeAfter));
    !!nodeAfter && (container = $getParentElement(nodeAfter));
  }
  return new Point$El_0($findElementWrapper_0(this$static, container), $findNodeWrapper(this$static, nodeAfter));
}

function $findElementWrapper_0(this$static, element){
  var filteredHtml, visibleElement;
  if (!element) {
    return null;
  }
  filteredHtml = this$static.filteredHtmlView;
  visibleElement = dynamicCastJso($getVisibleNode(filteredHtml, element));
  return visibleElement?$nullifyIfWrongDocument(this$static, !visibleElement?null:dynamicCast(visibleElement[BACKREF_NAME] || null, 196)):null;
}

function $findNodeWrapper(this$static, node){
  if (!node) {
    return null;
  }
  return node.nodeType == 3?$findTextWrapper(this$static, node, false):$findElementWrapper_0(this$static, node);
}

function $findTextWrapper(this$static, target, attemptRepair){
  var $e0, current, filteredHtml, maybeText, nextNode, nextNodelet, nodeletBeforeTextNodes, parentElement, parentNodelet, possibleOwner, possibleOwnerNode, renderedContent, wrapperBeforeTextNodes, find_2, find_4, nodelet, find_5, nodelet_0;
  if (!target) {
    return null;
  }
  renderedContent = this$static.renderedContentView;
  filteredHtml = this$static.filteredHtmlView;
  current = target;
  for (nodeletBeforeTextNodes = dynamicCastJso($getPreviousSibling_3(filteredHtml, target)); nodeletBeforeTextNodes; nodeletBeforeTextNodes = dynamicCastJso($getPreviousSibling_3(filteredHtml, nodeletBeforeTextNodes))) {
    maybeText = dynamicCastJso(filteredHtml.inner_0.asText_0(nodeletBeforeTextNodes));
    if (!maybeText) {
      break;
    }
    current = maybeText;
  }
  parentNodelet = dynamicCastJso($getParentElement_3(filteredHtml, target));
  if (!parentNodelet) {
    throw new RuntimeException_1('Somehow we are asking for the wrapper of something not in the editor??');
  }
  parentElement = !parentNodelet?null:dynamicCast(parentNodelet[BACKREF_NAME] || null, 196);
  if (!nodeletBeforeTextNodes) {
    possibleOwnerNode = dynamicCast((find_2 = renderedContent.inner_0.getFirstChild_0(parentElement) , $getNextVisibleNodeDepthFirst(renderedContent, find_2, parentElement)), 197);
  }
   else {
    wrapperBeforeTextNodes = ($clinit_1033() , !nodeletBeforeTextNodes?null:dynamicCast(nodeletBeforeTextNodes[BACKREF_NAME] || null, 196));
    possibleOwnerNode = dynamicCast($getNextSibling_3(renderedContent, wrapperBeforeTextNodes), 197);
  }
  while (true) {
    if (!possibleOwnerNode) {
      throw new InconsistencyException$HtmlInserted_0(new Point$El_0(parentElement, null), new Point$El_0(parentNodelet, (find_4 = filteredHtml.inner_0.getFirstChild_0(parentNodelet) , $getNextVisibleNodeDepthFirst(filteredHtml, find_4, parentNodelet))));
    }
    try {
      possibleOwner = dynamicCast(possibleOwnerNode, 225);
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 237)) {
        if (nodelet = possibleOwnerNode.getImplNodelet() , !!nodelet && !!$getParentElement(nodelet)) {
          throw new InconsistencyException$HtmlInserted_0(new Point$El_0(parentElement, possibleOwnerNode), new Point$El_0(parentNodelet, !nodeletBeforeTextNodes?(find_5 = filteredHtml.inner_0.getFirstChild_0(parentNodelet) , $getNextVisibleNodeDepthFirst(filteredHtml, find_5, parentNodelet)):$getNextSibling_3(filteredHtml, nodeletBeforeTextNodes)));
        }
         else {
          throw new InconsistencyException$HtmlMissing_0(possibleOwnerNode, parentNodelet);
        }
      }
       else 
        throw $e0;
    }
    nextNode = dynamicCast($getNextSibling_3(renderedContent, possibleOwner), 197);
    if (!!nextNode && !(nodelet_0 = nextNode.getImplNodelet() , !!nodelet_0 && !!$getParentElement(nodelet_0))) {
      throw new InconsistencyException$HtmlMissing_0(nextNode, parentNodelet);
    }
    if (current != possibleOwner.implNodelet) {
      if (attemptRepair) {
        possibleOwner.implNodelet = current;
        return !!possibleOwner && possibleOwner.context.this$0.renderingConcerns.this$0.renderedContentView == this$static.renderedContentView?possibleOwner:null;
      }
       else {
        throw new InconsistencyException$HtmlInserted_0(new Point$El_0(parentElement, possibleOwner), new Point$El_0(parentNodelet, current));
      }
    }
    nextNodelet = !nextNode?null:nextNode.getImplNodelet();
    while (current != nextNodelet && !!current) {
      if (current == target) {
        return !!possibleOwner && possibleOwner.context.this$0.renderingConcerns.this$0.renderedContentView == this$static.renderedContentView?possibleOwner:null;
      }
      current = dynamicCastJso($getNextSibling_3(filteredHtml, current));
    }
    possibleOwnerNode = nextNode;
  }
}

function $nodeletPointToWrapperPoint(this$static, nodelet){
  return nodelet.offset >= 0?$textNodeToWrapperPoint(this$static, dynamicCastJso(nodelet.container), $getTextOffset(nodelet)):$elementNodeToWrapperPoint(this$static, dynamicCastJso(nodelet.container), dynamicCastJso($getNodeAfter(nodelet)));
}

function $nullifyIfWrongDocument(this$static, node){
  return !!node && node.context.this$0.renderingConcerns.this$0.renderedContentView == this$static.renderedContentView?node:null;
}

function $textNodeToWrapperPoint(this$static, text, offset){
  var e, textNode;
  if (dynamicCast($getParentElement(text)[TRANSPARENCY] || null, 154) == ($clinit_2121() , DEEP)) {
    e = $getParentElement(text);
    return $elementNodeToWrapperPoint(this$static, $getParentElement(e), e);
  }
   else {
    textNode = $findTextWrapper(this$static, text, true);
    return new Point$Tx_0(textNode, offset + $getOffset(textNode, text));
  }
}

function $wrapperElementPointToNodeletPoint(this$static, point){
  var container, el, lastWrappedNodelet, nodeletAfter, parentNode, visibleNode;
  if ($getNodeAfter(point) == null) {
    container = dynamicCast(point.container, 196).containerNodelet;
    if (!container) {
      return null;
    }
    lastWrappedNodelet = container.lastChild;
    while (!!lastWrappedNodelet && lastWrappedNodelet.nodeType != 3 && !($clinit_1033() , !lastWrappedNodelet?null:dynamicCast(lastWrappedNodelet[BACKREF_NAME] || null, 196))) {
      lastWrappedNodelet = lastWrappedNodelet.previousSibling;
    }
    nodeletAfter = !lastWrappedNodelet?container.firstChild:lastWrappedNodelet.nextSibling;
  }
   else {
    nodeletAfter = $getImplNodeletRightwards(dynamicCast($getNodeAfter(point), 197));
  }
  if (!nodeletAfter) {
    visibleNode = dynamicCast($getVisibleNode(this$static.renderedContentView, dynamicCast(point.container, 197)), 197).asElement();
    el = visibleNode.containerNodelet;
    return el?new Point$El_0(el, null):null;
  }
   else {
    parentNode = nodeletAfter.parentNode;
    return parentNode?new Point$El_0(parentNode, nodeletAfter):null;
  }
}

function $wrapperPointToNodeletPoint(this$static, point){
  var output;
  if (point.offset >= 0) {
    output = $wrapperTextPointToHtmlPoint(this$static, point);
    return new Point$Tx_0(output.node, output.offset);
  }
   else {
    return $wrapperElementPointToNodeletPoint(this$static, point);
  }
}

function $wrapperTextPointToHtmlPoint(this$static, point){
  var $e0, attempt, e, output;
  output = new HtmlPoint_0;
  for (attempt = 1; attempt <= 2; ++attempt) {
    try {
      $findNodeletWithOffset(dynamicCast(point.container, 225), $getTextOffset(point), output);
      break;
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 205)) {
        e = $e0;
        $handle(this$static.repairer, e);
      }
       else 
        throw $e0;
    }
  }
  if (!output.node) {
    throw new EditorRuntimeException_0("Don't know what to do with this - offset too big? point: " + point);
  }
  return output;
}

function NodeManager_0(filteredHtmlView, renderedContentView, repairer){
  $clinit_1033();
  this.filteredHtmlView = filteredHtmlView;
  this.renderedContentView = renderedContentView;
  this.repairer = repairer;
}

function getBackReference(nodelet){
  $clinit_1033();
  return !nodelet?null:dynamicCast(nodelet[BACKREF_NAME] || null, 196);
}

function NodeManager(){
}

_ = NodeManager_0.prototype = NodeManager.prototype = new Object_0;
_.getClass$ = function getClass_667(){
  return Lorg_waveprotocol_wave_client_editor_impl_NodeManager_2_classLit;
}
;
_.castableTypeMap$ = {};
_.filteredHtmlView = null;
_.renderedContentView = null;
_.repairer = null;
var BACKREF_NAME, MAY_CONTAIN_SELECTION, TRANSPARENCY, TRANSPARENT_BACKREF, markerIndex = 0;
function $maybeStrip(node){
  var element, n;
  if (!node || node.nodeType == 3)
    return false;
  element = node;
  $clinit_1033();
  if (!(!!element && (element[BACKREF_NAME] || null) != null)) {
    while (n = element.firstChild) {
      element.parentNode.insertBefore(n, element);
    }
    $removeFromParent(element);
    return true;
  }
  return false;
}

function StrippingHtmlView_0(documentElement){
  $clinit_1032();
  this.documentElement_0 = documentElement;
}

function StrippingHtmlView(){
}

_ = StrippingHtmlView_0.prototype = StrippingHtmlView.prototype = new HtmlViewImpl;
_.getClass$ = function getClass_668(){
  return Lorg_waveprotocol_wave_client_editor_impl_StrippingHtmlView_2_classLit;
}
;
_.getFirstChild_1 = function getFirstChild_8(node){
  var n;
  while ($maybeStrip(n = node.firstChild)) {
  }
  return n;
}
;
_.getLastChild_1 = function getLastChild_8(node){
  var n;
  while ($maybeStrip(n = node.lastChild)) {
  }
  return n;
}
;
_.getNextSibling_0 = function getNextSibling_6(node){
  var n;
  while ($maybeStrip(n = node.nextSibling)) {
  }
  return n;
}
;
_.getPreviousSibling_0 = function getPreviousSibling_6(node){
  var n;
  while ($maybeStrip(n = node.previousSibling)) {
  }
  return n;
}
;
_.castableTypeMap$ = {19:1, 20:1};
function EditorOperationSequencer_0(sink){
  this.sink = sink;
}

function EditorOperationSequencer(){
}

_ = EditorOperationSequencer_0.prototype = EditorOperationSequencer.prototype = new Object_0;
_.begin = function begin_4(){
}
;
_.consume_0 = function consume_6(operation){
  $consumeAndReturnInvertible_0(this.sink, operation);
}
;
_.end_0 = function end_7(){
}
;
_.getClass$ = function getClass_670(){
  return Lorg_waveprotocol_wave_client_editor_operation_EditorOperationSequencer_2_classLit;
}
;
_.castableTypeMap$ = {};
_.sink = null;
function CaretMovementHelperWebkitImpl_0(nodeManager){
  this.nodeManager = nodeManager;
}

function CaretMovementHelperWebkitImpl(){
}

_ = CaretMovementHelperWebkitImpl_0.prototype = CaretMovementHelperWebkitImpl.prototype = new Object_0;
_.getClass$ = function getClass_671(){
  return Lorg_waveprotocol_wave_client_editor_selection_content_CaretMovementHelperWebkitImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.nodeManager = null;
function $getSkipLevel_1(this$static, node){
  if ($isRendered(node)) {
    if (this$static.inner_0.asText_0(node) != null) {
      return $clinit_2121() , DEEP;
    }
    return isKnownInvalidTopContainerForCursor(node)?($clinit_2121() , SHALLOW):($clinit_2121() , NONE_5);
  }
   else {
    return $clinit_2121() , DEEP;
  }
}

function PassiveSelectionHelper$ValidSelectionContainerView_0(rawView){
  checkNotNull_1(rawView, 'IdentityView (or subclass): Inner document may not be null!');
  this.inner_0 = rawView;
}

function PassiveSelectionHelper$ValidSelectionContainerView(){
}

_ = PassiveSelectionHelper$ValidSelectionContainerView_0.prototype = PassiveSelectionHelper$ValidSelectionContainerView.prototype = new FilteredView;
_.getClass$ = function getClass_672(){
  return Lorg_waveprotocol_wave_client_editor_selection_content_PassiveSelectionHelper$ValidSelectionContainerView_2_classLit;
}
;
_.getSkipLevel = function getSkipLevel_2(node){
  return $getSkipLevel_1(this, dynamicCast(node, 197));
}
;
_.castableTypeMap$ = {19:1, 20:1, 155:1, 156:1};
function $clinit_1040(){
  $clinit_1040 = nullMethod;
  NOP_IMPL_0 = new SelectionHelper$1_0;
}

var NOP_IMPL_0;
function SelectionHelper$1_0(){
}

function SelectionHelper$1(){
}

_ = SelectionHelper$1_0.prototype = SelectionHelper$1.prototype = new Object_0;
_.getClass$ = function getClass_673(){
  return Lorg_waveprotocol_wave_client_editor_selection_content_SelectionHelper$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function filterNonContentSelection(htmlSelection){
  var el, htmlFocus, parent_0;
  if (!htmlSelection) {
    return null;
  }
  htmlFocus = htmlSelection.focus_0;
  htmlFocus.offset >= 0?(el = (parent_0 = dynamicCastJso(htmlFocus.container).parentNode , (!parent_0 || parent_0.nodeType != 1) && (parent_0 = null) , parent_0)):(el = dynamicCastJso(htmlFocus.container));
  while ($clinit_1033() , !(!!el && (el[BACKREF_NAME] || null) != null)) {
    if (dynamicCast(el[TRANSPARENCY] || null, 154) == ($clinit_2121() , DEEP) || !!el[$clinit_790() , COMPLEX_IMPLEMENTATION_MARKER]) {
      if (!el[MAY_CONTAIN_SELECTION]) {
        htmlSelection = null;
        break;
      }
    }
    el = $getParentElement(el);
  }
  return htmlSelection;
}

function $clinit_1043(){
  $clinit_1043 = nullMethod;
  UNSKIPPED_TRANSIENT_CONTAINERS = ($clinit_2309() , defaultCollectionFactory.createStringSet());
  SHALLOW_SKIPPED_TRANSIENT_CONTAINERS = defaultCollectionFactory.createStringSet();
  SHALLOW_SKIPPED_PERSISTENT_CONTAINERS = defaultCollectionFactory.createStringSet();
  DEEP_SKIPPED_PERSISTENT_CONTAINERS = defaultCollectionFactory.createStringSet();
}

function $resolveSkip(node, skipLevels){
  var elt, isRendered, tagName, tagName_0;
  elt = node.asElement();
  if (!elt) {
    return $clinit_2121() , NONE_5;
  }
  isRendered = skipLevels[1] == ($clinit_2121() , NONE_5);
  switch (skipLevels[0].ordinal) {
    case 0:
      return isRendered?NONE_5:(tagName = elt.tagName_0 , SHALLOW_SKIPPED_PERSISTENT_CONTAINERS.contains_0(tagName)?SHALLOW:DEEP_SKIPPED_PERSISTENT_CONTAINERS.contains_0(tagName)?DEEP:NONE_5);
    case 1:
    case 2:
      return tagName_0 = elt.tagName_0 , UNSKIPPED_TRANSIENT_CONTAINERS.contains_0(tagName_0)?NONE_5:SHALLOW_SKIPPED_TRANSIENT_CONTAINERS.contains_0(tagName_0)?SHALLOW:DEEP;
  }
  return INVALID;
}

function registerTagForSelections(tag, isPersistent, skipLevel){
  $clinit_1043();
  switch (skipLevel.ordinal) {
    case 0:
      isPersistent || UNSKIPPED_TRANSIENT_CONTAINERS.add_3(tag);
      break;
    case 1:
      isPersistent?SHALLOW_SKIPPED_PERSISTENT_CONTAINERS.add_3(tag):SHALLOW_SKIPPED_TRANSIENT_CONTAINERS.add_3(tag);
      break;
    case 2:
      isPersistent && DEEP_SKIPPED_PERSISTENT_CONTAINERS.add_3(tag);
  }
}

var DEEP_SKIPPED_PERSISTENT_CONTAINERS, SHALLOW_SKIPPED_PERSISTENT_CONTAINERS, SHALLOW_SKIPPED_TRANSIENT_CONTAINERS, UNSKIPPED_TRANSIENT_CONTAINERS;
function $clinit_1046(){
  $clinit_1046 = nullMethod;
  LOG_2 = new BufferedLogger_0;
  new SelectionImplW3C_0;
  $clinit_1049();
  transientMutationListener = new NativeSelectionUtil$NoOpMutationListener_0;
}

function get_21(){
  $clinit_1046();
  if (caching) {
    !cache_1 && (cache_1 = $get_16());
    return cache_1;
  }
   else {
    return $get_16();
  }
}

function setCaret(caret){
  $clinit_1046();
  cache_1 = null;
  cache_1 = null;
  $set_8(caret, caret);
}

function setTransientMutationListener(mutationListener){
  $clinit_1046();
  checkNotNull_1(mutationListener, 'null mutationListener');
  transientMutationListener = mutationListener;
}

var LOG_2, cache_1 = null, caching = false, transientMutationListener;
function NativeSelectionUtil$NoOpMutationListener_0(){
}

function NativeSelectionUtil$NoOpMutationListener(){
}

_ = NativeSelectionUtil$NoOpMutationListener_0.prototype = NativeSelectionUtil$NoOpMutationListener.prototype = new Object_0;
_.getClass$ = function getClass_674(){
  return Lorg_waveprotocol_wave_client_editor_selection_html_NativeSelectionUtil$NoOpMutationListener_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_1049(){
  $clinit_1049 = nullMethod;
  SPAN = $doc.createElement('span');
}

var SPAN;
function $clinit_1050(){
  $clinit_1050 = nullMethod;
  $clinit_1046();
}

function SelectionImpl(){
}

_ = SelectionImpl.prototype = new Object_0;
_.getClass$ = function getClass_675(){
  return Lorg_waveprotocol_wave_client_editor_selection_html_SelectionImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_1051(){
  $clinit_1051 = nullMethod;
  $clinit_1050();
  logger_5 = ($clinit_1046() , LOG_2);
}

function $get_16(){
  var anchorNode, focusNode, selection;
  selection = getSelectionGuarded();
  if (!selection) {
    return null;
  }
  anchorNode = selection.anchorNode;
  focusNode = selection.focusNode;
  return !focusNode?null:constructRange(anchorNode, selection.anchorOffset, focusNode, selection.focusOffset);
}

function $getSelectionRange_0(){
  var selection;
  selection = getSelectionGuarded();
  return !!selection && selection.rangeCount > 0?selection.getRangeAt(0):null;
}

function $set_8(anchor, focus_0){
  var anchorNode, anchorOffset, focusNode, focusNodeAfter, focusOffset, range, parent_0;
  range = $doc.createRange();
  anchorNode = dynamicCastJso(anchor.container);
  focusNode = dynamicCastJso(focus_0.container);
  if (anchor.offset >= 0) {
    anchorOffset = $getTextOffset(anchor);
  }
   else if ($getNodeAfter(anchor) == null) {
    anchorOffset = anchorNode.childNodes.length;
  }
   else {
    anchorNode = (parent_0 = dynamicCastJso($getNodeAfter(anchor)).parentNode , (!parent_0 || parent_0.nodeType != 1) && (parent_0 = null) , parent_0);
    range.setStartBefore(dynamicCastJso($getNodeAfter(anchor)));
    anchorOffset = range.startOffset;
  }
  if (focus_0.offset >= 0) {
    focusOffset = $getTextOffset(focus_0);
  }
   else {
    focusNodeAfter = dynamicCastJso($getNodeAfter(focus_0));
    if (!focusNodeAfter) {
      focusOffset = focusNode.childNodes.length;
    }
     else {
      focusNode = $getParentElement(focusNodeAfter);
      range.setStartBefore(focusNodeAfter);
      focusOffset = range.startOffset;
    }
  }
  $clinit_649();
  $wnd.getSelection().setBaseAndExtent(anchorNode, anchorOffset, focusNode, focusOffset);
}

function SelectionImplW3C_0(){
  $clinit_1051();
  $log_0(logger_5.traceLogger, 'Constructed SelectionImplW3C');
}

function constructRange(anchorNode, anchorOffset, focusNode, focusOffset){
  return new FocusedPointRange_1(nodeOffsetToNodeletPoint(anchorNode, anchorOffset), nodeOffsetToNodeletPoint(focusNode, focusOffset));
}

function toOrderedPointRange(jsRange){
  if (!jsRange) {
    return null;
  }
  return new PointRange_1(nodeOffsetToNodeletPoint(jsRange.startContainer, jsRange.startOffset), nodeOffsetToNodeletPoint(jsRange.endContainer, jsRange.endOffset));
}

function SelectionImplW3C(){
}

_ = SelectionImplW3C_0.prototype = SelectionImplW3C.prototype = new SelectionImpl;
_.getClass$ = function getClass_676(){
  return Lorg_waveprotocol_wave_client_editor_selection_html_SelectionImplW3C_2_classLit;
}
;
_.castableTypeMap$ = {};
var logger_5;
function $setCaret_3(this$static, node){
  $clinit_649();
  this$static.setBaseAndExtent(node, 0, node, 0);
}

function getSelectionGuarded(){
  var selection;
  selection = $wnd.getSelection();
  if (!!selection && isUnreadable(selection.anchorNode)) {
    $setCaret_3(selection, ($clinit_1046() , $doc.activeElement));
    return selection;
  }
  return selection;
}

function $registerElement(this$static, element){
  $put_5(this$static.suggestables, null.nullMethod(), element);
}

function $setCurrent(this$static, newCurrent){
  var alreadyShown;
  alreadyShown = false;
  if (this$static.current) {
    !newCurrent?$hide(this$static.popupCloser.this$0.popup):throwClassCastExceptionUnlessNull(this$static.current.value_0).nullMethod();
    alreadyShown = true;
  }
  if (newCurrent) {
    this$static.current = newCurrent;
    throwClassCastExceptionUnlessNull(this$static.current.value_0);
    $clearItems(this$static.menu);
    null.nullMethod();
    null.nullMethod();
    $moveSelectionDown(this$static.menu);
    null.nullMethod();
    null.nullMethod();
    !this$static.savedSelection && (this$static.savedSelection = $getSelectionRange(this$static.selectionHelper));
    alreadyShown?$move_1(this$static.popup):$show_0(this$static.popup);
  }
}

function InteractiveSuggestionsManager_0(selectionHelper, closeSuggestionMenuDelayMs){
  this.handler = new InteractiveSuggestionsManager$1_0(this);
  this.menu = new SuggestionMenu_0(this.handler);
  this.suggestables = new LinkedPruningSequenceMap_0(new LinkedPruningSequenceMap$1_0);
  this.popupCloser = new InteractiveSuggestionsManager$PopupCloser_0(this, new SchedulerTimerService_0((!instance_7 && (instance_7 = new BrowserBackedScheduler_0 , setDefaultTimerService() , undefined) , instance_7)));
  this.popup = createPopup_0(this, true, this.menu, this);
  this.closeSuggestionMenuDelayMs = closeSuggestionMenuDelayMs;
  this.selectionHelper = selectionHelper;
}

function InteractiveSuggestionsManager(){
}

_ = InteractiveSuggestionsManager_0.prototype = InteractiveSuggestionsManager.prototype = new Object_0;
_.getClass$ = function getClass_679(){
  return Lorg_waveprotocol_wave_client_editor_sugg_InteractiveSuggestionsManager_2_classLit;
}
;
_.onHide = function onHide_0(source){
  try {
    !!this.savedSelection && $setSelectionRange_1(this.selectionHelper, this.savedSelection);
  }
   finally {
    this.savedSelection = null;
    if (this.current) {
      throwClassCastExceptionUnlessNull(this.current.value_0).nullMethod();
      this.current = null;
    }
  }
}
;
_.onShow = function onShow_0(source){
  $clinit_1046();
  cache_1 = null;
  $wnd.getSelection().removeAllRanges();
  $clinit_414();
  $focus_0(this.menu.element);
}
;
_.setPopupPositionAndMakeVisible = function setPopupPositionAndMakeVisible_0(reference, popup){
  var popupStyle;
  popupStyle = popup.style;
  popupStyle['left'] = null.nullMethod() - (popup.offsetWidth || 0) + 26 + ($clinit_88() , 'px');
  popupStyle['top'] = null.nullMethod() + 5 + 'px';
  popupStyle['visibility'] = ($clinit_99() , 'visible');
}
;
_.castableTypeMap$ = {349:1};
_.closeSuggestionMenuDelayMs = 0;
_.current = null;
_.popup = null;
_.savedSelection = null;
_.selectionHelper = null;
function $handleLeftRight(this$static, isRight){
  var newCurrent;
  newCurrent = isRight?$getNext(this$static.this$0.current):$getPrev(this$static.this$0.current);
  newCurrent == this$static.this$0.current && (newCurrent = null);
  $setCurrent(this$static.this$0, newCurrent);
}

function InteractiveSuggestionsManager$1_0(this$0){
  this.this$0 = this$0;
}

function InteractiveSuggestionsManager$1(){
}

_ = InteractiveSuggestionsManager$1_0.prototype = InteractiveSuggestionsManager$1.prototype = new Object_0;
_.getClass$ = function getClass_680(){
  return Lorg_waveprotocol_wave_client_editor_sugg_InteractiveSuggestionsManager$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $cancelScheduledClose(this$static){
  $cancel_3(this$static.timerService.scheduler, this$static.task);
}

function $scheduleClose(this$static){
  $scheduleDelayed_0(this$static.timerService, this$static.task, this$static.this$0.closeSuggestionMenuDelayMs);
}

function InteractiveSuggestionsManager$PopupCloser_0(this$0, timerService){
  this.this$0 = this$0;
  this.task = new InteractiveSuggestionsManager$PopupCloser$1_0(this);
  this.timerService = timerService;
}

function InteractiveSuggestionsManager$PopupCloser(){
}

_ = InteractiveSuggestionsManager$PopupCloser_0.prototype = InteractiveSuggestionsManager$PopupCloser.prototype = new Object_0;
_.getClass$ = function getClass_681(){
  return Lorg_waveprotocol_wave_client_editor_sugg_InteractiveSuggestionsManager$PopupCloser_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.timerService = null;
function InteractiveSuggestionsManager$PopupCloser$1_0(this$1){
  this.this$1 = this$1;
}

function InteractiveSuggestionsManager$PopupCloser$1(){
}

_ = InteractiveSuggestionsManager$PopupCloser$1_0.prototype = InteractiveSuggestionsManager$PopupCloser$1.prototype = new Object_0;
_.execute_0 = function execute_35(){
  $hide(this.this$1.this$0.popup);
}
;
_.getClass$ = function getClass_682(){
  return Lorg_waveprotocol_wave_client_editor_sugg_InteractiveSuggestionsManager$PopupCloser$1_2_classLit;
}
;
_.castableTypeMap$ = {252:1, 253:1};
_.this$1 = null;
function $clinit_1064(){
  $clinit_1064 = nullMethod;
  $clinit_103();
  $push_1(toInject, ($clinit_211() , "/* CssUrl */\n/* CssUrl */\na.C-LH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-sugg, a.C-IH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-orig, a.C-GH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-cmd {\n  display : block;\n  color : #003ea8;\n  background-color : white;\n  cursor : pointer;\n  padding : 3px 20px 4px 20px;\n  margin : 0 -2px !important;\n  text-decoration : none;\n}\n.C-HH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-hover a.C-LH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-sugg, .C-HH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-hover a.C-IH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-orig, .C-HH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-hover a.C-GH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-cmd {\n  color : white;\n  background-color : #4086ff;\n  text-decoration : none;\n}\n.C-HH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-hover a.C-LH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-sugg label, .C-HH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-hover a.C-IH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-orig label {\n  color : #c0d4ff;\n}\n.C-LH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-sugg label, .C-IH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-orig label {\n  margin-right : 5px;\n  text-decoration : underline;\n  color : #7295cf;\n}\n.C-LH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-sugg span {\n  font-weight : bold;\n  text-decoration : none;\n}\n.C-IH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-orig span {\n  font-style : italic;\n  text-decoration : none;\n}\n.C-IH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-orig {\n  background-image : url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHRJREFUeNpiYIABuxX/GQgAJmIVggAjEQo3AnEDw6GIC4woJh+KYERRZreCH0gmgBUzMDgyorgZXTFCrh5IKjDBBXAphIANQGzAxEAcEECEBmHgAMQXGPEqsVuhAPVgPsgZLDgUwYLzARAfACkE+ukhQIABAKZuHUYsPLRcAAAAAElFTkSuQmCC');\n  background-repeat : no-repeat;\n  background-position : 5px 50%;\n}\n.C-HH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-hover a.C-IH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-orig {\n  background-image : url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAGZJREFUeNpiYICC/0DAQAAwEasQrBhZ4X/sYAMQGzCgK0I3CSjED8T5QPwepIERWQMjEGCzHihVD6QUiHEqSLE+EJ9nYiAOCMBDgwjgAMQXCFmvAMQNUA/K41IEA/eBeD5MIUCAAQCexWwv78dj0QAAAABJRU5ErkJggg==');\n  background-repeat : no-repeat;\n  background-position : 5px 50%;\n}\n.C-GH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-cmd span {\n  margin-left : 12px;\n  text-decoration : none;\n}\n.C-KH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-sep {\n  width : 100%;\n  margin-top : 1px;\n  height : 1px;\n  border-top : 1px solid #e3e8f2;\n}\n.C-JH-org-waveprotocol-wave-client-editor-sugg-SuggestionResources-Css-selected {\n  background : #d0e8ff;\n}\n"));
  flush();
}

function $handleEventInner_0(this$static, event_0){
  var index, keyCode, target;
  switch ($eventGetTypeInt(event_0.type)) {
    case 262144:
      event_0.preventDefault();
      break;
    case 256:
    case 128:
      {
        keyCode = event_0.keyCode || 0;
        switch (keyCode) {
          case 37:
          case 39:
            $handleLeftRight(this$static.handler, keyCode == 39);
            event_0.stopPropagation();
            return;
          case 13:
            event_0.stopPropagation();
        }
        if (keyCode >= 49 && keyCode <= 57) {
          index = keyCode - 49;
          if (index >= 0 && index < this$static.items.size_0) {
            throwClassCastExceptionUnlessNull($get_7(this$static.items, index));
            return;
          }
        }
        break;
      }

    case 32:
      {
        target = event_0.relatedTarget;
        $isOrHasChild(this$static.element, target) || $scheduleClose(this$static.handler.this$0.popupCloser);
        break;
      }

    case 16:
      {
        $cancelScheduledClose(this$static.handler.this$0.popupCloser);
        break;
      }

  }
}

function SuggestionMenu_0(handler){
  $clinit_1064();
  MenuBar_1.call(this, $clinit_380());
  this.handler = handler;
  this.eventsToSink == -1?sinkEvents(this.element, 262400 | (this.element.__eventBits || 0)):(this.eventsToSink |= 262400);
}

function SuggestionMenu(){
}

_ = SuggestionMenu_0.prototype = SuggestionMenu.prototype = new MenuBar;
_.getClass$ = function getClass_683(){
  return Lorg_waveprotocol_wave_client_editor_sugg_SuggestionMenu_2_classLit;
}
;
_.onBrowserEvent = function onBrowserEvent_6(event_0){
  var sEvent;
  sEvent = ($clinit_669() , create_16(DEFAULT_FACTORY, event_0, true));
  !!sEvent && $handleEventInner_0(this, event_0);
  $onBrowserEvent_0(this, event_0);
}
;
_.castableTypeMap$ = {5:1, 6:1, 7:1, 8:1, 55:1, 59:1};
_.handler = null;
function $buildBoundaryMaps(this$static, location_0){
  var keysToCheck, leftValues, rightValues;
  this$static.leftSide.clear();
  this$static.rightSide.clear();
  leftValues = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  rightValues = defaultCollectionFactory.createStringMap();
  keysToCheck = defaultCollectionFactory.createStringSet();
  location_0 > 0 && (this$static.doc.doc.annotations.forEachAnnotationAt(location_0 - 1, new IndexedDocumentImpl$7_0(new AnnotationBehaviourLogic$3_0(leftValues, keysToCheck))) , undefined);
  location_0 < $size_15(this$static.doc.doc) && (this$static.doc.doc.annotations.forEachAnnotationAt(location_0, new IndexedDocumentImpl$7_0(new AnnotationBehaviourLogic$4_0(rightValues, keysToCheck))) , undefined);
  keysToCheck.each_3(new AnnotationBehaviourLogic$5_0(this$static, leftValues, rightValues));
}

function $shouldInheritFromRight(bias, inherit){
  switch (inherit.ordinal) {
    case 0:
      if (bias == ($clinit_1780() , RIGHT_4)) {
        return true;
      }

      break;
    case 1:
      if (bias == ($clinit_1780() , LEFT_4) || bias == NEITHER) {
        return true;
      }

  }
  return false;
}

function $supplementAnnotations(this$static, location_0, bias, type){
  checkState_2(!!this$static.doc, 'Cannot call out of init/reset cycle.');
  $buildBoundaryMaps(this$static, location_0);
  $locate_0(this$static.doc.doc, location_0);
  this$static.leftSide.each_2(new AnnotationBehaviourLogic$2_0(this$static, bias, type, location_0));
}

function AnnotationBehaviourLogic_0(registry, doc, caret){
  this.leftSide = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  this.rightSide = defaultCollectionFactory.createStringMap();
  this.registry = registry;
  this.doc = doc;
  this.caret = caret;
}

function AnnotationBehaviourLogic(){
}

_ = AnnotationBehaviourLogic_0.prototype = AnnotationBehaviourLogic.prototype = new Object_0;
_.getClass$ = function getClass_691(){
  return Lorg_waveprotocol_wave_client_editor_util_AnnotationBehaviourLogic_2_classLit;
}
;
_.castableTypeMap$ = {};
_.caret = null;
_.doc = null;
_.registry = null;
function AnnotationBehaviourLogic$2_0(this$0, val$bias, val$type, val$location){
  this.this$0 = this$0;
  this.val$bias = val$bias;
  this.val$type = val$type;
  this.val$location = val$location;
}

function AnnotationBehaviourLogic$2(){
}

_ = AnnotationBehaviourLogic$2_0.prototype = AnnotationBehaviourLogic$2.prototype = new Object_0;
_.apply_1 = function apply_43(key, value){
  var behaviours, direction, inheritFromRight, newValue, oldValue, ret;
  if (this.this$0.caret.annotations.containsKey(key)) {
    return;
  }
  direction = ($clinit_1786() , INSIDE);
  behaviours = $getBehaviours(this.this$0.registry, key);
  if (behaviours.next) {
    direction = (ret = behaviours.next , $getNext_5(behaviours) , ret).replace_0(this.this$0.rightSide, this.this$0.leftSide, this.val$type);
    inheritFromRight = $shouldInheritFromRight(this.val$bias, direction);
  }
   else {
    inheritFromRight = this.val$bias == ($clinit_1780() , RIGHT_4);
  }
  if (inheritFromRight) {
    newValue = getAlignedAnnotation(this.this$0.doc, this.val$location, key, false);
    oldValue = $getAnnotation_2(this.this$0.doc.doc, this.val$location - 1, key);
    (newValue == null?oldValue == null:$equals_3(newValue, oldValue)) || (this.this$0.caret.annotations.put(key, newValue) , undefined);
  }
   else 
    direction == NEITHER_0 && this.val$location > 0 && $getAnnotation_2(this.this$0.doc.doc, this.val$location - 1, key) != null && (this.this$0.caret.annotations.put(key, null) , undefined);
}
;
_.getClass$ = function getClass_693(){
  return Lorg_waveprotocol_wave_client_editor_util_AnnotationBehaviourLogic$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$bias = null;
_.val$location = 0;
_.val$type = null;
function $apply_7(this$static, key, value){
  if (value != null) {
    this$static.val$leftValues.put_3(key, value);
    this$static.val$keysToCheck.add_3(key);
  }
}

function AnnotationBehaviourLogic$3_0(val$leftValues, val$keysToCheck){
  this.val$leftValues = val$leftValues;
  this.val$keysToCheck = val$keysToCheck;
}

function AnnotationBehaviourLogic$3(){
}

_ = AnnotationBehaviourLogic$3_0.prototype = AnnotationBehaviourLogic$3.prototype = new Object_0;
_.apply_1 = function apply_44(key, value){
  $apply_7(this, key, dynamicCast(value, 1));
}
;
_.getClass$ = function getClass_694(){
  return Lorg_waveprotocol_wave_client_editor_util_AnnotationBehaviourLogic$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$keysToCheck = null;
_.val$leftValues = null;
function $apply_8(this$static, key, value){
  if (value != null) {
    this$static.val$rightValues.put_3(key, value);
    this$static.val$keysToCheck.add_3(key);
  }
}

function AnnotationBehaviourLogic$4_0(val$rightValues, val$keysToCheck){
  this.val$rightValues = val$rightValues;
  this.val$keysToCheck = val$keysToCheck;
}

function AnnotationBehaviourLogic$4(){
}

_ = AnnotationBehaviourLogic$4_0.prototype = AnnotationBehaviourLogic$4.prototype = new Object_0;
_.apply_1 = function apply_45(key, value){
  $apply_8(this, key, dynamicCast(value, 1));
}
;
_.getClass$ = function getClass_695(){
  return Lorg_waveprotocol_wave_client_editor_util_AnnotationBehaviourLogic$4_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$keysToCheck = null;
_.val$rightValues = null;
function AnnotationBehaviourLogic$5_0(this$0, val$leftValues, val$rightValues){
  this.this$0 = this$0;
  this.val$leftValues = val$leftValues;
  this.val$rightValues = val$rightValues;
}

function AnnotationBehaviourLogic$5(){
}

_ = AnnotationBehaviourLogic$5_0.prototype = AnnotationBehaviourLogic$5.prototype = new Object_0;
_.apply_4 = function apply_46(key){
  var left, right;
  left = dynamicCast(this.val$leftValues.get_4(key), 1);
  right = dynamicCast(this.val$rightValues.get_4(key), 1);
  if (left == null?right != null:!$equals_3(left, right)) {
    this.this$0.leftSide.put_3(key, left);
    this.this$0.rightSide.put_3(key, right);
  }
}
;
_.getClass$ = function getClass_696(){
  return Lorg_waveprotocol_wave_client_editor_util_AnnotationBehaviourLogic$5_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$leftValues = null;
_.val$rightValues = null;
function nativeSetupWebDriverTestPins_0(){
  $wnd['webdriverEditorGetContent'] = function(editorDiv){
    return webdriverEditorGetContent(editorDiv);
  }
  ;
  $wnd['webdriverEditorSetContent'] = function(editorDiv, content_0){
    webdriverEditorSetContent(editorDiv, content_0);
  }
  ;
  $wnd['webdriverEditorGetStartSelection'] = function(editorDiv){
    var range;
    return range = getSelectionWithFlush(editorDiv) , !range?-1:range.start;
  }
  ;
  $wnd['webdriverEditorGetEndSelection'] = function(editorDiv){
    var range;
    return range = getSelectionWithFlush(editorDiv) , !range?-1:range.end;
  }
  ;
  $wnd['webdriverEditorSetSelection'] = function(editorDiv, start, end){
    var editor;
    editor = !editorDiv?null:dynamicCast(editorDiv['__editor'] || null, 240);
    $setSelectionRange_1((checkState_2(!!editor.passiveSelectionHelper, 'Using the selection helper of an editor not set up.') , $checkContextConsistency(editor) , editor.passiveSelectionHelper), new FocusedRange_0(start, end));
  }
  ;
  $wnd['webdriverEditorGetEndSelection'] = function(editorDiv){
    var range;
    return range = getSelectionWithFlush(editorDiv) , !range?-1:range.end;
  }
  ;
  $wnd['webdriverEditorGetDocDiv'] = function(editorDiv){
    var editor;
    return editor = !editorDiv?null:dynamicCast(editorDiv['__editor'] || null, 240) , dynamicCast(editor.content_0.fullContentView.inner_0.getDocumentElement(), 196).implNodelet;
  }
  ;
  $wnd['webdriverEditorGetLocalDiffAnnotations'] = function(editorDiv){
    return webdriverEditorGetLocalDiffAnnotations(editorDiv);
  }
  ;
  $wnd['webdriverEditorGetLocalContent'] = function(editorDiv){
    return webdriverEditorGetLocalContent(editorDiv);
  }
  ;
}

function getSelectionWithFlush(editorDiv){
  var editor, selection;
  editor = !editorDiv?null:dynamicCast(editorDiv['__editor'] || null, 240);
  if (editor) {
    !!editor && !!editor.content_0 && $flush_1(editor.typing);
    return selection = $getSelectionRange((checkState_2(!!editor.passiveSelectionHelper, 'Using the selection helper of an editor not set up.') , $checkContextConsistency(editor) , editor.passiveSelectionHelper)) , selection?(!selection.range && (selection.range = selection.anchor < selection.focus_0?new Range_2(selection.anchor, selection.focus_0):new Range_2(selection.focus_0, selection.anchor)) , selection.range):null;
  }
  return null;
}

function webdriverEditorGetContent(editorDiv){
  var content_0, editor;
  editor = !editorDiv?null:dynamicCast(editorDiv['__editor'] || null, 240);
  if (editor) {
    !!editor && !!editor.content_0 && $flush_1(editor.typing);
    content_0 = innerXml1(editor.content_0.persistentContentView).builder.impl.string;
    return content_0 == null?null:'_' + content_0;
  }
   else {
    return 'Error in webdriverEditorGetContent';
  }
}

function webdriverEditorGetLocalContent(editorDiv){
  var editor;
  editor = !editorDiv?null:dynamicCast(editorDiv['__editor'] || null, 240);
  if (editor) {
    !!editor && !!editor.content_0 && $flush_1(editor.typing);
    return innerXml1(editor.content_0.fullContentView).builder.impl.string;
  }
   else {
    return 'Error in webdriverEditorGetLocalContent';
  }
}

function webdriverEditorGetLocalDiffAnnotations(editorDiv){
  var annotations, ans, editor, interval, interval$iterator, isDeletion, isInsertion, j, keys, symbol;
  editor = !editorDiv?null:dynamicCast(editorDiv['__editor'] || null, 240);
  if (!editor) {
    return 'Error in webdriverEditorGetContent';
  }
  !!editor && !!editor.content_0 && $flush_1(editor.typing);
  ans = new StringBuilder_2('');
  keys = newStringSet(initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, [($clinit_858() , DIFF_INSERT_KEY), DIFF_DELETE_KEY]));
  annotations = editor.content_0.localAnnotations;
  $annotationIntervals_2(annotations, 0, annotations.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1, keys);
  for (interval$iterator = $iterator_18($annotationIntervals_2(annotations, 0, annotations.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1, keys)); interval$iterator.first || interval$iterator.entries.heap.size_0 != 0;) {
    interval = $next_26(interval$iterator);
    isInsertion = interval.annotations.getExisting(DIFF_INSERT_KEY) != null;
    isDeletion = interval.annotations.getExisting(DIFF_DELETE_KEY) != null;
    isInsertion && isDeletion?(symbol = 42):isInsertion?(symbol = 43):isDeletion?(symbol = 45):(symbol = 46);
    for (j = 0; j < interval.end - interval.start; ++j) {
      ans.impl.string += String.fromCharCode(symbol);
    }
  }
  return ans.impl.string;
}

function webdriverEditorSetContent(editorDiv, content_0){
  var editor;
  editor = !editorDiv?null:dynamicCast(editorDiv['__editor'] || null, 240);
  if (editor) {
    checkNotNull_1(null, 'documentSchema is not set');
    $setContent_0(editor, $asOperation($parse_1(($clinit_2112() , content_0))));
  }
}

function install(profileManager, supplement, signedInUser){
  return new Gadget$1_0(supplement, profileManager, signedInUser);
}

function register_11(registry, waveletName, blip, supplement, profileManager, loginName){
  var renderer, mutable;
  renderer = new GadgetRenderer_0(waveletName, blip, supplement, profileManager, loginName);
  $registerEventHandler(registry, 'gadget', ($clinit_907() , INSTANCE_8));
  mutable = dynamicCast($modify_0(registry.data_0), 211);
  mutable.renderers.put_3('gadget', renderer);
  mutable.mutationHandlers.put_3('gadget', renderer);
}

function Gadget$1_0(val$supplement, val$profileManager, val$signedInUser){
  this.val$supplement = val$supplement;
  this.val$profileManager = val$profileManager;
  this.val$signedInUser = val$signedInUser;
}

function Gadget$1(){
}

_ = Gadget$1_0.prototype = Gadget$1.prototype = new Object_0;
_.getClass$ = function getClass_697(){
  return Lorg_waveprotocol_wave_client_gadget_Gadget$1_2_classLit;
}
;
_.install = function install_0(w, c, b, r){
  var name_0;
  name_0 = new WaveletName_0(w.waveId, w.wavelet.id_0);
  register_11(r.elementHandlerRegistry, name_0, b, this.val$supplement, this.val$profileManager, this.val$signedInUser.address);
}
;
_.castableTypeMap$ = {319:1};
_.val$profileManager = null;
_.val$signedInUser = null;
_.val$supplement = null;
function $clinit_1086(){
  $clinit_1086 = nullMethod;
  LOG_3 = new DomLogger_0('gadgets');
  FINE_LOG = new DomLogger_0('gadgets-fine');
  DEVELOPER_LOG = new DomLogger_0('gadgets-dev');
}

var DEVELOPER_LOG, FINE_LOG, LOG_3;
function $checkKeyValue(this$static, proc){
  var $e0;
  try {
    return $checkKeyValueImpl(this$static, proc);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 183)) {
      null.nullMethod();
      return false;
    }
     else 
      throw $e0;
  }
}

function $checkKeyValueImpl(this$static, proc){
  for (var key in this$static) {
    if (this$static.hasOwnProperty(key) && key.charAt(0) === ':') {
      if (!proc.check_0(key.substring(1), this$static[key])) {
        return false;
      }
    }
  }
  return true;
}

function $clear_18(this$static){
  $checkKeyValue(this$static, new StateMap$5_0(new StateMap$6_0(this$static)));
}

function $compare_4(this$static, otherMap){
  return !!otherMap && $checkKeyValue(this$static, new StateMap$KeyValueComparator_0(otherMap)) && $checkKeyValue(otherMap, new StateMap$KeyValueComparator_0(this$static));
}

function $copyFrom(this$static, map){
  $checkKeyValue(this$static, new StateMap$5_0(new StateMap$6_0(this$static)));
  $checkKeyValue(map, new StateMap$5_0(new StateMap$7_0(this$static)));
}

function $escapeValue(string){
  var escapable = new RegExp('[\\\\"\0-\37\x7F-\x9F\xAD\u0600-\u0604\u070F\u17B4\u17B5\u200C-\u200F\u2028-\u202F\u2060-\u206F\uFEFF\uFFF0-\uFFFF]', 'g');
  var meta = {'\b':'\\b', '\t':'\\t', '\n':'\\n', '\f':'\\f', '\r':'\\r', '"':'\\"', '\\':'\\\\'};
  escapable.lastIndex = 0;
  return escapable.test(string)?'"' + string.replace(escapable, function(a_0){
    var c = meta[a_0];
    return typeof c === 'string'?c:'\\u' + ('0000' + a_0.charCodeAt(0).toString(16)).slice(-4);
  }
  ) + '"':'"' + string + '"';
}

function $fromJson(this$static, json){
  var jsonObject = {};
  /^[\],:{}\s]*$/.test(json.replace(/\\["\\\/b-u]/g, '@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, ']').replace(/(?:^|:|,)(?:\s*\[)+/g, '')) && (jsonObject = eval('(' + json + ')'));
  copyJson(jsonObject, this$static);
}

function $remove_32(this$static, key){
  this$static.hasOwnProperty(':' + key) && (delete this$static[':' + key] , undefined);
}

function $toJson(this$static){
  var builder;
  builder = new StringBuilder_0;
  builder.impl.string += '{';
  $checkKeyValue(this$static, new StateMap$5_0(new StateMap$8_0(builder)));
  builder.impl.string += '}';
  return builder.impl.string;
}

function copyJson(source, target){
  for (var key in target) {
    target.hasOwnProperty(key) && delete target[key];
  }
  for (var key in source) {
    source[key] === null?(target[':' + key] = null):typeof source[key] === 'string'?(target[':' + key] = source[key]):typeof source[key] === 'number' && (target[':' + key] = String(source[key]));
  }
}

function StateMap$1_0(val$stateMap){
  this.val$stateMap = val$stateMap;
}

function StateMap$1(){
}

_ = StateMap$1_0.prototype = StateMap$1.prototype = new Object_0;
_.apply_1 = function apply_47(key, value){
  this.val$stateMap[':' + key] = dynamicCast(value, 1);
}
;
_.getClass$ = function getClass_698(){
  return Lorg_waveprotocol_wave_client_gadget_StateMap$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$stateMap = null;
function StateMap$5_0(val$proc){
  this.val$proc = val$proc;
}

function StateMap$5(){
}

_ = StateMap$5_0.prototype = StateMap$5.prototype = new Object_0;
_.check_0 = function check_8(key, value){
  this.val$proc.apply_10(key, value);
  return true;
}
;
_.getClass$ = function getClass_699(){
  return Lorg_waveprotocol_wave_client_gadget_StateMap$5_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$proc = null;
function StateMap$6_0(this$0){
  this.this$0 = this$0;
}

function StateMap$6(){
}

_ = StateMap$6_0.prototype = StateMap$6.prototype = new Object_0;
_.apply_10 = function apply_48(key, value){
  $remove_32(this.this$0, key);
}
;
_.getClass$ = function getClass_700(){
  return Lorg_waveprotocol_wave_client_gadget_StateMap$6_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function StateMap$7_0(this$0){
  this.this$0 = this$0;
}

function StateMap$7(){
}

_ = StateMap$7_0.prototype = StateMap$7.prototype = new Object_0;
_.apply_10 = function apply_49(key, value){
  this.this$0[':' + key] = value;
}
;
_.getClass$ = function getClass_701(){
  return Lorg_waveprotocol_wave_client_gadget_StateMap$7_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function StateMap$8_0(val$builder){
  this.val$builder = val$builder;
}

function StateMap$8(){
}

_ = StateMap$8_0.prototype = StateMap$8.prototype = new Object_0;
_.apply_10 = function apply_50(key, value){
  this.firstKey?(this.firstKey = false):$append_11(this.val$builder, ',');
  $append_11(this.val$builder, $escapeValue(key) + ':');
  value == null?$append_11(this.val$builder, 'null'):$append_11(this.val$builder, $escapeValue(value));
}
;
_.getClass$ = function getClass_702(){
  return Lorg_waveprotocol_wave_client_gadget_StateMap$8_2_classLit;
}
;
_.castableTypeMap$ = {};
_.firstKey = true;
_.val$builder = null;
function StateMap$9_0(val$jso){
  this.val$jso = val$jso;
}

function StateMap$9(){
}

_ = StateMap$9_0.prototype = StateMap$9.prototype = new Object_0;
_.apply_10 = function apply_51(key, value){
  this.val$jso[key] = value;
}
;
_.getClass$ = function getClass_703(){
  return Lorg_waveprotocol_wave_client_gadget_StateMap$9_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$jso = null;
function StateMap$KeyValueComparator_0(otherMap){
  this.otherMap = otherMap;
}

function StateMap$KeyValueComparator(){
}

_ = StateMap$KeyValueComparator_0.prototype = StateMap$KeyValueComparator.prototype = new Object_0;
_.check_0 = function check_9(key, value){
  return value == null?this.otherMap.hasOwnProperty(':' + key) && this.otherMap[':' + key] == null:$equals_3(value, this.otherMap[':' + key]);
}
;
_.getClass$ = function getClass_704(){
  return Lorg_waveprotocol_wave_client_gadget_StateMap$KeyValueComparator_2_classLit;
}
;
_.castableTypeMap$ = {};
_.otherMap = null;
function $registerService(this$static, service_0){
  var hub = this$static.hub;
  hub && hub.register(service_0, function(){
    var service = this['s'];
    var gadgetId = this['f'];
    var callback = this['c'] || null;
    var args = this['a'];
    (!instance_6 && (instance_6 = new Controller_0) , instance_6).callback_0(service, gadgetId, callback, args);
  }
  );
}

function Controller_0(){
  Controller_1.call(this, $wnd.gadgets.rpc);
}

function Controller_1(library){
  var service, service$array, service$index, service$max;
  this.callbackMap = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  this.serviceMap = defaultCollectionFactory.createStringMap();
  this.hub = library;
  for (service$array = ($clinit_1100() , $clinit_1100() , $VALUES_36) , service$index = 0 , service$max = service$array.length; service$index < service$max; ++service$index) {
    service = service$array[service$index];
    $registerService(this, service.name_0);
    this.serviceMap.put_3(service.name_0, service);
  }
}

function Controller(){
}

_ = Controller_0.prototype = Controller.prototype = new Object_0;
_.callback_0 = function callback_0(service, gadgetId, serviceCallback, arguments_0){
  this.callbackMap.containsKey_1(gadgetId) && this.serviceMap.containsKey_1(service) && $callService(dynamicCast(this.serviceMap.get_4(service), 113), dynamicCast(this.callbackMap.get_4(gadgetId), 241), arguments_0);
}
;
_.getClass$ = function getClass_705(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_Controller_2_classLit;
}
;
_.castableTypeMap$ = {};
_.hub = null;
var instance_6 = null;
function Controller$InvalidArgumentException_0(message){
  this.fillInStackTrace();
  this.detailMessage = message;
}

function Controller$InvalidArgumentException(){
}

_ = Controller$InvalidArgumentException_0.prototype = Controller$InvalidArgumentException.prototype = new Exception;
_.getClass$ = function getClass_706(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_Controller$InvalidArgumentException_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 39:1, 183:1};
function $clinit_1100(){
  $clinit_1100 = nullMethod;
  WAVE_ENABLE = new Controller$Service_0('WAVE_ENABLE', 0, 'wave_enable', new Controller$Service$1_0);
  WAVE_GADGET_STATE = new Controller$Service_0('WAVE_GADGET_STATE', 1, 'wave_gadget_state', new Controller$Service$2_0);
  WAVE_PRIVATE_GADGET_STATE = new Controller$Service_0('WAVE_PRIVATE_GADGET_STATE', 2, 'wave_private_gadget_state', new Controller$Service$3_0);
  SET_TITLE = new Controller$Service_0('SET_TITLE', 3, 'set_title', new Controller$Service$4_0);
  SET_PREF = new Controller$Service_0('SET_PREF', 4, 'set_pref', new Controller$Service$5_0);
  RESIZE_IFRAME = new Controller$Service_0('RESIZE_IFRAME', 5, 'resize_iframe', new Controller$Service$6_0);
  SET_IFRAME_WIDTH = new Controller$Service_0('SET_IFRAME_WIDTH', 6, 'setIframeWidth', new Controller$Service$7_0);
  REQUEST_NAVIGATE_TO = new Controller$Service_0('REQUEST_NAVIGATE_TO', 7, 'requestNavigateTo', new Controller$Service$8_0);
  NAVIGATE_TO_FRAGMENT = new Controller$Service_0('NAVIGATE_TO_FRAGMENT', 8, 'navigateToFragment', new Controller$Service$9_0);
  UPDATE_PODIUM_STATE = new Controller$Service_0('UPDATE_PODIUM_STATE', 9, 'updateState', new Controller$Service$10_0);
  LOG_MESSAGE = new Controller$Service_0('LOG_MESSAGE', 10, 'wave_log', new Controller$Service$11_0);
  SET_SNIPPET = new Controller$Service_0('SET_SNIPPET', 11, 'set_snippet', new Controller$Service$12_0);
  $VALUES_36 = initValues(_3Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service_2_classLit, {9:1, 68:1, 170:1}, 113, [WAVE_ENABLE, WAVE_GADGET_STATE, WAVE_PRIVATE_GADGET_STATE, SET_TITLE, SET_PREF, RESIZE_IFRAME, SET_IFRAME_WIDTH, REQUEST_NAVIGATE_TO, NAVIGATE_TO_FRAGMENT, UPDATE_PODIUM_STATE, LOG_MESSAGE, SET_SNIPPET]);
}

function $callService(this$static, listener, arguments_0){
  var $e0;
  try {
    this$static.callback.callService(listener, arguments_0);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (!instanceOf($e0, 183))
      throw $e0;
  }
}

function Controller$Service_0(enum$name, enum$ordinal, name_0, callback){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
  this.name_0 = name_0;
  this.callback = callback;
}

function getArgument(arguments_0){
  $clinit_1100();
  if (!!arguments_0 && arguments_0.length > 0) {
    return arguments_0[0] == null?null:Object(arguments_0[0]);
  }
   else {
    throw new Controller$InvalidArgumentException_0('Missing argument at 0');
  }
}

function getArgumentAsString(index, arguments_0){
  $clinit_1100();
  if (!!arguments_0 && arguments_0.length > index) {
    return String(arguments_0[index]);
  }
   else {
    throw new Controller$InvalidArgumentException_0('Missing argument at ' + index);
  }
}

function valueOf_43(name_0){
  $clinit_1100();
  return valueOf_0(($clinit_1113() , $MAP_36), name_0);
}

function values_37(){
  $clinit_1100();
  return $VALUES_36;
}

function Controller$Service(){
}

_ = Controller$Service_0.prototype = Controller$Service.prototype = new Enum;
_.getClass$ = function getClass_707(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 113:1};
_.callback = null;
_.name_0 = null;
var $VALUES_36, LOG_MESSAGE, NAVIGATE_TO_FRAGMENT, REQUEST_NAVIGATE_TO, RESIZE_IFRAME, SET_IFRAME_WIDTH, SET_PREF, SET_SNIPPET, SET_TITLE, UPDATE_PODIUM_STATE, WAVE_ENABLE, WAVE_GADGET_STATE, WAVE_PRIVATE_GADGET_STATE;
function Controller$Service$1_0(){
}

function Controller$Service$1(){
}

_ = Controller$Service$1_0.prototype = Controller$Service$1.prototype = new Object_0;
_.callService = function callService(listener, arguments_0){
  $waveEnable(listener, getArgumentAsString(0, arguments_0));
}
;
_.getClass$ = function getClass_708(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function Controller$Service$10_0(){
}

function Controller$Service$10(){
}

_ = Controller$Service$10_0.prototype = Controller$Service$10.prototype = new Object_0;
_.callService = function callService_0(listener, arguments_0){
  $updatePodiumState(listener, getArgumentAsString(0, arguments_0));
}
;
_.getClass$ = function getClass_709(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$10_2_classLit;
}
;
_.castableTypeMap$ = {};
function Controller$Service$11_0(){
}

function Controller$Service$11(){
}

_ = Controller$Service$11_0.prototype = Controller$Service$11.prototype = new Object_0;
_.callService = function callService_1(listener, arguments_0){
  $clinit_1086();
  $log_0(DEVELOPER_LOG.traceLogger, getArgumentAsString(0, arguments_0));
}
;
_.getClass$ = function getClass_710(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$11_2_classLit;
}
;
_.castableTypeMap$ = {};
function Controller$Service$12_0(){
}

function Controller$Service$12(){
}

_ = Controller$Service$12_0.prototype = Controller$Service$12.prototype = new Object_0;
_.callService = function callService_2(listener, arguments_0){
  $setSnippet(listener, getArgumentAsString(0, arguments_0));
}
;
_.getClass$ = function getClass_711(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$12_2_classLit;
}
;
_.castableTypeMap$ = {};
function Controller$Service$2_0(){
}

function Controller$Service$2(){
}

_ = Controller$Service$2_0.prototype = Controller$Service$2.prototype = new Object_0;
_.callService = function callService_3(listener, arguments_0){
  $waveGadgetStateUpdate(listener, getArgument(arguments_0));
}
;
_.getClass$ = function getClass_712(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$2_2_classLit;
}
;
_.castableTypeMap$ = {};
function Controller$Service$3_0(){
}

function Controller$Service$3(){
}

_ = Controller$Service$3_0.prototype = Controller$Service$3.prototype = new Object_0;
_.callService = function callService_4(listener, arguments_0){
  $wavePrivateGadgetStateUpdate(listener, getArgument(arguments_0));
}
;
_.getClass$ = function getClass_713(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$3_2_classLit;
}
;
_.castableTypeMap$ = {};
function Controller$Service$4_0(){
}

function Controller$Service$4(){
}

_ = Controller$Service$4_0.prototype = Controller$Service$4.prototype = new Object_0;
_.callService = function callService_5(listener, arguments_0){
  $setTitle_0(listener, getArgumentAsString(0, arguments_0));
}
;
_.getClass$ = function getClass_714(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$4_2_classLit;
}
;
_.castableTypeMap$ = {};
function Controller$Service$5_0(){
}

function Controller$Service$5(){
}

_ = Controller$Service$5_0.prototype = Controller$Service$5.prototype = new Object_0;
_.callService = function callService_6(listener, arguments_0){
  var i, keyValue;
  if (!arguments_0 || arguments_0.length < 1) {
    throw new Controller$InvalidArgumentException_0('Invalid number of arguments.');
  }
  keyValue = initDim(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, arguments_0.length - 1, 0);
  for (i = 1; i < arguments_0.length; ++i) {
    keyValue[i - 1] = getArgumentAsString(i, arguments_0);
  }
  $setPrefs(listener, keyValue);
}
;
_.getClass$ = function getClass_715(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$5_2_classLit;
}
;
_.castableTypeMap$ = {};
function Controller$Service$6_0(){
}

function Controller$Service$6(){
}

_ = Controller$Service$6_0.prototype = Controller$Service$6.prototype = new Object_0;
_.callService = function callService_7(listener, arguments_0){
  $setIframeHeight(listener, getArgumentAsString(0, arguments_0));
}
;
_.getClass$ = function getClass_716(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$6_2_classLit;
}
;
_.castableTypeMap$ = {};
function Controller$Service$7_0(){
}

function Controller$Service$7(){
}

_ = Controller$Service$7_0.prototype = Controller$Service$7.prototype = new Object_0;
_.callService = function callService_8(listener, arguments_0){
  $setIframeWidth(listener, getArgumentAsString(0, arguments_0));
}
;
_.getClass$ = function getClass_717(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$7_2_classLit;
}
;
_.castableTypeMap$ = {};
function Controller$Service$8_0(){
}

function Controller$Service$8(){
}

_ = Controller$Service$8_0.prototype = Controller$Service$8.prototype = new Object_0;
_.callService = function callService_9(listener, arguments_0){
  $requestNavigateTo(listener, getArgumentAsString(0, arguments_0));
}
;
_.getClass$ = function getClass_718(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$8_2_classLit;
}
;
_.castableTypeMap$ = {};
function Controller$Service$9_0(){
}

function Controller$Service$9(){
}

_ = Controller$Service$9_0.prototype = Controller$Service$9.prototype = new Object_0;
_.callService = function callService_10(listener, arguments_0){
  $requestNavigateTo(listener, getArgumentAsString(0, arguments_0));
}
;
_.getClass$ = function getClass_719(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$9_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_1113(){
  $clinit_1113 = nullMethod;
  $MAP_36 = createValueOfMap(($clinit_1100() , $VALUES_36));
}

var $MAP_36;
function $cleanupExpiredCache(this$static){
  var i, outerIter;
  i = (outerIter = $values(this$static.metadataMap).val$entrySet.iterator_0() , new AbstractMap$2$1_0(outerIter));
  while (i.val$outerIter.hasNext()) {
    $expired(dynamicCast(dynamicCast(i.val$outerIter.next_0(), 11).getValue(), 242)) && i.val$outerIter.remove_1();
  }
}

function $fetchDataByKey(this$static, key, receiveDataCommand){
  var cache;
  if (this$static.metadataMap.containsKey(key)) {
    cache = dynamicCast(this$static.metadataMap.get(key), 242);
    $onDataReady(receiveDataCommand, cache.metadata, cache);
    return true;
  }
  return false;
}

function $getGadgetData(this$static, gadgetSpecUrl, waveletName, instanceId, receiveDataCommand){
  var $e0, builder, e, gadget, gadgets, request, requestContext, secureGadgetDataKey, previous;
  $cleanupExpiredCache(this$static);
  secureGadgetDataKey = waveletName.waveId + ' ' + waveletName.waveletId + ' ' + instanceId + ' ' + gadgetSpecUrl;
  if ($fetchDataByKey(this$static, secureGadgetDataKey, receiveDataCommand)) {
    return;
  }
  if ($fetchDataByKey(this$static, gadgetSpecUrl, receiveDataCommand)) {
    return;
  }
  request = new JSONObject_0;
  requestContext = new JSONObject_0;
  gadgets = new JSONArray_0;
  gadget = new JSONObject_0;
  try {
    $put(gadget, 'url', new JSONString_0(gadgetSpecUrl));
    previous = $get_2(gadgets, 0);
    $set0(gadgets, 0, gadget);
    $put(requestContext, 'container', new JSONString_0('wave'));
    $put(request, 'context', requestContext);
    $put(request, 'gadgets', gadgets);
    builder = new RequestBuilder_0(($clinit_185() , POST), '/gadgets/metadata');
    $sendRequest(builder, $toString_6(request), new GadgetDataStoreImpl$1_0(this$static, receiveDataCommand, gadgetSpecUrl));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 243)) {
      e = $e0;
      $onError(receiveDataCommand, 'Unable to process gadget request.', e);
    }
     else 
      throw $e0;
  }
}

function GadgetDataStoreImpl_0(){
  this.metadataMap = new HashMap_0;
}

function GadgetDataStoreImpl(){
}

_ = GadgetDataStoreImpl_0.prototype = GadgetDataStoreImpl.prototype = new Object_0;
_.getClass$ = function getClass_720(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetDataStoreImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
var singleton_2 = null;
function GadgetDataStoreImpl$1_0(this$0, val$receiveDataCommand, val$nonSecureGadgetDataKey){
  this.this$0 = this$0;
  this.val$receiveDataCommand = val$receiveDataCommand;
  this.val$nonSecureGadgetDataKey = val$nonSecureGadgetDataKey;
}

function GadgetDataStoreImpl$1(){
}

_ = GadgetDataStoreImpl$1_0.prototype = GadgetDataStoreImpl$1.prototype = new Object_0;
_.getClass$ = function getClass_721(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetDataStoreImpl$1_2_classLit;
}
;
_.onError = function onError(request, exception){
  $onError(this.val$receiveDataCommand, 'Error retrieving metadata from the server.', exception);
}
;
_.onResponseReceived = function onResponseReceived(request, response){
  var $e0, exception, gadgetMetadata, metadata;
  gadgetMetadata = null;
  try {
    gadgetMetadata = $get_2($get_3(($clinit_233() , parse(response.val$xmlHttpRequest.responseText, false)).isObject(), 'gadgets').isArray(), 0).isObject();
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 244)) {
      exception = $e0;
      $onError(this.val$receiveDataCommand, 'Error in gadget metadata JSON.', exception);
    }
     else 
      throw $e0;
  }
  if (gadgetMetadata) {
    metadata = new GadgetMetadata_0(gadgetMetadata);
    this.this$0.metadataMap.put(this.val$nonSecureGadgetDataKey, new GadgetDataStoreImpl$CacheElement_0(metadata));
    $onDataReady(this.val$receiveDataCommand, metadata);
  }
   else {
    $onError(this.val$receiveDataCommand, 'Error in gadget metadata JSON.', null);
  }
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$nonSecureGadgetDataKey = null;
_.val$receiveDataCommand = null;
function $expired(this$static){
  return (new Date).getTime() > this$static.expirationTime;
}

function GadgetDataStoreImpl$CacheElement_0(metadata){
  this.metadata = metadata;
  this.expirationTime = (new Date).getTime() + 3600000;
}

function GadgetDataStoreImpl$CacheElement(){
}

_ = GadgetDataStoreImpl$CacheElement_0.prototype = GadgetDataStoreImpl$CacheElement.prototype = new Object_0;
_.getClass$ = function getClass_722(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetDataStoreImpl$CacheElement_2_classLit;
}
;
_.castableTypeMap$ = {242:1};
_.expirationTime = 0;
_.metadata = null;
function $clinit_1121(){
  $clinit_1121 = nullMethod;
  typeMap_0 = ($clinit_2309() , defaultCollectionFactory.createStringMap());
}

function $isDuplicate(this$static, child){
  var childKey;
  if (!child || child.type_0 != this$static.type_0) {
    return false;
  }
  childKey = dynamicCast(child.element.attributes.get_4('name'), 1);
  return childKey == dynamicCast(this$static.element.attributes.get_4('name'), 1) || childKey != null && $equals_3(childKey, dynamicCast(this$static.element.attributes.get_4('name'), 1));
}

function $setValue_4(this$static, value){
  if ($equals_3(this$static.value_0, value)) {
    return;
  }
  $setElementAttribute(this$static.element.context.this$0.mutableContent, this$static.element, 'value', value);
}

function GadgetElementChild_0(element){
  this.element = element;
  this.value_0 = dynamicCast(element.attributes.get_4('value'), 1);
  this.value_0 == null && (this.value_0 = '');
  this.type_0 = getElementType(this.element.tagName_0);
}

function create_24(node){
  $clinit_1121();
  var element;
  if (!node || !node.isElement()) {
    return null;
  }
   else {
    element = node.asElement();
    return new GadgetElementChild_0(element);
  }
}

function getElementType(tag){
  return typeMap_0.containsKey_1(tag)?dynamicCast(typeMap_0.get_4(tag), 114):($clinit_1122() , UNKNOWN);
}

function GadgetElementChild(){
}

_ = GadgetElementChild_0.prototype = GadgetElementChild.prototype = new Object_0;
_.getClass$ = function getClass_723(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetElementChild_2_classLit;
}
;
_.toString$ = function toString_70(){
  var keyString;
  keyString = dynamicCast(this.element.attributes.get_4('name'), 1) == null?'':", key '" + dynamicCast(this.element.attributes.get_4('name'), 1) + "'";
  return 'Gadget child ' + this.type_0 + keyString + ", value '" + this.value_0 + "'";
}
;
_.castableTypeMap$ = {246:1};
_.element = null;
_.type_0 = null;
_.value_0 = '';
var typeMap_0;
function $clinit_1122(){
  $clinit_1122 = nullMethod;
  CATEGORIES = new GadgetElementChild$Type_0('CATEGORIES', 0, 'category');
  TITLE = new GadgetElementChild$Type_0('TITLE', 1, 'title');
  STATE = new GadgetElementChild$Type_0('STATE', 2, 'state');
  PREF = new GadgetElementChild$Type_0('PREF', 3, 'pref');
  UNKNOWN = new GadgetElementChild$Type_0('UNKNOWN', 4, '?');
  $VALUES_37 = initValues(_3Lorg_waveprotocol_wave_client_gadget_renderer_GadgetElementChild$Type_2_classLit, {9:1, 68:1, 170:1}, 114, [CATEGORIES, TITLE, STATE, PREF, UNKNOWN]);
}

function GadgetElementChild$Type_0(enum$name, enum$ordinal, tag){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
  this.tag = tag;
  ($clinit_1121() , typeMap_0).put_3(tag, this);
}

function valueOf_44(name_0){
  $clinit_1122();
  return valueOf_0(($clinit_1123() , $MAP_37), name_0);
}

function values_38(){
  $clinit_1122();
  return $VALUES_37;
}

function GadgetElementChild$Type(){
}

_ = GadgetElementChild$Type_0.prototype = GadgetElementChild$Type.prototype = new Enum;
_.getClass$ = function getClass_724(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetElementChild$Type_2_classLit;
}
;
_.toString$ = function toString_71(){
  return this.tag;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 114:1};
_.tag = null;
var $VALUES_37, CATEGORIES, PREF, STATE, TITLE, UNKNOWN;
function $clinit_1123(){
  $clinit_1123 = nullMethod;
  $MAP_37 = createValueOfMap(($clinit_1122() , $VALUES_37));
}

var $MAP_37;
function $getPreferredHeight(this$static, view){
  var v;
  v = dynamicCast(this$static.views.get_4(view), 245);
  if (!v) {
    return P0_longLit;
  }
  return v.preferredHeight.value_0;
}

function $getPreferredWidth(this$static, view){
  var v;
  v = dynamicCast(this$static.views.get_4(view), 245);
  if (!v) {
    return P0_longLit;
  }
  return v.preferredWidth.value_0;
}

function $parse(this$static, gadget){
  var gadgetViews, v, viewJson, viewName, viewName$iterator, bool, value_11, value_12;
  this$static.iframeUrl = getJsonStringValue(gadget, 'iframeUrl');
  this$static.iframeUrl != null && (this$static.iframeUrl = $replaceFirst(this$static.iframeUrl, '^//http[s]?://', '//'));
  getJsonStringValue(gadget, 'url');
  getJsonStringValue(gadget, 'moduleId');
  this$static.title_0 = getJsonStringValue(gadget, 'title');
  getJsonStringValue(gadget, 'titleUrl');
  getJsonStringValue(gadget, 'directoryTitle');
  getJsonStringValue(gadget, 'thumbnail');
  getJsonStringValue(gadget, 'screenshot');
  getJsonStringValue(gadget, 'author');
  getJsonStringValue(gadget, 'authorEmail');
  this$static.height_0 = getJsonLongValue(gadget, 'height');
  this$static.width_0 = getJsonLongValue(gadget, 'width');
  value_11 = $get_3(gadget, 'scrolling');
  bool = !value_11?null:value_11.isBoolean();
  bool?($clinit_428() , bool.value_0?TRUE_0:FALSE_0):null;
  !!$get_3(gadget, 'userPrefs') && $parseDefaultValues(this$static.userPrefs, $get_3(gadget, 'userPrefs').isObject());
  gadgetViews = (value_12 = $get_3(gadget, 'views') , value_12?value_12.isObject():null);
  if (gadgetViews) {
    for (viewName$iterator = new AbstractList$IteratorImpl_0(new Arrays$ArrayList_0($keySet(gadgetViews).val$keys)); viewName$iterator.i < viewName$iterator.this$0_0.size_1();) {
      viewName = dynamicCast($next_4(viewName$iterator), 1);
      viewJson = $get_3(gadgetViews, viewName).isObject();
      v = new GadgetMetadata$View_0;
      v.type_0 = viewName;
      v.preferredHeight = getJsonLongValue(viewJson, 'preferredHeight');
      v.preferredWidth = getJsonLongValue(viewJson, 'preferredWidth');
      this$static.views.put_3(v.type_0, v);
    }
  }
}

function GadgetMetadata_0(metadataJson){
  this.views = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  this.userPrefs = {};
  $parse(this, metadataJson);
}

function getJsonLongValue(json, key){
  var number, value;
  value = $get_3(json, key);
  number = !value?null:value.isNumber();
  return number?valueOf_14(fromDouble(Math.round(number.value_0))):null;
}

function getJsonStringValue(json, key){
  var string, value;
  value = $get_3(json, key);
  string = !value?null:value.isString();
  return string?string.value_0:null;
}

function GadgetMetadata(){
}

_ = GadgetMetadata_0.prototype = GadgetMetadata.prototype = new Object_0;
_.getClass$ = function getClass_725(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetMetadata_2_classLit;
}
;
_.castableTypeMap$ = {};
_.height_0 = null;
_.iframeUrl = null;
_.title_0 = null;
_.width_0 = null;
function GadgetMetadata$View_0(){
}

function GadgetMetadata$View(){
}

_ = GadgetMetadata$View_0.prototype = GadgetMetadata$View.prototype = new Object_0;
_.getClass$ = function getClass_726(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetMetadata$View_2_classLit;
}
;
_.castableTypeMap$ = {245:1};
_.preferredHeight = null;
_.preferredWidth = null;
_.type_0 = null;
function $clinit_1126(){
  $clinit_1126 = nullMethod;
  $clinit_1021();
  GADGET_WIDGET = new Property$ImmutableProperty_0('GadgetWidget');
  CURRENT_LOCALE = new SessionLocale_0;
}

function GadgetRenderer_0(waveletName, blip, supplement, profileManager, loginName){
  $clinit_1126();
  this.flow = ($clinit_1022() , USE_WIDGET);
  this.waveletName = waveletName;
  this.blip = blip;
  this.supplement = supplement;
  this.profileManager = profileManager;
  this.loginName = loginName;
}

function GadgetRenderer(){
}

_ = GadgetRenderer_0.prototype = GadgetRenderer.prototype = new GwtRenderingMutationHandler;
_.getClass$ = function getClass_727(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetRenderer_2_classLit;
}
;
_.onAttributeModified = function onAttributeModified_6(element, name_0, oldValue, newValue){
  $onAttributeModified_3(dynamicCast(element.transientData.get_0(GADGET_WIDGET.id_0), 214), name_0, newValue);
}
;
_.onChildAdded = function onChildAdded_4(element, child){
  $run_0(dynamicCast(element.transientData.get_0(GADGET_WIDGET.id_0), 214).childAddedTask, child);
}
;
_.onChildRemoved = function onChildRemoved_4(element, child){
  $run_0(dynamicCast(element.transientData.get_0(GADGET_WIDGET.id_0), 214).childRemovedTask, child);
}
;
_.onDescendantsMutated = function onDescendantsMutated_3(element){
  $onDescendantsMutated_0(dynamicCast(element.transientData.get_0(GADGET_WIDGET.id_0), 214));
}
;
_.onRemovedFromParent = function onRemovedFromParent_4(element, newParent){
  !newParent && $setInactive(dynamicCast(element.transientData.get_0(GADGET_WIDGET.id_0), 214));
}
;
_.castableTypeMap$ = {212:1, 215:1, 217:1};
_.blip = null;
_.loginName = null;
_.profileManager = null;
_.supplement = null;
_.waveletName = null;
var CURRENT_LOCALE, GADGET_WIDGET;
function $parse_0(this$static, state){
  !!state && $checkKeyValue(state, new StateMap$5_0(new GadgetUserPrefs$1_0(this$static)));
}

function $parseDefaultValues(this$static, prefs){
  var pref, pref$iterator, prefJson, value;
  if (prefs) {
    for (pref$iterator = new AbstractList$IteratorImpl_0(new Arrays$ArrayList_0($keySet(prefs).val$keys)); pref$iterator.i < pref$iterator.this$0_0.size_1();) {
      pref = dynamicCast($next_4(pref$iterator), 1);
      if (!this$static.hasOwnProperty(':' + pref)) {
        prefJson = $get_3(prefs, pref).isObject();
        if (prefJson) {
          value = $get_3(prefJson, 'default');
          if (!!value && !!value.isString()) {
            this$static[':' + pref] = value.isString().value_0;
            $clinit_1086();
            $log_0(LOG_3.traceLogger, "Gadget pref '" + pref + "' = '" + this$static[':' + pref] + "'");
          }
        }
         else {
          $clinit_1086();
          $log_0(LOG_3.traceLogger, "Invalid pref '" + pref + "' value in Gadget metadata.");
        }
      }
    }
  }
}

function $setPref(this$static, pref, value, overwrite){
  (overwrite || this$static.hasOwnProperty(':' + pref)) && (this$static[':' + pref] = value , undefined);
}

function GadgetUserPrefs$1_0(this$0){
  this.this$0 = this$0;
  this.val$overwrite = true;
}

function GadgetUserPrefs$1(){
}

_ = GadgetUserPrefs$1_0.prototype = GadgetUserPrefs$1.prototype = new Object_0;
_.apply_10 = function apply_52(key, value){
  $setPref(this.this$0, key, value, this.val$overwrite);
}
;
_.getClass$ = function getClass_728(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetUserPrefs$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$overwrite = false;
function ObservableSupplementedWave$ListenerImpl(){
}

_ = ObservableSupplementedWave$ListenerImpl.prototype = new Object_0;
_.getClass$ = function getClass_729(){
  return Lorg_waveprotocol_wave_model_supplement_ObservableSupplementedWave$ListenerImpl_2_classLit;
}
;
_.onFolderAdded = function onFolderAdded(newFolder){
}
;
_.onMaybeBlipReadChanged = function onMaybeBlipReadChanged(blip){
}
;
_.onMaybeFollowStateChanged = function onMaybeFollowStateChanged(){
}
;
_.onMaybeGadgetStateChanged = function onMaybeGadgetStateChanged(gadgetId){
}
;
_.onMaybeInboxStateChanged = function onMaybeInboxStateChanged(){
}
;
_.onMaybeParticipantsReadChanged = function onMaybeParticipantsReadChanged(wavelet){
}
;
_.onMaybeTagsReadChanged = function onMaybeTagsReadChanged(wavelet){
}
;
_.onMaybeWaveletReadChanged = function onMaybeWaveletReadChanged(){
}
;
_.onThreadStateChanged = function onThreadStateChanged(thread){
}
;
_.onWantedEvaluationsChanged = function onWantedEvaluationsChanged(waveletId){
}
;
_.castableTypeMap$ = {264:1};
function $allowModificationOfNewlyCreatedGadget(this$static){
  if (!$hasAttribute_1(this$static, 'height') && $isEditing(this$static.editingIndicator)) {
    $clinit_1197();
    $schedule_2(scheduler_0, ($clinit_1200() , LOW), new GadgetWidget$15_0(this$static));
    $onModifyingDocument(this$static);
  }
}

function $attributeToState(this$static, attribute){
  var result, regexp, regexp_0;
  result = {};
  if (attribute != null && !$equals_3(attribute, '')) {
    $log(this$static, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Unescaped attribute: ', (throwIfNull('encodedURLComponent', attribute) , regexp = /\+/g , decodeURIComponent(attribute.replace(regexp, '%20')))]));
    $fromJson(result, (throwIfNull('encodedURLComponent', attribute) , regexp_0 = /\+/g , decodeURIComponent(attribute.replace(regexp_0, '%20'))));
    $log(this$static, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['State map: ', $toJson(result)]));
  }
  return result;
}

function $buildIframeUrl(this$static, instanceId, url){
  var builder, fragment, fragmentIndex, href, split, matchObj, split_0, matchObj_0;
  builder = new StringBuilder_0;
  fragment = '';
  fragmentIndex = url.indexOf('#');
  if (fragmentIndex >= 0) {
    fragment = url.substr(fragmentIndex + 1, url.length - (fragmentIndex + 1));
    url = url.substr(0, fragmentIndex - 0);
  }
  builder.impl.string += url;
  builder.impl.string += '&nocache=1';
  builder.impl.string += '&mid=' + instanceId;
  $append_11(builder, '&lang=' + (split = $split(this$static.locale.localeString, '[_-]', 3) , split.length > 0 && (matchObj = (new RegExp('[a-zA-Z]{1,8}')).exec(split[0]) , matchObj == null?false:split[0] == matchObj[0])?split[0]:'en'));
  $append_11(builder, '&country=' + (split_0 = $split(this$static.locale.localeString, '[_-]', 3) , split_0.length > 1 && (matchObj_0 = (new RegExp('[a-zA-Z0-9]{1,8}')).exec(split_0[1]) , matchObj_0 == null?false:split_0[1] == matchObj_0[0])?split_0[1]:'ALL'));
  href = $wnd.location.protocol + '//' + $wnd.location.host;
  $append_11(builder, '&parent=' + (throwIfNull('decodedURL', href) , encodeURI(href)));
  builder.impl.string += '&wave=1';
  $append_11(builder, '&waveId=' + encodeQueryString($serialiseWaveId(this$static.waveletName.waveId)));
  fragment = $updateGadgetUriFragment(this$static, fragment);
  if (fragment.length) {
    builder.impl.string += '#' + fragment;
    ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Appended fragment: ', fragment]))) , undefined);
  }
  !!this$static.userPrefs && $checkKeyValue(this$static.userPrefs, new StateMap$5_0(new GadgetWidget$7_0(builder)));
  return builder.impl.string;
}

function $constructGadgetFromMetadata(this$static, metadata, view){
  var url;
  $log(this$static, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Received metadata: ', metadata.iframeUrl]));
  url = cleanUrl(metadata.iframeUrl);
  if ($equals_3(url, this$static.iframeUrl)) {
    ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Received metadata matches the cached information.']))) , undefined);
    $constructGadgetSizeFromMetadata(this$static, metadata, view, url);
    return;
  }
  this$static.active && this$static.documentModified?($clinit_1197() , $schedule_2(scheduler_0, ($clinit_1200() , LOW), new GadgetWidget$8_0(this$static, 'ifr', url)) , undefined):(this$static.toUpdateIframeUrl = true);
  $equals_3('', $getTextOrHtml(this$static.ui.titleLabel.directionalTextHelper)) && metadata.title_0 != null && $setTitleLabelText(this$static.ui, metadata.title_0);
  $constructGadgetSizeFromMetadata(this$static, metadata, view, url);
}

function $constructGadgetSizeFromMetadata(this$static, metadata, view, url){
  var height, width;
  height = toInt(metadata.height_0?metadata.height_0.value_0:$getPreferredHeight(metadata, view));
  width = toInt(metadata.width_0?metadata.width_0.value_0:$getPreferredWidth(metadata, view));
  ($wnd.gadgets && $wnd.gadgets.rpc?true:false)?$controllerRegistration(this$static, url, fromInt(width), fromInt(height)):($scheduleRepeating_0(new GadgetWidget$9_0(this$static, url, fromInt(width), fromInt(height)), 250, 250) , undefined);
  height > 0?$setIframeHeight(this$static, '' + height):$setIframeHeight(this$static, '100');
  width > 0?$setIframeWidth(this$static, '' + width):$setIframeWidth(this$static, '600');
}

function $controllerRegistration(this$static, url, width, height){
  var controller, iframeHost, relayUrl, hub, hub_0;
  controller = (!instance_6 && (instance_6 = new Controller_0) , instance_6);
  iframeHost = getIframeHost(url);
  relayUrl = iframeHost + 'gadgets/files/container/rpc_relay.html';
  hub = controller.hub;
  hub.setRelayUrl('wgadget_iframe_' + this$static.clientInstanceId, relayUrl, false);
  controller.callbackMap.put_3('wgadget_iframe_' + this$static.clientInstanceId, this$static);
  hub_0 = controller.hub;
  hub_0.setAuthToken('wgadget_iframe_' + this$static.clientInstanceId, this$static.rpcToken);
  $updateGadgetIframe(this$static, url, width, height);
  $schedule_1(new GadgetWidget$14_0(this$static), 3000);
  $schedule_1(new GadgetWidget$13_0(this$static), 3000);
  $log(this$static, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Gadget ', 'wgadget_iframe_' + this$static.clientInstanceId, ' is registered, relayUrl=', relayUrl, ', RPC token=', this$static.rpcToken]));
}

function $createWidget(this$static){
  var cachedIframeUrl, conv, title, regexp;
  if (this$static.active) {
    ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Repeated attempt to create gadget widget.']))) , undefined);
    return;
  }
  this$static.active = true;
  $log(this$static, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Creating Gadget Widget ', 'wgadget_iframe_' + this$static.clientInstanceId]));
  this$static.ui.menuEnabled = true;
  $allowModificationOfNewlyCreatedGadget(this$static);
  $setSavedIframeHeight(this$static);
  $setSavedIframeWidth(this$static);
  this$static.source = this$static.element.attributes.containsKey_1('url')?dynamicCast(this$static.element.attributes.get_4('url'), 1):'';
  title = this$static.element.attributes.containsKey_1('title')?dynamicCast(this$static.element.attributes.get_4('title'), 1):'';
  $setTitleLabelText(this$static.ui, title == null?'':(throwIfNull('encodedURLComponent', title) , regexp = /\+/g , decodeURIComponent(title.replace(regexp, '%20'))));
  $updatePrefsFromAttribute(this$static, this$static.element.attributes.containsKey_1('prefs')?dynamicCast(this$static.element.attributes.get_4('prefs'), 1):'');
  $refreshParticipantInformation(this$static);
  conv = this$static.blip.helper.this$0;
  $add_31(conv.listeners, new WaveletListenerAdapter_0(this$static.blip, this$static));
  $log(this$static, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Requesting Gadget metadata: ', this$static.source]));
  cachedIframeUrl = this$static.element.attributes.containsKey_1('ifr')?dynamicCast(this$static.element.attributes.get_4('ifr'), 1):'';
  cachedIframeUrl != null && !!cachedIframeUrl.length && !!getIframeHost(cachedIframeUrl).length && $registerWithController(this$static, cleanUrl(cachedIframeUrl));
  !singleton_2 && (singleton_2 = new GadgetDataStoreImpl_0);
  $getGadgetData(singleton_2, this$static.source, this$static.waveletName, $getInstanceId(this$static), new GadgetWidget$16_0(this$static));
}

function $deleteGadget(this$static){
  this$static.active && $deleteNode(this$static.element.context.this$0.mutableContent, this$static.element);
}

function $deleteState(this$static, key){
  if (this$static.active) {
    ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Removing state ', key]))) , undefined);
    if (this$static.stateElements.containsKey_1(key)) {
      $onModifyingDocument(this$static);
      $deleteNode(this$static.element.context.this$0.mutableContent, dynamicCast(this$static.stateElements.get_4(key), 246).element);
    }
  }
   else {
    ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Unable to remove state ', key]))) , undefined);
  }
}

function $expandArgs(object, objects){
  var args;
  args = initDim(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, objects.length + 1, 0);
  setCheck(args, 0, object);
  arraycopy(objects, 0, args, 1, objects.length);
  return args;
}

function $generateAndSetGadgetId(this$static){
  var id, instanceDescriptor, name_0, prefix, time, version, time_0;
  if (!this$static.active) {
    return null;
  }
  id = (name_0 = $serialiseWaveletName(this$static.waveletName) , instanceDescriptor = name_0 + $getAuthor(this$static) + this$static.source , prefix = toPowerOfTwoString(getHashCode_0(instanceDescriptor)) , time = toPowerOfTwoString((time_0 = fromDouble((new Date_1).jsdate.getTime()) , toInt(xor(time_0, shru(time_0, 32))))) , version = toPowerOfTwoString_0(valueOf_14(this$static.blip.blip.blip.lastModifiedVersion).value_0) , prefix + time + version);
  $setElementAttribute(this$static.element.context.this$0.mutableContent, this$static.element, 'id', id);
  return id;
}

function $getAuthor(this$static){
  var author;
  author = dynamicCast(this$static.element.attributes.get_4('author'), 1);
  return author != null?author:this$static.blip.blip.blip.author.address;
}

function $getInstanceId(this$static){
  var hash, instanceDescriptor, name_0;
  name_0 = $serialiseWaveletName(this$static.waveletName);
  instanceDescriptor = name_0 + this$static.loginName + this$static.source;
  hash = getHashCode_0(instanceDescriptor);
  return hash < 0?~hash:hash;
}

function $getParticipantsForIds(list1, list2){
  var mergedMap, p, p$iterator;
  mergedMap = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  for (p$iterator = list1.iterator_0(); p$iterator.hasNext();) {
    p = dynamicCast(p$iterator.next_0(), 164);
    mergedMap.put_3(p.address, p);
  }
  for (p$iterator = list2.iterator_0(); p$iterator.hasNext();) {
    p = dynamicCast(p$iterator.next_0(), 164);
    mergedMap.put_3(p.address, p);
  }
  return mergedMap;
}

function $hasAttribute_1(this$static, name_0){
  var value;
  if (this$static.element.attributes.containsKey_1(name_0)) {
    value = dynamicCast(this$static.element.attributes.get_4(name_0), 1);
    if (!$equals_3('', value)) {
      return true;
    }
  }
  return false;
}

function $initializePodium(this$static){
  var $e0, myId, opponentId, participant, participant$iterator, podiumState;
  if (!this$static.active) {
    return;
  }
  for (participant$iterator = ($clinit_480() , new Collections$UnmodifiableSet_0(new Collections$UnmodifiableSet_0(this$static.blip.helper.this$0.wavelet.wavelet.participants))).iterator_0(); participant$iterator.hasNext();) {
    participant = dynamicCast(participant$iterator.next_0(), 164);
    myId = this$static.participants['myId'];
    if (myId != null && !$equals_3(participant.address, myId)) {
      opponentId = participant.address;
      try {
        $sendPodiumOnInitializedRpc('wgadget_iframe_' + this$static.clientInstanceId, myId, opponentId);
        ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Sent Podium initialization: ' + myId + ' ' + opponentId]))) , undefined);
        podiumState = this$static.state[':podiumState'];
        if (podiumState != null) {
          $sendPodiumOnStateChangedRpc('wgadget_iframe_' + this$static.clientInstanceId, podiumState);
          $shouldLog_0(LOG_3.traceLogger) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Sent Podium state update.']))) , undefined);
        }
      }
       catch ($e0) {
        $e0 = caught_0($e0);
        if (instanceOf($e0, 183)) {
          ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Podium initialization failure']))) , undefined);
        }
         else 
          throw $e0;
      }
      return;
    }
  }
  ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Podium is not initialized: less than two participants.']))) , undefined);
}

function $log(this$static, objects){
  ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, objects)) , undefined);
}

function $logFine(this$static, objects){
  ($clinit_1086() , $shouldLog_0(FINE_LOG.traceLogger)) && ($logLazyObjects(FINE_LOG.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, objects)) , undefined);
}

function $modifyState(this$static, key, value){
  if (this$static.active) {
    ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Modifying state ', key, ' ', value]))) , undefined);
    if (this$static.stateElements.containsKey_1(key)) {
      if (!$equals_3(dynamicCast(this$static.stateElements.get_4(key), 246).value_0, value)) {
        $onModifyingDocument(this$static);
        $setValue_4(dynamicCast(this$static.stateElements.get_4(key), 246), value);
      }
    }
     else {
      $onModifyingDocument(this$static);
      $insertXml(this$static.element.context.this$0.mutableContent, new Point$El_0(this$static.element, null), $wrap_3($appendText_0(new XmlStringBuilderDoc_0(null, ($clinit_2011() , ANY)), '', BLIP_TEXT), 'state', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['name', key, 'value', value])));
    }
  }
   else {
    ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Unable to modify state ', key, ' ', value]))) , undefined);
  }
}

function $onAttributeModified_3(this$static, name_0, value){
  var newState, podiumState, title, regexp;
  ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ["Attribute '", name_0, "' changed to '", value, "'"]))) , undefined);
  if (!this$static.userPrefs) {
    $shouldLog_0(LOG_3.traceLogger) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Attribute changed before the gadget is initialized.']))) , undefined);
    return;
  }
  if ($equals_3(name_0, 'url')) {
    this$static.source = value == null?'':value;
  }
   else if ($equals_3(name_0, 'title')) {
    title = value == null?'':(throwIfNull('encodedURLComponent', value) , regexp = /\+/g , decodeURIComponent(value.replace(regexp, '%20')));
    if (!$equals_3(title, $getTextOrHtml(this$static.ui.titleLabel.directionalTextHelper))) {
      $shouldLog_0(LOG_3.traceLogger) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Updating title: ', title]))) , undefined);
      $setTitleLabelText(this$static.ui, title);
    }
  }
   else if ($equals_3(name_0, 'prefs')) {
    $updatePrefsFromAttribute(this$static, value);
  }
   else if ($equals_3(name_0, 'state')) {
    newState = $attributeToState(this$static, value);
    if (!$compare_4(this$static.state, newState)) {
      podiumState = newState[':podiumState'];
      podiumState != null && !$equals_3(podiumState, this$static.state[':podiumState']) && $sendPodiumOnStateChangedRpc('wgadget_iframe_' + this$static.clientInstanceId, podiumState);
      $clear_18(this$static.state);
      $copyFrom(this$static.state, newState);
      $log(this$static, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Updating gadget state: ', $toJson(this$static.state)]));
      $submit_2(this$static.gadgetStateSubmitter);
    }
  }
}

function $onBlipContributorAdded(this$static, contributor){
  if (this$static.active) {
    ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Contributor added ', contributor]))) , undefined);
    $sendCurrentParticipantInformation(this$static);
  }
   else {
    ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Contributor added event in deleted node.']))) , undefined);
  }
}

function $onBlipContributorRemoved(this$static, contributor){
  if (this$static.active) {
    ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Contributor removed ', contributor]))) , undefined);
    $sendCurrentParticipantInformation(this$static);
  }
   else {
    ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Contributor removed event in deleted node.']))) , undefined);
  }
}

function $onDescendantsMutated_0(this$static){
  ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Descendants mutated.']))) , undefined);
  $clinit_1197();
  $schedule_2(scheduler_0, ($clinit_1200() , LOW), this$static.schedulableMutationTask);
}

function $onModifyingDocument(this$static){
  this$static.documentModified = true;
  if (this$static.toUpdateIframeUrl) {
    $clinit_1197();
    $schedule_2(scheduler_0, ($clinit_1200() , LOW), new GadgetWidget$8_0(this$static, 'ifr', this$static.iframeUrl));
    this$static.toUpdateIframeUrl = false;
  }
}

function $onParticipantAdded(this$static, participant){
  if (this$static.active) {
    ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Participant added ', participant]))) , undefined);
    $sendCurrentParticipantInformation(this$static);
  }
   else {
    ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Participant added event in deleted node.']))) , undefined);
  }
}

function $processChild(this$static, child){
  var newTitleValue;
  if (!child) {
    return;
  }
  ($clinit_1086() , $shouldLog_0(FINE_LOG.traceLogger)) && ($logLazyObjects(FINE_LOG.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Processing: ', child]))) , undefined);
  switch (child.type_0.ordinal) {
    case 2:
      $updateElementMaps(this$static, child, this$static.stateElements, this$static.state);
      break;
    case 3:
      $updateElementMaps(this$static, child, this$static.prefElements, this$static.userPrefs);
      break;
    case 1:
      this$static.titleElement = child;
      newTitleValue = child.value_0;
      newTitleValue == null && (newTitleValue = '');
      $equals_3(newTitleValue, $getTextOrHtml(this$static.ui.titleLabel.directionalTextHelper)) || $setTitleLabelText(this$static.ui, newTitleValue);
      break;
    case 0:
      $shouldLog_0(FINE_LOG.traceLogger) && ($logLazyObjects(FINE_LOG.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Categories element ignored.']))) , undefined);
      break;
    default:$logFine(this$static, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Unexpected gadget node ', child.element.tagName_0]));
  }
}

function $refreshParticipantInformation(this$static){
  var builder, participant, participant$iterator, participantList, viewerId, waveletParticipants;
  waveletParticipants = $getParticipantsForIds(($clinit_480() , new Collections$UnmodifiableSet_0(new Collections$UnmodifiableSet_0(this$static.blip.helper.this$0.wavelet.wavelet.participants))), new Collections$UnmodifiableSet_0(this$static.blip.blip.blip.contributors));
  viewerId = new ParticipantId_0(this$static.loginName);
  waveletParticipants.put_3(viewerId.address, viewerId);
  participantList = ($clinit_2309() , copyValuesToJavaCollection(waveletParticipants, new ArrayList_0));
  this$static.participants = create_25(viewerId.address, $getAuthor(this$static), participantList, $wnd.location.protocol + '//' + $wnd.location.host, this$static.profileManager);
  builder = new StringBuilder_0;
  builder.impl.string += 'Participants: ';
  $append_11(builder, 'I am ' + this$static.participants['myId']);
  for (participant$iterator = new AbstractList$IteratorImpl_0(participantList); participant$iterator.i < participant$iterator.this$0_0.size_1();) {
    participant = dynamicCast($next_4(participant$iterator), 164);
    builder.impl.string += '; ' + participant;
  }
  $log(this$static, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [builder.impl.string]));
}

function $registerWithController(this$static, url){
  ($wnd.gadgets && $wnd.gadgets.rpc?true:false)?$controllerRegistration(this$static, url, P0_longLit, P0_longLit):($scheduleRepeating_0(new GadgetWidget$9_0(this$static, url, P0_longLit, P0_longLit), 250, 250) , undefined);
}

function $removeChildFromMaps(this$static, child, childMap, stateMap){
  var key;
  key = dynamicCast(child.element.attributes.get_4('name'), 1);
  if (childMap.containsKey_1(key)) {
    stateMap.hasOwnProperty(':' + key) && (delete stateMap[':' + key] , undefined);
    childMap.remove_8(key);
    ($clinit_1086() , $shouldLog_0(FINE_LOG.traceLogger)) && ($logLazyObjects(FINE_LOG.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Removed element ', key]))) , undefined);
  }
}

function $removeRedundantNodes(this$static, child){
  if (!this$static.documentModified || !child) {
    return;
  }
  if (!this$static.redundantNodeCheckChild) {
    this$static.redundantNodeCheckChild = child;
    $clinit_1197();
    $schedule_2(scheduler_0, ($clinit_1200() , LOW), this$static.removeRedundantNodesTask);
  }
   else {
    ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Overlapping redundant node check requests.']))) , undefined);
  }
}

function $requestNavigateTo(this$static, url){
  var newFragment, matchObj;
  ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Requested navigate to: ', url]))) , undefined);
  newFragment = $replaceFirst(url, '[^#]*#', '');
  (matchObj = (new RegExp("([\\w~!&@\\$\\-\\.\\'\\(\\)\\*\\+\\,\\;\\=\\?\\:]|%[0-9a-fA-F]{2})+")).exec(newFragment) , matchObj == null?false:newFragment == matchObj[0])?replace_0($replaceFirst($wnd.location.href, '#.*', '') + '#' + newFragment):$shouldLog_0(LOG_3.traceLogger) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Navigate request denied.']))) , undefined);
}

function $rescanGadgetXmlElements(this$static){
  var childNode;
  ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Rescanning elements']))) , undefined);
  childNode = this$static.element.firstChild_0;
  while (childNode) {
    $processChild(this$static, create_24(childNode));
    childNode = childNode.next;
  }
}

function $resetGadget(this$static){
  var gadgetId;
  if (this$static.active) {
    $checkKeyValue(this$static.state, new StateMap$5_0(new GadgetWidget$22_0(this$static)));
    $submit_2(this$static.gadgetStateSubmitter);
    gadgetId = dynamicCast(this$static.element.attributes.get_4('id'), 1);
    if (gadgetId != null) {
      this$static.supplement.delegate.getGadgetState(gadgetId).each_2(new GadgetWidget$23_0(this$static, gadgetId));
      $submit_2(this$static.privateGadgetStateSubmitter);
    }
  }
}

function $selectGadget(this$static){
  var doc;
  if (this$static.active) {
    doc = this$static.element.context.this$0.mutableContent;
    $setSelectionPoints(this$static.element.context.this$0.editingConcerns.getSelectionHelper(), before_0(doc, this$static.element), after_1(doc, this$static.element));
  }
}

function $sendCurrentParticipantInformation(this$static){
  if (this$static.waveEnabled) {
    $refreshParticipantInformation(this$static);
    $sendParticipantsRpc('wgadget_iframe_' + this$static.clientInstanceId, this$static.participants);
    $log(this$static, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Sent participants: ', this$static.participants]));
  }
}

function $sendGadgetPrefRpc(target, name_0, value){
  try {
    $wnd.gadgets.rpc.call(target, 'set_pref', null, 0, name_0, value);
  }
   catch (e) {
    $clinit_1086();
    $log_0(LOG_3.traceLogger, 'set_pref RPC failed');
  }
}

function $sendGadgetState(this$static){
  var jso;
  if (this$static.waveEnabled) {
    $log(this$static, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Sending gadget state: ', $toJson(this$static.state)]));
    $sendGadgetStateRpc('wgadget_iframe_' + this$static.clientInstanceId, (jso = {} , $checkKeyValue(this$static.state, new StateMap$5_0(new StateMap$9_0(jso))) , jso));
  }
}

function $sendGadgetStateRpc(target, state){
  try {
    $wnd.gadgets.rpc.call(target, 'wave_gadget_state', null, state);
  }
   catch (e) {
    $clinit_1086();
    $log_0(LOG_3.traceLogger, 'wave_gadget_state RPC failed');
  }
}

function $sendMode(this$static){
  var mode, jso;
  if (this$static.waveEnabled) {
    mode = {};
    mode[':${playback}'] = '0';
    mode[':${edit}'] = $isEditing(this$static.editingIndicator)?'1':'0';
    $log(this$static, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Sending gadget mode: ', $toJson(mode)]));
    $sendModeRpc('wgadget_iframe_' + this$static.clientInstanceId, (jso = {} , $checkKeyValue(mode, new StateMap$5_0(new StateMap$9_0(jso))) , jso));
  }
}

function $sendModeRpc(target, mode){
  try {
    $wnd.gadgets.rpc.call(target, 'wave_gadget_mode', null, mode);
  }
   catch (e) {
    $clinit_1086();
    $log_0(LOG_3.traceLogger, 'wave_gadget_mode RPC failed');
  }
}

function $sendParticipantsRpc(target, participants){
  try {
    $wnd.gadgets.rpc.call(target, 'wave_participants', null, participants);
  }
   catch (e) {
    $clinit_1086();
    $log_0(LOG_3.traceLogger, 'wave_participants RPC failed');
  }
}

function $sendPodiumOnInitializedRpc(target, id, otherId){
  try {
    $wnd.gadgets.rpc.call(target, 'onInitialized', null, id, otherId);
  }
   catch (e) {
    $clinit_1086();
    $log_0(LOG_3.traceLogger, 'onInitialized RPC failed');
  }
}

function $sendPodiumOnStateChangedRpc(target, state){
  try {
    $wnd.gadgets.rpc.call(target, 'onStateChanged', null, state);
  }
   catch (e) {
    $clinit_1086();
    $log_0(LOG_3.traceLogger, 'onStateChanged RPC failed');
  }
}

function $sendPrivateGadgetState(this$static){
  var gadgetId, privateState, stateMap, jso;
  if (this$static.waveEnabled) {
    gadgetId = dynamicCast(this$static.element.attributes.get_4('id'), 1);
    privateState = (stateMap = {} , (gadgetId != null?this$static.supplement.delegate.getGadgetState(gadgetId):($clinit_2309() , $clinit_2309() , EMPTY_MAP_2)).each_2(new StateMap$1_0(stateMap)) , stateMap);
    $log(this$static, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Sending private gadget state: ', $toJson(privateState)]));
    $sendPrivateGadgetStateRpc('wgadget_iframe_' + this$static.clientInstanceId, (jso = {} , $checkKeyValue(privateState, new StateMap$5_0(new StateMap$9_0(jso))) , jso));
  }
}

function $sendPrivateGadgetStateRpc(target, state){
  try {
    $wnd.gadgets.rpc.call(target, 'wave_private_gadget_state', null, state);
  }
   catch (e) {
    $clinit_1086();
    $log_0(LOG_3.traceLogger, 'wave_private_gadget_state RPC failed');
  }
}

function $setIframeHeight(this$static, height){
  var $e0, heightValue;
  if (!this$static.active) {
    return;
  }
  ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Set IFrame height ', height]))) , undefined);
  try {
    heightValue = height.lastIndexOf('px') != -1 && height.lastIndexOf('px') == height.length - 'px'.length?__parseAndValidateInt(height.substr(0, height.length - 2 - 0), 10):__parseAndValidateInt(height, 10);
    $setIframeHeight_0(this$static.ui, fromInt(heightValue));
    $clinit_1197();
    $schedule_2(scheduler_0, ($clinit_1200() , LOW), new GadgetWidget$8_0(this$static, 'height', '' + toString_14(fromInt(heightValue))));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 188)) {
      $shouldLog_0(LOG_3.traceLogger) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Invalid height (ignored): ', height]))) , undefined);
    }
     else 
      throw $e0;
  }
}

function $setIframeWidth(this$static, width){
  var $e0, widthValue;
  if (!this$static.active) {
    return;
  }
  ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Set IFrame width ', width]))) , undefined);
  try {
    widthValue = width.lastIndexOf('px') != -1 && width.lastIndexOf('px') == width.length - 'px'.length?__parseAndValidateInt(width.substr(0, width.length - 2 - 0), 10):__parseAndValidateInt(width, 10);
    $setIframeWidth_0(this$static.ui, widthValue + 'px');
    setStyleName_0(this$static.ui.enclosingBox.element, 'C-AI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-inline', true);
    $clinit_1197();
    $schedule_2(scheduler_0, ($clinit_1200() , LOW), new GadgetWidget$8_0(this$static, 'width', '' + toString_14(fromInt(widthValue))));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 188)) {
      $shouldLog_0(LOG_3.traceLogger) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Invalid width (ignored): ', width]))) , undefined);
    }
     else 
      throw $e0;
  }
}

function $setInactive(this$static){
  ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Gadget node removed.']))) , undefined);
  $removeListener_2(this$static.supplement, this$static);
  this$static.active = false;
}

function $setPref_0(this$static, key, value){
  if (!this$static.active || key == null || value == null) {
    return;
  }
  this$static.userPrefs[':' + key] = value;
  if (this$static.prefElements.containsKey_1(key)) {
    if (!$equals_3(dynamicCast(this$static.prefElements.get_4(key), 246).value_0, value)) {
      ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ["Updating preference '", key, "'='", value, "'"]))) , undefined);
      $onModifyingDocument(this$static);
      $setValue_4(dynamicCast(this$static.prefElements.get_4(key), 246), value);
      $submit_2(this$static.blipSubmitter);
    }
  }
   else {
    ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ["New preference '", key, "'='", value, "'"]))) , undefined);
    $onModifyingDocument(this$static);
    $insertXml(this$static.element.context.this$0.mutableContent, new Point$El_0(this$static.element, null), $wrap_3($appendText_0(new XmlStringBuilderDoc_0(null, ($clinit_2011() , ANY)), '', BLIP_TEXT), 'pref', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['name', key, 'value', value])));
    $submit_2(this$static.blipSubmitter);
  }
}

function $setPrefs(this$static, keyValue){
  var i;
  if (!this$static.active) {
    return;
  }
  for (i = 0; i < keyValue.length - 1; i += 2) {
    $setPref_0(this$static, keyValue[i], keyValue[i + 1]);
  }
}

function $setSavedIframeHeight(this$static){
  var $e0, height, savedHeight;
  if ($hasAttribute_1(this$static, 'height')) {
    savedHeight = dynamicCast(this$static.element.attributes.get_4('height'), 1);
    try {
      height = savedHeight.lastIndexOf('px') != -1 && savedHeight.lastIndexOf('px') == savedHeight.length - 'px'.length?__parseAndValidateInt(savedHeight.substr(0, savedHeight.length - 2 - 0), 10):__parseAndValidateInt(savedHeight, 10);
      $setIframeHeight_0(this$static.ui, fromInt(height));
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 188)) {
        ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Invalid saved height attribute (ignored): ', savedHeight]))) , undefined);
      }
       else 
        throw $e0;
    }
  }
}

function $setSavedIframeWidth(this$static){
  var $e0, savedWidth, width;
  if ($hasAttribute_1(this$static, 'width')) {
    savedWidth = dynamicCast(this$static.element.attributes.get_4('width'), 1);
    try {
      width = savedWidth.lastIndexOf('px') != -1 && savedWidth.lastIndexOf('px') == savedWidth.length - 'px'.length?__parseAndValidateInt(savedWidth.substr(0, savedWidth.length - 2 - 0), 10):__parseAndValidateInt(savedWidth, 10);
      $setIframeWidth_0(this$static.ui, width + 'px');
      setStyleName_0(this$static.ui.enclosingBox.element, 'C-AI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-inline', true);
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 188)) {
        ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Invalid saved width attribute (ignored): ', savedWidth]))) , undefined);
      }
       else 
        throw $e0;
    }
  }
}

function $setSnippet(this$static, snippet){
  var safeSnippet;
  if (!this$static.active) {
    return;
  }
  safeSnippet = $replaceAll(snippet, '[<>\\"\\\'\\&]', ' ');
  ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Snippet changed: ' + safeSnippet]))) , undefined);
  $clinit_1197();
  $schedule_2(scheduler_0, ($clinit_1200() , LOW), new GadgetWidget$8_0(this$static, 'snippet', safeSnippet));
}

function $setTitle_0(this$static, title){
  var newTitle;
  if (!this$static.active) {
    return;
  }
  newTitle = title == null?'':title;
  $log(this$static, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ["Set title '", $appendText_0(new XmlStringBuilderDoc_0(null, ($clinit_2011() , ANY)), newTitle, BLIP_TEXT), "'"]));
  if (!this$static.titleElement) {
    $onModifyingDocument(this$static);
    create_24(dynamicCast($insertXml(this$static.element.context.this$0.mutableContent, new Point$El_0(this$static.element, null), $wrap_3($appendText_0(new XmlStringBuilderDoc_0(null, ANY), '', BLIP_TEXT), 'title', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['value', newTitle]))), 197));
    $submit_2(this$static.blipSubmitter);
  }
   else {
    if (!$equals_3(title, this$static.titleElement.value_0)) {
      $onModifyingDocument(this$static);
      $setValue_4(this$static.titleElement, newTitle);
      $submit_2(this$static.blipSubmitter);
    }
  }
}

function $showBrokenGadget(this$static, message){
  $showBrokenGadget_0(this$static.ui);
  ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Broken gadget: ', message]))) , undefined);
}

function $updateElementMaps(this$static, child, childMap, stateMap){
  if (dynamicCast(child.element.attributes.get_4('name'), 1) == null) {
    ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Missing key attribute: element ignored.']))) , undefined);
    return;
  }
  childMap.containsKey_1(dynamicCast(child.element.attributes.get_4('name'), 1)) && $logFine(this$static, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Old value: ', childMap.get_4(dynamicCast(child.element.attributes.get_4('name'), 1))]));
  childMap.put_3(dynamicCast(child.element.attributes.get_4('name'), 1), child);
  stateMap[':' + dynamicCast(child.element.attributes.get_4('name'), 1)] = child.value_0;
  $logFine(this$static, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Updated element ', dynamicCast(child.element.attributes.get_4('name'), 1), ' : ', child.value_0]));
}

function $updateGadgetIframe(this$static, url, width, height){
  var ifr;
  if (!this$static.active) {
    return;
  }
  this$static.iframeUrl = url;
  if ($hasAttribute_1(this$static, 'width')) {
    $setSavedIframeWidth(this$static);
  }
   else if (neq(width, P0_longLit)) {
    $setIframeWidth_0(this$static.ui, toString_14(width) + 'px');
    setStyleName_0(this$static.ui.enclosingBox.element, 'C-AI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-inline', true);
    $clinit_1197();
    $schedule_2(scheduler_0, ($clinit_1200() , LOW), new GadgetWidget$8_0(this$static, 'width', '' + toString_14(width)));
  }
  if (!$hasAttribute_1(this$static, 'height') && neq(height, P0_longLit)) {
    $setIframeHeight_0(this$static.ui, height);
    $clinit_1197();
    $schedule_2(scheduler_0, ($clinit_1200() , LOW), new GadgetWidget$8_0(this$static, 'height', '' + toString_14(height)));
  }
  ifr = $buildIframeUrl(this$static, $getInstanceId(this$static), url);
  ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['ifr: ', ifr]))) , undefined);
  $setIframeSource(this$static.ui, ifr);
}

function $updateGadgetUriFragment(this$static, fragment){
  fragment = 'rpctoken=' + this$static.rpcToken + (!fragment.length || fragment.charCodeAt(0) == 38?'':'&') + fragment;
  return fragment;
}

function $updatePodiumState(this$static, podiumState){
  if (this$static.active) {
    $modifyState(this$static, 'podiumState', podiumState);
    $submit_2(this$static.blipSubmitter);
  }
}

function $updatePrefsFromAttribute(this$static, prefAttribute){
  var prefState;
  if (!$equals_3(stateToAttribute(this$static.userPrefs), prefAttribute)) {
    prefState = $attributeToState(this$static, prefAttribute);
    $parse_0(this$static.userPrefs, prefState);
    $log(this$static, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Updating user prefs: ', $toJson(this$static.userPrefs)]));
    $checkKeyValue(prefState, new StateMap$5_0(new GadgetWidget$6_0(this$static)));
  }
}

function $waveEnable(this$static, waveApiVersion){
  if (!this$static.active) {
    return;
  }
  this$static.waveEnabled = true;
  ($clinit_1086() , $shouldLog_0(LOG_3.traceLogger)) && ($logLazyObjects(LOG_3.traceLogger, $expandArgs(this$static.clientInstanceLogLabel, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Wave-enabled gadget registered with API version ', waveApiVersion]))) , undefined);
  $sendMode(this$static);
  $sendCurrentParticipantInformation(this$static);
  $submitImmediately(this$static.gadgetStateSubmitter);
  $submitImmediately(this$static.privateGadgetStateSubmitter);
  $schedule_1(new GadgetWidget$21_0(this$static), 5000);
  $scheduleRepeating_0(new GadgetWidget$18_0(this$static), 200, 200);
}

function $waveGadgetStateUpdate(this$static, delta){
  var deltaState;
  if (!this$static.active) {
    return;
  }
  deltaState = {};
  copyJson(delta, deltaState);
  $clinit_1197();
  $schedule_2(scheduler_0, ($clinit_1200() , LOW), new GadgetWidget$19_0(this$static, deltaState, delta));
}

function $wavePrivateGadgetStateUpdate(this$static, delta){
  var deltaState, gadgetId, id;
  if (!this$static.active) {
    return;
  }
  deltaState = {};
  copyJson(delta, deltaState);
  gadgetId = (id = dynamicCast(this$static.element.attributes.get_4('id'), 1) , (id == null || !id.length) && (id = $generateAndSetGadgetId(this$static)) , id);
  if (gadgetId != null) {
    $checkKeyValue(deltaState, new StateMap$5_0(new GadgetWidget$20_0(this$static, gadgetId)));
    $log(this$static, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Applied private delta ', $toJson(deltaState)]));
    $submitIfScheduled(this$static.privateGadgetStateSubmitter);
  }
   else {
    $log(this$static, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Unable to get gadget ID to update private state. Delta ', $toJson(deltaState)]));
  }
}

function GadgetWidget_0(){
  this.removeRedundantNodesTask = new GadgetWidget$1_0(this);
  this.childAddedTask = new GadgetWidget$2_0(this);
  this.childRemovedTask = new GadgetWidget$3_0(this);
  this.descendantsMutatedTask = new GadgetWidget$4_0(this);
  this.schedulableMutationTask = new GadgetWidget$5_0(this);
  this.clientInstanceId = nextClientInstanceId++;
  this.clientInstanceLogLabel = '[' + this.clientInstanceId + ']';
  this.prefElements = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  this.stateElements = defaultCollectionFactory.createStringMap();
  this.rpcToken = '' + toString_14(or(shl(valueOf_14(fromInt(nextInt())).value_0, 32), and(valueOf_14(fromInt(nextInt())).value_0, Pffffffff_longLit)));
}

function cleanUrl(url){
  var baseUrl, fragment, fragmentIndex;
  baseUrl = url;
  fragment = '';
  fragmentIndex = url.indexOf('#');
  if (fragmentIndex >= 0) {
    fragment = $replaceAll(url.substr(fragmentIndex + 1, url.length - (fragmentIndex + 1)), '(^|&)(rpctoken=|st=|up_)[^&]*', '');
    fragment.indexOf('&') == 0 && (fragment = fragment.substr(1, fragment.length - 1));
    baseUrl = url.substr(0, fragmentIndex - 0);
  }
  baseUrl = $replaceAll(baseUrl, '&(mid=|st=|lang=|country=|debug=)[^&]*', '');
  return baseUrl + (!fragment.length?'':'#' + fragment);
}

function createGadgetWidget(element, waveletName, blip, supplement, profileManager, locale, loginName){
  var widget;
  widget = new GadgetWidget_0;
  widget.element = element;
  widget.editingIndicator = new GadgetWidget$BlipEditingIndicator_0(dynamicCast(element.context.this$0.renderingConcerns.this$0.renderedContentView.inner_0.getDocumentElement(), 196));
  widget.ui = new GadgetWidgetUi_0('wgadget_iframe_' + widget.clientInstanceId, widget.editingIndicator);
  widget.state = {};
  initializeGadgets();
  widget.blip = blip;
  widget.userPrefs = {};
  widget.blipSubmitter = new Submitter_0(new GadgetWidget$10_0(widget));
  widget.gadgetStateSubmitter = new Submitter_0(new GadgetWidget$11_0(widget));
  widget.privateGadgetStateSubmitter = new Submitter_0(new GadgetWidget$12_0(widget));
  widget.ui.listener = widget;
  widget.waveletName = waveletName;
  widget.supplement = supplement;
  widget.profileManager = profileManager;
  widget.locale = locale;
  widget.loginName = loginName;
  dynamicCast(supplement.delegate, 263).addListener(widget);
  return widget;
}

function findNextChildCopy(child, node){
  var gadgetChild;
  if (!child) {
    return null;
  }
  while (node) {
    gadgetChild = create_24(node);
    if ($isDuplicate(child, gadgetChild)) {
      return gadgetChild;
    }
    node = node.next;
  }
  return null;
}

function getIframeHost(url){
  var iframeHostMatcher;
  iframeHostMatcher = $replaceFirst(url, '^\\/\\/(https?:\\/\\/)?[^\\/]+\\/', '');
  return iframeHostMatcher.length != url.length?url.substr(0, url.length - iframeHostMatcher.length - 0):'';
}

function initializeGadgets(){
  var script;
  if (!initialized && !($wnd.gadgets && $wnd.gadgets.rpc?true:false)) {
    $clinit_1086();
    $log_0(LOG_3.traceLogger, 'Initializing Gadget RPC script tag.');
    script = $doc.createElement('script');
    script.type = 'text/javascript';
    script.src = '/gadgets/js/core:rpc.js';
    $doc.body.appendChild(script);
    initialized = true;
    $log_0(LOG_3.traceLogger, 'Gadgets RPC script tag initialized.');
  }
  !initialized && !($wnd.gadgets && $wnd.gadgets.rpc?true:false) && (css() , undefined);
}

function stateToAttribute(state){
  var regexp;
  if (!state) {
    return throwIfNull('decodedURLComponent', '{}') , regexp = /%20/g , encodeURIComponent('{}').replace(regexp, '+');
  }
  return encodeComponent($toJson(state));
}

function GadgetWidget(){
}

_ = GadgetWidget_0.prototype = GadgetWidget.prototype = new ObservableSupplementedWave$ListenerImpl;
_.getClass$ = function getClass_730(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget_2_classLit;
}
;
_.onMaybeGadgetStateChanged = function onMaybeGadgetStateChanged_0(gadgetId){
  var myId;
  if (gadgetId != null) {
    myId = dynamicCast(this.element.attributes.get_4('id'), 1);
    $equals_3(gadgetId, myId) && $submitImmediately(this.privateGadgetStateSubmitter);
  }
}
;
_.castableTypeMap$ = {214:1, 241:1, 264:1};
_.active = false;
_.blip = null;
_.blipSubmitter = null;
_.clientInstanceId = 0;
_.clientInstanceLogLabel = null;
_.documentModified = false;
_.editingIndicator = null;
_.element = null;
_.gadgetStateSubmitter = null;
_.iframeUrl = null;
_.locale = null;
_.loginName = null;
_.participants = null;
_.prefElements = null;
_.privateGadgetStateSubmitter = null;
_.profileManager = null;
_.redundantNodeCheckChild = null;
_.rpcToken = null;
_.source = null;
_.state = null;
_.stateElements = null;
_.supplement = null;
_.titleElement = null;
_.toUpdateIframeUrl = false;
_.ui = null;
_.userPrefs = null;
_.waveEnabled = false;
_.waveletName = null;
var initialized = false, nextClientInstanceId = 0;
function GadgetWidget$1_0(this$0){
  this.this$0 = this$0;
}

function GadgetWidget$1(){
}

_ = GadgetWidget$1_0.prototype = GadgetWidget$1.prototype = new Object_0;
_.execute_0 = function execute_36(){
  var firstMatchingNode, lastSeenNode;
  if (!this.this$0.active) {
    return;
  }
  if (this.this$0.redundantNodeCheckChild) {
    firstMatchingNode = findNextChildCopy(this.this$0.redundantNodeCheckChild, this.this$0.element.firstChild_0);
    lastSeenNode = firstMatchingNode;
    while (lastSeenNode) {
      lastSeenNode = findNextChildCopy(this.this$0.redundantNodeCheckChild, firstMatchingNode.element.next);
      if (lastSeenNode) {
        $log(this.this$0, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Removing: ', lastSeenNode]));
        $deleteNode(this.this$0.element.context.this$0.mutableContent, lastSeenNode.element);
      }
    }
  }
   else {
    $log(this.this$0, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Undefined redundant node check child.']));
  }
  this.this$0.redundantNodeCheckChild = null;
}
;
_.getClass$ = function getClass_731(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$1_2_classLit;
}
;
_.castableTypeMap$ = {252:1, 253:1};
_.this$0 = null;
function GadgetWidget$10_0(this$0){
  this.this$0 = this$0;
}

function GadgetWidget$10(){
}

_ = GadgetWidget$10_0.prototype = GadgetWidget$10.prototype = new Object_0;
_.doSubmit = function doSubmit(){
  $log(this.this$0, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Blip submitted.']));
}
;
_.getClass$ = function getClass_732(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$10_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function GadgetWidget$11_0(this$0){
  this.this$0 = this$0;
}

function GadgetWidget$11(){
}

_ = GadgetWidget$11_0.prototype = GadgetWidget$11.prototype = new Object_0;
_.doSubmit = function doSubmit_0(){
  $sendGadgetState(this.this$0);
  $log(this.this$0, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Gadget state sent.']));
}
;
_.getClass$ = function getClass_733(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$11_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function GadgetWidget$12_0(this$0){
  this.this$0 = this$0;
}

function GadgetWidget$12(){
}

_ = GadgetWidget$12_0.prototype = GadgetWidget$12.prototype = new Object_0;
_.doSubmit = function doSubmit_1(){
  $sendPrivateGadgetState(this.this$0);
  $log(this.this$0, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Private gadget state sent.']));
}
;
_.getClass$ = function getClass_734(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$12_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $cancel_2(this$static){
  $cancel_3(this$static.timerService.scheduler, this$static);
  this$static.isRepeating = false;
}

function $schedule_1(this$static, delayMillis){
  if (delayMillis <= 0) {
    throw new IllegalArgumentException_1('must be positive');
  }
  $cancel_3(this$static.timerService.scheduler, this$static);
  this$static.isRepeating = false;
  this$static.isRepeating = false;
  this$static.scheduledAgain = true;
  $scheduleDelayed_1(this$static.timerService, this$static, delayMillis);
}

function $scheduleRepeating_0(this$static, delayMillis, periodMillis){
  if (periodMillis <= 0) {
    throw new IllegalArgumentException_1('must be positive');
  }
  $cancel_3(this$static.timerService.scheduler, this$static);
  this$static.isRepeating = false;
  this$static.isRepeating = true;
  this$static.scheduledAgain = false;
  $scheduleRepeating_2(this$static.timerService, this$static, delayMillis, periodMillis);
}

function ScheduleTimer_0(timerService){
  this.timerService = timerService;
}

function ScheduleTimer_1(priority){
  ScheduleTimer_0.call(this, new SchedulerTimerService_1((!instance_7 && (instance_7 = new BrowserBackedScheduler_0 , setDefaultTimerService() , undefined) , instance_7), priority));
}

function ScheduleTimer(){
}

_ = ScheduleTimer.prototype = new Object_0;
_.execute = function execute_37(){
  this.scheduledAgain = false;
  this.run();
  return this.isRepeating || this.scheduledAgain;
}
;
_.getClass$ = function getClass_735(){
  return Lorg_waveprotocol_wave_client_scheduler_ScheduleTimer_2_classLit;
}
;
_.castableTypeMap$ = {251:1, 253:1};
_.isRepeating = false;
_.scheduledAgain = false;
_.timerService = null;
function GadgetWidget$13_0(this$0){
  this.this$0 = this$0;
  ScheduleTimer_1.call(this, ($clinit_1200() , LOW));
}

function GadgetWidget$13(){
}

_ = GadgetWidget$13_0.prototype = GadgetWidget$13.prototype = new ScheduleTimer;
_.getClass$ = function getClass_736(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$13_2_classLit;
}
;
_.run = function run_6(){
  $initializePodium(this.this$0);
}
;
_.castableTypeMap$ = {251:1, 253:1};
_.this$0 = null;
function GadgetWidget$14_0(this$0){
  this.this$0 = this$0;
  ScheduleTimer_1.call(this, ($clinit_1200() , LOW));
}

function GadgetWidget$14(){
}

_ = GadgetWidget$14_0.prototype = GadgetWidget$14.prototype = new ScheduleTimer;
_.getClass$ = function getClass_737(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$14_2_classLit;
}
;
_.run = function run_7(){
  $removeThrobber(this.this$0.ui);
}
;
_.castableTypeMap$ = {251:1, 253:1};
_.this$0 = null;
function GadgetWidget$15_0(this$0){
  this.this$0 = this$0;
}

function GadgetWidget$15(){
}

_ = GadgetWidget$15_0.prototype = GadgetWidget$15.prototype = new Object_0;
_.execute_0 = function execute_38(){
  $generateAndSetGadgetId(this.this$0);
}
;
_.getClass$ = function getClass_738(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$15_2_classLit;
}
;
_.castableTypeMap$ = {252:1, 253:1};
_.this$0 = null;
function $onDataReady(this$static, metadata){
  var url, view, views;
  if (this$static.this$0.active) {
    views = metadata.views.keySet_1();
    if (views.contains_0('canvas')) {
      view = 'canvas';
    }
     else if (views.contains_0('default')) {
      view = 'default';
    }
     else if (views.isEmpty()) {
      $showBrokenGadget(this$static.this$0, 'Gadget has no view to render.');
      return;
    }
     else {
      view = views.someElement_0();
    }
    url = metadata.iframeUrl;
    url != null && !!url.length && !!getIframeHost(url).length?$constructGadgetFromMetadata(this$static.this$0, metadata, view):$showBrokenGadget(this$static.this$0, 'Invalid IFrame URL ' + url);
  }
}

function $onError(this$static, message, t){
  !!t && t.getMessage() != null && (message += ' ' + t.getMessage());
  $showBrokenGadget(this$static.this$0, message);
}

function GadgetWidget$16_0(this$0){
  this.this$0 = this$0;
}

function GadgetWidget$16(){
}

_ = GadgetWidget$16_0.prototype = GadgetWidget$16.prototype = new Object_0;
_.getClass$ = function getClass_739(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$16_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function GadgetWidget$17_0(this$0, val$name, val$value){
  this.this$0 = this$0;
  this.val$name = val$name;
  this.val$value = val$value;
}

function GadgetWidget$17(){
}

_ = GadgetWidget$17_0.prototype = GadgetWidget$17.prototype = new Object_0;
_.execute_0 = function execute_39(){
  this.this$0.active && $sendGadgetPrefRpc('wgadget_iframe_' + this.this$0.clientInstanceId, this.val$name, this.val$value);
}
;
_.getClass$ = function getClass_740(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$17_2_classLit;
}
;
_.castableTypeMap$ = {252:1, 253:1};
_.this$0 = null;
_.val$name = null;
_.val$value = null;
function GadgetWidget$18_0(this$0){
  this.this$0 = this$0;
  ScheduleTimer_1.call(this, ($clinit_1200() , LOW));
  this.wasEditing = $isEditing(this.this$0.editingIndicator);
}

function GadgetWidget$18(){
}

_ = GadgetWidget$18_0.prototype = GadgetWidget$18.prototype = new ScheduleTimer;
_.getClass$ = function getClass_741(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$18_2_classLit;
}
;
_.run = function run_8(){
  var newEditing;
  if (this.this$0.active) {
    newEditing = $isEditing(this.this$0.editingIndicator);
    if (this.wasEditing != newEditing) {
      $sendMode(this.this$0);
      this.wasEditing = newEditing;
    }
  }
   else {
    $cancel_3(this.timerService.scheduler, this);
    this.isRepeating = false;
    return;
  }
}
;
_.castableTypeMap$ = {251:1, 253:1};
_.this$0 = null;
function GadgetWidget$19_0(this$0, val$deltaState, val$delta){
  this.this$0 = this$0;
  this.val$deltaState = val$deltaState;
  this.val$delta = val$delta;
}

function GadgetWidget$19(){
}

_ = GadgetWidget$19_0.prototype = GadgetWidget$19.prototype = new Object_0;
_.execute_0 = function execute_40(){
  $checkKeyValue(this.val$deltaState, new StateMap$5_0(new GadgetWidget$19$1_0(this)));
  $log(this.this$0, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Applied delta ', toStringSimple(this.val$delta), ' new state ', $toJson(this.this$0.state)]));
  $submitIfScheduled(this.this$0.gadgetStateSubmitter);
  $submitImmediately(this.this$0.blipSubmitter);
}
;
_.getClass$ = function getClass_742(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$19_2_classLit;
}
;
_.castableTypeMap$ = {252:1, 253:1};
_.this$0 = null;
_.val$delta = null;
_.val$deltaState = null;
function GadgetWidget$19$1_0(this$1){
  this.this$1 = this$1;
}

function GadgetWidget$19$1(){
}

_ = GadgetWidget$19$1_0.prototype = GadgetWidget$19$1.prototype = new Object_0;
_.apply_10 = function apply_53(key, value){
  value != null?$modifyState(this.this$1.this$0, key, value):$deleteState(this.this$1.this$0, key);
}
;
_.getClass$ = function getClass_743(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$19$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
function $run_0(this$static, node){
  var oldPrefs, oldState;
  if (!this$static.this$0_0.active) {
    $log(this$static.this$0_0, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Element change event in removed node: ignoring.']));
    return;
  }
  oldState = {};
  $copyFrom(oldState, this$static.this$0_0.state);
  oldPrefs = {};
  $copyFrom(oldPrefs, this$static.this$0_0.userPrefs);
  this$static.processChange(node);
  $compare_4(this$static.this$0_0.state, oldState) || $submit_2(this$static.this$0_0.gadgetStateSubmitter);
  $compare_4(this$static.this$0_0.userPrefs, oldPrefs) || $checkKeyValue(this$static.this$0_0.userPrefs, new StateMap$5_0(new GadgetWidget$ElementChangeTask$1_0(this$static, oldPrefs)));
}

function GadgetWidget$ElementChangeTask(){
}

_ = GadgetWidget$ElementChangeTask.prototype = new Object_0;
_.getClass$ = function getClass_744(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$ElementChangeTask_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0_0 = null;
function GadgetWidget$2_0(this$0){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
}

function GadgetWidget$2(){
}

_ = GadgetWidget$2_0.prototype = GadgetWidget$2.prototype = new GadgetWidget$ElementChangeTask;
_.getClass$ = function getClass_745(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$2_2_classLit;
}
;
_.processChange = function processChange(node){
  var child;
  child = create_24(node);
  $log(this.this$0, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Added: ', child]));
  if (child) {
    $removeRedundantNodes(this.this$0, child);
    $processChild(this.this$0, child);
  }
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function GadgetWidget$20_0(this$0, val$gadgetId){
  this.this$0 = this$0;
  this.val$gadgetId = val$gadgetId;
}

function GadgetWidget$20(){
}

_ = GadgetWidget$20_0.prototype = GadgetWidget$20.prototype = new Object_0;
_.apply_10 = function apply_54(key, value){
  this.this$0.supplement.delegate.setGadgetState(this.val$gadgetId, key, value);
}
;
_.getClass$ = function getClass_746(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$20_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$gadgetId = null;
function GadgetWidget$21_0(this$0){
  this.this$0 = this$0;
  ScheduleTimer_1.call(this, ($clinit_1200() , LOW));
}

function GadgetWidget$21(){
}

_ = GadgetWidget$21_0.prototype = GadgetWidget$21.prototype = new ScheduleTimer;
_.getClass$ = function getClass_747(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$21_2_classLit;
}
;
_.run = function run_9(){
  this.this$0.active && $sendCurrentParticipantInformation(this.this$0);
}
;
_.castableTypeMap$ = {251:1, 253:1};
_.this$0 = null;
function GadgetWidget$22_0(this$0){
  this.this$0 = this$0;
}

function GadgetWidget$22(){
}

_ = GadgetWidget$22_0.prototype = GadgetWidget$22.prototype = new Object_0;
_.apply_10 = function apply_55(key, value){
  $deleteState(this.this$0, key);
}
;
_.getClass$ = function getClass_748(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$22_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $apply_10(this$static, key){
  this$static.this$0.supplement.delegate.setGadgetState(this$static.val$gadgetId, key, null);
}

function GadgetWidget$23_0(this$0, val$gadgetId){
  this.this$0 = this$0;
  this.val$gadgetId = val$gadgetId;
}

function GadgetWidget$23(){
}

_ = GadgetWidget$23_0.prototype = GadgetWidget$23.prototype = new Object_0;
_.apply_1 = function apply_56(key, value){
  $apply_10(this, key, dynamicCast(value, 1));
}
;
_.getClass$ = function getClass_749(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$23_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$gadgetId = null;
function GadgetWidget$3_0(this$0){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
}

function GadgetWidget$3(){
}

_ = GadgetWidget$3_0.prototype = GadgetWidget$3.prototype = new GadgetWidget$ElementChangeTask;
_.getClass$ = function getClass_750(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$3_2_classLit;
}
;
_.processChange = function processChange_0(node){
  var child;
  child = create_24(node);
  $log(this.this$0, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Removed: ', child]));
  switch (child.type_0.ordinal) {
    case 2:
      $removeChildFromMaps(this.this$0, child, this.this$0.stateElements, this.this$0.state);
      break;
    case 3:
      $removeChildFromMaps(this.this$0, child, this.this$0.prefElements, this.this$0.userPrefs);
      break;
    case 1:
      $log(this.this$0, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Removing title is not supported']));
      break;
    case 0:
      $log(this.this$0, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Removing categories is not supported']));
      break;
    default:$log(this.this$0, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Unexpected gadget node removed ', child.element.tagName_0]));
  }
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function GadgetWidget$4_0(this$0){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
}

function GadgetWidget$4(){
}

_ = GadgetWidget$4_0.prototype = GadgetWidget$4.prototype = new GadgetWidget$ElementChangeTask;
_.getClass$ = function getClass_751(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$4_2_classLit;
}
;
_.processChange = function processChange_1(node){
  $rescanGadgetXmlElements(this.this$0);
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function GadgetWidget$5_0(this$0){
  this.this$0 = this$0;
}

function GadgetWidget$5(){
}

_ = GadgetWidget$5_0.prototype = GadgetWidget$5.prototype = new Object_0;
_.execute_0 = function execute_41(){
  $run_0(this.this$0.descendantsMutatedTask, null);
}
;
_.getClass$ = function getClass_752(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$5_2_classLit;
}
;
_.castableTypeMap$ = {252:1, 253:1};
_.this$0 = null;
function GadgetWidget$6_0(this$0){
  this.this$0 = this$0;
}

function GadgetWidget$6(){
}

_ = GadgetWidget$6_0.prototype = GadgetWidget$6.prototype = new Object_0;
_.apply_10 = function apply_57(key, value){
  $clinit_1197();
  $schedule_2(scheduler_0, ($clinit_1200() , LOW), new GadgetWidget$17_0(this.this$0, key, value));
}
;
_.getClass$ = function getClass_753(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$6_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function GadgetWidget$7_0(val$builder){
  this.val$builder = val$builder;
}

function GadgetWidget$7(){
}

_ = GadgetWidget$7_0.prototype = GadgetWidget$7.prototype = new Object_0;
_.apply_10 = function apply_58(key, value){
  var regexp, regexp_0;
  if (value != null) {
    $append_11(this.val$builder, '&up_');
    $append_11(this.val$builder, (throwIfNull('decodedURLComponent', key) , regexp = /%20/g , encodeURIComponent(key).replace(regexp, '+')));
    $append_6(this.val$builder, 61);
    $append_11(this.val$builder, (throwIfNull('decodedURLComponent', value) , regexp_0 = /%20/g , encodeURIComponent(value).replace(regexp_0, '+')));
  }
}
;
_.getClass$ = function getClass_754(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$7_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$builder = null;
function GadgetWidget$8_0(this$0, val$attributeName, val$value){
  this.this$0 = this$0;
  this.val$attributeName = val$attributeName;
  this.val$value = val$value;
}

function GadgetWidget$8(){
}

_ = GadgetWidget$8_0.prototype = GadgetWidget$8.prototype = new Object_0;
_.execute_0 = function execute_42(){
  var oldValue;
  if (this.this$0.active && this.this$0.documentModified) {
    oldValue = dynamicCast(this.this$0.element.attributes.get_4(this.val$attributeName), 1);
    $equals_3(this.val$value, oldValue) || $setElementAttribute(this.this$0.element.context.this$0.mutableContent, this.this$0.element, this.val$attributeName, this.val$value);
  }
}
;
_.getClass$ = function getClass_755(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$8_2_classLit;
}
;
_.castableTypeMap$ = {252:1, 253:1};
_.this$0 = null;
_.val$attributeName = null;
_.val$value = null;
function GadgetWidget$9_0(this$0, val$url, val$width, val$height){
  this.this$0 = this$0;
  this.val$url = val$url;
  this.val$width = val$width;
  this.val$height = val$height;
  ScheduleTimer_1.call(this, ($clinit_1200() , LOW));
  this.loadWarningTime = (new Date).getTime() + 30000;
}

function GadgetWidget$9(){
}

_ = GadgetWidget$9_0.prototype = GadgetWidget$9.prototype = new ScheduleTimer;
_.getClass$ = function getClass_756(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$9_2_classLit;
}
;
_.run = function run_10(){
  if (this.this$0.active) {
    if ($wnd.gadgets && $wnd.gadgets.rpc?true:false) {
      $cancel_3(this.timerService.scheduler, this);
      this.isRepeating = false;
      $controllerRegistration(this.this$0, this.val$url, this.val$width, this.val$height);
    }
     else {
      if ((new Date).getTime() > this.loadWarningTime) {
        $log(this.this$0, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Gadget RPC script failed to load on time.']));
        this.loadWarningTime += 30000;
      }
    }
  }
   else {
    $cancel_3(this.timerService.scheduler, this);
    this.isRepeating = false;
    $log(this.this$0, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Not active.']));
    return;
  }
}
;
_.castableTypeMap$ = {251:1, 253:1};
_.this$0 = null;
_.val$height = P0_longLit;
_.val$url = null;
_.val$width = P0_longLit;
function $isEditing(this$static){
  return !!this$static.element && ($clinit_797() , $equals_2(($clinit_428() , TRUE_0), ($clinit_790() , ELEMENT_MANAGER).getProperty(DOCUMENT_MODE, this$static.element)));
}

function GadgetWidget$BlipEditingIndicator_0(element){
  this.element = element;
}

function GadgetWidget$BlipEditingIndicator(){
}

_ = GadgetWidget$BlipEditingIndicator_0.prototype = GadgetWidget$BlipEditingIndicator.prototype = new Object_0;
_.getClass$ = function getClass_757(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$BlipEditingIndicator_2_classLit;
}
;
_.castableTypeMap$ = {};
_.element = null;
function GadgetWidget$ElementChangeTask$1_0(this$1, val$oldPrefs){
  this.this$1 = this$1;
  this.val$oldPrefs = val$oldPrefs;
}

function GadgetWidget$ElementChangeTask$1(){
}

_ = GadgetWidget$ElementChangeTask$1_0.prototype = GadgetWidget$ElementChangeTask$1.prototype = new Object_0;
_.apply_10 = function apply_59(key, value){
  (!this.val$oldPrefs.hasOwnProperty(':' + key) || !$equals_3(value, this.val$oldPrefs[':' + key])) && ($clinit_1197() , $schedule_2(scheduler_0, ($clinit_1200() , LOW), new GadgetWidget$17_0(this.this$1.this$0_0, key, value)) , undefined);
}
;
_.getClass$ = function getClass_758(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$ElementChangeTask$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
_.val$oldPrefs = null;
function $clinit_1162(){
  $clinit_1162 = nullMethod;
  $clinit_1168();
  $clinit_103();
  $push_1(toInject, ($clinit_211() , '.C-MI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-panel {\n  position : relative;\n  zoom : 1;\n  overflow : hidden;\n  font-size : 0;\n  border : none;\n  clear : left;\n}\n.C-AI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-inline {\n  display : inline-block;\n  vertical-align : bottom;\n}\n.C-NI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-title {\n  display : none;\n}\n.C-OH-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-gadgetFrame {\n  margin-top : 0;\n  margin-bottom : 0;\n  font-size : 0;\n  display : block;\n  position : relative;\n}\n.C-DI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-loadingGadgetFrame {\n  border : 1px solid #b8c6d9;\n}\n.C-CI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-loadedGadgetFrame {\n  border : 1px solid transparent;\n}\n.C-EI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-loadingGadgetLargeThrobber {\n  height : ' + ($clinit_1172() , loadingGadgetLarge).height_0 + 'px;\n  width : ' + loadingGadgetLarge.width_0 + 'px;\n  overflow : hidden;\n  background : url("' + loadingGadgetLarge.url + '") -' + loadingGadgetLarge.left_0 + 'px -' + loadingGadgetLarge.top_0 + 'px  no-repeat;\n  background-color : #e6ebf2;\n  background-repeat : no-repeat;\n  line-height : ' + loadingGadgetLarge.height_0 + 'px;\n  background-position : center center;\n  display : block;\n}\n.C-FI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-loadingGadgetSmallThrobber {\n  height : ' + loadingGadgetSmall.height_0 + 'px;\n  width : ' + loadingGadgetSmall.width_0 + 'px;\n  overflow : hidden;\n  background : url("' + loadingGadgetSmall.url + '") -' + loadingGadgetSmall.left_0 + 'px -' + loadingGadgetSmall.top_0 + 'px  no-repeat;\n  background-color : #e6ebf2;\n  background-repeat : no-repeat;\n  line-height : ' + loadingGadgetSmall.height_0 + "px;\n  background-position : center center;\n  display : block;\n}\n/* CssUrl */\n.C-MH-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-brokenGadgetIcon {\n  background-color : #e6ebf2;\n  background-image : url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAA3CAYAAAChMHI8AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA4xJREFUeNrsWjFy2zAQBD3qI7/AVJOUosukMVUlnZUXSHlBpBdI/gH9AvMHoTqnMtQkLVMmTZgXhHmBcuc5ejAMAYHEEZI1uRkMNSIEcnmHvb2jAuFg91++T+GwghEZpkkYy3dvXuVNJ3e7neCygePvP1nMiWneSPRsZ46/Lyzn5cKDuYLBMCstgMyPHgzsg29wCA0eyjDMYN6f5+AZQTeaaE4nvoCwgCELNd8PhUcLHGh5SJSM+2FmIAik5Uy3Dic1B3BTO3FAe/v6ZXBsYdbZPn/9EZ0MGLAXpwQmPiUw4X8wRwomCoJA6AYQxBrG1DSnGoMDA8E8tNgzZ0V5DQ8bkkgScldxTHlmvU/uwL0hOTxoTqMuTOH3CVc908WwWJvDTfxyXGdc32+H2DMfWgCJLR7MQcGMW8wd7lHs2aHBRExzN9w9gK4Z/8agwkMakUWjxApMQSP24RkC8rvlOllT0qzzNdLdCMbEIge0tVLTD2irnIumPINg0lrzQQWQMgLBJxnCTWwYJM2mUc7A4jf0ZLDxcKkmMfosmcDcGhJk6BpiT3uGuiym0OCwleHBtAmzEu5XdhWaXA28mORJffOHLT2z1Z3wTc2P3iH2wr05bZlEtSFmC4ar3pAkLqs1Vw7r6OsZfFLk7j7ASCKXCYwt7dGuoZs3UfITGHotgQnrJ3y+Y8gBWhC2sW8wY3d0UHP3HAAVRNfosZno1pUsKOnuI5YrlxKb9l5C368HDU9+DZNGpAw+dg2HBtaKFO0VdwzfC1gnUwDgsWpVpToCmDnuk1ypFJMOjGWyaxr/AO2rBJBKaTwWnqwvMDl55Ur4s20fYHLSYGvfnZ6znrwy78ErhTC/Q5VcYEraJ5LKBm6vVDUWsuxSIz5TVzBIkxEsdE7JEXMLXvCCuaBbKmVJ0uChW2ehCQu/N2iwOZOu28B16mUIJvU7JfwSZzZr0nOonVBBUEgsGOoh2XCNKpQxMiYVWNf2bK4upgGMFP3gcI1z0/qceSYigRoaQtGl7N7aAuEqzoak4ZaaFlLiSDDCJxhRZxelklwIt3eW0ieYkp5evSWVMIjVom0RN+B6D1/9OQHfYDFRcuvirS+hmTKskR0FGMoDlwSq9LFfHqOC878rSpg1VZkzqjBtegpIyXHba3vpm9FGzhXVgIp6SoMlxLx5Zo8kuiZQal9gZGopGVmIczhqvQhG1yaK+CvAABxGcnUMyhrYAAAAAElFTkSuQmCC');\n  background-repeat : no-repeat;\n  background-position : center center;\n  display : block;\n}\n.C-BI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-loadedGadget {\n  display : block;\n}\n.C-PH-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-iframeDiv {\n  position : relative;\n  left : 0;\n  top : 0;\n}\n/* CssEval */\n.C-HI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-metaButtons {\n  height : " + metaMid.height_0 + 'px;\n  overflow : hidden;\n  background : url("' + metaMid.url + '") -' + metaMid.left_0 + 'px -' + metaMid.top_0 + 'px  repeat-x;\n  position : absolute;\n  right : 14px;\n  top : 6px;\n  z-index : 1;\n  overflow : visible;\n  font-size : 0;\n  -webkit-transition : opacity 300ms ease-in-out;\n  -moz-transition : opacity 300ms ease-in-out;\n  transition : opacity 300ms ease-in-out;\n}\n/* CssEval */\n/* CssEval */\n.C-KI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-metaRight {\n  height : ' + metaRightImage.height_0 + 'px;\n  width : ' + metaRightImage.width_0 + 'px;\n  overflow : hidden;\n  background : url("' + metaRightImage.url + '") -' + metaRightImage.left_0 + 'px -' + metaRightImage.top_0 + 'px  no-repeat;\n  float : left;\n  margin-right : ' + META_RIGHT_WIDTH + ';\n}\n.C-JI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-metaLeft {\n  height : ' + metaLeftImage.height_0 + 'px;\n  width : ' + metaLeftImage.width_0 + 'px;\n  overflow : hidden;\n  background : url("' + metaLeftImage.url + '") -' + metaLeftImage.left_0 + 'px -' + metaLeftImage.top_0 + 'px  no-repeat;\n  float : left;\n  margin-left : ' + META_LEFT_WIDTH + ';\n}\n.C-II-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-metaButtonsPanel {\n  float : left;\n}\n.C-GI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-metaButton {\n  margin-top : 3px;\n  float : left;\n}\n.C-GI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-metaButton.C-NH-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-disabled {\n  opacity : 0.5;\n}\n.C-LI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-more {\n  height : ' + moreImage.height_0 + 'px;\n  width : ' + moreImage.width_0 + 'px;\n  overflow : hidden;\n  background : url("' + moreImage.url + '") -' + moreImage.left_0 + 'px -' + moreImage.top_0 + 'px  no-repeat;\n}\n'));
  schedule();
}

function $addHandlers(this$static, mouseOverHandler, mouseOutHandler){
  $addDomHandler(this$static, mouseOverHandler, ($clinit_155() , $clinit_155() , TYPE_8));
  $addDomHandler(this$static, mouseOutHandler, ($clinit_153() , $clinit_153() , TYPE_7));
  $addDomHandler(this$static.enclosingBox, mouseOverHandler, TYPE_8);
  $addDomHandler(this$static.gadgetFrame, mouseOverHandler, TYPE_8);
  $addDomHandler(this$static.iframeDiv, mouseOverHandler, TYPE_8);
  $addDomHandler(this$static.gadgetIframe, mouseOverHandler, TYPE_8);
  $addDomHandler(this$static.metaButtons, mouseOverHandler, TYPE_8);
  $addDomHandler(this$static.metaLeft, mouseOverHandler, TYPE_8);
  $addDomHandler(this$static.metaButtonsPanel, mouseOverHandler, TYPE_8);
  $addDomHandler(this$static.metaRight, mouseOverHandler, TYPE_8);
  $addDomHandler(this$static.menu.button_0, mouseOverHandler, TYPE_8);
}

function $buildIFrame(this$static, gadgetName){
  var height, iframe;
  this$static.gadgetIframe.element.id = gadgetName;
  height = 0;
  switch (this$static.throbberState.ordinal) {
    case 0:
      setStyleName_0(this$static.gadgetIframe.element, 'C-FI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-loadingGadgetSmallThrobber', true);
      height = ($clinit_1168() , $clinit_1172() , loadingGadgetSmall).height_0;
      break;
    case 1:
      setStyleName_0(this$static.gadgetIframe.element, 'C-EI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-loadingGadgetLargeThrobber', true);
      height = ($clinit_1168() , $clinit_1172() , loadingGadgetLarge).height_0;
  }
  iframe = this$static.gadgetIframe.element;
  iframe.setAttribute('vspace', '0');
  iframe.setAttribute('hspace', '0');
  iframe.setAttribute('frameBorder', 'no');
  iframe.setAttribute('moduleId', gadgetName);
  iframe.setAttribute('display', 'block');
  iframe.setAttribute('height', height + 'px');
  iframe.scrolling = 'no';
  $add_26(this$static.iframeDiv, this$static.gadgetIframe);
}

function $onMouseEnter(this$static){
  if (!this$static.menuEnabled || !$isEditing(this$static.editingIndicator)) {
    return;
  }
  $cancel_2(this$static.disableMenuTask);
  this$static.metaButtons.element.style['display'] = '';
  parseInt(this$static.metaButtons.element['offsetWidth']) || 0;
  this$static.metaButtons.element.style.opacity = '';
}

function $onMouseLeave(this$static){
  this$static.metaButtons.element.style.opacity = 0;
  $schedule_1(this$static.disableMenuTask, 300);
}

function $removeThrobber(this$static){
  switch (this$static.throbberState.ordinal) {
    case 0:
      setStyleName_0(this$static.gadgetIframe.element, 'C-FI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-loadingGadgetSmallThrobber', false);
      break;
    case 1:
      setStyleName_0(this$static.gadgetIframe.element, 'C-EI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-loadingGadgetLargeThrobber', false);
  }
  this$static.throbberState = ($clinit_1169() , DISABLED);
  setStyleName_0(this$static.gadgetIframe.element, 'C-BI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-loadedGadget', true);
  setStyleName_0(this$static.gadgetFrame.element, 'C-DI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-loadingGadgetFrame', false);
  setStyleName_0(this$static.gadgetFrame.element, 'C-CI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-loadedGadgetFrame', true);
}

function $setIframeHeight_0(this$static, height){
  this$static.gadgetIframe.element.setAttribute('height', toString_14(height) + 'px');
  if (gt(height, P3f_longLit)) {
    if (this$static.throbberState == ($clinit_1169() , SMALL)) {
      setStyleName_0(this$static.gadgetIframe.element, 'C-FI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-loadingGadgetSmallThrobber', false);
      setStyleName_0(this$static.gadgetIframe.element, 'C-EI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-loadingGadgetLargeThrobber', true);
      this$static.throbberState = LARGE;
    }
  }
   else {
    if (this$static.throbberState == ($clinit_1169() , LARGE)) {
      setStyleName_0(this$static.gadgetIframe.element, 'C-EI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-loadingGadgetLargeThrobber', false);
      setStyleName_0(this$static.gadgetIframe.element, 'C-FI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-loadingGadgetSmallThrobber', true);
      this$static.throbberState = SMALL;
    }
  }
}

function $setIframeSource(this$static, source){
  source != null && !$equals_3(source, this$static.gadgetIframe.element.src) && (this$static.gadgetIframe.element.src = source , undefined);
}

function $setIframeWidth_0(this$static, width){
  this$static.gadgetIframe.element.setAttribute('width', width);
  this$static.iframeDiv.element.style['width'] = width;
  this$static.gadgetFrame.element.style['width'] = width;
}

function $setTitleLabelText(this$static, text){
  $clinit_761();
  ++ignoreMutations;
  try {
    $setTextOrHtml(this$static.titleLabel.directionalTextHelper, text, false);
  }
   finally {
    --ignoreMutations;
  }
}

function $showBrokenGadget_0(this$static){
  switch (this$static.throbberState.ordinal) {
    case 0:
      setStyleName_0(this$static.gadgetIframe.element, 'C-FI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-loadingGadgetSmallThrobber', false);
      this$static.gadgetIframe.element.setAttribute('height', '64px');
      break;
    case 1:
      setStyleName_0(this$static.gadgetIframe.element, 'C-EI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-loadingGadgetLargeThrobber', false);
  }
  this$static.throbberState = ($clinit_1169() , BROKEN);
  setStyleName_0(this$static.gadgetIframe.element, 'C-MH-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-brokenGadgetIcon', true);
}

function GadgetWidgetUi_0(gadgetName, editingIndicator){
  var enclosingBox, gadgetFrame, iframeDiv, metaButtons, metaButtonsPanel, metaLeft, metaRight, titleLabel;
  $clinit_1162();
  this.throbberState = ($clinit_1169() , SMALL);
  this.disableMenuTask = new GadgetWidgetUi$1_0(this);
  this.editingIndicator = editingIndicator;
  this.menuEnabled = false;
  $initWidget(this, ($clinit_1172() , titleLabel = new Label_0 , iframeDiv = new ClickableDivPanel_0 , metaLeft = new ClickableDivPanel_0 , metaButtonsPanel = new ClickableDivPanel_0 , metaRight = new ClickableDivPanel_0 , metaButtons = new ClickableDivPanel_0 , gadgetFrame = new ClickableDivPanel_0 , enclosingBox = new ClickableDivPanel_0 , setStyleName_0(titleLabel.element, 'C-NI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-title', true) , $add_0(enclosingBox, titleLabel, enclosingBox.element) , setStyleName_0(iframeDiv.element, 'C-PH-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-iframeDiv', true) , $add_0(gadgetFrame, iframeDiv, gadgetFrame.element) , setStyleName_0(metaLeft.element, 'C-JI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-metaLeft', true) , $add_0(metaButtons, metaLeft, metaButtons.element) , setStyleName_0(metaButtonsPanel.element, 'C-II-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-metaButtonsPanel', true) , $add_0(metaButtons, metaButtonsPanel, metaButtons.element) , setStyleName_0(metaRight.element, 'C-KI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-metaRight', true) , $add_0(metaButtons, metaRight, metaButtons.element) , setStyleName_0(metaButtons.element, 'C-HI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-metaButtons', true) , $add_0(gadgetFrame, metaButtons, gadgetFrame.element) , setStyleName_0(gadgetFrame.element, 'C-OH-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-gadgetFrame', true) , $add_0(enclosingBox, gadgetFrame, enclosingBox.element) , setStyleName_0(enclosingBox.element, 'C-MI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-panel', true) , this.enclosingBox = enclosingBox , this.gadgetFrame = gadgetFrame , this.iframeDiv = iframeDiv , this.metaButtons = metaButtons , this.metaButtonsPanel = metaButtonsPanel , this.metaLeft = metaLeft , this.metaRight = metaRight , this.titleLabel = titleLabel , enclosingBox));
  this.gadgetIframe = new GadgetWidgetUi$GadgetIFrame_0(gadgetName);
  $buildIFrame(this, gadgetName);
  this.menu = new MenuButton_0;
  $addItem_1(this.menu.menu, 'Delete gadget', new GadgetWidgetUi$2_0(this));
  $addItem_1(this.menu.menu, 'Select', new GadgetWidgetUi$3_0(this));
  $addItem_1(this.menu.menu, 'Reset', new GadgetWidgetUi$4_0(this));
  $add_26(this.metaButtonsPanel, this.menu.button_0);
  this.metaButtons.element.style.opacity = 0;
  $schedule_1(this.disableMenuTask, 300);
  setStyleName_0(this.gadgetFrame.element, 'C-DI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-loadingGadgetFrame', true);
  setContentEditable(this.enclosingBox.element, false, false);
  setContentEditable(this.titleLabel.element, false, false);
  setContentEditable(this.gadgetFrame.element, false, false);
  setContentEditable(this.gadgetIframe.element, false, false);
  setContentEditable(this.metaButtons.element, false, false);
  setContentEditable(this.metaLeft.element, false, false);
  setContentEditable(this.metaButtonsPanel.element, false, false);
  setContentEditable(this.metaRight.element, false, false);
  setContentEditable(this.menu.button_0.element, false, false);
  $setup(($clinit_1568() , $clinit_1568() , HOVER_HELPER), this);
}

function GadgetWidgetUi(){
}

_ = GadgetWidgetUi_0.prototype = GadgetWidgetUi.prototype = new Composite;
_.getClass$ = function getClass_759(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidgetUi_2_classLit;
}
;
_.castableTypeMap$ = {5:1, 6:1, 7:1, 8:1, 55:1, 59:1};
_.editingIndicator = null;
_.enclosingBox = null;
_.gadgetFrame = null;
_.gadgetIframe = null;
_.iframeDiv = null;
_.listener = null;
_.menu = null;
_.menuEnabled = false;
_.metaButtons = null;
_.metaButtonsPanel = null;
_.metaLeft = null;
_.metaRight = null;
_.titleLabel = null;
function GadgetWidgetUi$1_0(this$0){
  this.this$0 = this$0;
  ScheduleTimer_1.call(this, ($clinit_1200() , LOW));
}

function GadgetWidgetUi$1(){
}

_ = GadgetWidgetUi$1_0.prototype = GadgetWidgetUi$1.prototype = new ScheduleTimer;
_.getClass$ = function getClass_760(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidgetUi$1_2_classLit;
}
;
_.run = function run_11(){
  this.this$0.metaButtons.element.style['display'] = ($clinit_63() , 'none');
}
;
_.castableTypeMap$ = {251:1, 253:1};
_.this$0 = null;
function GadgetWidgetUi$2_0(this$0){
  this.this$0 = this$0;
}

function GadgetWidgetUi$2(){
}

_ = GadgetWidgetUi$2_0.prototype = GadgetWidgetUi$2.prototype = new Object_0;
_.execute_0 = function execute_43(){
  !!this.this$0.listener && $deleteGadget(this.this$0.listener);
}
;
_.getClass$ = function getClass_761(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidgetUi$2_2_classLit;
}
;
_.castableTypeMap$ = {42:1, 52:1};
_.this$0 = null;
function GadgetWidgetUi$3_0(this$0){
  this.this$0 = this$0;
}

function GadgetWidgetUi$3(){
}

_ = GadgetWidgetUi$3_0.prototype = GadgetWidgetUi$3.prototype = new Object_0;
_.execute_0 = function execute_44(){
  !!this.this$0.listener && $selectGadget(this.this$0.listener);
}
;
_.getClass$ = function getClass_762(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidgetUi$3_2_classLit;
}
;
_.castableTypeMap$ = {42:1, 52:1};
_.this$0 = null;
function GadgetWidgetUi$4_0(this$0){
  this.this$0 = this$0;
}

function GadgetWidgetUi$4(){
}

_ = GadgetWidgetUi$4_0.prototype = GadgetWidgetUi$4.prototype = new Object_0;
_.execute_0 = function execute_45(){
  !!this.this$0.listener && $resetGadget(this.this$0.listener);
}
;
_.getClass$ = function getClass_763(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidgetUi$4_2_classLit;
}
;
_.castableTypeMap$ = {42:1, 52:1};
_.this$0 = null;
function GadgetWidgetUi$GadgetIFrame_0(name_0){
  $clinit_381();
  this.element = createIFrame(name_0);
  this.element['className'] = 'gwt-Frame';
}

function GadgetWidgetUi$GadgetIFrame(){
}

_ = GadgetWidgetUi$GadgetIFrame_0.prototype = GadgetWidgetUi$GadgetIFrame.prototype = new NamedFrame;
_.getClass$ = function getClass_764(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidgetUi$GadgetIFrame_2_classLit;
}
;
_.castableTypeMap$ = {5:1, 6:1, 7:1, 8:1, 55:1, 59:1};
function $clinit_1168(){
  $clinit_1168 = nullMethod;
  RESOURCES = new GadgetWidgetUi_Resources_safari_en_InlineClientBundleGenerator_0;
  META_LEFT_WIDTH = '-' + ($clinit_1172() , metaLeftImage).width_0 + 'px';
  META_RIGHT_WIDTH = '-' + metaRightImage.width_0 + 'px';
}

var META_LEFT_WIDTH, META_RIGHT_WIDTH, RESOURCES;
function $clinit_1169(){
  $clinit_1169 = nullMethod;
  SMALL = new GadgetWidgetUi$ThrobberState_0('SMALL', 0);
  LARGE = new GadgetWidgetUi$ThrobberState_0('LARGE', 1);
  BROKEN = new GadgetWidgetUi$ThrobberState_0('BROKEN', 2);
  DISABLED = new GadgetWidgetUi$ThrobberState_0('DISABLED', 3);
  $VALUES_38 = initValues(_3Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidgetUi$ThrobberState_2_classLit, {9:1, 68:1, 170:1}, 115, [SMALL, LARGE, BROKEN, DISABLED]);
}

function GadgetWidgetUi$ThrobberState_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_45(name_0){
  $clinit_1169();
  return valueOf_0(($clinit_1170() , $MAP_38), name_0);
}

function values_39(){
  $clinit_1169();
  return $VALUES_38;
}

function GadgetWidgetUi$ThrobberState(){
}

_ = GadgetWidgetUi$ThrobberState_0.prototype = GadgetWidgetUi$ThrobberState.prototype = new Enum;
_.getClass$ = function getClass_765(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidgetUi$ThrobberState_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 115:1};
var $VALUES_38, BROKEN, DISABLED, LARGE, SMALL;
function $clinit_1170(){
  $clinit_1170 = nullMethod;
  $MAP_38 = createValueOfMap(($clinit_1169() , $VALUES_38));
}

var $MAP_38;
function $clinit_1172(){
  $clinit_1172 = nullMethod;
  loadingGadgetLarge = new ImageResourcePrototype_0('data:image/gif;base64,R0lGODlhMQA+AMQeAOPp8Nri7M/Y5cnU4rvI2t3k7djf6uDm77/H0sPP38TP37vI29Xd6b7L3MzW5MTL1sDN3qGsu8bS4au1w5ijs8bR4dLb58HN3r7K3MzT3c/Z5tvi7Obr8rjG2f///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFBwAeACwAAAAAMQA+AAAF/yAnjmQpAkGaAmbrvrABdXTdJQWs76XtdxieUNf41SrDZKuwMF5YyugIULRJoNKsxRfIejkOn+GrRA1+mDHZyG67f6+3fG6L0+9uO37v0/P/fn97gYJ3hIVzh4hviottjY5GkJF9LpR0k5c0gQ0KmpUjB10cVR0DIlufNAcjDDQOHAI0TyeqNAIiBQQ0BLkbJQm2HRDBNqMmFcJGaiayyj64Lc7PNdEmZ9Q1DBwArCTFqgulNAEGNKcju6oSIq41ADO37cI5Is6nPgMC6qolDBosstWxJHATwYKZNCW8tLDGAgUKHEBsYuigHAn1SgS4gMkioxcHOra4462FuUQe3VRAwEJCl0gTeAiUFGGAn5yGr4DhwdnBQolkFUfSWTCAJYcDEoKSWcq0qdOnUKNKnUoVRoYJEzJU1TGBAoUJW2F0/Rr2xdWsYREgSKIWatshb8tGDQEAIfkEBQcAHgAsCQA3ABwABwAABR8gJ45kaZ5oqqpP9Jjtu5IRFZn1PY8x7O5AFCK4QoQAACH5BAUHAB4ALAkANwAdAAcAAAUiICeOZDlm05SZbEtOFDW5tAnLdS6iqj4iCJ8I6CIKjcJcCAAh+QQFBwAeACwAADcAJwAHAAAFIiAnjmRpnmiqrmzrPtFjwrLLRlRk4rq90rOYb2hCDI1ETggAIfkEBQcAHgAsAAA3ACgABwAABSQgJ45kaZ5oNk0Z6r7uRFETbN8yfe+uyiII3gsIIwpRxqNyFwIAIfkEBQcAHgAsAAA3ACgABwAABSEgJ45kaZ5oqq6s+ERPK5tvHFHRrIt3Xu+6H3DIQuyMqxAAIfkEBQcAHgAsAAA3ACcABwAABSVgNk0ZZ55oqq7rRFETK8+sC9M4LpJ575sIxE8WnBWHqyNyyQkBACH5BAUHAB4ALAAANwAmAAcAAAUhICeOZGmeaKqu6hM9pguzdERFpo3TrBy/vKBwSBQhhscQACH5BAUHAB4ALAAANwAlAAcAAAUlICeOYzZNGamubDtOFDW5dP3Gs62zJrrTCMSPExwShb+icbkMAQAh+QQFBwAeACwAADcAHAAHAAAFHyAnjmRpnmiqqk/0mO27khEVmfU9jzHs7kAUIrhChAAAOw==', 49, 62);
  loadingGadgetSmall = new ImageResourcePrototype_0('data:image/gif;base64,R0lGODlhMAAOAKIHAL/H0sTL1qGsu6u1w5ijs8zT3ebr8v///yH/C05FVFNDQVBFMi4wAwEAAAAh+QQFBwAHACwAAAAAMAAOAAADKmi63P4wykmrvTjrzVkZQ9GNxkAQA9mZqMp9oSsBAEbLyn3peO//wGAvAQAh+QQFBwAHACwNAAQAHAAHAAADGmi63P4wShlEcPVOJohw3bctGWaNKASkE5AAACH5BAUHAAcALA0ABAAdAAcAAAMdaLrcW2MURysbhAzLHdZdqECSuACAqaAWq7pqmAAAIfkEBQcABwAsBAAEACcABwAAAx1outz+MMpJqw0iOKwtFYTggKI3cVtmrg6wuqyRAAAh+QQFBwAHACwEAAQAKAAHAAADHmi63P6wjFGgvXYQMrD/GveNlkQBAHmhGKtC7iuPCQAh+QQFBwAHACwEAAQAKAAHAAADHGi63P4wyklVEKFqd7MgwiYqX9iN4omuFDC6UwIAIfkEBQcABwAsBAAEACcABwAAAx9YM2X+MMo5ByGD6k0t5iCoMGFpOgBwaunWrtMLz0YCACH5BAUHAAcALAQABAAmAAcAAAMcaLrc/jDKKYMIzmLKBRGOB3KUll1kqq6sAqxvAgAh+QQFBwAHACwEAAQAJQAHAAADH2i6WzOFyUnrGoQMy/vNmydSDjRyAHAa6cqqZ+vOcwIAIfkEBQcABwAsBAAEABwABwAAAxpoutz+MEoZRHD1TiaIcN23LRlmjSgEpBOQAAA7', 48, 14);
  new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAAQCAYAAAA8qK60AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAEVJREFUeNpi7J2xLIGBgaGfhZGRsR7IEGABAgUgg4GFmZmZAcwAAgZUEWZmFpgUpggeKTQRJqCBH0CGMgHlCoD4AUCAAQAhQwaPlhZvWAAAAABJRU5ErkJggg==', 2, 16);
  new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAAQCAYAAAA8qK60AAAAKElEQVR42mNYun6/wZIN+ysYlqzfX7B4/f4GBhBBLwbIZjAD7AygCwDpGFFb4KWG7wAAAABJRU5ErkJggg==', 2, 16);
  metaLeftImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAaCAYAAAB7GkaWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAORJREFUeNqckrEKwjAQhi9tagWLOPsOgo4OXQSfwSfxiRwdFBzc7ODSXRTFh5CYWofai2lIMbYa0As/Ifcl+Y9LCAAQQ4450/Um7gpCl/x2H2SP3AUjKII7F4i9cdh3O+0A3mK2iJDxVHJREy02BK0mCDmqoeCH/At+YRp+oQ5YQp8Uf3raqhXXNCM/V6sg2gqSfbSdtF2bIxBSr8mRDWCMJ0nhW5WDmK/2p3N2YRxyFMqiFI230XQYjvzd4TipXlsYNaQ8PftaxdpzjZcpf6DQUr+tTIIJTAgViCU0AWigNjwFGADaXYXYrpY3OAAAAABJRU5ErkJggg==', 7, 26);
  metaMid = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAaCAYAAAAHfFpPAAAAoElEQVR42u3ZvQ4BURQE4KmpKKmVvDQ9b8CbiBCWFRRr7d/dMYVXuMlNxkm+ySknpz0AMJBhwuL2W212dIaepDP0SmcISmcIQYsxdApnaLuezv4HaNpAZ6gVzlA3Wowhf1V0htuzojNkjw+d4Xwv6QynvKQzHK9vOsMhK+gM+0tBZ1iut3QGzVwWCYvdDzNzmPxMExW7H0YyTljsft6PkS+Y6h9SU+M5YQAAAABJRU5ErkJggg==', 64, 26);
  new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAIAAAAphe5+AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAD5JREFUeNpi7J2xjGEoAxZGRsah7QEgGNoeYGZmHo2B0RigzAMsQz0JjcbAaCYeTUKjMTAaA6NNiaELAAIMAIbcAqBR/8J4AAAAAElFTkSuQmCC', 64, 16);
  new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAMElEQVR42u3QwQAAAAgEsNBzCSCE1AK5PSawmr1OVgIECBAgQIAAAQIECBAgQECeB7cJRJfMRZawAAAAAElFTkSuQmCC', 64, 16);
  new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAAQCAYAAAA8qK60AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAEFJREFUeNpi7J2x7D4DA0MjCyMjowKQ0c8CBECaQYCFmZkZxGCAiTAgRJiZWWBSmCJ4pNBFoAY+AOn6AGQ0AAQYAGMxBw8mFhORAAAAAElFTkSuQmCC', 2, 16);
  new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAAQCAYAAAA8qK60AAAAKElEQVR42mNYsn5/wdL1+w0YFq/f37Bkw/4KMAOE6cUAuYABZDPIGQDq5lFbDiUBZAAAAABJRU5ErkJggg==', 2, 16);
  metaRightImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAaCAYAAABl03YlAAABWklEQVR42o3TTUtCQRQG4OlLzJC0hLKQAm0RWJv+Qf+gRct+XRFUi1tRVLQwCrIWgSBEu5I0tSsmZKbej9N7hzNRMQMtns2575058yWEEBE2CmEIwQgMwSAMiK39Cwrkbor2rnW0guLYj/CwDDquR/VGiw7ObymXL9ooxiHKI4fkiL5PFKjUm7RzfEUoTsMkB8Nyag+JQM9x5bQoznEwzlOHhOchxDiUgRQkvkdz8VHh0CLMwxSMy94c1yeFQ1lIQxJicns0oSWecob7ioi+45HCoWVY+BXq4aNiDvURYH9CszAht8FudUkxhl7fuqQYQ7XmJynG0EujQ4oxVLY7pBhX91z/oMBT9d28maVamwKFhwptWjn9sTxW23R3X6a9k2uyzvIl7QEHf28fXvrWab60tr6xqr0q3EOWR8hoLx2vJM1TpLTXl1eR5B4S2ofAxRg3GdU+qf88zi82VijqAQBcagAAAABJRU5ErkJggg==', 9, 26);
  moreImage = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAQCAYAAADwMZRfAAAAJUlEQVR42mNgGAUjFPzHgykzCAbINohcA+AGUWoA3JTRZEIaAABqMivVBZSu5QAAAABJRU5ErkJggg==', 17, 16);
}

function GadgetWidgetUi_Resources_safari_en_InlineClientBundleGenerator_0(){
  $clinit_1172();
}

function GadgetWidgetUi_Resources_safari_en_InlineClientBundleGenerator(){
}

_ = GadgetWidgetUi_Resources_safari_en_InlineClientBundleGenerator_0.prototype = GadgetWidgetUi_Resources_safari_en_InlineClientBundleGenerator.prototype = new Object_0;
_.getClass$ = function getClass_766(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidgetUi_1Resources_1safari_1en_1InlineClientBundleGenerator_2_classLit;
}
;
_.castableTypeMap$ = {};
var loadingGadgetLarge = null, loadingGadgetSmall = null, metaLeftImage = null, metaMid = null, metaRightImage = null, moreImage = null;
function $addParticipant(this$static, participant, parentUrl, profileManger){
  var fullName, imageUrl, profile;
  profile = $getProfile(profileManger, participant);
  imageUrl = '';
  fullName = participant.address;
  if (profile) {
    imageUrl = (profile.imageUrl == null && (profile.imageUrl = 'static/images/unknown.jpg') , profile.imageUrl);
    imageUrl.indexOf('http://') == 0 || imageUrl.indexOf('https://') == 0 || imageUrl.indexOf('//') == 0 || (imageUrl = parentUrl + imageUrl);
  }
  $addParticipantInfo(this$static, participant.address, fullName, imageUrl);
}

function $addParticipantInfo(this$static, id, name_0, thumbnailUrl){
  var p = {id:id, displayName:name_0, thumbnailUrl:thumbnailUrl};
  this$static['participants'][id] = p;
}

function create_25(myId, authorId, participants, parentUrl, profileManger){
  var info, participant, participant$iterator;
  info = {myId:myId, authorId:authorId, participants:{}};
  for (participant$iterator = new AbstractList$IteratorImpl_0(participants); participant$iterator.i < participant$iterator.this$0_0.size_1();) {
    participant = dynamicCast($next_4(participant$iterator), 164);
    $addParticipant(info, participant, parentUrl, profileManger);
  }
  return info;
}

function SessionLocale_0(){
  this.localeString = '';
}

function SessionLocale(){
}

_ = SessionLocale_0.prototype = SessionLocale.prototype = new Object_0;
_.getClass$ = function getClass_767(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_SessionLocale_2_classLit;
}
;
_.castableTypeMap$ = {};
_.localeString = null;
function $submit_2(this$static){
  if (this$static.timeoutMs == 0) {
    $submitImmediately(this$static);
  }
   else {
    if (!this$static.submitScheduled) {
      this$static.submitScheduled = true;
      $schedule_1(new Submitter$1_0(this$static), this$static.timeoutMs);
    }
  }
}

function $submitIfScheduled(this$static){
  this$static.submitScheduled && $submitImmediately(this$static);
}

function $submitImmediately(this$static){
  var $e0, e;
  try {
    this$static.task.doSubmit();
    this$static.submitScheduled = false;
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 183)) {
      e = $e0;
      $clinit_1086();
      $log_0(LOG_3.traceLogger, 'Submit exception ' + e.getMessage());
    }
     else 
      throw $e0;
  }
}

function Submitter_0(task){
  this.task = task;
  this.timeoutMs = 30;
  this.submitScheduled = false;
}

function Submitter(){
}

_ = Submitter_0.prototype = Submitter.prototype = new Object_0;
_.getClass$ = function getClass_768(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_Submitter_2_classLit;
}
;
_.castableTypeMap$ = {};
_.submitScheduled = false;
_.task = null;
_.timeoutMs = 0;
function Submitter$1_0(this$0){
  this.this$0 = this$0;
  ScheduleTimer_1.call(this, ($clinit_1200() , LOW));
}

function Submitter$1(){
}

_ = Submitter$1_0.prototype = Submitter$1.prototype = new ScheduleTimer;
_.getClass$ = function getClass_769(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_Submitter$1_2_classLit;
}
;
_.run = function run_12(){
  $submitIfScheduled(this.this$0);
}
;
_.castableTypeMap$ = {251:1, 253:1};
_.this$0 = null;
function ConversationListenerImpl(){
}

_ = ConversationListenerImpl.prototype = new Object_0;
_.getClass$ = function getClass_770(){
  return Lorg_waveprotocol_wave_model_conversation_ConversationListenerImpl_2_classLit;
}
;
_.onBlipAdded = function onBlipAdded(blip){
}
;
_.onBlipContributorAdded = function onBlipContributorAdded(blip, contributor){
}
;
_.onBlipContributorRemoved = function onBlipContributorRemoved(blip, contributor){
}
;
_.onBlipDeleted = function onBlipDeleted(blip){
}
;
_.onBlipTimestampChanged = function onBlipTimestampChanged(blip, oldTimestamp, newTimestamp){
}
;
_.onParticipantAdded = function onParticipantAdded(participant){
}
;
_.onThreadAdded = function onThreadAdded(thread){
}
;
_.onThreadDeleted = function onThreadDeleted(thread){
}
;
_.castableTypeMap$ = {374:1};
function WaveletListenerAdapter_0(blip, listener){
  this.myBlip = blip;
  this.listener = listener;
}

function WaveletListenerAdapter(){
}

_ = WaveletListenerAdapter_0.prototype = WaveletListenerAdapter.prototype = new ConversationListenerImpl;
_.getClass$ = function getClass_771(){
  return Lorg_waveprotocol_wave_client_gadget_renderer_WaveletListenerAdapter_2_classLit;
}
;
_.onBlipContributorAdded = function onBlipContributorAdded_0(blip, contributor){
  blip == this.myBlip && $onBlipContributorAdded(this.listener, contributor);
}
;
_.onBlipContributorRemoved = function onBlipContributorRemoved_0(blip, contributor){
  blip == this.myBlip && $onBlipContributorRemoved(this.listener, contributor);
}
;
_.onParticipantAdded = function onParticipantAdded_0(participant){
  $onParticipantAdded(this.listener, participant);
}
;
_.castableTypeMap$ = {374:1};
_.listener = null;
_.myBlip = null;
function $render_2(this$static, conversation){
  var participant, participant$iterator, participants;
  participants = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  for (participant$iterator = ($clinit_480() , new Collections$UnmodifiableSet_0(new Collections$UnmodifiableSet_0(conversation.wavelet.wavelet.participants))).iterator_0(); participant$iterator.hasNext();) {
    participant = dynamicCast(participant$iterator.next_0(), 164);
    participants.put_3(participant.address, $render_8(this$static.builders, conversation, participant));
  }
  return $render_6(this$static.builders, conversation, $render_7(this$static.builders, conversation, participants), $renderInner(this$static, conversation.rootThread));
}

function $render_4(this$static, thread){
  return $render_11(this$static.builders, thread, $renderInner(this$static, thread));
}

function $render_5(this$static, blip){
  var conversation, conversation$iterator, defaultAnchorRs, documentR, nestedRs, reply, reply$iterator, threadRs, manifestBlips, result, anchored, manifestBlips_0, result_0;
  threadRs = null;
  for (reply$iterator = $iterator_12((manifestBlips = blip.manifestBlip.replies.orderedValues , new WaveletBasedConversationBlip$2_0(blip, manifestBlips))); reply$iterator.next != null;) {
    reply = dynamicCast((result = reply$iterator.next , $advance(reply$iterator) , result), 248);
    !threadRs && (threadRs = ($clinit_2309() , defaultCollectionFactory.createIdentityMap()));
    threadRs.put_0(reply, $renderInner(this$static, reply));
  }
  threadRs = threadRs?threadRs:($clinit_2309() , $clinit_2309() , EMPTY_1);
  nestedRs = null;
  for (conversation$iterator = (anchored = dynamicCast(this$static.structure.anchoring.get(blip), 363) , anchored?anchored:($clinit_480() , $clinit_480() , EMPTY_SET)).iterator_0(); conversation$iterator.hasNext();) {
    conversation = dynamicCast(conversation$iterator.next_0(), 249);
    !nestedRs && (nestedRs = ($clinit_2309() , defaultCollectionFactory.createIdentityMap()));
    nestedRs.put_0(conversation, $render_2(this$static, conversation));
  }
  nestedRs = nestedRs?nestedRs:($clinit_2309() , $clinit_2309() , EMPTY_1);
  documentR = ($add_25(this$static.builders.docRenderer.val$pager, blip) , new UiBuilder$Constant$1_0(($clinit_592() , new SafeHtmlString_0('<div><\/div>'))));
  defaultAnchorRs = null;
  for (reply$iterator = $iterator_12((manifestBlips_0 = blip.manifestBlip.replies.orderedValues , new WaveletBasedConversationBlip$2_0(blip, manifestBlips_0))); reply$iterator.next != null;) {
    reply = dynamicCast((result_0 = reply$iterator.next , $advance(reply$iterator) , result_0), 248);
    !defaultAnchorRs && (defaultAnchorRs = ($clinit_2309() , defaultCollectionFactory.createIdentityMap()));
    defaultAnchorRs.put_0(reply, $render_11(this$static.builders, reply, dynamicCast(threadRs.get(reply), 16)));
  }
  defaultAnchorRs = defaultAnchorRs?defaultAnchorRs:($clinit_2309() , $clinit_2309() , EMPTY_1);
  return $render_10(this$static.builders, blip, documentR, defaultAnchorRs, nestedRs);
}

function $renderInner(this$static, thread){
  var blip, blip$iterator, blips, manifestBlips, result;
  blips = null;
  for (blip$iterator = $iterator_13((manifestBlips = thread.manifestThread.blips.orderedValues , new WaveletBasedConversationThread$1_0(thread, manifestBlips))); blip$iterator.next != null;) {
    blip = dynamicCast((result = blip$iterator.next , $advance(blip$iterator) , result), 247);
    !blips && (blips = ($clinit_2309() , defaultCollectionFactory.createIdentityMap()));
    blips.put_0(blip, $render_5(this$static, blip));
  }
  return $render_9(this$static.builders, thread, blips?blips:($clinit_2309() , $clinit_2309() , EMPTY_1));
}

function $schedule_2(this$static, priority, task){
  checkArgument_2(priority != ($clinit_1200() , INTERNAL_SUPPRESS), "Don't use internal level");
  $scheduleJob(this$static, priority, task);
}

function $schedule_3(this$static, priority, process){
  checkArgument_2(priority != ($clinit_1200() , INTERNAL_SUPPRESS), "Don't use internal level");
  $scheduleJob(this$static, priority, process);
}

function $scheduleRepeating_1(this$static, priority, process, minimumTime, interval){
  checkArgument_2(minimumTime >= 0, 'Minimum time must be at least zero');
  checkArgument_2(interval >= 0, 'Interval must be at least zero');
  checkArgument_2(priority != ($clinit_1200() , INTERNAL_SUPPRESS), "Don't use internal level");
  interval == 0 && minimumTime == 0 && (checkArgument_2(priority != INTERNAL_SUPPRESS, "Don't use internal level") , $scheduleJob(this$static, priority, process));
  $scheduleDelayedJob(this$static, priority, process, minimumTime, interval);
}

function FinalTaskRunnerImpl$1_0(this$0){
  this.this$0 = this$0;
}

function FinalTaskRunnerImpl$1(){
}

_ = FinalTaskRunnerImpl$1_0.prototype = FinalTaskRunnerImpl$1.prototype = new Object_0;
_.execute_0 = function execute_47(){
  var task;
  this.this$0.begin();
  this.this$0.isExecuting = true;
  try {
    while (!this.this$0.tasks.isEmpty()) {
      task = dynamicCast(this.this$0.tasks.someElement(), 252);
      this.this$0.tasks.remove_6(task);
      task.execute_0();
    }
  }
   finally {
    this.this$0.isExecuting = false;
    this.this$0.end_0();
  }
}
;
_.getClass$ = function getClass_778(){
  return Lorg_waveprotocol_wave_client_scheduler_FinalTaskRunnerImpl$1_2_classLit;
}
;
_.castableTypeMap$ = {42:1};
_.this$0 = null;
function $cancel_4(this$static){
  $cancel_3(this$static.timer.scheduler, this$static);
}

function QueueProcessor(){
}

_ = QueueProcessor.prototype = new Object_0;
_.execute = function execute_48(){
  $process(this, dynamicCast(this.queue.poll(), 247));
  return !this.queue.isEmpty();
}
;
_.getClass$ = function getClass_782(){
  return Lorg_waveprotocol_wave_client_scheduler_QueueProcessor_2_classLit;
}
;
_.castableTypeMap$ = {251:1, 253:1};
_.queue = null;
_.timer = null;
function $clinit_1197(){
  $clinit_1197 = nullMethod;
  scheduler_0 = (!instance_7 && (instance_7 = new BrowserBackedScheduler_0 , setDefaultTimerService() , undefined) , instance_7);
}

var scheduler_0;
function $schedule_6(this$static, process){
  $schedule_3(this$static.scheduler, this$static.priority, process);
}

function $scheduleDelayed_1(this$static, process, minimumTime){
  $scheduleRepeating_1(this$static.scheduler, this$static.priority, process, minimumTime, 0);
}

function $scheduleRepeating_2(this$static, process, minimumTime, interval){
  $scheduleRepeating_1(this$static.scheduler, this$static.priority, process, minimumTime, interval);
}

function SchedulerTimerService_0(scheduler){
  SchedulerTimerService_1.call(this, scheduler, ($clinit_1200() , LOW));
}

_ = SchedulerTimerService_0.prototype = SchedulerTimerService.prototype;
function $countDownEvent(this$static){
  --this$static.eventLatch;
  if (this$static.eventLatch == 0 && !this$static.eventThreads.isEmpty()) {
    $notifyListeners_0(this$static, this$static.eventThreads);
    this$static.eventThreads.clear();
  }
}

function $getOrCreateThreadState(this$static, thread){
  var state;
  state = dynamicCast(this$static.threadStates.get(thread), 257);
  if (!state) {
    state = new ThreadReadStateMonitorImpl$ThreadReadState_0(this$static, thread);
    this$static.threadStates.put_0(thread, state);
  }
  return state;
}

function $getReadCount(this$static, thread){
  var state;
  checkState_0(this$static.isReady, 'ThreadReadStateMonitor queried before ready');
  return $getReadCount_0((state = $getOrCreateThreadState(this$static, thread) , state.isMonitored = true , state));
}

function $getTotalCount(this$static, thread){
  var state, state_0;
  return (checkState_0(this$static.isReady, 'ThreadReadStateMonitor queried before ready') , $getReadCount_0((state = $getOrCreateThreadState(this$static, thread) , state.isMonitored = true , state))) + (checkState_0(this$static.isReady, 'ThreadReadStateMonitor queried before ready') , $getUnreadCount_0((state_0 = $getOrCreateThreadState(this$static, thread) , state_0.isMonitored = true , state_0)));
}

function $getUnreadCount(this$static, thread){
  var state;
  checkState_0(this$static.isReady, 'ThreadReadStateMonitor queried before ready');
  return $getUnreadCount_0((state = $getOrCreateThreadState(this$static, thread) , state.isMonitored = true , state));
}

function $handleBlipAdded(this$static, blip){
  var replyThread, replyThread$iterator, state, thread, manifestBlips, result;
  if (!$handleBlipAdded_0(this$static.knownBlips, blip)) {
    return;
  }
  ++this$static.eventLatch;
  thread = blip.parentThread;
  while (thread) {
    state = dynamicCast(this$static.threadStates.get(thread), 257);
    if (state) {
      $isUnread(state.this$0.supplementedWave, blip)?++state.unreadCount:++state.readCount;
      state.isMonitored && this$static.eventThreads.add_2(state.thread);
    }
    thread = thread.parentBlip?thread.parentBlip.parentThread:null;
  }
  for (replyThread$iterator = $iterator_12((manifestBlips = blip.manifestBlip.replies.orderedValues , new WaveletBasedConversationBlip$2_0(blip, manifestBlips))); replyThread$iterator.next != null;) {
    replyThread = dynamicCast((result = replyThread$iterator.next , $advance(replyThread$iterator) , result), 258);
    $handleThreadAdded(this$static, replyThread);
  }
  $countDownEvent(this$static);
}

function $handleBlipRemoved(this$static, blip){
  var replyThread, replyThread$iterator, state, thread, manifestBlips, result;
  if (!$handleBlipRemoved_0(this$static.knownBlips, blip)) {
    return;
  }
  ++this$static.eventLatch;
  thread = blip.parentThread;
  while (thread) {
    state = dynamicCast(this$static.threadStates.get(thread), 257);
    if (state) {
      $isUnread(state.this$0.supplementedWave, blip)?--state.unreadCount:--state.readCount;
      state.isMonitored && this$static.eventThreads.add_2(state.thread);
    }
    thread = thread.parentBlip?thread.parentBlip.parentThread:null;
  }
  for (replyThread$iterator = $iterator_12((manifestBlips = blip.manifestBlip.replies.orderedValues , new WaveletBasedConversationBlip$2_0(blip, manifestBlips))); replyThread$iterator.next != null;) {
    replyThread = dynamicCast((result = replyThread$iterator.next , $advance(replyThread$iterator) , result), 258);
    $handleThreadRemoved(this$static, replyThread);
  }
  $countDownEvent(this$static);
}

function $handleThreadAdded(this$static, thread){
  var blip, blip$iterator, manifestBlips, result;
  for (blip$iterator = $iterator_13((manifestBlips = thread.manifestThread.blips.orderedValues , new WaveletBasedConversationThread$1_0(thread, manifestBlips))); blip$iterator.next != null;) {
    blip = dynamicCast((result = blip$iterator.next , $advance(blip$iterator) , result), 256);
    $handleBlipAdded(this$static, blip);
  }
}

function $handleThreadRemoved(this$static, thread){
  var blip, blip$iterator, manifestBlips, result;
  this$static.threadStates.remove_6(thread);
  for (blip$iterator = $iterator_13((manifestBlips = thread.manifestThread.blips.orderedValues , new WaveletBasedConversationThread$1_0(thread, manifestBlips))); blip$iterator.next != null;) {
    blip = dynamicCast((result = blip$iterator.next , $advance(blip$iterator) , result), 256);
    $handleBlipRemoved(this$static, blip);
  }
}

function $init_4(this$static){
  var conversation, conversation$iterator;
  for (conversation$iterator = ($clinit_480() , new Collections$UnmodifiableCollection_0($values(this$static.conversationView.conversations))).iterator_0(); conversation$iterator.hasNext();) {
    conversation = dynamicCast(conversation$iterator.next_0(), 255);
    $handleThreadAdded(this$static, conversation.rootThread);
    $add_31(conversation.listeners, this$static);
  }
  $add_31(this$static.conversationView.listeners, this$static);
  $addListener_1(this$static.supplementedWave, this$static);
  this$static.isReady = true;
  if (!this$static.threadsToNotifyWhenReady.isEmpty()) {
    this$static.threadsToNotifyWhenReady.each_0(new ThreadReadStateMonitorImpl$1_0(this$static));
    $notifyListeners_0(this$static, this$static.threadsToNotifyWhenReady);
    this$static.threadsToNotifyWhenReady.clear();
    this$static.threadsToNotifyWhenReady = null;
  }
}

function $monitor(this$static, thread){
  var state;
  this$static.isReady?(state = $getOrCreateThreadState(this$static, thread) , state.isMonitored = true , state):this$static.threadsToNotifyWhenReady.add_2(thread);
}

function $notifyListeners_0(this$static, threads){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 259);
    threads.each_0(new LiveSupplementRenderer$1_0(listener));
  }
}

function $registerEventIfMonitored(this$static, state){
  state.isMonitored && this$static.eventThreads.add_2(state.thread);
}

function ThreadReadStateMonitorImpl_0(supplementedWave, conversationView){
  this.knownBlips = new ThreadReadStateMonitorImpl$ReadStateBucket_0(this);
  this.threadStates = ($clinit_2309() , defaultCollectionFactory.createIdentityMap());
  this.listeners = ($clinit_2326() , $clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
  this.eventThreads = defaultCollectionFactory.createIdentitySet();
  this.threadsToNotifyWhenReady = defaultCollectionFactory.createIdentitySet();
  checkNotNull_0(supplementedWave, 'supplementedWave cannot be null');
  checkNotNull_0(conversationView, 'conversationView cannot be null');
  this.supplementedWave = supplementedWave;
  this.conversationView = conversationView;
}

function ThreadReadStateMonitorImpl(){
}

_ = ThreadReadStateMonitorImpl_0.prototype = ThreadReadStateMonitorImpl.prototype = new ObservableSupplementedWave$ListenerImpl;
_.getClass$ = function getClass_795(){
  return Lorg_waveprotocol_wave_client_state_ThreadReadStateMonitorImpl_2_classLit;
}
;
_.onBlipAdded = function onBlipAdded_0(blip){
  $handleBlipAdded(this, blip);
}
;
_.onBlipContributorAdded = function onBlipContributorAdded_1(blip, contributor){
}
;
_.onBlipContributorRemoved = function onBlipContributorRemoved_1(blip, contributor){
}
;
_.onBlipDeleted = function onBlipDeleted_0(blip){
  $handleBlipRemoved(this, blip);
}
;
_.onBlipTimestampChanged = function onBlipTimestampChanged_0(blip, oldTimestamp, newTimestamp){
}
;
_.onConversationAdded = function onConversationAdded(conversation){
  $handleThreadAdded(this, conversation.rootThread);
  $add_31(conversation.listeners, this);
}
;
_.onConversationRemoved = function onConversationRemoved(conversation){
  $remove_42(conversation.listeners, this);
  $handleThreadRemoved(this, conversation.rootThread);
}
;
_.onMaybeBlipReadChanged = function onMaybeBlipReadChanged_0(blip){
  var state, thread;
  if (!$handleMaybeBlipReadStateChanged(this.knownBlips, blip)) {
    return;
  }
  ++this.eventLatch;
  thread = blip.parentThread;
  while (thread) {
    state = dynamicCast(this.threadStates.get(thread), 257);
    if (state) {
      $handleBlipReadStateChanged(state, blip);
      state.isMonitored && this.eventThreads.add_2(state.thread);
    }
    thread = thread.parentBlip?thread.parentBlip.parentThread:null;
  }
  $countDownEvent(this);
}
;
_.onMaybeWaveletReadChanged = function onMaybeWaveletReadChanged_0(){
  ++this.eventLatch;
  $handleWaveletReadStateChanged(this.knownBlips);
  this.threadStates.each(new ThreadReadStateMonitorImpl$2_0(this));
  $countDownEvent(this);
}
;
_.onParticipantAdded = function onParticipantAdded_1(participant){
}
;
_.onThreadAdded = function onThreadAdded_0(thread){
  $handleThreadAdded(this, thread);
}
;
_.onThreadDeleted = function onThreadDeleted_0(thread){
  $handleThreadRemoved(this, thread);
}
;
_.castableTypeMap$ = {264:1, 372:1, 374:1};
_.conversationView = null;
_.eventLatch = 0;
_.isReady = false;
_.supplementedWave = null;
function ThreadReadStateMonitorImpl$1_0(this$0){
  this.this$0 = this$0;
}

function ThreadReadStateMonitorImpl$1(){
}

_ = ThreadReadStateMonitorImpl$1_0.prototype = ThreadReadStateMonitorImpl$1.prototype = new Object_0;
_.apply_7 = function apply_61(thread){
  $monitor(this.this$0, dynamicCast(thread, 248));
}
;
_.getClass$ = function getClass_796(){
  return Lorg_waveprotocol_wave_client_state_ThreadReadStateMonitorImpl$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $apply_13(this$static, state){
  state.isDirty = true;
  $registerEventIfMonitored(this$static.this$0, state);
}

function ThreadReadStateMonitorImpl$2_0(this$0){
  this.this$0 = this$0;
}

function ThreadReadStateMonitorImpl$2(){
}

_ = ThreadReadStateMonitorImpl$2_0.prototype = ThreadReadStateMonitorImpl$2.prototype = new Object_0;
_.apply_3 = function apply_62(thread, state){
  $apply_13(this, (dynamicCast(thread, 248) , dynamicCast(state, 257)));
}
;
_.getClass$ = function getClass_797(){
  return Lorg_waveprotocol_wave_client_state_ThreadReadStateMonitorImpl$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $contains_8(this$static, blip){
  return this$static.readBlips.contains(blip) || this$static.unreadBlips.contains(blip);
}

function $handleBlipAdded_0(this$static, blip){
  if (this$static.readBlips.contains(blip) || this$static.unreadBlips.contains(blip)) {
    return false;
  }
   else {
    $isUnread(this$static.this$0.supplementedWave, blip)?this$static.unreadBlips.add_2(blip):this$static.readBlips.add_2(blip);
    return true;
  }
}

function $handleBlipRemoved_0(this$static, blip){
  if (this$static.readBlips.contains(blip) || this$static.unreadBlips.contains(blip)) {
    this$static.unreadBlips.remove_6(blip);
    this$static.readBlips.remove_6(blip);
    return true;
  }
   else {
    return false;
  }
}

function $handleMaybeBlipReadStateChanged(this$static, blip){
  if ($isUnread(this$static.this$0.supplementedWave, blip)) {
    if (this$static.readBlips.contains(blip)) {
      this$static.readBlips.remove_6(blip);
      this$static.unreadBlips.add_2(blip);
      return true;
    }
  }
   else {
    if (this$static.unreadBlips.contains(blip)) {
      this$static.unreadBlips.remove_6(blip);
      this$static.readBlips.add_2(blip);
      return true;
    }
  }
  return false;
}

function $handleWaveletReadStateChanged(this$static){
  var changedBlips;
  changedBlips = ($clinit_2309() , defaultCollectionFactory.createIdentitySet());
  this$static.readBlips.each_0(new ThreadReadStateMonitorImpl$ReadStateBucket$1_0(this$static, changedBlips));
  this$static.unreadBlips.each_0(new ThreadReadStateMonitorImpl$ReadStateBucket$2_0(this$static, changedBlips));
  changedBlips.each_0(new ThreadReadStateMonitorImpl$ReadStateBucket$3_0(this$static));
  return !changedBlips.isEmpty();
}

function ThreadReadStateMonitorImpl$ReadStateBucket_0(this$0){
  this.this$0 = this$0;
  this.readBlips = ($clinit_2309() , defaultCollectionFactory.createIdentitySet());
  this.unreadBlips = defaultCollectionFactory.createIdentitySet();
}

function ThreadReadStateMonitorImpl$ReadStateBucket(){
}

_ = ThreadReadStateMonitorImpl$ReadStateBucket_0.prototype = ThreadReadStateMonitorImpl$ReadStateBucket.prototype = new Object_0;
_.getClass$ = function getClass_798(){
  return Lorg_waveprotocol_wave_client_state_ThreadReadStateMonitorImpl$ReadStateBucket_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $apply_14(this$static, blip){
  $isUnread(this$static.this$1.this$0.supplementedWave, blip) && this$static.val$changedBlips.add_2(blip);
}

function ThreadReadStateMonitorImpl$ReadStateBucket$1_0(this$1, val$changedBlips){
  this.this$1 = this$1;
  this.val$changedBlips = val$changedBlips;
}

function ThreadReadStateMonitorImpl$ReadStateBucket$1(){
}

_ = ThreadReadStateMonitorImpl$ReadStateBucket$1_0.prototype = ThreadReadStateMonitorImpl$ReadStateBucket$1.prototype = new Object_0;
_.apply_7 = function apply_63(blip){
  $apply_14(this, dynamicCast(blip, 247));
}
;
_.getClass$ = function getClass_799(){
  return Lorg_waveprotocol_wave_client_state_ThreadReadStateMonitorImpl$ReadStateBucket$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
_.val$changedBlips = null;
function $apply_15(this$static, blip){
  $isUnread(this$static.this$1.this$0.supplementedWave, blip) || this$static.val$changedBlips.add_2(blip);
}

function ThreadReadStateMonitorImpl$ReadStateBucket$2_0(this$1, val$changedBlips){
  this.this$1 = this$1;
  this.val$changedBlips = val$changedBlips;
}

function ThreadReadStateMonitorImpl$ReadStateBucket$2(){
}

_ = ThreadReadStateMonitorImpl$ReadStateBucket$2_0.prototype = ThreadReadStateMonitorImpl$ReadStateBucket$2.prototype = new Object_0;
_.apply_7 = function apply_64(blip){
  $apply_15(this, dynamicCast(blip, 247));
}
;
_.getClass$ = function getClass_800(){
  return Lorg_waveprotocol_wave_client_state_ThreadReadStateMonitorImpl$ReadStateBucket$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
_.val$changedBlips = null;
function ThreadReadStateMonitorImpl$ReadStateBucket$3_0(this$1){
  this.this$1 = this$1;
}

function ThreadReadStateMonitorImpl$ReadStateBucket$3(){
}

_ = ThreadReadStateMonitorImpl$ReadStateBucket$3_0.prototype = ThreadReadStateMonitorImpl$ReadStateBucket$3.prototype = new Object_0;
_.apply_7 = function apply_65(blip){
  $handleMaybeBlipReadStateChanged(this.this$1, dynamicCast(blip, 247));
}
;
_.getClass$ = function getClass_801(){
  return Lorg_waveprotocol_wave_client_state_ThreadReadStateMonitorImpl$ReadStateBucket$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
function $countBlips(this$static){
  this$static.readCount = 0;
  this$static.unreadCount = 0;
  $countBlipsInner(this$static, this$static.thread);
  this$static.isDirty = false;
}

function $countBlipsInner(this$static, thread){
  var blip, blip$iterator, replyState, replyThread, replyThread$iterator, manifestBlips, result, manifestBlips_0, result_0;
  for (blip$iterator = $iterator_13((manifestBlips = thread.manifestThread.blips.orderedValues , new WaveletBasedConversationThread$1_0(thread, manifestBlips))); blip$iterator.next != null;) {
    blip = dynamicCast((result = blip$iterator.next , $advance(blip$iterator) , result), 247);
    $contains_8(this$static.this$0.knownBlips, blip) && ($isUnread(this$static.this$0.supplementedWave, blip)?++this$static.unreadCount:++this$static.readCount);
    for (replyThread$iterator = $iterator_12((manifestBlips_0 = blip.manifestBlip.replies.orderedValues , new WaveletBasedConversationBlip$2_0(blip, manifestBlips_0))); replyThread$iterator.next != null;) {
      replyThread = dynamicCast((result_0 = replyThread$iterator.next , $advance(replyThread$iterator) , result_0), 248);
      replyState = $getOrCreateThreadState(this$static.this$0, replyThread);
      this$static.readCount += (replyState.isDirty && $countBlips(replyState) , replyState.readCount);
      this$static.unreadCount += (replyState.isDirty && $countBlips(replyState) , replyState.unreadCount);
    }
  }
}

function $getReadCount_0(this$static){
  this$static.isDirty && $countBlips(this$static);
  return this$static.readCount;
}

function $getUnreadCount_0(this$static){
  this$static.isDirty && $countBlips(this$static);
  return this$static.unreadCount;
}

function $handleBlipReadStateChanged(this$static, blip){
  if ($isUnread(this$static.this$0.supplementedWave, blip)) {
    ++this$static.unreadCount;
    --this$static.readCount;
  }
   else {
    ++this$static.readCount;
    --this$static.unreadCount;
  }
}

function ThreadReadStateMonitorImpl$ThreadReadState_0(this$0, thread){
  this.this$0 = this$0;
  this.thread = thread;
}

function ThreadReadStateMonitorImpl$ThreadReadState(){
}

_ = ThreadReadStateMonitorImpl$ThreadReadState_0.prototype = ThreadReadStateMonitorImpl$ThreadReadState.prototype = new Object_0;
_.getClass$ = function getClass_802(){
  return Lorg_waveprotocol_wave_client_state_ThreadReadStateMonitorImpl$ThreadReadState_2_classLit;
}
;
_.castableTypeMap$ = {257:1};
_.isDirty = true;
_.isMonitored = false;
_.readCount = 0;
_.this$0 = null;
_.thread = null;
_.unreadCount = 0;
function BuilderHelper$1_0(val$uis){
  this.val$uis = val$uis;
}

function BuilderHelper$1(){
}

_ = BuilderHelper$1_0.prototype = BuilderHelper$1.prototype = new Object_0;
_.getClass$ = function getClass_814(){
  return Lorg_waveprotocol_wave_client_uibuilder_BuilderHelper$1_2_classLit;
}
;
_.outputHtml = function outputHtml(out){
  var ui, ui$array, ui$index, ui$max;
  for (ui$array = this.val$uis , ui$index = 0 , ui$max = ui$array.length; ui$index < ui$max; ++ui$index) {
    ui = ui$array[ui$index];
    (ui?ui:($clinit_1251() , EMPTY_0)).outputHtml(out);
  }
}
;
_.castableTypeMap$ = {15:1};
_.val$uis = null;
function $clinit_1247(){
  $clinit_1247 = nullMethod;
  EMPTY = new HtmlClosure$1_0;
}

var EMPTY;
function HtmlClosure$1_0(){
}

function HtmlClosure$1(){
}

_ = HtmlClosure$1_0.prototype = HtmlClosure$1.prototype = new Object_0;
_.getClass$ = function getClass_815(){
  return Lorg_waveprotocol_wave_client_uibuilder_HtmlClosure$1_2_classLit;
}
;
_.outputHtml = function outputHtml_0(out){
}
;
_.castableTypeMap$ = {15:1};
function $add_22(this$static, child){
  !this$static.children_0 && (this$static.children_0 = ($clinit_2309() , defaultCollectionFactory.createQueue()));
  this$static.children_0.add_0(child);
}

function $outputHtml(this$static, out){
  var builder, builder$iterator;
  if (this$static.children_0) {
    for (builder$iterator = this$static.children_0.iterator_0(); builder$iterator.hasNext();) {
      builder = dynamicCast(builder$iterator.next_0(), 15);
      builder.outputHtml(out);
    }
  }
}

function HtmlClosureCollection_0(){
}

function HtmlClosureCollection(){
}

_ = HtmlClosureCollection_0.prototype = HtmlClosureCollection.prototype = new Object_0;
_.getClass$ = function getClass_816(){
  return Lorg_waveprotocol_wave_client_uibuilder_HtmlClosureCollection_2_classLit;
}
;
_.outputHtml = function outputHtml_1(out){
  $outputHtml(this, out);
}
;
_.castableTypeMap$ = {15:1};
_.children_0 = null;
function append(builder, id){
  $append_11(builder.sb, '<div' + (id != null?" id='" + id + "'":'') + " class='C-DP-org-waveprotocol-wave-client-wavepanel-view-dom-full-TopConversationViewBuilder-Css-toolbar'>");
  $append_11(builder.sb, '<\/div>');
}

function appendSpan(builder, id, style, kind){
  $append_11(builder.sb, '<span' + (id != null?" id='" + id + "'":'') + (style != null?" class='" + style + "'":'') + (kind != null?" kind='" + kind + "'":'') + '>');
  $append_11(builder.sb, '<\/span>');
}

function image_0(builder, id, style, url, info){
  var img, safeUrl;
  safeUrl = url?sanitizeUri(url.html):null;
  img = ($clinit_592() , new SafeHtmlString_0("<img id='" + id + "' class='" + style + "' " + (safeUrl != null?"src='" + safeUrl + "' ":'') + (info?" alt='" + info.html + "' title='" + info.html + "' ":'') + '><\/img>'));
  $append_11(builder.sb, img.html);
}

function open_1(builder, id, clazz, kind){
  $append_11(builder.sb, '<div' + (id != null?" id='" + id + "'":'') + (clazz != null?" class='" + clazz + "'":'') + (kind != null?" kind='" + kind + "'":'') + '>');
}

function openSpan(builder, id, clazz, kind){
  $append_11(builder.sb, '<span' + (id != null?" id='" + id + "'":'') + (clazz != null?" class='" + clazz + "'":'') + (kind != null?" kind='" + kind + "'":'') + '>');
}

function openSpanWith(builder, id, clazz, kind, extra){
  $append_11(builder.sb, '<span' + (id != null?" id='" + id + "'":'') + (clazz != null?" class='" + clazz + "'":'') + (kind != null?" kind='" + kind + "'":'') + (extra != null?' ' + extra:'') + '>');
}

function openWith(builder, id, clazz, kind, extra){
  $append_11(builder.sb, '<div' + (id != null?" id='" + id + "'":'') + (clazz != null?" class='" + clazz + "'":'') + (kind != null?" kind='" + kind + "'":'') + (extra != null?' ' + extra:'') + '>');
}

function $clinit_1251(){
  $clinit_1251 = nullMethod;
  EMPTY_0 = new UiBuilder$1_0;
}

var EMPTY_0;
function UiBuilder$1_0(){
}

function UiBuilder$1(){
}

_ = UiBuilder$1_0.prototype = UiBuilder$1.prototype = new Object_0;
_.getClass$ = function getClass_817(){
  return Lorg_waveprotocol_wave_client_uibuilder_UiBuilder$1_2_classLit;
}
;
_.outputHtml = function outputHtml_2(out){
}
;
_.castableTypeMap$ = {15:1, 16:1};
function UiBuilder$Constant$1_0(val$html){
  this.val$html = val$html;
}

function UiBuilder$Constant$1(){
}

_ = UiBuilder$Constant$1_0.prototype = UiBuilder$Constant$1.prototype = new Object_0;
_.getClass$ = function getClass_818(){
  return Lorg_waveprotocol_wave_client_uibuilder_UiBuilder$Constant$1_2_classLit;
}
;
_.outputHtml = function outputHtml_3(out){
  $append_13(out, this.val$html);
}
;
_.castableTypeMap$ = {15:1, 16:1};
_.val$html = null;
function $consume_16(this$static, op){
  checkState(!this$static.hasDiffs);
  $consume_6(this$static.document_0, op);
}

function $consumeAsDiff(this$static, op){
  var $e0, e;
  try {
    $consume_12(this$static.differ, op);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 189)) {
      e = $e0;
      throw new OperationRuntimeException_0('error applying diff op', e);
    }
     else 
      throw $e0;
  }
  this$static.hasDiffs = true;
}

function DiffContentDocument_0(document_0, differ){
  this.document_0 = document_0;
  this.differ = differ;
}

function DiffContentDocument(){
}

_ = DiffContentDocument_0.prototype = DiffContentDocument.prototype = new Object_0;
_.clearDiffs = function clearDiffs_0(){
  clearDiffs(this.differ.inner);
  this.hasDiffs = false;
}
;
_.consume = function consume_7(op){
  $consume_16(this, dynamicCast(op, 207));
}
;
_.consumeAsDiff = function consumeAsDiff(op){
  $consumeAsDiff(this, op);
}
;
_.getClass$ = function getClass_826(){
  return Lorg_waveprotocol_wave_client_wave_DiffContentDocument_2_classLit;
}
;
_.castableTypeMap$ = {261:1};
_.differ = null;
_.document_0 = null;
_.hasDiffs = false;
function $firstAnnotationChange_5(this$static, start, end, key, fromValue){
  return $firstAnnotationChange_2(this$static.getDelegate().doc, start, end, key, fromValue);
}

function $getDelegate(this$static){
  if (!this$static.delegate) {
    throw new IllegalStateException_1('MutableDocumentProxy: ' + this$static.noDelegateErrorMessage);
  }
  return this$static.delegate;
}

function $lastAnnotationChange_4(this$static, start, end, key, fromValue){
  return $lastAnnotationChange_2(this$static.getDelegate().doc, start, end, key, fromValue);
}

function MutableDocumentProxy(){
}

_ = MutableDocumentProxy.prototype = new Object_0;
_.annotationIntervals = function annotationIntervals_3(start, end, keys){
  return $annotationIntervals_1(this.getDelegate().doc, start, end, keys);
}
;
_.asElement_0 = function asElement_7(node){
  return this.getDelegate().doc.substrate.asElement_0(node);
}
;
_.asText_0 = function asText_7(node){
  return this.getDelegate().doc.substrate.asText_0(node);
}
;
_.createChildElement = function createChildElement_0(parent_0, tag, attributes){
  return $createChildElement(this.getDelegate(), parent_0, tag, attributes);
}
;
_.createElement_0 = function createElement_6(point, tag, attributes){
  return $createElement_1(this.getDelegate(), point, tag, attributes);
}
;
_.deleteNode = function deleteNode_0(element){
  $deleteNode(this.getDelegate(), element);
}
;
_.emptyElement = function emptyElement_1(element){
  $emptyElement(this.getDelegate(), element);
}
;
_.firstAnnotationChange = function firstAnnotationChange_3(start, end, key, fromValue){
  return $firstAnnotationChange_5(this, start, end, key, dynamicCast(fromValue, 1));
}
;
_.forEachAnnotationAt = function forEachAnnotationAt_3(location_0, callback){
  this.getDelegate().doc.annotations.forEachAnnotationAt(location_0, new IndexedDocumentImpl$7_0(callback));
}
;
_.getAnnotation = function getAnnotation_3(location_0, key){
  return $getAnnotation_2(this.getDelegate().doc, location_0, key);
}
;
_.getAttribute_0 = function getAttribute_4(element, name_0){
  return this.getDelegate().doc.substrate.getAttribute_0(element, name_0);
}
;
_.getAttributes = function getAttributes_4(element){
  return this.getDelegate().doc.substrate.getAttributes(element);
}
;
_.getClass$ = function getClass_827(){
  return Lorg_waveprotocol_wave_model_document_util_MutableDocumentProxy_2_classLit;
}
;
_.getData = function getData_4(textNode){
  return this.getDelegate().doc.substrate.getData(textNode);
}
;
_.getDelegate = function getDelegate(){
  return $getDelegate(this);
}
;
_.getDocumentElement = function getDocumentElement_6(){
  return this.getDelegate().doc.substrate.getDocumentElement();
}
;
_.getFirstChild_0 = function getFirstChild_9(node){
  return this.getDelegate().doc.substrate.getFirstChild_0(node);
}
;
_.getLastChild_0 = function getLastChild_9(node){
  return this.getDelegate().doc.substrate.getLastChild_0(node);
}
;
_.getLength = function getLength_4(textNode){
  return this.getDelegate().doc.substrate.getLength(textNode);
}
;
_.getLocation = function getLocation_5(node){
  return this.getDelegate().doc.getLocation(node);
}
;
_.getNextSibling = function getNextSibling_7(node){
  return this.getDelegate().doc.substrate.getNextSibling(node);
}
;
_.getNodeType_0 = function getNodeType_6(node){
  return this.getDelegate().doc.substrate.getNodeType_0(node);
}
;
_.getParentElement = function getParentElement_5(node){
  return this.getDelegate().doc.substrate.getParentElement(node);
}
;
_.getPreviousSibling = function getPreviousSibling_7(node){
  return this.getDelegate().doc.substrate.getPreviousSibling(node);
}
;
_.getTagName = function getTagName_4(element){
  return this.getDelegate().doc.substrate.getTagName(element);
}
;
_.insertXml = function insertXml_0(point, xml){
  return $insertXml(this.getDelegate(), point, xml);
}
;
_.isSameNode = function isSameNode_4(node, other){
  return this.getDelegate().doc.substrate.isSameNode(node, other);
}
;
_.lastAnnotationChange = function lastAnnotationChange_3(start, end, key, fromValue){
  return $lastAnnotationChange_4(this, start, end, key, dynamicCast(fromValue, 1));
}
;
_.locate = function locate_2(location_0){
  return $locate_0(this.getDelegate().doc, location_0);
}
;
_.resetAnnotation = function resetAnnotation_1(start, end, key, value){
  $resetAnnotation(this.getDelegate(), start, end, key, value);
}
;
_.size_1 = function size_36(){
  return $size_15(this.getDelegate().doc);
}
;
_.toString$ = function toString_77(){
  return 'MutableDocumentProxy(' + $toString_18(this.getDelegate()) + ')';
}
;
_.with_$ = function with_$_0(actionToRunWithDocument){
  $with(this.getDelegate(), actionToRunWithDocument);
}
;
_.castableTypeMap$ = {19:1};
_.delegate = null;
_.noDelegateErrorMessage = null;
function $clearDiffs(this$static){
  if (this$static.diffsSuppressed)
  ;
  else {
    if (this$static.diffsRetained)
    ;
    else {
      dynamicCast(this$static.document_0?this$static.document_0:this$static.spec, 261).clearDiffs();
      this$static.isCompleteDiff = false;
    }
  }
}

function $loadWith(this$static, registries){
  var core, differ;
  core = new ContentDocument_1(($clinit_2009() , NO_SCHEMA_CONSTRAINTS));
  this$static.document_0 = (differ = new DiffHighlightingFilter_0(core.localAnnotations) , new DiffContentDocument_0(core, differ));
  !!this$static.outputSink && $setOutgoingSink(core, this$static.outputSink);
  core.registries = registries;
  core.registries?createAndSetDocPainter(core.context, core.registries.paintRegistry):clearDocPainter(core.context);
  this$static.delegate = core.mutableContent;
  if (this$static.spec) {
    $applyTo(this$static.spec, this$static.document_0);
    this$static.spec = null;
  }
}

function $startDiffSuppression(this$static){
  checkState_1(!this$static.diffsSuppressed, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [($clinit_428() , this$static.diffsSuppressed?TRUE_0:FALSE_0), this$static.diffsRetained?TRUE_0:FALSE_0]));
  this$static.diffsSuppressed = true;
  dynamicCast(this$static.document_0?this$static.document_0:this$static.spec, 261).clearDiffs();
  this$static.isCompleteDiff = false;
}

function $startRendering(this$static, registries, logicalPanel){
  var document_0;
  if (this$static.document_0) {
    document_0 = this$static.document_0.document_0;
    document_0.registries = registries;
    document_0.registries?createAndSetDocPainter(document_0.context, document_0.registries.paintRegistry):clearDocPainter(document_0.context);
  }
   else {
    $loadWith(this$static, registries);
    document_0 = this$static.document_0.document_0;
  }
  $setInteractive(document_0, logicalPanel);
  $clinit_797();
  flush_0(getDocPainter(document_0.context));
}

function LazyContentDocument_0(base, initial, isCompleteDiff){
  this.delegate = null;
  this.noDelegateErrorMessage = 'delegate document is not set';
  this.base = base;
  this.spec = initial;
  this.isCompleteDiff = isCompleteDiff;
}

function create_32(base, initial){
  return new LazyContentDocument_0(base, initial, initial.state.val$op.size_1() == 0);
}

function LazyContentDocument(){
}

_ = LazyContentDocument_0.prototype = LazyContentDocument.prototype = new MutableDocumentProxy;
_.consume = function consume_8(op){
  this.diffsSuppressed?dynamicCast(this.document_0?this.document_0:this.spec, 261).consume(op):dynamicCast(this.document_0?this.document_0:this.spec, 261).consumeAsDiff(op);
}
;
_.getClass$ = function getClass_828(){
  return Lorg_waveprotocol_wave_client_wave_LazyContentDocument_2_classLit;
}
;
_.getMutableDocument = function getMutableDocument(){
  !!this.document_0 || $loadWith(this, this.base);
  return this;
}
;
_.init = function init_1(outputSink){
  this.outputSink = outputSink;
}
;
_.castableTypeMap$ = {19:1, 266:1, 275:1};
_.base = null;
_.diffsRetained = false;
_.diffsSuppressed = false;
_.document_0 = null;
_.isCompleteDiff = false;
_.outputSink = null;
_.spec = null;
function SupplementedWaveWrapper(){
}

_ = SupplementedWaveWrapper.prototype = new Object_0;
_.getClass$ = function getClass_829(){
  return Lorg_waveprotocol_wave_model_supplement_SupplementedWaveWrapper_2_classLit;
}
;
_.getGadgetState = function getGadgetState(gadgetId){
  return this.delegate.getGadgetState(gadgetId);
}
;
_.isUnread = function isUnread(blip){
  return this.delegate.isUnread(blip);
}
;
_.markAsRead = function markAsRead(blip){
  this.delegate.markAsRead(blip);
}
;
_.setGadgetState = function setGadgetState(gadgetId, key, value){
  this.delegate.setGadgetState(gadgetId, key, value);
}
;
_.castableTypeMap$ = {};
_.delegate = null;
function $addListener_1(this$static, listener){
  dynamicCast(this$static.delegate, 263).addListener(listener);
}

function $init_5(this$static){
  var wavelet, wavelet$iterator, outerIter;
  $add_31(this$static.wave.listeners, this$static);
  for (wavelet$iterator = (outerIter = $values(this$static.wave.wavelets).val$entrySet.iterator_0() , new AbstractMap$2$1_0(outerIter)); wavelet$iterator.val$outerIter.hasNext();) {
    wavelet = dynamicCast(dynamicCast(wavelet$iterator.val$outerIter.next_0(), 11).getValue(), 262);
    $add_31(wavelet.listeners, this$static.remoteChangeDetector);
  }
  $scheduleRepeating_2(this$static.timer, this$static, 10000, 10000);
}

function $isUnread(this$static, blip){
  return !this$static.autoRead.has(blip) && dynamicCast(this$static.delegate, 263).isUnread(blip);
}

function $onRemoteChange(this$static, raw){
  var blip;
  blip = dynamicCast(this$static.rawAutoRead.get(raw), 247);
  !!blip && blip != this$static.reading && (this$static.autoRead.remove_6(blip) , this$static.rawAutoRead.remove_6(blip.blip));
}

function $removeListener_2(this$static, listener){
  dynamicCast(this$static.delegate, 263).removeListener(listener);
}

function $startAutoReading(this$static, blip){
  dynamicCast(this$static.delegate, 263).markAsRead(blip);
  this$static.autoRead.put_0(blip, new Double_0((new Date).getTime()));
  this$static.rawAutoRead.put_0(blip.blip, blip);
}

function $stopAutoReading(this$static, blip){
  this$static.autoRead.remove_6(blip);
  this$static.rawAutoRead.remove_6(blip.blip);
}

function LocalSupplementedWaveImpl_0(timer, wave, delegate){
  this.delegate = delegate;
  this.autoRead = ($clinit_2309() , defaultCollectionFactory.createIdentityMap());
  this.rawAutoRead = defaultCollectionFactory.createIdentityMap();
  this.remoteChangeDetector = new LocalSupplementedWaveImpl$1_0(this);
  this.timer = timer;
  this.wave = wave;
}

function create_33(wave, delegate){
  var supplement, timer;
  timer = (!instance_7 && (instance_7 = new BrowserBackedScheduler_0 , setDefaultTimerService() , undefined) , low_0);
  supplement = new LocalSupplementedWaveImpl_0(timer, wave, delegate);
  $init_5(supplement);
  return supplement;
}

function LocalSupplementedWaveImpl(){
}

_ = LocalSupplementedWaveImpl_0.prototype = LocalSupplementedWaveImpl.prototype = new SupplementedWaveWrapper;
_.addListener = function addListener_0(listener){
  $addListener_1(this, dynamicCast(listener, 264));
}
;
_.execute = function execute_52(){
  var toEvict;
  toEvict = ($clinit_2309() , defaultCollectionFactory.createIdentitySet());
  !!this.reading && dynamicCast(this.delegate, 263).markAsRead(this.reading);
  this.autoRead.each(new LocalSupplementedWaveImpl$2_0(this, toEvict));
  toEvict.each_0(new LocalSupplementedWaveImpl$3_0(this));
  return true;
}
;
_.getClass$ = function getClass_830(){
  return Lorg_waveprotocol_wave_client_wave_LocalSupplementedWaveImpl_2_classLit;
}
;
_.isUnread = function isUnread_0(blip){
  return !this.autoRead.has(blip) && dynamicCast(this.delegate, 263).isUnread(blip);
}
;
_.markAsRead = function markAsRead_0(blip){
  $startAutoReading(this, blip);
}
;
_.onWaveletAdded = function onWaveletAdded(wavelet){
  $add_31(wavelet.listeners, this.remoteChangeDetector);
}
;
_.removeListener = function removeListener_0(listener){
  $removeListener_2(this, dynamicCast(listener, 264));
}
;
_.castableTypeMap$ = {251:1, 253:1, 263:1, 481:1};
_.reading = null;
_.timer = null;
_.wave = null;
function WaveletListenerImpl(){
}

_ = WaveletListenerImpl.prototype = new Object_0;
_.getClass$ = function getClass_831(){
  return Lorg_waveprotocol_wave_model_wave_opbased_WaveletListenerImpl_2_classLit;
}
;
_.onBlipAdded_0 = function onBlipAdded_1(wavelet, blip){
}
;
_.onBlipContributorAdded_0 = function onBlipContributorAdded_2(wavelet, blip, contributor){
}
;
_.onBlipContributorRemoved_0 = function onBlipContributorRemoved_2(wavelet, blip, contributor){
}
;
_.onBlipTimestampModified = function onBlipTimestampModified(wavelet, blip, oldTime, newTime){
}
;
_.onBlipVersionModified = function onBlipVersionModified(wavelet, blip, oldVersion, newVersion){
}
;
_.onHashedVersionChanged = function onHashedVersionChanged(wavelet, oldHashedVersion, newHashedVersion){
}
;
_.onLastModifiedTimeChanged = function onLastModifiedTimeChanged(wavelet, oldTime, newTime){
}
;
_.onParticipantAdded_0 = function onParticipantAdded_2(wavelet, participant){
}
;
_.onRemoteBlipContentModified = function onRemoteBlipContentModified(wavelet, blip){
}
;
_.onVersionChanged = function onVersionChanged(wavelet, oldVersion, newVersion){
}
;
_.castableTypeMap$ = {480:1};
function LocalSupplementedWaveImpl$1_0(this$0){
  this.this$0 = this$0;
}

function LocalSupplementedWaveImpl$1(){
}

_ = LocalSupplementedWaveImpl$1_0.prototype = LocalSupplementedWaveImpl$1.prototype = new WaveletListenerImpl;
_.getClass$ = function getClass_832(){
  return Lorg_waveprotocol_wave_client_wave_LocalSupplementedWaveImpl$1_2_classLit;
}
;
_.onRemoteBlipContentModified = function onRemoteBlipContentModified_0(wavelet, blip){
  $onRemoteChange(this.this$0, blip);
}
;
_.castableTypeMap$ = {480:1};
_.this$0 = null;
function $apply_18(this$static, blip, touched){
  dynamicCast(this$static.this$0.delegate, 263).markAsRead(blip);
  blip != this$static.this$0.reading && this$static.now - touched.value_0 >= 60000 && this$static.val$toEvict.add_2(blip);
}

function LocalSupplementedWaveImpl$2_0(this$0, val$toEvict){
  this.this$0 = this$0;
  this.val$toEvict = val$toEvict;
  this.now = (new Date).getTime();
}

function LocalSupplementedWaveImpl$2(){
}

_ = LocalSupplementedWaveImpl$2_0.prototype = LocalSupplementedWaveImpl$2.prototype = new Object_0;
_.apply_3 = function apply_67(blip, touched){
  $apply_18(this, dynamicCast(blip, 247), dynamicCast(touched, 64));
}
;
_.getClass$ = function getClass_833(){
  return Lorg_waveprotocol_wave_client_wave_LocalSupplementedWaveImpl$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$toEvict = null;
function LocalSupplementedWaveImpl$3_0(this$0){
  this.this$0 = this$0;
}

function LocalSupplementedWaveImpl$3(){
}

_ = LocalSupplementedWaveImpl$3_0.prototype = LocalSupplementedWaveImpl$3.prototype = new Object_0;
_.apply_7 = function apply_68(blip){
  $stopAutoReading(this.this$0, dynamicCast(blip, 247));
}
;
_.getClass$ = function getClass_834(){
  return Lorg_waveprotocol_wave_client_wave_LocalSupplementedWaveImpl$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $clinit_1277(){
  $clinit_1277 = nullMethod;
  REGISTRIES = ($clinit_729() , ROOT_REGISTRIES);
  initRootRegistries();
  registerContainer(REGISTRIES.elementHandlerRegistry);
  $clinit_1716();
}

var REGISTRIES;
function $applyTo(this$static, target){
  $consume_16(target, this$static.state);
  !!this$static.diff && $consumeAsDiff(target, $composeAll(this$static.diff));
}

function $consume_18(this$static, op){
  checkState_0(!this$static.diff, 'Can not apply non-diff ops while diffs still exist');
  this$static.state = compose_1(this$static.state, op);
}

function SimpleDiffDoc_0(base){
  this.state = base;
}

function compose_1(state, diff){
  var $e0, e;
  try {
    return diff?asInitialization(compose_2(state, diff)):state;
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 189)) {
      e = $e0;
      throw new OperationRuntimeException_0('error occurred during diff compaction', e);
    }
     else 
      throw $e0;
  }
}

function SimpleDiffDoc(){
}

_ = SimpleDiffDoc_0.prototype = SimpleDiffDoc.prototype = new Object_0;
_.clearDiffs = function clearDiffs_1(){
  this.state = compose_1(this.state, this.diff?$composeAll(this.diff):null);
  this.diff = null;
}
;
_.consume = function consume_9(op){
  $consume_18(this, dynamicCast(op, 207));
}
;
_.consumeAsDiff = function consumeAsDiff_0(op){
  !this.diff && (this.diff = new DocOpCollector_0);
  $add_29(this.diff, op);
}
;
_.getClass$ = function getClass_835(){
  return Lorg_waveprotocol_wave_client_wave_SimpleDiffDoc_2_classLit;
}
;
_.castableTypeMap$ = {261:1};
_.diff = null;
_.state = null;
function $get_19(this$static, blip){
  return $getBlipDocument(this$static, $toString_28(dynamicCast(($clinit_2183() , blip.helper.this$0.wavelet.wavelet.id_0), 446)), dynamicCast($get_22(blip.manifestBlip.id_0), 1));
}

function $getBlipDocument(this$static, waveletId, docId){
  var convDocuments;
  convDocuments = dynamicCast(this$static.blips.get_4(waveletId), 265);
  return convDocuments?dynamicCast(convDocuments.get_4(docId), 266):null;
}

function $getConversationDocuments(this$static, id){
  var convDocuments;
  convDocuments = dynamicCast(this$static.blips.get_4(id), 265);
  if (!convDocuments) {
    convDocuments = ($clinit_2309() , defaultCollectionFactory.createStringMap());
    this$static.blips.put_3(id, convDocuments);
  }
  return convDocuments;
}

function WaveDocuments_0(blip, data){
  this.blips = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  this.blipDocFactory = blip;
  this.dataDocFactory = data;
}

function WaveDocuments(){
}

_ = WaveDocuments_0.prototype = WaveDocuments.prototype = new Object_0;
_.create_1 = function create_35(waveletId, blipId, content_0){
  var convDocuments, document_0, waveletIdStr;
  waveletIdStr = $serialiseWaveletId(waveletId);
  if (blipId.indexOf('b+') == 0 || blipId.indexOf('g+') == 0 || blipId.indexOf('*') != -1 && blipId.indexOf('m/') != 0 && blipId.indexOf('attach+') != 0 && blipId.indexOf('spell+') != 0) {
    document_0 = $create_1(this.blipDocFactory, content_0);
    convDocuments = $getConversationDocuments(this, waveletIdStr);
    checkState(!convDocuments.containsKey_1(blipId));
    convDocuments.put_3(blipId, document_0);
    return document_0;
  }
   else {
    return $create_4(this.dataDocFactory, waveletId, blipId, content_0);
  }
}
;
_.getClass$ = function getClass_836(){
  return Lorg_waveprotocol_wave_client_wave_WaveDocuments_2_classLit;
}
;
_.castableTypeMap$ = {};
_.blipDocFactory = null;
_.dataDocFactory = null;
function $doAdopt(this$static, child){
  $add_7(this$static.children_0, child);
  $setParent(child, this$static);
}

function $doOrphan_0(this$static, child){
  $setParent(child, null);
  $remove_5(this$static.children_0, child);
}

_ = EventDispatcherPanel.prototype;
_.doAdopt = function doAdopt_0(child){
  $add_7(this.children_0, child);
  $setParent(child, this);
}
;
_.doOrphan = function doOrphan_0(child){
  $setParent(child, null);
  $remove_5(this.children_0, child);
}
;
_ = WavePanelImpl.prototype;
_.addListener = function addListener_1(listener){
  $add_31(this.listeners, dynamicCast(listener, 273));
}
;
_.removeListener = function removeListener_1(listener){
  $remove_42(this.listeners, dynamicCast(listener, 273));
}
;
function $onBlipReadChanged(this$static, blip){
  var doc;
  if (!$isUnread(this$static.supplement, blip)) {
    doc = dynamicCast($get_19(this$static.documents, blip), 275);
    if (this$static.fullyUnread.contains(blip)) {
      checkState_1(doc.diffsSuppressed, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [($clinit_428() , doc.diffsSuppressed?TRUE_0:FALSE_0), doc.diffsRetained?TRUE_0:FALSE_0]));
      doc.diffsSuppressed = false;
      this$static.fullyUnread.remove_6(blip);
    }
     else {
      $clearDiffs(doc);
    }
  }
}

function $suppressFullyUnread(this$static, blip){
  var doc;
  doc = dynamicCast($get_19(this$static.documents, blip), 275);
  if (doc.isCompleteDiff) {
    this$static.fullyUnread.add_2(blip);
    $startDiffSuppression(doc);
  }
}

function DiffController_0(wave, supplement, documents, models){
  this.fullyUnread = ($clinit_2309() , defaultCollectionFactory.createIdentitySet());
  this.suppress = new DiffController$1_0(this);
  this.remove = new DiffController$2_0(this);
  this.supplementListener = new DiffController$3_0(this);
  this.wave = wave;
  this.supplement = supplement;
  this.documents = documents;
  this.models = models;
}

function DiffController(){
}

_ = DiffController_0.prototype = DiffController.prototype = new ConversationListenerImpl;
_.getClass$ = function getClass_848(){
  return Lorg_waveprotocol_wave_client_wavepanel_impl_diff_DiffController_2_classLit;
}
;
_.onBlipAdded = function onBlipAdded_2(blip){
  depthFirst_2(this.suppress, blip);
}
;
_.onBlipDeleted = function onBlipDeleted_1(blip){
  depthFirst_2(this.remove, blip);
}
;
_.onConversationAdded = function onConversationAdded_0(conversation){
  depthFirst_0(this.suppress, conversation);
  $add_31(conversation.listeners, this);
}
;
_.onConversationRemoved = function onConversationRemoved_0(conversation){
  $remove_42(conversation.listeners, this);
  depthFirst_0(this.remove, conversation);
}
;
_.onThreadAdded = function onThreadAdded_1(thread){
  depthFirst_1(this.suppress, thread);
}
;
_.onThreadDeleted = function onThreadDeleted_1(thread){
  depthFirst_1(this.remove, thread);
}
;
_.castableTypeMap$ = {279:1, 372:1, 374:1};
_.documents = null;
_.models = null;
_.supplement = null;
_.wave = null;
function DiffController$1_0(this$0){
  this.this$0 = this$0;
}

function DiffController$1(){
}

_ = DiffController$1_0.prototype = DiffController$1.prototype = new Object_0;
_.apply_11 = function apply_69(blip){
  return $suppressFullyUnread(this.this$0, blip) , true;
}
;
_.getClass$ = function getClass_849(){
  return Lorg_waveprotocol_wave_client_wavepanel_impl_diff_DiffController$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function DiffController$2_0(this$0){
  this.this$0 = this$0;
}

function DiffController$2(){
}

_ = DiffController$2_0.prototype = DiffController$2.prototype = new Object_0;
_.apply_11 = function apply_70(blip){
  return this.this$0.fullyUnread.remove_6(blip) , true;
}
;
_.getClass$ = function getClass_850(){
  return Lorg_waveprotocol_wave_client_wavepanel_impl_diff_DiffController$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function DiffController$3_0(this$0){
  this.this$0 = this$0;
}

function DiffController$3(){
}

_ = DiffController$3_0.prototype = DiffController$3.prototype = new ObservableSupplementedWave$ListenerImpl;
_.getClass$ = function getClass_851(){
  return Lorg_waveprotocol_wave_client_wavepanel_impl_diff_DiffController$3_2_classLit;
}
;
_.onMaybeBlipReadChanged = function onMaybeBlipReadChanged_1(blip){
  $onBlipReadChanged(this.this$0, blip);
}
;
_.castableTypeMap$ = {264:1};
_.this$0 = null;
_ = FocusFramePresenter.prototype;
_.addListener = function addListener_2(listener){
  $add_31(this.listeners, dynamicCast(listener, 284));
}
;
_.removeListener = function removeListener_2(listener){
  $remove_42(this.listeners, dynamicCast(listener, 284));
}
;
function $saveInlineReplies(this$static, metaDom){
  var defaultId, defaultUi, inlineId, inlineLocators, inlineUi, threadUi;
  inlineLocators = $getInlineLocators(metaDom);
  inlineId = (inlineLocators.recentIndex = 1 , inlineLocators.recentIndex == inlineLocators.data_0.length?null:$substring_0(inlineLocators.data_0, inlineLocators.recentIndex, inlineLocators.data_0.indexOf(',', inlineLocators.recentIndex)).replace(/&c/g, ',').replace(/&&/g, '&'));
  while (inlineId != null) {
    inlineUi = $asAnchor_1(this$static.views, $doc.getElementById(inlineId));
    threadUi = $getThread(dynamicCast(dynamicCast(inlineUi.helper, 287), 288), dynamicCast(inlineUi.impl, 289));
    if (threadUi) {
      defaultId = inlineId.substr(0, inlineId.length - 1 - 0) + 'D';
      defaultUi = $asAnchor_1(this$static.views, $doc.getElementById(defaultId));
      $detach_0((dynamicCast(inlineUi.helper, 287) , inlineUi.impl), threadUi);
      $attach_0((dynamicCast(defaultUi.helper, 287) , defaultUi.impl), threadUi);
    }
    inlineId = $getNext_1(inlineLocators, inlineId);
  }
}

function BlipPager_0(registries, blipPopulator, docProvider, views, viewProvider, logicalPanel){
  this.registries = registries;
  this.blipPopulator = blipPopulator;
  this.docProvider = docProvider;
  this.views = views;
  this.viewProvider = viewProvider;
  this.logicalPanel = logicalPanel;
}

function create_39(docRegistry, registries, views, viewProvider, blipPopulator, logicalPanel){
  var docProvider;
  docProvider = new BlipPager$1_0(docRegistry);
  return new BlipPager_0(registries, blipPopulator, docProvider, views, viewProvider, logicalPanel);
}

function BlipPager(){
}

_ = BlipPager_0.prototype = BlipPager.prototype = new Object_0;
_.getClass$ = function getClass_911(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_BlipPager_2_classLit;
}
;
_.pageIn = function pageIn(blip){
  var blipUi, doc, metaDom, r;
  blipUi = $getBlipView(this.viewProvider, blip);
  if (blipUi) {
    dynamicCast(blipUi.impl, 278);
    metaDom = dynamicCast($getMeta(dynamicCast(dynamicCast(blipUi.helper, 276), 277), dynamicCast(blipUi.impl, 278)).impl, 302);
    doc = dynamicCast($get_19(this.docProvider.val$docRegistry, blip), 275);
    r = $get_20(this.registries, blip);
    $saveInlineReplies(this, metaDom);
    $clear_14($getInlineLocators(metaDom));
    $getFirstChildElement((!metaDom.contentContainer && (metaDom.contentContainer = load(metaDom.id_0, ($clinit_1495() , CONTENT))) , metaDom.contentContainer)).innerHTML = '';
    $startRendering(doc, r, this.logicalPanel);
    $setContent_2(metaDom, dynamicCast((!!doc.document_0 || $loadWith(doc, doc.base) , doc.document_0.document_0).fullContentView.inner_0.getDocumentElement(), 196).implNodelet);
    $render_18(this.blipPopulator, blip, metaDom);
  }
}
;
_.castableTypeMap$ = {17:1};
_.blipPopulator = null;
_.docProvider = null;
_.logicalPanel = null;
_.registries = null;
_.viewProvider = null;
_.views = null;
function BlipPager$1_0(val$docRegistry){
  this.val$docRegistry = val$docRegistry;
}

function BlipPager$1(){
}

_ = BlipPager$1_0.prototype = BlipPager$1.prototype = new Object_0;
_.getClass$ = function getClass_912(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_BlipPager$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$docRegistry = null;
function $extendFor(this$static, c){
  var ci$iterator, r;
  r = $createExtension(this$static.registries);
  for (ci$iterator = this$static.cis.iterator_0(); ci$iterator.hasNext();) {
    throwClassCastExceptionUnlessNull(ci$iterator.next_0());
    null.nullMethod(c);
  }
  return new DocumentRegistries$ConversationRegistries_0(this$static, r, c.wavelet, c);
}

function $get_20(this$static, blip){
  return $getBlipRegistries($getConversationRegistries(this$static, blip.helper.this$0), blip);
}

function $getConversationRegistries(this$static, c){
  var rs;
  rs = dynamicCast(this$static.conversationRegistries.get(c), 317);
  if (!rs) {
    rs = $extendFor(this$static, c);
    this$static.conversationRegistries.put_0(c, rs);
  }
  return rs;
}

function DocumentRegistries_0(r, cis, bis){
  this.conversationRegistries = ($clinit_2309() , defaultCollectionFactory.createIdentityMap());
  this.registries = r;
  this.cis = cis;
  this.bis = bis;
}

function DocumentRegistries(){
}

_ = DocumentRegistries_0.prototype = DocumentRegistries.prototype = new Object_0;
_.getClass$ = function getClass_913(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_DocumentRegistries_2_classLit;
}
;
_.castableTypeMap$ = {};
_.bis = null;
_.cis = null;
_.registries = null;
function $build(this$static){
  var gi, gi$iterator, root, handler, painterRegistry, handler_0, painterRegistry_0;
  root = ($clinit_729() , ROOT_REGISTRIES);
  for (gi$iterator = nonNull(this$static.gis).iterator_0(); gi$iterator.hasNext();) {
    gi = dynamicCast(gi$iterator.next_0(), 318);
    register(root.annotationHandlerRegistry, root.paintRegistry);
    $registerRenderer(root.elementHandlerRegistry, 'l:diffdel', (!instance_4 && (instance_4 = new DiffDeleteRenderer_0) , instance_4));
    $clinit_910();
    painterRegistry = root.paintRegistry;
    handler = new StyleAnnotationHandler_0(painterRegistry.painter);
    $registerHandler(root.annotationHandlerRegistry, 'style', handler);
    $registerBehaviour(root.annotationHandlerRegistry, 'style', new AnnotationBehaviour$DefaultAnnotationBehaviour_0(($clinit_1778() , CONTENT_0)));
    $registerPaintFunction(painterRegistry, KEYS_1, renderFunc_0);
    $clinit_727();
    painterRegistry_0 = root.paintRegistry;
    handler_0 = new TitleAnnotationHandler_0(painterRegistry_0.painter);
    $registerHandler(root.annotationHandlerRegistry, 'conv', handler_0);
    $registerBehaviour(root.annotationHandlerRegistry, 'conv', new AnnotationBehaviour$DefaultAnnotationBehaviour_0(CONTENT_0));
    $registerPaintFunction(painterRegistry_0, KEYS_0, renderFunc);
    register_0(root, gi.this$1);
    register_1(root, $getSessionId(gi.this$1), $getProfileManager(gi.this$1));
  }
  return new DocumentRegistries_0(root, nonNull(this$static.cis), nonNull(this$static.bis));
}

function $use_6(this$static, b){
  (this$static.bis = lazyCreate(this$static.bis)).add_0(b);
  return this$static;
}

function $use_7(this$static, g){
  (this$static.gis = lazyCreate(this$static.gis)).add_0(g);
  return this$static;
}

function DocumentRegistries$Builder_0(){
}

function lazyCreate(xs){
  return !xs?($clinit_2309() , defaultCollectionFactory.createQueue()):xs;
}

function nonNull(xs){
  return !xs?($clinit_480() , $clinit_480() , EMPTY_LIST):xs;
}

function DocumentRegistries$Builder(){
}

_ = DocumentRegistries$Builder_0.prototype = DocumentRegistries$Builder.prototype = new Object_0;
_.getClass$ = function getClass_914(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_DocumentRegistries$Builder_2_classLit;
}
;
_.castableTypeMap$ = {};
_.bis = null;
_.cis = null;
_.gis = null;
function $extendFor_0(this$static, b){
  var bi, bi$iterator, r;
  r = $createExtension(this$static.registries);
  for (bi$iterator = this$static.this$0.bis.iterator_0(); bi$iterator.hasNext();) {
    bi = dynamicCast(bi$iterator.next_0(), 319);
    bi.install(this$static.w, this$static.c, b, r);
  }
  return r;
}

function $getBlipRegistries(this$static, b){
  var rs;
  rs = dynamicCast(this$static.blipRegistries.get(b), 320);
  if (!rs) {
    rs = $extendFor_0(this$static, b);
    this$static.blipRegistries.put_0(b, rs);
  }
  return rs;
}

function DocumentRegistries$ConversationRegistries_0(this$0, registries, w, c){
  this.this$0 = this$0;
  this.blipRegistries = ($clinit_2309() , defaultCollectionFactory.createIdentityMap());
  this.registries = registries;
  this.w = w;
  this.c = c;
}

function DocumentRegistries$ConversationRegistries(){
}

_ = DocumentRegistries$ConversationRegistries_0.prototype = DocumentRegistries$ConversationRegistries.prototype = new Object_0;
_.getClass$ = function getClass_915(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_DocumentRegistries$ConversationRegistries_2_classLit;
}
;
_.castableTypeMap$ = {317:1};
_.c = null;
_.registries = null;
_.this$0 = null;
_.w = null;
function $render_6(this$static, conversation, participantsUi, threadUi){
  var id, isTop;
  id = $shorten(this$static.viewIdMapper.modelMapper, $toString_28(dynamicCast(($clinit_2183() , conversation.wavelet.wavelet.id_0), 446))) + 'C';
  isTop = !$isValidAnchor(conversation, $getAnchorWaveletId(conversation), dynamicCast($getAnchor(conversation.manifest).anchor.second, 1));
  return isTop?new FixedConversationViewBuilder_0(($clinit_1533() , id), threadUi, participantsUi):(checkArgument(id.indexOf("'") == -1) , new InlineConversationViewBuilder_0(create_44(id, ($clinit_1531() , dynamicCast($get_10(CODES, ($clinit_1453() , INLINE_CONVERSATION)), 1)), new BuilderHelper$1_0(initValues(_3Lorg_waveprotocol_wave_client_uibuilder_UiBuilder_2_classLit, {9:1, 68:1}, 16, [participantsUi, threadUi])))));
}

function $render_7(this$static, conversation, participantUis){
  var id, participant, participant$iterator, participantsUi;
  participantsUi = new HtmlClosureCollection_0;
  for (participant$iterator = ($clinit_480() , new Collections$UnmodifiableSet_0(new Collections$UnmodifiableSet_0(conversation.wavelet.wavelet.participants))).iterator_0(); participant$iterator.hasNext();) {
    participant = dynamicCast(participant$iterator.next_0(), 164);
    $add_22(participantsUi, dynamicCast(participantUis.get_4(participant.address), 15));
  }
  id = $shorten(this$static.viewIdMapper.modelMapper, $toString_28(dynamicCast(($clinit_2183() , conversation.wavelet.wavelet.id_0), 446))) + 'P';
  return new ParticipantsViewBuilder_0(($clinit_1533() , id), participantsUi);
}

function $render_8(this$static, conversation, participant){
  var id, participantUi, profile;
  profile = $getProfile(this$static.profileManager, participant);
  id = $participantId(this$static.viewIdMapper.modelMapper, conversation, participant) + 'P';
  participantUi = new ParticipantNameViewBuilder_0(id, $clinit_1533());
  profile.imageUrl == null && (profile.imageUrl = 'static/images/unknown.jpg');
  participantUi.name_0 = (profile.fullName == null && $buildNames(profile) , profile.fullName);
  return participantUi;
}

function $render_9(this$static, thread, blipUis){
  var blipsUi, builder, indicatorBuilder, inlineBuilder, read, replyBoxBuilder, replyIndicatorId, threadId, unread, structure;
  blipsUi = new FullDomRenderer$2_0(thread, blipUis);
  threadId = $threadId(this$static.viewIdMapper.modelMapper, thread) + 'T';
  replyIndicatorId = $threadId(this$static.viewIdMapper.modelMapper, thread) + 'I';
  if (thread.helper.this$0.rootThread == thread) {
    replyBoxBuilder = new ReplyBoxViewBuilder_0(($clinit_1533() , replyIndicatorId));
    builder = new RootThreadViewBuilder_0(threadId, blipsUi, replyBoxBuilder, $clinit_1533());
  }
   else {
    indicatorBuilder = new ContinuationIndicatorViewBuilder_0(($clinit_1533() , replyIndicatorId));
    inlineBuilder = (checkArgument(threadId.indexOf("'") == -1) , structure = new InlineThreadViewBuilder$InlineThreadStructure_0(blipsUi, indicatorBuilder) , new InlineThreadViewBuilder_0(threadId, create_44(threadId, ($clinit_1531() , dynamicCast($get_10(CODES, ($clinit_1453() , INLINE_THREAD)), 1)), structure)));
    read = $getReadCount(this$static.readMonitor, thread);
    unread = $getUnreadCount(this$static.readMonitor, thread);
    inlineBuilder.impl.totalBlipCount = read + unread;
    inlineBuilder.impl.unreadBlipCount = unread;
    builder = inlineBuilder;
  }
  return builder;
}

function $render_10(this$static, blip, document_0, anchorUis, nestedConversations){
  var convsUi, metaUi, threadsUi;
  threadsUi = new FullDomRenderer$3_0(blip, anchorUis);
  convsUi = new FullDomRenderer$4_0(nestedConversations);
  metaUi = create_42($blipId(this$static.viewIdMapper.modelMapper, blip) + 'M', document_0);
  $render_18(this$static.blipPopulator, blip, metaUi);
  return create_43($blipId(this$static.viewIdMapper.modelMapper, blip) + 'B', metaUi, threadsUi, convsUi);
}

function $render_11(this$static, thread, threadR){
  var id;
  id = ($clinit_592() , $replaceAll($replaceAll($replaceAll($replaceAll($replaceAll($defaultAnchorOf(this$static.viewIdMapper, thread), '&', '&amp;'), '"', '&quot;'), "'", '&#39;'), '<', '&lt;'), '>', '&gt;'));
  return checkArgument(id == null || id.indexOf("'") == -1) , new AnchorViewBuilder_0(id, threadR?threadR:($clinit_1251() , EMPTY_0));
}

function $outputHtml_0(this$static, out){
  var blip, blip$iterator, blipUi, result;
  for (blip$iterator = $iterator_13($getBlips(this$static.val$thread)); blip$iterator.next != null;) {
    blip = dynamicCast((result = blip$iterator.next , $advance(blip$iterator) , result), 247);
    blipUi = dynamicCast(this$static.val$blipUis.get(blip), 16);
    !!blipUi && blipUi.outputHtml(out);
  }
}

function FullDomRenderer$2_0(val$thread, val$blipUis){
  this.val$thread = val$thread;
  this.val$blipUis = val$blipUis;
}

function FullDomRenderer$2(){
}

_ = FullDomRenderer$2_0.prototype = FullDomRenderer$2.prototype = new Object_0;
_.getClass$ = function getClass_918(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_FullDomRenderer$2_2_classLit;
}
;
_.outputHtml = function outputHtml_4(out){
  $outputHtml_0(this, out);
}
;
_.castableTypeMap$ = {15:1};
_.val$blipUis = null;
_.val$thread = null;
function FullDomRenderer$3_0(val$blip, val$anchorUis){
  this.val$blip = val$blip;
  this.val$anchorUis = val$anchorUis;
}

function FullDomRenderer$3(){
}

_ = FullDomRenderer$3_0.prototype = FullDomRenderer$3.prototype = new Object_0;
_.getClass$ = function getClass_919(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_FullDomRenderer$3_2_classLit;
}
;
_.outputHtml = function outputHtml_5(out){
  var thread, thread$iterator, result;
  for (thread$iterator = $iterator_12($getReplyThreads(this.val$blip)); thread$iterator.next != null;) {
    thread = dynamicCast((result = thread$iterator.next , $advance(thread$iterator) , result), 248);
    dynamicCast(this.val$anchorUis.get(thread), 16).outputHtml(out);
  }
}
;
_.castableTypeMap$ = {15:1, 16:1};
_.val$anchorUis = null;
_.val$blip = null;
function FullDomRenderer$4_0(val$nestedConversations){
  this.val$nestedConversations = val$nestedConversations;
}

function FullDomRenderer$4(){
}

_ = FullDomRenderer$4_0.prototype = FullDomRenderer$4.prototype = new Object_0;
_.getClass$ = function getClass_920(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_FullDomRenderer$4_2_classLit;
}
;
_.outputHtml = function outputHtml_6(out){
  var conv, conv$iterator, ordered;
  ordered = ($clinit_2309() , new ArrayList_0);
  this.val$nestedConversations.each(new FullDomRenderer$4$1_0(ordered));
  sort_2(ordered, new FullDomRenderer$4$2_0);
  new ArrayList_0;
  for (conv$iterator = new AbstractList$IteratorImpl_0(ordered); conv$iterator.i < conv$iterator.this$0_0.size_1();) {
    conv = dynamicCast($next_4(conv$iterator), 249);
    dynamicCast(this.val$nestedConversations.get(conv), 16).outputHtml(out);
  }
}
;
_.castableTypeMap$ = {15:1, 16:1};
_.val$nestedConversations = null;
function $apply_22(this$static, conv){
  $add_9(this$static.val$ordered, conv);
}

function FullDomRenderer$4$1_0(val$ordered){
  this.val$ordered = val$ordered;
}

function FullDomRenderer$4$1(){
}

_ = FullDomRenderer$4$1_0.prototype = FullDomRenderer$4$1.prototype = new Object_0;
_.apply_3 = function apply_72(conv, ui){
  $apply_22(this, dynamicCast(conv, 249), dynamicCast(ui, 16));
}
;
_.getClass$ = function getClass_921(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_FullDomRenderer$4$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$ordered = null;
function $compare_5(o1, o2){
  return compareTo_5($toString_28(dynamicCast(($clinit_2183() , o1.wavelet.wavelet.id_0), 446)), $toString_28(dynamicCast(o2.wavelet.wavelet.id_0, 446)));
}

function FullDomRenderer$4$2_0(){
}

function FullDomRenderer$4$2(){
}

_ = FullDomRenderer$4$2_0.prototype = FullDomRenderer$4$2.prototype = new Object_0;
_.compare = function compare_5(o1, o2){
  return $compare_5(dynamicCast(o1, 249), dynamicCast(o2, 249));
}
;
_.getClass$ = function getClass_922(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_FullDomRenderer$4$2_2_classLit;
}
;
_.castableTypeMap$ = {};
function $parseHtml(ui){
  var div, html, ret;
  if (!ui) {
    return null;
  }
  html = new SafeHtmlBuilder_0;
  ui.outputHtml(html);
  div = $doc.createElement('div');
  div.innerHTML = (new SafeHtmlString_0(html.sb.impl.string)).html || '';
  ret = $getFirstChildElement(div);
  $removeFromParent(ret);
  return ret;
}

function $clinit_1402(){
  $clinit_1402 = nullMethod;
  ANCHOR_HANDLER = new InlineAnchorLiveRenderer$1_0;
}

function $add_24(this$static, anchor){
  var existing;
  existing = dynamicCast((!this$static.canonicals && (this$static.canonicals = ($clinit_2309() , defaultCollectionFactory.createStringMap())) , this$static.canonicals).get_4(anchor.threadId), 321);
  if (!existing) {
    $addCanonical(this$static, anchor);
  }
   else if ($compareTo_7(anchor.el, existing.el) < 0) {
    $removeCanonical(this$static, existing);
    (!this$static.duplicates && (this$static.duplicates = ($clinit_2309() , defaultCollectionFactory.createIdentitySet())) , this$static.duplicates).add_2(existing);
    $addCanonical(this$static, anchor);
  }
   else {
    (!this$static.duplicates && (this$static.duplicates = ($clinit_2309() , defaultCollectionFactory.createIdentitySet())) , this$static.duplicates).add_2(anchor);
  }
}

function $addCanonical(this$static, anchor){
  var next, nextNode;
  (!this$static.canonicals && (this$static.canonicals = ($clinit_2309() , defaultCollectionFactory.createStringMap())) , this$static.canonicals).put_3(anchor.threadId, anchor);
  $put_5((!this$static.canonicalOrder && (this$static.canonicalOrder = new LinkedPruningSequenceMap_0(new LinkedPruningSequenceMap$1_0)) , this$static.canonicalOrder), anchor, anchor);
  nextNode = $getNext($getElement((!this$static.canonicalOrder && (this$static.canonicalOrder = new LinkedPruningSequenceMap_0(new LinkedPruningSequenceMap$1_0)) , this$static.canonicalOrder), anchor));
  next = nextNode != $getFirst((!this$static.canonicalOrder && (this$static.canonicalOrder = new LinkedPruningSequenceMap_0(new LinkedPruningSequenceMap$1_0)) , this$static.canonicalOrder))?nextNode.value_0:null;
  $setDomId(anchor, $anchorRoot(this$static.viewIdMapper, this$static.blip, anchor.threadId) + 'I');
  $onAnchorAddedBefore(this$static.handler, this$static.blip, next, anchor);
}

function $onAttributeModified_4(this$static, element, name_0, oldValue, newValue){
  if ($equals_3('id', name_0)) {
    oldValue != null && $remove_34(this$static, new InlineAnchorLiveRenderer$ReplyDoodad_0(this$static, element, oldValue));
    newValue != null && $add_24(this$static, new InlineAnchorLiveRenderer$ReplyDoodad_0(this$static, element, newValue));
  }
}

function $remove_34(this$static, anchor){
  var existing, toPromote;
  existing = dynamicCast((!this$static.canonicals && (this$static.canonicals = ($clinit_2309() , defaultCollectionFactory.createStringMap())) , this$static.canonicals).get_4(anchor.threadId), 321);
  if (existing == anchor || !!existing && anchor.el == existing.el) {
    $removeCanonical(this$static, anchor);
    toPromote = findMinimum(anchor.threadId, (!this$static.duplicates && (this$static.duplicates = ($clinit_2309() , defaultCollectionFactory.createIdentitySet())) , this$static.duplicates));
    if (toPromote) {
      (!this$static.duplicates && (this$static.duplicates = ($clinit_2309() , defaultCollectionFactory.createIdentitySet())) , this$static.duplicates).remove_6(toPromote);
      $addCanonical(this$static, toPromote);
    }
  }
   else {
    (!this$static.duplicates && (this$static.duplicates = ($clinit_2309() , defaultCollectionFactory.createIdentitySet())) , this$static.duplicates).remove_6(anchor);
  }
}

function $removeCanonical(this$static, anchor){
  (!this$static.canonicals && (this$static.canonicals = ($clinit_2309() , defaultCollectionFactory.createStringMap())) , this$static.canonicals).remove_8(anchor.threadId);
  $remove_27((!this$static.canonicalOrder && (this$static.canonicalOrder = new LinkedPruningSequenceMap_0(new LinkedPruningSequenceMap$1_0)) , this$static.canonicalOrder), anchor);
  $onAnchorRemoved(this$static.handler, this$static.blip, anchor);
  $setDomId(anchor, null);
}

function InlineAnchorLiveRenderer_0(viewIdMapper, blip, h_0, views){
  $clinit_1402();
  this.viewIdMapper = viewIdMapper;
  this.blip = blip;
  this.handler = h_0;
  this.views = views;
}

function InlineAnchorLiveRenderer(){
}

_ = InlineAnchorLiveRenderer_0.prototype = InlineAnchorLiveRenderer.prototype = new RenderingMutationHandler;
_.createDomImpl = function createDomImpl_13(element){
  var e;
  e = $doc.createElement('div');
  e.style['display'] = ($clinit_63() , 'inline');
  e.style['-webkit-user-modify'] = 'read-only';
  e.style['whiteSpace'] = 'normal';
  e.style['lineHeight'] = 'normal';
  return e;
}
;
_.getClass$ = function getClass_924(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_InlineAnchorLiveRenderer_2_classLit;
}
;
_.onActivatedSubtree = function onActivatedSubtree_1(element){
  var id;
  id = dynamicCast(element.attributes.get_4('id'), 1);
  id != null && $add_24(this, new InlineAnchorLiveRenderer$ReplyDoodad_0(this, element, id));
}
;
_.onAttributeModified = function onAttributeModified_7(element, name_0, oldValue, newValue){
  $onAttributeModified_4(this, element, name_0, oldValue, newValue);
}
;
_.onDeactivated_0 = function onDeactivated_2(element){
  var id;
  id = dynamicCast(element.attributes.get_4('id'), 1);
  id != null && $remove_34(this, new InlineAnchorLiveRenderer$ReplyDoodad_0(this, element, id));
}
;
_.castableTypeMap$ = {212:1, 215:1};
_.blip = null;
_.canonicalOrder = null;
_.canonicals = null;
_.duplicates = null;
_.handler = null;
_.viewIdMapper = null;
_.views = null;
var ANCHOR_HANDLER;
function InlineAnchorLiveRenderer$1_0(){
  $clinit_907();
}

function InlineAnchorLiveRenderer$1(){
}

_ = InlineAnchorLiveRenderer$1_0.prototype = InlineAnchorLiveRenderer$1.prototype = new ChunkyElementHandler;
_.getClass$ = function getClass_925(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_InlineAnchorLiveRenderer$1_2_classLit;
}
;
_.castableTypeMap$ = {216:1};
function InlineAnchorLiveRenderer$2_0(val$viewIdMapper, val$manager, val$views){
  this.val$viewIdMapper = val$viewIdMapper;
  this.val$manager = val$manager;
  this.val$views = val$views;
}

function InlineAnchorLiveRenderer$2(){
}

_ = InlineAnchorLiveRenderer$2_0.prototype = InlineAnchorLiveRenderer$2.prototype = new Object_0;
_.getClass$ = function getClass_926(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_InlineAnchorLiveRenderer$2_2_classLit;
}
;
_.install = function install_10(w, c, b, r){
  var renderer;
  renderer = new InlineAnchorLiveRenderer_0(this.val$viewIdMapper, b, this.val$manager, this.val$views);
  $registerRenderingMutationHandler(r.elementHandlerRegistry, 'reply', renderer);
  $registerEventHandler(r.elementHandlerRegistry, 'reply', ($clinit_1402() , ANCHOR_HANDLER));
}
;
_.castableTypeMap$ = {319:1};
_.val$manager = null;
_.val$viewIdMapper = null;
_.val$views = null;
function $apply_23(this$static, duplicate){
  $equals_3(duplicate.threadId, this$static.id_0) && (this$static.min_0 = !this$static.min_0 || $compareTo_7(duplicate.el, this$static.min_0.el) < 0?duplicate:this$static.min_0);
}

function InlineAnchorLiveRenderer$CanonicalAnchorFinder_0(id){
  this.id_0 = id;
}

function findMinimum(id, anchors){
  var finder;
  finder = new InlineAnchorLiveRenderer$CanonicalAnchorFinder_0(id);
  anchors.each_0(finder);
  return finder.min_0;
}

function InlineAnchorLiveRenderer$CanonicalAnchorFinder(){
}

_ = InlineAnchorLiveRenderer$CanonicalAnchorFinder_0.prototype = InlineAnchorLiveRenderer$CanonicalAnchorFinder.prototype = new Object_0;
_.apply_7 = function apply_73(duplicate){
  $apply_23(this, dynamicCast(duplicate, 321));
}
;
_.getClass$ = function getClass_927(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_InlineAnchorLiveRenderer$CanonicalAnchorFinder_2_classLit;
}
;
_.castableTypeMap$ = {};
_.id_0 = null;
_.min_0 = null;
function $setDomId(this$static, id){
  if (id != null) {
    this$static.el.implNodelet.id = id;
    this$static.el.implNodelet.setAttribute('kind', ($clinit_1531() , dynamicCast($get_10(CODES, ($clinit_1453() , ANCHOR)), 1)));
  }
   else {
    this$static.el.implNodelet.id = null;
    this$static.el.implNodelet.removeAttribute('kind');
  }
}

function InlineAnchorLiveRenderer$ReplyDoodad_0(this$0, el, id){
  this.this$0 = this$0;
  this.el = el;
  this.threadId = id;
}

function InlineAnchorLiveRenderer$ReplyDoodad(){
}

_ = InlineAnchorLiveRenderer$ReplyDoodad_0.prototype = InlineAnchorLiveRenderer$ReplyDoodad.prototype = new Object_0;
_.compareTo$ = function compareTo_10(o){
  return $compareTo_7(this.el, dynamicCast(o, 321).el);
}
;
_.equals$ = function equals_30(obj){
  return obj === this || obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[321] && this.el == dynamicCast(obj, 321).el;
}
;
_.getClass$ = function getClass_928(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_InlineAnchorLiveRenderer$ReplyDoodad_2_classLit;
}
;
_.castableTypeMap$ = {10:1, 185:1, 321:1};
_.anchor = null;
_.el = null;
_.this$0 = null;
_.threadId = null;
function $init_12(this$static){
  var conv, conv$iterator;
  $init_15(this$static.supplementRenderer);
  for (conv$iterator = ($clinit_480() , new Collections$UnmodifiableCollection_0($values(this$static.wave.conversations))).iterator_0(); conv$iterator.hasNext();) {
    conv = dynamicCast(conv$iterator.next_0(), 255);
    $observe(this$static, conv);
  }
  $add_31(this$static.wave.listeners, this$static);
}

function $observe(this$static, conversation){
  var profileRenderer, renderer;
  profileRenderer = create_41(this$static.timer, this$static.profiles, this$static.views, this$static.blipRenderer);
  renderer = new LiveConversationViewRenderer$LiveConversationRenderer_0(this$static, conversation, profileRenderer);
  $init_13(renderer);
  this$static.conversationRenderers.put_0(conversation, renderer);
}

function $unobserve(this$static, conversation){
  var renderer;
  renderer = dynamicCast(this$static.conversationRenderers.get(conversation), 322);
  if (renderer) {
    this$static.conversationRenderers.remove_6(conversation);
    $remove_42(renderer.conversation.anchorListeners, renderer);
    $remove_42(renderer.conversation.listeners, renderer);
    $destroy_0(renderer.profileRenderer);
  }
}

function $viewOf(this$static, thread){
  return !thread?null:thread.helper.this$0.rootThread == thread?$getRootThreadView(this$static.views, thread):$getInlineThreadView(this$static.views, thread);
}

function $viewOf_0(this$static, ref){
  return !ref?null:$getBlipView(this$static.views, ref);
}

function $viewOf_1(this$static, ref){
  return !ref?null:$getConversationView(this$static.views, ref);
}

function LiveConversationViewRenderer_0(timer, wave, views, blipRenderer, replyHandler, readMonitor, profiles, supplementRenderer){
  this.conversationRenderers = ($clinit_2309() , defaultCollectionFactory.createIdentityMap());
  this.timer = timer;
  this.wave = wave;
  this.views = views;
  this.blipRenderer = blipRenderer;
  this.replyHandler = replyHandler;
  this.readMonitor = readMonitor;
  this.profiles = profiles;
  this.supplementRenderer = supplementRenderer;
}

function create_40(timer, wave, views, blipRenderer, replyHandler, readMonitor, profiles, supplement){
  var supplementRenderer;
  supplementRenderer = new LiveSupplementRenderer_0(supplement, views, readMonitor);
  return new LiveConversationViewRenderer_0(timer, wave, views, blipRenderer, replyHandler, readMonitor, profiles, supplementRenderer);
}

function LiveConversationViewRenderer(){
}

_ = LiveConversationViewRenderer_0.prototype = LiveConversationViewRenderer.prototype = new Object_0;
_.getClass$ = function getClass_929(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_LiveConversationViewRenderer_2_classLit;
}
;
_.onConversationAdded = function onConversationAdded_1(conversation){
  var container;
  container = $viewOf_0(this, dynamicCast($maybeMakeAnchor(conversation, $getAnchorWaveletId(conversation), dynamicCast($getAnchor(conversation.manifest).anchor.second, 1)).anchor.second, 247));
  !!container && $insertConversationBefore_0(dynamicCast(container.helper, 276), container.impl, conversation);
  $observe(this, conversation);
}
;
_.onConversationRemoved = function onConversationRemoved_1(conversation){
  var convUi;
  $unobserve(this, conversation);
  convUi = !conversation?null:$getConversationView(this.views, conversation);
  !!convUi && dynamicCast(convUi.helper, 291).remove_6(convUi.impl);
}
;
_.pageIn = function pageIn_0(blip){
  var renderer;
  renderer = dynamicCast(this.conversationRenderers.get(blip.helper.this$0), 322);
  checkState(!!renderer);
  $pageIn(renderer, blip);
}
;
_.castableTypeMap$ = {17:1, 372:1};
_.blipRenderer = null;
_.profiles = null;
_.readMonitor = null;
_.replyHandler = null;
_.supplementRenderer = null;
_.timer = null;
_.views = null;
_.wave = null;
function $bubbleBlipCountUpdate(this$static, blip){
  var parentBlip, thread, threadUi;
  thread = blip.parentThread;
  threadUi = $viewOf(this$static.this$0, thread);
  threadUi.setTotalBlipCount($getTotalCount(this$static.this$0.readMonitor, thread));
  parentBlip = thread.parentBlip;
  !!parentBlip && $bubbleBlipCountUpdate(this$static, parentBlip);
}

function $findBefore_0(o, xs){
  var last, x, x$iterator;
  last = null;
  for (x$iterator = xs.iterator_0(); x$iterator.hasNext();) {
    x = x$iterator.next_0();
    if (equals__devirtual$(x, o)) {
      return last;
    }
    last = x;
  }
  throw new IllegalArgumentException_1('Item ' + o + ' not found in ' + xs);
}

function $init_13(this$static){
  var participant, participant$iterator;
  $init_14(this$static.profileRenderer);
  for (participant$iterator = ($clinit_480() , new Collections$UnmodifiableSet_0(new Collections$UnmodifiableSet_0(this$static.conversation.wavelet.wavelet.participants))).iterator_0(); participant$iterator.hasNext();) {
    participant = dynamicCast(participant$iterator.next_0(), 164);
    $monitorParticipation(this$static.profileRenderer, this$static.conversation, participant);
  }
  $add_31(this$static.conversation.anchorListeners, this$static);
  $add_31(this$static.conversation.listeners, this$static);
  return this$static;
}

function $onAnchorChanged(this$static, oldAnchor, newAnchor){
  var containerUi, oldUi;
  if (oldAnchor) {
    oldUi = $viewOf_1(this$static.this$0, this$static.conversation);
    !!oldUi && dynamicCast(oldUi.helper, 291).remove_6(oldUi.impl);
  }
  if (newAnchor) {
    containerUi = $viewOf_0(this$static.this$0, dynamicCast(newAnchor.anchor.second, 247));
    !!containerUi && $insertConversationBefore_1(containerUi, this$static.conversation);
  }
}

function $pageIn(this$static, blip){
  var contributor, contributor$iterator;
  for (contributor$iterator = ($clinit_480() , new Collections$UnmodifiableSet_0(blip.blip.blip.contributors)).iterator_0(); contributor$iterator.hasNext();) {
    contributor = dynamicCast(contributor$iterator.next_0(), 164);
    $monitorContribution(this$static.profileRenderer, blip, contributor);
  }
}

function LiveConversationViewRenderer$LiveConversationRenderer_0(this$0, conversation, profileRenderer){
  this.this$0 = this$0;
  this.conversation = conversation;
  this.profileRenderer = profileRenderer;
}

function LiveConversationViewRenderer$LiveConversationRenderer(){
}

_ = LiveConversationViewRenderer$LiveConversationRenderer_0.prototype = LiveConversationViewRenderer$LiveConversationRenderer.prototype = new Object_0;
_.getClass$ = function getClass_930(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_LiveConversationViewRenderer$LiveConversationRenderer_2_classLit;
}
;
_.onBlipAdded = function onBlipAdded_3(blip){
  var parentThread, ref, refView, threadView, manifestBlips;
  parentThread = blip.parentThread;
  threadView = $viewOf(this.this$0, parentThread);
  if (threadView) {
    ref = dynamicCast($findBefore_0(blip, (manifestBlips = parentThread.manifestThread.blips.orderedValues , new WaveletBasedConversationThread$1_0(parentThread, manifestBlips))), 247);
    refView = $viewOf_0(this.this$0, ref);
    dynamicCast(threadView.helper, 285).insertBlipAfter(threadView.impl, refView, blip);
    $bubbleBlipCountUpdate(this, blip);
  }
   else {
    throw new IllegalStateException_1('threadView not present');
  }
}
;
_.onBlipContributorAdded = function onBlipContributorAdded_3(blip, contributor){
  $monitorContribution(this.profileRenderer, blip, contributor);
}
;
_.onBlipContributorRemoved = function onBlipContributorRemoved_3(blip, contributor){
  $unmonitorContribution(this.profileRenderer, blip, contributor);
}
;
_.onBlipDeleted = function onBlipDeleted_2(blip){
  var blipView, contributor, contributor$iterator;
  blipView = $getBlipView(this.this$0.views, blip);
  !!blipView && $removeFromParent(dynamicCast((dynamicCast(blipView.helper, 276) , blipView.impl), 278).self_0);
  for (contributor$iterator = ($clinit_480() , new Collections$UnmodifiableSet_0(blip.blip.blip.contributors)).iterator_0(); contributor$iterator.hasNext();) {
    contributor = dynamicCast(contributor$iterator.next_0(), 164);
    $unmonitorContribution(this.profileRenderer, blip, contributor);
  }
  $bubbleBlipCountUpdate(this, blip);
}
;
_.onBlipTimestampChanged = function onBlipTimestampChanged_1(blip, oldTimestamp, newTimestamp){
  var blipUi, metaUi;
  blipUi = $getBlipView(this.this$0.views, blip);
  metaUi = blipUi?$getMeta(dynamicCast(dynamicCast(blipUi.helper, 276), 277), dynamicCast(blipUi.impl, 278)):null;
  !!metaUi && $setTime(metaUi, $formatPastDate(new Date_2(valueOf_14(blip.blip.blip.lastModifiedTime).value_0), new Date_1));
}
;
_.onParticipantAdded = function onParticipantAdded_3(participant){
  var participantUi;
  participantUi = $getParticipantsView(this.this$0.views, this.conversation);
  $appendParticipant(participantUi, this.conversation, participant);
  $monitorParticipation(this.profileRenderer, this.conversation, participant);
}
;
_.onThreadAdded = function onThreadAdded_2(thread){
  var blipView, next, parentBlip, manifestBlips;
  parentBlip = thread.parentBlip;
  blipView = $getBlipView(this.this$0.views, parentBlip);
  if (blipView) {
    next = dynamicCast($findBefore_0(thread, (manifestBlips = parentBlip.manifestBlip.replies.orderedValues , new WaveletBasedConversationBlip$2_0(parentBlip, manifestBlips))), 248);
    $presentAfter(this.this$0.replyHandler, blipView, next, thread);
  }
   else {
    throw new IllegalStateException_1('blipView not present');
  }
}
;
_.onThreadDeleted = function onThreadDeleted_2(thread){
  var threadView;
  threadView = $getInlineThreadView(this.this$0.views, thread);
  !!threadView && dynamicCast(threadView.helper, 323).removeThread(threadView.impl);
}
;
_.pageIn = function pageIn_1(blip){
  $pageIn(this, blip);
}
;
_.castableTypeMap$ = {17:1, 322:1, 374:1, 375:1};
_.conversation = null;
_.profileRenderer = null;
_.this$0 = null;
function $destroy_0(this$static){
  $remove_42(this$static.profiles.listeners, this$static);
  $cancel_4(this$static.contributorUpdater);
}

function $init_14(this$static){
  $add_31(this$static.profiles.listeners, this$static);
}

function $monitorContribution(this$static, b, c){
  var blips;
  blips = dynamicCast(this$static.contributions.get_4(c.address), 324);
  if (!blips) {
    blips = ($clinit_2309() , defaultCollectionFactory.createIdentitySet());
    this$static.contributions.put_3(c.address, blips);
  }
  blips.add_2(b);
}

function $monitorParticipation(this$static, c, p){
  var conversations;
  conversations = dynamicCast(this$static.participations.get_4(p.address), 324);
  if (!conversations) {
    conversations = ($clinit_2309() , defaultCollectionFactory.createIdentitySet());
    this$static.participations.put_3(p.address, conversations);
  }
  conversations.add_2(c);
}

function $unmonitorContribution(this$static, b, c){
  var blips;
  blips = dynamicCast(this$static.contributions.get_4(c.address), 324);
  if (blips) {
    blips.remove_6(b);
    blips.isEmpty() && this$static.contributions.remove_8(c.address);
  }
}

function LiveProfileRenderer_0(profiles, contributorUpdater){
  this.contributions = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  this.participations = defaultCollectionFactory.createStringMap();
  this.profiles = profiles;
  this.contributorUpdater = contributorUpdater;
}

function create_41(timer, profiles, views, blipRenderer){
  var contributorUpdater;
  contributorUpdater = new LiveProfileRenderer$1_0(timer, views, blipRenderer);
  return new LiveProfileRenderer_0(profiles, contributorUpdater);
}

function LiveProfileRenderer(){
}

_ = LiveProfileRenderer_0.prototype = LiveProfileRenderer.prototype = new Object_0;
_.getClass$ = function getClass_931(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_LiveProfileRenderer_2_classLit;
}
;
_.castableTypeMap$ = {178:1};
_.contributorUpdater = null;
_.profiles = null;
function $process(this$static, blip){
  var blipUi, metaUi;
  blipUi = blip?$getBlipView(this$static.val$views, blip):null;
  metaUi = blipUi?$getMeta(dynamicCast(dynamicCast(blipUi.helper, 276), 277), dynamicCast(blipUi.impl, 278)):null;
  !!metaUi && $renderContributors(this$static.val$blipRenderer, blip, metaUi);
}

function LiveProfileRenderer$1_0($anonymous0, val$views, val$blipRenderer){
  this.val$views = val$views;
  this.val$blipRenderer = val$blipRenderer;
  this.timer = $anonymous0;
  this.queue = ($clinit_2309() , defaultCollectionFactory.createQueue());
}

function LiveProfileRenderer$1(){
}

_ = LiveProfileRenderer$1_0.prototype = LiveProfileRenderer$1.prototype = new QueueProcessor;
_.getClass$ = function getClass_932(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_LiveProfileRenderer$1_2_classLit;
}
;
_.castableTypeMap$ = {251:1, 253:1};
_.val$blipRenderer = null;
_.val$views = null;
function $init_15(this$static){
  $addListener_1(this$static.supplement, this$static);
}

function LiveSupplementRenderer_0(supplement, views, readMonitor){
  this.supplement = supplement;
  this.views = views;
  this.readMonitor = readMonitor;
  $add_31(readMonitor.listeners, this);
}

function LiveSupplementRenderer(){
}

_ = LiveSupplementRenderer_0.prototype = LiveSupplementRenderer.prototype = new ObservableSupplementedWave$ListenerImpl;
_.getClass$ = function getClass_933(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_LiveSupplementRenderer_2_classLit;
}
;
_.onMaybeBlipReadChanged = function onMaybeBlipReadChanged_2(blip){
  var blipUi, metaUi;
  blipUi = $getBlipView(this.views, blip);
  metaUi = blipUi?$getMeta(dynamicCast(dynamicCast(blipUi.helper, 276), 277), dynamicCast(blipUi.impl, 278)):null;
  !!metaUi && $setRead(metaUi, !$isUnread(this.supplement, blip));
}
;
_.castableTypeMap$ = {259:1, 264:1};
_.readMonitor = null;
_.supplement = null;
_.views = null;
function $apply_24(this$static, thread){
  var threadUi;
  thread.parentBlip?(threadUi = $getInlineThreadView(this$static.this$0.views, thread)):(threadUi = $getRootThreadView(this$static.this$0.views, thread));
  threadUi.setUnreadBlipCount($getUnreadCount(this$static.this$0.readMonitor, thread));
}

function LiveSupplementRenderer$1_0(this$0){
  this.this$0 = this$0;
}

function LiveSupplementRenderer$1(){
}

_ = LiveSupplementRenderer$1_0.prototype = LiveSupplementRenderer$1.prototype = new Object_0;
_.apply_7 = function apply_74(thread){
  $apply_24(this, dynamicCast(thread, 248));
}
;
_.getClass$ = function getClass_934(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_LiveSupplementRenderer$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $pageIn_0(this$static, blip){
  var handler, handler$array, handler$index, handler$max;
  for (handler$array = this$static.handlers , handler$index = 0 , handler$max = handler$array.length; handler$index < handler$max; ++handler$index) {
    handler = handler$array[handler$index];
    handler.pageIn(blip);
  }
}

function PagingHandlerProxy_0(handlers){
  this.handlers = handlers;
}

function PagingHandlerProxy(){
}

_ = PagingHandlerProxy_0.prototype = PagingHandlerProxy.prototype = new Object_0;
_.getClass$ = function getClass_935(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_PagingHandlerProxy_2_classLit;
}
;
_.pageIn = function pageIn_2(blip){
  $pageIn_0(this, blip);
}
;
_.castableTypeMap$ = {17:1};
_.handlers = null;
function $onAnchorAddedBefore(this$static, blip, ref, dood){
  var blipUi, defaultUi, inlineUi, metaUi, reply, replyUi;
  blipUi = $getBlipView(this$static.views, blip);
  metaUi = blipUi?$getMeta(dynamicCast(dynamicCast(blipUi.helper, 276), 277), dynamicCast(blipUi.impl, 278)):null;
  if (metaUi) {
    inlineUi = (!dood.anchor && (dood.anchor = $asAnchor_1(dood.this$0.views, dood.el.implNodelet)) , dood.anchor);
    $insertInlineAnchorBefore_1(metaUi, ref?(!ref.anchor && (ref.anchor = $asAnchor_1(ref.this$0.views, ref.el.implNodelet)) , ref.anchor):null, inlineUi);
    reply = dynamicCast(blip.replies.get_4(dood.threadId), 258);
    defaultUi = reply?$getDefaultAnchor(this$static.views, reply):null;
    replyUi = defaultUi?$getThread(dynamicCast(dynamicCast(defaultUi.helper, 287), 288), dynamicCast(defaultUi.impl, 289)):null;
    if (replyUi) {
      $detach_0((dynamicCast(defaultUi.helper, 287) , defaultUi.impl), replyUi);
      $attach_0((dynamicCast(inlineUi.helper, 287) , inlineUi.impl), replyUi);
    }
  }
}

function $onAnchorRemoved(this$static, blip, dood){
  var blipUi, defaultUi, inlineUi, metaUi, reply, replyUi;
  blipUi = $getBlipView(this$static.views, blip);
  metaUi = blip?$getMeta(dynamicCast(dynamicCast(blipUi.helper, 276), 277), dynamicCast(blipUi.impl, 278)):null;
  if (metaUi) {
    inlineUi = (!dood.anchor && (dood.anchor = $asAnchor_1(dood.this$0.views, dood.el.implNodelet)) , dood.anchor);
    reply = dynamicCast(blip.replies.get_4(dood.threadId), 258);
    defaultUi = reply?$getDefaultAnchor(this$static.views, reply):null;
    replyUi = $getThread(dynamicCast(dynamicCast(inlineUi.helper, 287), 288), dynamicCast(inlineUi.impl, 289));
    if (replyUi) {
      $detach_0((dynamicCast(inlineUi.helper, 287) , inlineUi.impl), replyUi);
      $attach_0((dynamicCast(defaultUi.helper, 287) , defaultUi.impl), replyUi);
    }
    !dood.anchor && (dood.anchor = $asAnchor_1(dood.this$0.views, dood.el.implNodelet));
    $remove_37(dood.anchor);
  }
}

function $presentAfter(this$static, blipUi, ref, thread){
  var defaultUi, inlineUi, refDefault, threadUi;
  refDefault = ref?$getDefaultAnchor(this$static.views, ref):null;
  checkArgument_0(!ref || !!refDefault, 'ref is not rendered');
  defaultUi = $insertDefaultAnchorAfter_0(dynamicCast(blipUi.helper, 276), blipUi.impl, refDefault, thread);
  threadUi = $getThread(dynamicCast(dynamicCast(defaultUi.helper, 287), 288), dynamicCast(defaultUi.impl, 289));
  inlineUi = $getInlineAnchor(this$static.views, thread);
  if (inlineUi) {
    $detach_0((dynamicCast(defaultUi.helper, 287) , defaultUi.impl), threadUi);
    $attach_0((dynamicCast(inlineUi.helper, 287) , inlineUi.impl), threadUi);
  }
  return threadUi;
}

function ReplyManager_0(views){
  this.views = views;
}

function ReplyManager(){
}

_ = ReplyManager_0.prototype = ReplyManager.prototype = new Object_0;
_.getClass$ = function getClass_936(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_ReplyManager_2_classLit;
}
;
_.castableTypeMap$ = {};
_.views = null;
function $buildNames_0(this$static, contributors){
  var contributor, contributor$iterator, i, names;
  names = new StringBuilder_0;
  i = 0;
  for (contributor$iterator = contributors.iterator_0(); contributor$iterator.hasNext();) {
    contributor = dynamicCast(contributor$iterator.next_0(), 164);
    if (i >= 3) {
      break;
    }
    i > 0 && (names.impl.string += ', ' , names);
    $append_11(names, $getFirstName($getProfile(this$static.manager, contributor)));
    ++i;
  }
  return names.impl.string;
}

function $render_18(this$static, blip, view){
  $renderContributors(this$static, blip, view);
  view.setTime($formatPastDate(new Date_2(valueOf_14(blip.blip.blip.lastModifiedTime).value_0), new Date_1));
  view.setRead(!$isUnread(this$static.supplement, blip));
}

function $renderContributors(this$static, blip, meta){
  var contributors;
  contributors = ($clinit_480() , new Collections$UnmodifiableSet_0(blip.blip.blip.contributors));
  if (contributors.coll.isEmpty()) {
    meta.setAvatar('');
    meta.setMetaline('anon');
  }
   else {
    meta.setAvatar($getImageUrl($getProfile(this$static.manager, dynamicCast(contributors.iterator_0().next_0(), 164))));
    meta.setMetaline($buildNames_0(this$static, contributors));
  }
}

function UndercurrentShallowBlipRenderer_0(manager, supplement){
  this.manager = manager;
  this.supplement = supplement;
}

function UndercurrentShallowBlipRenderer(){
}

_ = UndercurrentShallowBlipRenderer_0.prototype = UndercurrentShallowBlipRenderer.prototype = new Object_0;
_.getClass$ = function getClass_937(){
  return Lorg_waveprotocol_wave_client_wavepanel_render_UndercurrentShallowBlipRenderer_2_classLit;
}
;
_.castableTypeMap$ = {};
_.manager = null;
_.supplement = null;
function $clinit_1432(){
  $clinit_1432 = nullMethod;
  REPLY = new IntrinsicBlipMetaView$MenuOption_0('REPLY', 0);
  DELETE_2 = new IntrinsicBlipMetaView$MenuOption_0('DELETE', 1);
  LINK = new IntrinsicBlipMetaView$MenuOption_0('LINK', 2);
  EDIT = new IntrinsicBlipMetaView$MenuOption_0('EDIT', 3);
  $VALUES_43 = initValues(_3Lorg_waveprotocol_wave_client_wavepanel_view_IntrinsicBlipMetaView$MenuOption_2_classLit, {9:1, 68:1, 170:1}, 122, [REPLY, DELETE_2, LINK, EDIT]);
}

function IntrinsicBlipMetaView$MenuOption_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_50(name_0){
  $clinit_1432();
  return valueOf_0(($clinit_1433() , $MAP_43), name_0);
}

function values_44(){
  $clinit_1432();
  return $VALUES_43;
}

function IntrinsicBlipMetaView$MenuOption(){
}

_ = IntrinsicBlipMetaView$MenuOption_0.prototype = IntrinsicBlipMetaView$MenuOption.prototype = new Enum;
_.getClass$ = function getClass_938(){
  return Lorg_waveprotocol_wave_client_wavepanel_view_IntrinsicBlipMetaView$MenuOption_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 122:1};
var $VALUES_43, DELETE_2, EDIT, LINK, REPLY;
function $clinit_1433(){
  $clinit_1433 = nullMethod;
  $MAP_43 = createValueOfMap(($clinit_1432() , $VALUES_43));
}

var $MAP_43;
function $blipId(this$static, b){
  return $shorten(this$static, $toString_28(dynamicCast(($clinit_2183() , b.helper.this$0.wavelet.wavelet.id_0), 446)).replace(/&/g, '&&').replace(/,/g, '&c') + ',' + dynamicCast($get_22(b.manifestBlip.id_0), 1).replace(/&/g, '&&').replace(/,/g, '&c'));
}

function $locateBlip(this$static, modelId){
  var c, longId, parts;
  longId = dynamicCast(this$static.shortIdToLongIdMap.get_4(modelId), 1);
  parts = split_1(longId);
  if (parts.length != 2) {
    throw new IllegalArgumentException_1('Not a blip model id: ' + modelId);
  }
   else {
    c = $getConversation(this$static.model, $fromString(($clinit_2183() , parts[0])));
    return c?dynamicCast(c.blips.get_4(parts[1]), 373):null;
  }
}

function $participantId(this$static, c, p){
  return $shorten(this$static, $toString_28(dynamicCast(($clinit_2183() , c.wavelet.wavelet.id_0), 446)).replace(/&/g, '&&').replace(/,/g, '&c') + ',' + p.address.replace(/&/g, '&&').replace(/,/g, '&c'));
}

function $shorten(this$static, longId){
  var shortId;
  shortId = dynamicCast(this$static.longIdToShortIdMap.get_4(longId), 1);
  if (shortId == null) {
    shortId = this$static.prefix + this$static.nextId++;
    checkArgument_0(!this$static.shortIdToLongIdMap.containsKey_1(shortId) && !this$static.longIdToShortIdMap.containsKey_1(longId), 'Id already exist');
    this$static.shortIdToLongIdMap.put_3(shortId, longId);
    this$static.longIdToShortIdMap.put_3(longId, shortId);
  }
  return shortId;
}

function $threadId(this$static, t){
  return $shorten(this$static, $toString_28(dynamicCast(($clinit_2183() , t.helper.this$0.wavelet.wavelet.id_0), 446)).replace(/&/g, '&&').replace(/,/g, '&c') + ',' + (t == t.helper.this$0.rootThread?'':dynamicCast($get_22(t.manifestThread.id_0), 1)).replace(/&/g, '&&').replace(/,/g, '&c'));
}

function ModelIdMapperImpl_0(model){
  this.shortIdToLongIdMap = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  this.longIdToShortIdMap = defaultCollectionFactory.createStringMap();
  this.model = model;
  this.prefix = 'UC';
  this.nextId = 0;
}

function split_1(domId){
  var i, parts;
  parts = $split(domId, ',', -1);
  for (i = 0; i < parts.length; ++i) {
    parts[i] = parts[i].replace(/&c/g, ',').replace(/&&/g, '&');
  }
  return parts;
}

function ModelIdMapperImpl(){
}

_ = ModelIdMapperImpl_0.prototype = ModelIdMapperImpl.prototype = new Object_0;
_.getClass$ = function getClass_939(){
  return Lorg_waveprotocol_wave_client_wavepanel_view_ModelIdMapperImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.model = null;
_.nextId = 0;
_.prefix = null;
function $anchorRoot(this$static, blip, threadId){
  return $blipId(this$static.modelMapper, blip) + threadId;
}

function $blipOf_0(this$static, domId){
  return $locateBlip(this$static.modelMapper, domId.substr(0, domId.length - 1 - 0));
}

function $defaultAnchorOf(this$static, t){
  return $anchorRoot(this$static, t.parentBlip, t == t.helper.this$0.rootThread?'':dynamicCast($get_22(t.manifestThread.id_0), 1)) + 'D';
}

function $inlineAnchorOf(this$static, blip, threadId){
  return $blipId(this$static.modelMapper, blip) + threadId + 'I';
}

function ViewIdMapper_0(modelMapper){
  this.modelMapper = modelMapper;
}

function ViewIdMapper(){
}

_ = ViewIdMapper_0.prototype = ViewIdMapper.prototype = new Object_0;
_.getClass$ = function getClass_941(){
  return Lorg_waveprotocol_wave_client_wavepanel_view_ViewIdMapper_2_classLit;
}
;
_.castableTypeMap$ = {};
_.modelMapper = null;
function $removeChild_6(this$static, e){
  checkArgument(!!e && $getParentElement(e) == this$static.self_0);
  $removeFromParent(e);
}

function $setChild(this$static, e){
  checkArgument(!!e);
  checkArgument(!$getParentElement(e));
  checkState(!$getFirstChildElement(this$static.self_0));
  this$static.self_0.appendChild(e);
}

function $setParentId(this$static, id){
  if (this$static.self_0.hasAttribute('pid')) {
    checkArgument(id == null);
    this$static.self_0.removeAttribute('pid');
  }
   else {
    checkArgument(id != null && !!id.length);
    this$static.self_0.setAttribute('pid', id);
  }
}

function $insertInlineLocatorBefore(this$static, ref, x){
  var id;
  id = ref?ref.id:null;
  $insertBefore_0($getInlineLocators(this$static), id, x.id);
}

function $removeInlineLocator(this$static, x){
  $remove_30($getInlineLocators(this$static), x.id);
}

function $setContent_2(this$static, document_0){
  $addClassName(document_0, 'document');
  $getFirstChildElement((!this$static.contentContainer && (this$static.contentContainer = load(this$static.id_0, ($clinit_1495() , CONTENT))) , this$static.contentContainer)).appendChild(document_0);
}

_ = BlipMetaDomImpl.prototype;
_.setAvatar = function setAvatar(avatarUrl){
  (!this.avatar && (this.avatar = load(this.id_0, ($clinit_1495() , AVATAR))) , this.avatar).src = avatarUrl;
}
;
_.setMetaline = function setMetaline(metaline){
  (!this.metaline && (this.metaline = load(this.id_0, ($clinit_1495() , METALINE))) , this.metaline).textContent = metaline || '';
}
;
_.setRead = function setRead(read){
  read?((!this.metabar && (this.metabar = load(this.id_0, ($clinit_1495() , METABAR))) , this.metabar).className = 'C-AM-org-waveprotocol-wave-client-wavepanel-view-dom-full-BlipViewBuilder-Css-metabar C-DM-org-waveprotocol-wave-client-wavepanel-view-dom-full-BlipViewBuilder-Css-read' , undefined):((!this.metabar && (this.metabar = load(this.id_0, ($clinit_1495() , METABAR))) , this.metabar).className = 'C-AM-org-waveprotocol-wave-client-wavepanel-view-dom-full-BlipViewBuilder-Css-metabar C-GM-org-waveprotocol-wave-client-wavepanel-view-dom-full-BlipViewBuilder-Css-unread' , undefined);
}
;
_.setTime = function setTime(time){
  (!this.time && (this.time = load(this.id_0, ($clinit_1495() , TIME_0))) , this.time).textContent = time || '';
}
;
function $setTotalBlipCount(this$static, totalBlipCount){
  this$static.self_0.setAttribute('t', '' + totalBlipCount);
  (!this$static.countTotal?(this$static.countTotal = load(this$static.id_0, ($clinit_1503() , COUNT_TOTAL))):this$static.countTotal).textContent = '' + totalBlipCount || '';
}

function $setUnreadBlipCount(this$static, unreadBlipCount){
  var unread;
  this$static.self_0.setAttribute('u', '' + unreadBlipCount);
  unread = !this$static.countUnread?(this$static.countUnread = load(this$static.id_0, ($clinit_1503() , COUNT_UNREAD))):this$static.countUnread;
  unread.textContent = '(' + unreadBlipCount + ')' || '';
  unreadBlipCount > 0?(unread.style['display'] = '' , undefined):(unread.style['display'] = ($clinit_63() , 'none') , undefined);
  $updatedCssClassNames(this$static);
}

function attachAfter(container, ref, target){
  var next;
  checkArgument(!ref || $getParentElement(ref) == container);
  checkArgument(!$getParentElement(target));
  !ref?container.insertBefore(target, container.firstChild):(next = !ref?null:ref.nextSibling , !next?container.appendChild(target):container.insertBefore(target, next));
}

function attachBefore(container, ref, target){
  checkArgument(!ref || $getParentElement(ref) == container);
  checkArgument(!$getParentElement(target));
  !ref?container.appendChild(target):container.insertBefore(target, ref);
}

function detach(container, target){
  checkArgument(!!target && $getParentElement(target) == container);
  $removeFromParent(target);
}

function $asAnchor_1(this$static, e){
  return checkArgument(!e || $typeOf(e) == ($clinit_1453() , ANCHOR)) , !e?null:new AnchorViewImpl_0(this$static.anchorHelper, new AnchorDomImpl_0(e));
}

function $asAnchorUnchecked(this$static, e){
  return !e?null:new AnchorViewImpl_0(this$static.anchorHelper, new AnchorDomImpl_0(e));
}

function $asConversation(this$static, e){
  var type;
  if (!e) {
    return null;
  }
   else {
    type = $typeOf(e);
    switch (type.ordinal) {
      case 1:
        return !e?null:new TopConversationViewImpl_0(this$static.convHelper, new TopConversationDomImpl_0(e, e.id));
      case 2:
        return !e?null:new InlineConversationViewImpl_0(this$static.inlineConvHelper, new InlineConversationDomImpl_0(of_4(e, this$static.cssProvider)));
      default:throw new IllegalArgumentException_1('Element has a non-conversation type: ' + type);
    }
  }
}

function $asInlineConversationUnchecked(this$static, e){
  return !e?null:new InlineConversationViewImpl_0(this$static.inlineConvHelper, new InlineConversationDomImpl_0(of_4(e, this$static.cssProvider)));
}

function $asInlineThread_1(this$static, e){
  return checkArgument(!e || $typeOf(e) == ($clinit_1453() , INLINE_THREAD)) , !e?null:new InlineThreadViewImpl_0(this$static.inlineThreadHelper, new InlineThreadDomImpl_0(of_4(e, this$static.cssProvider)));
}

function $asParticipant(this$static, e){
  checkArgument(!e || $typeOf(e) == ($clinit_1453() , PARTICIPANT));
  return !e?null:new ParticipantViewImpl_0(this$static.participantHelper, new ParticipantNameDomImpl_0(e));
}

function $asParticipants(this$static, e){
  checkArgument(!e || $typeOf(e) == ($clinit_1453() , PARTICIPANTS));
  return !e?null:new ParticipantsViewImpl_0(this$static.participantsHelper, new ParticipantsDomImpl_0(e, e.id));
}

function $asRootThread_1(this$static, e){
  return checkArgument(!e || $typeOf(e) == ($clinit_1453() , ROOT_THREAD)) , !e?null:new RootThreadViewImpl_0(this$static.rootThreadHelper, new RootThreadDomImpl_0(e, e.id));
}

function $getRenderer_0(this$static){
  checkState_0(!!this$static.renderer, 'Renderer not ready');
  return this$static.renderer;
}

_ = FullStructure$10.prototype;
_.remove_6 = function remove_51(impl){
  $removeFromParent($getElement_3(dynamicCast(impl, 300).c));
}
;
function $append_16(this$static, impl, conv, participant){
  var oldDisplay, t;
  t = $parseHtml($render_8($getRenderer_0(this$static.this$0).driver.builders, conv, participant));
  attachBefore((!impl.participantContainer && (impl.participantContainer = load(impl.id_0, ($clinit_1518() , CONTAINER))) , impl.participantContainer), (!impl.simple && (impl.simple = (!impl.participantContainer && (impl.participantContainer = load(impl.id_0, ($clinit_1518() , CONTAINER))) , impl.participantContainer).lastChild.previousSibling) , impl.simple), t);
  oldDisplay = impl.self_0.style['display'];
  impl.self_0.style['display'] = ($clinit_63() , 'none');
  impl.self_0.offsetParent;
  impl.self_0.style['display'] = oldDisplay;
  return $asParticipant(this$static.this$0, t);
}

function $append_17(this$static, impl, conv, participant){
  return $append_16(this$static, dynamicCast(impl, 330), conv, participant);
}

function $insertInlineAnchorBefore(impl, ref, x){
  var anchor;
  anchor = dynamicCast(x.impl, 289);
  $insertInlineLocatorBefore(impl, !ref?null:dynamicCast(ref.impl, 325).getElement(), anchor.self_0);
  $setParentId(anchor, impl.id_0);
}

function $insertInlineAnchorBefore_0(impl, ref, x){
  $insertInlineAnchorBefore(dynamicCast(impl, 302), ref, x);
}

function $insertConversationBefore(this$static, impl, c){
  var convDom;
  convDom = $parseHtml($render_2($getRenderer_0(this$static.this$0).driver, c));
  attachBefore((!impl.conversations && (impl.conversations = load(impl.id_0, ($clinit_1500() , PRIVATE_REPLIES))) , impl.conversations), null, convDom);
  return $asInlineConversationUnchecked(this$static.this$0, convDom);
}

function $insertConversationBefore_0(this$static, impl, c){
  return $insertConversationBefore(this$static, dynamicCast(impl, 278), c);
}

function $insertDefaultAnchorAfter(this$static, impl, ref, t){
  var anchorDom;
  anchorDom = $parseHtml($render_4($getRenderer_0(this$static.this$0).driver, t));
  attachAfter((!impl.replies && (impl.replies = load(impl.id_0, ($clinit_1500() , REPLIES))) , impl.replies), !ref?null:dynamicCast(ref.impl, 325).getElement(), anchorDom);
  return $asAnchorUnchecked(this$static.this$0, anchorDom);
}

function $insertDefaultAnchorAfter_0(this$static, impl, ref, t){
  return $insertDefaultAnchorAfter(this$static, dynamicCast(impl, 278), ref, t);
}

function $insertBlipAfter(this$static, thread, ref, blip){
  var t;
  t = $parseHtml($render_5($getRenderer_0(this$static.this$0).driver, blip));
  $insertAfter((!thread.blips && (thread.blips = load(thread.id_0, ($clinit_1525() , BLIPS))) , thread.blips), t, !ref?null:dynamicCast(ref.impl, 325).getElement());
  return $asBlip(this$static.this$0, t);
}

_ = FullStructure$4.prototype;
_.insertBlipAfter = function insertBlipAfter(thread, ref, blip){
  return $insertBlipAfter(this, dynamicCast(thread, 331), ref, blip);
}
;
_.removeThread = function removeThread(thread){
  $removeFromParent(dynamicCast(thread, 331).self_0);
}
;
function $insertBlipAfter_0(this$static, thread, ref, blip){
  var t;
  t = $parseHtml($render_5($getRenderer_0(this$static.this$0).driver, blip));
  $insertAfter($getFirstChildElement($getChrome(thread.c)), t, !ref?null:dynamicCast(ref.impl, 325).getElement());
  return $asBlip(this$static.this$0, t);
}

_ = FullStructure$6.prototype;
_.insertBlipAfter = function insertBlipAfter_0(thread, ref, blip){
  return $insertBlipAfter_0(this, dynamicCast(thread, 332), ref, blip);
}
;
_.removeThread = function removeThread_0(thread){
  $removeFromParent($getElement_3(dynamicCast(thread, 332).c));
}
;
function $attach(anchor, thread){
  $setChild(anchor, !thread?null:dynamicCast(thread.impl, 325).getElement());
}

function $attach_0(anchor, thread){
  $attach(dynamicCast(anchor, 289), thread);
}

function $detach(anchor, thread){
  $removeChild_6(anchor, !thread?null:dynamicCast(thread.impl, 325).getElement());
}

function $detach_0(anchor, thread){
  $detach(dynamicCast(anchor, 289), thread);
}

function $remove_36(this$static, impl){
  var parent_0, parentImpl;
  parent_0 = $getParent_3(this$static, impl);
  if (parent_0.getType_1() == ($clinit_1453() , BLIP)) {
    parentImpl = dynamicCast(dynamicCast(parent_0, 333).impl, 278);
    detach((!parentImpl.replies && (parentImpl.replies = load(parentImpl.id_0, ($clinit_1500() , REPLIES))) , parentImpl.replies), impl.self_0);
  }
   else if (parent_0.getType_1() == META_0) {
    parentImpl = dynamicCast(dynamicCast(parent_0, 333).impl, 302);
    $removeInlineLocator(parentImpl, impl.self_0);
    $setParentId(impl, null);
  }
}

_ = FullStructure$9.prototype;
_.remove_6 = function remove_52(impl){
  $removeFromParent(dynamicCast(impl, 280).self_0);
}
;
_ = InlineThreadDomImpl.prototype;
_.setTotalBlipCount = function setTotalBlipCount(totalBlipCount){
  $setTotalBlipCount(this.c, totalBlipCount);
}
;
_.setUnreadBlipCount = function setUnreadBlipCount(unreadBlipCount){
  $setUnreadBlipCount(this.c, unreadBlipCount);
}
;
function $getBlipView(this$static, source){
  var e;
  e = $doc.getElementById($blipId(this$static.viewIdMapper.modelMapper, source) + 'B');
  return $asBlip_1(this$static.viewProvider, e);
}

function $getConversationView(this$static, conv){
  var e;
  e = $doc.getElementById($shorten(this$static.viewIdMapper.modelMapper, $toString_28(dynamicCast(($clinit_2183() , conv.wavelet.wavelet.id_0), 446))) + 'C');
  return $asConversation(this$static.viewProvider, e);
}

function $getDefaultAnchor(this$static, source){
  var e;
  e = $doc.getElementById($defaultAnchorOf(this$static.viewIdMapper, source));
  return $asAnchor_1(this$static.viewProvider, e);
}

function $getInlineAnchor(this$static, source){
  var domId, e;
  domId = $inlineAnchorOf(this$static.viewIdMapper, source.parentBlip, source == source.helper.this$0.rootThread?'':dynamicCast($get_22(source.manifestThread.id_0), 1));
  e = $doc.getElementById(domId);
  return $asAnchor_1(this$static.viewProvider, e);
}

function $getInlineThreadView(this$static, source){
  var e;
  e = $doc.getElementById($threadId(this$static.viewIdMapper.modelMapper, source) + 'T');
  return $asInlineThread_1(this$static.viewProvider, e);
}

function $getParticipantsView(this$static, conv){
  var e;
  e = $doc.getElementById($shorten(this$static.viewIdMapper.modelMapper, $toString_28(dynamicCast(($clinit_2183() , conv.wavelet.wavelet.id_0), 446))) + 'P');
  return $asParticipants(this$static.viewProvider, e);
}

function $getRootThreadView(this$static, source){
  var e;
  e = $doc.getElementById($threadId(this$static.viewIdMapper.modelMapper, source) + 'T');
  return $asRootThread_1(this$static.viewProvider, e);
}

function ModelAsViewProviderImpl_0(viewIdMapper, viewProvider){
  this.viewProvider = viewProvider;
  this.viewIdMapper = viewIdMapper;
}

function ModelAsViewProviderImpl(){
}

_ = ModelAsViewProviderImpl_0.prototype = ModelAsViewProviderImpl.prototype = new Object_0;
_.getClass$ = function getClass_965(){
  return Lorg_waveprotocol_wave_client_wavepanel_view_dom_ModelAsViewProviderImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.viewIdMapper = null;
_.viewProvider = null;
_ = RootThreadDomImpl.prototype;
_.setTotalBlipCount = function setTotalBlipCount_0(totalBlipCount){
  this.self_0.setAttribute('t', '' + totalBlipCount);
}
;
_.setUnreadBlipCount = function setUnreadBlipCount_0(unreadBlipCount){
  this.self_0.setAttribute('u', '' + unreadBlipCount);
}
;
function AnchorViewBuilder_0(id, thread){
  this.id_0 = id;
  this.thread = thread;
}

function AnchorViewBuilder(){
}

_ = AnchorViewBuilder_0.prototype = AnchorViewBuilder.prototype = new Object_0;
_.getClass$ = function getClass_971(){
  return Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_AnchorViewBuilder_2_classLit;
}
;
_.outputHtml = function outputHtml_7(output){
  openSpan(output, this.id_0, null, ($clinit_1531() , dynamicCast($get_10(CODES, ($clinit_1453() , ANCHOR)), 1)));
  this.thread.outputHtml(output);
  $append_11(output.sb, '<\/span>');
}
;
_.castableTypeMap$ = {15:1, 16:1};
_.id_0 = null;
_.thread = null;
function $clinit_1493(){
  var outerIter, entry;
  $clinit_1493 = nullMethod;
  var option, option$iterator;
  MENU_CODES = new EnumMap_0(Lorg_waveprotocol_wave_client_wavepanel_view_IntrinsicBlipMetaView$MenuOption_2_classLit);
  MENU_LABELS = new EnumMap_0(Lorg_waveprotocol_wave_client_wavepanel_view_IntrinsicBlipMetaView$MenuOption_2_classLit);
  MENU_OPTIONS = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  DISABLED_WHILE_EDITING_MENU_OPTIONS_SET = of(($clinit_1432() , REPLY), initValues(_3Lorg_waveprotocol_wave_client_wavepanel_view_IntrinsicBlipMetaView$MenuOption_2_classLit, {9:1, 68:1, 170:1}, 122, [DELETE_2, LINK]));
  $put_2(MENU_CODES, EDIT, ($clinit_592() , new SafeHtmlString_0('e')));
  $put_2(MENU_CODES, REPLY, new SafeHtmlString_0('r'));
  $put_2(MENU_CODES, DELETE_2, new SafeHtmlString_0('d'));
  $put_2(MENU_CODES, LINK, new SafeHtmlString_0('l'));
  $put_2(MENU_LABELS, EDIT, new SafeHtmlString_0('Edit'));
  $put_2(MENU_LABELS, REPLY, new SafeHtmlString_0('Reply'));
  $put_2(MENU_LABELS, DELETE_2, new SafeHtmlString_0('Delete'));
  $put_2(MENU_LABELS, LINK, new SafeHtmlString_0('Link'));
  for (option$iterator = (outerIter = $keySet_0(MENU_CODES).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter)); option$iterator.val$outerIter.hasNext();) {
    option = dynamicCast((entry = dynamicCast(option$iterator.val$outerIter.next_0(), 11) , entry.getKey()), 122);
    MENU_OPTIONS.put_3(dynamicCast(dynamicCast($get_10(MENU_CODES, option), 337), 338).html, option);
  }
}

function BlipMetaViewBuilder_0(id, content_0){
  this.options = allOf(Lorg_waveprotocol_wave_client_wavepanel_view_IntrinsicBlipMetaView$MenuOption_2_classLit);
  this.selected = noneOf(Lorg_waveprotocol_wave_client_wavepanel_view_IntrinsicBlipMetaView$MenuOption_2_classLit);
  checkArgument(id.indexOf("'") == -1);
  this.id_0 = id;
  this.content_0 = content_0;
}

function create_42(id, content_0){
  $clinit_1493();
  return new BlipMetaViewBuilder_0(($clinit_1533() , id), content_0?content_0:($clinit_1251() , EMPTY_0));
}

function BlipMetaViewBuilder(){
}

_ = BlipMetaViewBuilder_0.prototype = BlipMetaViewBuilder.prototype = new Object_0;
_.getClass$ = function getClass_973(){
  return Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_BlipMetaViewBuilder_2_classLit;
}
;
_.outputHtml = function outputHtml_8(output){
  open_1(output, this.id_0, 'C-PL-org-waveprotocol-wave-client-wavepanel-view-dom-full-BlipViewBuilder-Css-meta', ($clinit_1531() , dynamicCast($get_10(CODES, ($clinit_1453() , META_0)), 1)));
  image_0(output, $getDomId(($clinit_1495() , AVATAR), this.id_0), 'C-JL-org-waveprotocol-wave-client-wavepanel-view-dom-full-BlipViewBuilder-Css-avatar', ($clinit_592() , new SafeHtmlString_0($replaceAll($replaceAll($replaceAll($replaceAll($replaceAll(this.avatarUrl, '&', '&amp;'), '"', '&quot;'), "'", '&#39;'), '<', '&lt;'), '>', '&gt;'))), new SafeHtmlString_0('author'));
  open_1(output, $getDomId(METABAR, this.id_0), 'C-AM-org-waveprotocol-wave-client-wavepanel-view-dom-full-BlipViewBuilder-Css-metabar ' + (this.read?'C-DM-org-waveprotocol-wave-client-wavepanel-view-dom-full-BlipViewBuilder-Css-read':'C-GM-org-waveprotocol-wave-client-wavepanel-view-dom-full-BlipViewBuilder-Css-unread'), null);
  open_1(output, $getDomId(MENU, this.id_0), 'C-ML-org-waveprotocol-wave-client-wavepanel-view-dom-full-BlipViewBuilder-Css-menu', null);
  $outputHtml_1(new BlipMetaViewBuilder$1_0(this.options, this.selected), output);
  $append_11(output.sb, '<\/div>');
  open_1(output, $getDomId(TIME_0, this.id_0), 'C-FM-org-waveprotocol-wave-client-wavepanel-view-dom-full-BlipViewBuilder-Css-time', null);
  this.time != null && $appendEscaped(output, this.time);
  $append_11(output.sb, '<\/div>');
  open_1(output, $getDomId(METALINE, this.id_0), 'C-BM-org-waveprotocol-wave-client-wavepanel-view-dom-full-BlipViewBuilder-Css-metaline', null);
  this.metaline != null && $appendEscaped(output, this.metaline);
  $append_11(output.sb, '<\/div>');
  $append_11(output.sb, '<\/div>');
  open_1(output, $getDomId(CONTENT, this.id_0), 'C-LL-org-waveprotocol-wave-client-wavepanel-view-dom-full-BlipViewBuilder-Css-contentContainer', 'document');
  this.content_0.outputHtml(output);
  $append_11(output.sb, '<\/div>');
  $append_11(output.sb, '<\/div>');
}
;
_.setAvatar = function setAvatar_0(avatarUrl){
  this.avatarUrl = avatarUrl;
}
;
_.setMetaline = function setMetaline_0(metaline){
  this.metaline = metaline;
}
;
_.setRead = function setRead_0(read){
  this.read = read;
}
;
_.setTime = function setTime_0(time){
  this.time = time;
}
;
_.castableTypeMap$ = {15:1, 16:1, 339:1};
_.avatarUrl = null;
_.content_0 = null;
_.id_0 = null;
_.metaline = null;
_.read = true;
_.time = null;
var DISABLED_WHILE_EDITING_MENU_OPTIONS_SET, MENU_CODES, MENU_LABELS, MENU_OPTIONS;
function $outputHtml_1(this$static, out){
  var extra, option, option$iterator, style;
  for (option$iterator = new EnumSet$EnumSetImpl$IteratorImpl_0(this$static.val$options); option$iterator.i < option$iterator.this$1.all.length;) {
    option = dynamicCast($next_8(option$iterator), 122);
    $append_13(out, ($clinit_592() , new SafeHtmlString_0('|')));
    style = $contains_3(this$static.val$selected, option)?'C-NL-org-waveprotocol-wave-client-wavepanel-view-dom-full-BlipViewBuilder-Css-menuOptionC-OL-org-waveprotocol-wave-client-wavepanel-view-dom-full-BlipViewBuilder-Css-menuOptionSelected':'C-NL-org-waveprotocol-wave-client-wavepanel-view-dom-full-BlipViewBuilder-Css-menuOption';
    extra = "o='" + dynamicCast(dynamicCast($get_10(($clinit_1493() , MENU_CODES), option), 337), 338).html + "'" + ($contains_3(this$static.val$selected, option)?" s='s'":'');
    openSpanWith(out, null, style, ($clinit_1531() , dynamicCast($get_10(CODES, ($clinit_1453() , MENU_ITEM)), 1)), extra);
    $append_13(out, dynamicCast($get_10(MENU_LABELS, option), 337));
    $append_11(out.sb, '<\/span>');
  }
}

function BlipMetaViewBuilder$1_0(val$options, val$selected){
  this.val$options = val$options;
  this.val$selected = val$selected;
}

function BlipMetaViewBuilder$1(){
}

_ = BlipMetaViewBuilder$1_0.prototype = BlipMetaViewBuilder$1.prototype = new Object_0;
_.getClass$ = function getClass_974(){
  return Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_BlipMetaViewBuilder$1_2_classLit;
}
;
_.outputHtml = function outputHtml_9(out){
  $outputHtml_1(this, out);
}
;
_.castableTypeMap$ = {15:1, 16:1};
_.val$options = null;
_.val$selected = null;
function $add_25(this$static, blip){
  this$static.toPageIn.isEmpty() && $schedule_6(this$static.timer, this$static);
  this$static.toPageIn.add_0(blip);
}

function BlipQueueRenderer_0(pager, timer){
  this.toPageIn = ($clinit_2309() , defaultCollectionFactory.createQueue());
  this.pager = pager;
  this.timer = timer;
}

function BlipQueueRenderer(){
}

_ = BlipQueueRenderer_0.prototype = BlipQueueRenderer.prototype = new Object_0;
_.execute = function execute_57(){
  return $pageIn_0(this.pager, dynamicCast(this.toPageIn.remove_5(), 247)) , !this.toPageIn.isEmpty();
}
;
_.getClass$ = function getClass_976(){
  return Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_BlipQueueRenderer_2_classLit;
}
;
_.castableTypeMap$ = {251:1, 253:1};
_.pager = null;
_.timer = null;
function BlipViewBuilder_0(id, meta, replies, privateReplies){
  this.id_0 = id;
  this.meta = meta;
  this.replies = replies;
  this.privateReplies = privateReplies;
}

function create_43(id, meta, replies, privateReplies){
  checkArgument(id.indexOf("'") == -1);
  return new BlipViewBuilder_0(id, meta?meta:($clinit_1251() , EMPTY_0), replies?replies:($clinit_1251() , EMPTY_0), privateReplies?privateReplies:($clinit_1251() , EMPTY_0), $clinit_1533());
}

function BlipViewBuilder(){
}

_ = BlipViewBuilder_0.prototype = BlipViewBuilder.prototype = new Object_0;
_.getClass$ = function getClass_977(){
  return Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_BlipViewBuilder_2_classLit;
}
;
_.getId = function getId_12(){
  return this.id_0;
}
;
_.outputHtml = function outputHtml_10(output){
  open_1(output, this.id_0, 'C-KL-org-waveprotocol-wave-client-wavepanel-view-dom-full-BlipViewBuilder-Css-blip', ($clinit_1531() , dynamicCast($get_10(CODES, ($clinit_1453() , BLIP)), 1)));
  this.meta.outputHtml(output);
  open_1(output, $getDomId_0(($clinit_1500() , REPLIES), this.id_0), 'C-EM-org-waveprotocol-wave-client-wavepanel-view-dom-full-BlipViewBuilder-Css-replies', null);
  this.replies.outputHtml(output);
  $append_11(output.sb, '<\/div>');
  open_1(output, $getDomId_0(PRIVATE_REPLIES, this.id_0), 'C-CM-org-waveprotocol-wave-client-wavepanel-view-dom-full-BlipViewBuilder-Css-privateReplies', null);
  this.privateReplies.outputHtml(output);
  $append_11(output.sb, '<\/div>');
  $append_11(output.sb, '<\/div>');
}
;
_.castableTypeMap$ = {15:1, 16:1, 334:1};
_.id_0 = null;
_.meta = null;
_.privateReplies = null;
_.replies = null;
function $outputHtml_2(this$static, output){
  var collapsedStateCss, extra, readStateCss, unreadExtra;
  readStateCss = ' ' + (this$static.unreadBlipCount > 0?'C-BN-org-waveprotocol-wave-client-wavepanel-view-dom-full-CollapsibleBuilder-Css-unread':'C-PM-org-waveprotocol-wave-client-wavepanel-view-dom-full-CollapsibleBuilder-Css-read');
  collapsedStateCss = ' ' + (this$static.collapsed?'C-JM-org-waveprotocol-wave-client-wavepanel-view-dom-full-CollapsibleBuilder-Css-collapsed':'C-OM-org-waveprotocol-wave-client-wavepanel-view-dom-full-CollapsibleBuilder-Css-expanded');
  extra = ' ' + (this$static.collapsed?"c='c'":'') + " t='" + this$static.totalBlipCount + "' u='" + this$static.unreadBlipCount + "'";
  openWith(output, this$static.id_0, 'C-KM-org-waveprotocol-wave-client-wavepanel-view-dom-full-CollapsibleBuilder-Css-collapsible', this$static.kind, extra);
  open_1(output, $getDomId_1(($clinit_1503() , TOGGLE_0), this$static.id_0), 'C-AN-org-waveprotocol-wave-client-wavepanel-view-dom-full-CollapsibleBuilder-Css-toggle' + readStateCss + collapsedStateCss, ($clinit_1531() , dynamicCast($get_10(CODES, ($clinit_1453() , TOGGLE)), 1)));
  appendSpan(output, $getDomId_1(ARROW, this$static.id_0), 'C-HM-org-waveprotocol-wave-client-wavepanel-view-dom-full-CollapsibleBuilder-Css-arrow', null);
  openSpan(output, $getDomId_1(COUNT, this$static.id_0), 'C-LM-org-waveprotocol-wave-client-wavepanel-view-dom-full-CollapsibleBuilder-Css-count', null);
  openSpan(output, $getDomId_1(COUNT_TOTAL, this$static.id_0), null, null);
  $append_14(output, this$static.totalBlipCount);
  $append_11(output.sb, '<\/span>');
  unreadExtra = this$static.unreadBlipCount <= 0?" style='display: none;'":'';
  openSpanWith(output, $getDomId_1(COUNT_UNREAD, this$static.id_0), null, null, unreadExtra);
  $appendEscaped(output, '(' + this$static.unreadBlipCount + ')');
  $append_11(output.sb, '<\/span>');
  openSpan(output, $getDomId_1(DROP_CONTAINER, this$static.id_0), 'C-NM-org-waveprotocol-wave-client-wavepanel-view-dom-full-CollapsibleBuilder-Css-dropContainer' + collapsedStateCss, null);
  $append_11(output.sb, "<span class='C-MM-org-waveprotocol-wave-client-wavepanel-view-dom-full-CollapsibleBuilder-Css-drop'>");
  $append_11(output.sb, '<\/span>');
  $append_11(output.sb, '<\/span>');
  $append_11(output.sb, '<\/span>');
  $append_11(output.sb, '<\/div>');
  openWith(output, $getDomId_1(CHROME, this$static.id_0), 'C-IM-org-waveprotocol-wave-client-wavepanel-view-dom-full-CollapsibleBuilder-Css-chrome' + collapsedStateCss, null, null);
  this$static.content_0.outputHtml(output);
  $append_11(output.sb, '<\/div>');
  $append_11(output.sb, '<\/div>');
}

function CollapsibleBuilder_0(id, content_0, kind){
  this.id_0 = id;
  this.content_0 = content_0;
  this.kind = kind;
}

function create_44(id, kind, contents){
  checkArgument(id.indexOf("'") == -1);
  return new CollapsibleBuilder_0(id, contents?contents:($clinit_1247() , EMPTY), ($clinit_1533() , kind));
}

function CollapsibleBuilder(){
}

_ = CollapsibleBuilder_0.prototype = CollapsibleBuilder.prototype = new Object_0;
_.getClass$ = function getClass_979(){
  return Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_CollapsibleBuilder_2_classLit;
}
;
_.outputHtml = function outputHtml_11(output){
  $outputHtml_2(this, output);
}
;
_.castableTypeMap$ = {15:1, 16:1};
_.collapsed = false;
_.content_0 = null;
_.id_0 = null;
_.kind = null;
_.totalBlipCount = 0;
_.unreadBlipCount = 0;
function $outputHtml_3(this$static, output){
  openWith(output, this$static.id_0, 'C-EN-org-waveprotocol-wave-client-wavepanel-view-dom-full-ContinuationIndicatorViewBuilder-Css-indicator', ($clinit_1531() , dynamicCast($get_10(CODES, ($clinit_1453() , CONTINUATION_INDICATOR)), 1)), this$static.enabled?'':"style='display:none'");
  $append_11(output.sb, "<div class='C-DN-org-waveprotocol-wave-client-wavepanel-view-dom-full-ContinuationIndicatorViewBuilder-Css-icon'>");
  $append_11(output.sb, '<\/div>');
  $append_11(output.sb, "<div class='C-CN-org-waveprotocol-wave-client-wavepanel-view-dom-full-ContinuationIndicatorViewBuilder-Css-bar'>");
  $append_11(output.sb, '<\/div>');
  $append_11(output.sb, '<\/div>');
}

function ContinuationIndicatorViewBuilder_0(id){
  checkArgument(id.indexOf("'") == -1);
  this.id_0 = id;
}

function ContinuationIndicatorViewBuilder(){
}

_ = ContinuationIndicatorViewBuilder_0.prototype = ContinuationIndicatorViewBuilder.prototype = new Object_0;
_.getClass$ = function getClass_981(){
  return Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_ContinuationIndicatorViewBuilder_2_classLit;
}
;
_.outputHtml = function outputHtml_12(output){
  $outputHtml_3(this, output);
}
;
_.castableTypeMap$ = {15:1, 16:1, 340:1};
_.enabled = true;
_.id_0 = null;
function TopConversationViewBuilder(){
}

_ = TopConversationViewBuilder.prototype = new Object_0;
_.getClass$ = function getClass_982(){
  return Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_TopConversationViewBuilder_2_classLit;
}
;
_.castableTypeMap$ = {15:1, 16:1};
function FixedConversationViewBuilder_0(id, rootThread, participants){
  this.id_0 = id;
  this.rootThread = rootThread;
  this.participants = participants;
}

function FixedConversationViewBuilder(){
}

_ = FixedConversationViewBuilder_0.prototype = FixedConversationViewBuilder.prototype = new TopConversationViewBuilder;
_.getClass$ = function getClass_983(){
  return Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_FixedConversationViewBuilder_2_classLit;
}
;
_.outputHtml = function outputHtml_13(out){
  open_1(out, this.id_0, 'C-BP-org-waveprotocol-wave-client-wavepanel-view-dom-full-TopConversationViewBuilder-Css-fixedSelf', ($clinit_1531() , dynamicCast($get_10(CODES, ($clinit_1453() , ROOT_CONVERSATION)), 1)));
  $outputHtml_4(this.participants, out);
  append(out, $getDomId_5(($clinit_1527() , TOOLBAR_CONTAINER), this.id_0));
  open_1(out, $getDomId_5(THREAD_CONTAINER, this.id_0), 'C-CP-org-waveprotocol-wave-client-wavepanel-view-dom-full-TopConversationViewBuilder-Css-fixedThread', null);
  this.rootThread.outputHtml(out);
  $append_11(out.sb, '<\/div>');
  $append_11(out.sb, '<\/div>');
}
;
_.castableTypeMap$ = {15:1, 16:1};
_.id_0 = null;
_.participants = null;
_.rootThread = null;
function InlineConversationViewBuilder_0(impl){
  this.impl = impl;
}

function InlineConversationViewBuilder(){
}

_ = InlineConversationViewBuilder_0.prototype = InlineConversationViewBuilder.prototype = new Object_0;
_.getClass$ = function getClass_985(){
  return Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_InlineConversationViewBuilder_2_classLit;
}
;
_.isCollapsed_0 = function isCollapsed_2(){
  return this.impl.collapsed;
}
;
_.outputHtml = function outputHtml_14(output){
  $outputHtml_2(this.impl, output);
}
;
_.castableTypeMap$ = {15:1, 16:1, 290:1};
_.impl = null;
function InlineThreadViewBuilder_0(id, impl){
  this.id_0 = id;
  this.impl = impl;
}

function InlineThreadViewBuilder(){
}

_ = InlineThreadViewBuilder_0.prototype = InlineThreadViewBuilder.prototype = new Object_0;
_.getClass$ = function getClass_986(){
  return Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_InlineThreadViewBuilder_2_classLit;
}
;
_.isCollapsed_0 = function isCollapsed_3(){
  return this.impl.collapsed;
}
;
_.outputHtml = function outputHtml_15(output){
  $outputHtml_2(this.impl, output);
}
;
_.setCollapsed = function setCollapsed_0(collapsed){
  this.impl.collapsed = collapsed;
}
;
_.setTotalBlipCount = function setTotalBlipCount_1(totalBlipCount){
  this.impl.totalBlipCount = totalBlipCount;
}
;
_.setUnreadBlipCount = function setUnreadBlipCount_1(unreadBlipCount){
  this.impl.unreadBlipCount = unreadBlipCount;
}
;
_.castableTypeMap$ = {15:1, 16:1, 274:1, 344:1};
_.id_0 = null;
_.impl = null;
function InlineThreadViewBuilder$InlineThreadStructure_0(blips, continnuationIndicator){
  this.blips = blips;
  this.continuationIndicator = continnuationIndicator;
}

function InlineThreadViewBuilder$InlineThreadStructure(){
}

_ = InlineThreadViewBuilder$InlineThreadStructure_0.prototype = InlineThreadViewBuilder$InlineThreadStructure.prototype = new Object_0;
_.getClass$ = function getClass_987(){
  return Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_InlineThreadViewBuilder$InlineThreadStructure_2_classLit;
}
;
_.outputHtml = function outputHtml_16(output){
  $append_11(output.sb, '<div>');
  $outputHtml_0(this.blips, output);
  $append_11(output.sb, '<\/div>');
  $outputHtml_3(this.continuationIndicator, output);
}
;
_.castableTypeMap$ = {15:1};
_.blips = null;
_.continuationIndicator = null;
function ParticipantNameViewBuilder_0(id){
  this.id_0 = id;
}

function ParticipantNameViewBuilder(){
}

_ = ParticipantNameViewBuilder_0.prototype = ParticipantNameViewBuilder.prototype = new Object_0;
_.getClass$ = function getClass_988(){
  return Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_ParticipantNameViewBuilder_2_classLit;
}
;
_.outputHtml = function outputHtml_17(output){
  open_1(output, this.id_0, 'C-LO-org-waveprotocol-wave-client-wavepanel-view-dom-full-ParticipantsViewBuilder-Css-participant', ($clinit_1531() , dynamicCast($get_10(CODES, ($clinit_1453() , PARTICIPANT)), 1)));
  $appendEscaped(output, this.name_0);
  $append_11(output.sb, '<\/div>');
}
;
_.castableTypeMap$ = {15:1, 16:1, 336:1};
_.id_0 = null;
_.name_0 = null;
function $outputHtml_4(this$static, output){
  open_1(output, this$static.id_0, 'C-KO-org-waveprotocol-wave-client-wavepanel-view-dom-full-ParticipantsViewBuilder-Css-panel', ($clinit_1531() , dynamicCast($get_10(CODES, ($clinit_1453() , PARTICIPANTS)), 1)));
  $append_11(output.sb, "<div class='C-JO-org-waveprotocol-wave-client-wavepanel-view-dom-full-ParticipantsViewBuilder-Css-flow'>");
  open_1(output, $getDomId_2(($clinit_1518() , CONTAINER), this$static.id_0), null, null);
  $outputHtml(this$static.participantUis, output);
  $append_11(output.sb, "<span class='C-IO-org-waveprotocol-wave-client-wavepanel-view-dom-full-ParticipantsViewBuilder-Css-extra'>");
  openSpanWith(output, null, 'C-NO-org-waveprotocol-wave-client-wavepanel-view-dom-full-ParticipantsViewBuilder-Css-toggleGroup', null, 'onclick="var p=document.getElementById(\'' + this$static.id_0 + "');var x=p.getAttribute('s')=='e';var l=this.lastChild;p.style.height=x?'':'auto';p.setAttribute('s',x?'':'e');lastChild.innerHTML=x?'more':'less';firstChild.className=x?'C-HO-org-waveprotocol-wave-client-wavepanel-view-dom-full-ParticipantsViewBuilder-Css-expandButton':'C-GO-org-waveprotocol-wave-client-wavepanel-view-dom-full-ParticipantsViewBuilder-Css-collapseButton';parentNode.nextSibling.style.display=x?'':'none';\"");
  $append_11(output.sb, "<span class='C-HO-org-waveprotocol-wave-client-wavepanel-view-dom-full-ParticipantsViewBuilder-Css-expandButton'>");
  $append_11(output.sb, '<\/span>');
  $append_11(output.sb, '<span>');
  $append_11(output.sb, 'more');
  $append_11(output.sb, '<\/span>');
  $append_11(output.sb, '<\/span>');
  appendSpan(output, null, 'C-FO-org-waveprotocol-wave-client-wavepanel-view-dom-full-ParticipantsViewBuilder-Css-addButton', dynamicCast($get_10(CODES, ADD_PARTICIPANT), 1));
  $append_11(output.sb, '<\/span>');
  $append_11(output.sb, "<span class='C-MO-org-waveprotocol-wave-client-wavepanel-view-dom-full-ParticipantsViewBuilder-Css-simple'>");
  appendSpan(output, null, 'C-FO-org-waveprotocol-wave-client-wavepanel-view-dom-full-ParticipantsViewBuilder-Css-addButton', dynamicCast($get_10(CODES, ADD_PARTICIPANT), 1));
  $append_11(output.sb, '<\/span>');
  $append_11(output.sb, '<\/div>');
  $append_11(output.sb, '<\/div>');
  $append_11(output.sb, '<\/div>');
}

function ParticipantsViewBuilder_0(id, participantUis){
  this.id_0 = id;
  this.participantUis = participantUis;
}

function ParticipantsViewBuilder(){
}

_ = ParticipantsViewBuilder_0.prototype = ParticipantsViewBuilder.prototype = new Object_0;
_.getClass$ = function getClass_989(){
  return Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_ParticipantsViewBuilder_2_classLit;
}
;
_.outputHtml = function outputHtml_18(output){
  $outputHtml_4(this, output);
}
;
_.castableTypeMap$ = {15:1, 16:1};
_.id_0 = null;
_.participantUis = null;
function $clinit_1518(){
  $clinit_1518 = nullMethod;
  CONTAINER = new ParticipantsViewBuilder$Components_0('CONTAINER', 0, 'C');
  ADD = new ParticipantsViewBuilder$Components_0('ADD', 1, 'A');
  $VALUES_48 = initValues(_3Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_ParticipantsViewBuilder$Components_2_classLit, {9:1, 68:1, 170:1}, 127, [CONTAINER, ADD]);
}

function $getDomId_2(this$static, baseId){
  return baseId + this$static.postfix;
}

function ParticipantsViewBuilder$Components_0(enum$name, enum$ordinal, postfix){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
  this.postfix = postfix;
}

function valueOf_55(name_0){
  $clinit_1518();
  return valueOf_0(($clinit_1519() , $MAP_48), name_0);
}

function values_49(){
  $clinit_1518();
  return $VALUES_48;
}

function ParticipantsViewBuilder$Components(){
}

_ = ParticipantsViewBuilder$Components_0.prototype = ParticipantsViewBuilder$Components.prototype = new Enum;
_.getClass$ = function getClass_990(){
  return Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_ParticipantsViewBuilder$Components_2_classLit;
}
;
_.getDomId = function getDomId_2(baseId){
  return baseId + this.postfix;
}
;
_.castableTypeMap$ = {9:1, 10:1, 14:1, 65:1, 127:1};
_.postfix = null;
var $VALUES_48, ADD, CONTAINER;
function $clinit_1519(){
  $clinit_1519 = nullMethod;
  $MAP_48 = createValueOfMap(($clinit_1518() , $VALUES_48));
}

var $MAP_48;
function $outputHtml_5(this$static, output){
  openWith(output, this$static.id_0, 'C-PO-org-waveprotocol-wave-client-wavepanel-view-dom-full-ReplyBoxViewBuilder-Css-replyBox', ($clinit_1531() , dynamicCast($get_10(CODES, ($clinit_1453() , REPLY_BOX)), 1)), this$static.enabled?'':"style='display:none'");
  image_0(output, $getDomId_3(($clinit_1522() , AVATAR_0), this$static.id_0), 'C-OO-org-waveprotocol-wave-client-wavepanel-view-dom-full-ReplyBoxViewBuilder-Css-avatar', ($clinit_592() , new SafeHtmlString_0($replaceAll($replaceAll($replaceAll($replaceAll($replaceAll(this$static.avatarUrl, '&', '&amp;'), '"', '&quot;'), "'", '&#39;'), '<', '&lt;'), '>', '&gt;'))), new SafeHtmlString_0('author'));
  $append_11(output.sb, 'Click here to reply');
  $append_11(output.sb, '<\/div>');
}

function ReplyBoxViewBuilder_0(id){
  checkArgument(id.indexOf("'") == -1);
  this.id_0 = id;
  this.avatarUrl = 'static/images/unknown.jpg';
}

function ReplyBoxViewBuilder(){
}

_ = ReplyBoxViewBuilder_0.prototype = ReplyBoxViewBuilder.prototype = new Object_0;
_.getClass$ = function getClass_991(){
  return Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_ReplyBoxViewBuilder_2_classLit;
}
;
_.outputHtml = function outputHtml_19(output){
  $outputHtml_5(this, output);
}
;
_.castableTypeMap$ = {15:1, 16:1, 343:1};
_.avatarUrl = null;
_.enabled = true;
_.id_0 = null;
function $clinit_1522(){
  $clinit_1522 = nullMethod;
  AVATAR_0 = new ReplyBoxViewBuilder$Components_0;
  $VALUES_49 = initValues(_3Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_ReplyBoxViewBuilder$Components_2_classLit, {9:1, 68:1, 170:1}, 128, [AVATAR_0]);
}

function $getDomId_3(this$static, baseId){
  return baseId + this$static.postfix;
}

function ReplyBoxViewBuilder$Components_0(){
  this.name_1 = 'AVATAR';
  this.ordinal = 0;
  this.postfix = 'A';
}

function valueOf_56(name_0){
  $clinit_1522();
  return valueOf_0(($clinit_1523() , $MAP_49), name_0);
}

function values_50(){
  $clinit_1522();
  return $VALUES_49;
}

function ReplyBoxViewBuilder$Components(){
}

_ = ReplyBoxViewBuilder$Components_0.prototype = ReplyBoxViewBuilder$Components.prototype = new Enum;
_.getClass$ = function getClass_992(){
  return Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_ReplyBoxViewBuilder$Components_2_classLit;
}
;
_.getDomId = function getDomId_3(baseId){
  return baseId + this.postfix;
}
;
_.castableTypeMap$ = {9:1, 10:1, 14:1, 65:1, 128:1};
_.postfix = null;
var $VALUES_49, AVATAR_0;
function $clinit_1523(){
  $clinit_1523 = nullMethod;
  $MAP_49 = createValueOfMap(($clinit_1522() , $VALUES_49));
}

var $MAP_49;
function RootThreadViewBuilder_0(id, blips, replyBox){
  this.id_0 = id;
  this.blips = blips;
  this.replyBox = replyBox;
}

function RootThreadViewBuilder(){
}

_ = RootThreadViewBuilder_0.prototype = RootThreadViewBuilder.prototype = new Object_0;
_.getClass$ = function getClass_993(){
  return Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_RootThreadViewBuilder_2_classLit;
}
;
_.outputHtml = function outputHtml_20(output){
  var extra;
  extra = " t='" + this.totalBlipCount + "' u='" + this.unreadBlipCount + "'";
  openWith(output, this.id_0, 'C-AP-org-waveprotocol-wave-client-wavepanel-view-dom-full-RootThreadViewBuilder-Css-thread', ($clinit_1531() , dynamicCast($get_10(CODES, ($clinit_1453() , ROOT_THREAD)), 1)), extra);
  open_1(output, $getDomId_4(($clinit_1525() , BLIPS), this.id_0), null, null);
  $outputHtml_0(this.blips, output);
  $append_11(output.sb, '<\/div>');
  $outputHtml_5(this.replyBox, output);
  $append_11(output.sb, '<\/div>');
}
;
_.setTotalBlipCount = function setTotalBlipCount_2(totalBlipCount){
  this.totalBlipCount = totalBlipCount;
}
;
_.setUnreadBlipCount = function setUnreadBlipCount_2(unreadBlipCount){
  this.unreadBlipCount = unreadBlipCount;
}
;
_.castableTypeMap$ = {15:1, 16:1, 344:1};
_.blips = null;
_.id_0 = null;
_.replyBox = null;
_.totalBlipCount = 0;
_.unreadBlipCount = 0;
function $remove_37(this$static){
  $remove_36(dynamicCast(dynamicCast(this$static.helper, 287), 288), dynamicCast(this$static.impl, 289));
}

function $insertInlineAnchorBefore_1(this$static, ref, x){
  $insertInlineAnchorBefore_0((dynamicCast(this$static.helper, 286) , this$static.impl), ref, x);
}

function $setRead(this$static, read){
  dynamicCast(this$static.impl, 339).setRead(read);
}

function $setTime(this$static, time){
  dynamicCast(this$static.impl, 339).setTime(time);
}

_ = BlipMetaViewImpl.prototype;
_.setAvatar = function setAvatar_1(imageUrl){
  dynamicCast(this.impl, 339).setAvatar(imageUrl);
}
;
_.setMetaline = function setMetaline_1(metaline){
  dynamicCast(this.impl, 339).setMetaline(metaline);
}
;
_.setRead = function setRead_1(read){
  dynamicCast(this.impl, 339).setRead(read);
}
;
_.setTime = function setTime_1(time){
  dynamicCast(this.impl, 339).setTime(time);
}
;
function $insertConversationBefore_1(this$static, c){
  return $insertConversationBefore_0(dynamicCast(this$static.helper, 276), this$static.impl, c);
}

_ = BlipViewImpl.prototype;
_.getId = function getId_16(){
  return dynamicCast(this.impl, 334).getId();
}
;
_ = InlineThreadViewImpl.prototype;
_.setTotalBlipCount = function setTotalBlipCount_3(totalBlipCount){
  dynamicCast(this.impl, 274).setTotalBlipCount(totalBlipCount);
}
;
_.setUnreadBlipCount = function setUnreadBlipCount_3(unreadBlipCount){
  dynamicCast(this.impl, 274).setUnreadBlipCount(unreadBlipCount);
}
;
function $appendParticipant(this$static, conv, participant){
  return $append_17(dynamicCast(this$static.helper, 342), this$static.impl, conv, participant);
}

_ = RootThreadViewImpl.prototype;
_.setTotalBlipCount = function setTotalBlipCount_4(totalBlipCount){
  dynamicCast(this.impl, 344).setTotalBlipCount(totalBlipCount);
}
;
_.setUnreadBlipCount = function setUnreadBlipCount_4(unreadBlipCount){
  dynamicCast(this.impl, 344).setUnreadBlipCount(unreadBlipCount);
}
;
function Button_3(){
}

_ = Button_3.prototype = new Label;
_.getClass$ = function getClass_1012(){
  return Lorg_waveprotocol_wave_client_widget_common_Button_2_classLit;
}
;
_.onBrowserEvent = function onBrowserEvent_7(event_0){
  switch ($eventGetTypeInt(event_0.type)) {
    case 4:
      $replaceClassName(this.me, 'up', 'down');
      break;
    case 8:
      $replaceClassName(this.me, 'down', 'up');
      break;
    case 16:
      $replaceClassName(this.me, 'cat', 'mouse');
      break;
    case 32:
      $replaceClassName(this.me, 'mouse', 'cat');
  }
  $onBrowserEvent(this, event_0);
}
;
_.castableTypeMap$ = {5:1, 6:1, 7:1, 8:1, 55:1, 59:1};
_.me = null;
function $setState(this$static, on){
  on?$replaceClassName(this$static.me, 'off', 'on'):$replaceClassName(this$static.me, 'on', 'off');
  this$static.me.title = (on?this$static.onTitle:this$static.offTitle) || '';
  this$static.on = on;
}

function ButtonSwitch_0(listener){
  Label_0.call(this);
  this.me = this.element;
  this.element['className'] = 'button';
  setStyleName_0(this.element, 'C-GI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-metaButton C-LI-org-waveprotocol-wave-client-gadget-renderer-GadgetWidgetUi-Css-more', true);
  setStyleName_0(this.element, 'up', true);
  setStyleName_0(this.element, 'cat', true);
  $replaceClassName(this.me, 'disabled', 'enabled');
  this.element.setAttribute('title', 'Hide menu');
  $addDomHandler(this, this, ($clinit_116() , $clinit_116() , TYPE_1));
  this.listener = listener;
  this.onTitle = 'Hide menu';
  this.offTitle = 'Gadget menu';
  $setState(this, true);
}

function ButtonSwitch(){
}

_ = ButtonSwitch_0.prototype = ButtonSwitch.prototype = new Button_3;
_.getClass$ = function getClass_1013(){
  return Lorg_waveprotocol_wave_client_widget_common_ButtonSwitch_2_classLit;
}
;
_.onClick = function onClick_11(e){
  $setState(this, !this.on);
  this.on?$show_0(this.listener.menu.popup):$hide(this.listener.menu.popup);
  e.nativeEvent.stopPropagation();
}
;
_.castableTypeMap$ = {5:1, 6:1, 7:1, 8:1, 24:1, 38:1, 55:1, 59:1};
_.listener = null;
_.offTitle = null;
_.on = false;
_.onTitle = null;
function $add_26(this$static, w){
  $add_0(this$static, w, this$static.element);
}

function ElementPanel_0(elem){
  this.children_0 = new WidgetCollection_0(this);
  this.element = elem;
}

function ElementPanel(){
}

_ = ElementPanel.prototype = new ComplexPanel;
_.getClass$ = function getClass_1014(){
  return Lorg_waveprotocol_wave_client_widget_generic_ElementPanel_2_classLit;
}
;
_.castableTypeMap$ = {5:1, 6:1, 7:1, 8:1, 55:1, 59:1, 61:1};
function ClickableDivPanel_0(){
  ElementPanel_0.call(this, $doc.createElement('div'));
}

function ClickableDivPanel(){
}

_ = ClickableDivPanel_0.prototype = ClickableDivPanel.prototype = new ElementPanel;
_.getClass$ = function getClass_1015(){
  return Lorg_waveprotocol_wave_client_widget_common_ClickableDivPanel_2_classLit;
}
;
_.castableTypeMap$ = {5:1, 6:1, 7:1, 8:1, 55:1, 59:1, 61:1};
function $clinit_1568(){
  $clinit_1568 = nullMethod;
  HOVER_HELPER = new HoverHelper_0;
}

function $enter(this$static, hoverable){
  if (this$static.last != hoverable) {
    !!this$static.last && $onMouseLeave(this$static.last);
    this$static.last = hoverable;
    $onMouseEnter(this$static.last);
  }
}

function $exit(this$static, hoverable){
  if (this$static.last != hoverable) {
    return;
  }
  $onMouseLeave(this$static.last);
  this$static.last = null;
}

function $setup(this$static, hoverable){
  $addHandlers(hoverable, new HoverHelper$1_0(this$static, hoverable), new HoverHelper$2_0(this$static, hoverable));
}

function HoverHelper_0(){
}

function HoverHelper(){
}

_ = HoverHelper_0.prototype = HoverHelper.prototype = new Object_0;
_.getClass$ = function getClass_1016(){
  return Lorg_waveprotocol_wave_client_widget_common_HoverHelper_2_classLit;
}
;
_.castableTypeMap$ = {};
_.last = null;
var HOVER_HELPER;
function HoverHelper$1_0(this$0, val$hoverable){
  this.this$0 = this$0;
  this.val$hoverable = val$hoverable;
}

function HoverHelper$1(){
}

_ = HoverHelper$1_0.prototype = HoverHelper$1.prototype = new Object_0;
_.getClass$ = function getClass_1017(){
  return Lorg_waveprotocol_wave_client_widget_common_HoverHelper$1_2_classLit;
}
;
_.onMouseOver = function onMouseOver_0(event_0){
  $enter(this.this$0, this.val$hoverable);
  event_0.nativeEvent.stopPropagation();
}
;
_.castableTypeMap$ = {32:1, 38:1};
_.this$0 = null;
_.val$hoverable = null;
function HoverHelper$2_0(this$0, val$hoverable){
  this.this$0 = this$0;
  this.val$hoverable = val$hoverable;
}

function HoverHelper$2(){
}

_ = HoverHelper$2_0.prototype = HoverHelper$2.prototype = new Object_0;
_.getClass$ = function getClass_1018(){
  return Lorg_waveprotocol_wave_client_widget_common_HoverHelper$2_2_classLit;
}
;
_.onMouseOut = function onMouseOut_0(event_0){
  var to;
  to = event_0.nativeEvent.relatedTarget;
  !!to && $isOrHasChild(this.val$hoverable.enclosingBox.element, to) || $exit(this.this$0, this.val$hoverable);
  event_0.nativeEvent.stopPropagation();
}
;
_.castableTypeMap$ = {31:1, 38:1};
_.this$0 = null;
_.val$hoverable = null;
function $clinit_1574(){
  $clinit_1574 = nullMethod;
  new MenuButton$1_0;
}

function MenuButton_0(){
  $clinit_1574();
  MenuButton_2.call(this, null);
}

function MenuButton_2(userPositioner){
  this.button_0 = new ButtonSwitch_0(this);
  setStyleName_0(this.button_0.element, 'menu', true);
  $setState(this.button_0, false);
  !userPositioner && (userPositioner = ($clinit_1587() , BELOW_RIGHT));
  this.menu = new PopupMenu_1(this.button_0.element, userPositioner);
  $associateWidget_1(this.menu.popup, this.button_0);
  $add_31(this.menu.popup.listeners, new MenuButton$2_0(this));
}

function MenuButton(){
}

_ = MenuButton_0.prototype = MenuButton.prototype = new Object_0;
_.getClass$ = function getClass_1020(){
  return Lorg_waveprotocol_wave_client_widget_menu_MenuButton_2_classLit;
}
;
_.castableTypeMap$ = {};
_.button_0 = null;
_.menu = null;
function MenuButton$1_0(){
  $clinit_2309();
  defaultCollectionFactory.createStringMap();
}

function MenuButton$1(){
}

_ = MenuButton$1_0.prototype = MenuButton$1.prototype = new Object_0;
_.getClass$ = function getClass_1021(){
  return Lorg_waveprotocol_wave_client_widget_menu_MenuButton$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function MenuButton$2_0(this$0){
  this.this$0 = this$0;
}

function MenuButton$2(){
}

_ = MenuButton$2_0.prototype = MenuButton$2.prototype = new Object_0;
_.getClass$ = function getClass_1022(){
  return Lorg_waveprotocol_wave_client_widget_menu_MenuButton$2_2_classLit;
}
;
_.onHide = function onHide_3(source){
  $setState(this.this$0.button_0, false);
}
;
_.onShow = function onShow_3(source){
  $setState(this.this$0.button_0, true);
}
;
_.castableTypeMap$ = {349:1};
_.this$0 = null;
function $clinit_1579(){
  $clinit_1579 = nullMethod;
  PREVENT_DEFAULT_HANDLER = new PopupMenu$1_0;
  $clinit_103();
  $push_1(toInject, ($clinit_211() , '.C-ES-org-waveprotocol-wave-client-widget-menu-PopupMenu-Resources-Css-item {\n  margin : 0 1px;\n  padding : 3px 7px 3px 12px;\n  color : #003ea8;\n  cursor : pointer;\n  cursor : hand;\n  background-color : white;\n}\n.C-ES-org-waveprotocol-wave-client-widget-menu-PopupMenu-Resources-Css-item:hover {\n  background-color : #4086ff;\n  color : white;\n}\n.C-ES-org-waveprotocol-wave-client-widget-menu-PopupMenu-Resources-Css-item.C-CS-org-waveprotocol-wave-client-widget-menu-PopupMenu-Resources-Css-disabled {\n  cursor : default;\n  opacity : 0.35;\n}\n.C-ES-org-waveprotocol-wave-client-widget-menu-PopupMenu-Resources-Css-item.C-CS-org-waveprotocol-wave-client-widget-menu-PopupMenu-Resources-Css-disabled:hover {\n  color : #003ea8;\n  background-color : white;\n}\n.verticalSeparator {\n  display : inline;\n}\n.C-DS-org-waveprotocol-wave-client-widget-menu-PopupMenu-Resources-Css-divider {\n  margin : 3px 1px;\n  border-bottom : 1px solid #e3e8f2;\n  cursor : auto;\n  background-color : white;\n}\n'));
  schedule();
}

function $addItem_1(this$static, label, cmd){
  var item;
  item = new PopupMenu$PopupMenuItem_0(this$static, label, cmd);
  $add_2(this$static.popup, item);
  return item;
}

function PopupMenu_1(relative, positioner){
  $clinit_1579();
  this.popup = createPopup_1(relative, positioner, (!provider_0 && (provider_0 = new DesktopPopupChromeProvider_0) , new DesktopPopupChrome_0));
  this.isPreClicked = false;
}

function PopupMenu(){
}

_ = PopupMenu_1.prototype = PopupMenu.prototype = new Object_0;
_.getClass$ = function getClass_1023(){
  return Lorg_waveprotocol_wave_client_widget_menu_PopupMenu_2_classLit;
}
;
_.castableTypeMap$ = {};
_.isPreClicked = false;
_.popup = null;
var PREVENT_DEFAULT_HANDLER;
function PopupMenu$1_0(){
}

function PopupMenu$1(){
}

_ = PopupMenu$1_0.prototype = PopupMenu$1.prototype = new Object_0;
_.getClass$ = function getClass_1024(){
  return Lorg_waveprotocol_wave_client_widget_menu_PopupMenu$1_2_classLit;
}
;
_.onMouseDown = function onMouseDown_3(event_0){
  event_0.nativeEvent.preventDefault();
}
;
_.castableTypeMap$ = {30:1, 38:1};
function $onClicked_0(this$static){
  if (this$static.enabled) {
    !!this$static.command && this$static.command.execute_0();
    this$static.hide && $hide(this$static.this$0.popup);
  }
}

function PopupMenu$PopupMenuItem_0(this$0, text, cmd){
  this.this$0 = this$0;
  Label_0.call(this);
  $setTextOrHtml(this.directionalTextHelper, text, false);
  this.element['className'] = ($clinit_1579() , 'C-ES-org-waveprotocol-wave-client-widget-menu-PopupMenu-Resources-Css-item');
  setStyleName_0(this.element, 'C-CS-org-waveprotocol-wave-client-widget-menu-PopupMenu-Resources-Css-disabled', false);
  this.enabled = true;
  this.command = cmd;
  this.hide = true;
  this$0.isPreClicked?$addDomHandler(this, new PopupMenu$PopupMenuItem$1_0(this), ($clinit_157() , $clinit_157() , TYPE_9)):$addDomHandler(this, new PopupMenu$PopupMenuItem$2_0(this), ($clinit_116() , $clinit_116() , TYPE_1));
  $addDomHandler(this, PREVENT_DEFAULT_HANDLER, ($clinit_151() , $clinit_151() , TYPE_6));
}

function PopupMenu$PopupMenuItem(){
}

_ = PopupMenu$PopupMenuItem_0.prototype = PopupMenu$PopupMenuItem.prototype = new Label;
_.getClass$ = function getClass_1025(){
  return Lorg_waveprotocol_wave_client_widget_menu_PopupMenu$PopupMenuItem_2_classLit;
}
;
_.castableTypeMap$ = {5:1, 6:1, 7:1, 8:1, 55:1, 59:1};
_.command = null;
_.enabled = false;
_.hide = false;
_.this$0 = null;
function PopupMenu$PopupMenuItem$1_0(this$1){
  this.this$1 = this$1;
}

function PopupMenu$PopupMenuItem$1(){
}

_ = PopupMenu$PopupMenuItem$1_0.prototype = PopupMenu$PopupMenuItem$1.prototype = new Object_0;
_.getClass$ = function getClass_1026(){
  return Lorg_waveprotocol_wave_client_widget_menu_PopupMenu$PopupMenuItem$1_2_classLit;
}
;
_.castableTypeMap$ = {33:1, 34:1, 38:1};
_.this$1 = null;
function PopupMenu$PopupMenuItem$2_0(this$1){
  this.this$1 = this$1;
}

function PopupMenu$PopupMenuItem$2(){
}

_ = PopupMenu$PopupMenuItem$2_0.prototype = PopupMenu$PopupMenuItem$2.prototype = new Object_0;
_.getClass$ = function getClass_1027(){
  return Lorg_waveprotocol_wave_client_widget_menu_PopupMenu$PopupMenuItem$2_2_classLit;
}
;
_.onClick = function onClick_12(e){
  $onClicked_0(this.this$1);
}
;
_.castableTypeMap$ = {24:1, 38:1};
_.this$1 = null;
function $clinit_1587(){
  $clinit_1587 = nullMethod;
  new AlignedPopupPositioner_0(($clinit_1592() , NONE_2), ($clinit_1588() , LEFT_3), RIGHT_3, ($clinit_1593() , TOP), BOTTOM);
  new AlignedPopupPositioner_0(NONE_2, LEFT_3, RIGHT_3, BOTTOM, TOP);
  BELOW_RIGHT = new AlignedPopupPositioner_0(NONE_2, RIGHT_3, LEFT_3, BOTTOM, TOP);
  ABOVE_RIGHT = new AlignedPopupPositioner_0(NONE_2, RIGHT_3, LEFT_3, TOP, BOTTOM);
}

function AlignedPopupPositioner_0(insets, primaryHorz, secondaryHorz, primaryVert, secondaryVert){
  this.insets = insets;
  this.primaryHorz = primaryHorz;
  this.secondaryHorz = secondaryHorz;
  this.primaryVert = primaryVert;
  this.secondaryVert = secondaryVert;
}

function AlignedPopupPositioner(){
}

_ = AlignedPopupPositioner_0.prototype = AlignedPopupPositioner.prototype = new Object_0;
_.getClass$ = function getClass_1030(){
  return Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner_2_classLit;
}
;
_.setPopupPositionAndMakeVisible = function setPopupPositionAndMakeVisible_1(relative, popup){
  var bodyBottom, bodyLeft, bodyRight, bodyTop, bottom, left, popupHeight, popupWidth, relBottom, relLeft, relRight, relTop, right, secondaryBottom, secondaryLeft, secondaryRight, secondaryTop, top_0;
  bodyLeft = $getAbsoluteLeft(($clinit_386() , get_0()).element);
  bodyRight = $getAbsoluteRight(get_0().element);
  bodyTop = $getAbsoluteTop(get_0().element);
  bodyBottom = $getAbsoluteBottom(get_0().element);
  relLeft = $getAbsoluteLeft(relative) - bodyLeft + this.insets.left_0;
  relRight = $getAbsoluteLeft(relative) + (relative.offsetWidth || 0) - bodyLeft - this.insets.right;
  relTop = $getAbsoluteTop(relative) - bodyTop + this.insets.top_0;
  relBottom = $getAbsoluteTop(relative) + (relative.offsetHeight || 0) - bodyTop - this.insets.bottom;
  popupWidth = popup.offsetWidth || 0;
  popupHeight = popup.offsetHeight || 0;
  left = this.primaryHorz.getLeft(relLeft, relRight, popupWidth);
  right = left + popupWidth + 1;
  if (left < bodyLeft || right > bodyRight) {
    secondaryLeft = this.secondaryHorz.getLeft(relLeft, relRight, popupWidth);
    secondaryRight = secondaryLeft + popupWidth + 1;
    secondaryLeft < bodyLeft || secondaryRight > bodyRight?(left = min_1(left > 0?left:0, $getClientWidth($doc) - (right - left) - 16)):(left = secondaryLeft);
  }
  top_0 = this.primaryVert.getTop(relTop, relBottom, popupHeight);
  bottom = top_0 + popupHeight + 3;
  if (top_0 < bodyTop || bottom > bodyBottom) {
    secondaryTop = this.secondaryVert.getTop(relTop, relBottom, popupHeight);
    secondaryBottom = secondaryTop + popupHeight + 3;
    secondaryTop < bodyTop || secondaryBottom > bodyBottom?(top_0 = min_1(top_0 > 0?top_0:0, $getClientHeight($doc) - (bottom - top_0) - 16)):(top_0 = secondaryTop);
  }
  popup.style['left'] = left + ($clinit_88() , 'px');
  popup.style['top'] = top_0 + 'px';
  popup.style['visibility'] = ($clinit_99() , 'visible');
}
;
_.castableTypeMap$ = {};
_.insets = null;
_.primaryHorz = null;
_.primaryVert = null;
_.secondaryHorz = null;
_.secondaryVert = null;
var ABOVE_RIGHT, BELOW_RIGHT;
function $clinit_1588(){
  $clinit_1588 = nullMethod;
  LEFT_3 = new AlignedPopupPositioner$Horizontal$1_0;
  RIGHT_3 = new AlignedPopupPositioner$Horizontal$2_0;
  $VALUES_52 = initValues(_3Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Horizontal_2_classLit, {9:1, 68:1, 170:1}, 131, [LEFT_3, RIGHT_3]);
}

function valueOf_59(name_0){
  $clinit_1588();
  return valueOf_0(($clinit_1591() , $MAP_52), name_0);
}

function values_53(){
  $clinit_1588();
  return $VALUES_52;
}

function AlignedPopupPositioner$Horizontal(){
}

_ = AlignedPopupPositioner$Horizontal.prototype = new Enum;
_.getClass$ = function getClass_1031(){
  return Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Horizontal_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 131:1};
var $VALUES_52, LEFT_3, RIGHT_3;
function AlignedPopupPositioner$Horizontal$1_0(){
  this.name_1 = 'LEFT';
  this.ordinal = 0;
}

function AlignedPopupPositioner$Horizontal$1(){
}

_ = AlignedPopupPositioner$Horizontal$1_0.prototype = AlignedPopupPositioner$Horizontal$1.prototype = new AlignedPopupPositioner$Horizontal;
_.getClass$ = function getClass_1032(){
  return Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Horizontal$1_2_classLit;
}
;
_.getLeft = function getLeft(relLeft, relRight, popupWidth){
  return relLeft + 1;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 131:1};
function AlignedPopupPositioner$Horizontal$2_0(){
  this.name_1 = 'RIGHT';
  this.ordinal = 1;
}

function AlignedPopupPositioner$Horizontal$2(){
}

_ = AlignedPopupPositioner$Horizontal$2_0.prototype = AlignedPopupPositioner$Horizontal$2.prototype = new AlignedPopupPositioner$Horizontal;
_.getClass$ = function getClass_1033(){
  return Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Horizontal$2_2_classLit;
}
;
_.getLeft = function getLeft_0(relLeft, relRight, popupWidth){
  return relRight - popupWidth - 1;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 131:1};
function $clinit_1591(){
  $clinit_1591 = nullMethod;
  $MAP_52 = createValueOfMap(($clinit_1588() , $VALUES_52));
}

var $MAP_52;
function $clinit_1592(){
  $clinit_1592 = nullMethod;
  NONE_2 = new AlignedPopupPositioner$Insets_0;
}

function AlignedPopupPositioner$Insets_0(){
  this.top_0 = 0;
  this.right = 0;
  this.bottom = 0;
  this.left_0 = 0;
}

function AlignedPopupPositioner$Insets(){
}

_ = AlignedPopupPositioner$Insets_0.prototype = AlignedPopupPositioner$Insets.prototype = new Object_0;
_.getClass$ = function getClass_1034(){
  return Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Insets_2_classLit;
}
;
_.castableTypeMap$ = {};
_.bottom = 0;
_.left_0 = 0;
_.right = 0;
_.top_0 = 0;
var NONE_2;
function $clinit_1593(){
  $clinit_1593 = nullMethod;
  BOTTOM = new AlignedPopupPositioner$Vertical$1_0;
  TOP = new AlignedPopupPositioner$Vertical$2_0;
  $VALUES_53 = initValues(_3Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Vertical_2_classLit, {9:1, 68:1, 170:1}, 132, [BOTTOM, TOP]);
}

function valueOf_60(name_0){
  $clinit_1593();
  return valueOf_0(($clinit_1596() , $MAP_53), name_0);
}

function values_54(){
  $clinit_1593();
  return $VALUES_53;
}

function AlignedPopupPositioner$Vertical(){
}

_ = AlignedPopupPositioner$Vertical.prototype = new Enum;
_.getClass$ = function getClass_1035(){
  return Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Vertical_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 132:1};
var $VALUES_53, BOTTOM, TOP;
function AlignedPopupPositioner$Vertical$1_0(){
  this.name_1 = 'BOTTOM';
  this.ordinal = 0;
}

function AlignedPopupPositioner$Vertical$1(){
}

_ = AlignedPopupPositioner$Vertical$1_0.prototype = AlignedPopupPositioner$Vertical$1.prototype = new AlignedPopupPositioner$Vertical;
_.getClass$ = function getClass_1036(){
  return Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Vertical$1_2_classLit;
}
;
_.getTop = function getTop(relTop, relBottom, popupHeight){
  return relBottom + 3 + 5;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 132:1};
function AlignedPopupPositioner$Vertical$2_0(){
  this.name_1 = 'TOP';
  this.ordinal = 1;
}

function AlignedPopupPositioner$Vertical$2(){
}

_ = AlignedPopupPositioner$Vertical$2_0.prototype = AlignedPopupPositioner$Vertical$2.prototype = new AlignedPopupPositioner$Vertical;
_.getClass$ = function getClass_1037(){
  return Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Vertical$2_2_classLit;
}
;
_.getTop = function getTop_0(relTop, relBottom, popupHeight){
  return relTop - popupHeight - 3 - 5;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 132:1};
function $clinit_1596(){
  $clinit_1596 = nullMethod;
  $MAP_53 = createValueOfMap(($clinit_1593() , $VALUES_53));
}

var $MAP_53;
function DesktopPopupProvider_0(){
}

function DesktopPopupProvider(){
}

_ = DesktopPopupProvider_0.prototype = DesktopPopupProvider.prototype = new Object_0;
_.getClass$ = function getClass_1040(){
  return Lorg_waveprotocol_wave_client_widget_popup_DesktopPopupProvider_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_1601(){
  $clinit_1601 = nullMethod;
  $clinit_103();
  $push_1(toInject, ($clinit_211() , '.C-LS-org-waveprotocol-wave-client-widget-popup-DesktopUniversalPopup-Resources-Css-popup {\n  position : absolute;\n  z-index : 1000;\n  background-color : white;\n}\n/* CssEval */\n.C-IS-org-waveprotocol-wave-client-widget-popup-DesktopUniversalPopup-Resources-Css-fadeIn {\n  -webkit-transition : opacity 250ms ease-in;\n  -moz-transition : opacity 250ms ease-in;\n  transition : opacity 250ms ease-in;\n}\n/* CssEval */\n.C-JS-org-waveprotocol-wave-client-widget-popup-DesktopUniversalPopup-Resources-Css-fadeOut {\n  -webkit-transition : opacity 350ms ease-out;\n  -moz-transition : opacity 350ms ease-out;\n  transition : opacity 350ms ease-out;\n}\n.C-KS-org-waveprotocol-wave-client-widget-popup-DesktopUniversalPopup-Resources-Css-mask {\n  position : absolute;\n  top : 0;\n  right : 0;\n  bottom : 0;\n  left : -12px;\n  background-color : black;\n  opacity : 0.6;\n  filter : "alpha(opacity=40%)";\n  z-index : 3;\n}\n'));
  flush();
}

function $associateWidget_1(this$static, w){
  $maybeCreateAutoHider(this$static);
  $add_9(this$static.autoHide.insideElements, w.element);
}

function $hide(this$static){
  var clone, listener, listener$iterator;
  if (!this$static.showing) {
    return;
  }
  clone = this$static.element.cloneNode(true);
  ($clinit_386() , $doc.body).appendChild(clone);
  this$static.showing = false;
  $remove_2(get_0(), this$static);
  this$static.shouldAutoHide && ($clinit_584() , $deregisterAutoHider(autoHideRegistrar, this$static.autoHide));
  $removeClassName(clone, 'C-IS-org-waveprotocol-wave-client-widget-popup-DesktopUniversalPopup-Resources-Css-fadeIn');
  $addClassName(clone, 'C-JS-org-waveprotocol-wave-client-widget-popup-DesktopUniversalPopup-Resources-Css-fadeOut');
  clone.offsetWidth || 0;
  clone.style.opacity = 0;
  $schedule_1(new DesktopUniversalPopup$1_0(clone), 450);
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 349);
    listener.onHide(this$static);
  }
}

function $maybeCreateAutoHider(this$static){
  if (!this$static.autoHide) {
    this$static.autoHide = new AutoHider_0(this$static, ($clinit_581() , HIDE_ON_ESCAPE));
    $add_9(this$static.autoHide.insideElements, this$static.element);
  }
}

function $move_1(this$static){
  this$static.positioner.setPopupPositionAndMakeVisible(this$static.reference, this$static.element);
}

function $show_0(this$static){
  var listener, listener$iterator;
  if (this$static.showing) {
    return;
  }
  this$static.element.style['visibility'] = ($clinit_99() , 'hidden');
  this$static.element.style.opacity = 0;
  $add_1(($clinit_386() , get_0()), this$static);
  this$static.shouldAutoHide && ($maybeCreateAutoHider(this$static) , $clinit_584() , $registerAutoHider(autoHideRegistrar, this$static.autoHide));
  this$static.positioner?this$static.positioner.setPopupPositionAndMakeVisible(this$static.reference, this$static.element):(this$static.element.style['visibility'] = 'visible' , undefined);
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 349);
    listener.onShow(this$static);
  }
  $removeClassName(this$static.element, 'C-JS-org-waveprotocol-wave-client-widget-popup-DesktopUniversalPopup-Resources-Css-fadeOut');
  $addClassName(this$static.element, 'C-IS-org-waveprotocol-wave-client-widget-popup-DesktopUniversalPopup-Resources-Css-fadeIn');
  parseInt(this$static.element['offsetWidth']) || 0;
  this$static.element.style.opacity = 1;
  this$static.showing = true;
}

function DesktopUniversalPopup_0(reference, p, chrome, autoHide){
  $clinit_1601();
  FlowPanel_0.call(this);
  this.listeners = ($clinit_2326() , $clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
  checkNotNull_0(this.element, 'addDebugClass: Element must not be null');
  this.chrome = chrome;
  this.positioner = p;
  this.reference = reference;
  this.shouldAutoHide = autoHide;
  this.element.className = 'C-LS-org-waveprotocol-wave-client-widget-popup-DesktopUniversalPopup-Resources-Css-popup';
  !!chrome && ($add_0(this, chrome, this.element) , undefined);
}

function DesktopUniversalPopup(){
}

_ = DesktopUniversalPopup_0.prototype = DesktopUniversalPopup.prototype = new FlowPanel;
_.getClass$ = function getClass_1042(){
  return Lorg_waveprotocol_wave_client_widget_popup_DesktopUniversalPopup_2_classLit;
}
;
_.onBrowserEvent = function onBrowserEvent_8(event_0){
  $onBrowserEvent(this, event_0);
  event_0.stopPropagation();
}
;
_.castableTypeMap$ = {5:1, 6:1, 7:1, 8:1, 55:1, 59:1, 61:1};
_.autoHide = null;
_.chrome = null;
_.positioner = null;
_.reference = null;
_.shouldAutoHide = false;
_.showing = false;
_.titleBar = null;
function DesktopUniversalPopup$1_0(val$clone){
  this.val$clone = val$clone;
  ScheduleTimer_1.call(this, ($clinit_1200() , LOW));
}

function DesktopUniversalPopup$1(){
}

_ = DesktopUniversalPopup$1_0.prototype = DesktopUniversalPopup$1.prototype = new ScheduleTimer;
_.getClass$ = function getClass_1043(){
  return Lorg_waveprotocol_wave_client_widget_popup_DesktopUniversalPopup$1_2_classLit;
}
;
_.run = function run_15(){
  $removeFromParent(this.val$clone);
}
;
_.castableTypeMap$ = {251:1, 253:1};
_.val$clone = null;
var provider_0 = null;
function createPopup_1(relative, positioner, chrome){
  return !provider_1 && (provider_1 = new DesktopPopupProvider_0) , new DesktopUniversalPopup_0(relative, positioner, chrome, true);
}

var provider_1 = null;
function $clinit_1613(){
  $clinit_1613 = nullMethod;
  $clinit_1616();
  $clinit_103();
  $push_1(toInject, ($clinit_211() , '/* CssDef */\n/* CssDef */\n/* CssDef */\n/* CssDef */\n.C-BT-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-north {\n  height : ' + chromeNorth.height_0 + 'px;\n  overflow : hidden;\n  background : url("' + chromeNorth.url + '") -' + chromeNorth.left_0 + 'px -' + chromeNorth.top_0 + 'px  repeat-x;\n  position : absolute;\n  top : -3px;\n  right : 2px;\n  left : 2px;\n}\n.C-HT-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-titled .C-BT-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-north {\n  height : ' + chromeNorthTitled.height_0 + 'px;\n  overflow : hidden;\n  background : url("' + chromeNorthTitled.url + '") -' + chromeNorthTitled.left_0 + 'px -' + chromeNorthTitled.top_0 + 'px  repeat-x;\n}\n.C-CT-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-northEast {\n  height : ' + chromeNorthEast.height_0 + 'px;\n  width : ' + chromeNorthEast.width_0 + 'px;\n  overflow : hidden;\n  background : url("' + chromeNorthEast.url + '") -' + chromeNorthEast.left_0 + 'px -' + chromeNorthEast.top_0 + 'px  no-repeat;\n  position : absolute;\n  right : -9px;\n  top : -3px;\n}\n.C-HT-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-titled .C-CT-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-northEast {\n  height : ' + chromeNorthEastTitled.height_0 + 'px;\n  width : ' + chromeNorthEastTitled.width_0 + 'px;\n  overflow : hidden;\n  background : url("' + chromeNorthEastTitled.url + '") -' + chromeNorthEastTitled.left_0 + 'px -' + chromeNorthEastTitled.top_0 + 'px  no-repeat;\n}\n.C-AT-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-eastNorthEast {\n  height : ' + chromeEastNorthEast.height_0 + 'px;\n  width : ' + chromeEastNorthEast.width_0 + 'px;\n  overflow : hidden;\n  background : url("' + chromeEastNorthEast.url + '") -' + chromeEastNorthEast.left_0 + 'px -' + chromeEastNorthEast.top_0 + 'px  no-repeat;\n  position : absolute;\n  top : 0;\n  right : -9px;\n}\n.C-PS-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-east {\n  width : ' + chromeEast.width_0 + 'px;\n  overflow : hidden;\n  background : url("' + chromeEast.url + '") -' + chromeEast.left_0 + 'px -' + chromeEast.top_0 + 'px  repeat-y;\n  position : absolute;\n  top : 9px;\n  right : -9px;\n  bottom : 0;\n}\n.C-FT-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-southEast {\n  height : ' + chromeSouthEast.height_0 + 'px;\n  width : ' + chromeSouthEast.width_0 + 'px;\n  overflow : hidden;\n  background : url("' + chromeSouthEast.url + '") -' + chromeSouthEast.left_0 + 'px -' + chromeSouthEast.top_0 + 'px  no-repeat;\n  position : absolute;\n  right : -9px;\n  bottom : -11px;\n}\n.C-ET-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-south {\n  height : ' + chromeSouth.height_0 + 'px;\n  overflow : hidden;\n  background : url("' + chromeSouth.url + '") -' + chromeSouth.left_0 + 'px -' + chromeSouth.top_0 + 'px  repeat-x;\n  position : absolute;\n  right : 2px;\n  bottom : -11px;\n  left : 10px;\n}\n.C-GT-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-southWest {\n  height : ' + chromeSouthWest.height_0 + 'px;\n  width : ' + chromeSouthWest.width_0 + 'px;\n  overflow : hidden;\n  background : url("' + chromeSouthWest.url + '") -' + chromeSouthWest.left_0 + 'px -' + chromeSouthWest.top_0 + 'px  no-repeat;\n  position : absolute;\n  bottom : -11px;\n  left : -1px;\n}\n.C-IT-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-west {\n  width : ' + chromeWest.width_0 + 'px;\n  overflow : hidden;\n  background : url("' + chromeWest.url + '") -' + chromeWest.left_0 + 'px -' + chromeWest.top_0 + 'px  repeat-y;\n  position : absolute;\n  top : 0;\n  bottom : 0;\n  left : -1px;\n}\n.C-DT-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-northWest {\n  height : ' + chromeNorthWest.height_0 + 'px;\n  width : ' + chromeNorthWest.width_0 + 'px;\n  overflow : hidden;\n  background : url("' + chromeNorthWest.url + '") -' + chromeNorthWest.left_0 + 'px -' + chromeNorthWest.top_0 + 'px  no-repeat;\n  position : absolute;\n  top : -3px;\n  left : -1px;\n}\n.C-HT-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-titled .C-DT-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-northWest {\n  height : ' + chromeNorthWestTitled.height_0 + 'px;\n  width : ' + chromeNorthWestTitled.width_0 + 'px;\n  overflow : hidden;\n  background : url("' + chromeNorthWestTitled.url + '") -' + chromeNorthWestTitled.left_0 + 'px -' + chromeNorthWestTitled.top_0 + 'px  no-repeat;\n}\n'));
  schedule();
}

function DesktopPopupChrome_0(){
  var frame;
  $clinit_1613();
  $initWidget(this, ($clinit_1616() , frame = new HTMLPanel_0("<div class='C-BT-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-north'><\/div> <div class='C-CT-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-northEast'><\/div> <div class='C-AT-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-eastNorthEast'><\/div> <div class='C-PS-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-east'><\/div> <div class='C-FT-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-southEast'><\/div> <div class='C-ET-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-south'><\/div> <div class='C-GT-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-southWest'><\/div> <div class='C-IT-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-west'><\/div> <div class='C-DT-org-waveprotocol-wave-client-widget-popup-desktopchrome-DesktopPopupChrome-Resources-Css-northWest'><\/div>") , this.frame = frame , frame));
}

function DesktopPopupChrome(){
}

_ = DesktopPopupChrome_0.prototype = DesktopPopupChrome.prototype = new Composite;
_.getClass$ = function getClass_1044(){
  return Lorg_waveprotocol_wave_client_widget_popup_desktopchrome_DesktopPopupChrome_2_classLit;
}
;
_.castableTypeMap$ = {5:1, 6:1, 7:1, 8:1, 55:1, 59:1};
_.frame = null;
function DesktopPopupChromeProvider_0(){
}

function DesktopPopupChromeProvider(){
}

_ = DesktopPopupChromeProvider_0.prototype = DesktopPopupChromeProvider.prototype = new Object_0;
_.getClass$ = function getClass_1045(){
  return Lorg_waveprotocol_wave_client_widget_popup_desktopchrome_DesktopPopupChromeProvider_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_1616(){
  $clinit_1616 = nullMethod;
  chromeEast = new ImageResourcePrototype_0(($clinit_211() , 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAPoCAYAAAAMYdSqAAAAnklEQVR42u3KIQGAQAAEsJMYFBKLxGFIQi6yUYi/EC8n5pbn/f4kd1111lF7bbXWEkmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSZqQBOFF72/pGXZMAAAAASUVORK5CYII='), 9, 1000);
  chromeEastNorthEast = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAJCAYAAADgkQYQAAAAi0lEQVR42m3PUQqCUBRF0UtlVhppUpQiRBmCRoVBzaRxNbYmlDs5xvvoY/1t7jvPnq/3x8zWSBAhxBRjjDAwRTlSxbHCCTwM+6jADhlWuhjA764pqnBUmOrp+e+aoovCQk9/n11g1m1TdMMZpa5ttC1wozuuurbHFkt9wO+jBxrUODi7/kYn7crc8S0ZfB8on3LctgAAAABJRU5ErkJggg==', 9, 9);
  chromeNorth = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA+gAAAADCAYAAAAAyCU4AAAAMUlEQVR42u3XQREAAAQAQSnlkk0hYvDYnbkQF1k9kiRJkiTpthgAAADgnEEHAACABxaMsb4A6I472gAAAABJRU5ErkJggg==', 1000, 3);
  chromeNorthEast = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAADCAYAAABF//VLAAAAV0lEQVR42mMIm3Dpf/Pau3cmrdirzMDAwAbFrEDMAsTMQMwExIxgfO7+p/8lS26BNQAFuIGYC4g5gJgdqgmh4T8QnLn78X/ijKv/gAICQMwPxLxQTSgaAKtnHCYpcRuVAAAAAElFTkSuQmCC', 11, 3);
  chromeNorthEastTitled = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAADCAYAAABF//VLAAAAUUlEQVR42mMIm3Dpf/Pau3cmrdirzMDAwAbFrEDMAsTMQMwExIxgDFJcsuQWWANQgBuIuYCYA4jZoZoQGkCKQThxxtV/QAEBIOYHYl6oJhQNAAHPGRjx7W8TAAAAAElFTkSuQmCC', 11, 3);
  chromeNorthTitled = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA+gAAAADCAYAAAAAyCU4AAAALklEQVR42u3XMQEAAAQAQSnlkk0htLDccAV++8jqAQAAAH6FCAAAAGDQAQAAgLPzHtJavNsQRAAAAABJRU5ErkJggg==', 1000, 3);
  chromeNorthWest = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAADCAYAAABWKLW/AAAAL0lEQVR42mNYevSefOemB+cSpl/9x9Cy/v6tzLnX/5+++/E/Q9jES/8vPPj0HwQA9AUb0BPRzY0AAAAASUVORK5CYII=', 3, 3);
  chromeNorthWestTitled = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAADCAYAAABWKLW/AAAAK0lEQVR42mNYevSefOemB+cSpl/9x9Cy/v6tzLnX/4dNuPSfIWziJTADhAHalBjAKy8yoQAAAABJRU5ErkJggg==', 3, 3);
  chromeSouth = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA+gAAAALCAYAAADsm6dVAAAAb0lEQVR42u3XoRGAQAADwUgMColF4jBUQl3URkMPXQSxN7MNxCVDkiRJkiTViwkkSZIkSfrBQb/uZwAAAABd+ToBAACAuhwAAABAXXYAAACgLhsAAABQlxUAAACoywIAAADUZQYAAADqMgEAAABdLwbPnmxRs7tzAAAAAElFTkSuQmCC', 1000, 11);
  chromeSouthEast = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALCAYAAACprHcmAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAALRJREFUeNpi+A8EVx5/+R828dJ/BgYGCyA2AmIdIFYBYmkgFgZiXiDmYLr5/BvDjD1PGDTFWZ4ABf4B8X80zABjM3VtevBfmOv/4/0L63OgipExsgYGRqjVMMk/UPwLiH8C8Q8o/RuEWaAMmOK/UP4fKBvFdBaozv9Iiv9g0QDWxAK16j+a6ega/sMUf0eyCl3DX2TnwExmQFKM7CQMZ/xCD080Tf+QnfEbTTEDlogBiwMEGACMaXY26wk4CwAAAABJRU5ErkJggg==', 11, 11);
  chromeSouthWest = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALCAYAAACprHcmAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJxJREFUeNpiSJxx9d/Fh5//EwOYNCS5LszY84Th0qMvDL/+/GPABxi7lxxQ/sEpu/PKk2/KDAQAIxCzATErFLMDMQeUZoeKMQMxE0gtTDELVIINqogNSTETsmKYbhaoIjYkjciKwc5ggSpmRrKBFc0JcMXIAixImmAGMMIwI8w9SBqY0QyAKUboQtLAiE0hzGRGpGBkRFeAzAYIMADGGjr/RsKvfgAAAABJRU5ErkJggg==', 11, 11);
  chromeWest = new ImageResourcePrototype_0('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAPoCAYAAAAftpReAAAAJUlEQVR42u3EMQEAAAgDoKU0l9kspCn84CDVs5EkSZIkSZL02QHrQ5tv5uTjowAAAABJRU5ErkJggg==', 1, 1000);
}

var chromeEast = null, chromeEastNorthEast = null, chromeNorth = null, chromeNorthEast = null, chromeNorthEastTitled = null, chromeNorthTitled = null, chromeNorthWest = null, chromeNorthWestTitled = null, chromeSouth = null, chromeSouthEast = null, chromeSouthWest = null, chromeWest = null;
function $clinit_1659(){
  $clinit_1659 = nullMethod;
  FATAL = new AbstractLogger$Level_0('FATAL', 0, 'fatal', 0);
  ERROR = new AbstractLogger$Level_0('ERROR', 1, 'error', 1);
  TRACE = new AbstractLogger$Level_0('TRACE', 2, 'trace', 2);
  $VALUES_55 = initValues(_3Lorg_waveprotocol_wave_common_logging_AbstractLogger$Level_2_classLit, {9:1, 68:1, 170:1}, 134, [FATAL, ERROR, TRACE]);
}

function AbstractLogger$Level_0(enum$name, enum$ordinal, string, value){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
  this.string = string;
  this.value_0 = value;
}

function valueOf_62(name_0){
  $clinit_1659();
  return valueOf_0(($clinit_1660() , $MAP_55), name_0);
}

function values_56(){
  $clinit_1659();
  return $VALUES_55;
}

function AbstractLogger$Level(){
}

_ = AbstractLogger$Level_0.prototype = AbstractLogger$Level.prototype = new Enum;
_.getClass$ = function getClass_1067(){
  return Lorg_waveprotocol_wave_common_logging_AbstractLogger$Level_2_classLit;
}
;
_.toString$ = function toString_79(){
  return this.string;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 134:1};
_.string = null;
_.value_0 = 0;
var $VALUES_55, ERROR, FATAL, TRACE;
function $clinit_1660(){
  $clinit_1660 = nullMethod;
  $MAP_55 = createValueOfMap(($clinit_1659() , $VALUES_55));
}

var $MAP_55;
function $log_0(this$static, msg){
  this$static.this$0.handleClientErrors(this$static.level, null, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [msg]));
  this$static.this$0.shouldLog(this$static.level) && (this$static.this$0.sink.lazyLog(this$static.level, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [msg])) , undefined);
}

function $log_2(this$static, label, o){
  this$static.this$0.handleClientErrors(this$static.level, null, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [label, o]));
  this$static.this$0.shouldLog(this$static.level) && (this$static.this$0.sink.lazyLog(this$static.level, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [label.length > 0?label + ': ':'', "<span class='object'>" + $replaceAll($replaceAll($replaceAll($replaceAll($replaceAll('' + o, '&', '&amp;'), '<', '&lt;'), '>', '&gt;'), '"', '&quot;'), "'", '&#39;') + '<\/span>'])) , undefined);
}

function $log_3(this$static, t){
  this$static.this$0.handleClientErrors(this$static.level, t, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [t.getMessage()]));
  this$static.this$0.shouldLog(this$static.level) && this$static.this$0.sink.lazyLog(this$static.level, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [t.toString$(), ': ', new LogSink$1_0(t)]));
}

function $log_4(this$static, label, t){
  this$static.this$0.handleClientErrors(this$static.level, t, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [label]));
  this$static.this$0.shouldLog(this$static.level) && this$static.this$0.sink.lazyLog(this$static.level, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [label, ': ', new LogSink$1_0(t)]));
}

function $logLazyObjects(this$static, objects){
  this$static.this$0.handleClientErrors(this$static.level, null, objects);
  this$static.this$0.shouldLog(this$static.level) && (this$static.this$0.sink.lazyLog(this$static.level, objects) , undefined);
}

function $logPlainText(this$static, msg){
  this$static.this$0.handleClientErrors(this$static.level, null, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [msg]));
  this$static.this$0.shouldLog(this$static.level) && this$static.this$0.logPlainTextInner(this$static.level, msg);
}

function $logXml(this$static, xml){
  this$static.this$0.handleClientErrors(this$static.level, null, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [xml]));
  this$static.this$0.shouldLog(this$static.level) && (this$static.this$0.sink.lazyLog(this$static.level, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [$replaceAll($replaceAll($replaceAll($replaceAll($replaceAll(xml, '&', '&amp;'), '<', '&lt;'), '>', '&gt;'), '"', '&quot;'), "'", '&#39;')])) , undefined);
}

function $shouldLog_0(this$static){
  return this$static.this$0.shouldLog(this$static.level);
}

function AbstractLogger$LevelLogger_0(this$0, level){
  this.this$0 = this$0;
  this.level = level;
}

function AbstractLogger$LevelLogger(){
}

_ = AbstractLogger$LevelLogger_0.prototype = AbstractLogger$LevelLogger.prototype = new Object_0;
_.getClass$ = function getClass_1068(){
  return Lorg_waveprotocol_wave_common_logging_AbstractLogger$LevelLogger_2_classLit;
}
;
_.castableTypeMap$ = {};
_.level = null;
_.this$0 = null;
function $add_27(this$static, e){
  $addLast(this$static.data_0, e);
  this$static.data_0.size_0 > this$static.maxSize && $removeFirst(this$static.data_0);
}

function CircularBuffer_0(){
  this.data_0 = new LinkedList_0;
  this.maxSize = 2000;
}

function CircularBuffer(){
}

_ = CircularBuffer_0.prototype = CircularBuffer.prototype = new Object_0;
_.getClass$ = function getClass_1069(){
  return Lorg_waveprotocol_wave_common_logging_CircularBuffer_2_classLit;
}
;
_.iterator_0 = function iterator_22(){
  return $listIterator_2(this.data_0, 0);
}
;
_.castableTypeMap$ = {};
_.data_0 = null;
_.maxSize = 0;
function $lazyLog_1(this$static, level, messages){
  var s, s$iterator, outerIter, entry;
  $add_27(this$static.buffer, messages);
  if (this$static.sinks.map.size_1() != 0) {
    for (s$iterator = (outerIter = $keySet_0(this$static.sinks.map).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter)); s$iterator.val$outerIter.hasNext();) {
      s = dynamicCast((entry = dynamicCast(s$iterator.val$outerIter.next_0(), 11) , entry.getKey()), 351);
      s.lazyLog(level, messages);
    }
  }
}

function InMemoryLogSink_0(){
  this.buffer = new CircularBuffer_0;
  this.sinks = new HashSet_0;
}

function InMemoryLogSink(){
}

_ = InMemoryLogSink_0.prototype = InMemoryLogSink.prototype = new LogSink;
_.getClass$ = function getClass_1070(){
  return Lorg_waveprotocol_wave_common_logging_InMemoryLogSink_2_classLit;
}
;
_.lazyLog = function lazyLog_2(level, messages){
  $lazyLog_1(this, level, messages);
}
;
_.castableTypeMap$ = {351:1};
function LogSink$1_0(val$t){
  this.val$t = val$t;
}

function LogSink$1(){
}

_ = LogSink$1_0.prototype = LogSink$1.prototype = new Object_0;
_.getClass$ = function getClass_1071(){
  return Lorg_waveprotocol_wave_common_logging_LogSink$1_2_classLit;
}
;
_.toString$ = function toString_80(){
  return $replaceAll($replaceAll($replaceAll($replaceAll($replaceAll(this.val$t.toString$(), '&', '&amp;'), '<', '&lt;'), '>', '&gt;'), '"', '&quot;'), "'", '&#39;') + '<br/>' + printStackTraceAsHtml(this.val$t);
}
;
_.castableTypeMap$ = {};
_.val$t = null;
function printStackTraceAsHtml(t){
  var i, sb, stes;
  stes = $getStackTrace(t);
  sb = new StringBuilder_0;
  for (i = 0; i < stes.length && i <= 12; ++i) {
    $append_11($append_11($append_11($append_9($append_11($append_11((sb.impl.string += '&nbsp;&nbsp;&nbsp;&nbsp;' , sb), stes[i].className_0), ':'), stes[i].lineNumber), ': '), stes[i].methodName), '<br/>');
  }
  12 < stes.length - 1 && (sb.impl.string += '&nbsp;&nbsp;&nbsp;&nbsp;...<br/>' , sb);
  return sb.impl.string;
}

function stringifyLogObject(o){
  var builder, object, object$index, object$max, objects;
  if (o != null && o.castableTypeMap$ && !!o.castableTypeMap$[68]) {
    builder = new StringBuilder_0;
    objects = dynamicCast(o, 68);
    for (object$index = 0 , object$max = objects.length; object$index < object$max; ++object$index) {
      object = objects[object$index];
      $append_11(builder, toString__devirtual$(object));
    }
    return builder.impl.string;
  }
   else {
    return toString__devirtual$(o);
  }
}

function $fireOnValueAdded(this$static, value){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 353);
    $triggerOnFolderAdded_0(listener.this$0, value.value_0);
  }
}

function $fireOnValueRemoved(this$static, value){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 353);
    $triggerOnFolderRemoved(listener.this$0, value.value_0);
  }
}

function AbstractObservableBasicSet(){
}

_ = AbstractObservableBasicSet.prototype = new Object_0;
_.addListener = function addListener_3(listener){
  $add_31(this.listeners, dynamicCast(listener, 353));
}
;
_.getClass$ = function getClass_1074(){
  return Lorg_waveprotocol_wave_model_adt_AbstractObservableBasicSet_2_classLit;
}
;
_.removeListener = function removeListener_3(listener){
  $remove_42(this.listeners, dynamicCast(listener, 353));
}
;
_.castableTypeMap$ = {};
function $cleanup_0(this$static){
  var e, e$iterator, obsoleteEntry, obsoleteEntry$iterator, toRemove, outerIter, entry;
  if (!this$static.activeCleanUp) {
    return;
  }
  toRemove = new ArrayList_0;
  for (obsoleteEntry$iterator = (outerIter = $keySet_0(this$static.obsoleteEntries.map).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter)); obsoleteEntry$iterator.val$outerIter.hasNext();) {
    obsoleteEntry = (entry = dynamicCast(obsoleteEntry$iterator.val$outerIter.next_0(), 11) , entry.getKey());
    setCheck(toRemove.array, toRemove.size_0++, obsoleteEntry);
  }
  for (e$iterator = new AbstractList$IteratorImpl_0(toRemove); e$iterator.i < e$iterator.this$0_0.size_1();) {
    e = $next_4(e$iterator);
    this$static.router.getDocument_0().deleteNode(e);
  }
}

function $get_21(this$static, key){
  var entry;
  entry = this$static.entries.get(key);
  return entry != null?$valueOf(this$static, entry):null;
}

function $invalidateEntry(this$static, entry){
  entry != null && this$static.activeCleanUp && $add_13(this$static.obsoleteEntries, entry);
}

function $load_0(this$static){
  var entry, nextEntry;
  entry = getFirstChildElement(this$static.router.getDocument_0(), this$static.container);
  while (entry != null) {
    nextEntry = getNextSiblingElement(this$static.router.getDocument_0(), entry);
    $onElementAdded(this$static, entry);
    entry = nextEntry;
  }
}

function $onElementAdded(this$static, entry){
  var key, newValue, oldEntry, oldValue, keyString;
  if (!$equals_3(this$static.entryTagName, this$static.router.getDocument_0().getTagName(entry))) {
    return;
  }
  key = (keyString = this$static.router.getDocument_0().getAttribute_0(entry, this$static.keyAttrName) , this$static.keySerializer.fromString(keyString));
  newValue = $valueOf(this$static, entry);
  oldEntry = this$static.entries.get(key);
  oldValue = oldEntry != null?$valueOf(this$static, oldEntry):null;
  if (this$static.canReplace(oldEntry, entry, oldValue, newValue)) {
    $invalidateEntry(this$static, this$static.entries.get(key));
    this$static.entries.put(key, entry);
    $triggerOnEntryChanged(this$static, key, oldValue, newValue);
  }
   else {
    entry != null && this$static.activeCleanUp && $add_13(this$static.obsoleteEntries, entry);
  }
}

function $put_8(this$static, key, value){
  var currentValue, entry, attrs;
  checkNotNull_1(key, 'key must not be null');
  checkNotNull_1(value, 'value must not be null');
  currentValue = (entry = this$static.entries.get(key) , entry != null?$valueOf(this$static, entry):null);
  if (this$static.isRedundantPut(currentValue, value)) {
    return false;
  }
  this$static.suppressBroadcasts = true;
  $invalidateEntry(this$static, this$static.entries.get(key));
  $cleanup_0(this$static);
  attrs = new HashMap_0;
  attrs.put(this$static.keyAttrName, this$static.keySerializer.toString_0(key));
  attrs.put(this$static.valueAttrName, this$static.valueSerializer.toString_0(value));
  prependChild(this$static.router.getDocument_0(), this$static.container, this$static.entryTagName, new AttributesImpl_1(attrs));
  this$static.suppressBroadcasts = false;
  $triggerOnEntryChanged(this$static, key, currentValue, value);
  return true;
}

function $remove_38(this$static, key){
  $invalidateEntry(this$static, this$static.entries.get(key));
  $cleanup_0(this$static);
}

function $triggerOnEntryChanged(this$static, key, oldValue, newValue){
  var l_0, l$iterator;
  if (this$static.suppressBroadcasts) {
    return;
  }
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 354);
    l_0.onEntrySet(key, oldValue, newValue);
  }
}

function $valueOf(this$static, entry){
  var valueString;
  valueString = this$static.router.getDocument_0().getAttribute_0(entry, this$static.valueAttrName);
  return valueString != null?this$static.valueSerializer.fromString(valueString):null;
}

function AbstractDocumentBasedMap_0(router, entryContainer, keySerializer, valueSerializer, entryTagName, keyAttrName, valueAttrName){
  this.entries = new HashMap_0;
  this.obsoleteEntries = new HashSet_0;
  this.listeners = ($clinit_2326() , $clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
  this.container = entryContainer;
  this.keySerializer = keySerializer;
  this.valueSerializer = valueSerializer;
  this.entryTagName = entryTagName;
  this.keyAttrName = keyAttrName;
  this.valueAttrName = valueAttrName;
  this.activeCleanUp = true;
  this.router = router;
  this.suppressBroadcasts = false;
}

function prependChild(doc, container, tag, attrs){
  return doc.createElement_0(new Point$El_0(container, doc.getFirstChild_0(container)), tag, attrs);
}

function AbstractDocumentBasedMap(){
}

_ = AbstractDocumentBasedMap.prototype = new Object_0;
_.getClass$ = function getClass_1075(){
  return Lorg_waveprotocol_wave_model_adt_docbased_AbstractDocumentBasedMap_2_classLit;
}
;
_.onElementAdded = function onElementAdded(entry){
  $onElementAdded(this, entry);
}
;
_.onElementRemoved = function onElementRemoved(entry){
  var key, keyString;
  if (!$equals_3(this.entryTagName, this.router.getDocument_0().getTagName(entry))) {
    return;
  }
  key = (keyString = this.router.getDocument_0().getAttribute_0(entry, this.keyAttrName) , this.keySerializer.fromString(keyString));
  if (maskUndefined(this.entries.get(key)) === (entry == null?null:entry)) {
    this.entries.remove_3(key);
    $triggerOnEntryChanged(this, key, $valueOf(this, entry), null);
  }
  this.activeCleanUp && this.obsoleteEntries.map.remove_3(entry) != null;
}
;
_.castableTypeMap$ = {434:1};
_.activeCleanUp = false;
_.container = null;
_.entryTagName = null;
_.keyAttrName = null;
_.keySerializer = null;
_.router = null;
_.suppressBroadcasts = false;
_.valueAttrName = null;
_.valueSerializer = null;
function CompoundInitializer_0(components){
  this.components = components;
}

function CompoundInitializer(){
}

_ = CompoundInitializer_0.prototype = CompoundInitializer.prototype = new Object_0;
_.getClass$ = function getClass_1076(){
  return Lorg_waveprotocol_wave_model_adt_docbased_CompoundInitializer_2_classLit;
}
;
_.initialize = function initialize(target){
  var initializer, initializer$array, initializer$index, initializer$max;
  for (initializer$array = this.components , initializer$index = 0 , initializer$max = initializer$array.length; initializer$index < initializer$max; ++initializer$index) {
    initializer = initializer$array[initializer$index];
    initializer.initialize(target);
  }
}
;
_.castableTypeMap$ = {18:1};
_.components = null;
function DocumentBasedBasicMap_0(router, entryContainer, keySerializer, valueSerializer, entryTagName, keyAttrName, valueAttrName){
  AbstractDocumentBasedMap_0.call(this, router, entryContainer, keySerializer, valueSerializer, entryTagName, keyAttrName, valueAttrName);
}

function DocumentBasedBasicMap(){
}

_ = DocumentBasedBasicMap_0.prototype = DocumentBasedBasicMap.prototype = new AbstractDocumentBasedMap;
_.canReplace = function canReplace(oldEntry, newEntry, oldValue, newValue){
  if (oldEntry == null) {
    return true;
  }
  if (this.router.getDocument_0().getLocation(newEntry) > this.router.getDocument_0().getLocation(oldEntry)) {
    return true;
  }
  return false;
}
;
_.getClass$ = function getClass_1077(){
  return Lorg_waveprotocol_wave_model_adt_docbased_DocumentBasedBasicMap_2_classLit;
}
;
_.isRedundantPut = function isRedundantPut(oldValue, newValue){
  if (oldValue == null) {
    return newValue == null;
  }
  if (newValue != null) {
    return equals__devirtual$(oldValue, newValue);
  }
  return false;
}
;
_.castableTypeMap$ = {434:1};
function $deleteObsoleteElements(this$static){
  var document_0, outerIter, entry;
  document_0 = this$static.router.getDocument_0();
  while (this$static.obsoleteElements.map.size_1() != 0) {
    document_0.deleteNode((entry = dynamicCast((outerIter = $keySet_0(this$static.obsoleteElements.map).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter)).val$outerIter.next_0(), 11) , entry.getKey()));
  }
}

function $handleElementAdded(this$static, newElement){
  var document_0, oldEntry, value;
  document_0 = this$static.router.getDocument_0();
  if (!$equals_3(this$static.entryTagName, document_0.getTagName(newElement))) {
    return;
  }
  value = $fromString_2(this$static.router.getDocument_0().getAttribute_0(newElement, this$static.valueAttrName));
  oldEntry = this$static.valueElements.get(value);
  if (oldEntry == null) {
    this$static.valueElements.put(value, newElement);
    $fireOnValueAdded(this$static, value);
  }
   else if (document_0.getLocation(oldEntry) < document_0.getLocation(newElement)) {
    $add_13(this$static.obsoleteElements, newElement);
  }
   else {
    $add_13(this$static.obsoleteElements, oldEntry);
    this$static.valueElements.put(value, newElement);
  }
}

function $handleElementRemoved(this$static, deletedElement){
  var existingElement, value;
  if (!$equals_3(this$static.entryTagName, this$static.router.getDocument_0().getTagName(deletedElement))) {
    return;
  }
  if (this$static.obsoleteElements.map.remove_3(deletedElement) != null) {
    return;
  }
  value = $fromString_2(this$static.router.getDocument_0().getAttribute_0(deletedElement, this$static.valueAttrName));
  existingElement = this$static.valueElements.get(value);
  if ((existingElement == null?null:existingElement) !== (deletedElement == null?null:deletedElement))
  ;
  else {
    this$static.valueElements.remove_3(value);
    $fireOnValueRemoved(this$static, value);
  }
}

function $init_18(this$static){
  var curr, document_0, next;
  $addChildListener(this$static.router, this$static.container, new DocumentBasedBasicSet$1_0(this$static));
  document_0 = this$static.router.getDocument_0();
  curr = getFirstChildElement(document_0, this$static.container);
  while (curr != null) {
    next = getNextElementInclusive(document_0, document_0.getNextSibling(curr), true);
    $handleElementAdded(this$static, curr);
    curr = next;
  }
  return this$static;
}

function $remove_39(this$static, value){
  if (this$static.valueElements.containsKey(value)) {
    $deleteObsoleteElements(this$static);
    this$static.router.getDocument_0().deleteNode(this$static.valueElements.get(value));
  }
}

function DocumentBasedBasicSet_0(router, entryContainer, serializer){
  this.listeners = ($clinit_2326() , $clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
  this.valueElements = ($clinit_2309() , new HashMap_0);
  this.obsoleteElements = new HashSet_0;
  this.router = router;
  this.container = entryContainer;
  this.entryTagName = 'folder';
  this.valueAttrName = 'i';
}

function DocumentBasedBasicSet(){
}

_ = DocumentBasedBasicSet_0.prototype = DocumentBasedBasicSet.prototype = new AbstractObservableBasicSet;
_.getClass$ = function getClass_1078(){
  return Lorg_waveprotocol_wave_model_adt_docbased_DocumentBasedBasicSet_2_classLit;
}
;
_.castableTypeMap$ = {};
_.container = null;
_.entryTagName = null;
_.router = null;
_.valueAttrName = null;
function DocumentBasedBasicSet$1_0(this$0){
  this.this$0 = this$0;
}

function DocumentBasedBasicSet$1(){
}

_ = DocumentBasedBasicSet$1_0.prototype = DocumentBasedBasicSet$1.prototype = new Object_0;
_.getClass$ = function getClass_1079(){
  return Lorg_waveprotocol_wave_model_adt_docbased_DocumentBasedBasicSet$1_2_classLit;
}
;
_.onElementAdded = function onElementAdded_0(element){
  $handleElementAdded(this.this$0, element);
}
;
_.onElementRemoved = function onElementRemoved_0(element){
  $handleElementRemoved(this.this$0, element);
}
;
_.castableTypeMap$ = {434:1};
_.this$0 = null;
function $get_22(this$static){
  var valueStr;
  valueStr = this$static.document_0.getAttribute_0(this$static.element, this$static.valueAttrName);
  return this$static.serializer.fromString(valueStr);
}

function $triggerOnValueChanged(this$static, oldValue, newValue){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 355);
    listener.onValueChanged(oldValue, newValue);
  }
}

function DocumentBasedBasicValue_0(document_0, element, serializer, valueAttrName){
  this.listeners = ($clinit_2326() , $clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
  this.document_0 = document_0;
  this.element = element;
  this.serializer = serializer;
  this.valueAttrName = valueAttrName;
}

function create_48(router, element, serializer, valueAttrName){
  var value;
  value = new DocumentBasedBasicValue_0(router.getDocument_0(), element, serializer, valueAttrName);
  router.addAttributeListener(element, value);
  return value;
}

function createInitialiser(serializer, valueAttrName, value){
  return new DocumentBasedBasicValue$1_0(value, valueAttrName, serializer);
}

function DocumentBasedBasicValue(){
}

_ = DocumentBasedBasicValue_0.prototype = DocumentBasedBasicValue.prototype = new Object_0;
_.addListener = function addListener_4(listener){
  $add_31(this.listeners, dynamicCast(listener, 355));
}
;
_.getClass$ = function getClass_1080(){
  return Lorg_waveprotocol_wave_model_adt_docbased_DocumentBasedBasicValue_2_classLit;
}
;
_.onAttributesChanged = function onAttributesChanged(element, oldValues, newValues){
  var newValue, newValueStr, oldValue, oldValueStr;
  oldValueStr = dynamicCast(oldValues.map.get(this.valueAttrName), 1);
  newValueStr = dynamicCast(newValues.map.get(this.valueAttrName), 1);
  oldValue = this.serializer.fromString(oldValueStr);
  newValue = this.serializer.fromString(newValueStr);
  (oldValue == null?newValue != null:!equals__devirtual$(oldValue, newValue)) && $triggerOnValueChanged(this, oldValue, newValue);
}
;
_.removeListener = function removeListener_4(listener){
  $remove_42(this.listeners, dynamicCast(listener, 355));
}
;
_.castableTypeMap$ = {433:1};
_.document_0 = null;
_.element = null;
_.serializer = null;
_.valueAttrName = null;
function DocumentBasedBasicValue$1_0(val$value, val$valueAttrName, val$serializer){
  this.val$value = val$value;
  this.val$valueAttrName = val$valueAttrName;
  this.val$serializer = val$serializer;
}

function DocumentBasedBasicValue$1(){
}

_ = DocumentBasedBasicValue$1_0.prototype = DocumentBasedBasicValue$1.prototype = new Object_0;
_.getClass$ = function getClass_1081(){
  return Lorg_waveprotocol_wave_model_adt_docbased_DocumentBasedBasicValue$1_2_classLit;
}
;
_.initialize = function initialize_0(target){
  this.val$value != null && initialiseAttribute(target, this.val$valueAttrName, this.val$serializer.toString_0(this.val$value));
}
;
_.castableTypeMap$ = {18:1};
_.val$serializer = null;
_.val$value = null;
_.val$valueAttrName = null;
function $clinit_1703(){
  $clinit_1703 = nullMethod;
  FALSE_2 = $toString_33(dynamicCast(($clinit_2363() , $clinit_428() , $clinit_428() , FALSE_0), 62));
}

function $changeValue(this$static, newElement){
  var newValue, oldValue;
  oldValue = this$static.value_0;
  if (newElement != null) {
    this$static.valueElement = newElement;
    this$static.value_0 = ($clinit_428() , $equals_3(FALSE_2, this$static.router.getDocument_0().getAttribute_0(this$static.valueElement, this$static.valueAttr))?FALSE_0:TRUE_0);
  }
   else {
    this$static.valueElement = null;
    this$static.value_0 = null;
  }
  newValue = this$static.value_0;
  $maybeTriggerOnValueChanged(this$static, oldValue, newValue);
}

function $extractLastRedundant(this$static){
  var element, element$iterator, location_0, maxElement, maxLocation;
  maxElement = null;
  maxLocation = -1;
  for (element$iterator = new AbstractList$IteratorImpl_0(this$static.redundantElements); element$iterator.i < element$iterator.this$0_0.size_1();) {
    element = $next_4(element$iterator);
    location_0 = this$static.router.getDocument_0().getLocation(element);
    if (location_0 > maxLocation) {
      maxLocation = location_0;
      maxElement = element;
    }
  }
  $remove_13(this$static.redundantElements, maxElement);
  return maxElement;
}

function $load_1(this$static){
  var child, document_0;
  document_0 = this$static.router.getDocument_0();
  child = getFirstChildElement(document_0, this$static.container);
  while (child != null) {
    $onElementAdded_0(this$static, child);
    child = getNextElementInclusive(document_0, document_0.getNextSibling(child), true);
  }
}

function $maybeTriggerOnValueChanged(this$static, oldValue, newValue){
  var listener, listener$iterator;
  if (!(!oldValue?!newValue:!!newValue && newValue.value_0 == oldValue.value_0)) {
    for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
      listener = dynamicCast(listener$iterator.next_0(), 355);
      listener.onValueChanged(oldValue, newValue);
    }
  }
}

function $onElementAdded_0(this$static, newElement){
  var document_0;
  document_0 = this$static.router.getDocument_0();
  if (!$equals_3(this$static.tag, document_0.getTagName(newElement))) {
    return;
  }
  if (this$static.valueElement != null) {
    if (document_0.getLocation(newElement) < document_0.getLocation(this$static.valueElement)) {
      $add_9(this$static.redundantElements, newElement);
    }
     else {
      $add_9(this$static.redundantElements, this$static.valueElement);
      $changeValue(this$static, newElement);
    }
  }
   else {
    $changeValue(this$static, newElement);
  }
}

function DocumentBasedBoolean_0(router, container, tag, valueAttr){
  this.redundantElements = new ArrayList_0;
  this.listeners = ($clinit_2326() , $clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
  this.router = router;
  this.container = container;
  this.tag = tag;
  this.valueAttr = valueAttr;
}

function create_49(router, container, tag, valueAttrName){
  $clinit_1703();
  var value;
  value = new DocumentBasedBoolean_0(router, container, tag, valueAttrName);
  $addChildListener(router, container, value);
  $load_1(value);
  return value;
}

function DocumentBasedBoolean(){
}

_ = DocumentBasedBoolean_0.prototype = DocumentBasedBoolean.prototype = new Object_0;
_.addListener = function addListener_5(listener){
  $add_31(this.listeners, dynamicCast(listener, 355));
}
;
_.getClass$ = function getClass_1082(){
  return Lorg_waveprotocol_wave_model_adt_docbased_DocumentBasedBoolean_2_classLit;
}
;
_.onElementAdded = function onElementAdded_1(newElement){
  $onElementAdded_0(this, newElement);
}
;
_.onElementRemoved = function onElementRemoved_1(oldElement){
  if (!$equals_3(this.tag, this.router.getDocument_0().getTagName(oldElement))) {
    return;
  }
  $remove_13(this.redundantElements, oldElement);
  (oldElement == null?null:oldElement) === maskUndefined(this.valueElement) && $changeValue(this, $extractLastRedundant(this));
}
;
_.removeListener = function removeListener_5(listener){
  $remove_42(this.listeners, dynamicCast(listener, 355));
}
;
_.castableTypeMap$ = {434:1};
_.container = null;
_.router = null;
_.tag = null;
_.value_0 = null;
_.valueAttr = null;
_.valueElement = null;
var FALSE_2;
function $add_28(this$static, initialState){
  var attributes, element;
  attributes = buildAttributes(initialState, this$static.factory);
  element = this$static.router.getDocument_0().createChildElement(this$static.parent_0, this$static.childTag, attributes);
  return this$static.elementToValue.get(element);
}

function $fireElementAdded(this$static, child){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 356);
    l_0.onValueAdded(child);
  }
}

function $fireElementRemoved(this$static, child){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 356);
    l_0.onValueRemoved(child);
  }
}

function $getPreviousKnownValue(this$static, added){
  var prev, value;
  prev = getPreviousSiblingElement_0(this$static.router.getDocument_0(), added);
  while (prev != null) {
    value = this$static.elementToValue.get(prev);
    if (value != null) {
      return value;
    }
    prev = getPreviousSiblingElement_0(this$static.router.getDocument_0(), prev);
  }
  return null;
}

function $load_2(this$static){
  var entry;
  entry = getFirstChildElement(this$static.router.getDocument_0(), this$static.parent_0);
  while (entry != null) {
    $onElementAdded_1(this$static, entry);
    entry = getNextSiblingElement(this$static.router.getDocument_0(), entry);
  }
}

function $onElementAdded_1(this$static, element){
  var child, sibling;
  if ($equals_3(this$static.childTag, this$static.router.getDocument_0().getTagName(element))) {
    child = this$static.factory.adapt(this$static.router, element);
    sibling = $getPreviousKnownValue(this$static, element);
    $add_10(this$static.orderedValues, sibling == null?0:$indexOf_4(this$static.orderedValues, sibling, 0) + 1, child);
    this$static.elementToValue.put(element, child);
    this$static.valueToElement.put(child, element);
    $fireElementAdded(this$static, child);
  }
}

function DocumentBasedElementList_0(router, parent_0, childTag, factory){
  this.orderedValues = new ArrayList_0;
  this.valueToElement = new HashMap_0;
  this.elementToValue = new HashMap_0;
  this.listeners = ($clinit_2326() , $clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
  this.parent_0 = parent_0;
  this.childTag = childTag;
  this.factory = factory;
  this.router = router;
}

function DocumentBasedElementList(){
}

_ = DocumentBasedElementList_0.prototype = DocumentBasedElementList.prototype = new Object_0;
_.addListener = function addListener_6(listener){
  $add_31(this.listeners, dynamicCast(listener, 356));
}
;
_.getClass$ = function getClass_1083(){
  return Lorg_waveprotocol_wave_model_adt_docbased_DocumentBasedElementList_2_classLit;
}
;
_.onElementAdded = function onElementAdded_2(element){
  $onElementAdded_1(this, element);
}
;
_.onElementRemoved = function onElementRemoved_2(element){
  var child;
  child = this.elementToValue.remove_3(element);
  if (child != null) {
    $remove_13(this.orderedValues, child);
    $fireElementRemoved(this, child);
  }
}
;
_.removeListener = function removeListener_6(listener){
  $remove_42(this.listeners, dynamicCast(listener, 356));
}
;
_.castableTypeMap$ = {434:1};
_.childTag = null;
_.elementToValue = null;
_.factory = null;
_.listeners = null;
_.orderedValues = null;
_.parent_0 = null;
_.router = null;
_.valueToElement = null;
function $canReplace(currentValue, value){
  if (currentValue == null || currentValue.compareTo$(value) < 0) {
    return true;
  }
  return false;
}

function $isRedundantPut(currentValue, newValue){
  return currentValue == null?newValue == null:newValue != null && currentValue.compareTo$(newValue) >= 0;
}

function DocumentBasedMonotonicMap_0(router, entryContainer, keySerializer, valueSerializer, entryTagName, valueAttrName){
  AbstractDocumentBasedMap_0.call(this, router, entryContainer, keySerializer, valueSerializer, entryTagName, 'i', valueAttrName);
}

function DocumentBasedMonotonicMap(){
}

_ = DocumentBasedMonotonicMap_0.prototype = DocumentBasedMonotonicMap.prototype = new AbstractDocumentBasedMap;
_.canReplace = function canReplace_0(oldEntry, newEntry, currentValue, value){
  return $canReplace(dynamicCast(currentValue, 10), dynamicCast(value, 10));
}
;
_.getClass$ = function getClass_1084(){
  return Lorg_waveprotocol_wave_model_adt_docbased_DocumentBasedMonotonicMap_2_classLit;
}
;
_.isRedundantPut = function isRedundantPut_0(currentValue, newValue){
  return $isRedundantPut(dynamicCast(currentValue, 10), dynamicCast(newValue, 10));
}
;
_.castableTypeMap$ = {434:1};
function $get_23(this$static){
  return this$static.value_0 != null?$valueOf_0(this$static, this$static.value_0):null;
}

function $invalidateEntry_0(this$static, entry){
  entry != null && $add_13(this$static.obsoleteEntries, entry);
}

function $load_3(this$static){
  var document_0, nextValue, value;
  document_0 = this$static.router.getDocument_0();
  value = getFirstChildElement(document_0, this$static.container);
  while (value != null) {
    nextValue = getNextElementInclusive(document_0, document_0.getNextSibling(value), true);
    $onElementAdded_2(this$static, value);
    value = nextValue;
  }
}

function $onElementAdded_2(this$static, entry){
  var document_0, newValue, oldValue;
  document_0 = this$static.router.getDocument_0();
  if (!$equals_3(this$static.entryTagName, document_0.getTagName(entry))) {
    return;
  }
  newValue = $fromString_2(this$static.router.getDocument_0().getAttribute_0(entry, this$static.valueAttrName));
  oldValue = this$static.value_0 != null?$valueOf_0(this$static, this$static.value_0):null;
  if (!oldValue || (oldValue.value_0 < newValue.value_0?-1:oldValue.value_0 > newValue.value_0?1:0) < 0) {
    $invalidateEntry_0(this$static, this$static.value_0);
    this$static.value_0 = null;
    this$static.value_0 = entry;
    $triggerOnEntryChanged_0(this$static, oldValue, newValue);
  }
   else {
    entry != null && $add_13(this$static.obsoleteEntries, entry);
  }
}

function $triggerOnEntryChanged_0(this$static, oldValue, newValue){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 357);
    l_0.onSet(oldValue, newValue);
  }
}

function $valueOf_0(this$static, entry){
  return $fromString_2(this$static.router.getDocument_0().getAttribute_0(entry, this$static.valueAttrName));
}

function DocumentBasedMonotonicValue_0(router, entryContainer, serializer, entryTagName){
  this.obsoleteEntries = new HashSet_0;
  this.listeners = ($clinit_2326() , $clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
  this.router = router;
  this.container = entryContainer;
  this.entryTagName = entryTagName;
  this.valueAttrName = 'v';
}

function create_52(router, entryContainer, serializer, entryTagName){
  var value;
  value = new DocumentBasedMonotonicValue_0(router, entryContainer, serializer, entryTagName);
  $addChildListener(router, entryContainer, value);
  $load_3(value);
  return value;
}

function DocumentBasedMonotonicValue(){
}

_ = DocumentBasedMonotonicValue_0.prototype = DocumentBasedMonotonicValue.prototype = new Object_0;
_.getClass$ = function getClass_1085(){
  return Lorg_waveprotocol_wave_model_adt_docbased_DocumentBasedMonotonicValue_2_classLit;
}
;
_.onElementAdded = function onElementAdded_3(entry){
  $onElementAdded_2(this, entry);
}
;
_.onElementRemoved = function onElementRemoved_3(entry){
  var oldValue;
  if (!$equals_3(this.entryTagName, this.router.getDocument_0().getTagName(entry))) {
    return;
  }
  if (maskUndefined(this.value_0) === (entry == null?null:entry)) {
    oldValue = this.value_0 != null?$valueOf_0(this, this.value_0):null;
    this.value_0 = null;
    $triggerOnEntryChanged_0(this, oldValue, null);
  }
   else {
    this.obsoleteEntries.map.remove_3(entry) != null;
  }
}
;
_.castableTypeMap$ = {434:1};
_.container = null;
_.entryTagName = null;
_.router = null;
_.value_0 = null;
_.valueAttrName = null;
function $changeCurrentValue(this$static, newCurrentElement){
  var oldValue;
  !this$static.currentValue && (this$static.currentValue = this$static.currentElement?$adapt(this$static.router, dynamicCast(this$static.currentElement, 260)):null);
  oldValue = this$static.currentValue;
  this$static.currentElement = newCurrentElement;
  this$static.currentValue = null;
  !this$static.currentValue && (this$static.currentValue = this$static.currentElement?$adapt(this$static.router, dynamicCast(this$static.currentElement, 260)):null);
  $maybeTriggerOnValueChanged_0(this$static, oldValue, this$static.currentValue);
}

function $get_24(this$static){
  !this$static.currentValue && (this$static.currentValue = this$static.currentElement?$adapt(this$static.router, dynamicCast(this$static.currentElement, 260)):null);
  return this$static.currentValue;
}

function $maybeTriggerOnValueChanged_0(this$static, oldValue, newValue){
  var l_0, l$iterator;
  if (!oldValue?!!newValue:oldValue != newValue) {
    for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
      l_0 = dynamicCast(l$iterator.next_0(), 358);
      $onValueChanged(l_0, oldValue, newValue);
    }
  }
}

function $onElementAdded_3(this$static, newElement){
  newElement == dynamicCast(getElementWithTagName_0(this$static.router.doc, this$static.valueTagName, this$static.container), 260) && newElement != this$static.currentElement && $changeCurrentValue(this$static, newElement);
}

function $onElementRemoved(this$static, removedElement){
  removedElement == this$static.currentElement && $changeCurrentValue(this$static, dynamicCast(getElementWithTagName_0(this$static.router.doc, this$static.valueTagName, this$static.container), 260));
}

function DocumentBasedSingleton_0(router, container, valueFactory){
  this.listeners = ($clinit_2326() , $clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
  this.router = router;
  this.container = container;
  this.valueTagName = 'conversation';
  this.currentElement = dynamicCast(getElementWithTagName_0(this.router.doc, this.valueTagName, this.container), 260);
}

function create_53(router, container, valueFactory){
  var singleton;
  singleton = new DocumentBasedSingleton_0(router, container, valueFactory);
  $addChildListener(router, container, singleton);
  return singleton;
}

function DocumentBasedSingleton(){
}

_ = DocumentBasedSingleton_0.prototype = DocumentBasedSingleton.prototype = new Object_0;
_.addListener = function addListener_7(listener){
  $add_31(this.listeners, dynamicCast(listener, 358));
}
;
_.getClass$ = function getClass_1086(){
  return Lorg_waveprotocol_wave_model_adt_docbased_DocumentBasedSingleton_2_classLit;
}
;
_.onElementAdded = function onElementAdded_4(newElement){
  $onElementAdded_3(this, dynamicCast(newElement, 260));
}
;
_.onElementRemoved = function onElementRemoved_4(removedElement){
  $onElementRemoved(this, dynamicCast(removedElement, 260));
}
;
_.removeListener = function removeListener_7(listener){
  $remove_42(this.listeners, dynamicCast(listener, 358));
}
;
_.castableTypeMap$ = {434:1};
_.container = null;
_.currentElement = null;
_.currentValue = null;
_.router = null;
_.valueTagName = null;
function $get_25(this$static, name_0){
  var valueStr;
  valueStr = this$static.document_0.getAttribute_0(this$static.element, name_0.toString$());
  return valueStr != null?valueStr:null;
}

function $triggerOnDeleted(this$static){
  var listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    dynamicCast(listener$iterator.next_0(), 359);
  }
}

function $triggerOnValuesChanged(this$static, oldValues){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 359);
    $triggerOnAnchorChanged(listener.this$0, oldValues);
  }
}

function DocumentBasedStructuredValue_0(document_0, element, serializer, keyClass){
  this.listeners = ($clinit_2326() , $clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
  this.document_0 = document_0;
  this.element = element;
  this.keyClass = keyClass;
}

function create_54(router, element, serializer, keyClass){
  var value;
  value = new DocumentBasedStructuredValue_0(router.getDocument_0(), element, serializer, keyClass);
  router.addAttributeListener(element, value);
  router.addDeletionListener(element, value);
  return value;
}

function DocumentBasedStructuredValue(){
}

_ = DocumentBasedStructuredValue_0.prototype = DocumentBasedStructuredValue.prototype = new Object_0;
_.addListener = function addListener_8(listener){
  $add_31(this.listeners, dynamicCast(listener, 359));
}
;
_.getClass$ = function getClass_1087(){
  return Lorg_waveprotocol_wave_model_adt_docbased_DocumentBasedStructuredValue_2_classLit;
}
;
_.onAttributesChanged = function onAttributesChanged_0(element, oldValues, newValues){
  var name_0, name$index, name$max, names, newFields, newValue, newValueStr, oldFields, oldValue, oldValueStr;
  oldFields = ($clinit_2309() , new HashMap_0);
  newFields = new HashMap_0;
  names = dynamicCast($getEnumConstants(this.keyClass), 170);
  for (name$index = 0 , name$max = names.length; name$index < name$max; ++name$index) {
    name_0 = names[name$index];
    if (oldValues.map.containsKey(name_0.toString$()) || newValues.map.containsKey(name_0.toString$())) {
      oldValueStr = dynamicCast(oldValues.map.get(name_0.toString$()), 1);
      newValueStr = dynamicCast(newValues.map.get(name_0.toString$()), 1);
      oldValue = oldValueStr != null?oldValueStr:null;
      newValue = newValueStr != null?newValueStr:null;
      if (oldValue == null?newValue != null:!$equals_3(oldValue, newValue)) {
        oldFields.put(name_0, oldValue);
        newFields.put(name_0, newValue);
      }
    }
  }
  oldFields.size_1() == 0 || $triggerOnValuesChanged(this, oldFields);
}
;
_.onDeleted = function onDeleted(){
  $triggerOnDeleted(this);
}
;
_.removeListener = function removeListener_8(listener){
  $remove_42(this.listeners, dynamicCast(listener, 359));
}
;
_.castableTypeMap$ = {433:1, 435:1};
_.document_0 = null;
_.element = null;
_.keyClass = null;
function buildAttributes(initialState, initializerFactory){
  var attrs;
  attrs = ($clinit_2309() , new HashMap_0);
  initializerFactory.createInitializer(initialState).initialize(attrs);
  return attrs;
}

function initialiseAttribute(target, key, value){
  target.containsKey(key) && illegalArgument("Duplicate initialiser key '" + key + "' in initialiser");
  target.put(key, value);
}

function $equals_9(this$static, obj){
  var other;
  if (this$static === obj) {
    return true;
  }
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[360])) {
    return false;
  }
  other = dynamicCast(obj, 360);
  return $equals_16(this$static.anchor, other.anchor);
}

function AnchorData_0(conversationId, blipId){
  this.anchor = new Pair_0(conversationId, blipId);
}

function AnchorData(){
}

_ = AnchorData_0.prototype = AnchorData.prototype = new Object_0;
_.equals$ = function equals_44(obj){
  return $equals_9(this, obj);
}
;
_.getClass$ = function getClass_1088(){
  return Lorg_waveprotocol_wave_model_conversation_AnchorData_2_classLit;
}
;
_.hashCode$ = function hashCode_43(){
  return $hashCode_14(this.anchor);
}
;
_.castableTypeMap$ = {360:1};
_.anchor = null;
function depthFirst_0(p, conversation){
  var $e0;
  try {
    $apply_27(new BlipMappers$DepthFirst_0(p), conversation.rootThread);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (!instanceOf($e0, 361))
      throw $e0;
  }
}

function depthFirst_1(p, thread){
  var $e0;
  try {
    $apply_27(new BlipMappers$DepthFirst_0(p), thread);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (!instanceOf($e0, 361))
      throw $e0;
  }
}

function depthFirst_2(p, blip){
  var $e0;
  try {
    $apply_28(new BlipMappers$DepthFirst_0(p), blip);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (!instanceOf($e0, 361))
      throw $e0;
  }
}

function $apply_27(this$static, thread){
  var blip, blip$iterator, manifestBlips, result;
  for (blip$iterator = $iterator_13((manifestBlips = thread.manifestThread.blips.orderedValues , new WaveletBasedConversationThread$1_0(thread, manifestBlips))); blip$iterator.next != null;) {
    blip = dynamicCast((result = blip$iterator.next , $advance(blip$iterator) , result), 247);
    $apply_28(this$static, blip);
  }
}

function $apply_28(this$static, blip){
  var thread, thread$iterator, manifestBlips, result;
  if (!this$static.p.apply_11(blip)) {
    throw $clinit_1715() , INSTANCE_11;
  }
  for (thread$iterator = $iterator_12((manifestBlips = blip.manifestBlip.replies.orderedValues , new WaveletBasedConversationBlip$2_0(blip, manifestBlips))); thread$iterator.next != null;) {
    thread = dynamicCast((result = thread$iterator.next , $advance(thread$iterator) , result), 248);
    $apply_27(this$static, thread);
  }
}

function BlipMappers$DepthFirst_0(p){
  this.p = p;
}

function BlipMappers$DepthFirst(){
}

_ = BlipMappers$DepthFirst_0.prototype = BlipMappers$DepthFirst.prototype = new Object_0;
_.getClass$ = function getClass_1089(){
  return Lorg_waveprotocol_wave_model_conversation_BlipMappers$DepthFirst_2_classLit;
}
;
_.castableTypeMap$ = {};
_.p = null;
function $clinit_1715(){
  $clinit_1715 = nullMethod;
  INSTANCE_11 = new BlipMappers$Exit_0;
}

function BlipMappers$Exit_0(){
  this.fillInStackTrace();
}

function BlipMappers$Exit(){
}

_ = BlipMappers$Exit_0.prototype = BlipMappers$Exit.prototype = new RuntimeException;
_.getClass$ = function getClass_1090(){
  return Lorg_waveprotocol_wave_model_conversation_BlipMappers$Exit_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 21:1, 39:1, 183:1, 361:1};
var INSTANCE_11;
function $clinit_1716(){
  $clinit_1716 = nullMethod;
  $clinit_2135();
  checkNotNull_1('body', 'Top level tag name must not be null');
  topLevelContainerTagname = 'body';
  $add_13(lineContainerTagnames, 'body');
  INITIAL_HEAD = new XmlStringBuilderDoc_0(null, ($clinit_2011() , ANY));
  INITIAL_BODY = $wrap_2($wrap_2(new XmlStringBuilderDoc_0(null, ANY), 'line'), 'body');
  INITIAL_CONTENT = $append_19($append_19(new XmlStringBuilderDoc_0(null, ANY), INITIAL_HEAD), INITIAL_BODY);
}

var INITIAL_BODY, INITIAL_CONTENT, INITIAL_HEAD;
function $equals_10(this$static, obj){
  var other;
  if (this$static === obj) {
    return true;
  }
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[362])) {
    return false;
  }
  other = dynamicCast(obj, 362);
  return $equals_16(this$static.anchor, other.anchor);
}

function Conversation$Anchor_0(conversation, blip){
  checkNotNull_1(conversation, 'anchor conversation cannot be null');
  checkNotNull_1(blip, 'anchro blip cannot be null');
  this.anchor = new Pair_0(conversation, blip);
}

function Conversation$Anchor(){
}

_ = Conversation$Anchor_0.prototype = Conversation$Anchor.prototype = new Object_0;
_.equals$ = function equals_45(obj){
  return $equals_10(this, obj);
}
;
_.getClass$ = function getClass_1091(){
  return Lorg_waveprotocol_wave_model_conversation_Conversation$Anchor_2_classLit;
}
;
_.hashCode$ = function hashCode_44(){
  return $hashCode_14(this.anchor);
}
;
_.castableTypeMap$ = {362:1};
_.anchor = null;
function $clinit_1723(){
  $clinit_1723 = nullMethod;
  FACTORY_0 = new DocumentBasedManifest$1_0;
}

function $getAnchor(this$static){
  return new AnchorData_0($get_25(this$static.anchor, ($clinit_1727() , WAVELET)), $get_25(this$static.anchor, BLIP_0));
}

function $triggerOnAnchorChanged(this$static, oldValues){
  var l_0, l$iterator, newAnchor, newAnchorBlipId, newAnchorWavelet, oldAnchor, oldAnchorBlipId, oldAnchorWavelet;
  oldAnchorWavelet = oldValues.containsKey(($clinit_1727() , WAVELET))?dynamicCast(oldValues.get(WAVELET), 1):$get_25(this$static.anchor, WAVELET);
  oldAnchorBlipId = oldValues.containsKey(BLIP_0)?dynamicCast(oldValues.get(BLIP_0), 1):$get_25(this$static.anchor, BLIP_0);
  newAnchorWavelet = $get_25(this$static.anchor, WAVELET);
  newAnchorBlipId = $get_25(this$static.anchor, BLIP_0);
  oldAnchor = new AnchorData_0(oldAnchorWavelet, oldAnchorBlipId);
  newAnchor = new AnchorData_0(newAnchorWavelet, newAnchorBlipId);
  if (!$equals_9(oldAnchor, newAnchor)) {
    for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
      l_0 = dynamicCast(l$iterator.next_0(), 364);
      $triggerOnAnchorChanged_0(l_0.this$0, oldAnchor, newAnchor);
    }
  }
}

function DocumentBasedManifest_0(rootThread, anchor){
  $clinit_1723();
  var anchorListener;
  this.listeners = ($clinit_2326() , $clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
  anchorListener = new DocumentBasedManifest$2_0(this);
  this.rootThread = rootThread;
  this.anchor = anchor;
  $add_31(this.anchor.listeners, anchorListener);
}

function DocumentBasedManifest(){
}

_ = DocumentBasedManifest_0.prototype = DocumentBasedManifest.prototype = new Object_0;
_.addListener = function addListener_9(listener){
  $add_31(this.listeners, dynamicCast(listener, 364));
}
;
_.getClass$ = function getClass_1093(){
  return Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifest_2_classLit;
}
;
_.removeListener = function removeListener_9(listener){
  $remove_42(this.listeners, dynamicCast(listener, 364));
}
;
_.castableTypeMap$ = {};
_.anchor = null;
_.rootThread = null;
var FACTORY_0;
function $adapt(router, element){
  var list;
  return $clinit_1723() , checkArgument_3($equals_3(router.getDocument_0().getTagName(element), 'conversation'), 'Invalid manifest top tag %s', initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [router.getDocument_0().getTagName(element)])) , new DocumentBasedManifest_0(new DocumentBasedManifestThread_0((list = new DocumentBasedElementList_0(router, element, 'blip', new DocumentBasedManifestBlip$1_0) , list.router.addChildListener(list.parent_0, list) , $load_2(list) , list), create_48(router, element, ($clinit_2363() , STRING), 'id'), create_48(router, element, BOOLEAN, 'inline')), create_54(router, element, STRING, Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifest$AnchorKey_2_classLit));
}

function $createInitializer(){
  return new DocumentBasedManifest$1$1_0;
}

function DocumentBasedManifest$1_0(){
}

function DocumentBasedManifest$1(){
}

_ = DocumentBasedManifest$1_0.prototype = DocumentBasedManifest$1.prototype = new Object_0;
_.adapt = function adapt(router, element){
  return $adapt(router, dynamicCast(element, 260));
}
;
_.createInitializer = function createInitializer(initialState){
  return $createInitializer(throwClassCastExceptionUnlessNull(initialState));
}
;
_.getClass$ = function getClass_1094(){
  return Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifest$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function DocumentBasedManifest$1$1_0(){
}

function DocumentBasedManifest$1$1(){
}

_ = DocumentBasedManifest$1$1_0.prototype = DocumentBasedManifest$1$1.prototype = new Object_0;
_.getClass$ = function getClass_1095(){
  return Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifest$1$1_2_classLit;
}
;
_.initialize = function initialize_1(target){
}
;
_.castableTypeMap$ = {18:1};
function DocumentBasedManifest$2_0(this$0){
  this.this$0 = this$0;
}

function DocumentBasedManifest$2(){
}

_ = DocumentBasedManifest$2_0.prototype = DocumentBasedManifest$2.prototype = new Object_0;
_.getClass$ = function getClass_1096(){
  return Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifest$2_2_classLit;
}
;
_.onDeleted = function onDeleted_0(){
}
;
_.castableTypeMap$ = {359:1, 435:1};
_.this$0 = null;
function $clinit_1727(){
  $clinit_1727 = nullMethod;
  WAVELET = new DocumentBasedManifest$AnchorKey$1_0;
  BLIP_0 = new DocumentBasedManifest$AnchorKey$2_0;
  $VALUES_56 = initValues(_3Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifest$AnchorKey_2_classLit, {9:1, 68:1, 170:1}, 135, [WAVELET, BLIP_0]);
}

function valueOf_63(name_0){
  $clinit_1727();
  return valueOf_0(($clinit_1730() , $MAP_56), name_0);
}

function values_57(){
  $clinit_1727();
  return $VALUES_56;
}

function DocumentBasedManifest$AnchorKey(){
}

_ = DocumentBasedManifest$AnchorKey.prototype = new Enum;
_.getClass$ = function getClass_1097(){
  return Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifest$AnchorKey_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 135:1};
var $VALUES_56, BLIP_0, WAVELET;
function DocumentBasedManifest$AnchorKey$1_0(){
  this.name_1 = 'WAVELET';
  this.ordinal = 0;
}

function DocumentBasedManifest$AnchorKey$1(){
}

_ = DocumentBasedManifest$AnchorKey$1_0.prototype = DocumentBasedManifest$AnchorKey$1.prototype = new DocumentBasedManifest$AnchorKey;
_.getClass$ = function getClass_1098(){
  return Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifest$AnchorKey$1_2_classLit;
}
;
_.toString$ = function toString_82(){
  return 'anchorWavelet';
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 135:1};
function DocumentBasedManifest$AnchorKey$2_0(){
  this.name_1 = 'BLIP';
  this.ordinal = 1;
}

function DocumentBasedManifest$AnchorKey$2(){
}

_ = DocumentBasedManifest$AnchorKey$2_0.prototype = DocumentBasedManifest$AnchorKey$2.prototype = new DocumentBasedManifest$AnchorKey;
_.getClass$ = function getClass_1099(){
  return Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifest$AnchorKey$2_2_classLit;
}
;
_.toString$ = function toString_83(){
  return 'anchorBlip';
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 135:1};
function $clinit_1730(){
  $clinit_1730 = nullMethod;
  $MAP_56 = createValueOfMap(($clinit_1727() , $VALUES_56));
}

var $MAP_56;
function $triggerOnManifestThreadAdded(this$static, entry){
  var l_0, l$iterator, convThread;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 366);
    convThread = $adaptThread(l_0, entry);
    $triggerOnReplyAdded(l_0, convThread);
  }
}

function $triggerOnManifestThreadRemoved(this$static, entry){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 366);
    $forgetThread(l_0, dynamicCast(l_0.replies.get_4(dynamicCast($get_22(entry.id_0), 1)), 367));
  }
}

function DocumentBasedManifestBlip_0(replies, id){
  var repliesListener;
  this.listeners = ($clinit_2326() , $clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
  repliesListener = new DocumentBasedManifestBlip$2_0(this);
  this.replies = replies;
  $add_31(this.replies.listeners, repliesListener);
  this.id_0 = id;
}

function DocumentBasedManifestBlip(){
}

_ = DocumentBasedManifestBlip_0.prototype = DocumentBasedManifestBlip.prototype = new Object_0;
_.addListener = function addListener_10(listener){
  $add_31(this.listeners, dynamicCast(listener, 366));
}
;
_.getClass$ = function getClass_1100(){
  return Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifestBlip_2_classLit;
}
;
_.getId = function getId_20(){
  return dynamicCast($get_22(this.id_0), 1);
}
;
_.removeListener = function removeListener_10(listener){
  $remove_42(this.listeners, dynamicCast(listener, 366));
}
;
_.toString$ = function toString_84(){
  return Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifestBlip_2_classLit.typeName + '(id = ' + dynamicCast($get_22(this.id_0), 1) + ')';
}
;
_.castableTypeMap$ = {369:1, 379:1};
_.id_0 = null;
_.replies = null;
function DocumentBasedManifestBlip$1_0(){
}

function DocumentBasedManifestBlip$1(){
}

_ = DocumentBasedManifestBlip$1_0.prototype = DocumentBasedManifestBlip$1.prototype = new Object_0;
_.adapt = function adapt_0(router, element){
  var list;
  return new DocumentBasedManifestBlip_0((list = new DocumentBasedElementList_0(router, element, 'thread', new DocumentBasedManifestThread$1_0) , list.router.addChildListener(list.parent_0, list) , $load_2(list) , list), create_48(router, element, ($clinit_2363() , STRING), 'id'));
}
;
_.createInitializer = function createInitializer_0(blipId){
  return createInitialiser(($clinit_2363() , STRING), 'id', dynamicCast(blipId, 1));
}
;
_.getClass$ = function getClass_1101(){
  return Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifestBlip$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function $onValueRemoved(this$static, entry){
  $clear_20(entry.listeners);
  $triggerOnManifestThreadRemoved(this$static.this$0, entry);
}

function DocumentBasedManifestBlip$2_0(this$0){
  this.this$0 = this$0;
}

function DocumentBasedManifestBlip$2(){
}

_ = DocumentBasedManifestBlip$2_0.prototype = DocumentBasedManifestBlip$2.prototype = new Object_0;
_.getClass$ = function getClass_1102(){
  return Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifestBlip$2_2_classLit;
}
;
_.onValueAdded = function onValueAdded(entry){
  $triggerOnManifestThreadAdded(this.this$0, dynamicCast(entry, 365));
}
;
_.onValueRemoved = function onValueRemoved(entry){
  $onValueRemoved(this, dynamicCast(entry, 365));
}
;
_.castableTypeMap$ = {356:1};
_.this$0 = null;
function DocumentBasedManifestBlip$ThreadInitialiser_0(id){
  checkNotNull_1(id, 'Null thread id');
  this.id_0 = id;
  this.isInline = true;
}

function DocumentBasedManifestBlip$ThreadInitialiser(){
}

_ = DocumentBasedManifestBlip$ThreadInitialiser_0.prototype = DocumentBasedManifestBlip$ThreadInitialiser.prototype = new Object_0;
_.equals$ = function equals_46(obj){
  var other;
  if (this === obj) {
    return true;
  }
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[368])) {
    return false;
  }
  other = dynamicCast(obj, 368);
  return $equals_3(this.id_0, other.id_0) && this.isInline == other.isInline;
}
;
_.getClass$ = function getClass_1103(){
  return Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifestBlip$ThreadInitialiser_2_classLit;
}
;
_.hashCode$ = function hashCode_45(){
  return getHashCode_0(this.id_0) * 37 + (($clinit_428() , this.isInline?TRUE_0:FALSE_0).value_0?1231:1237);
}
;
_.castableTypeMap$ = {368:1};
_.id_0 = null;
_.isInline = false;
function $triggerOnManifestBlipAdded(this$static, entry){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 370);
    $onBlipAdded(l_0, entry);
  }
}

function $triggerOnManifestBlipRemoved(this$static, entry){
  var l_0, l$iterator, blipToRemove, idToRemove_0;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 370);
    blipToRemove = dynamicCast(l_0.blips.get_4(dynamicCast($get_22(entry.id_0), 1)), 373);
    !!blipToRemove && (idToRemove_0 = dynamicCast($get_22(blipToRemove.manifestBlip.id_0), 1) , l_0.blips.remove_8(idToRemove_0) , $triggerOnDeleted_0(blipToRemove) , undefined);
  }
}

function DocumentBasedManifestThread_0(blips, id, inline){
  var blipListListener;
  this.listeners = ($clinit_2326() , $clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
  blipListListener = new DocumentBasedManifestThread$2_0(this);
  this.blips = blips;
  $add_31(this.blips.listeners, blipListListener);
  this.id_0 = id;
  this.inline = inline;
}

function DocumentBasedManifestThread(){
}

_ = DocumentBasedManifestThread_0.prototype = DocumentBasedManifestThread.prototype = new Object_0;
_.addListener = function addListener_11(listener){
  $add_31(this.listeners, dynamicCast(listener, 370));
}
;
_.getClass$ = function getClass_1104(){
  return Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifestThread_2_classLit;
}
;
_.getId = function getId_21(){
  return dynamicCast($get_22(this.id_0), 1);
}
;
_.removeListener = function removeListener_11(listener){
  $remove_42(this.listeners, dynamicCast(listener, 370));
}
;
_.toString$ = function toString_85(){
  return Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifestThread_2_classLit.typeName + '(id = ' + dynamicCast($get_22(this.id_0), 1) + ', inline = ' + $get_22(this.inline) + ')';
}
;
_.castableTypeMap$ = {365:1, 379:1};
_.blips = null;
_.id_0 = null;
_.inline = null;
function $createInitializer_1(initialState){
  return new CompoundInitializer_0(initValues(_3Lorg_waveprotocol_wave_model_adt_docbased_Initializer_2_classLit, {9:1, 68:1}, 18, [createInitialiser(($clinit_2363() , STRING), 'id', initialState.id_0), createInitialiser(BOOLEAN, 'inline', initialState.isInline?($clinit_428() , $clinit_428() , TRUE_0):null)]));
}

function DocumentBasedManifestThread$1_0(){
}

function DocumentBasedManifestThread$1(){
}

_ = DocumentBasedManifestThread$1_0.prototype = DocumentBasedManifestThread$1.prototype = new Object_0;
_.adapt = function adapt_1(router, element){
  var list;
  return new DocumentBasedManifestThread_0((list = new DocumentBasedElementList_0(router, element, 'blip', new DocumentBasedManifestBlip$1_0) , list.router.addChildListener(list.parent_0, list) , $load_2(list) , list), create_48(router, element, ($clinit_2363() , STRING), 'id'), create_48(router, element, BOOLEAN, 'inline'));
}
;
_.createInitializer = function createInitializer_1(initialState){
  return $createInitializer_1(dynamicCast(initialState, 368));
}
;
_.getClass$ = function getClass_1105(){
  return Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifestThread$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function $onValueRemoved_0(this$static, entry){
  $clear_20(entry.listeners);
  $triggerOnManifestBlipRemoved(this$static.this$0, entry);
}

function DocumentBasedManifestThread$2_0(this$0){
  this.this$0 = this$0;
}

function DocumentBasedManifestThread$2(){
}

_ = DocumentBasedManifestThread$2_0.prototype = DocumentBasedManifestThread$2.prototype = new Object_0;
_.getClass$ = function getClass_1106(){
  return Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifestThread$2_2_classLit;
}
;
_.onValueAdded = function onValueAdded_0(entry){
  $triggerOnManifestBlipAdded(this.this$0, dynamicCast(entry, 369));
}
;
_.onValueRemoved = function onValueRemoved_0(entry){
  $onValueRemoved_0(this, dynamicCast(entry, 369));
}
;
_.castableTypeMap$ = {356:1};
_.this$0 = null;
function $createContainer_0(this$static, wavelet){
  var container, conversation, manifestContainer, manifestDoc, router;
  manifestDoc = $getDocument_5(wavelet, 'conversation');
  router = new DefaultDocEventRouter_0(manifestDoc);
  manifestContainer = create_53(router, dynamicCast(manifestDoc.getDocumentElement(), 260), ($clinit_1723() , FACTORY_0));
  container = new WaveBasedConversationView$ConversationContainer_0(this$static, wavelet, manifestContainer);
  $add_31(manifestContainer.listeners, container);
  this$static.containers.put_0(wavelet, container);
  conversation = (!container.conversation && !!container.manifestContainer.currentElement && (container.conversation = create_56(container.this$0, container.wavelet, $get_24(container.manifestContainer), container.this$0.idGenerator)) , container.conversation);
  if (conversation) {
    this$static.conversations.put(wavelet, conversation);
    $triggerOnConversationAdded(this$static, conversation);
  }
  return container;
}

function $getConversation(this$static, id){
  var wavelet, tokens, tokens_0;
  $equals_3((tokens = $split_0(($clinit_2178() , DEFAULT_ESCAPER), id.id_0) , tokens.length > 1?tokens[0]:''), 'conv') || $isEmpty_1((tokens_0 = $split_0(DEFAULT_ESCAPER, id.id_0) , tokens_0.length > 1?tokens_0[0]:'')) || illegalArgument('Wavelet id ' + id + ' is not conversational');
  wavelet = dynamicCast(this$static.waveView.wavelets.get(id), 262);
  if (wavelet) {
    return dynamicCast(this$static.conversations.get(wavelet), 371);
  }
  return null;
}

function $getRoot(this$static){
  var rootWavelet;
  rootWavelet = $getRoot_0(this$static.waveView);
  return rootWavelet?dynamicCast(this$static.conversations.get(rootWavelet), 371):null;
}

function $triggerOnConversationAdded(this$static, conversation){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 372);
    l_0.onConversationAdded(conversation);
  }
}

function $triggerOnConversationRemoved(this$static, conversation){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 372);
    l_0.onConversationRemoved(conversation);
  }
}

function WaveBasedConversationView_0(waveView, idGenerator){
  var wavelet, wavelet$iterator, outerIter;
  this.containers = ($clinit_2309() , defaultCollectionFactory.createIdentityMap());
  this.conversations = new HashMap_0;
  this.listeners = ($clinit_2326() , $clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
  this.waveView = waveView;
  this.idGenerator = idGenerator;
  for (wavelet$iterator = (outerIter = $values(waveView.wavelets).val$entrySet.iterator_0() , new AbstractMap$2$1_0(outerIter)); wavelet$iterator.val$outerIter.hasNext();) {
    wavelet = dynamicCast(dynamicCast(wavelet$iterator.val$outerIter.next_0(), 11).getValue(), 262);
    isConversationalId(wavelet.wavelet.id_0) && $createContainer_0(this, wavelet);
  }
}

function create_55(waveView, idGenerator){
  var convView;
  $serialiseWaveId(waveView.waveId);
  convView = new WaveBasedConversationView_0(waveView, idGenerator);
  $add_31(waveView.listeners, convView);
  return convView;
}

function WaveBasedConversationView(){
}

_ = WaveBasedConversationView_0.prototype = WaveBasedConversationView.prototype = new Object_0;
_.addListener = function addListener_12(listener){
  $add_31(this.listeners, dynamicCast(listener, 372));
}
;
_.getClass$ = function getClass_1107(){
  return Lorg_waveprotocol_wave_model_conversation_WaveBasedConversationView_2_classLit;
}
;
_.onWaveletAdded = function onWaveletAdded_0(wavelet){
  isConversationalId(wavelet.wavelet.id_0) && $createContainer_0(this, wavelet);
}
;
_.removeListener = function removeListener_12(listener){
  $remove_42(this.listeners, dynamicCast(listener, 372));
}
;
_.castableTypeMap$ = {481:1};
_.idGenerator = null;
_.waveView = null;
function $onValueChanged(this$static, oldValue, newValue){
  if (oldValue) {
    this$static.this$0.conversations.remove_3(this$static.wavelet);
    $destroy_1(this$static.conversation);
    $triggerOnConversationRemoved(this$static.this$0, this$static.conversation);
    this$static.conversation = null;
  }
  if (newValue) {
    this$static.conversation = create_56(this$static.this$0, this$static.wavelet, newValue, this$static.this$0.idGenerator);
    this$static.this$0.conversations.put(this$static.wavelet, this$static.conversation);
    $triggerOnConversationAdded(this$static.this$0, this$static.conversation);
  }
}

function WaveBasedConversationView$ConversationContainer_0(this$0, wavelet, manifestContainer){
  this.this$0 = this$0;
  this.wavelet = wavelet;
  this.manifestContainer = manifestContainer;
}

function WaveBasedConversationView$ConversationContainer(){
}

_ = WaveBasedConversationView$ConversationContainer_0.prototype = WaveBasedConversationView$ConversationContainer.prototype = new Object_0;
_.getClass$ = function getClass_1108(){
  return Lorg_waveprotocol_wave_model_conversation_WaveBasedConversationView$ConversationContainer_2_classLit;
}
;
_.castableTypeMap$ = {358:1};
_.conversation = null;
_.manifestContainer = null;
_.this$0 = null;
_.wavelet = null;
function $destroy_1(this$static){
  checkState_2(this$static.isUsable, 'Cannot use destroyed conversation');
  $remove_42(this$static.wavelet.listeners, this$static.waveletListener);
  $remove_42(this$static.manifest.listeners, this$static.manifestListener);
  $clear_20(this$static.listeners);
  $clear_20(this$static.anchorListeners);
  $destroy_3(this$static.rootThread);
  this$static.isUsable = false;
}

function $getAnchorWaveletId(this$static){
  var anchorWaveletId;
  anchorWaveletId = dynamicCast($getAnchor(this$static.manifest).anchor.first, 1);
  return $fromString(($clinit_2183() , anchorWaveletId));
}

function $isValidAnchor(this$static, waveletId, blipId){
  var conversation, isValid;
  isValid = false;
  if (!!waveletId && blipId != null) {
    conversation = $getConversation(this$static.wave, waveletId);
    !!conversation && (isValid = !!dynamicCast(conversation.blips.get_4(blipId), 373));
  }
  return isValid;
}

function $maybeMakeAnchor(this$static, waveletId, blipId){
  var anchor, anchorBlip, anchorConversation;
  anchor = null;
  if ($isValidAnchor(this$static, waveletId, blipId)) {
    anchorConversation = $getConversation(this$static.wave, waveletId);
    anchorBlip = dynamicCast(anchorConversation.blips.get_4(blipId), 373);
    anchor = new Conversation$Anchor_0(anchorConversation, anchorBlip);
  }
  return anchor;
}

function $observe_0(this$static, blip){
  var thread, thread$iterator, manifestBlips, result;
  this$static.blips.put_3(dynamicCast($get_22(blip.manifestBlip.id_0), 1), blip);
  $add_31(blip.listeners, new WaveletBasedConversation$BlipListenerAggregator_0(this$static, blip));
  for (thread$iterator = $iterator_12((manifestBlips = blip.manifestBlip.replies.orderedValues , new WaveletBasedConversationBlip$2_0(blip, manifestBlips))); thread$iterator.next != null;) {
    thread = dynamicCast((result = thread$iterator.next , $advance(thread$iterator) , result), 367);
    $observe_1(this$static, thread);
  }
}

function $observe_1(this$static, thread){
  var blip, blip$iterator, manifestBlips, result;
  this$static.threads.put_3(thread == thread.helper.this$0.rootThread?'':dynamicCast($get_22(thread.manifestThread.id_0), 1), thread);
  $add_31(thread.listeners, new WaveletBasedConversation$ThreadListenerAggregator_0(this$static, thread));
  for (blip$iterator = $iterator_13((manifestBlips = thread.manifestThread.blips.orderedValues , new WaveletBasedConversationThread$1_0(thread, manifestBlips))); blip$iterator.next != null;) {
    blip = dynamicCast((result = blip$iterator.next , $advance(blip$iterator) , result), 373);
    $observe_0(this$static, blip);
  }
}

function $triggerOnAnchorChanged_0(this$static, oldMAnchor, newMAnchor){
  var newAnchor, newWaveletId, oldAnchor, oldWaveletId;
  oldWaveletId = $fromString(($clinit_2183() , dynamicCast(oldMAnchor.anchor.first, 1)));
  newWaveletId = $fromString(dynamicCast(newMAnchor.anchor.first, 1));
  oldAnchor = $maybeMakeAnchor(this$static, oldWaveletId, dynamicCast(oldMAnchor.anchor.second, 1));
  newAnchor = $maybeMakeAnchor(this$static, newWaveletId, dynamicCast(newMAnchor.anchor.second, 1));
  $triggerOnAnchorChanged_1(this$static, oldAnchor, newAnchor);
}

function $triggerOnAnchorChanged_1(this$static, oldAnchor, newAnchor){
  var l_0, l$iterator;
  if (!oldAnchor?!!newAnchor:!$equals_10(oldAnchor, newAnchor)) {
    for (l$iterator = $iterator_20(this$static.anchorListeners); l$iterator.hasNext();) {
      l_0 = dynamicCast(l$iterator.next_0(), 375);
      $onAnchorChanged(l_0, oldAnchor, newAnchor);
    }
  }
}

function $triggerOnBlipAdded(this$static, blip){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 374);
    l_0.onBlipAdded(blip);
  }
}

function $triggerOnBlipContributorAdded(this$static, blip, contributor){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 374);
    l_0.onBlipContributorAdded(blip, contributor);
  }
}

function $triggerOnBlipContributorRemoved(this$static, blip, contributor){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 374);
    l_0.onBlipContributorRemoved(blip, contributor);
  }
}

function $triggerOnBlipDeleted(this$static, blip){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 374);
    l_0.onBlipDeleted(blip);
  }
}

function $triggerOnBlipTimestampChanged(this$static, blip, oldTimestamp, newTimestamp){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 374);
    l_0.onBlipTimestampChanged(blip, oldTimestamp, newTimestamp);
  }
}

function $triggerOnParticipantAdded(this$static, participant){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 374);
    l_0.onParticipantAdded(participant);
  }
}

function $triggerOnThreadAdded(this$static, thread){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 374);
    l_0.onThreadAdded(thread);
  }
}

function $triggerOnThreadDeleted(this$static, thread){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 374);
    l_0.onThreadDeleted(thread);
  }
}

function WaveletBasedConversation_0(wave, wavelet, manifest, idGenerator){
  var $e0, e;
  this.waveletListener = new WaveletBasedConversation$1_0(this);
  this.manifestListener = new WaveletBasedConversation$2_0(this);
  this.listeners = ($clinit_2326() , $clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
  this.anchorListeners = new CopyOnWriteSet_0(HASH_SET);
  this.blips = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  this.threads = defaultCollectionFactory.createStringMap();
  checkNotNull_1(wavelet, 'Null wavelet');
  checkNotNull_1(manifest, 'Null conversation manifest');
  this.wave = wave;
  this.wavelet = wavelet;
  this.manifest = manifest;
  this.idGenerator = idGenerator;
  try {
    this.rootThread = create_58(manifest.rootThread, null, new WaveletBasedConversation$ComponentHelper_0(this));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 21)) {
      e = $e0;
      throw new IllegalArgumentException_2('Failed to create conversation on wavelet ' + wavelet.waveId + ' ' + wavelet.wavelet.id_0, e);
    }
     else 
      throw $e0;
  }
}

function create_56(view, wavelet, manifest, idGenerator){
  var conversation;
  conversation = new WaveletBasedConversation_0(view, wavelet, manifest, idGenerator);
  $add_31(wavelet.listeners, conversation.waveletListener);
  $add_31(manifest.listeners, conversation.manifestListener);
  $observe_1(conversation, conversation.rootThread);
  return conversation;
}

function widFor(conversation){
  return $fromString(($clinit_2183() , conversation));
}

function WaveletBasedConversation(){
}

_ = WaveletBasedConversation_0.prototype = WaveletBasedConversation.prototype = new Object_0;
_.addListener = function addListener_13(listener){
  $add_31(this.listeners, dynamicCast(listener, 374));
}
;
_.getClass$ = function getClass_1109(){
  return Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversation_2_classLit;
}
;
_.removeListener = function removeListener_13(listener){
  $remove_42(this.listeners, dynamicCast(listener, 374));
}
;
_.toString$ = function toString_86(){
  return 'WaveletBasedConversation(' + this.wavelet.waveId + this.wavelet.wavelet.id_0 + ')';
}
;
_.castableTypeMap$ = {249:1, 255:1, 371:1};
_.idGenerator = null;
_.isUsable = true;
_.manifest = null;
_.rootThread = null;
_.wave = null;
_.wavelet = null;
function WaveletBasedConversation$1_0(this$0){
  this.this$0 = this$0;
}

function WaveletBasedConversation$1(){
}

_ = WaveletBasedConversation$1_0.prototype = WaveletBasedConversation$1.prototype = new WaveletListenerImpl;
_.getClass$ = function getClass_1110(){
  return Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversation$1_2_classLit;
}
;
_.onParticipantAdded_0 = function onParticipantAdded_4(wavelet, participant){
  $triggerOnParticipantAdded(this.this$0, participant);
}
;
_.castableTypeMap$ = {480:1};
_.this$0 = null;
function WaveletBasedConversation$2_0(this$0){
  this.this$0 = this$0;
}

function WaveletBasedConversation$2(){
}

_ = WaveletBasedConversation$2_0.prototype = WaveletBasedConversation$2.prototype = new Object_0;
_.getClass$ = function getClass_1111(){
  return Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversation$2_2_classLit;
}
;
_.castableTypeMap$ = {364:1};
_.this$0 = null;
function WaveletBasedConversation$BlipListenerAggregator_0(this$0, blip){
  this.this$0 = this$0;
  this.blip = blip;
}

function WaveletBasedConversation$BlipListenerAggregator(){
}

_ = WaveletBasedConversation$BlipListenerAggregator_0.prototype = WaveletBasedConversation$BlipListenerAggregator.prototype = new Object_0;
_.getClass$ = function getClass_1112(){
  return Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversation$BlipListenerAggregator_2_classLit;
}
;
_.castableTypeMap$ = {377:1};
_.blip = null;
_.this$0 = null;
function $createBlip(this$static){
  var blip, doc, newId;
  blip = $createBlip_0(this$static.this$0.wavelet, (newId = $newId(this$static.this$0.idGenerator, 'b') , newId.indexOf('b+') == 0 || newId.indexOf('g+') == 0 || newId.indexOf('*') != -1 && newId.indexOf('m/') != 0 && newId.indexOf('attach+') != 0 && newId.indexOf('spell+') != 0 || illegalState("generated blip id '" + newId + "' is not a blip id") , newId));
  doc = blip.blip.content_0.getMutableDocument();
  doc.insertXml(new Point$El_0(dynamicCast(doc.getDocumentElement(), 376), null), ($clinit_1716() , INITIAL_CONTENT));
  return blip;
}

function WaveletBasedConversation$ComponentHelper_0(this$0){
  this.this$0 = this$0;
}

function WaveletBasedConversation$ComponentHelper(){
}

_ = WaveletBasedConversation$ComponentHelper_0.prototype = WaveletBasedConversation$ComponentHelper.prototype = new Object_0;
_.getClass$ = function getClass_1113(){
  return Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversation$ComponentHelper_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function WaveletBasedConversation$ThreadListenerAggregator_0(this$0, thread){
  this.this$0 = this$0;
  this.thread = thread;
}

function WaveletBasedConversation$ThreadListenerAggregator(){
}

_ = WaveletBasedConversation$ThreadListenerAggregator_0.prototype = WaveletBasedConversation$ThreadListenerAggregator.prototype = new Object_0;
_.getClass$ = function getClass_1114(){
  return Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversation$ThreadListenerAggregator_2_classLit;
}
;
_.castableTypeMap$ = {378:1};
_.this$0 = null;
_.thread = null;
function $adaptThread(this$static, manifestThread){
  var id, thread;
  thread = create_58(manifestThread, this$static, this$static.helper);
  id = thread == thread.helper.this$0.rootThread?'':dynamicCast($get_22(thread.manifestThread.id_0), 1);
  this$static.replies.put_3(id, thread);
  return thread;
}

function $addReplyThread(this$static, location_0){
  var threadId;
  this$static.isUsable || illegalState('Deleted blip is not usable: ' + this$static);
  threadId = ($clinit_2172() , $join_1(($clinit_2178() , DEFAULT_ESCAPER), initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['b', $peekUniqueToken(this$static.helper.this$0.idGenerator)])));
  this$static.blip.blip.content_0.getMutableDocument().with_$(new WaveletBasedConversationBlip$4_0(location_0, threadId));
  dynamicCast($add_28(this$static.manifestBlip.replies, new DocumentBasedManifestBlip$ThreadInitialiser_0(threadId)), 365);
  return dynamicCast(this$static.replies.get_4(threadId), 367);
}

function $destroy_2(this$static){
  var thread, thread$iterator;
  for (thread$iterator = new AbstractList$IteratorImpl_0(valueList(this$static.replies)); thread$iterator.i < thread$iterator.this$0_0.size_1();) {
    thread = dynamicCast($next_4(thread$iterator), 367);
    $destroy_3(thread);
  }
  $invalidate(this$static);
  $clear_20(this$static.listeners);
}

function $forgetThread(this$static, threadToRemove){
  var id;
  id = threadToRemove == threadToRemove.helper.this$0.rootThread?'':dynamicCast($get_22(threadToRemove.manifestThread.id_0), 1);
  this$static.replies.remove_8(id);
  $triggerOnDeleted_1(threadToRemove);
}

function $getReplyThreads(this$static){
  var manifestBlips;
  manifestBlips = this$static.manifestBlip.replies.orderedValues;
  return new WaveletBasedConversationBlip$2_0(this$static, manifestBlips);
}

function $invalidate(this$static){
  this$static.isUsable || illegalState('Deleted blip is not usable: ' + this$static);
  $remove_42(this$static.manifestBlip.listeners, this$static);
  this$static.isUsable = false;
}

function $triggerOnContributorAdded(this$static, contributor){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 377);
    $triggerOnBlipContributorAdded(l_0.this$0, l_0.blip, contributor);
  }
}

function $triggerOnContributorRemoved(this$static, contributor){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 377);
    $triggerOnBlipContributorRemoved(l_0.this$0, l_0.blip, contributor);
  }
}

function $triggerOnDeleted_0(this$static){
  var l_0, l$iterator;
  $remove_42(this$static.helper.this$0.wavelet.listeners, this$static.waveletListener);
  $invalidate(this$static);
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 377);
    $remove_42(l_0.blip.listeners, l_0);
    $triggerOnBlipDeleted(l_0.this$0, l_0.blip);
    l_0.this$0.blips.remove_8(dynamicCast($get_22(l_0.blip.manifestBlip.id_0), 1));
  }
}

function $triggerOnReplyAdded(this$static, reply){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 377);
    $observe_1(l_0.this$0, reply);
    $triggerOnThreadAdded(l_0.this$0, reply);
  }
}

function $triggerOnTimestampModified(this$static, oldTimestamp, newTimestamp){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 377);
    $triggerOnBlipTimestampChanged(l_0.this$0, l_0.blip, oldTimestamp, newTimestamp);
  }
}

function WaveletBasedConversationBlip_0(manifestBlip, blip, thread, helper){
  this.waveletListener = new WaveletBasedConversationBlip$1_0(this);
  this.replies = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  this.listeners = ($clinit_2326() , $clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
  checkNotNull_1(manifestBlip, 'WaveletBasedConversationBlip received null manifest blip');
  !blip && nullPointer('WaveletBasedConversationBlip ' + dynamicCast($get_22(manifestBlip.id_0), 1) + ' received null blip');
  this.manifestBlip = manifestBlip;
  this.blip = blip;
  this.helper = helper;
  this.parentThread = thread;
}

function create_57(manifestBlip, backingBlip, thread, helper){
  var blip, reply, reply$iterator;
  blip = new WaveletBasedConversationBlip_0(manifestBlip, backingBlip, thread, helper);
  for (reply$iterator = new AbstractList$IteratorImpl_0(manifestBlip.replies.orderedValues); reply$iterator.i < reply$iterator.this$0_0.size_1();) {
    reply = dynamicCast($next_4(reply$iterator), 365);
    $adaptThread(blip, reply);
  }
  $add_31(manifestBlip.listeners, blip);
  $add_31(helper.this$0.wavelet.listeners, blip.waveletListener);
  return blip;
}

function WaveletBasedConversationBlip(){
}

_ = WaveletBasedConversationBlip_0.prototype = WaveletBasedConversationBlip.prototype = new Object_0;
_.addListener = function addListener_14(listener){
  $add_31(this.listeners, dynamicCast(listener, 377));
}
;
_.getClass$ = function getClass_1115(){
  return Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversationBlip_2_classLit;
}
;
_.removeListener = function removeListener_14(listener){
  $remove_42(this.listeners, dynamicCast(listener, 377));
}
;
_.toString$ = function toString_87(){
  return 'WaveletBasedConversationBlip(id = ' + dynamicCast($get_22(this.manifestBlip.id_0), 1) + ')';
}
;
_.castableTypeMap$ = {247:1, 256:1, 366:1, 373:1};
_.blip = null;
_.helper = null;
_.isUsable = true;
_.manifestBlip = null;
_.parentThread = null;
function WaveletBasedConversationBlip$1_0(this$0){
  this.this$0 = this$0;
}

function WaveletBasedConversationBlip$1(){
}

_ = WaveletBasedConversationBlip$1_0.prototype = WaveletBasedConversationBlip$1.prototype = new WaveletListenerImpl;
_.getClass$ = function getClass_1116(){
  return Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversationBlip$1_2_classLit;
}
;
_.onBlipContributorAdded_0 = function onBlipContributorAdded_4(wavelet, eventBlip, contributor){
  eventBlip == this.this$0.blip && $triggerOnContributorAdded(this.this$0, contributor);
}
;
_.onBlipContributorRemoved_0 = function onBlipContributorRemoved_4(wavelet, eventBlip, contributor){
  eventBlip == this.this$0.blip && $triggerOnContributorRemoved(this.this$0, contributor);
}
;
_.onBlipTimestampModified = function onBlipTimestampModified_0(wavelet, eventBlip, oldTime, newTime){
  eventBlip == this.this$0.blip && $triggerOnTimestampModified(this.this$0, oldTime, newTime);
}
;
_.castableTypeMap$ = {480:1};
_.this$0 = null;
function $iterator_12(this$static){
  return new WrapperIterator_0(new AbstractList$IteratorImpl_0(this$static.val$manifestBlips), this$static.this$0.replies);
}

function WaveletBasedConversationBlip$2_0(this$0, val$manifestBlips){
  this.this$0 = this$0;
  this.val$manifestBlips = val$manifestBlips;
}

function WaveletBasedConversationBlip$2(){
}

_ = WaveletBasedConversationBlip$2_0.prototype = WaveletBasedConversationBlip$2.prototype = new Object_0;
_.getClass$ = function getClass_1117(){
  return Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversationBlip$2_2_classLit;
}
;
_.iterator_0 = function iterator_23(){
  return new WrapperIterator_0(new AbstractList$IteratorImpl_0(this.val$manifestBlips), this.this$0.replies);
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$manifestBlips = null;
function WaveletBasedConversationBlip$4_0(val$location, val$threadId){
  this.val$location = val$location;
  this.val$threadId = val$threadId;
}

function WaveletBasedConversationBlip$4(){
}

_ = WaveletBasedConversationBlip$4_0.prototype = WaveletBasedConversationBlip$4.prototype = new Object_0;
_.exec_0 = function exec(doc){
  var point;
  point = $locate_0(doc.doc, this.val$location);
  $createElement_1(doc, point, 'reply', singletonMap('id', this.val$threadId));
}
;
_.getClass$ = function getClass_1118(){
  return Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversationBlip$4_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$location = 0;
_.val$threadId = null;
function $appendBlipWithContent(this$static){
  var blip, blipId;
  blip = $createBlip(this$static.helper);
  blipId = blip.blip.id_0;
  dynamicCast($add_28(this$static.manifestThread.blips, blipId), 369);
  return dynamicCast(this$static.blips.get_4(blipId), 373);
}

function $destroy_3(this$static){
  this$static.blips.each_2(new WaveletBasedConversationThread$2_0);
  $invalidate_0(this$static);
  $clear_20(this$static.listeners);
}

function $getBlips(this$static){
  var manifestBlips;
  manifestBlips = this$static.manifestThread.blips.orderedValues;
  return new WaveletBasedConversationThread$1_0(this$static, manifestBlips);
}

function $getId_18(this$static){
  return this$static == this$static.helper.this$0.rootThread?'':dynamicCast($get_22(this$static.manifestThread.id_0), 1);
}

function $invalidate_0(this$static){
  this$static.isUsable || illegalState('Deleted thread is not usable: ' + this$static);
  $remove_42(this$static.manifestThread.listeners, this$static);
  this$static.isUsable = false;
}

function $onBlipAdded(this$static, manifestBlip){
  var blip, convBlip, convBlip_0;
  blip = $getBlip_4(this$static.helper.this$0.wavelet, dynamicCast($get_22(manifestBlip.id_0), 1));
  if (blip) {
    convBlip = (convBlip_0 = create_57(manifestBlip, blip, this$static, this$static.helper) , this$static.blips.put_3(dynamicCast($get_22(manifestBlip.id_0), 1), convBlip_0) , convBlip_0);
    $triggerOnBlipAdded_0(this$static, convBlip);
  }
}

function $triggerOnBlipAdded_0(this$static, blip){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 378);
    $observe_0(l_0.this$0, blip);
    $triggerOnBlipAdded(l_0.this$0, blip);
  }
}

function $triggerOnDeleted_1(this$static){
  var l_0, l$iterator;
  $invalidate_0(this$static);
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 378);
    $remove_42(l_0.thread.listeners, l_0);
    $triggerOnThreadDeleted(l_0.this$0, l_0.thread);
    l_0.this$0.threads.remove_8($getId_18(l_0.thread));
  }
}

function WaveletBasedConversationThread_0(manifestThread, parentBlip, helper){
  this.blips = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  this.listeners = ($clinit_2326() , $clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
  checkNotNull_1(manifestThread, 'WaveletBasedConversationThread received null manifest thread');
  this.manifestThread = manifestThread;
  this.helper = helper;
  this.parentBlip = parentBlip;
}

function create_58(manifestThread, parentBlip, helper){
  var blip, manifestBlip, manifestBlip$iterator, thread, convBlip;
  thread = new WaveletBasedConversationThread_0(manifestThread, parentBlip, helper);
  for (manifestBlip$iterator = new AbstractList$IteratorImpl_0(manifestThread.blips.orderedValues); manifestBlip$iterator.i < manifestBlip$iterator.this$0_0.size_1();) {
    manifestBlip = dynamicCast($next_4(manifestBlip$iterator), 369);
    blip = $getBlip_4(helper.this$0.wavelet, dynamicCast($get_22(manifestBlip.id_0), 1));
    !!blip && (convBlip = create_57(manifestBlip, blip, thread, thread.helper) , thread.blips.put_3(dynamicCast($get_22(manifestBlip.id_0), 1), convBlip) , convBlip);
  }
  $add_31(manifestThread.listeners, thread);
  return thread;
}

function WaveletBasedConversationThread(){
}

_ = WaveletBasedConversationThread_0.prototype = WaveletBasedConversationThread.prototype = new Object_0;
_.addListener = function addListener_15(listener){
  $add_31(this.listeners, dynamicCast(listener, 378));
}
;
_.getClass$ = function getClass_1121(){
  return Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversationThread_2_classLit;
}
;
_.removeListener = function removeListener_15(listener){
  $remove_42(this.listeners, dynamicCast(listener, 378));
}
;
_.toString$ = function toString_88(){
  var isInline;
  return 'WaveletBasedConversationThread(id = ' + dynamicCast($get_22(this.manifestThread.id_0), 1) + ', inline = ' + (isInline = dynamicCast($get_22(this.manifestThread.inline), 62) , !!isInline && isInline.value_0) + ')';
}
;
_.castableTypeMap$ = {248:1, 258:1, 367:1, 370:1};
_.helper = null;
_.isUsable = true;
_.manifestThread = null;
_.parentBlip = null;
function $iterator_13(this$static){
  return new WrapperIterator_0(new AbstractList$IteratorImpl_0(this$static.val$manifestBlips), this$static.this$0.blips);
}

function WaveletBasedConversationThread$1_0(this$0, val$manifestBlips){
  this.this$0 = this$0;
  this.val$manifestBlips = val$manifestBlips;
}

function WaveletBasedConversationThread$1(){
}

_ = WaveletBasedConversationThread$1_0.prototype = WaveletBasedConversationThread$1.prototype = new Object_0;
_.getClass$ = function getClass_1122(){
  return Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversationThread$1_2_classLit;
}
;
_.iterator_0 = function iterator_24(){
  return new WrapperIterator_0(new AbstractList$IteratorImpl_0(this.val$manifestBlips), this.this$0.blips);
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$manifestBlips = null;
function WaveletBasedConversationThread$2_0(){
}

function WaveletBasedConversationThread$2(){
}

_ = WaveletBasedConversationThread$2_0.prototype = WaveletBasedConversationThread$2.prototype = new Object_0;
_.apply_1 = function apply_77(key, blip){
  $destroy_2(dynamicCast(blip, 373));
}
;
_.getClass$ = function getClass_1123(){
  return Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversationThread$2_2_classLit;
}
;
_.castableTypeMap$ = {};
function $advance(this$static){
  var nextManifest, nextWrapper;
  while ($hasNext_2(this$static.manifestIterator)) {
    nextManifest = dynamicCast($next_4(this$static.manifestIterator), 379);
    nextWrapper = this$static.wrapperMap.get_4(nextManifest.getId());
    if (nextWrapper != null) {
      this$static.next = nextWrapper;
      return;
    }
  }
  this$static.next = null;
}

function WrapperIterator_0(manifestIterator, wrapperMap){
  this.manifestIterator = manifestIterator;
  this.wrapperMap = wrapperMap;
  $advance(this);
}

function WrapperIterator(){
}

_ = WrapperIterator_0.prototype = WrapperIterator.prototype = new Object_0;
_.getClass$ = function getClass_1124(){
  return Lorg_waveprotocol_wave_model_conversation_WrapperIterator_2_classLit;
}
;
_.hasNext = function hasNext_16(){
  return this.next != null;
}
;
_.next_0 = function next_24(){
  var result;
  return result = this.next , $advance(this) , result;
}
;
_.remove_1 = function remove_53(){
  throw new UnsupportedOperationException_0;
}
;
_.castableTypeMap$ = {};
_.manifestIterator = null;
_.next = null;
_.wrapperMap = null;
function $clinit_1776(){
  $clinit_1776 = nullMethod;
  new AnnotationBehaviour$1_0(($clinit_1778() , META_1));
}

function AnnotationBehaviour$1_0($anonymous0){
  this.family = $anonymous0;
}

function AnnotationBehaviour$1(){
}

_ = AnnotationBehaviour$1_0.prototype = AnnotationBehaviour$1.prototype = new AnnotationBehaviour$DefaultAnnotationBehaviour;
_.getClass$ = function getClass_1125(){
  return Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$1_2_classLit;
}
;
_.replace_0 = function replace_2(inside, outside, type){
  return $clinit_1786() , NEITHER_0;
}
;
_.castableTypeMap$ = {430:1};
function $clinit_1778(){
  $clinit_1778 = nullMethod;
  CONTENT_0 = new AnnotationBehaviour$AnnotationFamily_0('CONTENT', 0);
  META_1 = new AnnotationBehaviour$AnnotationFamily_0('META', 1);
  $VALUES_57 = initValues(_3Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$AnnotationFamily_2_classLit, {9:1, 68:1, 170:1}, 136, [CONTENT_0, META_1]);
}

function AnnotationBehaviour$AnnotationFamily_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_64(name_0){
  $clinit_1778();
  return valueOf_0(($clinit_1779() , $MAP_57), name_0);
}

function values_58(){
  $clinit_1778();
  return $VALUES_57;
}

function AnnotationBehaviour$AnnotationFamily(){
}

_ = AnnotationBehaviour$AnnotationFamily_0.prototype = AnnotationBehaviour$AnnotationFamily.prototype = new Enum;
_.getClass$ = function getClass_1126(){
  return Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$AnnotationFamily_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 136:1};
var $VALUES_57, CONTENT_0, META_1;
function $clinit_1779(){
  $clinit_1779 = nullMethod;
  $MAP_57 = createValueOfMap(($clinit_1778() , $VALUES_57));
}

var $MAP_57;
function $clinit_1780(){
  $clinit_1780 = nullMethod;
  LEFT_4 = new AnnotationBehaviour$BiasDirection_0('LEFT', 0);
  RIGHT_4 = new AnnotationBehaviour$BiasDirection_0('RIGHT', 1);
  NEITHER = new AnnotationBehaviour$BiasDirection_0('NEITHER', 2);
  $VALUES_58 = initValues(_3Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$BiasDirection_2_classLit, {9:1, 68:1, 170:1}, 137, [LEFT_4, RIGHT_4, NEITHER]);
}

function AnnotationBehaviour$BiasDirection_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_65(name_0){
  $clinit_1780();
  return valueOf_0(($clinit_1781() , $MAP_58), name_0);
}

function values_59(){
  $clinit_1780();
  return $VALUES_58;
}

function AnnotationBehaviour$BiasDirection(){
}

_ = AnnotationBehaviour$BiasDirection_0.prototype = AnnotationBehaviour$BiasDirection.prototype = new Enum;
_.getClass$ = function getClass_1127(){
  return Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$BiasDirection_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 137:1};
var $VALUES_58, LEFT_4, NEITHER, RIGHT_4;
function $clinit_1781(){
  $clinit_1781 = nullMethod;
  $MAP_58 = createValueOfMap(($clinit_1780() , $VALUES_58));
}

var $MAP_58;
function $clinit_1782(){
  $clinit_1782 = nullMethod;
  PLAIN_TEXT = new AnnotationBehaviour$ContentType_0('PLAIN_TEXT', 0);
  RICH_TEXT = new AnnotationBehaviour$ContentType_0('RICH_TEXT', 1);
  $VALUES_59 = initValues(_3Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$ContentType_2_classLit, {9:1, 68:1, 170:1}, 138, [PLAIN_TEXT, RICH_TEXT]);
}

function AnnotationBehaviour$ContentType_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_66(name_0){
  $clinit_1782();
  return valueOf_0(($clinit_1783() , $MAP_59), name_0);
}

function values_60(){
  $clinit_1782();
  return $VALUES_59;
}

function AnnotationBehaviour$ContentType(){
}

_ = AnnotationBehaviour$ContentType_0.prototype = AnnotationBehaviour$ContentType.prototype = new Enum;
_.getClass$ = function getClass_1128(){
  return Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$ContentType_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 138:1};
var $VALUES_59, PLAIN_TEXT, RICH_TEXT;
function $clinit_1783(){
  $clinit_1783 = nullMethod;
  $MAP_59 = createValueOfMap(($clinit_1782() , $VALUES_59));
}

var $MAP_59;
function $clinit_1786(){
  $clinit_1786 = nullMethod;
  INSIDE = new AnnotationBehaviour$InheritDirection_0('INSIDE', 0);
  OUTSIDE = new AnnotationBehaviour$InheritDirection_0('OUTSIDE', 1);
  NEITHER_0 = new AnnotationBehaviour$InheritDirection_0('NEITHER', 2);
  $VALUES_61 = initValues(_3Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$InheritDirection_2_classLit, {9:1, 68:1, 170:1}, 140, [INSIDE, OUTSIDE, NEITHER_0]);
}

function AnnotationBehaviour$InheritDirection_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_68(name_0){
  $clinit_1786();
  return valueOf_0(($clinit_1787() , $MAP_61), name_0);
}

function values_62(){
  $clinit_1786();
  return $VALUES_61;
}

function AnnotationBehaviour$InheritDirection(){
}

_ = AnnotationBehaviour$InheritDirection_0.prototype = AnnotationBehaviour$InheritDirection.prototype = new Enum;
_.getClass$ = function getClass_1130(){
  return Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$InheritDirection_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 140:1};
var $VALUES_61, INSIDE, NEITHER_0, OUTSIDE;
function $clinit_1787(){
  $clinit_1787 = nullMethod;
  $MAP_61 = createValueOfMap(($clinit_1786() , $VALUES_61));
}

var $MAP_61;
function $apply_29(openAnnotation){
  throw new IllegalStateException_1('finish() called while annotations are still open: ' + openAnnotation);
}

function AnnotationTree$1_0(){
}

function AnnotationTree$1(){
}

_ = AnnotationTree$1_0.prototype = AnnotationTree$1.prototype = new Object_0;
_.apply_1 = function apply_78(key, openAnnotation){
  $apply_29(dynamicCast(openAnnotation, 382));
}
;
_.getClass$ = function getClass_1131(){
  return Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function AnnotationTree$2_0(this$0, val$start, val$end){
  this.this$0 = this$0;
  this.val$start = val$start;
  this.val$end = val$end;
}

function AnnotationTree$2(){
}

_ = AnnotationTree$2_0.prototype = AnnotationTree$2.prototype = new Object_0;
_.apply_1 = function apply_79(key, value){
  this.this$0.openAnnotations.containsKey_1(key) || $setAnnotation_2(this.this$0.tree, this.val$start, this.val$end, key, value);
}
;
_.getClass$ = function getClass_1132(){
  return Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$end = 0;
_.val$start = 0;
function AnnotationTree$3_0(this$0, val$start, val$end){
  this.this$0 = this$0;
  this.val$start = val$start;
  this.val$end = val$end;
}

function AnnotationTree$3(){
}

_ = AnnotationTree$3_0.prototype = AnnotationTree$3.prototype = new Object_0;
_.apply_4 = function apply_80(key){
  !this.this$0.inheritedAnnotationsForInsertion.containsKey_1(key) && !this.this$0.openAnnotations.containsKey_1(key) && $setAnnotation_2(this.this$0.tree, this.val$start, this.val$end, key, null);
}
;
_.getClass$ = function getClass_1133(){
  return Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$end = 0;
_.val$start = 0;
function AnnotationTree$Notification_0(this$0, start, end, key, value){
  this.this$0 = this$0;
  this.start = start;
  this.end = end;
  this.key = key;
  this.value_0 = value;
}

function AnnotationTree$Notification(){
}

_ = AnnotationTree$Notification_0.prototype = AnnotationTree$Notification.prototype = new Object_0;
_.getClass$ = function getClass_1134(){
  return Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree$Notification_2_classLit;
}
;
_.toString$ = function toString_89(){
  return 'Notification(' + this.start + '-' + this.end + ' ' + this.key + '=' + this.value_0 + ')';
}
;
_.castableTypeMap$ = {381:1};
_.end = 0;
_.key = null;
_.start = 0;
_.this$0 = null;
_.value_0 = null;
function AnnotationTree$OpenAnnotation_0(start, key, value){
  this.start = start;
  this.key = key;
  this.value_0 = value;
}

function AnnotationTree$OpenAnnotation(){
}

_ = AnnotationTree$OpenAnnotation_0.prototype = AnnotationTree$OpenAnnotation.prototype = new Object_0;
_.getClass$ = function getClass_1135(){
  return Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree$OpenAnnotation_2_classLit;
}
;
_.toString$ = function toString_90(){
  return 'PendingAnnotation(' + this.start + ', ' + this.key + ', ' + this.value_0 + ')';
}
;
_.castableTypeMap$ = {382:1};
_.key = null;
_.start = 0;
_.value_0 = null;
function $cleanupKnownKeys(this$static){
  this$static.knownKeys.filter_1(new BasicAnnotationTree$3_0(this$static));
}

function $cleanupLeavesThatHaveBecomeEmpty(this$static){
  var leaf, leaf$iterator, mine, originalParent;
  while (this$static.leavesThatHaveBecomeEmpty.size_0 != 0) {
    mine = this$static.leavesThatHaveBecomeEmpty;
    this$static.leavesThatHaveBecomeEmpty = new ArrayList_0;
    for (leaf$iterator = new AbstractList$IteratorImpl_0(mine); leaf$iterator.i < leaf$iterator.this$0_0.size_1();) {
      leaf = dynamicCast($next_4(leaf$iterator), 383);
      $tryToPropagateFromDyingSubtree(leaf);
      originalParent = leaf.parent_0;
      $tryToCollapse(originalParent);
    }
  }
}

function $collectAllAnnotationsAtRaw(this$static, index, accu){
  var leftLength, node, nodeStart;
  node = this$static.sentinel.left_0;
  nodeStart = 0;
  while (true) {
    accu.putAll_0(node.localMap);
    if (node.type_0 == ($clinit_1819() , LEAF_BLACK)) {
      break;
    }
    leftLength = node.left_0.subtreeLength;
    if (index < nodeStart + leftLength) {
      node = node.left_0;
    }
     else {
      node = node.right;
      nodeStart += leftLength;
    }
  }
}

function $delete_3(this$static, start, end){
  if (start >= end) {
    return;
  }
  $deleteRaw(this$static, start + 1, end + 1);
  $cleanupLeavesThatHaveBecomeEmpty(this$static);
}

function $deleteRaw(this$static, start, end){
  var deletionEnd, deletionLength, deletionStart, node, nodeEnd, nodeStart;
  node = this$static.sentinel.left_0;
  nodeStart = 0;
  outer: while (true) {
    if (end <= nodeStart) {
      return;
    }
    nodeEnd = nodeStart + node.subtreeLength;
    deletionStart = nodeStart > start?nodeStart:start;
    deletionEnd = nodeEnd < end?nodeEnd:end;
    deletionLength = deletionEnd - deletionStart;
    node.subtreeLength -= deletionLength;
    if (node.type_0 == ($clinit_1819() , LEAF_BLACK)) {
      end -= deletionLength;
      node.subtreeLength == 0 && $add_9(this$static.leavesThatHaveBecomeEmpty, node);
    }
     else {
      if (start < nodeStart + node.left_0.subtreeLength) {
        node = node.left_0;
      }
       else {
        nodeStart += node.left_0.subtreeLength;
        node = node.right;
      }
      continue outer;
    }
    while (true) {
      if (node.parent_0.left_0 == node) {
        nodeStart += node.subtreeLength;
        node = node.parent_0.right;
        continue outer;
      }
      nodeStart -= node.parent_0.left_0.subtreeLength;
      node = node.parent_0;
      if (node.parent_0 == node.this$0.sentinel) {
        return;
      }
    }
  }
}

function $differentValue(this$static, notThis, notThat){
  if (!equals__devirtual$(this$static.oneValue, notThis) && !equals__devirtual$(this$static.oneValue, notThat)) {
    return this$static.oneValue;
  }
  if (!equals__devirtual$(this$static.anotherValue, notThis) && !equals__devirtual$(this$static.anotherValue, notThat)) {
    return this$static.anotherValue;
  }
  return null;
}

function $firstAnnotationChange_6(this$static, start, end, key, fromValue){
  var pos;
  if (start >= end) {
    return -1;
  }
  if (!this$static.knownKeys.contains_0(key)) {
    return fromValue == null?-1:start;
  }
  pos = $firstAnnotationChangeRaw(this$static, start + 1, end + 1, key, fromValue);
  if (pos == -1) {
    return -1;
  }
  return pos - 1;
}

function $firstAnnotationChangeRaw(this$static, start, end, key, fromValue){
  var leftNode, node, nodeStart, valueHere, out;
  node = this$static.sentinel.left_0;
  nodeStart = 0;
  outer: while (true) {
    if (nodeStart >= end) {
      return -1;
    }
    if (node.localMap.containsKey_1(key)) {
      valueHere = node.localMap.getExisting(key);
      if (!(valueHere == null?fromValue == null:equals__devirtual$(valueHere, fromValue))) {
        return nodeStart > start?nodeStart:start;
      }
      if (node.parent_0 == node.this$0.sentinel) {
        return -1;
      }
      while (true) {
        if (node.parent_0.left_0 == node) {
          nodeStart += node.subtreeLength;
          node = node.parent_0.right;
          continue outer;
        }
        nodeStart -= node.parent_0.left_0.subtreeLength;
        node = node.parent_0;
        if (node.parent_0 == node.this$0.sentinel) {
          return -1;
        }
      }
    }
    leftNode = node.left_0;
    if (!leftNode) {
      throw new NullPointerException_1('Unexpected null leftNode:\n' + (out = new StringBuilder_0 , $append_11(out, 'AnnotationTree, length ' + (this$static.sentinel.left_0.subtreeLength - 1) + ', sentinel=' + this$static.sentinel + ':\n') , $printForDebugging(this$static.sentinel.left_0, out) , $charAt_0(out, out.impl.string.length - 1) == 10 && $setLength_1(out, out.impl.string.length - 1) , out.impl.string));
    }
    if (start >= nodeStart + leftNode.subtreeLength) {
      nodeStart += leftNode.subtreeLength;
      node = node.right;
    }
     else {
      node = node.left_0;
    }
  }
}

function $fixupMapsAfterSingleRotation(this$static, a_0, b, c, d, e){
  var a0, a1, b0, c0, d0, e0;
  a0 = a_0.localMap;
  b0 = b.localMap;
  c0 = c.localMap;
  d0 = d.localMap;
  e0 = e.localMap;
  a1 = this$static.factory.createStringMap();
  d0.filter_0(new BasicAnnotationTree$1_0(b0, a1));
  c0.each_2(new BasicAnnotationTree$2_0(b0, a1, d0, e0));
  a_0.localMap = a1;
  c.localMap = a0;
}

function $forEachAnnotationAtRaw(this$static, index, callback){
  var leftLength, node, nodeStart;
  node = this$static.sentinel.left_0;
  nodeStart = 0;
  while (true) {
    node.localMap.each_2(callback);
    if (node.type_0 == ($clinit_1819() , LEAF_BLACK)) {
      break;
    }
    leftLength = node.left_0.subtreeLength;
    if (index < nodeStart + leftLength) {
      node = node.left_0;
    }
     else {
      node = node.right;
      nodeStart += leftLength;
    }
  }
}

function $getAnnotation_5(this$static, index, key){
  if (!this$static.knownKeys.contains_0(key)) {
    return null;
  }
  return $getAnnotationRaw(this$static, index + 1, key);
}

function $getAnnotationRaw(this$static, index, key){
  var leftLength, node;
  node = this$static.sentinel.left_0;
  while (true) {
    if (node.localMap.containsKey_1(key)) {
      return node.localMap.getExisting(key);
    }
    leftLength = node.left_0.subtreeLength;
    if (index < leftLength) {
      node = node.left_0;
    }
     else {
      index -= leftLength;
      node = node.right;
    }
  }
}

function $insertRaw(this$static, firstShiftedIndex, length_0){
  var node, nodeStart;
  node = this$static.sentinel.left_0;
  nodeStart = 0;
  while (true) {
    node.subtreeLength += length_0;
    if (node.type_0 == ($clinit_1819() , LEAF_BLACK)) {
      return;
    }
    if (firstShiftedIndex <= nodeStart + node.left_0.subtreeLength) {
      node = node.left_0;
    }
     else {
      nodeStart += node.left_0.subtreeLength;
      node = node.right;
    }
  }
}

function $lastAnnotationChange_5(this$static, start, end, key, fromValue){
  var pos;
  if (start >= end) {
    return -1;
  }
  if (!this$static.knownKeys.contains_0(key)) {
    return fromValue == null?-1:end;
  }
  pos = $lastAnnotationChangeRaw(this$static, start + 1, end + 1, key, fromValue);
  if (pos == -1) {
    return -1;
  }
  return pos - 1;
}

function $lastAnnotationChangeRaw(this$static, start, end, key, fromValue){
  var node, nodeEnd, rightNode, valueHere;
  node = this$static.sentinel.left_0;
  nodeEnd = node.subtreeLength;
  outer: while (true) {
    if (nodeEnd <= start) {
      return -1;
    }
    if (node.localMap.containsKey_1(key)) {
      valueHere = node.localMap.getExisting(key);
      if (!(valueHere == null?fromValue == null:equals__devirtual$(valueHere, fromValue))) {
        return nodeEnd < end?nodeEnd:end;
      }
      if (node.parent_0 == node.this$0.sentinel) {
        return -1;
      }
      while (true) {
        if (node.parent_0.left_0 != node) {
          nodeEnd -= node.subtreeLength;
          node = node.parent_0.left_0;
          continue outer;
        }
        nodeEnd += node.parent_0.right.subtreeLength;
        node = node.parent_0;
        if (node.parent_0 == node.this$0.sentinel) {
          return -1;
        }
      }
    }
    rightNode = node.right;
    if (end <= nodeEnd - rightNode.subtreeLength) {
      nodeEnd -= rightNode.subtreeLength;
      node = node.left_0;
    }
     else {
      node = node.right;
    }
  }
}

function $mapToString(map){
  var buf, first;
  buf = new StringBuilder_2('{');
  first = initValues(_3Z_classLit, {9:1}, -1, [true]);
  map.each_2(new BasicAnnotationTree$6_0(first, buf));
  buf.impl.string += '}';
  return buf.impl.string;
}

function $newLeaf(this$static, subtreeLength){
  return new BasicAnnotationTree$Node_0(this$static, ($clinit_1819() , LEAF_BLACK), subtreeLength, this$static.factory.createStringMap());
}

function $setAnnotation_2(this$static, start, end, key, value){
  var currentStart, end1;
  if (start >= end) {
    return;
  }
  if (!this$static.knownKeys.contains_0(key)) {
    this$static.sentinel.left_0.localMap.put_3(key, null);
    this$static.knownKeys.add_3(key);
  }
  currentStart = start + 1;
  end1 = end + 1;
  do {
    currentStart = $setAnnotationRaw(this$static, currentStart, end1, key, value);
  }
   while (currentStart != -1);
  $cleanupLeavesThatHaveBecomeEmpty(this$static);
}

function $setAnnotationRaw(this$static, start, end, key, value){
  var leafResult, node, nodeEnd, nodeStart;
  node = this$static.sentinel.left_0;
  nodeStart = 0;
  outer: while (true) {
    if (end <= nodeStart) {
      return -1;
    }
    if (!(node.localMap.containsKey_1(key) && equal_0(node.localMap.getExisting(key), value))) {
      nodeEnd = nodeStart + node.subtreeLength;
      if (start <= nodeStart && end >= nodeEnd) {
        $eraseAnnotations(node, nodeStart, key);
        node.localMap.put_3(key, value);
        if ($tryToPropagateFromChildren(node.parent_0, key)) {
          return nodeStart + node.subtreeLength;
        }
      }
       else {
        if (node.type_0 == ($clinit_1819() , LEAF_BLACK)) {
          leafResult = $setAnnotationForLeaf(node, nodeStart, start - nodeStart, end - nodeStart, key, value);
          if (leafResult == -1)
          ;
          else {
            return leafResult;
          }
        }
         else {
          node.localMap.containsKey_1(key) && $pushKeyIntoChildren(node, key);
          if (start < nodeStart + node.left_0.subtreeLength) {
            node = node.left_0;
          }
           else {
            nodeStart += node.left_0.subtreeLength;
            node = node.right;
          }
          continue outer;
        }
      }
    }
    while (true) {
      if (node.parent_0.left_0 == node) {
        nodeStart += node.subtreeLength;
        node = node.parent_0.right;
        continue outer;
      }
      nodeStart -= node.parent_0.left_0.subtreeLength;
      node = node.parent_0;
      if (node.parent_0 == node.this$0.sentinel) {
        return -1;
      }
    }
  }
}

function $tryToPropagateFromDyingSubtree(child){
  var entries, parent_0, sibling;
  parent_0 = child.parent_0;
  while (parent_0.subtreeLength == 0) {
    child = parent_0;
    parent_0 = parent_0.parent_0;
  }
  sibling = child.parent_0.left_0 == child?child.parent_0.right:child.parent_0.left_0;
  entries = sibling.localMap;
  parent_0.localMap.putAll_0(entries);
  $tryToPropagateFromChildren_0(parent_0.parent_0, entries);
  sibling.localMap.clear();
}

function BasicAnnotationTree_0(oneValue, anotherValue){
  var root;
  this.factory = ($clinit_2309() , $clinit_2309() , defaultCollectionFactory);
  this.leavesThatHaveBecomeEmpty = new ArrayList_0;
  this.knownKeys = this.factory.createStringSet();
  this.oneValue = oneValue;
  this.anotherValue = anotherValue;
  root = new BasicAnnotationTree$Node_0(this, ($clinit_1819() , LEAF_BLACK), 1, this.factory.createStringMap());
  this.sentinel = new BasicAnnotationTree$Node_0(this, INTERNAL_BLACK, -1, this.factory.createStringMap());
  this.sentinel.left_0 = root;
  root.parent_0 = this.sentinel;
  this.sentinel.right = new BasicAnnotationTree$Node_0(this, LEAF_BLACK, 0, this.factory.createStringMap());
  this.sentinel.right.parent_0 = this.sentinel;
  this.knownKeys.clear();
}

function BasicAnnotationTree(){
}

_ = BasicAnnotationTree_0.prototype = BasicAnnotationTree.prototype = new Object_0;
_.getClass$ = function getClass_1136(){
  return Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree_2_classLit;
}
;
_.castableTypeMap$ = {};
_.anotherValue = null;
_.knownKeys = null;
_.nextId = 0;
_.oneValue = null;
_.sentinel = null;
function $apply_30(this$static, key, value){
  if (this$static.val$b0.containsKey_1(key) && equal_0(this$static.val$b0.getExisting(key), value)) {
    this$static.val$a1.put_3(key, value);
    this$static.val$b0.remove_8(key);
    return false;
  }
  return true;
}

function BasicAnnotationTree$1_0(val$b0, val$a1){
  this.val$b0 = val$b0;
  this.val$a1 = val$a1;
}

function BasicAnnotationTree$1(){
}

_ = BasicAnnotationTree$1_0.prototype = BasicAnnotationTree$1.prototype = new Object_0;
_.getClass$ = function getClass_1137(){
  return Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$a1 = null;
_.val$b0 = null;
function BasicAnnotationTree$2_0(val$b0, val$a1, val$d0, val$e0){
  this.val$b0 = val$b0;
  this.val$a1 = val$a1;
  this.val$d0 = val$d0;
  this.val$e0 = val$e0;
}

function BasicAnnotationTree$2(){
}

_ = BasicAnnotationTree$2_0.prototype = BasicAnnotationTree$2.prototype = new Object_0;
_.apply_1 = function apply_81(key, value){
  if (this.val$b0.containsKey_1(key) && equal_0(this.val$b0.getExisting(key), value)) {
    this.val$b0.remove_8(key);
    this.val$a1.put_3(key, value);
  }
   else {
    this.val$d0.put_3(key, value);
  }
  this.val$e0.put_3(key, value);
}
;
_.getClass$ = function getClass_1138(){
  return Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$a1 = null;
_.val$b0 = null;
_.val$d0 = null;
_.val$e0 = null;
function $apply_31(this$static, key){
  if (this$static.this$0.sentinel.left_0.localMap.containsKey_1(key) && this$static.this$0.sentinel.left_0.localMap.getExisting(key) == null) {
    this$static.this$0.sentinel.left_0.localMap.remove_8(key);
    return false;
  }
   else {
    return true;
  }
}

function BasicAnnotationTree$3_0(this$0){
  this.this$0 = this$0;
}

function BasicAnnotationTree$3(){
}

_ = BasicAnnotationTree$3_0.prototype = BasicAnnotationTree$3.prototype = new Object_0;
_.getClass$ = function getClass_1139(){
  return Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function BasicAnnotationTree$6_0(val$first, val$buf){
  this.val$first = val$first;
  this.val$buf = val$buf;
}

function BasicAnnotationTree$6(){
}

_ = BasicAnnotationTree$6_0.prototype = BasicAnnotationTree$6.prototype = new Object_0;
_.apply_1 = function apply_82(key, value){
  this.val$first[0]?(this.val$first[0] = false):$append_11(this.val$buf, ', ');
  $append_11(this.val$buf, key + '=' + value);
}
;
_.getClass$ = function getClass_1140(){
  return Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$6_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$buf = null;
_.val$first = null;
function $absoluteFromRelative(this$static, relativeIndex){
  if (this$static == this$static.this$0.sentinel) {
    return relativeIndex;
  }
  return this$static.parent_0.left_0 == this$static?$absoluteFromRelative(this$static.parent_0, relativeIndex):$absoluteFromRelative(this$static.parent_0, relativeIndex + this$static.parent_0.left_0.subtreeLength);
}

function $eraseAnnotations(this$static, nodeStart, key){
  if (this$static.localMap.containsKey_1(key)) {
    this$static.localMap.remove_8(key);
    return;
  }
  $eraseAnnotations(this$static.left_0, nodeStart, key);
  $eraseAnnotations(this$static.right, nodeStart + this$static.left_0.subtreeLength, key);
  $tryToMergeChildren(this$static);
}

function $isLeftChild(this$static){
  return this$static.parent_0.left_0 == this$static;
}

function $pathString(this$static){
  if (this$static.parent_0 == this$static.this$0.sentinel) {
    return '#';
  }
  if (this$static.this$0.sentinel == this$static) {
    return 'S';
  }
  if (!this$static.parent_0) {
    return 'O';
  }
  if (this$static == this$static.parent_0.left_0) {
    return $pathString(this$static.parent_0) + 'l';
  }
  if (this$static == this$static.parent_0.right) {
    return $pathString(this$static.parent_0) + 'r';
  }
  return '<not a child of parent>';
}

function $printForDebugging(this$static, out){
  if (this$static.type_0 == ($clinit_1819() , LEAF_BLACK)) {
    $append_11(out, $toString_23(this$static) + '\n');
  }
   else {
    !this$static.right?(out.impl.string += 'null right?!\n' , out):$printForDebugging(this$static.right, out);
    $append_11(out, $toString_23(this$static) + '\n');
    !this$static.left_0?(out.impl.string += 'null left?!\n' , out):$printForDebugging(this$static.left_0, out);
  }
}

function $pushKeyIntoChildren(this$static, key){
  var value;
  value = this$static.localMap.getExisting(key);
  this$static.left_0.localMap.put_3(key, value);
  this$static.right.localMap.put_3(key, value);
  this$static.localMap.remove_8(key);
}

function $rebalanceAfterInsertion(this$static){
  var g, u;
  if (this$static.parent_0 == this$static.this$0.sentinel) {
    $setRed(this$static, false);
    return;
  }
  if (this$static.parent_0.type_0 != ($clinit_1819() , INTERNAL_RED)) {
    return;
  }
  if (this$static.parent_0.parent_0 == this$static.this$0.sentinel) {
    $setRed(this$static.parent_0, false);
    return;
  }
  g = this$static.parent_0.parent_0;
  u = $sibling(this$static.parent_0);
  if (g != this$static.this$0.sentinel && u.type_0 == INTERNAL_RED) {
    $setRed(this$static.parent_0, false);
    $setRed(u, false);
    $setRed(g, true);
    $rebalanceAfterInsertion(g);
    return;
  }
  if (this$static.parent_0.left_0 != this$static && $isLeftChild(this$static.parent_0)) {
    $rotateL(this$static.parent_0);
    g = this$static.parent_0;
    $setRed(this$static, false);
    $setRed(g, true);
    $rotateR(g);
    return;
  }
   else if (this$static.parent_0.left_0 == this$static && !$isLeftChild(this$static.parent_0)) {
    $rotateR(this$static.parent_0);
    g = this$static.parent_0;
    $setRed(this$static, false);
    $setRed(g, true);
    $rotateL(g);
    return;
  }
  $setRed(this$static.parent_0, false);
  $setRed(g, true);
  if (this$static.parent_0.left_0 == this$static && $isLeftChild(this$static.parent_0)) {
    $rotateR(g);
    return;
  }
   else {
    $rotateL(g);
    return;
  }
}

function $rebalanceAfterRemoval(this$static){
  var s;
  if (this$static.parent_0 == this$static.this$0.sentinel) {
    return;
  }
  s = this$static.parent_0.left_0 == this$static?this$static.parent_0.right:this$static.parent_0.left_0;
  if (s.type_0 == ($clinit_1819() , INTERNAL_RED)) {
    $setRed(this$static.parent_0, true);
    $setRed(s, false);
    this$static.parent_0.left_0 == this$static?$rotateL(this$static.parent_0):$rotateR(this$static.parent_0);
  }
  s = this$static.parent_0.left_0 == this$static?this$static.parent_0.right:this$static.parent_0.left_0;
  if (this$static.parent_0.type_0 != INTERNAL_RED && s.type_0 != INTERNAL_RED && s.left_0.type_0 != INTERNAL_RED && s.right.type_0 != INTERNAL_RED) {
    $setRed(s, true);
    $rebalanceAfterRemoval(this$static.parent_0);
    return;
  }
  if (this$static.parent_0.type_0 == INTERNAL_RED && s.type_0 != INTERNAL_RED && s.left_0.type_0 != INTERNAL_RED && s.right.type_0 != INTERNAL_RED) {
    $setRed(s, true);
    $setRed(this$static.parent_0, false);
    return;
  }
  if (this$static.parent_0.left_0 == this$static) {
    if (s.type_0 != INTERNAL_RED && s.left_0.type_0 == INTERNAL_RED && s.right.type_0 != INTERNAL_RED) {
      $setRed(s, true);
      $setRed(s.left_0, false);
      $rotateR(s);
      s = this$static.parent_0.left_0 == this$static?this$static.parent_0.right:this$static.parent_0.left_0;
    }
    $setRed(s, this$static.parent_0.type_0 == INTERNAL_RED);
    $setRed(this$static.parent_0, false);
    $setRed(s.right, false);
    $rotateL(this$static.parent_0);
  }
   else {
    if (s.type_0 != INTERNAL_RED && s.left_0.type_0 != INTERNAL_RED && s.right.type_0 == INTERNAL_RED) {
      $setRed(s, true);
      $setRed(s.right, false);
      $rotateL(s);
      s = this$static.parent_0.left_0 == this$static?this$static.parent_0.right:this$static.parent_0.left_0;
    }
    $setRed(s, this$static.parent_0.type_0 == INTERNAL_RED);
    $setRed(this$static.parent_0, false);
    $setRed(s.left_0, false);
    $rotateR(this$static.parent_0);
  }
}

function $replaceNodeWithSoleChild(this$static, child){
  child.parent_0.left_0 == child?(this$static.right.parent_0 = null):(this$static.left_0.parent_0 = null);
  child.parent_0 = null;
  $replaceThisNodeWith(this$static, child);
  $tryToMergeChildren(child.parent_0);
  if (this$static.type_0 == ($clinit_1819() , INTERNAL_RED)) {
    return;
  }
  if (child.type_0 == INTERNAL_RED) {
    $setRed(child, false);
    return;
  }
  $rebalanceAfterRemoval(child);
  $tryToMergeChildren(child.parent_0);
}

function $replaceThisNodeWith(this$static, other){
  other.parent_0 = this$static.parent_0;
  this$static.parent_0.left_0 == this$static?(this$static.parent_0.left_0 = other):(this$static.parent_0.right = other);
  this$static.parent_0 = null;
}

function $rotateL(this$static){
  var b, c, d, e, p;
  p = this$static.parent_0;
  b = this$static.left_0;
  c = this$static.right;
  d = c.left_0;
  e = c.right;
  c.parent_0 = null;
  $replaceThisNodeWith(this$static, c);
  this$static.right = d;
  c.left_0 = this$static;
  this$static.parent_0 = c;
  c.parent_0 = p;
  d.parent_0 = this$static;
  this$static.subtreeLength -= e.subtreeLength;
  c.subtreeLength += b.subtreeLength;
  $fixupMapsAfterSingleRotation(this$static.this$0, this$static, b, c, d, e);
  $tryToMergeChildren(this$static);
}

function $rotateR(this$static){
  var b, c, d, e, p;
  p = this$static.parent_0;
  b = this$static.right;
  c = this$static.left_0;
  d = c.right;
  e = c.left_0;
  c.parent_0 = null;
  $replaceThisNodeWith(this$static, c);
  this$static.left_0 = d;
  c.right = this$static;
  this$static.parent_0 = c;
  c.parent_0 = p;
  d.parent_0 = this$static;
  this$static.subtreeLength -= e.subtreeLength;
  c.subtreeLength += b.subtreeLength;
  $fixupMapsAfterSingleRotation(this$static.this$0, this$static, b, c, d, e);
  $tryToMergeChildren(this$static);
}

function $setAnnotationForLeaf(this$static, absoluteNodeStart, start, end, key, value){
  var indexOnRight, newMiddle, newParent, newParent1, newParent2, previousValue, temporaryRight, valueOnRight;
  start = start > 0?start:0;
  end = min_1(end, this$static.subtreeLength);
  if (start >= end) {
    return -1;
  }
  if (equal_0(this$static.localMap.getExisting(key), value)) {
    return -1;
  }
  if (start == 0 && end == this$static.subtreeLength) {
    $eraseAnnotations(this$static, absoluteNodeStart, key);
    this$static.localMap.put_3(key, value);
    return $tryToPropagateFromChildren(this$static.parent_0, key)?absoluteNodeStart + end:-1;
  }
  if (start == 0) {
    newParent = $splitNode(this$static, end);
    $pushKeyIntoChildren(newParent, key);
    $setAnnotationForLeaf(newParent.left_0, absoluteNodeStart, 0, end, key, value);
    $tryToPropagateFromChildren(newParent, key);
    $rebalanceAfterInsertion(newParent);
    return absoluteNodeStart + end;
  }
  if (end == this$static.subtreeLength) {
    newParent = $splitNode(this$static, start);
    $pushKeyIntoChildren(newParent, key);
    $setAnnotationForLeaf(newParent.right, absoluteNodeStart + start, start - start, end - start, key, value);
    $tryToPropagateFromChildren(newParent, key);
    $rebalanceAfterInsertion(newParent);
    return absoluteNodeStart + end;
  }
  previousValue = this$static.localMap.getExisting(key);
  indexOnRight = absoluteNodeStart + this$static.subtreeLength;
  valueOnRight = indexOnRight == this$static.this$0.sentinel.left_0.subtreeLength?null:$getAnnotationRaw(this$static.this$0, indexOnRight, key);
  newParent1 = $splitNode(this$static, start);
  $pushKeyIntoChildren(newParent1, key);
  temporaryRight = newParent1.right;
  temporaryRight.localMap.put_3(key, $differentValue(this$static.this$0, previousValue, valueOnRight));
  $rebalanceAfterInsertion(newParent1);
  temporaryRight.localMap.put_3(key, previousValue);
  newParent2 = $splitNode(temporaryRight, end - start);
  $pushKeyIntoChildren(newParent2, key);
  newMiddle = newParent2.left_0;
  $setAnnotationForLeaf(newMiddle, absoluteNodeStart + start, start - start, end - start, key, value);
  $tryToPropagateFromChildren(newParent2, key);
  $rebalanceAfterInsertion(newParent2);
  return absoluteNodeStart + end;
}

function $setRed(this$static, flag){
  if (this$static.type_0 == ($clinit_1819() , LEAF_BLACK))
  ;
  else {
    this$static.type_0 = flag?INTERNAL_RED:INTERNAL_BLACK;
  }
}

function $sibling(this$static){
  return this$static.parent_0.left_0 == this$static?this$static.parent_0.right:this$static.parent_0.left_0;
}

function $splitNode(this$static, splitIndex){
  var newLeft, newParent, newRight;
  newLeft = $newLeaf(this$static.this$0, splitIndex);
  newRight = $newLeaf(this$static.this$0, this$static.subtreeLength - splitIndex);
  newParent = new BasicAnnotationTree$Node_0(this$static.this$0, ($clinit_1819() , INTERNAL_BLACK), this$static.subtreeLength, this$static.localMap);
  newLeft.parent_0 = newParent;
  newRight.parent_0 = newParent;
  newParent.left_0 = newLeft;
  newParent.right = newRight;
  $setRed(newParent, true);
  $replaceThisNodeWith(this$static, newParent);
  return newParent;
}

function $toString_23(this$static){
  var $e0, rangeString, typeString;
  try {
    rangeString = '' + $absoluteFromRelative(this$static, 0) + '+' + this$static.subtreeLength + '=' + $absoluteFromRelative(this$static, this$static.subtreeLength);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 21)) {
      rangeString = '<RuntimeException computing range; length=' + this$static.subtreeLength + '>';
    }
     else 
      throw $e0;
  }
  switch (this$static.type_0.ordinal) {
    case 2:
      typeString = 'internal, black';
      break;
    case 1:
      typeString = 'internal, red';
      break;
    case 0:
      typeString = 'leaf, black';
      break;
    default:typeString = '<error: invalid node type ' + this$static.type_0 + '>';
  }
  return $pathString(this$static) + ' Node (' + this$static.id_0 + ':' + toPowerOfTwoString(!this$static?0:this$static.$H || (this$static.$H = ++sNextHashId)) + ') ' + rangeString + ' ' + typeString + (this$static == this$static.this$0.sentinel?' (sentinel)':this$static == this$static.this$0.sentinel.left_0?' (root)':'') + ' ' + $mapToString(this$static.localMap);
}

function $tryToCollapse(this$static){
  if (this$static.subtreeLength == 0) {
    $replaceNodeWithSoleChild(this$static, this$static.right);
    return;
  }
  if (this$static.left_0.subtreeLength == 0) {
    this$static.right.localMap.putAll_0(this$static.localMap);
    $replaceNodeWithSoleChild(this$static, this$static.right);
    return;
  }
  if (this$static.right.subtreeLength == 0) {
    this$static.left_0.localMap.putAll_0(this$static.localMap);
    $replaceNodeWithSoleChild(this$static, this$static.left_0);
    return;
  }
}

function $tryToMergeChildren(this$static){
  var rightLength;
  if (this$static.left_0.localMap.isEmpty() && this$static.right.localMap.isEmpty() && this$static.left_0.type_0 == ($clinit_1819() , LEAF_BLACK) && this$static.right.type_0 == ($clinit_1819() , LEAF_BLACK)) {
    rightLength = this$static.right.subtreeLength;
    if (rightLength == 0) {
      return;
    }
    if (this$static.left_0.subtreeLength == 0) {
      return;
    }
    this$static.left_0.subtreeLength += rightLength;
    this$static.right.subtreeLength = 0;
    $add_9(this$static.this$0.leavesThatHaveBecomeEmpty, this$static.right);
  }
}

function $tryToPropagateFromChildren(this$static, key){
  var valueLeft;
  if (this$static.left_0.localMap.containsKey_1(key) && this$static.right.localMap.containsKey_1(key)) {
    valueLeft = this$static.left_0.localMap.getExisting(key);
    if (equal_0(valueLeft, this$static.right.localMap.getExisting(key))) {
      this$static.localMap.put_3(key, valueLeft);
      this$static.left_0.localMap.remove_8(key);
      this$static.right.localMap.remove_8(key);
      $tryToMergeChildren(this$static);
      $tryToPropagateFromChildren(this$static.parent_0, key);
      return true;
    }
  }
  return false;
}

function $tryToPropagateFromChildren_0(this$static, entries){
  entries.each_2(new BasicAnnotationTree$Node$3_0(this$static));
}

function BasicAnnotationTree$Node_0(this$0, type, subtreeLength, localMap){
  this.this$0 = this$0;
  this.subtreeLength = subtreeLength;
  this.localMap = localMap;
  this.type_0 = type;
  this.id_0 = this$0.nextId++;
}

function BasicAnnotationTree$Node(){
}

_ = BasicAnnotationTree$Node_0.prototype = BasicAnnotationTree$Node.prototype = new Object_0;
_.getClass$ = function getClass_1141(){
  return Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$Node_2_classLit;
}
;
_.toString$ = function toString_91(){
  return $toString_23(this);
}
;
_.castableTypeMap$ = {383:1};
_.id_0 = 0;
_.left_0 = null;
_.localMap = null;
_.parent_0 = null;
_.right = null;
_.subtreeLength = 0;
_.this$0 = null;
_.type_0 = null;
function BasicAnnotationTree$Node$3_0(this$1){
  this.this$1 = this$1;
}

function BasicAnnotationTree$Node$3(){
}

_ = BasicAnnotationTree$Node$3_0.prototype = BasicAnnotationTree$Node$3.prototype = new Object_0;
_.apply_1 = function apply_83(key, value){
  $tryToPropagateFromChildren(this.this$1, key);
}
;
_.getClass$ = function getClass_1142(){
  return Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$Node$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
function $clinit_1819(){
  $clinit_1819 = nullMethod;
  LEAF_BLACK = new BasicAnnotationTree$NodeType_0('LEAF_BLACK', 0);
  INTERNAL_RED = new BasicAnnotationTree$NodeType_0('INTERNAL_RED', 1);
  INTERNAL_BLACK = new BasicAnnotationTree$NodeType_0('INTERNAL_BLACK', 2);
  $VALUES_62 = initValues(_3Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$NodeType_2_classLit, {9:1, 68:1, 170:1}, 141, [LEAF_BLACK, INTERNAL_RED, INTERNAL_BLACK]);
}

function BasicAnnotationTree$NodeType_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_69(name_0){
  $clinit_1819();
  return valueOf_0(($clinit_1820() , $MAP_62), name_0);
}

function values_63(){
  $clinit_1819();
  return $VALUES_62;
}

function BasicAnnotationTree$NodeType(){
}

_ = BasicAnnotationTree$NodeType_0.prototype = BasicAnnotationTree$NodeType.prototype = new Enum;
_.getClass$ = function getClass_1143(){
  return Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$NodeType_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 141:1};
var $VALUES_62, INTERNAL_BLACK, INTERNAL_RED, LEAF_BLACK;
function $clinit_1820(){
  $clinit_1820 = nullMethod;
  $MAP_62 = createValueOfMap(($clinit_1819() , $VALUES_62));
}

var $MAP_62;
function DocumentEvent(){
}

_ = DocumentEvent.prototype = new Object_0;
_.getClass$ = function getClass_1144(){
  return Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent_2_classLit;
}
;
_.castableTypeMap$ = {431:1};
_.type_0 = null;
function DocumentEvent$AnnotationChanged_0(start, end, key, newValue){
  this.type_0 = ($clinit_1832() , ANNOTATION_CHANGED);
  this.start = start;
  this.end = end;
  this.key = key;
  this.newValue = newValue;
}

function DocumentEvent$AnnotationChanged(){
}

_ = DocumentEvent$AnnotationChanged_0.prototype = DocumentEvent$AnnotationChanged.prototype = new DocumentEvent;
_.getClass$ = function getClass_1145(){
  return Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$AnnotationChanged_2_classLit;
}
;
_.toString$ = function toString_92(){
  return 'AC:@(' + this.start + ',' + this.end + '):[' + this.key + ':' + this.newValue + ']';
}
;
_.castableTypeMap$ = {431:1};
_.end = 0;
_.key = null;
_.newValue = null;
_.start = 0;
function DocumentEvent$AttributesModified_0(element, oldValues, newValues){
  var entry, entry$iterator, key, key$iterator, keysToRemove, newV, oldV;
  this.type_0 = ($clinit_1832() , ATTRIBUTES);
  this.element = element;
  oldV = new HashMap_3(oldValues);
  newV = new HashMap_3(newValues);
  keysToRemove = new ArrayList_0;
  for (entry$iterator = oldV.entrySet_0().iterator_0(); entry$iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.next_0(), 11);
    key = dynamicCast(entry.getKey(), 1);
    if (newV.containsKey(key)) {
      if (equal_0(dynamicCast(newV.get(key), 1), dynamicCast(entry.getValue(), 1))) {
        newV.remove_3(key);
        setCheck(keysToRemove.array, keysToRemove.size_0++, key);
      }
    }
     else {
      newV.put(key, null);
    }
  }
  for (key$iterator = new AbstractList$IteratorImpl_0(keysToRemove); key$iterator.i < key$iterator.this$0_0.size_1();) {
    key = dynamicCast($next_4(key$iterator), 1);
    oldV.remove_3(key);
  }
  for (entry$iterator = newV.entrySet_0().iterator_0(); entry$iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.next_0(), 11);
    oldV.containsKey(entry.getKey()) || oldV.put(dynamicCast(entry.getKey(), 1), null);
  }
  this.oldValues = ($clinit_480() , new Collections$UnmodifiableMap_0(oldV));
  this.newValues = new Collections$UnmodifiableMap_0(newV);
}

function DocumentEvent$AttributesModified_1(element, update){
  var i, newV, newValue, oldV, oldValue;
  this.type_0 = ($clinit_1832() , ATTRIBUTES);
  this.element = element;
  oldV = new HashMap_0;
  newV = new HashMap_0;
  for (i = 0; i < update.updates.size_1(); ++i) {
    oldValue = dynamicCast(update.updates.get_0(i), 384).oldValue;
    newValue = dynamicCast(update.updates.get_0(i), 384).newValue;
    if (newValue == null?oldValue != null:!$equals_3(newValue, oldValue)) {
      oldV.put(dynamicCast(update.updates.get_0(i), 384).name_0, oldValue);
      newV.put(dynamicCast(update.updates.get_0(i), 384).name_0, newValue);
    }
  }
  this.oldValues = ($clinit_480() , new Collections$UnmodifiableMap_0(oldV));
  this.newValues = new Collections$UnmodifiableMap_0(newV);
}

function DocumentEvent$AttributesModified(){
}

_ = DocumentEvent$AttributesModified_1.prototype = DocumentEvent$AttributesModified_0.prototype = DocumentEvent$AttributesModified.prototype = new DocumentEvent;
_.equals$ = function equals_47(obj){
  var other;
  if (this === obj)
    return true;
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[385]))
    return false;
  other = dynamicCast(obj, 385);
  if (this.element == null) {
    if (other.element != null)
      return false;
  }
   else if (!equals__devirtual$(this.element, other.element))
    return false;
  if (!this.newValues) {
    if (other.newValues)
      return false;
  }
   else if (!this.newValues.map.equals$(other.newValues))
    return false;
  if (!this.oldValues) {
    if (other.oldValues)
      return false;
  }
   else if (!this.oldValues.map.equals$(other.oldValues))
    return false;
  return true;
}
;
_.getClass$ = function getClass_1146(){
  return Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$AttributesModified_2_classLit;
}
;
_.hashCode$ = function hashCode_46(){
  var result;
  result = 31 + (this.element == null?0:hashCode__devirtual$(this.element));
  result = 31 * result + (!this.newValues?0:this.newValues.map.hashCode$());
  result = 31 * result + (!this.oldValues?0:this.oldValues.map.hashCode$());
  return result;
}
;
_.toString$ = function toString_93(){
  return 'A:' + this.oldValues + '->' + this.newValues;
}
;
_.castableTypeMap$ = {385:1, 431:1};
_.element = null;
_.newValues = null;
_.oldValues = null;
function DocumentEvent$ContentDeleted_0(location_0, size, tokens, root){
  this.type_0 = ($clinit_1832() , CONTENT_DELETED);
  this.location_0 = location_0;
  this.size_0 = size;
  this.tokens = tokens;
  this.root = root;
}

function DocumentEvent$ContentDeleted(){
}

_ = DocumentEvent$ContentDeleted_0.prototype = DocumentEvent$ContentDeleted.prototype = new DocumentEvent;
_.equals$ = function equals_48(obj){
  var other;
  if (this === obj)
    return true;
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[386]))
    return false;
  other = dynamicCast(obj, 386);
  if (this.location_0 != other.location_0)
    return false;
  if (this.size_0 != other.size_0)
    return false;
  if (!$equals_5(this.tokens, other.tokens))
    return false;
  return true;
}
;
_.getClass$ = function getClass_1147(){
  return Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$ContentDeleted_2_classLit;
}
;
_.hashCode$ = function hashCode_47(){
  var result;
  result = 31 + this.location_0;
  result = 31 * result + this.size_0;
  result = 31 * result + $hashCode_6(this.tokens);
  return result;
}
;
_.toString$ = function toString_94(){
  var content_0, token, token$iterator;
  content_0 = 'CD:@' + this.location_0 + '-' + this.size_0 + ' [';
  for (token$iterator = new AbstractList$IteratorImpl_0(this.tokens); token$iterator.i < token$iterator.this$0_0.size_1();) {
    token = dynamicCast($next_4(token$iterator), 387);
    content_0 += $toString_24(token);
  }
  content_0 += ']';
  return content_0;
}
;
_.castableTypeMap$ = {386:1, 431:1};
_.location_0 = 0;
_.root = null;
_.size_0 = 0;
_.tokens = null;
function $addElementEnd(this$static){
  $add_9(this$static.tokens, new DocumentEvent$ContentDeleted$Token_0(($clinit_1827() , ELEMENT_END), dynamicCast($pop(this$static.tagNames), 1), null, null));
  ++this$static.size_0;
}

function $addElementStart(this$static, tagName, elements){
  $add_9(this$static.tokens, new DocumentEvent$ContentDeleted$Token_0(($clinit_1827() , ELEMENT_START), tagName, elements, null));
  $add_9(this$static.tagNames.arrayList, tagName);
  ++this$static.size_0;
}

function $addText(this$static, text){
  $add_9(this$static.tokens, new DocumentEvent$ContentDeleted$Token_0(($clinit_1827() , TEXT), null, null, text));
  this$static.size_0 += text.length;
}

function $build_0(this$static){
  return new DocumentEvent$ContentDeleted_0(this$static.start, this$static.size_0, this$static.tokens, this$static.root);
}

function DocumentEvent$ContentDeleted$Builder_0(start, root){
  this.start = start;
  this.size_0 = 0;
  this.tokens = new ArrayList_0;
  this.tagNames = new Stack_0;
  this.root = root;
}

function DocumentEvent$ContentDeleted$Builder(){
}

_ = DocumentEvent$ContentDeleted$Builder_0.prototype = DocumentEvent$ContentDeleted$Builder.prototype = new Object_0;
_.getClass$ = function getClass_1148(){
  return Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$ContentDeleted$Builder_2_classLit;
}
;
_.castableTypeMap$ = {};
_.root = null;
_.size_0 = 0;
_.start = 0;
_.tagNames = null;
_.tokens = null;
function $toString_24(this$static){
  var b, key, key$iterator;
  if (this$static.text_0 != null) {
    return this$static.text_0;
  }
   else if (this$static.attributes) {
    b = new StringBuilder_0;
    $append_11(b, '<' + this$static.tagName_0);
    for (key$iterator = this$static.attributes.keySet_0().iterator_0(); key$iterator.hasNext();) {
      key = dynamicCast(key$iterator.next_0(), 1);
      $append_11(b, ' ' + key + '=' + dynamicCast(this$static.attributes.get(key), 1));
    }
    b.impl.string += '>';
    return b.impl.string;
  }
  return '<\/' + this$static.tagName_0 + '>';
}

function DocumentEvent$ContentDeleted$Token_0(type, tagName, attributes, text){
  this.type_0 = type;
  this.tagName_0 = tagName;
  this.attributes = attributes;
  this.text_0 = text;
}

function DocumentEvent$ContentDeleted$Token(){
}

_ = DocumentEvent$ContentDeleted$Token_0.prototype = DocumentEvent$ContentDeleted$Token.prototype = new Object_0;
_.equals$ = function equals_49(obj){
  var other;
  if (this === obj)
    return true;
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[387]))
    return false;
  other = dynamicCast(obj, 387);
  if (!this.attributes) {
    if (other.attributes)
      return false;
  }
   else if (!this.attributes.equals$(other.attributes))
    return false;
  if (this.tagName_0 == null) {
    if (other.tagName_0 != null)
      return false;
  }
   else if (!$equals_3(this.tagName_0, other.tagName_0))
    return false;
  if (this.text_0 == null) {
    if (other.text_0 != null)
      return false;
  }
   else if (!$equals_3(this.text_0, other.text_0))
    return false;
  if (!this.type_0) {
    if (other.type_0)
      return false;
  }
   else if (this.type_0 != other.type_0)
    return false;
  return true;
}
;
_.getClass$ = function getClass_1149(){
  return Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$ContentDeleted$Token_2_classLit;
}
;
_.hashCode$ = function hashCode_48(){
  var result;
  result = 31 + (!this.attributes?0:this.attributes.hashCode$());
  result = 31 * result + (this.tagName_0 == null?0:getHashCode_0(this.tagName_0));
  result = 31 * result + (this.text_0 == null?0:getHashCode_0(this.text_0));
  result = 31 * result + (!this.type_0?0:getHashCode(this.type_0));
  return result;
}
;
_.toString$ = function toString_95(){
  return $toString_24(this);
}
;
_.castableTypeMap$ = {387:1};
_.attributes = null;
_.tagName_0 = null;
_.text_0 = null;
_.type_0 = null;
function $clinit_1827(){
  $clinit_1827 = nullMethod;
  TEXT = new DocumentEvent$ContentDeleted$TokenType_0('TEXT', 0);
  ELEMENT_START = new DocumentEvent$ContentDeleted$TokenType_0('ELEMENT_START', 1);
  ELEMENT_END = new DocumentEvent$ContentDeleted$TokenType_0('ELEMENT_END', 2);
  $VALUES_63 = initValues(_3Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$ContentDeleted$TokenType_2_classLit, {9:1, 68:1, 170:1}, 142, [TEXT, ELEMENT_START, ELEMENT_END]);
}

function DocumentEvent$ContentDeleted$TokenType_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_70(name_0){
  $clinit_1827();
  return valueOf_0(($clinit_1828() , $MAP_63), name_0);
}

function values_64(){
  $clinit_1827();
  return $VALUES_63;
}

function DocumentEvent$ContentDeleted$TokenType(){
}

_ = DocumentEvent$ContentDeleted$TokenType_0.prototype = DocumentEvent$ContentDeleted$TokenType.prototype = new Enum;
_.getClass$ = function getClass_1150(){
  return Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$ContentDeleted$TokenType_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 142:1};
var $VALUES_63, ELEMENT_END, ELEMENT_START, TEXT;
function $clinit_1828(){
  $clinit_1828 = nullMethod;
  $MAP_63 = createValueOfMap(($clinit_1827() , $VALUES_63));
}

var $MAP_63;
function DocumentEvent$ContentInserted_0(element){
  this.type_0 = ($clinit_1832() , CONTENT_INSERTED);
  this.element = element;
}

function DocumentEvent$ContentInserted(){
}

_ = DocumentEvent$ContentInserted_0.prototype = DocumentEvent$ContentInserted.prototype = new DocumentEvent;
_.equals$ = function equals_50(obj){
  var other;
  if (this === obj)
    return true;
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[388]))
    return false;
  other = dynamicCast(obj, 388);
  if (this.element == null) {
    if (other.element != null)
      return false;
  }
   else if (!equals__devirtual$(this.element, other.element))
    return false;
  return true;
}
;
_.getClass$ = function getClass_1151(){
  return Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$ContentInserted_2_classLit;
}
;
_.hashCode$ = function hashCode_49(){
  var result;
  result = 31 + (this.element == null?0:hashCode__devirtual$(this.element));
  return result;
}
;
_.toString$ = function toString_96(){
  return 'CI:' + this.element;
}
;
_.castableTypeMap$ = {388:1, 431:1};
_.element = null;
function DocumentEvent$TextDeleted_0(location_0, deletedText){
  this.type_0 = ($clinit_1832() , TEXT_DELETED);
  this.location_0 = location_0;
  this.deletedText = deletedText;
}

function DocumentEvent$TextDeleted(){
}

_ = DocumentEvent$TextDeleted_0.prototype = DocumentEvent$TextDeleted.prototype = new DocumentEvent;
_.equals$ = function equals_51(obj){
  var other;
  if (this === obj)
    return true;
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[389]))
    return false;
  other = dynamicCast(obj, 389);
  if (this.deletedText == null) {
    if (other.deletedText != null)
      return false;
  }
   else if (!$equals_3(this.deletedText, other.deletedText))
    return false;
  if (this.location_0 != other.location_0)
    return false;
  return true;
}
;
_.getClass$ = function getClass_1152(){
  return Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$TextDeleted_2_classLit;
}
;
_.hashCode$ = function hashCode_50(){
  var result;
  result = 31 + (this.deletedText == null?0:getHashCode_0(this.deletedText));
  result = 31 * result + this.location_0;
  return result;
}
;
_.toString$ = function toString_97(){
  return 'TD:' + this.deletedText + '@' + this.location_0;
}
;
_.castableTypeMap$ = {389:1, 431:1};
_.deletedText = null;
_.location_0 = 0;
function DocumentEvent$TextInserted_0(location_0, insertedText){
  this.type_0 = ($clinit_1832() , TEXT_INSERTED);
  this.location_0 = location_0;
  this.insertedText = insertedText;
}

function DocumentEvent$TextInserted(){
}

_ = DocumentEvent$TextInserted_0.prototype = DocumentEvent$TextInserted.prototype = new DocumentEvent;
_.equals$ = function equals_52(obj){
  var other;
  if (this === obj)
    return true;
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[390]))
    return false;
  other = dynamicCast(obj, 390);
  if (this.insertedText == null) {
    if (other.insertedText != null)
      return false;
  }
   else if (!$equals_3(this.insertedText, other.insertedText))
    return false;
  if (this.location_0 != other.location_0)
    return false;
  return true;
}
;
_.getClass$ = function getClass_1153(){
  return Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$TextInserted_2_classLit;
}
;
_.hashCode$ = function hashCode_51(){
  var result;
  result = 31 + (this.insertedText == null?0:getHashCode_0(this.insertedText));
  result = 31 * result + this.location_0;
  return result;
}
;
_.toString$ = function toString_98(){
  return 'TI:' + this.insertedText + '@' + this.location_0;
}
;
_.castableTypeMap$ = {390:1, 431:1};
_.insertedText = null;
_.location_0 = 0;
function $clinit_1832(){
  $clinit_1832 = nullMethod;
  ATTRIBUTES = new DocumentEvent$Type_0('ATTRIBUTES', 0);
  TEXT_INSERTED = new DocumentEvent$Type_0('TEXT_INSERTED', 1);
  CONTENT_INSERTED = new DocumentEvent$Type_0('CONTENT_INSERTED', 2);
  TEXT_DELETED = new DocumentEvent$Type_0('TEXT_DELETED', 3);
  CONTENT_DELETED = new DocumentEvent$Type_0('CONTENT_DELETED', 4);
  ANNOTATION_CHANGED = new DocumentEvent$Type_0('ANNOTATION_CHANGED', 5);
  $VALUES_64 = initValues(_3Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$Type_2_classLit, {9:1, 68:1, 170:1}, 143, [ATTRIBUTES, TEXT_INSERTED, CONTENT_INSERTED, TEXT_DELETED, CONTENT_DELETED, ANNOTATION_CHANGED]);
}

function DocumentEvent$Type_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_71(name_0){
  $clinit_1832();
  return valueOf_0(($clinit_1833() , $MAP_64), name_0);
}

function values_65(){
  $clinit_1832();
  return $VALUES_64;
}

function DocumentEvent$Type(){
}

_ = DocumentEvent$Type_0.prototype = DocumentEvent$Type.prototype = new Enum;
_.getClass$ = function getClass_1154(){
  return Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$Type_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 143:1};
var $VALUES_64, ANNOTATION_CHANGED, ATTRIBUTES, CONTENT_DELETED, CONTENT_INSERTED, TEXT_DELETED, TEXT_INSERTED;
function $clinit_1833(){
  $clinit_1833 = nullMethod;
  $MAP_64 = createValueOfMap(($clinit_1832() , $VALUES_64));
}

var $MAP_64;
function EventBundleImpl_0(components, deleted){
  this.components = components;
  this.deleted = deleted;
}

function EventBundleImpl(){
}

_ = EventBundleImpl_0.prototype = EventBundleImpl.prototype = new Object_0;
_.getClass$ = function getClass_1155(){
  return Lorg_waveprotocol_wave_model_document_indexed_EventBundleImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.components = null;
_.deleted = null;
function $addDeletedElement(this$static, e){
  !this$static.deleted && (this$static.deleted = new LinkedHashSet_0);
  this$static.deleted.add_0(e);
}

function $addInsertedElement(this$static, e){
  !this$static.inserted && (this$static.inserted = new ArrayList_0);
  this$static.inserted.add_0(e);
}

function $build_1(this$static){
  !this$static.inserted && (this$static.inserted = ($clinit_480() , $clinit_480() , EMPTY_SET));
  !this$static.deleted && (this$static.deleted = ($clinit_480() , $clinit_480() , EMPTY_SET));
  return new EventBundleImpl_0(this$static.components, this$static.deleted);
}

function EventBundleImpl$Builder_0(){
  this.components = new ArrayList_0;
}

function EventBundleImpl$Builder(){
}

_ = EventBundleImpl$Builder_0.prototype = EventBundleImpl$Builder.prototype = new Object_0;
_.getClass$ = function getClass_1156(){
  return Lorg_waveprotocol_wave_model_document_indexed_EventBundleImpl$Builder_2_classLit;
}
;
_.castableTypeMap$ = {397:1};
_.deleted = null;
_.inserted = null;
function $clinit_1838(){
  $clinit_1838 = nullMethod;
  ONE_OBJECT_0 = new Object_1;
  ANOTHER_OBJECT_0 = new Object_1;
}

function $build_2(operation, schema){
  var $e0, annotations, doc, e;
  annotations = new AnnotationTree_0(ONE_OBJECT_0, ANOTHER_OBJECT_0, null);
  doc = new IndexedDocumentImpl_0(new RawDocumentImpl_0('doc', ($clinit_1880() , EMPTY_MAP_0)), annotations, schema);
  try {
    $consume_10(doc, operation, performValidation);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 189)) {
      e = $e0;
      throw new OperationRuntimeException_0('Invalid initialization', e);
    }
     else 
      throw $e0;
  }
  return doc;
}

function $build_3(operation, schema, handler){
  var doc;
  doc = new ObservableIndexedDocument_0(handler, new RawDocumentImpl_0('doc', ($clinit_1880() , EMPTY_MAP_0)), schema);
  $consume_10(doc, operation, performValidation);
  return doc;
}

function $parse_1(text){
  var $e0, docInitialization, e;
  try {
    docInitialization = docInitializationFromXml(text);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 380)) {
      e = $e0;
      throw new IllegalArgumentException_3(e);
    }
     else 
      throw $e0;
  }
  return $build_2(docInitialization, ($clinit_2009() , NO_SCHEMA_CONSTRAINTS));
}

var ANOTHER_OBJECT_0, ONE_OBJECT_0;
function $maybeTextNodeEnd(this$static, node){
  var textNode;
  textNode = this$static.this$0.substrate.asText_0(node);
  return textNode == null?null:new Point$Tx_0(textNode, this$static.this$0.substrate.getLength(textNode));
}

function $performAction(this$static, container, offset){
  var domNode, element, maybeAdjust;
  domNode = container.value_0;
  if (domNode == null) {
    if (container == this$static.this$0.offsetList.root) {
      return new Point$El_0(this$static.this$0.substrate.getDocumentElement(), null);
    }
    element = $getParentOf(this$static.this$0, container);
    maybeAdjust = $maybeTextNodeEnd(this$static, this$static.this$0.substrate.getLastChild_0(element));
    return maybeAdjust?maybeAdjust:new Point$El_0(element, null);
  }
   else if (this$static.this$0.substrate.asElement_0(domNode) != null) {
    maybeAdjust = $maybeTextNodeEnd(this$static, this$static.this$0.substrate.getPreviousSibling(domNode));
    return maybeAdjust?maybeAdjust:before_0(this$static.this$0.substrate, domNode);
  }
   else {
    if (offset == 0) {
      maybeAdjust = $maybeTextNodeEnd(this$static, this$static.this$0.substrate.getPreviousSibling(domNode));
      return maybeAdjust?maybeAdjust:new Point$Tx_0(domNode, 0);
    }
     else {
      return new Point$Tx_0(domNode, offset);
    }
  }
}

function IndexedDocumentImpl$1_0(this$0){
  this.this$0 = this$0;
}

function IndexedDocumentImpl$1(){
}

_ = IndexedDocumentImpl$1_0.prototype = IndexedDocumentImpl$1.prototype = new Object_0;
_.getClass$ = function getClass_1157(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$1_2_classLit;
}
;
_.performAction = function performAction(container, offset){
  return $performAction(this, container, offset);
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function IndexedDocumentImpl$2_0(this$0){
  this.this$0 = this$0;
}

function IndexedDocumentImpl$2(){
}

_ = IndexedDocumentImpl$2_0.prototype = IndexedDocumentImpl$2.prototype = new Object_0;
_.getClass$ = function getClass_1158(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$2_2_classLit;
}
;
_.performAction = function performAction_0(container, offset){
  return this.this$0.currentContainer = container , this.this$0.currentOffset = offset , this.this$0.currentParent = $getParentOf(this.this$0, container) , null;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function IndexedDocumentImpl$3_0(){
}

function IndexedDocumentImpl$3(){
}

_ = IndexedDocumentImpl$3_0.prototype = IndexedDocumentImpl$3.prototype = new Object_0;
_.apply_4 = function apply_84(key){
  checkPersistentKey(key);
}
;
_.getClass$ = function getClass_1159(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$3_2_classLit;
}
;
_.castableTypeMap$ = {};
function IndexedDocumentImpl$4_0(val$b){
  this.val$b = val$b;
}

function IndexedDocumentImpl$4(){
}

_ = IndexedDocumentImpl$4_0.prototype = IndexedDocumentImpl$4.prototype = new Object_0;
_.apply_1 = function apply_85(key, value){
  value != null?($put_3(this.val$b.annotationChanges, key, new AnnotationsNormalizer$AnnotationChangeValues_0(null, dynamicCast(value, 1))) , undefined):($put_3(this.val$b.annotationChanges, key, null) , undefined);
}
;
_.getClass$ = function getClass_1160(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$4_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$b = null;
function IndexedDocumentImpl$5_0(val$b){
  this.val$b = val$b;
}

function IndexedDocumentImpl$5(){
}

_ = IndexedDocumentImpl$5_0.prototype = IndexedDocumentImpl$5.prototype = new Object_0;
_.apply_1 = function apply_86(key, value){
  $put_3(this.val$b.annotationChanges, key, null);
}
;
_.getClass$ = function getClass_1161(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$5_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$b = null;
function IndexedDocumentImpl$6_0(val$knownKeys){
  this.val$knownKeys = val$knownKeys;
}

function IndexedDocumentImpl$6(){
}

_ = IndexedDocumentImpl$6_0.prototype = IndexedDocumentImpl$6.prototype = new Object_0;
_.apply_4 = function apply_87(key){
  key.charCodeAt(0) == 64 || this.val$knownKeys.add_3(key);
}
;
_.getClass$ = function getClass_1162(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$6_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$knownKeys = null;
function IndexedDocumentImpl$7_0(val$callback){
  this.val$callback = val$callback;
}

function IndexedDocumentImpl$7(){
}

_ = IndexedDocumentImpl$7_0.prototype = IndexedDocumentImpl$7.prototype = new Object_0;
_.apply_1 = function apply_88(key, value){
  key.charCodeAt(0) == 64 || this.val$callback.apply_1(key, dynamicCast(value, 1));
}
;
_.getClass$ = function getClass_1163(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$7_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$callback = null;
function IndexedDocumentImpl$8_0(val$iterable){
  this.val$iterable = val$iterable;
}

function IndexedDocumentImpl$8(){
}

_ = IndexedDocumentImpl$8_0.prototype = IndexedDocumentImpl$8.prototype = new Object_0;
_.getClass$ = function getClass_1164(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$8_2_classLit;
}
;
_.iterator_0 = function iterator_25(){
  var iterator;
  return iterator = this.val$iterable.iterator_0() , new IndexedDocumentImpl$8$1_0(iterator);
}
;
_.castableTypeMap$ = {};
_.val$iterable = null;
function $next_14(this$static){
  var annotations, diffFromLeft, end, rawInterval, start;
  rawInterval = dynamicCast(this$static.val$iterator.next_0(), 393);
  start = rawInterval.start;
  end = rawInterval.end;
  annotations = rawInterval.annotations;
  diffFromLeft = rawInterval.diffFromLeft;
  return new AnnotationIntervalImpl_0(start, end, annotations, diffFromLeft);
}

function IndexedDocumentImpl$8$1_0(val$iterator){
  this.val$iterator = val$iterator;
}

function IndexedDocumentImpl$8$1(){
}

_ = IndexedDocumentImpl$8$1_0.prototype = IndexedDocumentImpl$8$1.prototype = new Object_0;
_.getClass$ = function getClass_1165(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$8$1_2_classLit;
}
;
_.hasNext = function hasNext_17(){
  return this.val$iterator.hasNext();
}
;
_.next_0 = function next_25(){
  return $next_14(this);
}
;
_.remove_1 = function remove_54(){
  this.val$iterator.remove_1();
}
;
_.castableTypeMap$ = {};
_.val$iterator = null;
function IndexedDocumentImpl$InvertibleCursor_0(this$0){
  this.this$0 = this$0;
}

function IndexedDocumentImpl$InvertibleCursor(){
}

_ = IndexedDocumentImpl$InvertibleCursor_0.prototype = IndexedDocumentImpl$InvertibleCursor.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_0(map){
  var i;
  for (i = 0; i < map.endSize(); ++i) {
    $doEndAnnotation(this.this$0, map.getEndKey_0(i));
  }
  for (i = 0; i < map.changeSize(); ++i) {
    $doStartAnnotation(this.this$0, map.getChangeKey_0(i), map.getNewValue(i));
  }
}
;
_.characters_0 = function characters_1(characters){
  $doCharacters(this.this$0, characters);
}
;
_.deleteCharacters = function deleteCharacters_0(chars){
  this.this$0.annotations.delete_$(chars.length);
  $doDeleteCharacters(this.this$0, chars.length);
  this.this$0.onDeleteCharacters(this.this$0.currentLocation, chars);
}
;
_.deleteElementEnd = function deleteElementEnd_0(){
  this.this$0.onDeleteElementEnd();
  this.this$0.annotations.delete_$(1);
  $deleteCurrentContainer(this.this$0);
  --this.this$0.deletionDepth;
}
;
_.deleteElementStart = function deleteElementStart_0(type, attrs){
  var nodeToDelete;
  nodeToDelete = this.this$0.substrate.asElement_0(this.this$0.currentContainer.value_0);
  if (nodeToDelete == null) {
    throw new OpCursorException_0('No element to delete at the current location.');
  }
  this.this$0.deletionDepth == 0 && this.this$0.substrate.removeChild_0(this.this$0.currentParent, nodeToDelete);
  this.this$0.annotations.delete_$(1);
  $deleteCurrentContainer(this.this$0);
  ++this.this$0.deletionDepth;
  this.this$0.onDeleteElementStart(this.this$0.currentLocation, nodeToDelete);
}
;
_.elementEnd = function elementEnd_0(){
  $doElementEnd(this.this$0);
}
;
_.elementStart = function elementStart_0(tagName, attributes){
  $doElementStart(this.this$0, tagName, attributes);
}
;
_.getClass$ = function getClass_1168(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$InvertibleCursor_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_0(oldAttrs, newAttrs){
  var attribute, attribute$iterator, key, node;
  this.this$0.annotations.skip(1);
  node = this.this$0.substrate.asElement_0(this.this$0.currentContainer.value_0);
  for (attribute$iterator = new ImmutableStateMap$1$1_0(oldAttrs.entrySet); attribute$iterator.iterator.hasNext();) {
    attribute = dynamicCast(attribute$iterator.iterator.next_0(), 394);
    key = attribute.name_0;
    !!$implFindEntry(newAttrs, key, false) || this.this$0.substrate.removeAttribute_0(node, key);
  }
  for (attribute$iterator = new ImmutableStateMap$1$1_0(newAttrs.entrySet); attribute$iterator.iterator.hasNext();) {
    attribute = dynamicCast(attribute$iterator.iterator.next_0(), 394);
    if (attribute.value_0 == null) {
      throw new OpCursorException_0('Null attribute value in setAttributes');
    }
    this.this$0.substrate.setAttribute_0(node, attribute.name_0, attribute.value_0);
  }
  ++this.this$0.currentLocation;
  this.this$0.currentContainer = this.this$0.currentContainer.nextContainer;
  this.this$0.currentParent = node;
  this.this$0.onModifyAttributes(this.this$0.currentParent, oldAttrs, newAttrs);
}
;
_.retain = function retain_0(itemCount){
  $checkRetain(this.this$0, itemCount);
  this.this$0.annotations.skip(itemCount);
  this.this$0.currentLocation += itemCount;
  $moveToCurrentLocation(this.this$0);
}
;
_.updateAttributes = function updateAttributes_0(attrUpdate){
  var i, name_0, newValue, node;
  this.this$0.annotations.skip(1);
  node = this.this$0.substrate.asElement_0(this.this$0.currentContainer.value_0);
  for (i = 0; i < attrUpdate.updates.size_1(); ++i) {
    name_0 = dynamicCast(attrUpdate.updates.get_0(i), 384).name_0;
    newValue = dynamicCast(attrUpdate.updates.get_0(i), 384).newValue;
    newValue != null?this.this$0.substrate.setAttribute_0(node, name_0, newValue):this.this$0.substrate.removeAttribute_0(node, name_0);
  }
  ++this.this$0.currentLocation;
  this.this$0.currentContainer = this.this$0.currentContainer.nextContainer;
  this.this$0.currentParent = node;
  this.this$0.onModifyAttributes_0(this.this$0.currentParent, attrUpdate);
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $begin2(this$static){
  $beginChange(this$static.this$0);
  this$static.builder = new AnnotationsNormalizer_0(performValidation?new DocOpBuffer_0:new UncheckedDocOpBuffer_0);
  this$static.sizeDiffSoFar = 0;
  this$static.deletionValues.clear();
}

function $beginInsert(this$static){
  this$static.newValues.each_2(new IndexedDocumentImpl$NonInvertibleCursor$3_0(this$static));
  this$static.newValues.clear();
  this$static.deletionValues.clear();
  this$static.deletionValues.putAll_0(this$static.requestedValues);
  this$static.endKeys.each_3(new IndexedDocumentImpl$NonInvertibleCursor$5_0(this$static));
  this$static.endKeys.clear();
}

function $beginUpdate(this$static){
  this$static.requestedValues.each_2(new IndexedDocumentImpl$NonInvertibleCursor$4_0(this$static));
  this$static.newValues.clear();
  this$static.deletionValues.clear();
  this$static.deletionValues.putAll_0(this$static.requestedValues);
  this$static.endKeys.each_3(new IndexedDocumentImpl$NonInvertibleCursor$5_0(this$static));
  this$static.endKeys.clear();
}

function $deleteAnnotations(this$static, size){
  var deletionInherit, end, events, i, i$iterator, open_0, realStart, start, iterator;
  events = new ArrayList_0;
  open_0 = ($clinit_2309() , defaultCollectionFactory.createStringSet());
  deletionInherit = defaultCollectionFactory.createStringMap();
  this$static.deletionValues.each_2(new IndexedDocumentImpl$NonInvertibleCursor$6_0(deletionInherit));
  start = this$static.this$0.currentLocation;
  end = this$static.this$0.currentLocation + size;
  for (i$iterator = (iterator = $annotationIntervals_1(this$static.this$0, start, end, null).val$iterable.iterator_0() , new IndexedDocumentImpl$8$1_0(iterator)); i$iterator.val$iterator.hasNext();) {
    i = $next_14(i$iterator);
    realStart = max_1(start, i.start);
    deletionInherit.each_2(new IndexedDocumentImpl$NonInvertibleCursor$7_0(this$static, events, realStart, open_0));
    i.annotations.each_2(new IndexedDocumentImpl$NonInvertibleCursor$8_0(deletionInherit, events, realStart, open_0));
  }
  open_0.each_3(new IndexedDocumentImpl$NonInvertibleCursor$9_0(events, end));
  this$static.this$0.annotations.delete_$(size);
  return events;
}

function $doSingleDelete(this$static, tagName, attrs){
  var changeKey, check, ev, ev$iterator, eventLocation, events, moved;
  events = $deleteAnnotations(this$static, 1);
  moved = false;
  check = 0;
  for (ev$iterator = new AbstractList$IteratorImpl_0(events); ev$iterator.i < ev$iterator.this$0_0.size_1();) {
    ev = dynamicCast($next_4(ev$iterator), 395);
    eventLocation = ev.index_0;
    if (eventLocation > this$static.this$0.currentLocation && !moved) {
      moved = true;
      tagName != null?$deleteElementStart_0(this$static.builder, tagName, attrs):$deleteElementEnd_0(this$static.builder);
    }
    if (ev.getEndKey() != null) {
      $maybeRenewAnnotation(this$static, ev.getEndKey());
      $put_3(this$static.builder.annotationChanges, ev.getEndKey(), null);
      --check;
    }
     else {
      changeKey = ev.getChangeKey();
      $put_3(this$static.builder.annotationChanges, changeKey, new AnnotationsNormalizer$AnnotationChangeValues_0(ev.getChangeOldValue(), $getLeftNeighbourAnnotation(this$static, changeKey)));
      ++check;
    }
  }
  moved || (tagName != null?$deleteElementStart_0(this$static.builder, tagName, attrs):$deleteElementEnd_0(this$static.builder));
}

function $finish2(this$static){
  $endChange(this$static.this$0);
  return dynamicCast($finish_2(this$static.builder), 207);
}

function $getLeftNeighbourAnnotation(this$static, key){
  if (this$static.deletionValues.containsKey_1(key)) {
    return dynamicCast(this$static.deletionValues.get_4(key), 1);
  }
  return this$static.this$0.currentLocation != 0?dynamicCast(this$static.this$0.annotations.getAnnotation(this$static.this$0.currentLocation - 1, key), 1):null;
}

function $maybeRenewAnnotation(this$static, key){
  !this$static.newValues.containsKey_1(key) && this$static.requestedValues.containsKey_1(key) && this$static.newValues.put_3(key, dynamicCast(this$static.requestedValues.get_4(key), 1));
}

function $moveAndUpdateAnnotations(this$static, itemCount){
  var annotations, changeKey, currentLocationBackup, ev, ev$iterator, eventLocation, events, finalLocation, i, i$iterator, open_0, iterator;
  $beginUpdate(this$static);
  this$static.this$0.annotations.skip(itemCount);
  finalLocation = this$static.this$0.currentLocation + itemCount;
  if (!this$static.requestedValues.isEmpty()) {
    events = new ArrayList_0;
    annotations = new Box_0;
    currentLocationBackup = this$static.this$0.currentLocation;
    open_0 = ($clinit_2309() , defaultCollectionFactory.createStringSet());
    for (i$iterator = (iterator = $annotationIntervals_1(this$static.this$0, this$static.this$0.currentLocation, finalLocation, this$static.requestedKeys).val$iterable.iterator_0() , new IndexedDocumentImpl$8$1_0(iterator)); i$iterator.val$iterator.hasNext();) {
      i = $next_14(i$iterator);
      this$static.this$0.currentLocation = i.start;
      annotations.boxed = i.annotations;
      this$static.requestedValues.each_2(new IndexedDocumentImpl$NonInvertibleCursor$1_0(this$static, annotations, events, open_0));
    }
    open_0.each_3(new IndexedDocumentImpl$NonInvertibleCursor$2_0(events, finalLocation));
    this$static.this$0.currentLocation = currentLocationBackup;
    for (ev$iterator = new AbstractList$IteratorImpl_0(events); ev$iterator.i < ev$iterator.this$0_0.size_1();) {
      ev = dynamicCast($next_4(ev$iterator), 395);
      eventLocation = ev.index_0;
      if (eventLocation > this$static.this$0.currentLocation) {
        $retain_0(this$static.builder, eventLocation - this$static.this$0.currentLocation);
        this$static.this$0.currentLocation = eventLocation;
      }
      if (ev.getEndKey() != null) {
        $maybeRenewAnnotation(this$static, ev.getEndKey());
        $put_3(this$static.builder.annotationChanges, ev.getEndKey(), null);
      }
       else {
        changeKey = ev.getChangeKey();
        $put_3(this$static.builder.annotationChanges, changeKey, new AnnotationsNormalizer$AnnotationChangeValues_0(ev.getChangeOldValue(), dynamicCast(this$static.requestedValues.get_3(changeKey, null), 1)));
      }
    }
  }
  if (this$static.this$0.currentLocation < finalLocation) {
    $retain_0(this$static.builder, finalLocation - this$static.this$0.currentLocation);
    this$static.this$0.currentLocation = finalLocation;
  }
}

function IndexedDocumentImpl$NonInvertibleCursor_0(this$0){
  this.this$0 = this$0;
  this.requestedValues = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  this.requestedKeys = defaultCollectionFactory.createStringSet();
  this.newValues = defaultCollectionFactory.createStringMap();
  this.endKeys = defaultCollectionFactory.createStringSet();
  this.deletionValues = defaultCollectionFactory.createStringMap();
}

function IndexedDocumentImpl$NonInvertibleCursor(){
}

_ = IndexedDocumentImpl$NonInvertibleCursor_0.prototype = IndexedDocumentImpl$NonInvertibleCursor.prototype = new Object_0;
_.begin = function begin_5(){
}
;
_.characters_0 = function characters_2(characters){
  $beginInsert(this);
  $doCharacters(this.this$0, characters);
  $characters_0(this.builder, characters);
  this.sizeDiffSoFar += characters.length;
}
;
_.deleteCharacters_0 = function deleteCharacters_1(deletionSize){
  var changeKey, check, ev, ev$iterator, eventLocation, events, index, newIndex, oldChars;
  events = $deleteAnnotations(this, deletionSize);
  oldChars = $doDeleteCharacters(this.this$0, deletionSize);
  index = 0;
  check = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  for (ev$iterator = new AbstractList$IteratorImpl_0(events); ev$iterator.i < ev$iterator.this$0_0.size_1();) {
    ev = dynamicCast($next_4(ev$iterator), 395);
    eventLocation = ev.index_0;
    newIndex = eventLocation - this.this$0.currentLocation;
    if (newIndex > index) {
      $deleteCharacters_0(this.builder, oldChars.substr(index, newIndex - index));
      index = newIndex;
    }
    if (ev.getEndKey() != null) {
      $maybeRenewAnnotation(this, ev.getEndKey());
      $put_3(this.builder.annotationChanges, ev.getEndKey(), null);
      check.remove_8(ev.getEndKey());
    }
     else {
      changeKey = ev.getChangeKey();
      $put_3(this.builder.annotationChanges, changeKey, new AnnotationsNormalizer$AnnotationChangeValues_0(ev.getChangeOldValue(), $getLeftNeighbourAnnotation(this, changeKey)));
      check.put_3(ev.getChangeKey(), ev.getChangeOldValue());
    }
  }
  index < deletionSize && $deleteCharacters_0(this.builder, oldChars.substr(index, deletionSize - index));
  this.sizeDiffSoFar -= deletionSize;
  this.this$0.onDeleteCharacters(this.this$0.currentLocation, oldChars);
}
;
_.deleteElementEnd = function deleteElementEnd_1(){
  this.this$0.onDeleteElementEnd();
  $doSingleDelete(this, null, null);
  $deleteCurrentContainer(this.this$0);
  --this.this$0.deletionDepth;
  --this.sizeDiffSoFar;
}
;
_.deleteElementStart_0 = function deleteElementStart_1(){
  var attributes, nodeToDelete, tagName;
  nodeToDelete = this.this$0.substrate.asElement_0(this.this$0.currentContainer.value_0);
  if (nodeToDelete == null) {
    throw new OpCursorException_0('No element to delete at the current location.');
  }
  tagName = this.this$0.substrate.getTagName(nodeToDelete);
  attributes = new AttributesImpl_1(this.this$0.substrate.getAttributes(nodeToDelete));
  this.this$0.deletionDepth == 0 && this.this$0.substrate.removeChild_0(this.this$0.currentParent, nodeToDelete);
  $doSingleDelete(this, tagName, attributes);
  $deleteCurrentContainer(this.this$0);
  ++this.this$0.deletionDepth;
  --this.sizeDiffSoFar;
  this.this$0.onDeleteElementStart(this.this$0.currentLocation, nodeToDelete);
}
;
_.elementEnd = function elementEnd_1(){
  $beginInsert(this);
  $doElementEnd(this.this$0);
  $elementEnd_0(this.builder);
  ++this.sizeDiffSoFar;
}
;
_.elementStart = function elementStart_1(tagName, attributes){
  $beginInsert(this);
  $doElementStart(this.this$0, tagName, attributes);
  $elementStart_0(this.builder, tagName, attributes);
  ++this.sizeDiffSoFar;
}
;
_.endAnnotation = function endAnnotation_0(key){
  this.requestedValues.remove_8(key);
  this.requestedKeys.remove_8(key);
  this.newValues.remove_8(key);
  this.deletionValues.containsKey_1(key) && this.endKeys.add_3(key);
  $doEndAnnotation(this.this$0, key);
}
;
_.finish = function finish_0(){
  var remaining;
  remaining = $size_15(this.this$0) - this.this$0.currentLocation;
  this.endKeys.each_3(new IndexedDocumentImpl$NonInvertibleCursor$5_0(this));
  this.endKeys.clear();
  remaining > 0 && $retain_0(this.builder, remaining);
  this.this$0.currentLocation = $size_15(this.this$0);
}
;
_.getClass$ = function getClass_1169(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor_2_classLit;
}
;
_.replaceAttributes_0 = function replaceAttributes_1(newAttrs){
  var attribute, attribute$iterator, key, node, oldAttributes;
  $beginUpdate(this);
  node = this.this$0.substrate.asElement_0(this.this$0.currentContainer.value_0);
  oldAttributes = new AttributesImpl_1(this.this$0.substrate.getAttributes(node));
  for (attribute$iterator = new ImmutableStateMap$1$1_0(oldAttributes.entrySet); attribute$iterator.iterator.hasNext();) {
    attribute = dynamicCast(attribute$iterator.iterator.next_0(), 394);
    key = attribute.name_0;
    !!$implFindEntry(newAttrs, key, false) || this.this$0.substrate.removeAttribute_0(node, attribute.name_0);
  }
  for (attribute$iterator = new ImmutableStateMap$1$1_0(newAttrs.entrySet); attribute$iterator.iterator.hasNext();) {
    attribute = dynamicCast(attribute$iterator.iterator.next_0(), 394);
    if (attribute.value_0 == null) {
      throw new OpCursorException_0('Null attribute value in setAttributes');
    }
    this.this$0.substrate.setAttribute_0(node, attribute.name_0, attribute.value_0);
  }
  ++this.this$0.currentLocation;
  this.this$0.currentContainer = this.this$0.currentContainer.nextContainer;
  this.this$0.currentParent = node;
  this.this$0.annotations.skip(1);
  $replaceAttributes_0(this.builder, oldAttributes, newAttrs);
  this.this$0.onModifyAttributes(this.this$0.currentParent, oldAttributes, newAttrs);
}
;
_.skip = function skip_0(itemCount){
  $checkRetain(this.this$0, itemCount);
  $moveAndUpdateAnnotations(this, itemCount);
  $moveToCurrentLocation(this.this$0);
}
;
_.startAnnotation_0 = function startAnnotation_0(key, value){
  this.endKeys.contains_0(key) && this.endKeys.remove_8(key);
  $doStartAnnotation(this.this$0, key, value);
  this.requestedValues.put_3(key, value);
  this.requestedKeys.add_3(key);
  this.newValues.put_3(key, value);
}
;
_.updateAttributes_0 = function updateAttributes_1(attributes){
  var attrUpdate, attribute, attribute$iterator, i, name_0, newValue, node, oldAttributes, triples;
  $beginUpdate(this);
  triples = initDim(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, attributes.size_1() * 3, 0);
  node = this.this$0.substrate.asElement_0(this.this$0.currentContainer.value_0);
  oldAttributes = this.this$0.substrate.getAttributes(node);
  i = 0;
  for (attribute$iterator = attributes.entrySet_0().iterator_0(); attribute$iterator.hasNext();) {
    attribute = dynamicCast(attribute$iterator.next_0(), 11);
    name_0 = dynamicCast(attribute.getKey(), 1);
    newValue = dynamicCast(attribute.getValue(), 1);
    triples[i] = name_0;
    triples[i + 1] = dynamicCast(oldAttributes.get(name_0), 1);
    triples[i + 2] = newValue;
    newValue != null?this.this$0.substrate.setAttribute_0(node, name_0, newValue):this.this$0.substrate.removeAttribute_0(node, name_0);
    i += 3;
  }
  ++this.this$0.currentLocation;
  this.this$0.currentContainer = this.this$0.currentContainer.nextContainer;
  this.this$0.currentParent = node;
  this.this$0.annotations.skip(1);
  attrUpdate = new AttributesUpdateImpl_1(triples);
  $updateAttributes_0(this.builder, attrUpdate);
  this.this$0.onModifyAttributes_0(this.this$0.currentParent, attrUpdate);
}
;
_.castableTypeMap$ = {};
_.builder = null;
_.sizeDiffSoFar = 0;
_.this$0 = null;
function $apply_32(this$static, key, value){
  var oldVal;
  oldVal = dynamicCast(dynamicCast(this$static.val$annotations.boxed, 396).get_3(key, null), 1);
  if (value == null?oldVal != null:!$equals_3(value, oldVal)) {
    $add_9(this$static.val$events, new RawAnnotationSet$AnnotationStartEvent_0(this$static.this$1.this$0.currentLocation, key, oldVal));
    this$static.val$open.add_3(key);
  }
   else if (this$static.val$open.contains_0(key)) {
    $add_9(this$static.val$events, new RawAnnotationSet$AnnotationEndEvent_0(this$static.this$1.this$0.currentLocation, key));
    this$static.val$open.remove_8(key);
  }
}

function IndexedDocumentImpl$NonInvertibleCursor$1_0(this$1, val$annotations, val$events, val$open){
  this.this$1 = this$1;
  this.val$annotations = val$annotations;
  this.val$events = val$events;
  this.val$open = val$open;
}

function IndexedDocumentImpl$NonInvertibleCursor$1(){
}

_ = IndexedDocumentImpl$NonInvertibleCursor$1_0.prototype = IndexedDocumentImpl$NonInvertibleCursor$1.prototype = new Object_0;
_.apply_1 = function apply_89(key, value){
  $apply_32(this, key, dynamicCast(value, 1));
}
;
_.getClass$ = function getClass_1170(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
_.val$annotations = null;
_.val$events = null;
_.val$open = null;
function IndexedDocumentImpl$NonInvertibleCursor$2_0(val$events, val$finalLocation){
  this.val$events = val$events;
  this.val$finalLocation = val$finalLocation;
}

function IndexedDocumentImpl$NonInvertibleCursor$2(){
}

_ = IndexedDocumentImpl$NonInvertibleCursor$2_0.prototype = IndexedDocumentImpl$NonInvertibleCursor$2.prototype = new Object_0;
_.apply_4 = function apply_90(key){
  $add_9(this.val$events, new RawAnnotationSet$AnnotationEndEvent_0(this.val$finalLocation, key));
}
;
_.getClass$ = function getClass_1171(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$events = null;
_.val$finalLocation = 0;
function $apply_33(this$static, key, value){
  $put_3(this$static.this$1.builder.annotationChanges, key, new AnnotationsNormalizer$AnnotationChangeValues_0(this$static.this$1.this$0.annotations.getInherited(key), value));
}

function IndexedDocumentImpl$NonInvertibleCursor$3_0(this$1){
  this.this$1 = this$1;
}

function IndexedDocumentImpl$NonInvertibleCursor$3(){
}

_ = IndexedDocumentImpl$NonInvertibleCursor$3_0.prototype = IndexedDocumentImpl$NonInvertibleCursor$3.prototype = new Object_0;
_.apply_1 = function apply_91(key, value){
  $apply_33(this, key, dynamicCast(value, 1));
}
;
_.getClass$ = function getClass_1172(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
function $apply_34(this$static, key, value){
  var current;
  current = dynamicCast(this$static.this$1.this$0.annotations.getAnnotation(this$static.this$1.this$0.currentLocation, key), 1);
  $put_3(this$static.this$1.builder.annotationChanges, key, new AnnotationsNormalizer$AnnotationChangeValues_0(current, value));
}

function IndexedDocumentImpl$NonInvertibleCursor$4_0(this$1){
  this.this$1 = this$1;
}

function IndexedDocumentImpl$NonInvertibleCursor$4(){
}

_ = IndexedDocumentImpl$NonInvertibleCursor$4_0.prototype = IndexedDocumentImpl$NonInvertibleCursor$4.prototype = new Object_0;
_.apply_1 = function apply_92(key, value){
  $apply_34(this, key, dynamicCast(value, 1));
}
;
_.getClass$ = function getClass_1173(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$4_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
function IndexedDocumentImpl$NonInvertibleCursor$5_0(this$1){
  this.this$1 = this$1;
}

function IndexedDocumentImpl$NonInvertibleCursor$5(){
}

_ = IndexedDocumentImpl$NonInvertibleCursor$5_0.prototype = IndexedDocumentImpl$NonInvertibleCursor$5.prototype = new Object_0;
_.apply_4 = function apply_93(key){
  $put_3(this.this$1.builder.annotationChanges, key, null);
}
;
_.getClass$ = function getClass_1174(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$5_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
function IndexedDocumentImpl$NonInvertibleCursor$6_0(val$deletionInherit){
  this.val$deletionInherit = val$deletionInherit;
}

function IndexedDocumentImpl$NonInvertibleCursor$6(){
}

_ = IndexedDocumentImpl$NonInvertibleCursor$6_0.prototype = IndexedDocumentImpl$NonInvertibleCursor$6.prototype = new Object_0;
_.apply_1 = function apply_94(key, value){
  this.val$deletionInherit.put_3(key, dynamicCast(value, 1));
}
;
_.getClass$ = function getClass_1175(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$6_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$deletionInherit = null;
function $apply_36(this$static, key){
  $add_9(this$static.val$events, new RawAnnotationSet$AnnotationStartEvent_0(this$static.val$realStart, key, $getAnnotation_2(this$static.this$1.this$0, this$static.val$realStart, key)));
  this$static.val$open.add_3(key);
}

function IndexedDocumentImpl$NonInvertibleCursor$7_0(this$1, val$events, val$realStart, val$open){
  this.this$1 = this$1;
  this.val$events = val$events;
  this.val$realStart = val$realStart;
  this.val$open = val$open;
}

function IndexedDocumentImpl$NonInvertibleCursor$7(){
}

_ = IndexedDocumentImpl$NonInvertibleCursor$7_0.prototype = IndexedDocumentImpl$NonInvertibleCursor$7.prototype = new Object_0;
_.apply_1 = function apply_95(key, value){
  $apply_36(this, key, dynamicCast(value, 1));
}
;
_.getClass$ = function getClass_1176(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$7_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
_.val$events = null;
_.val$open = null;
_.val$realStart = 0;
function $apply_37(this$static, key, value){
  if (!this$static.val$deletionInherit.containsKey_1(key)) {
    $add_9(this$static.val$events, new RawAnnotationSet$AnnotationStartEvent_0(this$static.val$realStart, key, value));
    this$static.val$open.add_3(key);
  }
}

function IndexedDocumentImpl$NonInvertibleCursor$8_0(val$deletionInherit, val$events, val$realStart, val$open){
  this.val$deletionInherit = val$deletionInherit;
  this.val$events = val$events;
  this.val$realStart = val$realStart;
  this.val$open = val$open;
}

function IndexedDocumentImpl$NonInvertibleCursor$8(){
}

_ = IndexedDocumentImpl$NonInvertibleCursor$8_0.prototype = IndexedDocumentImpl$NonInvertibleCursor$8.prototype = new Object_0;
_.apply_1 = function apply_96(key, value){
  $apply_37(this, key, dynamicCast(value, 1));
}
;
_.getClass$ = function getClass_1177(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$8_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$deletionInherit = null;
_.val$events = null;
_.val$open = null;
_.val$realStart = 0;
function IndexedDocumentImpl$NonInvertibleCursor$9_0(val$events, val$end){
  this.val$events = val$events;
  this.val$end = val$end;
}

function IndexedDocumentImpl$NonInvertibleCursor$9(){
}

_ = IndexedDocumentImpl$NonInvertibleCursor$9_0.prototype = IndexedDocumentImpl$NonInvertibleCursor$9.prototype = new Object_0;
_.apply_4 = function apply_97(key){
  $add_9(this.val$events, new RawAnnotationSet$AnnotationEndEvent_0(this.val$end, key));
}
;
_.getClass$ = function getClass_1178(){
  return Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$9_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$end = 0;
_.val$events = null;
function start_4(doc, element){
  return doc.getLocation_0(new Point$El_0(element, doc.substrate.getFirstChild_0(element)));
}

function $clinit_1864(){
  $clinit_1864 = nullMethod;
  ONE_OBJECT_1 = new Object_1;
  ANOTHER_OBJECT_1 = new Object_1;
}

function $event(this$static, event_0){
  $add_9(dynamicCast($get_7(this$static.events, this$static.events.size_0 - 1), 397).components, event_0);
}

function ObservableIndexedDocument_0(handler, substrate, schema){
  $clinit_1864();
  ObservableIndexedDocument_1.call(this, handler, substrate, new AnnotationTree_0(ONE_OBJECT_1, ANOTHER_OBJECT_1, null), schema);
}

function ObservableIndexedDocument_1(handler, substrate, annotations, schema){
  var listener;
  IndexedDocumentImpl_0.call(this, substrate, annotations, schema);
  this.events = new ArrayList_0;
  new ArrayList_0;
  listener = new ObservableIndexedDocument$1_0(this);
  annotations.listener = listener;
  this.handler = handler;
}

function ObservableIndexedDocument(){
}

_ = ObservableIndexedDocument_0.prototype = ObservableIndexedDocument.prototype = new IndexedDocumentImpl;
_.afterFinish = function afterFinish_0(){
  !!this.handler && $onDocumentEvents(this.handler, $build_1(dynamicCast($get_7(this.events, 0), 397)));
  $clear_4(this.events);
}
;
_.beforeBegin = function beforeBegin_0(){
  $add_9(this.events, new EventBundleImpl$Builder_0);
}
;
_.getClass$ = function getClass_1179(){
  return Lorg_waveprotocol_wave_model_document_indexed_ObservableIndexedDocument_2_classLit;
}
;
_.onCharacters = function onCharacters_0(location_0, characters){
  this.depth == 0 && $event(this, new DocumentEvent$TextInserted_0(location_0, characters));
}
;
_.onDeleteCharacters = function onDeleteCharacters_0(location_0, characters){
  this.depth == 0 && $event(this, new DocumentEvent$TextDeleted_0(location_0, characters));
  !!this.deletion && $addText(this.deletion, characters);
}
;
_.onDeleteElementEnd = function onDeleteElementEnd_0(){
  $addElementEnd(this.deletion);
  --this.depth;
  if (this.depth == 0) {
    $event(this, $build_0(this.deletion));
    this.deletion = null;
  }
}
;
_.onDeleteElementStart = function onDeleteElementStart_0(location_0, element){
  this.depth == 0 && (this.deletion = new DocumentEvent$ContentDeleted$Builder_0(location_0, element));
  ++this.depth;
  $addDeletedElement(dynamicCast($get_7(this.events, this.events.size_0 - 1), 397), element);
  $addElementStart(this.deletion, this.substrate.getTagName(element), this.substrate.getAttributes(element));
}
;
_.onElementEnd = function onElementEnd_0(){
  --this.depth;
}
;
_.onElementStart = function onElementStart_0(element){
  this.depth == 0 && $event(this, new DocumentEvent$ContentInserted_0(element));
  $addInsertedElement(dynamicCast($get_7(this.events, this.events.size_0 - 1), 397), element);
  ++this.depth;
}
;
_.onModifyAttributes_0 = function onModifyAttributes_1(element, update){
  $event(this, new DocumentEvent$AttributesModified_1(element, update));
}
;
_.onModifyAttributes = function onModifyAttributes_2(element, oldAttributes, newAttributes){
  $event(this, new DocumentEvent$AttributesModified_0(element, oldAttributes, newAttributes));
}
;
_.castableTypeMap$ = {19:1};
_.deletion = null;
_.depth = 0;
_.handler = null;
var ANOTHER_OBJECT_1, ONE_OBJECT_1;
function ObservableIndexedDocument$1_0(this$0){
  this.this$0 = this$0;
}

function ObservableIndexedDocument$1(){
}

_ = ObservableIndexedDocument$1_0.prototype = ObservableIndexedDocument$1.prototype = new Object_0;
_.getClass$ = function getClass_1180(){
  return Lorg_waveprotocol_wave_model_document_indexed_ObservableIndexedDocument$1_2_classLit;
}
;
_.onAnnotationChange = function onAnnotationChange_0(start, end, key, newValue){
  $event(this.this$0, new DocumentEvent$AnnotationChanged_0(start, end, key, dynamicCast(newValue, 1)));
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function RawAnnotationSet$AnnotationEvent(){
}

_ = RawAnnotationSet$AnnotationEvent.prototype = new Object_0;
_.getClass$ = function getClass_1181(){
  return Lorg_waveprotocol_wave_model_document_indexed_RawAnnotationSet$AnnotationEvent_2_classLit;
}
;
_.castableTypeMap$ = {395:1};
_.index_0 = 0;
_.key = null;
function RawAnnotationSet$AnnotationEndEvent_0(index, key){
  this.index_0 = index;
  this.key = key;
}

function RawAnnotationSet$AnnotationEndEvent(){
}

_ = RawAnnotationSet$AnnotationEndEvent_0.prototype = RawAnnotationSet$AnnotationEndEvent.prototype = new RawAnnotationSet$AnnotationEvent;
_.getChangeKey = function getChangeKey(){
  return null;
}
;
_.getChangeOldValue = function getChangeOldValue(){
  return null;
}
;
_.getClass$ = function getClass_1182(){
  return Lorg_waveprotocol_wave_model_document_indexed_RawAnnotationSet$AnnotationEndEvent_2_classLit;
}
;
_.getEndKey = function getEndKey(){
  return this.key;
}
;
_.toString$ = function toString_99(){
  return 'AnnotationEndEvent ' + this.key + ' @' + this.index_0;
}
;
_.castableTypeMap$ = {395:1};
function RawAnnotationSet$AnnotationStartEvent_0(index, key, value){
  this.index_0 = index;
  this.key = key;
  this.value_0 = value;
}

function RawAnnotationSet$AnnotationStartEvent(){
}

_ = RawAnnotationSet$AnnotationStartEvent_0.prototype = RawAnnotationSet$AnnotationStartEvent.prototype = new RawAnnotationSet$AnnotationEvent;
_.getChangeKey = function getChangeKey_0(){
  return this.key;
}
;
_.getChangeOldValue = function getChangeOldValue_0(){
  return this.value_0;
}
;
_.getClass$ = function getClass_1183(){
  return Lorg_waveprotocol_wave_model_document_indexed_RawAnnotationSet$AnnotationStartEvent_2_classLit;
}
;
_.getEndKey = function getEndKey_0(){
  return null;
}
;
_.toString$ = function toString_100(){
  return 'AnnotationStart ' + this.key + '=' + this.value_0 + ' @' + this.index_0;
}
;
_.castableTypeMap$ = {395:1};
_.value_0 = null;
function StubModifiableAnnotations_0(){
}

function StubModifiableAnnotations(){
}

_ = StubModifiableAnnotations_0.prototype = StubModifiableAnnotations.prototype = new Object_0;
_.annotationIntervals = function annotationIntervals_4(start, end, keys){
  !keys && (keys = ($clinit_2309() , defaultCollectionFactory.createStringSet()));
  return new GenericAnnotationIntervalIterable_0(this, start, end, keys);
}
;
_.begin = function begin_6(){
}
;
_.delete_$ = function delete_$_0(deleteSize){
  this.size_0 -= deleteSize;
}
;
_.endAnnotation = function endAnnotation_1(key){
}
;
_.finish = function finish_1(){
}
;
_.firstAnnotationChange = function firstAnnotationChange_4(start, end, key, fromValue){
  return -1;
}
;
_.forEachAnnotationAt = function forEachAnnotationAt_4(location_0, callback){
}
;
_.getAnnotation = function getAnnotation_4(start, key){
  return null;
}
;
_.getClass$ = function getClass_1184(){
  return Lorg_waveprotocol_wave_model_document_indexed_StubModifiableAnnotations_2_classLit;
}
;
_.getInherited = function getInherited_0(key){
  return null;
}
;
_.insert = function insert_0(insertSize){
  this.size_0 += insertSize;
}
;
_.knownKeysLive = function knownKeysLive_0(){
  return $clinit_2309() , defaultCollectionFactory.createStringSet();
}
;
_.lastAnnotationChange = function lastAnnotationChange_4(start, end, key, fromValue){
  return -1;
}
;
_.size_1 = function size_37(){
  return this.size_0;
}
;
_.skip = function skip_1(skipSize){
}
;
_.startAnnotation = function startAnnotation_1(key, value){
}
;
_.castableTypeMap$ = {};
_.size_0 = 0;
function $clinit_1874(){
  $clinit_1874 = nullMethod;
  TRIPLET_COMPARATOR = new AnnotationBoundaryMapBuilder$1_0;
}

function AnnotationBoundaryMapBuilder_0(){
  $clinit_1874();
  this.endKeys = ($clinit_2309() , defaultCollectionFactory.createStringSet());
  this.changes = defaultCollectionFactory.createStringMap();
}

function AnnotationBoundaryMapBuilder(){
}

_ = AnnotationBoundaryMapBuilder_0.prototype = AnnotationBoundaryMapBuilder.prototype = new Object_0;
_.getClass$ = function getClass_1185(){
  return Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder_2_classLit;
}
;
_.castableTypeMap$ = {};
var TRIPLET_COMPARATOR;
function AnnotationBoundaryMapBuilder$1_0(){
}

function AnnotationBoundaryMapBuilder$1(){
}

_ = AnnotationBoundaryMapBuilder$1_0.prototype = AnnotationBoundaryMapBuilder$1.prototype = new Object_0;
_.compare = function compare_6(a_0, b){
  return compareTo_5(dynamicCast(a_0, 144).key, dynamicCast(b, 144).key);
}
;
_.getClass$ = function getClass_1186(){
  return Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function AnnotationBoundaryMapBuilder$2_0(val$ends){
  this.val$ends = val$ends;
}

function AnnotationBoundaryMapBuilder$2(){
}

_ = AnnotationBoundaryMapBuilder$2_0.prototype = AnnotationBoundaryMapBuilder$2.prototype = new Object_0;
_.apply_4 = function apply_98(key){
  this.val$ends[this.i] = key;
  ++this.i;
}
;
_.getClass$ = function getClass_1187(){
  return Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.i = 0;
_.val$ends = null;
function $apply_38(this$static, key, value){
  this$static.val$changes[this$static.i] = new AnnotationBoundaryMapBuilder$Triplet_0(key, dynamicCast(value.first, 1), dynamicCast(value.second, 1));
  ++this$static.i;
}

function AnnotationBoundaryMapBuilder$3_0(val$changes){
  this.val$changes = val$changes;
}

function AnnotationBoundaryMapBuilder$3(){
}

_ = AnnotationBoundaryMapBuilder$3_0.prototype = AnnotationBoundaryMapBuilder$3.prototype = new Object_0;
_.apply_1 = function apply_99(key, value){
  $apply_38(this, key, dynamicCast(value, 398));
}
;
_.getClass$ = function getClass_1188(){
  return Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.i = 0;
_.val$changes = null;
function AnnotationBoundaryMapBuilder$AnnotationBoundaryMapImpl_0(ends, changes){
  this.ends = ends;
  this.changes = changes;
}

function AnnotationBoundaryMapBuilder$AnnotationBoundaryMapImpl(){
}

_ = AnnotationBoundaryMapBuilder$AnnotationBoundaryMapImpl_0.prototype = AnnotationBoundaryMapBuilder$AnnotationBoundaryMapImpl.prototype = new Object_0;
_.changeSize = function changeSize_0(){
  return this.changes.length;
}
;
_.endSize = function endSize_0(){
  return this.ends.length;
}
;
_.getChangeKey_0 = function getChangeKey_1(i){
  return this.changes[i].key;
}
;
_.getClass$ = function getClass_1189(){
  return Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$AnnotationBoundaryMapImpl_2_classLit;
}
;
_.getEndKey_0 = function getEndKey_1(i){
  return this.ends[i];
}
;
_.getNewValue = function getNewValue(i){
  return this.changes[i].newValue;
}
;
_.getOldValue = function getOldValue(i){
  return this.changes[i].oldValue;
}
;
_.castableTypeMap$ = {409:1};
_.changes = null;
_.ends = null;
function AnnotationBoundaryMapBuilder$Triplet_0(key, oldValue, newValue){
  this.key = key;
  this.oldValue = oldValue;
  this.newValue = newValue;
}

function AnnotationBoundaryMapBuilder$Triplet(){
}

_ = AnnotationBoundaryMapBuilder$Triplet_0.prototype = AnnotationBoundaryMapBuilder$Triplet.prototype = new Object_0;
_.getClass$ = function getClass_1190(){
  return Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$Triplet_2_classLit;
}
;
_.castableTypeMap$ = {144:1};
_.key = null;
_.newValue = null;
_.oldValue = null;
function $clinit_1880(){
  $clinit_1880 = nullMethod;
  EMPTY_MAP_0 = new AttributesImpl_0;
}

var EMPTY_MAP_0;
function Automatons$1_0(val$doc){
  this.val$doc = val$doc;
}

function Automatons$1(){
}

_ = Automatons$1_0.prototype = Automatons$1.prototype = new Object_0;
_.annotationsAt = function annotationsAt(pos){
  var annotations;
  checkElementIndex(pos, $size_15(this.val$doc));
  annotations = new Automatons$1$1AnnoMap_0;
  $knownKeys(this.val$doc).each_3(new Automatons$1$1_0(this.val$doc, pos, annotations));
  return annotations;
}
;
_.attributesAt = function attributesAt(pos){
  var el;
  el = elementAfter(this.val$doc, $locate_0(this.val$doc, pos));
  return el != null && (el == null?null:el) !== maskUndefined(this.val$doc.substrate.getDocumentElement())?new AttributesImpl_1(this.val$doc.substrate.getAttributes(el)):null;
}
;
_.charAt_0 = function charAt(pos){
  var str;
  str = getText(this.val$doc, pos, pos + 1);
  return str.length > 0?str.charCodeAt(0):-1;
}
;
_.elementEndingAt = function elementEndingAt(pos){
  var el;
  el = elementEndingAt_1(this.val$doc, $locate_0(this.val$doc, pos));
  return el != null && (el == null?null:el) !== maskUndefined(this.val$doc.substrate.getDocumentElement())?this.val$doc.substrate.getTagName(el):null;
}
;
_.elementStartingAt = function elementStartingAt(pos){
  var el;
  el = elementAfter(this.val$doc, $locate_0(this.val$doc, pos));
  return el != null && (el == null?null:el) !== maskUndefined(this.val$doc.substrate.getDocumentElement())?this.val$doc.substrate.getTagName(el):null;
}
;
_.firstAnnotationChange_0 = function firstAnnotationChange_5(start, end, key, fromValue){
  return $firstAnnotationChange_2(this.val$doc, start, end, key, fromValue);
}
;
_.getAnnotation_0 = function getAnnotation_5(pos, key){
  return $getAnnotation_2(this.val$doc, pos, key);
}
;
_.getClass$ = function getClass_1191(){
  return Lorg_waveprotocol_wave_model_document_operation_Automatons$1_2_classLit;
}
;
_.length_1 = function length_1(){
  return $size_15(this.val$doc);
}
;
_.nthEnclosingElementTag = function nthEnclosingElementTag(insertionPoint, depth){
  var el;
  el = enclosingElement(this.val$doc, $locate_0(this.val$doc, insertionPoint).container);
  while (depth > 0 && el != null && (el == null?null:el) !== maskUndefined(this.val$doc.substrate.getDocumentElement())) {
    el = this.val$doc.substrate.getParentElement(el);
  }
  return el != null && (el == null?null:el) !== maskUndefined(this.val$doc.substrate.getDocumentElement())?this.val$doc.substrate.getTagName(el):null;
}
;
_.toString$ = function toString_101(){
  return 'Automatons.fromReadable(): ' + this.val$doc;
}
;
_.castableTypeMap$ = {};
_.val$doc = null;
function Automatons$1$1_0(val$doc, val$pos, val$annotations){
  this.val$doc = val$doc;
  this.val$pos = val$pos;
  this.val$annotations = val$annotations;
}

function Automatons$1$1(){
}

_ = Automatons$1$1_0.prototype = Automatons$1$1.prototype = new Object_0;
_.apply_4 = function apply_100(key){
  var value;
  value = $getAnnotation_2(this.val$doc, this.val$pos, key);
  value != null && $put_0(this.val$annotations, key, value);
}
;
_.getClass$ = function getClass_1192(){
  return Lorg_waveprotocol_wave_model_document_operation_Automatons$1$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$annotations = null;
_.val$doc = null;
_.val$pos = 0;
function Automatons$1$1AnnoMap_0(){
  $clearImpl(this);
}

function Automatons$1$1AnnoMap(){
}

_ = Automatons$1$1AnnoMap_0.prototype = Automatons$1$1AnnoMap.prototype = new HashMap;
_.getClass$ = function getClass_1193(){
  return Lorg_waveprotocol_wave_model_document_operation_Automatons$1$1AnnoMap_2_classLit;
}
;
_.updateWithNoCompatibilityCheck = function updateWithNoCompatibilityCheck(mutation){
  return dynamicCast($updateWith(new AnnotationMapImpl_1(this), mutation, false), 399);
}
;
_.castableTypeMap$ = {9:1, 40:1};
function $clinit_1886(){
  $clinit_1886 = nullMethod;
  ANNOTATION_BOUNDARY = new DocInitializationComponentType_0('annotation boundary');
  CHARACTERS = new DocInitializationComponentType_0('characters');
  ELEMENT_START_0 = new DocInitializationComponentType_0('element start');
  ELEMENT_END_0 = new DocInitializationComponentType_0('element end');
  RETAIN = new DocOpComponentType_0('retain');
  DELETE_CHARACTERS = new DocOpComponentType_0('delete characters');
  DELETE_ELEMENT_START = new DocOpComponentType_0('delete element start');
  DELETE_ELEMENT_END = new DocOpComponentType_0('delete element end');
  REPLACE_ATTRIBUTES = new DocOpComponentType_0('replace attributes');
  UPDATE_ATTRIBUTES = new DocOpComponentType_0('update attributes');
}

function DocOpComponentType_0(name_0){
  this.name_0 = name_0;
}

function DocOpComponentType(){
}

_ = DocOpComponentType_0.prototype = DocOpComponentType.prototype = new Object_0;
_.getClass$ = function getClass_1194(){
  return Lorg_waveprotocol_wave_model_document_operation_DocOpComponentType_2_classLit;
}
;
_.toString$ = function toString_102(){
  return this.name_0;
}
;
_.castableTypeMap$ = {};
_.name_0 = null;
var ANNOTATION_BOUNDARY, CHARACTERS, DELETE_CHARACTERS, DELETE_ELEMENT_END, DELETE_ELEMENT_START, ELEMENT_END_0, ELEMENT_START_0, REPLACE_ATTRIBUTES, RETAIN, UPDATE_ATTRIBUTES;
function DocInitializationComponentType_0(name_0){
  this.name_0 = name_0;
}

function DocInitializationComponentType(){
}

_ = DocInitializationComponentType_0.prototype = DocInitializationComponentType.prototype = new DocOpComponentType;
_.getClass$ = function getClass_1195(){
  return Lorg_waveprotocol_wave_model_document_operation_DocInitializationComponentType_2_classLit;
}
;
_.castableTypeMap$ = {424:1};
function $delete_4(this$static, size){
  this$static.scanPoint <= this$static.mutatingLocation && (this$static.mutatingLocation = max_1(this$static.scanPoint, this$static.mutatingLocation - size));
}

function $insert_5(this$static, size){
  if (this$static.scanPoint < this$static.mutatingLocation) {
    this$static.mutatingLocation += size;
    this$static.scanPoint += size;
  }
}

function LocationModifier_0(location_0){
  this.mutatingLocation = location_0;
}

function transformLocation(op, location_0){
  var modifier;
  modifier = new LocationModifier_0(location_0);
  op.apply_8(modifier);
  return modifier.mutatingLocation;
}

function LocationModifier(){
}

_ = LocationModifier_0.prototype = LocationModifier.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_1(m_0){
}
;
_.characters_0 = function characters_3(characters){
  $insert_5(this, characters.length);
}
;
_.deleteCharacters = function deleteCharacters_2(chars){
  $delete_4(this, chars.length);
}
;
_.deleteElementEnd = function deleteElementEnd_2(){
  this.scanPoint <= this.mutatingLocation && (this.mutatingLocation = max_1(this.scanPoint, this.mutatingLocation - 1));
}
;
_.deleteElementStart = function deleteElementStart_2(type, attributes){
  this.scanPoint <= this.mutatingLocation && (this.mutatingLocation = max_1(this.scanPoint, this.mutatingLocation - 1));
}
;
_.elementEnd = function elementEnd_2(){
  $insert_5(this, 1);
}
;
_.elementStart = function elementStart_2(type, attributes){
  $insert_5(this, 1);
}
;
_.getClass$ = function getClass_1196(){
  return Lorg_waveprotocol_wave_model_document_operation_LocationModifier_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_2(oldAttributes, newAttributes){
  this.scanPoint += 1;
}
;
_.retain = function retain_1(itemCount){
  this.scanPoint += itemCount;
}
;
_.updateAttributes = function updateAttributes_2(attributesUpdate){
  this.scanPoint += 1;
}
;
_.castableTypeMap$ = {};
_.mutatingLocation = 0;
_.scanPoint = 0;
function $apply_39(this$static, document_0){
  var i, mutationComponent, mutationComponent$iterator;
  document_0.begin();
  if (!printing) {
    printing = true;
    printing = false;
  }
  i = 0;
  for (mutationComponent$iterator = new AbstractList$IteratorImpl_0(this$static.mutationList); mutationComponent$iterator.i < mutationComponent$iterator.this$0_0.size_1();) {
    mutationComponent = dynamicCast($next_4(mutationComponent$iterator), 400);
    ++i;
    mutationComponent.apply_13(document_0);
  }
  document_0.finish();
}

function Nindo_0(mutationList){
  this.mutationList = new ArrayList_1(mutationList);
}

function Nindo(){
}

_ = Nindo_0.prototype = Nindo.prototype = new Object_0;
_.getClass$ = function getClass_1197(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo_2_classLit;
}
;
_.toString$ = function toString_103(){
  var builder;
  builder = new StringBuilder_0;
  $apply_39(this, new Nindo$1_0(builder));
  return builder.impl.string;
}
;
_.castableTypeMap$ = {};
_.mutationList = null;
var printing = false;
function Nindo$1_0(val$builder){
  this.val$builder = val$builder;
}

function Nindo$1(){
}

_ = Nindo$1_0.prototype = Nindo$1.prototype = new Object_0;
_.begin = function begin_7(){
  $append_11(this.val$builder, '{');
}
;
_.characters_0 = function characters_4(characters){
  var regex, replacement;
  $append_11(this.val$builder, '++"' + $replace_1((regex = $replaceAll('\\', '([/\\\\\\.\\*\\+\\?\\|\\(\\)\\[\\]\\{\\}$^])', '\\\\$1') , replacement = $replaceAll($replaceAll('\\\\', '\\\\', '\\\\\\\\'), '\\$', '\\\\$') , $replaceAll(characters, regex, replacement)), '"', '\\"') + '"; ');
}
;
_.deleteCharacters_0 = function deleteCharacters_3(deletionSize){
  $append_11(this.val$builder, '-- ' + deletionSize + '; ');
}
;
_.deleteElementEnd = function deleteElementEnd_3(){
  $append_11(this.val$builder, 'x>; ');
}
;
_.deleteElementStart_0 = function deleteElementStart_3(){
  $append_11(this.val$builder, 'x<; ');
}
;
_.elementEnd = function elementEnd_3(){
  $append_11(this.val$builder, '>>; ');
}
;
_.elementStart = function elementStart_3(tagName, attributes){
  $append_11(this.val$builder, '<< ' + tagName + ' ' + attributes + '; ');
}
;
_.endAnnotation = function endAnnotation_2(key){
  $append_11(this.val$builder, ')) ' + key + '; ');
}
;
_.finish = function finish_2(){
  $append_11(this.val$builder, '}');
}
;
_.getClass$ = function getClass_1198(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$1_2_classLit;
}
;
_.replaceAttributes_0 = function replaceAttributes_3(attributes){
  $append_11(this.val$builder, 's@ ' + attributes + '; ');
}
;
_.skip = function skip_2(skipSize){
  $append_11(this.val$builder, '__' + skipSize + '; ');
}
;
_.startAnnotation_0 = function startAnnotation_2(key, value){
  var regex, replacement;
  $append_11(this.val$builder, '(( ' + key + '=' + (value == null?'null':'"' + $replace_1((regex = $replaceAll('\\', '([/\\\\\\.\\*\\+\\?\\|\\(\\)\\[\\]\\{\\}$^])', '\\\\$1') , replacement = $replaceAll($replaceAll('\\\\', '\\\\', '\\\\\\\\'), '\\$', '\\\\$') , $replaceAll(value, regex, replacement)), '"', '\\"') + '"') + '; ');
}
;
_.toString$ = function toString_104(){
  return this.val$builder.impl.string;
}
;
_.updateAttributes_0 = function updateAttributes_3(attributes){
  $append_11(this.val$builder, 'u@ ' + attributes + '; ');
}
;
_.castableTypeMap$ = {};
_.val$builder = null;
function Nindo$2_0(val$b){
  this.val$b = val$b;
}

function Nindo$2(){
}

_ = Nindo$2_0.prototype = Nindo$2.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_2(map){
  var i;
  for (i = 0; i < map.endSize(); ++i) {
    $add_9(this.val$b.mutationList, new Nindo$EndAnnotation_0(map.getEndKey_0(i)));
  }
  for (i = 0; i < map.changeSize(); ++i) {
    $add_9(this.val$b.mutationList, new Nindo$StartAnnotation_0(map.getChangeKey_0(i), map.getNewValue(i)));
  }
}
;
_.characters_0 = function characters_5(chars){
  $characters(this.val$b, chars);
}
;
_.deleteCharacters = function deleteCharacters_4(chars){
  $add_9(this.val$b.mutationList, new Nindo$DeleteCharacters_0(chars.length));
}
;
_.deleteElementEnd = function deleteElementEnd_4(){
  $add_9(this.val$b.mutationList, ($clinit_1902() , INSTANCE_12));
}
;
_.deleteElementStart = function deleteElementStart_4(type, attrs){
  $add_9(this.val$b.mutationList, ($clinit_1903() , INSTANCE_13));
}
;
_.elementEnd = function elementEnd_4(){
  $add_9(this.val$b.mutationList, ($clinit_1904() , INSTANCE_14));
}
;
_.elementStart = function elementStart_4(type, attrs){
  $add_9(this.val$b.mutationList, new Nindo$ElementStart_0(type, attrs));
}
;
_.getClass$ = function getClass_1199(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$2_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_4(oldAttrs, newAttrs){
  $add_9(this.val$b.mutationList, new Nindo$ReplaceAttributes_0(newAttrs));
}
;
_.retain = function retain_2(itemCount){
  $add_9(this.val$b.mutationList, new Nindo$Skip_0(itemCount));
}
;
_.updateAttributes = function updateAttributes_4(attrUpdate){
  var i, updates;
  updates = new HashMap_0;
  for (i = 0; i < attrUpdate.updates.size_1(); ++i) {
    updates.put(dynamicCast(attrUpdate.updates.get_0(i), 384).name_0, dynamicCast(attrUpdate.updates.get_0(i), 384).newValue);
  }
  $add_9(this.val$b.mutationList, new Nindo$UpdateAttributes_0(updates));
}
;
_.castableTypeMap$ = {};
_.val$b = null;
function $characters(this$static, characters){
  !characters.length || $add_9(this$static.mutationList, new Nindo$Characters_0(characters));
}

function Nindo$Builder_0(){
  this.mutationList = new ArrayList_0;
}

function Nindo$Builder(){
}

_ = Nindo$Builder_0.prototype = Nindo$Builder.prototype = new Object_0;
_.begin = function begin_8(){
  checkState_2(!this.hasBeenUsed, 'Cannot reuse a builder');
  this.hasBeenUsed = true;
}
;
_.characters_0 = function characters_6(characters){
  !characters.length || $add_9(this.mutationList, new Nindo$Characters_0(characters));
}
;
_.deleteCharacters_0 = function deleteCharacters_5(deletionSize){
  $add_9(this.mutationList, new Nindo$DeleteCharacters_0(deletionSize));
}
;
_.deleteElementEnd = function deleteElementEnd_5(){
  $add_9(this.mutationList, ($clinit_1902() , INSTANCE_12));
}
;
_.deleteElementStart_0 = function deleteElementStart_5(){
  $add_9(this.mutationList, ($clinit_1903() , INSTANCE_13));
}
;
_.elementEnd = function elementEnd_5(){
  $add_9(this.mutationList, ($clinit_1904() , INSTANCE_14));
}
;
_.elementStart = function elementStart_5(tagName, attributes){
  $add_9(this.mutationList, new Nindo$ElementStart_0(tagName, attributes));
}
;
_.endAnnotation = function endAnnotation_3(key){
  $add_9(this.mutationList, new Nindo$EndAnnotation_0(key));
}
;
_.finish = function finish_3(){
}
;
_.getClass$ = function getClass_1200(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$Builder_2_classLit;
}
;
_.replaceAttributes_0 = function replaceAttributes_5(attributes){
  $add_9(this.mutationList, new Nindo$ReplaceAttributes_0(attributes));
}
;
_.skip = function skip_3(skipSize){
  $add_9(this.mutationList, new Nindo$Skip_0(skipSize));
}
;
_.startAnnotation_0 = function startAnnotation_3(key, value){
  $add_9(this.mutationList, new Nindo$StartAnnotation_0(key, value));
}
;
_.updateAttributes_0 = function updateAttributes_5(attributes){
  $add_9(this.mutationList, new Nindo$UpdateAttributes_0(attributes));
}
;
_.castableTypeMap$ = {};
_.hasBeenUsed = false;
function Nindo$MutationComponent(){
}

_ = Nindo$MutationComponent.prototype = new Object_0;
_.getClass$ = function getClass_1201(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$MutationComponent_2_classLit;
}
;
_.castableTypeMap$ = {400:1};
function Nindo$Characters_0(characters){
  this.characters = characters;
}

function Nindo$Characters(){
}

_ = Nindo$Characters_0.prototype = Nindo$Characters.prototype = new Nindo$MutationComponent;
_.apply_13 = function apply_101(document_0){
  document_0.characters_0(this.characters);
}
;
_.getClass$ = function getClass_1202(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$Characters_2_classLit;
}
;
_.castableTypeMap$ = {400:1};
_.characters = null;
function Nindo$DeleteCharacters_0(deletionSize){
  this.deletionSize = deletionSize;
}

function Nindo$DeleteCharacters(){
}

_ = Nindo$DeleteCharacters_0.prototype = Nindo$DeleteCharacters.prototype = new Nindo$MutationComponent;
_.apply_13 = function apply_102(document_0){
  document_0.deleteCharacters_0(this.deletionSize);
}
;
_.getClass$ = function getClass_1203(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$DeleteCharacters_2_classLit;
}
;
_.castableTypeMap$ = {400:1};
_.deletionSize = 0;
function $clinit_1902(){
  $clinit_1902 = nullMethod;
  INSTANCE_12 = new Nindo$DeleteElementEnd_0;
}

function Nindo$DeleteElementEnd_0(){
}

function Nindo$DeleteElementEnd(){
}

_ = Nindo$DeleteElementEnd_0.prototype = Nindo$DeleteElementEnd.prototype = new Nindo$MutationComponent;
_.apply_13 = function apply_103(document_0){
  document_0.deleteElementEnd();
}
;
_.getClass$ = function getClass_1204(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$DeleteElementEnd_2_classLit;
}
;
_.castableTypeMap$ = {400:1};
var INSTANCE_12;
function $clinit_1903(){
  $clinit_1903 = nullMethod;
  INSTANCE_13 = new Nindo$DeleteElementStart_0;
}

function Nindo$DeleteElementStart_0(){
}

function Nindo$DeleteElementStart(){
}

_ = Nindo$DeleteElementStart_0.prototype = Nindo$DeleteElementStart.prototype = new Nindo$MutationComponent;
_.apply_13 = function apply_104(document_0){
  document_0.deleteElementStart_0();
}
;
_.getClass$ = function getClass_1205(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$DeleteElementStart_2_classLit;
}
;
_.castableTypeMap$ = {400:1};
var INSTANCE_13;
function $clinit_1904(){
  $clinit_1904 = nullMethod;
  INSTANCE_14 = new Nindo$ElementEnd_0;
}

function Nindo$ElementEnd_0(){
}

function Nindo$ElementEnd(){
}

_ = Nindo$ElementEnd_0.prototype = Nindo$ElementEnd.prototype = new Nindo$MutationComponent;
_.apply_13 = function apply_105(document_0){
  document_0.elementEnd();
}
;
_.getClass$ = function getClass_1206(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$ElementEnd_2_classLit;
}
;
_.castableTypeMap$ = {400:1};
var INSTANCE_14;
function Nindo$ElementStart_0(tagName, attributes){
  this.tagName_0 = tagName;
  this.attributes = attributes;
}

function Nindo$ElementStart(){
}

_ = Nindo$ElementStart_0.prototype = Nindo$ElementStart.prototype = new Nindo$MutationComponent;
_.apply_13 = function apply_106(document_0){
  document_0.elementStart(this.tagName_0, this.attributes);
}
;
_.getClass$ = function getClass_1207(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$ElementStart_2_classLit;
}
;
_.castableTypeMap$ = {400:1};
_.attributes = null;
_.tagName_0 = null;
function Nindo$EndAnnotation_0(key){
  checkNotNull_1(key, 'Null annotation key');
  this.key = key;
}

function Nindo$EndAnnotation(){
}

_ = Nindo$EndAnnotation_0.prototype = Nindo$EndAnnotation.prototype = new Nindo$MutationComponent;
_.apply_13 = function apply_107(document_0){
  document_0.endAnnotation(this.key);
}
;
_.getClass$ = function getClass_1208(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$EndAnnotation_2_classLit;
}
;
_.castableTypeMap$ = {400:1};
_.key = null;
function Nindo$ReplaceAttributes_0(attributes){
  this.attributes = attributes;
}

function Nindo$ReplaceAttributes(){
}

_ = Nindo$ReplaceAttributes_0.prototype = Nindo$ReplaceAttributes.prototype = new Nindo$MutationComponent;
_.apply_13 = function apply_108(document_0){
  document_0.replaceAttributes_0(this.attributes);
}
;
_.getClass$ = function getClass_1209(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$ReplaceAttributes_2_classLit;
}
;
_.castableTypeMap$ = {400:1};
_.attributes = null;
function Nindo$Skip_0(skipSize){
  this.skipSize = skipSize;
}

function Nindo$Skip(){
}

_ = Nindo$Skip_0.prototype = Nindo$Skip.prototype = new Nindo$MutationComponent;
_.apply_13 = function apply_109(document_0){
  document_0.skip(this.skipSize);
}
;
_.getClass$ = function getClass_1210(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$Skip_2_classLit;
}
;
_.castableTypeMap$ = {400:1, 401:1};
_.skipSize = 0;
function Nindo$StartAnnotation_0(key, value){
  checkNotNull_1(key, 'Null annotation key');
  this.key = key;
  this.value_0 = value;
}

function Nindo$StartAnnotation(){
}

_ = Nindo$StartAnnotation_0.prototype = Nindo$StartAnnotation.prototype = new Nindo$MutationComponent;
_.apply_13 = function apply_110(document_0){
  document_0.startAnnotation_0(this.key, this.value_0);
}
;
_.getClass$ = function getClass_1211(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$StartAnnotation_2_classLit;
}
;
_.castableTypeMap$ = {400:1};
_.key = null;
_.value_0 = null;
function Nindo$UpdateAttributes_0(update){
  this.attributesUpdate = update;
}

function Nindo$UpdateAttributes(){
}

_ = Nindo$UpdateAttributes_0.prototype = Nindo$UpdateAttributes.prototype = new Nindo$MutationComponent;
_.apply_13 = function apply_111(document_0){
  document_0.updateAttributes_0(this.attributesUpdate);
}
;
_.getClass$ = function getClass_1212(){
  return Lorg_waveprotocol_wave_model_document_operation_Nindo$UpdateAttributes_2_classLit;
}
;
_.castableTypeMap$ = {400:1};
_.attributesUpdate = null;
function $addViolation(a_0, v){
  !!a_0 && $add_9(a_0.operationIllFormed, v);
  return $clinit_2006() , ILL_FORMED;
}

function $addViolation_0(a_0, v){
  !!a_0 && $add_9(a_0.operationInvalid, v);
  return $clinit_2006() , INVALID_DOCUMENT;
}

function $addViolation_1(a_0, v){
  !!a_0 && $add_9(a_0.schemaViolations, v);
  return $clinit_2006() , INVALID_SCHEMA;
}

function $canIncreaseLength(this$static, delta){
  return delta <= 429496729 - this$static.resultingLength;
}

function $checkChangeAttributes(this$static, attr, v, allowNullValues){
  var actualTag;
  if (this$static.stack_0.size_0 != 0) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('attribute change inside insert or delete', this$static.effectivePos, this$static.resultingPos));
  }
  if ($effectiveDocSymbol(this$static) != ($clinit_1915() , OPEN)) {
    return $addViolation_0(v, new DocOpAutomaton$OperationInvalid_0('no element start to change attributes here', this$static.effectivePos, this$static.resultingPos));
  }
  actualTag = $effectiveDocSymbolTag(this$static);
  return $validateAttributes(this$static, actualTag, attr, v, allowNullValues);
}

function $checkCharacters(this$static, characters, v){
  var enclosingTag;
  if (characters == null) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('characters is null', this$static.effectivePos, this$static.resultingPos));
  }
  if (characters.length == 0) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('characters is empty', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.stack_0.size_0 != 0 && !!dynamicCast($get_7(this$static.stack_0, this$static.stack_0.size_0 - 1), 402).asDeleteElement()) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('insertion inside deletion', this$static.effectivePos, this$static.resultingPos));
  }
  enclosingTag = $effectiveEnclosingElementTag(this$static);
  if (!$tagAllowsText(this$static, enclosingTag)) {
    return $addViolation_1(v, new DocOpAutomaton$SchemaViolation_0('element type ' + enclosingTag + ' does not allow text content', this$static.effectivePos, this$static.resultingPos));
  }
  if (!$canIncreaseLength(this$static, characters.length)) {
    return $addViolation_0(v, new DocOpAutomaton$OperationInvalid_0('intermediate or final document too long', this$static.effectivePos, this$static.resultingPos));
  }
  return $clinit_2006() , VALID;
}

function $checkDeleteCharacters(this$static, count, v){
  var available;
  if (count <= 0) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('delete length not positive', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.stack_0.size_0 != 0 && !!dynamicCast($get_7(this$static.stack_0, this$static.stack_0.size_0 - 1), 402).asInsertElement()) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('deletion inside insertion', this$static.effectivePos, this$static.resultingPos));
  }
  available = remainingCharactersInElement(this$static.doc, this$static.effectivePos);
  if (count > available) {
    return $addViolation_0(v, new DocOpAutomaton$OperationInvalid_0('cannot delete ' + count + ' characters, only ' + available + ' available', this$static.effectivePos, this$static.resultingPos));
  }
  return $clinit_2006() , VALID;
}

function $checkDeleteElementEnd(this$static, v){
  if (!(this$static.stack_0.size_0 != 0 && !!dynamicCast($get_7(this$static.stack_0, this$static.stack_0.size_0 - 1), 402).asDeleteElement())) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('deleteElementEnd with no deleteElementStart', this$static.effectivePos, this$static.resultingPos));
  }
  if ($effectiveDocSymbol(this$static) != ($clinit_1915() , CLOSE)) {
    return $addViolation_0(v, new DocOpAutomaton$OperationInvalid_0('no element end to delete here', this$static.effectivePos, this$static.resultingPos));
  }
  return $clinit_2006() , VALID;
}

function $checkDeleteElementStart(this$static, v){
  if (this$static.stack_0.size_0 != 0 && !!dynamicCast($get_7(this$static.stack_0, this$static.stack_0.size_0 - 1), 402).asInsertElement()) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('deletion inside insertion', this$static.effectivePos, this$static.resultingPos));
  }
  if ($effectiveDocSymbol(this$static) != ($clinit_1915() , OPEN)) {
    return $addViolation_0(v, new DocOpAutomaton$OperationInvalid_0('no element start to delete here', this$static.effectivePos, this$static.resultingPos));
  }
  return $clinit_2006() , VALID;
}

function $checkElementEnd(this$static, v){
  if (!(this$static.stack_0.size_0 != 0 && !!dynamicCast($get_7(this$static.stack_0, this$static.stack_0.size_0 - 1), 402).asInsertElement())) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('elementEnd with no elementStart', this$static.effectivePos, this$static.resultingPos));
  }
  return $clinit_2006() , VALID;
}

function $checkElementStart(this$static, tag, attr, v){
  var attrViolation, parentTag;
  if (tag == null) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('element type is null', this$static.effectivePos, this$static.resultingPos));
  }
  if (!isXmlName(tag)) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('element type is not an XML name: "' + tag + '"', this$static.effectivePos, this$static.resultingPos));
  }
  attrViolation = $validateAttributes(this$static, tag, attr, v, false);
  if (attrViolation != ($clinit_2006() , VALID)) {
    return attrViolation;
  }
  if (this$static.stack_0.size_0 != 0 && !!dynamicCast($get_7(this$static.stack_0, this$static.stack_0.size_0 - 1), 402).asDeleteElement()) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('insertion inside deletion', this$static.effectivePos, this$static.resultingPos));
  }
  if (2 > 429496729 - this$static.resultingLength) {
    return $addViolation_0(v, new DocOpAutomaton$OperationInvalid_0('intermediate or final document too long', this$static.effectivePos, this$static.resultingPos));
  }
  if ($effectiveDocSymbol(this$static) == ($clinit_1915() , END_1) && $effectiveEnclosingElementTag(this$static) == null && this$static.stack_0.size_0 == 0 && this$static.resultingLength == 0) {
    return this$static.schemaConstraints.permitsChild(null, tag)?VALID:$addViolation_1(v, new DocOpAutomaton$SchemaViolation_0('type not permitted as root element', this$static.effectivePos, this$static.resultingPos));
  }
  parentTag = $effectiveEnclosingElementTag(this$static);
  if (parentTag == null) {
    if (!this$static.schemaConstraints.permitsChild(null, tag)) {
      return $addViolation_1(v, new DocOpAutomaton$SchemaViolation_0('type not permitted as root element', this$static.effectivePos, this$static.resultingPos));
    }
  }
   else {
    if (!this$static.schemaConstraints.permitsChild(parentTag, tag)) {
      return $addViolation_1(v, new DocOpAutomaton$SchemaViolation_0('element type ' + parentTag + ' does not permit subelement type ' + tag, this$static.effectivePos, this$static.resultingPos));
    }
  }
  return VALID;
}

function $checkEndAnnotation(this$static, key, v){
  var r;
  r = $validateAnnotationKey(this$static, key, v);
  if (r != ($clinit_2006() , VALID)) {
    return r;
  }
  if (!this$static.openAnnotationKeys.map.containsKey(key)) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('endAnnotation of key ' + key + ' with no startAnnotation', this$static.effectivePos, this$static.resultingPos));
  }
  return VALID;
}

function $checkFinish(this$static, v){
  var e, e$iterator, key, key$iterator, outerIter, entry;
  for (e$iterator = new AbstractList$IteratorImpl_0(this$static.stack_0); e$iterator.i < e$iterator.this$0_0.size_1();) {
    e = dynamicCast($next_4(e$iterator), 402);
    return e.notClosed(this$static, v);
  }
  for (key$iterator = (outerIter = $keySet_0(this$static.openAnnotationKeys.map).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter)); key$iterator.val$outerIter.hasNext();) {
    key = dynamicCast((entry = dynamicCast(key$iterator.val$outerIter.next_0(), 11) , entry.getKey()), 1);
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('startAnnotation of key ' + key + ' with no endAnnotation', this$static.effectivePos, this$static.resultingPos));
  }
  return $clinit_2006() , VALID;
}

function $checkSkip(this$static, distance, v){
  if (distance <= 0) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('skip distance not positive', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.stack_0.size_0 != 0) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('skip inside insert or delete', this$static.effectivePos, this$static.resultingPos));
  }
  if (distance > (this$static.effectivePos >= $size_15(this$static.doc)?0:$size_15(this$static.doc) - this$static.effectivePos)) {
    return $addViolation_0(v, new DocOpAutomaton$OperationInvalid_0('skip past end of document', this$static.effectivePos, this$static.resultingPos));
  }
  return $clinit_2006() , VALID;
}

function $checkStartAnnotation(this$static, key, v){
  var r;
  r = $validateAnnotationKey(this$static, key, v);
  if (r != ($clinit_2006() , VALID)) {
    return r;
  }
  return VALID;
}

function $doCharacters_0(this$static, characters){
  this$static.resultingLength += characters.length;
  this$static.resultingPos += characters.length;
}

function $doDeleteCharacters_0(this$static, count){
  this$static.effectivePos += count;
  this$static.resultingLength -= count;
}

function $doDeleteElementEnd(this$static){
  $remove_12(this$static.stack_0, this$static.stack_0.size_0 - 1);
  this$static.resultingLength -= 2;
  this$static.effectivePos += 1;
}

function $doDeleteElementStart(this$static){
  $add_9(this$static.stack_0, ($clinit_1914() , $clinit_1914() , instance_9));
  this$static.effectivePos += 1;
}

function $doElementEnd_0(this$static){
  $remove_12(this$static.stack_0, this$static.stack_0.size_0 - 1);
  this$static.resultingPos += 1;
}

function $doElementStart_0(this$static, tag){
  $add_9(this$static.stack_0, new NindoAutomaton$InsertElement_0(tag));
  this$static.resultingLength += 2;
  this$static.resultingPos += 1;
}

function $doSetAttributes(this$static){
  this$static.effectivePos += 1;
  this$static.resultingPos += 1;
}

function $doSkip(this$static, distance){
  this$static.effectivePos += distance;
  this$static.resultingPos += distance;
}

function $doUpdateAttributes(this$static){
  this$static.effectivePos += 1;
  this$static.resultingPos += 1;
}

function $effectiveDocSymbol(this$static){
  var e;
  if (this$static.effectivePos >= $size_15(this$static.doc)) {
    return $clinit_1915() , END_1;
  }
  e = $elementStartingHere(this$static);
  if (e != null) {
    return $clinit_1915() , OPEN;
  }
  e = $elementEndingNext(this$static);
  if (e != null) {
    return $clinit_1915() , CLOSE;
  }
  return $clinit_1915() , CHARACTER_1;
}

function $effectiveDocSymbolTag(this$static){
  var tag;
  switch ($effectiveDocSymbol(this$static).ordinal) {
    case 1:
      {
        tag = this$static.doc.substrate.getTagName($elementStartingHere(this$static));
        return tag;
      }

    case 2:
      {
        tag = this$static.doc.substrate.getTagName($elementEndingNext(this$static));
        return tag;
      }

    default:throw new IllegalStateException_1('not at tag');
  }
}

function $effectiveEnclosingElement(this$static){
  var e, e$iterator;
  if (this$static.effectivePos == 0 || this$static.effectivePos >= $size_15(this$static.doc)) {
    return null;
  }
  if (this$static.stack_0.size_0 == 0) {
    return nthEnclosingElement(this$static.doc, this$static.effectivePos);
  }
   else {
    !!dynamicCast($get_7(this$static.stack_0, this$static.stack_0.size_0 - 1), 402).asInsertElement();
    if (dynamicCast($get_7(this$static.stack_0, this$static.stack_0.size_0 - 1), 402).asDeleteElement()) {
      for (e$iterator = new AbstractList$IteratorImpl_0(this$static.stack_0); e$iterator.i < e$iterator.this$0_0.size_1();) {
        e = dynamicCast($next_4(e$iterator), 402);
        !!e.asDeleteElement();
      }
      e = nthEnclosingElement(this$static.doc, this$static.effectivePos);
      return e;
    }
    throw new RuntimeException_1('unexpected top of stack: ' + dynamicCast($get_7(this$static.stack_0, this$static.stack_0.size_0 - 1), 402));
  }
}

function $effectiveEnclosingElementTag(this$static){
  var e;
  if (this$static.stack_0.size_0 != 0 && !!dynamicCast($get_7(this$static.stack_0, this$static.stack_0.size_0 - 1), 402).asInsertElement()) {
    return dynamicCast($get_7(this$static.stack_0, this$static.stack_0.size_0 - 1), 402).asInsertElement().tag;
  }
   else {
    e = $effectiveEnclosingElement(this$static);
    return e == null?null:this$static.doc.substrate.getTagName(e);
  }
}

function $elementEndingNext(this$static){
  var elementHere, elementNext, root;
  checkPositionIndex(this$static.effectivePos, $size_15(this$static.doc));
  if (this$static.effectivePos == 0) {
    return null;
  }
  if (this$static.effectivePos == $size_15(this$static.doc)) {
    return null;
  }
  if (this$static.effectivePos == $size_15(this$static.doc) - 1) {
    root = this$static.doc.substrate.getDocumentElement();
    return root;
  }
  $locate_0(this$static.doc, this$static.effectivePos);
  elementHere = enclosingElement(this$static.doc, $locate_0(this$static.doc, this$static.effectivePos).container);
  elementNext = enclosingElement(this$static.doc, $locate_0(this$static.doc, this$static.effectivePos + 1).container);
  if (elementHere == null) {
    return null;
  }
  return maskUndefined(this$static.doc.substrate.getParentElement(elementHere)) !== (elementNext == null?null:elementNext)?null:elementHere;
}

function $elementStartingHere(this$static){
  var elementHere, elementNext;
  checkPositionIndex(this$static.effectivePos, $size_15(this$static.doc));
  if (this$static.effectivePos + 1 >= $size_15(this$static.doc)) {
    return null;
  }
  elementHere = this$static.effectivePos == 0?this$static.doc.substrate.getDocumentElement():enclosingElement(this$static.doc, $locate_0(this$static.doc, this$static.effectivePos).container);
  elementNext = enclosingElement(this$static.doc, $locate_0(this$static.doc, this$static.effectivePos + 1).container);
  if (elementNext == null) {
    return null;
  }
  return (elementHere == null?null:elementHere) !== maskUndefined(this$static.doc.substrate.getParentElement(elementNext))?null:elementNext;
}

function $tagAllowsText(this$static, tag){
  switch (this$static.schemaConstraints.permittedCharacters(tag).ordinal) {
    case 2:
      return true;
    case 1:
      return true;
    case 0:
      return false;
    default:throw new AssertionError_1('unexpected return value from permittedCharacters');
  }
}

function $validateAnnotationKey(this$static, key, v){
  if (key == null) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('annotation key is null', this$static.effectivePos, this$static.resultingPos));
  }
  return $clinit_2006() , VALID;
}

function $validateAttributes(this$static, tag, attr, v, allowRemovals){
  var e, e$iterator, key, value;
  if (!attr) {
    return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('attributes is null', this$static.effectivePos, this$static.resultingPos));
  }
  for (e$iterator = attr.entrySet_0().iterator_0(); e$iterator.hasNext();) {
    e = dynamicCast(e$iterator.next_0(), 11);
    key = dynamicCast(e.getKey(), 1);
    value = dynamicCast(e.getValue(), 1);
    if (key == null) {
      return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('attribute key is null', this$static.effectivePos, this$static.resultingPos));
    }
    if (!isXmlName(key)) {
      return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('attribute key is not an XML name: "' + key + '"', this$static.effectivePos, this$static.resultingPos));
    }
    if (value == null) {
      if (!allowRemovals) {
        return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('attribute value is null', this$static.effectivePos, this$static.resultingPos));
      }
      if (!this$static.schemaConstraints.permitsAttribute(tag, key)) {
        return $addViolation_1(v, new DocOpAutomaton$SchemaViolation_0('type ' + tag + ' does not permit attribute ' + key, this$static.effectivePos, this$static.resultingPos));
      }
    }
     else {
      if (!this$static.schemaConstraints.permitsAttribute_0(tag, key, value)) {
        return $addViolation_1(v, new DocOpAutomaton$SchemaViolation_0('type ' + tag + ' does not permit attribute ' + key + ' with value ' + value, this$static.effectivePos, this$static.resultingPos));
      }
    }
  }
  return $clinit_2006() , VALID;
}

function NindoAutomaton_0(schemaConstraints, doc){
  this.stack_0 = new ArrayList_0;
  this.openAnnotationKeys = new HashSet_0;
  this.schemaConstraints = schemaConstraints;
  this.doc = doc;
  this.resultingLength = ($checkSizeConsistency(doc, 'size') , doc.offsetList.root.offset);
}

function isXmlName(s){
  var i;
  if (s.length == 0) {
    return false;
  }
  if (!isXmlNameStartChar(s.charCodeAt(0))) {
    return false;
  }
  for (i = 1; i < s.length; ++i) {
    if (!isXmlNameChar(s.charCodeAt(i))) {
      return false;
    }
  }
  return true;
}

function isXmlNameChar(c){
  return c == 58 || 65 <= c && c <= 90 || c == 95 | (97 <= c && c <= 122) || 192 <= c && c <= 214 || 216 <= c && c <= 246 || 248 <= c && c <= 767 || 880 <= c && c <= 893 || 895 <= c && c <= 8191 || 8204 <= c && c <= 8205 || 8304 <= c && c <= 8591 || 11264 <= c && c <= 12271 || 12289 <= c && c <= 55295 || 63744 <= c && c <= 64975 || 65008 <= c && c <= 65533 || 65536 <= c && c <= 983039 || c == 45 || c == 46 || 48 <= c && c <= 57 || c == 183 || 768 <= c && c <= 879 || 8255 <= c && c <= 8256;
}

function isXmlNameStartChar(c){
  return c == 58 || 65 <= c && c <= 90 || c == 95 | (97 <= c && c <= 122) || 192 <= c && c <= 214 || 216 <= c && c <= 246 || 248 <= c && c <= 767 || 880 <= c && c <= 893 || 895 <= c && c <= 8191 || 8204 <= c && c <= 8205 || 8304 <= c && c <= 8591 || 11264 <= c && c <= 12271 || 12289 <= c && c <= 55295 || 63744 <= c && c <= 64975 || 65008 <= c && c <= 65533 || 65536 <= c && c <= 983039;
}

function nthEnclosingElement(doc, pos){
  var e;
  e = enclosingElement(doc, (checkPositionIndex(pos, doc.offsetList.root.offset) , $performActionAt(doc.offsetList, pos, doc.pointFinder)).container);
  return e;
}

function remainingCharactersInElement(doc, pos){
  var container, deletionPoint, next, nodeLength, offsetWithinNode, remainingChars;
  if (pos >= ($checkSizeConsistency(doc, 'size') , doc.offsetList.root.offset)) {
    return 0;
  }
  deletionPoint = (checkPositionIndex(pos, doc.offsetList.root.offset) , $performActionAt(doc.offsetList, pos, doc.pointFinder));
  if (deletionPoint.offset < 0) {
    return 0;
  }
  offsetWithinNode = $getTextOffset(deletionPoint);
  container = deletionPoint.container;
  nodeLength = getItemSize(doc, container);
  remainingChars = nodeLength - offsetWithinNode;
  while (true) {
    next = doc.substrate.getNextSibling(container);
    if (next == null || doc.substrate.getNodeType_0(next) != 3) {
      break;
    }
    remainingChars += getItemSize(doc, next);
    container = next;
  }
  return remainingChars;
}

function NindoAutomaton(){
}

_ = NindoAutomaton_0.prototype = NindoAutomaton.prototype = new Object_0;
_.getClass$ = function getClass_1213(){
  return Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton_2_classLit;
}
;
_.castableTypeMap$ = {};
_.doc = null;
_.effectivePos = 0;
_.resultingLength = 0;
_.resultingPos = 0;
_.schemaConstraints = null;
function NindoAutomaton$StackEntry(){
}

_ = NindoAutomaton$StackEntry.prototype = new Object_0;
_.asDeleteElement = function asDeleteElement(){
  return null;
}
;
_.asInsertElement = function asInsertElement(){
  return null;
}
;
_.getClass$ = function getClass_1214(){
  return Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton$StackEntry_2_classLit;
}
;
_.castableTypeMap$ = {402:1};
function $clinit_1914(){
  $clinit_1914 = nullMethod;
  instance_9 = new NindoAutomaton$DeleteElement_0;
}

function NindoAutomaton$DeleteElement_0(){
}

function NindoAutomaton$DeleteElement(){
}

_ = NindoAutomaton$DeleteElement_0.prototype = NindoAutomaton$DeleteElement.prototype = new NindoAutomaton$StackEntry;
_.asDeleteElement = function asDeleteElement_0(){
  return this;
}
;
_.getClass$ = function getClass_1215(){
  return Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton$DeleteElement_2_classLit;
}
;
_.notClosed = function notClosed(a_0, v){
  return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('deleteElementStart with no deleteElementEnd', a_0.effectivePos, a_0.resultingPos));
}
;
_.castableTypeMap$ = {402:1};
var instance_9;
function $clinit_1915(){
  $clinit_1915 = nullMethod;
  CHARACTER_1 = new NindoAutomaton$DocSymbol_0('CHARACTER', 0);
  OPEN = new NindoAutomaton$DocSymbol_0('OPEN', 1);
  CLOSE = new NindoAutomaton$DocSymbol_0('CLOSE', 2);
  END_1 = new NindoAutomaton$DocSymbol_0('END', 3);
  $VALUES_65 = initValues(_3Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton$DocSymbol_2_classLit, {9:1, 68:1, 170:1}, 145, [CHARACTER_1, OPEN, CLOSE, END_1]);
}

function NindoAutomaton$DocSymbol_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_72(name_0){
  $clinit_1915();
  return valueOf_0(($clinit_1916() , $MAP_65), name_0);
}

function values_66(){
  $clinit_1915();
  return $VALUES_65;
}

function NindoAutomaton$DocSymbol(){
}

_ = NindoAutomaton$DocSymbol_0.prototype = NindoAutomaton$DocSymbol.prototype = new Enum;
_.getClass$ = function getClass_1216(){
  return Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton$DocSymbol_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 145:1};
var $VALUES_65, CHARACTER_1, CLOSE, END_1, OPEN;
function $clinit_1916(){
  $clinit_1916 = nullMethod;
  $MAP_65 = createValueOfMap(($clinit_1915() , $VALUES_65));
}

var $MAP_65;
function NindoAutomaton$InsertElement_0(tag){
  this.tag = tag;
}

function NindoAutomaton$InsertElement(){
}

_ = NindoAutomaton$InsertElement_0.prototype = NindoAutomaton$InsertElement.prototype = new NindoAutomaton$StackEntry;
_.asInsertElement = function asInsertElement_0(){
  return this;
}
;
_.getClass$ = function getClass_1217(){
  return Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton$InsertElement_2_classLit;
}
;
_.notClosed = function notClosed_0(a_0, v){
  return $addViolation(v, new DocOpAutomaton$OperationIllFormed_0('elementStart with no elementEnd', a_0.effectivePos, a_0.resultingPos));
}
;
_.castableTypeMap$ = {402:1};
_.tag = null;
function validate_0(doc, m_0, schema){
  var $e0, a_0, v;
  checkNotNull_1(schema, 'Schema constraints required, if not, use DocumentSchema.NO_SCHEMA_CONSTRAINTS');
  a_0 = new NindoAutomaton_0(schema, doc);
  v = new DocOpAutomaton$ViolationCollector_0;
  try {
    $apply_39(m_0, new NindoValidator$1_0(a_0, v));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 403)) {
      return v;
    }
     else 
      throw $e0;
  }
  if ($checkFinish(a_0, v) == ($clinit_2006() , ILL_FORMED)) {
    return v;
  }
  return v;
}

function NindoValidator$1_0(val$a, val$v){
  this.val$a = val$a;
  this.val$v = val$v;
}

function NindoValidator$1(){
}

_ = NindoValidator$1_0.prototype = NindoValidator$1.prototype = new Object_0;
_.begin = function begin_9(){
}
;
_.characters_0 = function characters_7(s){
  if ($checkCharacters(this.val$a, s, this.val$v) == ($clinit_2006() , ILL_FORMED)) {
    throw new NindoValidator$IllFormed_0;
  }
  $doCharacters_0(this.val$a, s);
}
;
_.deleteCharacters_0 = function deleteCharacters_6(n){
  if ($checkDeleteCharacters(this.val$a, n, this.val$v) == ($clinit_2006() , ILL_FORMED)) {
    throw new NindoValidator$IllFormed_0;
  }
  $doDeleteCharacters_0(this.val$a, n);
}
;
_.deleteElementEnd = function deleteElementEnd_6(){
  if ($checkDeleteElementEnd(this.val$a, this.val$v) == ($clinit_2006() , ILL_FORMED)) {
    throw new NindoValidator$IllFormed_0;
  }
  $doDeleteElementEnd(this.val$a);
}
;
_.deleteElementStart_0 = function deleteElementStart_6(){
  if ($checkDeleteElementStart(this.val$a, this.val$v) == ($clinit_2006() , ILL_FORMED)) {
    throw new NindoValidator$IllFormed_0;
  }
  $doDeleteElementStart(this.val$a);
}
;
_.elementEnd = function elementEnd_6(){
  if ($checkElementEnd(this.val$a, this.val$v) == ($clinit_2006() , ILL_FORMED)) {
    throw new NindoValidator$IllFormed_0;
  }
  $doElementEnd_0(this.val$a);
}
;
_.elementStart = function elementStart_6(tagName, attributes){
  if ($checkElementStart(this.val$a, tagName, attributes, this.val$v) == ($clinit_2006() , ILL_FORMED)) {
    throw new NindoValidator$IllFormed_0;
  }
  $doElementStart_0(this.val$a, tagName);
}
;
_.endAnnotation = function endAnnotation_4(key){
  if ($checkEndAnnotation(this.val$a, key, this.val$v) == ($clinit_2006() , ILL_FORMED)) {
    throw new NindoValidator$IllFormed_0;
  }
  this.val$a.openAnnotationKeys.map.remove_3(key) != null;
}
;
_.finish = function finish_4(){
}
;
_.getClass$ = function getClass_1218(){
  return Lorg_waveprotocol_wave_model_document_operation_NindoValidator$1_2_classLit;
}
;
_.replaceAttributes_0 = function replaceAttributes_6(attributes){
  if ($checkChangeAttributes(this.val$a, attributes, this.val$v, false) == ($clinit_2006() , ILL_FORMED)) {
    throw new NindoValidator$IllFormed_0;
  }
  $doSetAttributes(this.val$a);
}
;
_.skip = function skip_4(n){
  if ($checkSkip(this.val$a, n, this.val$v) == ($clinit_2006() , ILL_FORMED)) {
    throw new NindoValidator$IllFormed_0;
  }
  $doSkip(this.val$a, n);
}
;
_.startAnnotation_0 = function startAnnotation_4(key, value){
  if ($checkStartAnnotation(this.val$a, key, this.val$v) == ($clinit_2006() , ILL_FORMED)) {
    throw new NindoValidator$IllFormed_0;
  }
  $add_13(this.val$a.openAnnotationKeys, key);
}
;
_.updateAttributes_0 = function updateAttributes_6(attributes){
  if ($checkChangeAttributes(this.val$a, attributes, this.val$v, true) == ($clinit_2006() , ILL_FORMED)) {
    throw new NindoValidator$IllFormed_0;
  }
  $doUpdateAttributes(this.val$a);
}
;
_.castableTypeMap$ = {};
_.val$a = null;
_.val$v = null;
function NindoValidator$IllFormed_0(){
  this.fillInStackTrace();
}

function NindoValidator$IllFormed(){
}

_ = NindoValidator$IllFormed_0.prototype = NindoValidator$IllFormed.prototype = new RuntimeException;
_.getClass$ = function getClass_1219(){
  return Lorg_waveprotocol_wave_model_document_operation_NindoValidator$IllFormed_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 21:1, 39:1, 183:1, 403:1};
function $annotationBoundary(this$static, map){
  var changeSize, endSize, i;
  changeSize = map.changeSize();
  for (i = 0; i < changeSize; ++i) {
    $put_3(this$static.annotationChanges, map.getChangeKey_0(i), new AnnotationsNormalizer$AnnotationChangeValues_0(map.getOldValue(i), map.getNewValue(i)));
  }
  endSize = map.endSize();
  for (i = 0; i < endSize; ++i) {
    $put_3(this$static.annotationChanges, map.getEndKey_0(i), null);
  }
}

function $characters_0(this$static, chars){
  if (chars.length) {
    $flushAnnotations(this$static);
    this$static.target_0.characters_0(chars);
  }
}

function $deleteCharacters_0(this$static, chars){
  if (chars.length) {
    $flushAnnotations(this$static);
    this$static.target_0.deleteCharacters(chars);
  }
}

function $deleteElementEnd_0(this$static){
  $flushAnnotations(this$static);
  this$static.target_0.deleteElementEnd();
}

function $deleteElementStart_0(this$static, type, attrs){
  $flushAnnotations(this$static);
  this$static.target_0.deleteElementStart(type, attrs);
}

function $elementEnd_0(this$static){
  $flushAnnotations(this$static);
  this$static.target_0.elementEnd();
}

function $elementStart_0(this$static, type, attrs){
  $flushAnnotations(this$static);
  this$static.target_0.elementStart(type, attrs);
}

function $finish_2(this$static){
  $flushAnnotations(this$static);
  return this$static.target_0.finish_0();
}

function $flushAnnotations(this$static){
  var change, change$iterator, changes, ends, key, previousValues, values, entry;
  changes = new ArrayList_0;
  ends = new ArrayList_0;
  for (change$iterator = new TreeMap$EntryIterator_0((new TreeMap$EntrySet_0(this$static.annotationChanges)).this$0); $hasNext_2(change$iterator.iter);) {
    change = change$iterator.last = dynamicCast($next_4(change$iterator.iter), 11);
    key = dynamicCast(change.getKey(), 1);
    values = dynamicCast(change.getValue(), 404);
    previousValues = dynamicCast((entry = $getEntry(this$static.annotationTracker, key) , entry?entry.value_0:null), 404);
    if (!values) {
      if (previousValues) {
        $remove_23(this$static.annotationTracker, key);
        setCheck(ends.array, ends.size_0++, key);
      }
    }
     else {
      if (!previousValues || !equal_0(values.oldValue, previousValues.oldValue) || !equal_0(values.newValue, previousValues.newValue)) {
        $put_3(this$static.annotationTracker, key, values);
        $add_9(changes, new AnnotationsNormalizer$AnnotationChange_0(key, values.oldValue, values.newValue));
      }
    }
  }
  (changes.size_0 != 0 || ends.size_0 != 0) && this$static.target_0.annotationBoundary(new AnnotationsNormalizer$1_0(changes, ends));
  $clear_10(this$static.annotationChanges);
}

function $replaceAttributes_0(this$static, oldAttrs, newAttrs){
  $flushAnnotations(this$static);
  this$static.target_0.replaceAttributes(oldAttrs, newAttrs);
}

function $retain_0(this$static, itemCount){
  if (itemCount > 0) {
    $flushAnnotations(this$static);
    this$static.target_0.retain(itemCount);
  }
}

function $updateAttributes_0(this$static, attrUpdate){
  $flushAnnotations(this$static);
  this$static.target_0.updateAttributes(attrUpdate);
}

function AnnotationsNormalizer_0(target){
  this.annotationTracker = new TreeMap_0;
  this.annotationChanges = new TreeMap_0;
  this.target_0 = target;
}

function AnnotationsNormalizer(){
}

_ = AnnotationsNormalizer_0.prototype = AnnotationsNormalizer.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_3(map){
  $annotationBoundary(this, map);
}
;
_.characters_0 = function characters_8(chars){
  $characters_0(this, chars);
}
;
_.deleteCharacters = function deleteCharacters_7(chars){
  $deleteCharacters_0(this, chars);
}
;
_.deleteElementEnd = function deleteElementEnd_7(){
  $flushAnnotations(this);
  this.target_0.deleteElementEnd();
}
;
_.deleteElementStart = function deleteElementStart_7(type, attrs){
  $flushAnnotations(this);
  this.target_0.deleteElementStart(type, attrs);
}
;
_.elementEnd = function elementEnd_7(){
  $flushAnnotations(this);
  this.target_0.elementEnd();
}
;
_.elementStart = function elementStart_7(type, attrs){
  $flushAnnotations(this);
  this.target_0.elementStart(type, attrs);
}
;
_.finish_0 = function finish_5(){
  return $flushAnnotations(this) , this.target_0.finish_0();
}
;
_.getClass$ = function getClass_1220(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_AnnotationsNormalizer_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_7(oldAttrs, newAttrs){
  $flushAnnotations(this);
  this.target_0.replaceAttributes(oldAttrs, newAttrs);
}
;
_.retain = function retain_3(itemCount){
  $retain_0(this, itemCount);
}
;
_.updateAttributes = function updateAttributes_7(attrUpdate){
  $flushAnnotations(this);
  this.target_0.updateAttributes(attrUpdate);
}
;
_.castableTypeMap$ = {};
_.target_0 = null;
function AnnotationsNormalizer$1_0(val$changes, val$ends){
  this.val$changes = val$changes;
  this.val$ends = val$ends;
}

function AnnotationsNormalizer$1(){
}

_ = AnnotationsNormalizer$1_0.prototype = AnnotationsNormalizer$1.prototype = new Object_0;
_.changeSize = function changeSize_1(){
  return this.val$changes.size_0;
}
;
_.endSize = function endSize_1(){
  return this.val$ends.size_0;
}
;
_.getChangeKey_0 = function getChangeKey_2(changeIndex){
  return dynamicCast($get_7(this.val$changes, changeIndex), 405).key;
}
;
_.getClass$ = function getClass_1221(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_AnnotationsNormalizer$1_2_classLit;
}
;
_.getEndKey_0 = function getEndKey_2(endIndex){
  return dynamicCast($get_7(this.val$ends, endIndex), 1);
}
;
_.getNewValue = function getNewValue_0(changeIndex){
  return dynamicCast($get_7(this.val$changes, changeIndex), 405).newValue;
}
;
_.getOldValue = function getOldValue_0(changeIndex){
  return dynamicCast($get_7(this.val$changes, changeIndex), 405).oldValue;
}
;
_.castableTypeMap$ = {409:1};
_.val$changes = null;
_.val$ends = null;
function AnnotationsNormalizer$AnnotationChange_0(key, oldValue, newValue){
  this.key = key;
  this.oldValue = oldValue;
  this.newValue = newValue;
}

function AnnotationsNormalizer$AnnotationChange(){
}

_ = AnnotationsNormalizer$AnnotationChange_0.prototype = AnnotationsNormalizer$AnnotationChange.prototype = new Object_0;
_.getClass$ = function getClass_1222(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_AnnotationsNormalizer$AnnotationChange_2_classLit;
}
;
_.castableTypeMap$ = {405:1};
_.key = null;
_.newValue = null;
_.oldValue = null;
function AnnotationsNormalizer$AnnotationChangeValues_0(oldValue, newValue){
  this.oldValue = oldValue;
  this.newValue = newValue;
}

function AnnotationsNormalizer$AnnotationChangeValues(){
}

_ = AnnotationsNormalizer$AnnotationChangeValues_0.prototype = AnnotationsNormalizer$AnnotationChangeValues.prototype = new Object_0;
_.getClass$ = function getClass_1223(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_AnnotationsNormalizer$AnnotationChangeValues_2_classLit;
}
;
_.castableTypeMap$ = {404:1};
_.newValue = null;
_.oldValue = null;
function $composeOperations(this$static, op1, op2){
  var op1Index, op2Index, size, size_0;
  this$static.target_0 = this$static.defaultTarget;
  op1Index = 0;
  op2Index = 0;
  while (op1Index < op1.size_1()) {
    op1.applyComponent(op1Index++, this$static.target_0);
    while (this$static.target_0.isPostTarget()) {
      if (op2Index >= op2.size_1()) {
        throw new OperationException_0('Document size mismatch: op1 resulting length=' + (size = initValues(_3I_classLit, {9:1}, -1, [0]) , op1.apply_8(new DocOpUtil$5_0(size)) , size[0]) + ', op2 initial length=' + (size_0 = initValues(_3I_classLit, {9:1}, -1, [0]) , op2.apply_8(new DocOpUtil$4_0(size_0)) , size_0[0]));
      }
      op2.applyComponent(op2Index++, this$static.target_0);
    }
  }
  if (op2Index < op2.size_1()) {
    this$static.target_0 = new Composer$FinisherPostTarget_0(this$static);
    while (op2Index < op2.size_1()) {
      op2.applyComponent(op2Index++, this$static.target_0);
    }
  }
  $flush_4(this$static.preAnnotationQueue);
  $flush_4(this$static.postAnnotationQueue);
  return dynamicCast($finish_2(this$static.normalizer), 207);
}

function $flushAnnotations_0(this$static){
  $flush_4(this$static.preAnnotationQueue);
  $flush_4(this$static.postAnnotationQueue);
}

function Composer_0(cursor){
  this.preAnnotations = new HashMap_0;
  this.postAnnotations = new HashMap_0;
  this.preAnnotationQueue = new Composer$1_0(this);
  this.postAnnotationQueue = new Composer$2_0(this);
  this.defaultTarget = new Composer$DefaultPreTarget_0(this);
  this.normalizer = new AnnotationsNormalizer_0(new RangeNormalizer_0(cursor));
}

function compose_2(op1, op2){
  var $e0, e;
  try {
    return $composeOperations(new Composer_0(new DocOpBuffer_0), op1, op2);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 406)) {
      e = $e0;
      throw new OperationException_0(e.detailMessage);
    }
     else 
      throw $e0;
  }
}

function composeUnchecked(op1, op2){
  var $e0, e;
  try {
    return $composeOperations(new Composer_0(new UncheckedDocOpBuffer_0), op1, op2);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 406)) {
      e = $e0;
      throw new OperationException_0(e.detailMessage);
    }
     else 
      throw $e0;
  }
}

function invertUpdate(attrUpdate){
  var i, inverseUpdate;
  inverseUpdate = new AttributesUpdateImpl_0;
  for (i = 0; i < attrUpdate.updates.size_1(); ++i) {
    inverseUpdate = $composeWith(inverseUpdate, new AttributesUpdateImpl_1(initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, [dynamicCast(attrUpdate.updates.get_0(i), 384).name_0, dynamicCast(attrUpdate.updates.get_0(i), 384).newValue, dynamicCast(attrUpdate.updates.get_0(i), 384).oldValue])));
  }
  return inverseUpdate;
}

function Composer(){
}

_ = Composer_0.prototype = Composer.prototype = new Object_0;
_.getClass$ = function getClass_1224(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer_2_classLit;
}
;
_.castableTypeMap$ = {};
_.normalizer = null;
_.target_0 = null;
function $flush_4(this$static){
  var map, map$iterator;
  for (map$iterator = new AbstractList$IteratorImpl_0(this$static.events); map$iterator.i < map$iterator.this$0_0.size_1();) {
    map = dynamicCast($next_4(map$iterator), 409);
    this$static.unqueue(map);
  }
  $clear_4(this$static.events);
}

function Composer$AnnotationQueue(){
}

_ = Composer$AnnotationQueue.prototype = new Object_0;
_.getClass$ = function getClass_1225(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$AnnotationQueue_2_classLit;
}
;
_.castableTypeMap$ = {};
function Composer$1_0(this$0){
  this.this$0 = this$0;
  this.events = new ArrayList_0;
}

function Composer$1(){
}

_ = Composer$1_0.prototype = Composer$1.prototype = new Composer$AnnotationQueue;
_.getClass$ = function getClass_1226(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$1_2_classLit;
}
;
_.unqueue = function unqueue(map){
  var changeKeys, changeNewValues, changeOldValues, endKeys, i, key, newValue, oldValue, postValues;
  endKeys = new ArrayList_0;
  changeKeys = new ArrayList_0;
  changeOldValues = new ArrayList_0;
  changeNewValues = new ArrayList_0;
  for (i = 0; i < map.endSize(); ++i) {
    key = map.getEndKey_0(i);
    postValues = dynamicCast(this.this$0.postAnnotations.get(key), 407);
    if (postValues) {
      setCheck(changeKeys.array, changeKeys.size_0++, key);
      $add_9(changeOldValues, postValues.oldValue);
      $add_9(changeNewValues, postValues.newValue);
    }
     else {
      setCheck(endKeys.array, endKeys.size_0++, key);
    }
    this.this$0.preAnnotations.remove_3(key);
  }
  for (i = 0; i < map.changeSize(); ++i) {
    key = map.getChangeKey_0(i);
    oldValue = map.getOldValue(i);
    newValue = map.getNewValue(i);
    postValues = dynamicCast(this.this$0.postAnnotations.get(key), 407);
    setCheck(changeKeys.array, changeKeys.size_0++, key);
    setCheck(changeOldValues.array, changeOldValues.size_0++, oldValue);
    postValues?$add_9(changeNewValues, postValues.newValue):(setCheck(changeNewValues.array, changeNewValues.size_0++, newValue) , true);
    this.this$0.preAnnotations.put(key, new ValueUpdate_0(oldValue, newValue));
  }
  $annotationBoundary(this.this$0.normalizer, new AnnotationBoundaryMapImpl_0(dynamicCast($toArray_1(endKeys, initDim(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, 0, 0)), 408), dynamicCast($toArray_1(changeKeys, initDim(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, 0, 0)), 408), dynamicCast($toArray_1(changeOldValues, initDim(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, 0, 0)), 408), dynamicCast($toArray_1(changeNewValues, initDim(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, 0, 0)), 408)));
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function Composer$2_0(this$0){
  this.this$0 = this$0;
  this.events = new ArrayList_0;
}

function Composer$2(){
}

_ = Composer$2_0.prototype = Composer$2.prototype = new Composer$AnnotationQueue;
_.getClass$ = function getClass_1227(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$2_2_classLit;
}
;
_.unqueue = function unqueue_0(map){
  var changeKeys, changeNewValues, changeOldValues, endKeys, i, key, newValue, oldValue, preValues;
  endKeys = new ArrayList_0;
  changeKeys = new ArrayList_0;
  changeOldValues = new ArrayList_0;
  changeNewValues = new ArrayList_0;
  for (i = 0; i < map.endSize(); ++i) {
    key = map.getEndKey_0(i);
    preValues = dynamicCast(this.this$0.preAnnotations.get(key), 407);
    if (preValues) {
      setCheck(changeKeys.array, changeKeys.size_0++, key);
      $add_9(changeOldValues, preValues.oldValue);
      $add_9(changeNewValues, preValues.newValue);
    }
     else {
      setCheck(endKeys.array, endKeys.size_0++, key);
    }
    this.this$0.postAnnotations.remove_3(key);
  }
  for (i = 0; i < map.changeSize(); ++i) {
    key = map.getChangeKey_0(i);
    oldValue = map.getOldValue(i);
    newValue = map.getNewValue(i);
    preValues = dynamicCast(this.this$0.preAnnotations.get(key), 407);
    setCheck(changeKeys.array, changeKeys.size_0++, key);
    setCheck(changeNewValues.array, changeNewValues.size_0++, newValue);
    preValues?$add_9(changeOldValues, preValues.oldValue):(setCheck(changeOldValues.array, changeOldValues.size_0++, oldValue) , true);
    this.this$0.postAnnotations.put(key, new ValueUpdate_0(oldValue, newValue));
  }
  $annotationBoundary(this.this$0.normalizer, new AnnotationBoundaryMapImpl_0(dynamicCast($toArray_1(endKeys, initDim(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, 0, 0)), 408), dynamicCast($toArray_1(changeKeys, initDim(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, 0, 0)), 408), dynamicCast($toArray_1(changeOldValues, initDim(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, 0, 0)), 408), dynamicCast($toArray_1(changeNewValues, initDim(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, 0, 0)), 408)));
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function Composer$Target(){
}

_ = Composer$Target.prototype = new Object_0;
_.getClass$ = function getClass_1228(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$Target_2_classLit;
}
;
_.castableTypeMap$ = {};
function Composer$PostTarget(){
}

_ = Composer$PostTarget.prototype = new Composer$Target;
_.annotationBoundary = function annotationBoundary_4(map){
  $add_9(this.this$0_0.postAnnotationQueue.events, map);
}
;
_.characters_0 = function characters_9(chars){
  $flush_4(this.this$0_0.postAnnotationQueue);
  $characters_0(this.this$0_0.normalizer, chars);
}
;
_.elementEnd = function elementEnd_8(){
  $flush_4(this.this$0_0.postAnnotationQueue);
  $elementEnd_0(this.this$0_0.normalizer);
}
;
_.elementStart = function elementStart_8(type, attrs){
  $flush_4(this.this$0_0.postAnnotationQueue);
  $elementStart_0(this.this$0_0.normalizer, type, attrs);
}
;
_.getClass$ = function getClass_1229(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$PostTarget_2_classLit;
}
;
_.isPostTarget = function isPostTarget(){
  return true;
}
;
_.castableTypeMap$ = {};
_.this$0_0 = null;
function $cancelCharacters(this$static, size){
  size < this$static.chars.length?(this$static.chars = $substring(this$static.chars, size)):(this$static.this$0.target_0 = this$static.this$0.defaultTarget);
}

function Composer$CharactersPostTarget_0(this$0, chars){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
  this.chars = chars;
}

function Composer$CharactersPostTarget(){
}

_ = Composer$CharactersPostTarget_0.prototype = Composer$CharactersPostTarget.prototype = new Composer$PostTarget;
_.deleteCharacters = function deleteCharacters_8(chars){
  $flushAnnotations_0(this.this$0);
  chars.length <= this.chars.length?$cancelCharacters(this, chars.length):(this.this$0.target_0 = new Composer$DeleteCharactersPreTarget_0(this.this$0, $substring(chars, this.chars.length)));
}
;
_.deleteElementEnd = function deleteElementEnd_8(){
  throw new Composer$ComposeException_0;
}
;
_.deleteElementStart = function deleteElementStart_8(type, attrs){
  throw new Composer$ComposeException_0;
}
;
_.getClass$ = function getClass_1230(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$CharactersPostTarget_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_8(oldAttrs, newAttrs){
  throw new Composer$ComposeException_0;
}
;
_.retain = function retain_4(itemCount){
  $flushAnnotations_0(this.this$0);
  if (itemCount <= this.chars.length) {
    $characters_0(this.this$0.normalizer, this.chars.substr(0, itemCount - 0));
    itemCount < this.chars.length?(this.chars = $substring(this.chars, itemCount)):(this.this$0.target_0 = this.this$0.defaultTarget);
  }
   else {
    $characters_0(this.this$0.normalizer, this.chars);
    this.this$0.target_0 = new Composer$RetainPreTarget_0(this.this$0, itemCount - this.chars.length);
  }
}
;
_.updateAttributes = function updateAttributes_8(attrUpdate){
  throw new Composer$ComposeException_0;
}
;
_.castableTypeMap$ = {};
_.chars = null;
_.this$0 = null;
function Composer$ComposeException_0(){
  this.fillInStackTrace();
  this.detailMessage = 'Illegal composition';
}

function Composer$ComposeException(){
}

_ = Composer$ComposeException_0.prototype = Composer$ComposeException.prototype = new RuntimeException;
_.getClass$ = function getClass_1231(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$ComposeException_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 21:1, 39:1, 183:1, 406:1};
function Composer$PreTarget(){
}

_ = Composer$PreTarget.prototype = new Composer$Target;
_.annotationBoundary = function annotationBoundary_5(map){
  $add_9(this.this$0_0.preAnnotationQueue.events, map);
}
;
_.deleteCharacters = function deleteCharacters_9(chars){
  $flush_4(this.this$0_0.preAnnotationQueue);
  $deleteCharacters_0(this.this$0_0.normalizer, chars);
}
;
_.deleteElementEnd = function deleteElementEnd_9(){
  $flush_4(this.this$0_0.preAnnotationQueue);
  $deleteElementEnd_0(this.this$0_0.normalizer);
}
;
_.deleteElementStart = function deleteElementStart_9(type, attrs){
  $flush_4(this.this$0_0.preAnnotationQueue);
  $deleteElementStart_0(this.this$0_0.normalizer, type, attrs);
}
;
_.getClass$ = function getClass_1232(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$PreTarget_2_classLit;
}
;
_.isPostTarget = function isPostTarget_0(){
  return false;
}
;
_.castableTypeMap$ = {};
_.this$0_0 = null;
function Composer$DefaultPreTarget_0(this$0){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
}

function Composer$DefaultPreTarget(){
}

_ = Composer$DefaultPreTarget_0.prototype = Composer$DefaultPreTarget.prototype = new Composer$PreTarget;
_.characters_0 = function characters_10(chars){
  this.this$0.target_0 = new Composer$CharactersPostTarget_0(this.this$0, chars);
}
;
_.elementEnd = function elementEnd_9(){
  this.this$0.target_0 = new Composer$ElementEndPostTarget_0(this.this$0);
}
;
_.elementStart = function elementStart_9(type, attrs){
  this.this$0.target_0 = new Composer$ElementStartPostTarget_0(this.this$0, type, attrs);
}
;
_.getClass$ = function getClass_1233(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$DefaultPreTarget_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_9(oldAttrs, newAttrs){
  this.this$0.target_0 = new Composer$ReplaceAttributesPostTarget_0(this.this$0, oldAttrs, newAttrs);
}
;
_.retain = function retain_5(itemCount){
  this.this$0.target_0 = new Composer$RetainPostTarget_0(this.this$0, itemCount);
}
;
_.updateAttributes = function updateAttributes_9(attrUpdate){
  this.this$0.target_0 = new Composer$UpdateAttributesPostTarget_0(this.this$0, attrUpdate);
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $cancelDeleteCharacters(this$static, size){
  size < this$static.chars.length?(this$static.chars = $substring(this$static.chars, size)):(this$static.this$0.target_0 = this$static.this$0.defaultTarget);
}

function Composer$DeleteCharactersPreTarget_0(this$0, chars){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
  this.chars = chars;
}

function Composer$DeleteCharactersPreTarget(){
}

_ = Composer$DeleteCharactersPreTarget_0.prototype = Composer$DeleteCharactersPreTarget.prototype = new Composer$PreTarget;
_.characters_0 = function characters_11(chars){
  $flushAnnotations_0(this.this$0);
  chars.length <= this.chars.length?$cancelDeleteCharacters(this, chars.length):(this.this$0.target_0 = new Composer$CharactersPostTarget_0(this.this$0, $substring(chars, this.chars.length)));
}
;
_.elementEnd = function elementEnd_10(){
  throw new Composer$ComposeException_0;
}
;
_.elementStart = function elementStart_10(type, attrs){
  throw new Composer$ComposeException_0;
}
;
_.getClass$ = function getClass_1234(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$DeleteCharactersPreTarget_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_10(oldAttrs, newAttrs){
  throw new Composer$ComposeException_0;
}
;
_.retain = function retain_6(itemCount){
  $flushAnnotations_0(this.this$0);
  if (itemCount <= this.chars.length) {
    $deleteCharacters_0(this.this$0.normalizer, this.chars.substr(0, itemCount - 0));
    itemCount < this.chars.length?(this.chars = $substring(this.chars, itemCount)):(this.this$0.target_0 = this.this$0.defaultTarget);
  }
   else {
    $deleteCharacters_0(this.this$0.normalizer, this.chars);
    this.this$0.target_0 = new Composer$RetainPostTarget_0(this.this$0, itemCount - this.chars.length);
  }
}
;
_.updateAttributes = function updateAttributes_10(attrUpdate){
  throw new Composer$ComposeException_0;
}
;
_.castableTypeMap$ = {};
_.chars = null;
_.this$0 = null;
function Composer$ElementEndPostTarget_0(this$0){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
}

function Composer$ElementEndPostTarget(){
}

_ = Composer$ElementEndPostTarget_0.prototype = Composer$ElementEndPostTarget.prototype = new Composer$PostTarget;
_.deleteCharacters = function deleteCharacters_10(chars){
  throw new Composer$ComposeException_0;
}
;
_.deleteElementEnd = function deleteElementEnd_10(){
  $flushAnnotations_0(this.this$0);
  this.this$0.target_0 = this.this$0.defaultTarget;
}
;
_.deleteElementStart = function deleteElementStart_10(type, attrs){
  throw new Composer$ComposeException_0;
}
;
_.getClass$ = function getClass_1235(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$ElementEndPostTarget_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_11(oldAttrs, newAttrs){
  throw new Composer$ComposeException_0;
}
;
_.retain = function retain_7(itemCount){
  $flushAnnotations_0(this.this$0);
  $elementEnd_0(this.this$0.normalizer);
  itemCount > 1?(this.this$0.target_0 = new Composer$RetainPreTarget_0(this.this$0, itemCount - 1)):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.updateAttributes = function updateAttributes_11(attrUpdate){
  throw new Composer$ComposeException_0;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function Composer$ElementStartPostTarget_0(this$0, type, attrs){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
  this.type_0 = type;
  this.attrs = attrs;
}

function Composer$ElementStartPostTarget(){
}

_ = Composer$ElementStartPostTarget_0.prototype = Composer$ElementStartPostTarget.prototype = new Composer$PostTarget;
_.deleteCharacters = function deleteCharacters_11(chars){
  throw new Composer$ComposeException_0;
}
;
_.deleteElementEnd = function deleteElementEnd_11(){
  throw new Composer$ComposeException_0;
}
;
_.deleteElementStart = function deleteElementStart_11(type, attrs){
  $flushAnnotations_0(this.this$0);
  this.this$0.target_0 = this.this$0.defaultTarget;
}
;
_.getClass$ = function getClass_1236(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$ElementStartPostTarget_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_12(oldAttrs, newAttrs){
  $flushAnnotations_0(this.this$0);
  $elementStart_0(this.this$0.normalizer, this.type_0, newAttrs);
  this.this$0.target_0 = this.this$0.defaultTarget;
}
;
_.retain = function retain_8(itemCount){
  $flushAnnotations_0(this.this$0);
  $elementStart_0(this.this$0.normalizer, this.type_0, this.attrs);
  itemCount > 1?(this.this$0.target_0 = new Composer$RetainPreTarget_0(this.this$0, itemCount - 1)):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.updateAttributes = function updateAttributes_12(attrUpdate){
  $flushAnnotations_0(this.this$0);
  $elementStart_0(this.this$0.normalizer, this.type_0, dynamicCast($updateWith(this.attrs, attrUpdate, true), 410));
  this.this$0.target_0 = this.this$0.defaultTarget;
}
;
_.castableTypeMap$ = {};
_.attrs = null;
_.this$0 = null;
_.type_0 = null;
function Composer$FinisherPostTarget_0(this$0){
  this.this$0_0 = this$0;
}

function Composer$FinisherPostTarget(){
}

_ = Composer$FinisherPostTarget_0.prototype = Composer$FinisherPostTarget.prototype = new Composer$PostTarget;
_.deleteCharacters = function deleteCharacters_12(chars){
  throw new Composer$ComposeException_0;
}
;
_.deleteElementEnd = function deleteElementEnd_12(){
  throw new Composer$ComposeException_0;
}
;
_.deleteElementStart = function deleteElementStart_12(type, attrs){
  throw new Composer$ComposeException_0;
}
;
_.getClass$ = function getClass_1237(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$FinisherPostTarget_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_13(oldAttrs, newAttrs){
  throw new Composer$ComposeException_0;
}
;
_.retain = function retain_9(itemCount){
  throw new Composer$ComposeException_0;
}
;
_.updateAttributes = function updateAttributes_13(attrUpdate){
  throw new Composer$ComposeException_0;
}
;
_.castableTypeMap$ = {};
function Composer$ReplaceAttributesPostTarget_0(this$0, oldAttrs, newAttrs){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
  this.oldAttrs = oldAttrs;
  this.newAttrs = newAttrs;
}

function Composer$ReplaceAttributesPostTarget(){
}

_ = Composer$ReplaceAttributesPostTarget_0.prototype = Composer$ReplaceAttributesPostTarget.prototype = new Composer$PostTarget;
_.deleteCharacters = function deleteCharacters_13(chars){
  throw new Composer$ComposeException_0;
}
;
_.deleteElementEnd = function deleteElementEnd_13(){
  throw new Composer$ComposeException_0;
}
;
_.deleteElementStart = function deleteElementStart_13(type, attrs){
  $flushAnnotations_0(this.this$0);
  $deleteElementStart_0(this.this$0.normalizer, type, this.oldAttrs);
  this.this$0.target_0 = this.this$0.defaultTarget;
}
;
_.getClass$ = function getClass_1238(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$ReplaceAttributesPostTarget_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_14(oldAttrs, newAttrs){
  $flushAnnotations_0(this.this$0);
  $replaceAttributes_0(this.this$0.normalizer, this.oldAttrs, newAttrs);
  this.this$0.target_0 = this.this$0.defaultTarget;
}
;
_.retain = function retain_10(itemCount){
  $flushAnnotations_0(this.this$0);
  $replaceAttributes_0(this.this$0.normalizer, this.oldAttrs, this.newAttrs);
  itemCount > 1?(this.this$0.target_0 = new Composer$RetainPreTarget_0(this.this$0, itemCount - 1)):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.updateAttributes = function updateAttributes_14(attrUpdate){
  $flushAnnotations_0(this.this$0);
  $replaceAttributes_0(this.this$0.normalizer, this.oldAttrs, dynamicCast($updateWith(this.newAttrs, attrUpdate, true), 410));
  this.this$0.target_0 = this.this$0.defaultTarget;
}
;
_.castableTypeMap$ = {};
_.newAttrs = null;
_.oldAttrs = null;
_.this$0 = null;
function $cancelRetain(this$static, size){
  size < this$static.itemCount?(this$static.itemCount -= size):(this$static.this$0.target_0 = this$static.this$0.defaultTarget);
}

function Composer$RetainPostTarget_0(this$0, itemCount){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
  this.itemCount = itemCount;
}

function Composer$RetainPostTarget(){
}

_ = Composer$RetainPostTarget_0.prototype = Composer$RetainPostTarget.prototype = new Composer$PostTarget;
_.deleteCharacters = function deleteCharacters_14(chars){
  $flushAnnotations_0(this.this$0);
  if (chars.length <= this.itemCount) {
    $deleteCharacters_0(this.this$0.normalizer, chars);
    $cancelRetain(this, chars.length);
  }
   else {
    $deleteCharacters_0(this.this$0.normalizer, chars.substr(0, this.itemCount - 0));
    this.this$0.target_0 = new Composer$DeleteCharactersPreTarget_0(this.this$0, $substring(chars, this.itemCount));
  }
}
;
_.deleteElementEnd = function deleteElementEnd_14(){
  $flushAnnotations_0(this.this$0);
  $deleteElementEnd_0(this.this$0.normalizer);
  1 < this.itemCount?(this.itemCount -= 1):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.deleteElementStart = function deleteElementStart_14(type, attrs){
  $flushAnnotations_0(this.this$0);
  $deleteElementStart_0(this.this$0.normalizer, type, attrs);
  1 < this.itemCount?(this.itemCount -= 1):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.getClass$ = function getClass_1239(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$RetainPostTarget_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_15(oldAttrs, newAttrs){
  $flushAnnotations_0(this.this$0);
  $replaceAttributes_0(this.this$0.normalizer, oldAttrs, newAttrs);
  1 < this.itemCount?(this.itemCount -= 1):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.retain = function retain_11(itemCount){
  $flushAnnotations_0(this.this$0);
  if (itemCount <= this.itemCount) {
    $retain_0(this.this$0.normalizer, itemCount);
    itemCount < this.itemCount?(this.itemCount -= itemCount):(this.this$0.target_0 = this.this$0.defaultTarget);
  }
   else {
    $retain_0(this.this$0.normalizer, this.itemCount);
    this.this$0.target_0 = new Composer$RetainPreTarget_0(this.this$0, itemCount - this.itemCount);
  }
}
;
_.updateAttributes = function updateAttributes_15(attrUpdate){
  $flushAnnotations_0(this.this$0);
  $updateAttributes_0(this.this$0.normalizer, attrUpdate);
  1 < this.itemCount?(this.itemCount -= 1):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.castableTypeMap$ = {};
_.itemCount = 0;
_.this$0 = null;
function $cancelRetain_0(this$static, size){
  size < this$static.itemCount?(this$static.itemCount -= size):(this$static.this$0.target_0 = this$static.this$0.defaultTarget);
}

function Composer$RetainPreTarget_0(this$0, itemCount){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
  this.itemCount = itemCount;
}

function Composer$RetainPreTarget(){
}

_ = Composer$RetainPreTarget_0.prototype = Composer$RetainPreTarget.prototype = new Composer$PreTarget;
_.characters_0 = function characters_12(chars){
  $flushAnnotations_0(this.this$0);
  if (chars.length <= this.itemCount) {
    $characters_0(this.this$0.normalizer, chars);
    $cancelRetain_0(this, chars.length);
  }
   else {
    $characters_0(this.this$0.normalizer, chars.substr(0, this.itemCount - 0));
    this.this$0.target_0 = new Composer$CharactersPostTarget_0(this.this$0, $substring(chars, this.itemCount));
  }
}
;
_.elementEnd = function elementEnd_11(){
  $flushAnnotations_0(this.this$0);
  $elementEnd_0(this.this$0.normalizer);
  1 < this.itemCount?(this.itemCount -= 1):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.elementStart = function elementStart_11(type, attrs){
  $flushAnnotations_0(this.this$0);
  $elementStart_0(this.this$0.normalizer, type, attrs);
  1 < this.itemCount?(this.itemCount -= 1):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.getClass$ = function getClass_1240(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$RetainPreTarget_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_16(oldAttrs, newAttrs){
  $flushAnnotations_0(this.this$0);
  $replaceAttributes_0(this.this$0.normalizer, oldAttrs, newAttrs);
  1 < this.itemCount?(this.itemCount -= 1):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.retain = function retain_12(itemCount){
  $flushAnnotations_0(this.this$0);
  if (itemCount <= this.itemCount) {
    $retain_0(this.this$0.normalizer, itemCount);
    itemCount < this.itemCount?(this.itemCount -= itemCount):(this.this$0.target_0 = this.this$0.defaultTarget);
  }
   else {
    $retain_0(this.this$0.normalizer, this.itemCount);
    this.this$0.target_0 = new Composer$RetainPostTarget_0(this.this$0, itemCount - this.itemCount);
  }
}
;
_.updateAttributes = function updateAttributes_16(attrsUpdate){
  $flushAnnotations_0(this.this$0);
  $updateAttributes_0(this.this$0.normalizer, attrsUpdate);
  1 < this.itemCount?(this.itemCount -= 1):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.castableTypeMap$ = {};
_.itemCount = 0;
_.this$0 = null;
function Composer$UpdateAttributesPostTarget_0(this$0, attrUpdate){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
  this.attrUpdate = attrUpdate;
}

function Composer$UpdateAttributesPostTarget(){
}

_ = Composer$UpdateAttributesPostTarget_0.prototype = Composer$UpdateAttributesPostTarget.prototype = new Composer$PostTarget;
_.deleteCharacters = function deleteCharacters_15(chars){
  throw new Composer$ComposeException_0;
}
;
_.deleteElementEnd = function deleteElementEnd_15(){
  throw new Composer$ComposeException_0;
}
;
_.deleteElementStart = function deleteElementStart_15(type, attrs){
  $flushAnnotations_0(this.this$0);
  $deleteElementStart_0(this.this$0.normalizer, type, dynamicCast($updateWith(attrs, invertUpdate(this.attrUpdate), true), 410));
  this.this$0.target_0 = this.this$0.defaultTarget;
}
;
_.getClass$ = function getClass_1241(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$UpdateAttributesPostTarget_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_17(oldAttrs, newAttrs){
  $flushAnnotations_0(this.this$0);
  $replaceAttributes_0(this.this$0.normalizer, dynamicCast($updateWith(oldAttrs, invertUpdate(this.attrUpdate), true), 410), newAttrs);
  this.this$0.target_0 = this.this$0.defaultTarget;
}
;
_.retain = function retain_13(itemCount){
  $flushAnnotations_0(this.this$0);
  $updateAttributes_0(this.this$0.normalizer, this.attrUpdate);
  itemCount > 1?(this.this$0.target_0 = new Composer$RetainPreTarget_0(this.this$0, itemCount - 1)):(this.this$0.target_0 = this.this$0.defaultTarget);
}
;
_.updateAttributes = function updateAttributes_17(attrUpdate){
  $flushAnnotations_0(this.this$0);
  $updateAttributes_0(this.this$0.normalizer, $composeWith(this.attrUpdate, attrUpdate));
  this.this$0.target_0 = this.this$0.defaultTarget;
}
;
_.castableTypeMap$ = {};
_.attrUpdate = null;
_.this$0 = null;
function $add_29(this$static, operation){
  var iterator, nextOperation;
  iterator = new AbstractList$ListIteratorImpl_0(this$static.operations, 0);
  while (iterator.i < iterator.this$0_0.size_1()) {
    nextOperation = dynamicCast($next_4(iterator), 207);
    if (!nextOperation) {
      $set_3(iterator, operation);
      return;
    }
    $set_3(iterator, null);
    operation = $compose_1(nextOperation, operation);
  }
  $add_9(this$static.operations, operation);
}

function $compose_1(op1, op2){
  var $e0, e;
  try {
    return compose_2(op1, op2);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 189)) {
      e = $e0;
      throw new IllegalArgumentException_3(e);
    }
     else 
      throw $e0;
  }
}

function $composeAll(this$static){
  var operation, operation$iterator, result;
  result = null;
  for (operation$iterator = new AbstractList$IteratorImpl_0(this$static.operations); operation$iterator.i < operation$iterator.this$0_0.size_1();) {
    operation = dynamicCast($next_4(operation$iterator), 207);
    !!operation && (result = result?$compose_1(operation, result):operation);
  }
  $clear_4(this$static.operations);
  return result;
}

function DocOpCollector_0(){
  this.operations = new ArrayList_0;
}

function DocOpCollector(){
}

_ = DocOpCollector_0.prototype = DocOpCollector.prototype = new Object_0;
_.getClass$ = function getClass_1243(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_DocOpCollector_2_classLit;
}
;
_.castableTypeMap$ = {};
function $characters_1(this$static, chars){
  !chars.length || this$static.cache.characters_0(chars);
}

function $elementEnd_1(this$static){
  this$static.cache.flush_0();
  $add_9(this$static.target_0.accu, ($clinit_2053() , INSTANCE_16));
}

function $elementStart_1(this$static, type, attrs){
  this$static.cache.flush_0();
  $add_9(this$static.target_0.accu, new OperationComponents$ElementStart_0(type, attrs));
}

function $finish_4(this$static){
  this$static.cache.flush_0();
  return this$static.target_0.finish_1();
}

function $retain_1(this$static, itemCount){
  itemCount > 0 && this$static.cache.skip(itemCount);
}

function RangeNormalizer_0(target){
  this.emptyCache = new RangeNormalizer$1_0(this);
  this.skipCache = new RangeNormalizer$2_0(this);
  this.charactersCache = new RangeNormalizer$3_0(this);
  this.deleteCharactersCache = new RangeNormalizer$4_0(this);
  this.cache = this.emptyCache;
  this.target_0 = target;
}

function RangeNormalizer(){
}

_ = RangeNormalizer_0.prototype = RangeNormalizer.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_12(map){
  this.cache.flush_0();
  $add_9(this.target_0.accu, new OperationComponents$AnnotationBoundary_0(map));
}
;
_.characters_0 = function characters_19(chars){
  !chars.length || this.cache.characters_0(chars);
}
;
_.deleteCharacters = function deleteCharacters_22(chars){
  !chars.length || this.cache.deleteCharacters(chars);
}
;
_.deleteElementEnd = function deleteElementEnd_22(){
  this.cache.flush_0();
  $add_9(this.target_0.accu, ($clinit_2051() , INSTANCE_15));
}
;
_.deleteElementStart = function deleteElementStart_22(type, attrs){
  this.cache.flush_0();
  $add_9(this.target_0.accu, new OperationComponents$DeleteElementStart_0(type, attrs));
}
;
_.elementEnd = function elementEnd_18(){
  this.cache.flush_0();
  $add_9(this.target_0.accu, ($clinit_2053() , INSTANCE_16));
}
;
_.elementStart = function elementStart_18(type, attrs){
  this.cache.flush_0();
  $add_9(this.target_0.accu, new OperationComponents$ElementStart_0(type, attrs));
}
;
_.finish_0 = function finish_11(){
  return this.cache.flush_0() , this.target_0.finish_1();
}
;
_.getClass$ = function getClass_1279(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_24(oldAttrs, newAttrs){
  this.cache.flush_0();
  $add_9(this.target_0.accu, new OperationComponents$ReplaceAttributes_0(oldAttrs, newAttrs));
}
;
_.retain = function retain_20(itemCount){
  itemCount > 0 && this.cache.skip(itemCount);
}
;
_.updateAttributes = function updateAttributes_24(attrUpdate){
  this.cache.flush_0();
  $add_9(this.target_0.accu, new OperationComponents$UpdateAttributes_0(attrUpdate));
}
;
_.castableTypeMap$ = {};
_.target_0 = null;
function RangeNormalizer$Cache(){
}

_ = RangeNormalizer$Cache.prototype = new Object_0;
_.characters_0 = function characters_20(characters){
  this.flush_0();
  this.this$0_0.cache = this.this$0_0.charactersCache;
  this.this$0_0.cache.characters_0(characters);
}
;
_.deleteCharacters = function deleteCharacters_23(characters){
  this.flush_0();
  this.this$0_0.cache = this.this$0_0.deleteCharactersCache;
  this.this$0_0.cache.deleteCharacters(characters);
}
;
_.getClass$ = function getClass_1280(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer$Cache_2_classLit;
}
;
_.skip = function skip_5(distance){
  this.flush_0();
  this.this$0_0.cache = this.this$0_0.skipCache;
  this.this$0_0.cache.skip(distance);
}
;
_.castableTypeMap$ = {};
_.this$0_0 = null;
function RangeNormalizer$1_0(this$0){
  this.this$0_0 = this$0;
}

function RangeNormalizer$1(){
}

_ = RangeNormalizer$1_0.prototype = RangeNormalizer$1.prototype = new RangeNormalizer$Cache;
_.flush_0 = function flush_1(){
}
;
_.getClass$ = function getClass_1281(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function RangeNormalizer$2_0(this$0){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
}

function RangeNormalizer$2(){
}

_ = RangeNormalizer$2_0.prototype = RangeNormalizer$2.prototype = new RangeNormalizer$Cache;
_.flush_0 = function flush_2(){
  $add_9(this.this$0.target_0.accu, new OperationComponents$Retain_0(this.distance));
  this.distance = 0;
  this.this$0.cache = this.this$0.emptyCache;
}
;
_.getClass$ = function getClass_1282(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer$2_2_classLit;
}
;
_.skip = function skip_6(distance){
  this.distance += distance;
}
;
_.castableTypeMap$ = {};
_.distance = 0;
_.this$0 = null;
function RangeNormalizer$3_0(this$0){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
  this.characters = new StringBuilder_0;
}

function RangeNormalizer$3(){
}

_ = RangeNormalizer$3_0.prototype = RangeNormalizer$3.prototype = new RangeNormalizer$Cache;
_.characters_0 = function characters_21(characters){
  $append_11(this.characters, characters);
}
;
_.flush_0 = function flush_3(){
  $add_9(this.this$0.target_0.accu, new OperationComponents$Characters_0(this.characters.impl.string));
  this.characters = new StringBuilder_0;
  this.this$0.cache = this.this$0.emptyCache;
}
;
_.getClass$ = function getClass_1283(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function RangeNormalizer$4_0(this$0){
  this.this$0 = this$0;
  this.this$0_0 = this$0;
  this.characters = new StringBuilder_0;
}

function RangeNormalizer$4(){
}

_ = RangeNormalizer$4_0.prototype = RangeNormalizer$4.prototype = new RangeNormalizer$Cache;
_.deleteCharacters = function deleteCharacters_24(characters){
  $append_11(this.characters, characters);
}
;
_.flush_0 = function flush_4(){
  $add_9(this.this$0.target_0.accu, new OperationComponents$DeleteCharacters_0(this.characters.impl.string));
  this.characters = new StringBuilder_0;
  this.this$0.cache = this.this$0.emptyCache;
}
;
_.getClass$ = function getClass_1284(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer$4_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function ValueUpdate_0(oldValue, newValue){
  this.oldValue = oldValue;
  this.newValue = newValue;
}

function ValueUpdate(){
}

_ = ValueUpdate_0.prototype = ValueUpdate.prototype = new Object_0;
_.equals$ = function equals_53(obj){
  var other;
  if (this === obj)
    return true;
  if (obj == null)
    return false;
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[407]))
    return false;
  other = dynamicCast(obj, 407);
  if (this.newValue == null) {
    if (other.newValue != null)
      return false;
  }
   else if (!$equals_3(this.newValue, other.newValue))
    return false;
  if (this.oldValue == null) {
    if (other.oldValue != null)
      return false;
  }
   else if (!$equals_3(this.oldValue, other.oldValue))
    return false;
  return true;
}
;
_.getClass$ = function getClass_1285(){
  return Lorg_waveprotocol_wave_model_document_operation_algorithm_ValueUpdate_2_classLit;
}
;
_.hashCode$ = function hashCode_52(){
  var result;
  result = 31 + (this.newValue == null?0:getHashCode_0(this.newValue));
  result = 31 * result + (this.oldValue == null?0:getHashCode_0(this.oldValue));
  return result;
}
;
_.castableTypeMap$ = {407:1};
_.newValue = null;
_.oldValue = null;
function $clinit_1997(){
  $clinit_1997 = nullMethod;
  EMPTY_DOCUMENT = new DocOpAutomaton$1_0;
  EMPTY_ANNOTATIONS = ($clinit_2024() , EMPTY_MAP_1);
}

function $addViolation_2(a_0, v){
  !!a_0 && $add_9(a_0.operationIllFormed, v);
  return $clinit_2006() , ILL_FORMED;
}

function $addViolation_3(a_0, v){
  !!a_0 && $add_9(a_0.operationInvalid, v);
  return $clinit_2006() , INVALID_DOCUMENT;
}

function $addViolation_4(a_0, v){
  !!a_0 && $add_9(a_0.schemaViolations, v);
  return $clinit_2006() , INVALID_SCHEMA;
}

function $annotationKeysNotStrictlyMonotonic(this$static, v, key1, key2){
  return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('annotation keys not strictly monotonic: ' + key1 + ' >= ' + key2, this$static.effectivePos, this$static.resultingPos));
}

function $attributeKeysNotStrictlyMonotonic(this$static, v, key1, key2){
  return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute keys not strictly monotonic: ' + key1 + ' >= ' + key2, this$static.effectivePos, this$static.resultingPos));
}

function $attributeNameNotXmlName(this$static, v, name_0){
  return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute name is not an XML Name: "' + name_0 + '"', this$static.effectivePos, this$static.resultingPos));
}

function $attributesEqual(a_0, b){
  var ae, ae$iterator, entry;
  if (a_0.entrySet_0().size_1() != b.entrySet_0().size_1()) {
    return false;
  }
  for (ae$iterator = new ImmutableStateMap$1$1_0(a_0.entrySet); ae$iterator.iterator.hasNext();) {
    ae = dynamicCast(ae$iterator.iterator.next_0(), 394);
    if (!equal(ae.value_0, (entry = $implFindEntry(b, ae.name_0, false) , !entry?null:entry.getValue()))) {
      return false;
    }
  }
  return true;
}

function $checkAnnotationBoundary(this$static, map, v){
  var endKeys, i, key, r, old;
  if (this$static.afterAnnotationBoundary) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('adjacent annotation boundaries', this$static.effectivePos, this$static.resultingPos));
  }
  endKeys = new HashSet_0;
  for (i = 0; i < map.endSize(); ++i) {
    key = map.getEndKey_0(i);
    r = $validateAnnotationKey_0(this$static, key, v);
    if (r != ($clinit_2006() , VALID)) {
      return r;
    }
    if (i > 0 && compareTo_5(map.getEndKey_0(i - 1), key) >= 0) {
      return $annotationKeysNotStrictlyMonotonic(this$static, v, map.getEndKey_0(i - 1), key);
    }
    if (!$containsKey_7(this$static.annotationsUpdate, key)) {
      return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('annotation of key ' + key + ' ends without having started', this$static.effectivePos, this$static.resultingPos));
    }
    old = endKeys.map.put(key, endKeys);
  }
  for (i = 0; i < map.changeSize(); ++i) {
    key = map.getChangeKey_0(i);
    r = $validateAnnotationKey_0(this$static, key, v);
    if (r != ($clinit_2006() , VALID)) {
      return r;
    }
    r = $validateAnnotationValue(this$static, map.getOldValue(i), v);
    if (r != VALID) {
      return r;
    }
    r = $validateAnnotationValue(this$static, map.getNewValue(i), v);
    if (r != VALID) {
      return r;
    }
    if (i > 0 && compareTo_5(map.getChangeKey_0(i - 1), key) >= 0) {
      return $annotationKeysNotStrictlyMonotonic(this$static, v, map.getChangeKey_0(i - 1), key);
    }
    if (endKeys.map.containsKey(key)) {
      return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('annotation boundary contains duplicate key ' + key, this$static.effectivePos, this$static.resultingPos));
    }
  }
  return $clinit_2006() , VALID;
}

function $checkAnnotationsForDeletion(this$static, v, itemCount){
  var annotationsHere, firstChange, i, key, key$iterator, newValue, offset, oldValue, pos, requiredValue, valueInDoc;
  if (!this$static.targetAnnotationsForDeletion) {
    return $clinit_2006() , VALID;
  }
  for (i = 0; i < this$static.annotationsUpdate.updates.size_1(); ++i) {
    key = dynamicCast(this$static.annotationsUpdate.updates.get_0(i), 384).name_0;
    oldValue = dynamicCast(this$static.annotationsUpdate.updates.get_0(i), 384).oldValue;
    firstChange = this$static.doc.firstAnnotationChange_0(this$static.effectivePos, this$static.effectivePos + itemCount, key, oldValue);
    if (firstChange != -1) {
      return $oldAnnotationsDifferFromDocument(this$static, v, key, oldValue, this$static.doc.getAnnotation_0(firstChange, key));
    }
    newValue = dynamicCast(this$static.annotationsUpdate.updates.get_0(i), 384).newValue;
    if (!equal(newValue, this$static.targetAnnotationsForDeletion.get(key))) {
      return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('new annotation value incorrect for deletion', this$static.effectivePos, this$static.resultingPos));
    }
  }
  for (offset = 0; offset < itemCount; ++offset) {
    pos = this$static.effectivePos + offset;
    annotationsHere = this$static.doc.annotationsAt(pos);
    for (key$iterator = annotationsHere.keySet_0().iterator_0(); key$iterator.hasNext();) {
      key = dynamicCast(key$iterator.next_0(), 1);
      valueInDoc = dynamicCast(annotationsHere.get(key), 1);
      requiredValue = dynamicCast(this$static.targetAnnotationsForDeletion.get(key), 1);
      if (!(valueInDoc == null?requiredValue == null:$equals_3(valueInDoc, requiredValue))) {
        if (!$containsKey_7(this$static.annotationsUpdate, key)) {
          return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('deletion does not reset value for key ' + key + ' from ' + valueInDoc + ' to ' + requiredValue, this$static.effectivePos, this$static.resultingPos));
        }
      }
    }
    for (key$iterator = this$static.targetAnnotationsForDeletion.keySet_0().iterator_0(); key$iterator.hasNext();) {
      key = dynamicCast(key$iterator.next_0(), 1);
      valueInDoc = dynamicCast(annotationsHere.get(key), 1);
      requiredValue = dynamicCast(this$static.targetAnnotationsForDeletion.get(key), 1);
      if (!(valueInDoc == null?requiredValue == null:$equals_3(valueInDoc, requiredValue))) {
        if (!$containsKey_7(this$static.annotationsUpdate, key)) {
          return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('deletion does not reset value for key ' + key + ' from ' + valueInDoc + ' to ' + requiredValue, this$static.effectivePos, this$static.resultingPos));
        }
      }
    }
  }
  return $clinit_2006() , VALID;
}

function $checkAnnotationsForInsertion(this$static, v){
  var defaultFromDocument, i, key, oldValue, posToInheritFrom;
  if (this$static.effectivePos > this$static.doc.length_1()) {
    return $clinit_2006() , VALID;
  }
  posToInheritFrom = this$static.effectivePos - 1;
  for (i = 0; i < this$static.annotationsUpdate.updates.size_1(); ++i) {
    key = dynamicCast(this$static.annotationsUpdate.updates.get_0(i), 384).name_0;
    oldValue = dynamicCast(this$static.annotationsUpdate.updates.get_0(i), 384).oldValue;
    defaultFromDocument = posToInheritFrom == -1?null:this$static.doc.getAnnotation_0(posToInheritFrom, key);
    if (!(oldValue == null?defaultFromDocument == null:$equals_3(oldValue, defaultFromDocument))) {
      return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('old annotations differ from document: purported old value for key ' + key + ' is ' + oldValue + ', actual value in document is ' + defaultFromDocument, this$static.effectivePos, this$static.resultingPos));
    }
  }
  return $clinit_2006() , VALID;
}

function $checkAnnotationsForRetain(this$static, v, itemCount){
  var firstChange, i, key, oldValue;
  for (i = 0; i < this$static.annotationsUpdate.updates.size_1(); ++i) {
    key = dynamicCast(this$static.annotationsUpdate.updates.get_0(i), 384).name_0;
    oldValue = dynamicCast(this$static.annotationsUpdate.updates.get_0(i), 384).oldValue;
    firstChange = this$static.doc.firstAnnotationChange_0(this$static.effectivePos, this$static.effectivePos + itemCount, key, oldValue);
    if (firstChange != -1) {
      return $oldAnnotationsDifferFromDocument(this$static, v, key, oldValue, this$static.doc.getAnnotation_0(firstChange, key));
    }
  }
  return $clinit_2006() , VALID;
}

function $checkAttributesUpdateWellFormed(this$static, u, v){
  var i, key, previousKey;
  if (!u) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attributes update is null', this$static.effectivePos, this$static.resultingPos));
  }
  previousKey = null;
  for (i = 0; i < u.updates.size_1(); ++i) {
    key = dynamicCast(u.updates.get_0(i), 384).name_0;
    if (key == null) {
      return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute key is null', this$static.effectivePos, this$static.resultingPos));
    }
    if (!isXmlName_0(key)) {
      return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute name is not an XML Name: "' + key + '"', this$static.effectivePos, this$static.resultingPos));
    }
    if (previousKey != null && compareTo_5(previousKey, key) >= 0) {
      return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute keys not strictly monotonic: ' + previousKey + ' >= ' + key, this$static.effectivePos, this$static.resultingPos));
    }
    if (dynamicCast(u.updates.get_0(i), 384).oldValue != null && ($clinit_2376() , !traverseUtf16String(dynamicCast(u.updates.get_0(i), 384).oldValue, VALID_UTF16).value_0)) {
      return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute value is not valid UTF-16', this$static.effectivePos, this$static.resultingPos));
    }
    if (dynamicCast(u.updates.get_0(i), 384).newValue != null && ($clinit_2376() , !traverseUtf16String(dynamicCast(u.updates.get_0(i), 384).newValue, VALID_UTF16).value_0)) {
      return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute value is not valid UTF-16', this$static.effectivePos, this$static.resultingPos));
    }
    previousKey = key;
  }
  return $clinit_2006() , VALID;
}

function $checkAttributesWellFormed(this$static, attr, v){
  var e, e$iterator, previousKey;
  if (!attr) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attributes is null', this$static.effectivePos, this$static.resultingPos));
  }
  previousKey = null;
  for (e$iterator = new ImmutableStateMap$1$1_0(attr.entrySet); e$iterator.iterator.hasNext();) {
    e = dynamicCast(e$iterator.iterator.next_0(), 394);
    if (e.name_0 == null) {
      return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute key is null', this$static.effectivePos, this$static.resultingPos));
    }
    if (!isXmlName_0(e.name_0)) {
      return $attributeNameNotXmlName(this$static, v, e.name_0);
    }
    if (e.value_0 == null) {
      return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute value is null', this$static.effectivePos, this$static.resultingPos));
    }
    $clinit_2376();
    if (!traverseUtf16String(e.value_0, VALID_UTF16).value_0) {
      return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute value is not valid UTF-16', this$static.effectivePos, this$static.resultingPos));
    }
    if (previousKey != null && compareTo_5(previousKey, e.name_0) >= 0) {
      return $attributeKeysNotStrictlyMonotonic(this$static, v, previousKey, e.name_0);
    }
    previousKey = e.name_0;
  }
  return $clinit_2006() , VALID;
}

function $checkCharacters_0(this$static, chars, v){
  var enclosingTag, r;
  if (chars == null) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('characters is null', this$static.effectivePos, this$static.resultingPos));
  }
  if (!chars.length) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('characters is empty', this$static.effectivePos, this$static.resultingPos));
  }
  if (firstSurrogate(chars) != -1) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('characters component contains surrogate', this$static.effectivePos, this$static.resultingPos));
  }
  $clinit_2376();
  if (!traverseUtf16String(chars, VALID_UTF16).value_0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('characters component contains invalid unicode', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.deletionStackDepth != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('insertion inside deletion', this$static.effectivePos, this$static.resultingPos));
  }
  r = $checkAnnotationsForInsertion(this$static, v);
  if (r != ($clinit_2006() , VALID)) {
    return r;
  }
  if (this$static.nextRequiredElement != null) {
    return $childElementRequired(this$static, v, this$static.nextRequiredElement);
  }
  r = $checkForInsertionBeforeRequiredChild(this$static, v);
  if (r != VALID) {
    return r;
  }
  enclosingTag = $effectiveEnclosingElementTag_0(this$static);
  switch (this$static.constraints.permittedCharacters(enclosingTag).ordinal) {
    case 0:
      return $addViolation_4(v, new DocOpAutomaton$SchemaViolation_0('element type ' + enclosingTag + ' does not allow text content', this$static.effectivePos, this$static.resultingPos));
    case 1:
      {
        if (!traverseUtf16String(chars, GOOD_UTF16_FOR_BLIP).value_0) {
          return $addViolation_4(v, new DocOpAutomaton$SchemaViolation_0('element type ' + enclosingTag + ' only allows blip text content, not arbitrary characters', this$static.effectivePos, this$static.resultingPos));
        }
      }

      break;
    case 2:
      break;
    default:throw new AssertionError_1('unexpected return value from permittedCharacters()');
  }
  return VALID;
}

function $checkDeleteCharacters_0(this$static, chars, v){
  var charHere, charHereIfAny, docLength, offset, attempted, attempted_0;
  if (chars == null) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('characters is null', this$static.effectivePos, this$static.resultingPos));
  }
  if (!chars.length) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('characters is empty', this$static.effectivePos, this$static.resultingPos));
  }
  if (firstSurrogate(chars) != -1) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('delete characters component contains surrogate', this$static.effectivePos, this$static.resultingPos));
  }
  $clinit_2376();
  if (!traverseUtf16String(chars, VALID_UTF16).value_0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('delete characters component contains invalid unicode', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.insertionStack.size_0 != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('deletion inside insertion', this$static.effectivePos, this$static.resultingPos));
  }
  docLength = this$static.doc.length_1();
  for (offset = 0; offset < chars.length; ++offset) {
    if (this$static.effectivePos + offset >= docLength) {
      return attempted = chars.length , $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('cannot delete ' + attempted + ' characters, only ' + offset + ' available', this$static.effectivePos, this$static.resultingPos));
    }
    charHereIfAny = this$static.doc.charAt_0(this$static.effectivePos + offset);
    if (charHereIfAny == -1) {
      return attempted_0 = chars.length , $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('cannot delete ' + attempted_0 + ' characters, only ' + offset + ' available', this$static.effectivePos, this$static.resultingPos));
    }
    charHere = charHereIfAny & 65535;
    if (charHere != chars.charCodeAt(offset)) {
      return $oldCharacterDiffersFromDocument(this$static, v, charHere, chars.charCodeAt(offset));
    }
  }
  return $checkAnnotationsForDeletion(this$static, v, chars.length);
}

function $checkDeleteElementEnd_0(this$static, v){
  var r;
  if (this$static.insertionStack.size_0 != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('deletion inside insertion', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.deletionStackDepth == 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('deleteElementEnd with no matching deleteElementStart', this$static.effectivePos, this$static.resultingPos));
  }
  if ($effectiveDocSymbol_0(this$static) != ($clinit_1999() , CLOSE_0)) {
    return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('no element end to delete here', this$static.effectivePos, this$static.resultingPos));
  }
  r = $checkAnnotationsForDeletion(this$static, v, 1);
  if (r != ($clinit_2006() , VALID)) {
    return r;
  }
  return VALID;
}

function $checkDeleteElementStart_0(this$static, type, attr, v){
  var isFirstChild, parentType, r, requiredFirstChild;
  if (type == null) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('element type is null', this$static.effectivePos, this$static.resultingPos));
  }
  if (!isXmlName_0(type)) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('element type is not an XML Name: "' + type + '"', this$static.effectivePos, this$static.resultingPos));
  }
  r = $checkAttributesWellFormed(this$static, attr, v);
  if (r != ($clinit_2006() , VALID)) {
    return r;
  }
  if (this$static.insertionStack.size_0 != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('deletion inside insertion', this$static.effectivePos, this$static.resultingPos));
  }
  if ($effectiveDocSymbol_0(this$static) != ($clinit_1999() , OPEN_0)) {
    return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('no element start to delete here', this$static.effectivePos, this$static.resultingPos));
  }
  if (!$equals_3($effectiveDocSymbolTag_0(this$static), type)) {
    return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('old element type differs from document', this$static.effectivePos, this$static.resultingPos));
  }
  if (!$attributesEqual(attr, $effectiveDocSymbolAttributes(this$static))) {
    return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('old attributes differ from document', this$static.effectivePos, this$static.resultingPos));
  }
  r = $checkAnnotationsForDeletion(this$static, v, 1);
  if (r != VALID) {
    return r;
  }
  if (this$static.deletionStackDepth == 0) {
    if (this$static.effectivePos < this$static.doc.length_1()) {
      parentType = this$static.doc.nthEnclosingElementTag(this$static.effectivePos, 0);
      requiredFirstChild = $requiredFirstChild(this$static, parentType);
      isFirstChild = this$static.effectivePos == 0 || this$static.doc.elementStartingAt(this$static.effectivePos - 1) != null;
      if (isFirstChild && requiredFirstChild != null) {
        return $addViolation_4(v, new DocOpAutomaton$SchemaViolation_0('attempt to delete required child', this$static.effectivePos, this$static.resultingPos));
      }
    }
  }
  return VALID;
}

function $checkElementEnd_0(this$static, v){
  var r;
  if (this$static.deletionStackDepth != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('insertion inside deletion', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.insertionStack.size_0 == 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('elementEnd with no matching elementStart', this$static.effectivePos, this$static.resultingPos));
  }
  r = $checkAnnotationsForInsertion(this$static, v);
  if (r != ($clinit_2006() , VALID)) {
    return r;
  }
  if (this$static.nextRequiredElement != null) {
    return $childElementRequired(this$static, v, this$static.nextRequiredElement);
  }
  return VALID;
}

function $checkElementStart_0(this$static, type, attr, v){
  var parentTag, r;
  if (type == null) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('element type is null', this$static.effectivePos, this$static.resultingPos));
  }
  if (!isXmlName_0(type)) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('element type is not an XML Name: "' + type + '"', this$static.effectivePos, this$static.resultingPos));
  }
  r = $checkAttributesWellFormed(this$static, attr, v);
  if (r != ($clinit_2006() , VALID)) {
    return r;
  }
  if (this$static.deletionStackDepth != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('insertion inside deletion', this$static.effectivePos, this$static.resultingPos));
  }
  r = $checkAnnotationsForInsertion(this$static, v);
  if (r != VALID) {
    return r;
  }
  r = $validateAttributes_0(this$static, type, attr, v);
  if (r != VALID) {
    return r;
  }
  parentTag = $effectiveEnclosingElementTag_0(this$static);
  if (!this$static.constraints.permitsChild(parentTag, type)) {
    return parentTag == null?$addViolation_4(v, new DocOpAutomaton$SchemaViolation_0('element type ' + type + ' not permitted at top level', this$static.effectivePos, this$static.resultingPos)):$addViolation_4(v, new DocOpAutomaton$SchemaViolation_0('element type ' + parentTag + ' does not permit subelement type ' + type, this$static.effectivePos, this$static.resultingPos));
  }
  r = $checkForInsertionBeforeRequiredChild(this$static, v);
  if (r != VALID) {
    return r;
  }
  if (this$static.nextRequiredElement != null && !$equals_3(this$static.nextRequiredElement, type)) {
    return $differentElementTypeRequired(this$static, v, this$static.nextRequiredElement, type);
  }
  return VALID;
}

function $checkFinish_0(this$static, v){
  var e$iterator;
  if (this$static.insertionStack.size_0 != 0) {
    for (e$iterator = new AbstractList$IteratorImpl_0(this$static.insertionStack); e$iterator.i < e$iterator.this$0_0.size_1();) {
      dynamicCast($next_4(e$iterator), 412);
      return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('elementStart with no matching elementEnd', this$static.effectivePos, this$static.resultingPos));
    }
  }
  if (this$static.deletionStackDepth != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('deleteElementStart with no matching deleteElementEnd', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.annotationsUpdate.updates.size_1() > 0) {
    return $mismatchedStartAnnotation(this$static, v, dynamicCast(this$static.annotationsUpdate.updates.get_0(0), 384).name_0);
  }
  if (this$static.effectivePos != this$static.doc.length_1()) {
    return $missingRetainToEnd(this$static, v, this$static.doc.length_1(), this$static.effectivePos);
  }
  return $clinit_2006() , VALID;
}

function $checkForInsertionBeforeRequiredChild(this$static, v){
  var isFirstChild, parentType, requiredFirstChild;
  if (this$static.effectivePos < this$static.doc.length_1() && this$static.insertionStack.size_0 == 0) {
    parentType = this$static.doc.nthEnclosingElementTag(this$static.effectivePos, 0);
    requiredFirstChild = $requiredFirstChild(this$static, parentType);
    isFirstChild = this$static.effectivePos == 0 || this$static.doc.elementStartingAt(this$static.effectivePos - 1) != null;
    if (isFirstChild && requiredFirstChild != null) {
      return $addViolation_4(v, new DocOpAutomaton$SchemaViolation_0('attempt to insert before required child', this$static.effectivePos, this$static.resultingPos));
    }
  }
  return $clinit_2006() , VALID;
}

function $checkReplaceAttributes(this$static, oldAttrs, newAttrs, v){
  var actualOldAttrs, r, type;
  r = $checkAttributesWellFormed(this$static, oldAttrs, v);
  if (r != ($clinit_2006() , VALID)) {
    return r;
  }
  r = $checkAttributesWellFormed(this$static, newAttrs, v);
  if (r != VALID) {
    return r;
  }
  if (this$static.deletionStackDepth != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute change inside insert or delete', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.insertionStack.size_0 != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute change inside insert or delete', this$static.effectivePos, this$static.resultingPos));
  }
  if ($effectiveDocSymbol_0(this$static) != ($clinit_1999() , OPEN_0)) {
    return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('no element start to change attributes here', this$static.effectivePos, this$static.resultingPos));
  }
  type = $effectiveDocSymbolTag_0(this$static);
  actualOldAttrs = $effectiveDocSymbolAttributes(this$static);
  if (!$attributesEqual(actualOldAttrs, oldAttrs)) {
    return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('old attributes differ from document', this$static.effectivePos, this$static.resultingPos));
  }
  r = $checkAnnotationsForRetain(this$static, v, 1);
  if (r != VALID) {
    return r;
  }
  r = $validateAttributes_0(this$static, type, newAttrs, v);
  if (r != VALID) {
    return r;
  }
  return VALID;
}

function $checkRetain_0(this$static, itemCount, v){
  if (itemCount <= 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('retain item count not positive', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.insertionStack.size_0 != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('retain inside insert or delete', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.deletionStackDepth != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('retain inside insert or delete', this$static.effectivePos, this$static.resultingPos));
  }
  if (itemCount > (this$static.effectivePos >= this$static.doc.length_1()?0:this$static.doc.length_1() - this$static.effectivePos)) {
    return $retainPastEnd(this$static, v, this$static.doc.length_1(), itemCount);
  }
  return $checkAnnotationsForRetain(this$static, v, itemCount);
}

function $checkUpdateAttributes(this$static, u, v){
  var i, key, oldAttrs, oldValue, r, type, value, entry;
  r = $checkAttributesUpdateWellFormed(this$static, u, v);
  if (r != ($clinit_2006() , VALID)) {
    return r;
  }
  if (this$static.deletionStackDepth != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute change inside insert or delete', this$static.effectivePos, this$static.resultingPos));
  }
  if (this$static.insertionStack.size_0 != 0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('attribute change inside insert or delete', this$static.effectivePos, this$static.resultingPos));
  }
  if ($effectiveDocSymbol_0(this$static) != ($clinit_1999() , OPEN_0)) {
    return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('no element start to change attributes here', this$static.effectivePos, this$static.resultingPos));
  }
  type = $effectiveDocSymbolTag_0(this$static);
  oldAttrs = $effectiveDocSymbolAttributes(this$static);
  for (i = 0; i < u.updates.size_1(); ++i) {
    key = dynamicCast(u.updates.get_0(i), 384).name_0;
    oldValue = dynamicCast(u.updates.get_0(i), 384).oldValue;
    if (!equal(oldValue, (entry = $implFindEntry(oldAttrs, key, false) , !entry?null:entry.getValue()))) {
      return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('old attributes differ from document', this$static.effectivePos, this$static.resultingPos));
    }
  }
  r = $checkAnnotationsForRetain(this$static, v, 1);
  if (r != VALID) {
    return r;
  }
  for (i = 0; i < u.updates.size_1(); ++i) {
    key = dynamicCast(u.updates.get_0(i), 384).name_0;
    value = dynamicCast(u.updates.get_0(i), 384).newValue;
    if (value != null) {
      if (!this$static.constraints.permitsAttribute_0(type, key, value)) {
        return $addViolation_4(v, new DocOpAutomaton$SchemaViolation_0('type ' + type + ' does not permit attribute ' + key + ' with value ' + value, this$static.effectivePos, this$static.resultingPos));
      }
    }
  }
  return VALID;
}

function $childElementRequired(this$static, v, expectedType){
  return $addViolation_4(v, new DocOpAutomaton$SchemaViolation_0('child element required, expected type ' + expectedType, this$static.effectivePos, this$static.resultingPos));
}

function $differentElementTypeRequired(this$static, v, expectedType, actualType){
  return $addViolation_4(v, new DocOpAutomaton$SchemaViolation_0('element of type ' + expectedType + ' required, not ' + actualType, this$static.effectivePos, this$static.resultingPos));
}

function $doAnnotationBoundary(this$static, map){
  this$static.annotationsUpdate = $composeWith_0(this$static.annotationsUpdate, map);
  this$static.afterAnnotationBoundary = true;
}

function $doCharacters_1(this$static, characters){
  this$static.effectivePos > this$static.doc.length_1()?(this$static.targetAnnotationsForDeletion = null):(this$static.targetAnnotationsForDeletion = $inheritedAnnotations(this$static).updateWithNoCompatibilityCheck(this$static.annotationsUpdate));
  this$static.resultingPos += characters.length;
  this$static.afterAnnotationBoundary = false;
}

function $doDeleteCharacters_2(this$static, chars){
  this$static.effectivePos += chars.length;
  this$static.afterAnnotationBoundary = false;
}

function $doDeleteElementEnd_1(this$static){
  --this$static.deletionStackDepth;
  this$static.effectivePos += 1;
  this$static.afterAnnotationBoundary = false;
}

function $doDeleteElementStart_1(this$static){
  ++this$static.deletionStackDepth;
  this$static.effectivePos += 1;
  this$static.afterAnnotationBoundary = false;
}

function $doElementEnd_1(this$static){
  this$static.effectivePos > this$static.doc.length_1()?(this$static.targetAnnotationsForDeletion = null):(this$static.targetAnnotationsForDeletion = $inheritedAnnotations(this$static).updateWithNoCompatibilityCheck(this$static.annotationsUpdate));
  $remove_12(this$static.insertionStack, this$static.insertionStack.size_0 - 1);
  this$static.resultingPos += 1;
  this$static.afterAnnotationBoundary = false;
}

function $doElementStart_1(this$static, type){
  this$static.effectivePos > this$static.doc.length_1()?(this$static.targetAnnotationsForDeletion = null):(this$static.targetAnnotationsForDeletion = $inheritedAnnotations(this$static).updateWithNoCompatibilityCheck(this$static.annotationsUpdate));
  $add_9(this$static.insertionStack, new DocOpAutomaton$InsertStart_0(type));
  this$static.nextRequiredElement = $requiredFirstChild(this$static, type);
  this$static.resultingPos += 1;
  this$static.afterAnnotationBoundary = false;
}

function $doReplaceAttributes(this$static){
  this$static.effectivePos += 1;
  this$static.effectivePos > this$static.doc.length_1()?(this$static.targetAnnotationsForDeletion = null):(this$static.targetAnnotationsForDeletion = $inheritedAnnotations(this$static).updateWithNoCompatibilityCheck(this$static.annotationsUpdate));
  this$static.resultingPos += 1;
  this$static.afterAnnotationBoundary = false;
}

function $doRetain(this$static, itemCount){
  this$static.effectivePos += itemCount;
  this$static.effectivePos > this$static.doc.length_1()?(this$static.targetAnnotationsForDeletion = null):(this$static.targetAnnotationsForDeletion = $inheritedAnnotations(this$static).updateWithNoCompatibilityCheck(this$static.annotationsUpdate));
  this$static.resultingPos += itemCount;
  this$static.afterAnnotationBoundary = false;
}

function $doUpdateAttributes_0(this$static){
  this$static.effectivePos += 1;
  this$static.effectivePos > this$static.doc.length_1()?(this$static.targetAnnotationsForDeletion = null):(this$static.targetAnnotationsForDeletion = $inheritedAnnotations(this$static).updateWithNoCompatibilityCheck(this$static.annotationsUpdate));
  this$static.resultingPos += 1;
  this$static.afterAnnotationBoundary = false;
}

function $effectiveDocSymbol_0(this$static){
  var s;
  if (this$static.effectivePos >= this$static.doc.length_1()) {
    return $clinit_1999() , END_2;
  }
  s = (checkPositionIndex(this$static.effectivePos, this$static.doc.length_1()) , this$static.doc.elementStartingAt(this$static.effectivePos));
  if (s != null) {
    return $clinit_1999() , OPEN_0;
  }
  s = (checkPositionIndex(this$static.effectivePos, this$static.doc.length_1()) , this$static.doc.elementEndingAt(this$static.effectivePos));
  if (s != null) {
    return $clinit_1999() , CLOSE_0;
  }
  return $clinit_1999() , CHARACTER_2;
}

function $effectiveDocSymbolAttributes(this$static){
  var attributes;
  switch ($effectiveDocSymbol_0(this$static).ordinal) {
    case 1:
      {
        attributes = this$static.doc.attributesAt(this$static.effectivePos);
        return attributes;
      }

    default:throw new IllegalStateException_1('not at element start');
  }
}

function $effectiveDocSymbolTag_0(this$static){
  var tag;
  switch ($effectiveDocSymbol_0(this$static).ordinal) {
    case 1:
      {
        tag = (checkPositionIndex(this$static.effectivePos, this$static.doc.length_1()) , this$static.doc.elementStartingAt(this$static.effectivePos));
        return tag;
      }

    case 2:
      {
        tag = (checkPositionIndex(this$static.effectivePos, this$static.doc.length_1()) , this$static.doc.elementEndingAt(this$static.effectivePos));
        return tag;
      }

    default:throw new IllegalStateException_1('not at element start or end');
  }
}

function $effectiveEnclosingElementTag_0(this$static){
  var e, i;
  for (i = this$static.insertionStack.size_0 - 1; i >= 0;) {
    e = dynamicCast($get_7(this$static.insertionStack, i), 412);
    return e.tag;
  }
  if (this$static.effectivePos > this$static.doc.length_1()) {
    return null;
  }
  return this$static.doc.nthEnclosingElementTag(this$static.effectivePos, 0);
}

function $inheritedAnnotations(this$static){
  var posToInheritFrom;
  if (this$static.effectivePos == 0 || this$static.effectivePos > this$static.doc.length_1()) {
    return EMPTY_ANNOTATIONS;
  }
   else {
    posToInheritFrom = this$static.effectivePos - 1;
    return this$static.doc.annotationsAt(posToInheritFrom);
  }
}

function $mismatchedStartAnnotation(this$static, v, key){
  return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('annotation of key ' + key + ' starts but never ends', this$static.effectivePos, this$static.resultingPos));
}

function $missingRetainToEnd(this$static, v, expectedLength, actualLength){
  return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('operation shorter than document, document length ' + expectedLength + ', length of input of operation ' + actualLength, this$static.effectivePos, this$static.resultingPos));
}

function $oldAnnotationsDifferFromDocument(this$static, v, key, oldValue, valueInDoc){
  return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('old annotations differ from document: purported old value for key ' + key + ' is ' + oldValue + ', actual value in document is ' + valueInDoc, this$static.effectivePos, this$static.resultingPos));
}

function $oldCharacterDiffersFromDocument(this$static, v, expected, actual){
  return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('attempt to delete character ' + String.fromCharCode(actual) + ' when the actual character is ' + String.fromCharCode(expected), this$static.effectivePos, this$static.resultingPos));
}

function $requiredFirstChild(this$static, parentType){
  var list;
  list = this$static.constraints.getRequiredInitialChildren(parentType);
  if (list.isEmpty()) {
    return null;
  }
   else if (list.size_1() > 1) {
    throw new UnsupportedOperationException_1('Schema requires multiple initial children');
  }
   else {
    return dynamicCast(list.get_0(0), 1);
  }
}

function $retainPastEnd(this$static, v, expectedLength, retainItemCount){
  return $addViolation_3(v, new DocOpAutomaton$OperationInvalid_0('retain past end of document, document length ' + expectedLength + ', retain item count ' + retainItemCount, this$static.effectivePos, this$static.resultingPos));
}

function $validateAnnotationKey_0(this$static, key, v){
  if (key == null) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('annotation key is null', this$static.effectivePos, this$static.resultingPos));
  }
  if (key.indexOf('?') != -1 || key.indexOf('@') != -1) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('invalid character in annotation key: ' + key, this$static.effectivePos, this$static.resultingPos));
  }
  $clinit_2376();
  if (!traverseUtf16String(key, VALID_UTF16).value_0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('annotation key is not valid UTF-16', this$static.effectivePos, this$static.resultingPos));
  }
  return $clinit_2006() , VALID;
}

function $validateAnnotationValue(this$static, value, v){
  if (value == null) {
    return $clinit_2006() , VALID;
  }
  $clinit_2376();
  if (!traverseUtf16String(value, VALID_UTF16).value_0) {
    return $addViolation_2(v, new DocOpAutomaton$OperationIllFormed_0('annotation value is not valid UTF-16', this$static.effectivePos, this$static.resultingPos));
  }
  return $clinit_2006() , VALID;
}

function $validateAttributes_0(this$static, tag, attr, v){
  var e, e$iterator, key, value;
  for (e$iterator = new ImmutableStateMap$1$1_0(attr.entrySet); e$iterator.iterator.hasNext();) {
    e = dynamicCast(e$iterator.iterator.next_0(), 394);
    key = e.name_0;
    value = e.value_0;
    if (!this$static.constraints.permitsAttribute_0(tag, key, value)) {
      return $addViolation_4(v, new DocOpAutomaton$SchemaViolation_0('type ' + tag + ' does not permit attribute ' + key + ' with value ' + value, this$static.effectivePos, this$static.resultingPos));
    }
  }
  return $clinit_2006() , VALID;
}

function DocOpAutomaton_0(doc, constraints){
  $clinit_1997();
  this.annotationsUpdate = new AnnotationsUpdateImpl_0;
  this.targetAnnotationsForDeletion = EMPTY_ANNOTATIONS;
  this.doc = doc;
  this.constraints = constraints;
  this.nextRequiredElement = $requiredFirstChild(this, null);
  this.insertionStack = new ArrayList_0;
}

function equal(a_0, b){
  return a_0 == null?b == null:$equals_3(a_0, b);
}

function DocOpAutomaton(){
}

_ = DocOpAutomaton_0.prototype = DocOpAutomaton.prototype = new Object_0;
_.getClass$ = function getClass_1286(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton_2_classLit;
}
;
_.castableTypeMap$ = {};
_.afterAnnotationBoundary = false;
_.constraints = null;
_.deletionStackDepth = 0;
_.doc = null;
_.effectivePos = 0;
_.insertionStack = null;
_.nextRequiredElement = null;
_.resultingPos = 0;
var EMPTY_ANNOTATIONS, EMPTY_DOCUMENT;
function DocOpAutomaton$1_0(){
}

function DocOpAutomaton$1(){
}

_ = DocOpAutomaton$1_0.prototype = DocOpAutomaton$1.prototype = new Object_0;
_.annotationsAt = function annotationsAt_0(pos){
  return $clinit_2024() , EMPTY_MAP_1;
}
;
_.attributesAt = function attributesAt_0(pos){
  return null;
}
;
_.charAt_0 = function charAt_0(pos){
  return -1;
}
;
_.elementEndingAt = function elementEndingAt_0(pos){
  return null;
}
;
_.elementStartingAt = function elementStartingAt_0(pos){
  return null;
}
;
_.firstAnnotationChange_0 = function firstAnnotationChange_6(start, end, key, fromValue){
  checkPositionIndexesInRange(start, end, 0);
  return -1;
}
;
_.getAnnotation_0 = function getAnnotation_6(pos, key){
  return null;
}
;
_.getClass$ = function getClass_1287(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$1_2_classLit;
}
;
_.length_1 = function length_2(){
  return 0;
}
;
_.nthEnclosingElementTag = function nthEnclosingElementTag_0(insertionPoint, depth){
  return null;
}
;
_.castableTypeMap$ = {};
function $clinit_1999(){
  $clinit_1999 = nullMethod;
  CHARACTER_2 = new DocOpAutomaton$DocSymbol_0('CHARACTER', 0);
  OPEN_0 = new DocOpAutomaton$DocSymbol_0('OPEN', 1);
  CLOSE_0 = new DocOpAutomaton$DocSymbol_0('CLOSE', 2);
  END_2 = new DocOpAutomaton$DocSymbol_0('END', 3);
  $VALUES_66 = initValues(_3Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$DocSymbol_2_classLit, {9:1, 68:1, 170:1}, 146, [CHARACTER_2, OPEN_0, CLOSE_0, END_2]);
}

function DocOpAutomaton$DocSymbol_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_73(name_0){
  $clinit_1999();
  return valueOf_0(($clinit_2000() , $MAP_66), name_0);
}

function values_67(){
  $clinit_1999();
  return $VALUES_66;
}

function DocOpAutomaton$DocSymbol(){
}

_ = DocOpAutomaton$DocSymbol_0.prototype = DocOpAutomaton$DocSymbol.prototype = new Enum;
_.getClass$ = function getClass_1288(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$DocSymbol_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 146:1};
var $VALUES_66, CHARACTER_2, CLOSE_0, END_2, OPEN_0;
function $clinit_2000(){
  $clinit_2000 = nullMethod;
  $MAP_66 = createValueOfMap(($clinit_1999() , $VALUES_66));
}

var $MAP_66;
function DocOpAutomaton$InsertStart_0(tag){
  this.tag = tag;
}

function DocOpAutomaton$InsertStart(){
}

_ = DocOpAutomaton$InsertStart_0.prototype = DocOpAutomaton$InsertStart.prototype = new Object_0;
_.getClass$ = function getClass_1289(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$InsertStart_2_classLit;
}
;
_.castableTypeMap$ = {412:1};
_.tag = null;
function DocOpAutomaton$Violation(){
}

_ = DocOpAutomaton$Violation.prototype = new Object_0;
_.getClass$ = function getClass_1290(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$Violation_2_classLit;
}
;
_.castableTypeMap$ = {};
_.description = null;
_.originalDocumentPos = 0;
_.resultingDocumentPos = 0;
function DocOpAutomaton$OperationIllFormed_0(description, originalPos, resultingPos){
  this.description = description;
  this.originalDocumentPos = originalPos;
  this.resultingDocumentPos = resultingPos;
}

function DocOpAutomaton$OperationIllFormed(){
}

_ = DocOpAutomaton$OperationIllFormed_0.prototype = DocOpAutomaton$OperationIllFormed.prototype = new DocOpAutomaton$Violation;
_.getClass$ = function getClass_1291(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$OperationIllFormed_2_classLit;
}
;
_.castableTypeMap$ = {413:1};
function DocOpAutomaton$OperationInvalid_0(description, originalPos, resultingPos){
  this.description = description;
  this.originalDocumentPos = originalPos;
  this.resultingDocumentPos = resultingPos;
}

function DocOpAutomaton$OperationInvalid(){
}

_ = DocOpAutomaton$OperationInvalid_0.prototype = DocOpAutomaton$OperationInvalid.prototype = new DocOpAutomaton$Violation;
_.getClass$ = function getClass_1292(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$OperationInvalid_2_classLit;
}
;
_.castableTypeMap$ = {414:1};
function DocOpAutomaton$SchemaViolation_0(description, originalPos, resultingPos){
  this.description = description;
  this.originalDocumentPos = originalPos;
  this.resultingDocumentPos = resultingPos;
}

function DocOpAutomaton$SchemaViolation(){
}

_ = DocOpAutomaton$SchemaViolation_0.prototype = DocOpAutomaton$SchemaViolation.prototype = new DocOpAutomaton$Violation;
_.getClass$ = function getClass_1293(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$SchemaViolation_2_classLit;
}
;
_.castableTypeMap$ = {415:1};
function $clinit_2006(){
  $clinit_2006 = nullMethod;
  ILL_FORMED = new DocOpAutomaton$ValidationResult_0('ILL_FORMED', 0);
  INVALID_DOCUMENT = new DocOpAutomaton$ValidationResult_0('INVALID_DOCUMENT', 1);
  INVALID_SCHEMA = new DocOpAutomaton$ValidationResult_0('INVALID_SCHEMA', 2);
  VALID = new DocOpAutomaton$ValidationResult_0('VALID', 3);
  $VALUES_67 = initValues(_3Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$ValidationResult_2_classLit, {9:1, 68:1, 170:1}, 147, [ILL_FORMED, INVALID_DOCUMENT, INVALID_SCHEMA, VALID]);
}

function $mergeWith(this$static, other){
  checkNotNull_1(other, 'Null ValidationResult');
  return $VALUES_67[min_1(this$static.ordinal, other.ordinal)];
}

function DocOpAutomaton$ValidationResult_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_74(name_0){
  $clinit_2006();
  return valueOf_0(($clinit_2007() , $MAP_67), name_0);
}

function values_68(){
  $clinit_2006();
  return $VALUES_67;
}

function DocOpAutomaton$ValidationResult(){
}

_ = DocOpAutomaton$ValidationResult_0.prototype = DocOpAutomaton$ValidationResult.prototype = new Enum;
_.getClass$ = function getClass_1294(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$ValidationResult_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 147:1};
var $VALUES_67, ILL_FORMED, INVALID_DOCUMENT, INVALID_SCHEMA, VALID;
function $clinit_2007(){
  $clinit_2007 = nullMethod;
  $MAP_67 = createValueOfMap(($clinit_2006() , $VALUES_67));
}

var $MAP_67;
function $firstDescription(this$static){
  var v, v$iterator;
  for (v$iterator = new AbstractList$IteratorImpl_0(this$static.operationIllFormed); v$iterator.i < v$iterator.this$0_0.size_1();) {
    v = dynamicCast($next_4(v$iterator), 413);
    return 'ill-formed: ' + v.description + ' at original document position ' + v.originalDocumentPos + ' / resulting document position ' + v.resultingDocumentPos;
  }
  for (v$iterator = new AbstractList$IteratorImpl_0(this$static.operationInvalid); v$iterator.i < v$iterator.this$0_0.size_1();) {
    v = dynamicCast($next_4(v$iterator), 414);
    return 'invalid operation: ' + v.description + ' at original document position ' + v.originalDocumentPos + ' / resulting document position ' + v.resultingDocumentPos;
  }
  for (v$iterator = new AbstractList$IteratorImpl_0(this$static.schemaViolations); v$iterator.i < v$iterator.this$0_0.size_1();) {
    v = dynamicCast($next_4(v$iterator), 415);
    return 'schema violation: ' + v.description + ' at original document position ' + v.originalDocumentPos + ' / resulting document position ' + v.resultingDocumentPos;
  }
  return null;
}

function $getValidationResult(this$static){
  return this$static.operationIllFormed.size_0 == 0?this$static.operationInvalid.size_0 == 0?this$static.schemaViolations.size_0 == 0?($clinit_2006() , VALID):($clinit_2006() , INVALID_SCHEMA):($clinit_2006() , INVALID_DOCUMENT):($clinit_2006() , ILL_FORMED);
}

function DocOpAutomaton$ViolationCollector_0(){
  this.operationIllFormed = new ArrayList_0;
  this.operationInvalid = new ArrayList_0;
  this.schemaViolations = new ArrayList_0;
}

function DocOpAutomaton$ViolationCollector(){
}

_ = DocOpAutomaton$ViolationCollector_0.prototype = DocOpAutomaton$ViolationCollector.prototype = new Object_0;
_.getClass$ = function getClass_1295(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$ViolationCollector_2_classLit;
}
;
_.toString$ = function toString_105(){
  var b;
  if (this.operationIllFormed.size_0 + this.operationInvalid.size_0 + this.schemaViolations.size_0 == 0) {
    return 'ViolationCollector[0]';
  }
  b = new StringBuilder_0;
  $append_11(b, 'ViolationCollector[' + (this.operationIllFormed.size_0 + this.operationInvalid.size_0 + this.schemaViolations.size_0) + ': ' + $firstDescription(this) + ']');
  return b.impl.string;
}
;
_.castableTypeMap$ = {};
function $clinit_2009(){
  $clinit_2009 = nullMethod;
  NO_SCHEMA_CONSTRAINTS = new DocumentSchema$1_0;
}

var NO_SCHEMA_CONSTRAINTS;
function DocumentSchema$1_0(){
}

function DocumentSchema$1(){
}

_ = DocumentSchema$1_0.prototype = DocumentSchema$1.prototype = new Object_0;
_.getClass$ = function getClass_1296(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$1_2_classLit;
}
;
_.getRequiredInitialChildren = function getRequiredInitialChildren(typeOrNull){
  return $clinit_480() , $clinit_480() , EMPTY_LIST;
}
;
_.permitsAttribute = function permitsAttribute(type, attributeName){
  return true;
}
;
_.permitsAttribute_0 = function permitsAttribute_0(type, attributeName, attributeValue){
  return true;
}
;
_.permitsChild = function permitsChild(parentType, childType){
  return true;
}
;
_.permittedCharacters = function permittedCharacters(type){
  return $clinit_2011() , ANY;
}
;
_.castableTypeMap$ = {459:1};
function $clinit_2011(){
  $clinit_2011 = nullMethod;
  NONE_3 = new DocumentSchema$PermittedCharacters$1_0;
  BLIP_TEXT = new DocumentSchema$PermittedCharacters$2_0;
  ANY = new DocumentSchema$PermittedCharacters$3_0;
  $VALUES_68 = initValues(_3Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters_2_classLit, {9:1, 68:1, 170:1}, 148, [NONE_3, BLIP_TEXT, ANY]);
}

function valueOf_75(name_0){
  $clinit_2011();
  return valueOf_0(($clinit_2017() , $MAP_68), name_0);
}

function values_69(){
  $clinit_2011();
  return $VALUES_68;
}

function DocumentSchema$PermittedCharacters(){
}

_ = DocumentSchema$PermittedCharacters.prototype = new Enum;
_.getClass$ = function getClass_1297(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 148:1};
var $VALUES_68, ANY, BLIP_TEXT, NONE_3;
function DocumentSchema$PermittedCharacters$1_0(){
  this.name_1 = 'NONE';
  this.ordinal = 0;
}

function DocumentSchema$PermittedCharacters$1(){
}

_ = DocumentSchema$PermittedCharacters$1_0.prototype = DocumentSchema$PermittedCharacters$1.prototype = new DocumentSchema$PermittedCharacters;
_.coerceString = function coerceString(string){
  throw new IllegalArgumentException_1("Text not permitted at all, can't convert");
}
;
_.getClass$ = function getClass_1298(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters$1_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 148:1};
function $coerceString(string){
  var result;
  result = new StringBuilder_0;
  traverseUtf16String(string, new DocumentSchema$PermittedCharacters$2$1_0(result));
  return result.impl.string;
}

function DocumentSchema$PermittedCharacters$2_0(){
  this.name_1 = 'BLIP_TEXT';
  this.ordinal = 1;
}

function DocumentSchema$PermittedCharacters$2(){
}

_ = DocumentSchema$PermittedCharacters$2_0.prototype = DocumentSchema$PermittedCharacters$2.prototype = new DocumentSchema$PermittedCharacters;
_.coerceString = function coerceString_0(string){
  var result;
  return result = new StringBuilder_0 , traverseUtf16String(string, new DocumentSchema$PermittedCharacters$2$1_0(result)) , result.impl.string;
}
;
_.getClass$ = function getClass_1299(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters$2_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 148:1};
function DocumentSchema$PermittedCharacters$2$1_0(val$result){
  this.val$result = val$result;
}

function DocumentSchema$PermittedCharacters$2$1(){
}

_ = DocumentSchema$PermittedCharacters$2$1_0.prototype = DocumentSchema$PermittedCharacters$2$1.prototype = new Object_0;
_.codePoint = function codePoint_0(cp){
  return cp == 9?$append_11(this.val$result, '    '):cp == 10 || cp == 13?$append_6(this.val$result, 32):($clinit_2376() , 0 <= cp && cp <= 1114111 || illegalArgument('Not a code point: 0x' + toPowerOfTwoString(cp)) , cp >= 65536?$append_6(this.val$result, 65533):isCodePointGoodForBlip(cp) == ($clinit_2380() , OK)?$append_6(this.val$result, cp & 65535):$append_6(this.val$result, 65533)) , null;
}
;
_.endOfString = function endOfString(){
  return null;
}
;
_.getClass$ = function getClass_1300(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters$2$1_2_classLit;
}
;
_.unpairedSurrogate = function unpairedSurrogate(c){
  return $append_6(this.val$result, 65533) , null;
}
;
_.castableTypeMap$ = {};
_.val$result = null;
function DocumentSchema$PermittedCharacters$3_0(){
  this.name_1 = 'ANY';
  this.ordinal = 2;
}

function DocumentSchema$PermittedCharacters$3(){
}

_ = DocumentSchema$PermittedCharacters$3_0.prototype = DocumentSchema$PermittedCharacters$3.prototype = new DocumentSchema$PermittedCharacters;
_.coerceString = function coerceString_1(string){
  var result;
  result = new StringBuilder_0;
  traverseUtf16String(string, new DocumentSchema$PermittedCharacters$3$1_0(result));
  return result.impl.string;
}
;
_.getClass$ = function getClass_1301(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters$3_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 148:1};
function DocumentSchema$PermittedCharacters$3$1_0(val$result){
  this.val$result = val$result;
}

function DocumentSchema$PermittedCharacters$3$1(){
}

_ = DocumentSchema$PermittedCharacters$3$1_0.prototype = DocumentSchema$PermittedCharacters$3$1.prototype = new Object_0;
_.codePoint = function codePoint_1(cp){
  return $clinit_2376() , 0 <= cp && cp <= 1114111 || illegalArgument('Not a code point: 0x' + toPowerOfTwoString(cp)) , cp >= 65536?$append_6(this.val$result, 65533):isCodePointValid(cp)?$append_6(this.val$result, cp & 65535):$append_6(this.val$result, 65533) , null;
}
;
_.endOfString = function endOfString_0(){
  return null;
}
;
_.getClass$ = function getClass_1302(){
  return Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters$3$1_2_classLit;
}
;
_.unpairedSurrogate = function unpairedSurrogate_0(c){
  return $append_6(this.val$result, 65533) , null;
}
;
_.castableTypeMap$ = {};
_.val$result = null;
function $clinit_2017(){
  $clinit_2017 = nullMethod;
  $MAP_68 = createValueOfMap(($clinit_2011() , $VALUES_68));
}

var $MAP_68;
function AbstractDocInitialization(){
}

_ = AbstractDocInitialization.prototype = new Object_0;
_.apply_8 = function apply_112(c){
  this.val$op.apply_8(c?c:new InitializationCursorAdapter_0(null));
}
;
_.apply_7 = function apply_113(c){
  $apply_40(this, throwClassCastExceptionUnlessNull(c));
}
;
_.applyComponent = function applyComponent_0(i, c){
  this.val$op.applyComponent(i, c?c:new InitializationCursorAdapter_0(null));
}
;
_.getClass$ = function getClass_1303(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_AbstractDocInitialization_2_classLit;
}
;
_.castableTypeMap$ = {207:1, 392:1};
function $apply_40(this$static, c){
  this$static.val$op.apply_8(c?c:new InitializationCursorAdapter_0(null));
}

function AbstractBufferedDocInitialization(){
}

_ = AbstractBufferedDocInitialization.prototype = new AbstractDocInitialization;
_.apply_8 = function apply_114(c){
  this.val$op.apply_8(c?c:new InitializationCursorAdapter_0(null));
}
;
_.getClass$ = function getClass_1304(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_AbstractBufferedDocInitialization_2_classLit;
}
;
_.getDeleteCharactersString = function getDeleteCharactersString_0(i){
  throw new UnsupportedOperationException_1('Initializations have no delete characters components');
}
;
_.getDeleteElementStartAttributes = function getDeleteElementStartAttributes_0(i){
  throw new UnsupportedOperationException_1('Initializations have no delete element start components');
}
;
_.getDeleteElementStartTag = function getDeleteElementStartTag_0(i){
  throw new UnsupportedOperationException_1('Initializations have no delete element start components');
}
;
_.getReplaceAttributesNewAttributes = function getReplaceAttributesNewAttributes_0(i){
  throw new UnsupportedOperationException_1('Initializations have no replace attributes components');
}
;
_.getReplaceAttributesOldAttributes = function getReplaceAttributesOldAttributes_0(i){
  throw new UnsupportedOperationException_1('Initializations have no replace attributes components');
}
;
_.getRetainItemCount = function getRetainItemCount_0(i){
  throw new UnsupportedOperationException_1('Initializations have no retain components');
}
;
_.getUpdateAttributesUpdate = function getUpdateAttributesUpdate_0(i){
  throw new UnsupportedOperationException_1('Initializations have no update attributes components');
}
;
_.toString$ = function toString_106(){
  return 'BufferedInit@' + toPowerOfTwoString(this.$H || (this.$H = ++sNextHashId)) + '[' + toConciseString(($clinit_2104() , $clinit_2104() , asInitialization(scrub_0(this)))) + ']';
}
;
_.castableTypeMap$ = {207:1, 392:1};
function $clinit_2020(){
  $clinit_2020 = nullMethod;
  EMPTY_ARRAY = initDim(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, 0, 0);
  $build_5(new AnnotationBoundaryMapImpl$Builder_0);
}

function $copy(input){
  var i, ret;
  ret = initDim(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, input.length, 0);
  for (i = 0; i < input.length; ++i) {
    ret[i] = input[i];
  }
  return ret;
}

function AnnotationBoundaryMapImpl_0(endKeys, changeKeys, changeOldValues, changeNewValues){
  $clinit_2020();
  var changeKey, changeKey$index, changeKey$max, changeKeySet, endKey, endKey$index, endKey$max, endKeySet;
  if (changeKeys.length != changeOldValues.length || changeKeys.length != changeNewValues.length) {
    throw new IllegalArgumentException_1("Change keys, new values, and old values sizes don't match");
  }
  changeKeySet = new HashSet_1(new Arrays$ArrayList_0(changeKeys));
  endKeySet = new HashSet_1(new Arrays$ArrayList_0(endKeys));
  if (changeKeySet.map.size_1() != changeKeys.length || endKeySet.map.size_1() != endKeys.length) {
    throw new IllegalArgumentException_1('Keys must all be unique');
  }
  if (changeKeySet.map.containsKey(null) || endKeySet.map.containsKey(null)) {
    throw new NullPointerException_1('Null keys are not permitted');
  }
  if (changeKeySet.map.containsKey('') || endKeySet.map.containsKey('')) {
    throw new IllegalArgumentException_1('Empty-string keys are not permitted');
  }
  for (changeKey$index = 0 , changeKey$max = changeKeys.length; changeKey$index < changeKey$max; ++changeKey$index) {
    changeKey = changeKeys[changeKey$index];
    validateAnnotationKey(changeKey);
  }
  for (endKey$index = 0 , endKey$max = endKeys.length; endKey$index < endKey$max; ++endKey$index) {
    endKey = endKeys[endKey$index];
    validateAnnotationKey(endKey);
    if (changeKeySet.map.containsKey(endKey)) {
      throw new IllegalArgumentException_1('Change keys and end keys must be disjoint sets');
    }
  }
  this.changeKeys = $copy(changeKeys);
  this.changeOldValues = $copy(changeOldValues);
  this.changeNewValues = $copy(changeNewValues);
  this.endKeys = $copy(endKeys);
}

function validateAnnotationKey(key){
  if (key.indexOf('?') != -1 || key.indexOf('@') != -1) {
    throw new IllegalArgumentException_1("Annotation keys must not contain the '?' or '@' characters");
  }
}

function AnnotationBoundaryMapImpl(){
}

_ = AnnotationBoundaryMapImpl_0.prototype = AnnotationBoundaryMapImpl.prototype = new Object_0;
_.changeSize = function changeSize_3(){
  return this.changeKeys.length;
}
;
_.endSize = function endSize_3(){
  return this.endKeys.length;
}
;
_.getChangeKey_0 = function getChangeKey_4(changeIndex){
  return this.changeKeys[changeIndex];
}
;
_.getClass$ = function getClass_1305(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_AnnotationBoundaryMapImpl_2_classLit;
}
;
_.getEndKey_0 = function getEndKey_4(endIndex){
  return this.endKeys[endIndex];
}
;
_.getNewValue = function getNewValue_2(changeIndex){
  return this.changeNewValues[changeIndex];
}
;
_.getOldValue = function getOldValue_2(changeIndex){
  return this.changeOldValues[changeIndex];
}
;
_.toString$ = function toString_107(){
  return toConciseString_2(this);
}
;
_.castableTypeMap$ = {409:1};
_.changeKeys = null;
_.changeNewValues = null;
_.changeOldValues = null;
_.endKeys = null;
var EMPTY_ARRAY;
function $build_5(this$static){
  return new AnnotationBoundaryMapImpl_0(this$static.endKeys, this$static.changeKeys, this$static.changeOldValues, this$static.changeNewValues);
}

function AnnotationBoundaryMapImpl$Builder_0(){
  this.changeKeys = ($clinit_2020() , EMPTY_ARRAY);
  this.changeOldValues = EMPTY_ARRAY;
  this.changeNewValues = EMPTY_ARRAY;
  this.endKeys = EMPTY_ARRAY;
}

function AnnotationBoundaryMapImpl$Builder(){
}

_ = AnnotationBoundaryMapImpl$Builder_0.prototype = AnnotationBoundaryMapImpl$Builder.prototype = new Object_0;
_.getClass$ = function getClass_1306(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_AnnotationBoundaryMapImpl$Builder_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_2023(){
  $clinit_2023 = nullMethod;
  comparator = new ImmutableStateMap$2_0;
}

function $attributeListFromMap(map){
  var attributeList, entry, entry$iterator;
  attributeList = new ArrayList_2(map.size_1());
  for (entry$iterator = map.entrySet_0().iterator_0(); entry$iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.next_0(), 11);
    (entry.getKey() == null || entry.getValue() == null) && nullPointer('This map does not allow null keys or values');
    $add_9(attributeList, new ImmutableStateMap$Attribute_0(entry));
  }
  sort_2(attributeList, comparator);
  return attributeList;
}

function $updateWith(this$static, attributeUpdate, checkCompatibility){
  var comparison, iterator, newImmutableStateMap, nextAttribute, update, update$iterator, updates;
  newImmutableStateMap = new ArrayList_0;
  iterator = this$static.attributes.iterator_0();
  nextAttribute = iterator.hasNext()?dynamicCast(iterator.next_0(), 394):null;
  updates = attributeUpdate.updates;
  for (update$iterator = updates.iterator_0(); update$iterator.hasNext();) {
    update = dynamicCast(update$iterator.next_0(), 384);
    while (nextAttribute) {
      comparison = compareTo_5(update.name_0, nextAttribute.name_0);
      if (comparison > 0) {
        setCheck(newImmutableStateMap.array, newImmutableStateMap.size_0++, nextAttribute);
        nextAttribute = iterator.hasNext()?dynamicCast(iterator.next_0(), 394):null;
      }
       else if (comparison < 0) {
        checkCompatibility && update.oldValue != null && illegalArgument('Mismatched old value: attempt to update unset attribute with ' + update);
        break;
      }
       else if (comparison == 0) {
        checkCompatibility && !$equals_3(nextAttribute.value_0, update.oldValue) && illegalArgument('Mismatched old value: attempt to update ' + nextAttribute + ' with ' + update);
        nextAttribute = iterator.hasNext()?dynamicCast(iterator.next_0(), 394):null;
        break;
      }
    }
    update.newValue != null && $add_9(newImmutableStateMap, new ImmutableStateMap$Attribute_1(update.name_0, update.newValue));
  }
  if (nextAttribute) {
    setCheck(newImmutableStateMap.array, newImmutableStateMap.size_0++, nextAttribute);
    while (iterator.hasNext()) {
      $add_9(newImmutableStateMap, dynamicCast(iterator.next_0(), 394));
    }
  }
  return this$static.createFromList(newImmutableStateMap);
}

function ImmutableStateMap_0(){
  $clinit_2023();
  this.entrySet = new ImmutableStateMap$1_0(this);
  this.attributes = ($clinit_480() , $clinit_480() , EMPTY_LIST);
}

function ImmutableStateMap_2(pairs){
  var i, map;
  this.entrySet = new ImmutableStateMap$1_0(this);
  checkArgument_2(pairs.length % 2 == 0, 'Pairs must come in groups of two');
  map = new HashMap_0;
  for (i = 0; i < pairs.length; i += 2) {
    checkNotNull_1(pairs[i], 'Null key');
    checkNotNull_1(pairs[i + 1], 'Null value');
    map.containsKey(pairs[i]) && illegalArgument('Duplicate key: ' + pairs[i]);
    map.put(pairs[i], pairs[i + 1]);
  }
  this.attributes = $attributeListFromMap(map);
}

function checkAttributesSorted(attributes){
  var a_0, a$iterator, previous;
  previous = null;
  for (a$iterator = new AbstractList$IteratorImpl_0(attributes); a$iterator.i < a$iterator.this$0_0.size_1();) {
    a_0 = dynamicCast($next_4(a$iterator), 394);
    checkNotNull_1(a_0, 'Null attribute');
    !!previous && compareTo_5(previous.name_0, a_0.name_0) >= 0 && illegalArgument('Attribute keys not strictly monotonic: ' + previous.name_0 + ', ' + a_0.name_0);
    previous = a_0;
  }
}

function ImmutableStateMap(){
}

_ = ImmutableStateMap.prototype = new AbstractMap;
_.entrySet_0 = function entrySet_6(){
  return this.entrySet;
}
;
_.getClass$ = function getClass_1307(){
  return Lorg_waveprotocol_wave_model_document_operation_util_ImmutableStateMap_2_classLit;
}
;
_.castableTypeMap$ = {40:1};
_.attributes = null;
var comparator;
function $clinit_2024(){
  $clinit_2024 = nullMethod;
  $clinit_2023();
  EMPTY_MAP_1 = new AnnotationMapImpl_0;
}

function AnnotationMapImpl_0(){
  ImmutableStateMap_0.call(this);
}

function AnnotationMapImpl_1(map){
  $clinit_2024();
  this.entrySet = new ImmutableStateMap$1_0(this);
  this.attributes = $attributeListFromMap(map);
}

function AnnotationMapImpl_2(attributes){
  $clinit_2023();
  this.entrySet = new ImmutableStateMap$1_0(this);
  this.attributes = attributes;
}

function AnnotationMapImpl(){
}

_ = AnnotationMapImpl_2.prototype = AnnotationMapImpl_1.prototype = AnnotationMapImpl_0.prototype = AnnotationMapImpl.prototype = new ImmutableStateMap;
_.createFromList = function createFromList(attributes){
  return new AnnotationMapImpl_2(attributes);
}
;
_.getClass$ = function getClass_1308(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_AnnotationMapImpl_2_classLit;
}
;
_.updateWithNoCompatibilityCheck = function updateWithNoCompatibilityCheck_0(attributeUpdate){
  return $updateWith(this, attributeUpdate, false);
}
;
_.castableTypeMap$ = {40:1, 399:1};
var EMPTY_MAP_1;
function $clinit_2026(){
  $clinit_2026 = nullMethod;
  comparator_0 = new ImmutableUpdateMap$1_0;
}

function $areEqual(a_0, b){
  return a_0 == null?b == null:$equals_3(a_0, b);
}

function $composeWith(this$static, mutation){
  var attribute, attribute$iterator, comparison, iterator, mutationAttributes, newAttributes, nextAttribute;
  newAttributes = new ArrayList_0;
  iterator = this$static.updates.iterator_0();
  nextAttribute = iterator.hasNext()?dynamicCast(iterator.next_0(), 384):null;
  mutationAttributes = mutation.updates;
  loop: for (attribute$iterator = mutationAttributes.iterator_0(); attribute$iterator.hasNext();) {
    attribute = dynamicCast(attribute$iterator.next_0(), 384);
    while (nextAttribute) {
      comparison = compareTo_5(dynamicCast(attribute, 384).name_0, dynamicCast(nextAttribute, 384).name_0);
      if (comparison < 0) {
        break;
      }
       else if (comparison > 0) {
        setCheck(newAttributes.array, newAttributes.size_0++, nextAttribute);
        nextAttribute = iterator.hasNext()?dynamicCast(iterator.next_0(), 384):null;
      }
       else {
        $areEqual(nextAttribute.newValue, attribute.oldValue) || illegalArgument('Mismatched old value: attempt to update ' + nextAttribute + ' with ' + attribute);
        $add_9(newAttributes, new ImmutableUpdateMap$AttributeUpdate_0(attribute.name_0, nextAttribute.oldValue, attribute.newValue));
        nextAttribute = iterator.hasNext()?dynamicCast(iterator.next_0(), 384):null;
        continue loop;
      }
    }
    setCheck(newAttributes.array, newAttributes.size_0++, attribute);
  }
  if (nextAttribute) {
    setCheck(newAttributes.array, newAttributes.size_0++, nextAttribute);
    while (iterator.hasNext()) {
      $add_9(newAttributes, dynamicCast(iterator.next_0(), 384));
    }
  }
  return new AttributesUpdateImpl_2(newAttributes);
}

function ImmutableUpdateMap_1(triples){
  $clinit_2026();
  var accu, i, x;
  checkArgument_2(triples.length % 3 == 0, 'Triples must come in groups of three');
  accu = new ArrayList_2(~~(triples.length / 3));
  for (i = 0; i < triples.length; i += 3) {
    checkNotNull_1(triples[i], 'Null key');
    $add_9(accu, new ImmutableUpdateMap$AttributeUpdate_0(triples[i], triples[i + 1], triples[i + 2]));
  }
  sort_2(accu, comparator_0);
  for (i = 1; i < accu.size_0; ++i) {
    x = $compare_9(dynamicCast((checkIndex(i - 1, accu.size_0) , accu.array[i - 1]), 384), dynamicCast((checkIndex(i, accu.size_0) , accu.array[i]), 384));
    if (x == 0) {
      throw new IllegalArgumentException_1('Duplicate key: ' + dynamicCast((checkIndex(i, accu.size_0) , accu.array[i]), 384).name_0);
    }
  }
  this.updates = accu;
}

function ImmutableUpdateMap(){
}

_ = ImmutableUpdateMap.prototype = new Object_0;
_.getClass$ = function getClass_1309(){
  return Lorg_waveprotocol_wave_model_document_operation_util_ImmutableUpdateMap_2_classLit;
}
;
_.toString$ = function toString_108(){
  return 'Updates: ' + this.updates;
}
;
_.castableTypeMap$ = {};
_.updates = null;
var comparator_0;
function $clinit_2027(){
  $clinit_2027 = nullMethod;
  $clinit_2026();
  new AnnotationsUpdateImpl_0;
}

function $composeWith_0(this$static, map){
  var changeIndex, changeKey, endIndex, endKey, existingIndex, existingKey, existingVsChange, existingVsEnd, newUpdates;
  newUpdates = new ArrayList_0;
  existingIndex = 0;
  changeIndex = 0;
  endIndex = 0;
  while (existingIndex < this$static.updates.size_1() || changeIndex < map.changeSize() || endIndex < map.endSize()) {
    existingKey = existingIndex < this$static.updates.size_1()?dynamicCast(this$static.updates.get_0(existingIndex), 384).name_0:'\uFFFF';
    changeKey = changeIndex < map.changeSize()?map.getChangeKey_0(changeIndex):'\uFFFF';
    endKey = endIndex < map.endSize()?map.getEndKey_0(endIndex):'\uFFFF';
    existingVsEnd = compareTo_5(existingKey, endKey);
    existingVsChange = compareTo_5(existingKey, changeKey);
    if (existingVsEnd < 0) {
      if (existingVsChange < 0) {
        $add_9(newUpdates, dynamicCast(this$static.updates.get_0(existingIndex), 384));
        ++existingIndex;
      }
       else if (existingVsChange == 0) {
        $add_9(newUpdates, new ImmutableUpdateMap$AttributeUpdate_0(changeKey, map.getOldValue(changeIndex), map.getNewValue(changeIndex)));
        ++existingIndex;
        ++changeIndex;
      }
       else if (existingVsChange > 0) {
        $add_9(newUpdates, new ImmutableUpdateMap$AttributeUpdate_0(changeKey, map.getOldValue(changeIndex), map.getNewValue(changeIndex)));
        ++changeIndex;
      }
    }
     else if (existingVsEnd == 0) {
      if (existingVsChange < 0) {
        ++existingIndex;
        ++endIndex;
      }
       else if (existingVsChange == 0) {
        illegalArgument('AnnotationBoundaryMap with key both in change and end: ' + changeKey);
      }
       else if (existingVsChange > 0) {
        $add_9(newUpdates, new ImmutableUpdateMap$AttributeUpdate_0(changeKey, map.getOldValue(changeIndex), map.getNewValue(changeIndex)));
        ++existingIndex;
        ++endIndex;
        ++changeIndex;
      }
    }
     else 
      existingVsEnd > 0 && illegalArgument('Attempt to end key that is not part of the update: ' + endKey);
  }
  return new AnnotationsUpdateImpl_1(newUpdates);
}

function $containsKey_7(this$static, key){
  var u, u$iterator;
  checkNotNull_1(key, 'Null key');
  for (u$iterator = this$static.updates.iterator_0(); u$iterator.hasNext();) {
    u = dynamicCast(u$iterator.next_0(), 384);
    if ($equals_3(key, u.name_0)) {
      return true;
    }
  }
  return false;
}

function AnnotationsUpdateImpl_0(){
  $clinit_2027();
  this.updates = ($clinit_480() , $clinit_480() , EMPTY_LIST);
}

function AnnotationsUpdateImpl_1(updates){
  $clinit_2026();
  this.updates = updates;
}

function AnnotationsUpdateImpl(){
}

_ = AnnotationsUpdateImpl_1.prototype = AnnotationsUpdateImpl_0.prototype = AnnotationsUpdateImpl.prototype = new ImmutableUpdateMap;
_.getClass$ = function getClass_1310(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_AnnotationsUpdateImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
function AttributesImpl_0(){
  $clinit_2023();
  ImmutableStateMap_0.call(this);
}

function AttributesImpl_1(map){
  $clinit_2023();
  this.entrySet = new ImmutableStateMap$1_0(this);
  this.attributes = $attributeListFromMap(map);
}

function AttributesImpl_2(attributes){
  $clinit_2023();
  this.entrySet = new ImmutableStateMap$1_0(this);
  this.attributes = attributes;
}

function AttributesImpl_3(pairs){
  $clinit_2023();
  ImmutableStateMap_2.call(this, pairs);
}

function fromStringMap(stringMap){
  $clinit_2023();
  var attrs;
  attrs = new ArrayList_0;
  stringMap.each_2(new AttributesImpl$1_0(attrs));
  return fromUnsortedAttributes(attrs);
}

function fromUnsortedAttributes(unsortedAttributes){
  $clinit_2023();
  var sorted;
  sorted = new ArrayList_1(unsortedAttributes);
  sort_2(sorted, comparator);
  return checkAttributesSorted(sorted) , new AttributesImpl_2(sorted);
}

function AttributesImpl(){
}

_ = AttributesImpl_3.prototype = AttributesImpl_2.prototype = AttributesImpl_1.prototype = AttributesImpl_0.prototype = AttributesImpl.prototype = new ImmutableStateMap;
_.createFromList = function createFromList_0(attributes){
  return new AttributesImpl_2(attributes);
}
;
_.getClass$ = function getClass_1311(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_AttributesImpl_2_classLit;
}
;
_.castableTypeMap$ = {40:1, 410:1};
function AttributesImpl$1_0(val$attrs){
  this.val$attrs = val$attrs;
}

function AttributesImpl$1(){
}

_ = AttributesImpl$1_0.prototype = AttributesImpl$1.prototype = new Object_0;
_.apply_1 = function apply_115(key, value){
  $add_9(this.val$attrs, new ImmutableStateMap$Attribute_1(key, dynamicCast(value, 1)));
}
;
_.getClass$ = function getClass_1312(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_AttributesImpl$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$attrs = null;
function $clinit_2030(){
  $clinit_2030 = nullMethod;
  $clinit_2026();
  new AttributesUpdateImpl_0;
}

function AttributesUpdateImpl_0(){
  $clinit_2030();
  this.updates = ($clinit_480() , $clinit_480() , EMPTY_LIST);
}

function AttributesUpdateImpl_1(triples){
  $clinit_2030();
  ImmutableUpdateMap_1.call(this, triples);
}

function AttributesUpdateImpl_2(updates){
  $clinit_2030();
  this.updates = updates;
}

function AttributesUpdateImpl(){
}

_ = AttributesUpdateImpl_2.prototype = AttributesUpdateImpl_1.prototype = AttributesUpdateImpl_0.prototype = AttributesUpdateImpl.prototype = new ImmutableUpdateMap;
_.getClass$ = function getClass_1313(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_AttributesUpdateImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
function $apply_42(this$static, cursor){
  var component, component$array, component$index, component$max;
  for (component$array = this$static.components , component$index = 0 , component$max = component$array.length; component$index < component$max; ++component$index) {
    component = component$array[component$index];
    component.apply_8(cursor);
  }
}

function $check_3(this$static, i, expectedType){
  var actualType;
  actualType = this$static.components[i].getType_2();
  actualType != expectedType && illegalArgument('Component ' + i + " is not of type ' " + expectedType + "', it is '" + actualType + "'");
}

function BufferedDocOpImpl_0(components){
  this.components = components;
}

function checkWellformedness(value){
  var v;
  $clinit_2042();
  if (!(value?isWellFormed(null, value):validate_1(null, ($clinit_2009() , NO_SCHEMA_CONSTRAINTS), ($clinit_1997() , EMPTY_DOCUMENT), null) != ($clinit_2006() , ILL_FORMED))) {
    v = new DocOpAutomaton$ViolationCollector_0;
    value?isWellFormed(v, value):validate_1(v, ($clinit_2009() , NO_SCHEMA_CONSTRAINTS), ($clinit_1997() , EMPTY_DOCUMENT), null) != ($clinit_2006() , ILL_FORMED);
    illegalState('Attempt to build ill-formed operation (' + v + '): ' + value);
  }
}

function BufferedDocOpImpl(){
}

_ = BufferedDocOpImpl_0.prototype = BufferedDocOpImpl.prototype = new Object_0;
_.apply_8 = function apply_116(cursor){
  $apply_42(this, cursor);
}
;
_.apply_7 = function apply_117(cursor){
  $apply_42(this, throwClassCastExceptionUnlessNull(cursor));
}
;
_.applyComponent = function applyComponent_1(i, cursor){
  this.components[i].apply_8(cursor);
}
;
_.getAnnotationBoundary = function getAnnotationBoundary_0(i){
  $check_3(this, i, ($clinit_1886() , ANNOTATION_BOUNDARY));
  return dynamicCast(this.components[i], 420).boundary;
}
;
_.getCharactersString = function getCharactersString_0(i){
  $check_3(this, i, ($clinit_1886() , CHARACTERS));
  return dynamicCast(this.components[i], 416).string;
}
;
_.getClass$ = function getClass_1314(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_BufferedDocOpImpl_2_classLit;
}
;
_.getDeleteCharactersString = function getDeleteCharactersString_1(i){
  $check_3(this, i, ($clinit_1886() , DELETE_CHARACTERS));
  return dynamicCast(this.components[i], 417).string;
}
;
_.getDeleteElementStartAttributes = function getDeleteElementStartAttributes_1(i){
  $check_3(this, i, ($clinit_1886() , DELETE_ELEMENT_START));
  return dynamicCast(this.components[i], 421).attrs;
}
;
_.getDeleteElementStartTag = function getDeleteElementStartTag_1(i){
  $check_3(this, i, ($clinit_1886() , DELETE_ELEMENT_START));
  return dynamicCast(this.components[i], 421).type_0;
}
;
_.getElementStartAttributes = function getElementStartAttributes_0(i){
  $check_3(this, i, ($clinit_1886() , ELEMENT_START_0));
  return dynamicCast(this.components[i], 422).attrs;
}
;
_.getElementStartTag = function getElementStartTag_0(i){
  $check_3(this, i, ($clinit_1886() , ELEMENT_START_0));
  return dynamicCast(this.components[i], 422).type_0;
}
;
_.getReplaceAttributesNewAttributes = function getReplaceAttributesNewAttributes_1(i){
  $check_3(this, i, ($clinit_1886() , REPLACE_ATTRIBUTES));
  return dynamicCast(this.components[i], 418).newAttrs;
}
;
_.getReplaceAttributesOldAttributes = function getReplaceAttributesOldAttributes_1(i){
  $check_3(this, i, ($clinit_1886() , REPLACE_ATTRIBUTES));
  return dynamicCast(this.components[i], 418).oldAttrs;
}
;
_.getRetainItemCount = function getRetainItemCount_1(i){
  $check_3(this, i, ($clinit_1886() , RETAIN));
  return dynamicCast(this.components[i], 419).itemCount;
}
;
_.getType_0 = function getType_21(i){
  return this.components[i].getType_2();
}
;
_.getUpdateAttributesUpdate = function getUpdateAttributesUpdate_1(i){
  $check_3(this, i, ($clinit_1886() , UPDATE_ATTRIBUTES));
  return dynamicCast(this.components[i], 423).update;
}
;
_.size_1 = function size_38(){
  return this.components.length;
}
;
_.toString$ = function toString_109(){
  return 'Buffered@' + toPowerOfTwoString(this.$H || (this.$H = ++sNextHashId)) + '[' + toConciseString(($clinit_2104() , scrub_0(this))) + ']';
}
;
_.castableTypeMap$ = {207:1};
_.components = null;
_.knownToBeWellFormed = false;
function $clinit_2032(){
  $clinit_2032 = nullMethod;
  EMPTY_ARRAY_0 = initDim(_3Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DocInitializationComponent_2_classLit, {9:1, 68:1, 228:1}, 149, 0, 0);
}

function DocInitializationBuilder_0(){
  $clinit_2032();
  this.accu = new ArrayList_0;
}

function DocInitializationBuilder(){
}

_ = DocInitializationBuilder_0.prototype = DocInitializationBuilder.prototype = new Object_0;
_.getClass$ = function getClass_1315(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_DocInitializationBuilder_2_classLit;
}
;
_.castableTypeMap$ = {};
var EMPTY_ARRAY_0;
function $clinit_2033(){
  $clinit_2033 = nullMethod;
  EMPTY_ARRAY_1 = initDim(_3Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DocOpComponent_2_classLit, {9:1, 68:1, 228:1}, 150, 0, 0);
}

function UncheckedDocOpBuffer_0(){
  $clinit_2033();
  this.accu = new ArrayList_0;
}

function UncheckedDocOpBuffer(){
}

_ = UncheckedDocOpBuffer_0.prototype = UncheckedDocOpBuffer.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_13(map){
  $add_9(this.accu, new OperationComponents$AnnotationBoundary_0(map));
}
;
_.characters_0 = function characters_22(s){
  $add_9(this.accu, new OperationComponents$Characters_0(s));
}
;
_.deleteCharacters = function deleteCharacters_25(s){
  $add_9(this.accu, new OperationComponents$DeleteCharacters_0(s));
}
;
_.deleteElementEnd = function deleteElementEnd_23(){
  $add_9(this.accu, ($clinit_2051() , INSTANCE_15));
}
;
_.deleteElementStart = function deleteElementStart_23(type, attrs){
  $add_9(this.accu, new OperationComponents$DeleteElementStart_0(type, attrs));
}
;
_.elementEnd = function elementEnd_19(){
  $add_9(this.accu, ($clinit_2053() , INSTANCE_16));
}
;
_.elementStart = function elementStart_19(type, attrs){
  $add_9(this.accu, new OperationComponents$ElementStart_0(type, attrs));
}
;
_.finish_1 = function finish_12(){
  return new BufferedDocOpImpl_0(dynamicCast($toArray_1(this.accu, EMPTY_ARRAY_1), 228));
}
;
_.finish_0 = function finish_13(){
  return this.finish_1();
}
;
_.getClass$ = function getClass_1316(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_UncheckedDocOpBuffer_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_25(oldAttrs, newAttrs){
  $add_9(this.accu, new OperationComponents$ReplaceAttributes_0(oldAttrs, newAttrs));
}
;
_.retain = function retain_21(itemCount){
  $add_9(this.accu, new OperationComponents$Retain_0(itemCount));
}
;
_.updateAttributes = function updateAttributes_25(update){
  $add_9(this.accu, new OperationComponents$UpdateAttributes_0(update));
}
;
_.castableTypeMap$ = {};
var EMPTY_ARRAY_1;
function DocOpBuffer_0(){
  $clinit_2033();
  this.accu = new ArrayList_0;
}

function DocOpBuffer(){
}

_ = DocOpBuffer_0.prototype = DocOpBuffer.prototype = new UncheckedDocOpBuffer;
_.finish_1 = function finish_14(){
  var op;
  return op = new BufferedDocOpImpl_0(dynamicCast($toArray_1(this.accu, EMPTY_ARRAY_1), 228)) , checkWellformedness(op) , op;
}
;
_.getClass$ = function getClass_1317(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_DocOpBuffer_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_2035(){
  $clinit_2035 = nullMethod;
  EMPTY_ARRAY_2 = initDim(_3Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DocOpComponent_2_classLit, {9:1, 68:1, 228:1}, 150, 0, 0);
}

function $annotationBoundary_2(this$static, map){
  $add_9(this$static.accu, new OperationComponents$AnnotationBoundary_0(map));
  return this$static;
}

function $characters_3(this$static, s){
  $add_9(this$static.accu, new OperationComponents$Characters_0(s));
  return this$static;
}

function $elementStart_4(this$static, type, attrs){
  $add_9(this$static.accu, new OperationComponents$ElementStart_0(type, attrs));
  return this$static;
}

function DocOpBuilder_0(){
  $clinit_2035();
  this.accu = new ArrayList_0;
}

function DocOpBuilder(){
}

_ = DocOpBuilder_0.prototype = DocOpBuilder.prototype = new Object_0;
_.getClass$ = function getClass_1318(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_DocOpBuilder_2_classLit;
}
;
_.castableTypeMap$ = {};
var EMPTY_ARRAY_2;
function asInitialization(op){
  return op != null && op.castableTypeMap$ && !!op.castableTypeMap$[392]?dynamicCast(op, 392):new DocOpUtil$1_0(op);
}

function attributeString(attributes){
  var b, e, e$iterator, first;
  b = new StringBuilder_0;
  first = true;
  for (e$iterator = new ImmutableStateMap$1$1_0(attributes.entrySet); e$iterator.iterator.hasNext();) {
    e = dynamicCast(e$iterator.iterator.next_0(), 394);
    first?(first = false):(b.impl.string += ' ' , b);
    $append_11(b, e.name_0 + '=' + (e.value_0 == null?'null':'"' + $replaceAll(e.value_0, '"', '&quot;') + '"'));
  }
  return b.impl.string;
}

function buildXmlString(op, b){
  var $e0, e;
  try {
    op.val$op.apply_8(new InitializationCursorAdapter_0(new DocOpUtil$3_0(b)));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 21)) {
      e = $e0;
      throw new RuntimeException_2('toXmlString: DocInitialization was probably ill-formed', e);
    }
     else 
      throw $e0;
  }
}

function docInitializationFromXml(text){
  var anBuilder, ann, ann$iterator, builder, key, name_0, newValue, op, p, parseAnnotations, changes, ends, op_0;
  p = new StreamingXmlParser_0(text);
  builder = new DocOpBuilder_0;
  while ($hasMore(p.buffer) || p.atSelfClosingStart) {
    switch ($next_19(p).ordinal) {
      case 0:
        $elementStart_4(builder, $getTagName_5(p.current), fromStringMap($getAttributes_4(p.current)));
        continue;
      case 1:
        $add_9(builder.accu, ($clinit_2053() , INSTANCE_16));
        continue;
      case 2:
        $characters_3(builder, $getText(p.current));
        continue;
      case 3:
        name_0 = $getProcessingInstructionName(p.current);
        anBuilder = new AnnotationBoundaryMapBuilder_0;
        if ($equals_3('a', name_0)) {
          parseAnnotations = $parse_2(new AnnotationParser_0($getProcessingInstructionValue(p.current)));
          for (ann$iterator = new AbstractList$IteratorImpl_0(parseAnnotations); ann$iterator.i < ann$iterator.this$0_0.size_1();) {
            ann = dynamicCast($next_4(ann$iterator), 398);
            key = dynamicCast(ann.first, 1);
            newValue = dynamicCast(ann.second, 1);
            newValue == null?(anBuilder.changes.remove_8(key) , anBuilder.endKeys.add_3(key) , anBuilder):(anBuilder.endKeys.remove_8(key) , anBuilder.changes.put_3(key, new Pair_0(null, newValue)) , anBuilder);
          }
          $annotationBoundary_2(builder, (ends = initDim(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, anBuilder.endKeys.countEntries(), 0) , changes = initDim(_3Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$Triplet_2_classLit, {9:1, 68:1}, 144, anBuilder.changes.countEntries(), 0) , anBuilder.endKeys.each_3(new AnnotationBoundaryMapBuilder$2_0(ends)) , anBuilder.changes.each_2(new AnnotationBoundaryMapBuilder$3_0(changes)) , mergeSort(ends, 0, ends.length, ($clinit_497() , $clinit_497() , NATURAL)) , sort_0(changes, TRIPLET_COMPARATOR) , new AnnotationBoundaryMapBuilder$AnnotationBoundaryMapImpl_0(ends, changes)));
        }

        continue;
    }
  }
  op = (op_0 = new BufferedDocOpImpl_0(dynamicCast($toArray_1(builder.accu, ($clinit_2035() , EMPTY_ARRAY_2)), 228)) , checkWellformedness(op_0) , op_0);
  return new DocOpUtil$1_0(op);
}

function literalString(string){
  var regex, replacement;
  return string == null?'null':'"' + $replace_1((regex = $replaceAll('\\', '([/\\\\\\.\\*\\+\\?\\|\\(\\)\\[\\]\\{\\}$^])', '\\\\$1') , replacement = $replaceAll($replaceAll('\\\\', '\\\\', '\\\\\\\\'), '\\$', '\\\\$') , $replaceAll(string, regex, replacement)), '"', '\\"') + '"';
}

function toConciseString(op){
  var b;
  b = new StringBuilder_0;
  op.apply_8(new DocOpUtil$2_0(b));
  return b.impl.string;
}

function toConciseString_0(attributes){
  var b, entry, entry$iterator, first;
  if (attributes.size_1() == 0) {
    return '{}';
  }
  b = new StringBuilder_0;
  b.impl.string += '{ ';
  first = true;
  for (entry$iterator = new ImmutableStateMap$1$1_0(attributes.entrySet); entry$iterator.iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.iterator.next_0(), 394);
    first?(first = false):(b.impl.string += ', ' , b);
    $append_11(b, entry.name_0);
    b.impl.string += '=';
    $append_11(b, literalString(entry.value_0));
  }
  b.impl.string += ' }';
  return b.impl.string;
}

function toConciseString_1(update){
  var b, i;
  if (update.updates.size_1() == 0) {
    return '{}';
  }
  b = new StringBuilder_0;
  b.impl.string += '{ ';
  for (i = 0; i < update.updates.size_1(); ++i) {
    i > 0 && (b.impl.string += ', ' , b);
    $append_11(b, dynamicCast(update.updates.get_0(i), 384).name_0);
    b.impl.string += ': ';
    $append_11(b, literalString(dynamicCast(update.updates.get_0(i), 384).oldValue));
    b.impl.string += ' -> ';
    $append_11(b, literalString(dynamicCast(update.updates.get_0(i), 384).newValue));
  }
  b.impl.string += ' }';
  return b.impl.string;
}

function toConciseString_2(map){
  var b, i, notEmpty;
  b = new StringBuilder_0;
  b.impl.string += '{ ';
  notEmpty = false;
  for (i = 0; i < map.endSize(); ++i) {
    notEmpty?(b.impl.string += ', ' , b):(notEmpty = true);
    $append_11(b, literalString(map.getEndKey_0(i)));
  }
  for (i = 0; i < map.changeSize(); ++i) {
    notEmpty?(b.impl.string += ', ' , b):(notEmpty = true);
    $append_11(b, literalString(map.getChangeKey_0(i)));
    b.impl.string += ': ';
    $append_11(b, literalString(map.getOldValue(i)));
    b.impl.string += ' -> ';
    $append_11(b, literalString(map.getNewValue(i)));
  }
  b.impl.string += ' }';
  return notEmpty?b.impl.string:'{}';
}

function toPrettyXmlString(op){
  var b;
  b = new StringBuilder_0;
  buildXmlString(op, b);
  return b.impl.string;
}

function $getType_1(this$static, i){
  var t;
  t = this$static.val$op.getType_0(i);
  if (t != null && t.castableTypeMap$ && !!t.castableTypeMap$[424]) {
    return dynamicCast(t, 424);
  }
   else {
    throw new UnsupportedOperationException_1('Initialization with unexpected component ' + t + ': ' + this$static.val$op);
  }
}

function DocOpUtil$1_0(val$op){
  this.val$op = val$op;
}

function DocOpUtil$1(){
}

_ = DocOpUtil$1_0.prototype = DocOpUtil$1.prototype = new AbstractBufferedDocInitialization;
_.getAnnotationBoundary = function getAnnotationBoundary_1(i){
  return this.val$op.getAnnotationBoundary(i);
}
;
_.getCharactersString = function getCharactersString_1(i){
  return this.val$op.getCharactersString(i);
}
;
_.getClass$ = function getClass_1319(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_DocOpUtil$1_2_classLit;
}
;
_.getElementStartAttributes = function getElementStartAttributes_1(i){
  return this.val$op.getElementStartAttributes(i);
}
;
_.getElementStartTag = function getElementStartTag_1(i){
  return this.val$op.getElementStartTag(i);
}
;
_.getType_0 = function getType_22(i){
  return $getType_1(this, i);
}
;
_.size_1 = function size_39(){
  return this.val$op.size_1();
}
;
_.castableTypeMap$ = {207:1, 392:1};
_.val$op = null;
function DocOpUtil$2_0(val$b){
  this.val$b = val$b;
}

function DocOpUtil$2(){
}

_ = DocOpUtil$2_0.prototype = DocOpUtil$2.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_14(map){
  $append_11(this.val$b, '|| ' + toConciseString_2(map) + '; ');
}
;
_.characters_0 = function characters_23(chars){
  var regex, replacement;
  $append_11(this.val$b, '++' + (chars == null?'null':'"' + $replace_1((regex = $replaceAll('\\', '([/\\\\\\.\\*\\+\\?\\|\\(\\)\\[\\]\\{\\}$^])', '\\\\$1') , replacement = $replaceAll($replaceAll('\\\\', '\\\\', '\\\\\\\\'), '\\$', '\\\\$') , $replaceAll(chars, regex, replacement)), '"', '\\"') + '"') + '; ');
}
;
_.deleteCharacters = function deleteCharacters_26(chars){
  var regex, replacement;
  $append_11(this.val$b, '--' + (chars == null?'null':'"' + $replace_1((regex = $replaceAll('\\', '([/\\\\\\.\\*\\+\\?\\|\\(\\)\\[\\]\\{\\}$^])', '\\\\$1') , replacement = $replaceAll($replaceAll('\\\\', '\\\\', '\\\\\\\\'), '\\$', '\\\\$') , $replaceAll(chars, regex, replacement)), '"', '\\"') + '"') + '; ');
}
;
_.deleteElementEnd = function deleteElementEnd_24(){
  $append_11(this.val$b, 'x>; ');
}
;
_.deleteElementStart = function deleteElementStart_24(type, attrs){
  $append_11(this.val$b, 'x< ' + type + ' ' + toConciseString_0(attrs) + '; ');
}
;
_.elementEnd = function elementEnd_20(){
  $append_11(this.val$b, '>>; ');
}
;
_.elementStart = function elementStart_20(type, attrs){
  $append_11(this.val$b, '<< ' + type + ' ' + toConciseString_0(attrs) + '; ');
}
;
_.getClass$ = function getClass_1320(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_DocOpUtil$2_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_26(oldAttrs, newAttrs){
  $append_11(this.val$b, 'r@ ' + toConciseString_0(oldAttrs) + ' ' + toConciseString_0(newAttrs) + '; ');
}
;
_.retain = function retain_22(distance){
  $append_11(this.val$b, '__' + distance + '; ');
}
;
_.updateAttributes = function updateAttributes_26(attrUpdate){
  $append_11(this.val$b, 'u@ ' + toConciseString_1(attrUpdate) + '; ');
}
;
_.castableTypeMap$ = {};
_.val$b = null;
function $annotationBoundary_3(this$static, map){
  var entry, entry$iterator, i, key, value;
  $clear_10(this$static.changes);
  for (i = 0; i < map.changeSize(); ++i) {
    key = map.getChangeKey_0(i);
    value = map.getNewValue(i);
    if (!$equal(dynamicCast(this$static.currentAnnotations.get(key), 1), value)) {
      this$static.currentAnnotations.put(key, value);
      $put_3(this$static.changes, key, value);
    }
  }
  for (i = 0; i < map.endSize(); ++i) {
    key = map.getEndKey_0(i);
    if (this$static.currentAnnotations.get(key) != null) {
      this$static.currentAnnotations.remove_3(key);
      $put_3(this$static.changes, key, null);
    }
  }
  if (this$static.changes.size_0 == 0) {
    return;
  }
  if (this$static.elementPart != null) {
    $append_11(this$static.val$b, this$static.elementPart + '>');
    this$static.elementPart = null;
  }
  $append_11(this$static.val$b, '<?a');
  for (entry$iterator = new TreeMap$EntryIterator_0((new TreeMap$EntrySet_0(this$static.changes)).this$0); $hasNext_2(entry$iterator.iter);) {
    entry = entry$iterator.last = dynamicCast($next_4(entry$iterator.iter), 11);
    if (entry.getValue() != null) {
      $append_11(this$static.val$b, ' "' + $replaceAll($replaceAll($replaceAll($replace_1($replace_1($replace_1(dynamicCast(entry.getKey(), 1), '\\', '\\\\'), '"', '\\"'), '?', '\\q'), '&', '&amp;'), '<', '&lt;'), '>', '&gt;') + '"');
      $append_11(this$static.val$b, '=');
      $append_11(this$static.val$b, '"' + $replaceAll($replaceAll($replaceAll($replace_1($replace_1($replace_1(dynamicCast(entry.getValue(), 1), '\\', '\\\\'), '"', '\\"'), '?', '\\q'), '&', '&amp;'), '<', '&lt;'), '>', '&gt;') + '"');
    }
     else {
      $append_11(this$static.val$b, ' "' + $replaceAll($replaceAll($replaceAll($replace_1($replace_1($replace_1(dynamicCast(entry.getKey(), 1), '\\', '\\\\'), '"', '\\"'), '?', '\\q'), '&', '&amp;'), '<', '&lt;'), '>', '&gt;') + '"');
    }
  }
  $append_11(this$static.val$b, '?>');
}

function $characters_4(this$static, chars){
  if (this$static.elementPart != null) {
    $append_11(this$static.val$b, this$static.elementPart + '>');
    this$static.elementPart = null;
  }
  $append_11(this$static.val$b, $replaceAll($replaceAll($replaceAll(chars, '&', '&amp;'), '<', '&lt;'), '>', '&gt;'));
}

function $elementEnd_3(this$static){
  var tag;
  if (this$static.elementPart != null) {
    $append_11(this$static.val$b, this$static.elementPart + '/>');
    this$static.elementPart = null;
    $remove_12(this$static.tags, this$static.tags.size_0 - 1);
  }
   else {
    tag = dynamicCast($remove_12(this$static.tags, this$static.tags.size_0 - 1), 1);
    $append_11(this$static.val$b, '<\/' + tag + '>');
  }
}

function $elementStart_5(this$static, type, attrs){
  if (this$static.elementPart != null) {
    $append_11(this$static.val$b, this$static.elementPart + '>');
    this$static.elementPart = null;
  }
  this$static.elementPart = '<' + type + (attrs.size_1() == 0?'':' ' + attributeString(attrs));
  $add_9(this$static.tags, type);
}

function $equal(a_0, b){
  return a_0 == null?b == null:$equals_3(a_0, b);
}

function DocOpUtil$3_0(val$b){
  this.val$b = val$b;
  this.currentAnnotations = new HashMap_0;
  this.changes = new TreeMap_0;
  this.tags = new ArrayList_0;
}

function DocOpUtil$3(){
}

_ = DocOpUtil$3_0.prototype = DocOpUtil$3.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_15(map){
  $annotationBoundary_3(this, map);
}
;
_.characters_0 = function characters_24(chars){
  $characters_4(this, chars);
}
;
_.elementEnd = function elementEnd_21(){
  $elementEnd_3(this);
}
;
_.elementStart = function elementStart_21(type, attrs){
  $elementStart_5(this, type, attrs);
}
;
_.getClass$ = function getClass_1321(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_DocOpUtil$3_2_classLit;
}
;
_.castableTypeMap$ = {};
_.elementPart = null;
_.val$b = null;
function DocOpUtil$4_0(val$size){
  this.val$size = val$size;
}

function DocOpUtil$4(){
}

_ = DocOpUtil$4_0.prototype = DocOpUtil$4.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_16(map){
}
;
_.characters_0 = function characters_25(chars){
}
;
_.deleteCharacters = function deleteCharacters_27(chars){
  this.val$size[0] += chars.length;
}
;
_.deleteElementEnd = function deleteElementEnd_25(){
  ++this.val$size[0];
}
;
_.deleteElementStart = function deleteElementStart_25(type, attrs){
  ++this.val$size[0];
}
;
_.elementEnd = function elementEnd_22(){
}
;
_.elementStart = function elementStart_22(type, attrs){
}
;
_.getClass$ = function getClass_1322(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_DocOpUtil$4_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_27(oldAttrs, newAttrs){
  ++this.val$size[0];
}
;
_.retain = function retain_23(itemCount){
  this.val$size[0] += itemCount;
}
;
_.updateAttributes = function updateAttributes_27(attrUpdate){
  ++this.val$size[0];
}
;
_.castableTypeMap$ = {};
_.val$size = null;
function DocOpUtil$5_0(val$size){
  this.val$size = val$size;
}

function DocOpUtil$5(){
}

_ = DocOpUtil$5_0.prototype = DocOpUtil$5.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_17(map){
}
;
_.characters_0 = function characters_26(chars){
  this.val$size[0] += chars.length;
}
;
_.deleteCharacters = function deleteCharacters_28(chars){
}
;
_.deleteElementEnd = function deleteElementEnd_26(){
}
;
_.deleteElementStart = function deleteElementStart_26(type, attrs){
}
;
_.elementEnd = function elementEnd_23(){
  ++this.val$size[0];
}
;
_.elementStart = function elementStart_23(type, attrs){
  ++this.val$size[0];
}
;
_.getClass$ = function getClass_1323(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_DocOpUtil$5_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_28(oldAttrs, newAttrs){
  ++this.val$size[0];
}
;
_.retain = function retain_24(itemCount){
  this.val$size[0] += itemCount;
}
;
_.updateAttributes = function updateAttributes_28(attrUpdate){
  ++this.val$size[0];
}
;
_.castableTypeMap$ = {};
_.val$size = null;
function $clinit_2042(){
  $clinit_2042 = nullMethod;
  ILL_FORMED_0 = new DocOpValidator$IllFormed_0;
}

function isWellFormed(v, buffered){
  $clinit_2042();
  if (buffered.knownToBeWellFormed) {
    return true;
  }
   else {
    if (validate_1(v, ($clinit_2009() , NO_SCHEMA_CONSTRAINTS), ($clinit_1997() , EMPTY_DOCUMENT), buffered) == ($clinit_2006() , ILL_FORMED)) {
      return false;
    }
     else {
      buffered.knownToBeWellFormed = true;
      return true;
    }
  }
}

function validate_1(v, schema, doc, op){
  $clinit_2042();
  var $e0, a_0, accu;
  !schema && (schema = ($clinit_2009() , NO_SCHEMA_CONSTRAINTS));
  a_0 = new DocOpAutomaton_0(doc, schema);
  accu = initValues(_3Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$ValidationResult_2_classLit, {9:1, 68:1, 170:1}, 147, [($clinit_2006() , VALID)]);
  try {
    op.apply_8(new DocOpValidator$1_0(accu, a_0, v));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 425)) {
      return ILL_FORMED;
    }
     else 
      throw $e0;
  }
  accu[0] = $mergeWith(accu[0], $checkFinish_0(a_0, v));
  return accu[0];
}

var ILL_FORMED_0;
function $abortIfIllFormed(this$static){
  if (this$static.val$accu[0] == ($clinit_2006() , ILL_FORMED)) {
    throw $clinit_2042() , ILL_FORMED_0;
  }
}

function DocOpValidator$1_0(val$accu, val$a, val$v){
  this.val$accu = val$accu;
  this.val$a = val$a;
  this.val$v = val$v;
}

function DocOpValidator$1(){
}

_ = DocOpValidator$1_0.prototype = DocOpValidator$1.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_18(map){
  this.val$accu[0] = $mergeWith(this.val$accu[0], $checkAnnotationBoundary(this.val$a, map, this.val$v));
  $abortIfIllFormed(this);
  $doAnnotationBoundary(this.val$a, map);
}
;
_.characters_0 = function characters_27(s){
  this.val$accu[0] = $mergeWith(this.val$accu[0], $checkCharacters_0(this.val$a, s, this.val$v));
  $abortIfIllFormed(this);
  $doCharacters_1(this.val$a, s);
}
;
_.deleteCharacters = function deleteCharacters_29(chars){
  this.val$accu[0] = $mergeWith(this.val$accu[0], $checkDeleteCharacters_0(this.val$a, chars, this.val$v));
  $abortIfIllFormed(this);
  $doDeleteCharacters_2(this.val$a, chars);
}
;
_.deleteElementEnd = function deleteElementEnd_27(){
  this.val$accu[0] = $mergeWith(this.val$accu[0], $checkDeleteElementEnd_0(this.val$a, this.val$v));
  $abortIfIllFormed(this);
  $doDeleteElementEnd_1(this.val$a);
}
;
_.deleteElementStart = function deleteElementStart_27(type, attrs){
  this.val$accu[0] = $mergeWith(this.val$accu[0], $checkDeleteElementStart_0(this.val$a, type, attrs, this.val$v));
  $abortIfIllFormed(this);
  $doDeleteElementStart_1(this.val$a);
}
;
_.elementEnd = function elementEnd_24(){
  this.val$accu[0] = $mergeWith(this.val$accu[0], $checkElementEnd_0(this.val$a, this.val$v));
  $abortIfIllFormed(this);
  $doElementEnd_1(this.val$a);
}
;
_.elementStart = function elementStart_24(type, attrs){
  this.val$accu[0] = $mergeWith(this.val$accu[0], $checkElementStart_0(this.val$a, type, attrs, this.val$v));
  $abortIfIllFormed(this);
  $doElementStart_1(this.val$a, type);
}
;
_.getClass$ = function getClass_1324(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_DocOpValidator$1_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_29(oldAttrs, newAttrs){
  this.val$accu[0] = $mergeWith(this.val$accu[0], $checkReplaceAttributes(this.val$a, oldAttrs, newAttrs, this.val$v));
  $abortIfIllFormed(this);
  $doReplaceAttributes(this.val$a);
}
;
_.retain = function retain_25(itemCount){
  this.val$accu[0] = $mergeWith(this.val$accu[0], $checkRetain_0(this.val$a, itemCount, this.val$v));
  $abortIfIllFormed(this);
  $doRetain(this.val$a, itemCount);
}
;
_.updateAttributes = function updateAttributes_29(u){
  this.val$accu[0] = $mergeWith(this.val$accu[0], $checkUpdateAttributes(this.val$a, u, this.val$v));
  $abortIfIllFormed(this);
  $doUpdateAttributes_0(this.val$a);
}
;
_.castableTypeMap$ = {};
_.val$a = null;
_.val$accu = null;
_.val$v = null;
function DocOpValidator$IllFormed_0(){
  this.fillInStackTrace();
  this.detailMessage = 'Preallocated exception with a meaningless stack trace';
}

function DocOpValidator$IllFormed(){
}

_ = DocOpValidator$IllFormed_0.prototype = DocOpValidator$IllFormed.prototype = new RuntimeException;
_.fillInStackTrace = function fillInStackTrace_1(){
  return this;
}
;
_.getClass$ = function getClass_1325(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_DocOpValidator$IllFormed_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 21:1, 39:1, 183:1, 425:1};
function InitializationCursorAdapter_0(inner){
  this.inner = inner;
}

function InitializationCursorAdapter(){
}

_ = InitializationCursorAdapter_0.prototype = InitializationCursorAdapter.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_19(map){
  $annotationBoundary_3(this.inner, map);
}
;
_.characters_0 = function characters_28(chars){
  $characters_4(this.inner, chars);
}
;
_.deleteCharacters = function deleteCharacters_30(chars){
  throw new UnsupportedOperationException_1('deleteCharacters');
}
;
_.deleteElementEnd = function deleteElementEnd_28(){
  throw new UnsupportedOperationException_1('deleteElementEnd');
}
;
_.deleteElementStart = function deleteElementStart_28(type, attrs){
  throw new UnsupportedOperationException_1('deleteElementStart');
}
;
_.elementEnd = function elementEnd_25(){
  $elementEnd_3(this.inner);
}
;
_.elementStart = function elementStart_25(type, attrs){
  $elementStart_5(this.inner, type, attrs);
}
;
_.getClass$ = function getClass_1326(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_InitializationCursorAdapter_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_30(oldAttrs, newAttrs){
  throw new UnsupportedOperationException_1('replaceAttributes');
}
;
_.retain = function retain_26(itemCount){
  throw new UnsupportedOperationException_1('retain');
}
;
_.updateAttributes = function updateAttributes_30(attrUpdate){
  throw new UnsupportedOperationException_1('updateAttributes');
}
;
_.castableTypeMap$ = {};
_.inner = null;
function OperationComponents$DocOpComponent(){
}

_ = OperationComponents$DocOpComponent.prototype = new Object_0;
_.getClass$ = function getClass_1327(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DocOpComponent_2_classLit;
}
;
_.castableTypeMap$ = {150:1};
function OperationComponents$DocInitializationComponent(){
}

_ = OperationComponents$DocInitializationComponent.prototype = new OperationComponents$DocOpComponent;
_.apply_8 = function apply_118(c){
  this.apply_14(c);
}
;
_.getClass$ = function getClass_1328(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DocInitializationComponent_2_classLit;
}
;
_.getType_2 = function getType_23(){
  return this.getType_3();
}
;
_.castableTypeMap$ = {149:1, 150:1};
function OperationComponents$AnnotationBoundary_0(boundary){
  this.boundary = boundary;
}

function OperationComponents$AnnotationBoundary(){
}

_ = OperationComponents$AnnotationBoundary_0.prototype = OperationComponents$AnnotationBoundary.prototype = new OperationComponents$DocInitializationComponent;
_.apply_14 = function apply_119(c){
  c.annotationBoundary(this.boundary);
}
;
_.getClass$ = function getClass_1329(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$AnnotationBoundary_2_classLit;
}
;
_.getType_3 = function getType_24(){
  return $clinit_1886() , ANNOTATION_BOUNDARY;
}
;
_.castableTypeMap$ = {149:1, 150:1, 420:1};
_.boundary = null;
function OperationComponents$Characters_0(string){
  this.string = string;
}

function OperationComponents$Characters(){
}

_ = OperationComponents$Characters_0.prototype = OperationComponents$Characters.prototype = new OperationComponents$DocInitializationComponent;
_.apply_14 = function apply_120(c){
  c.characters_0(this.string);
}
;
_.getClass$ = function getClass_1330(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$Characters_2_classLit;
}
;
_.getType_3 = function getType_25(){
  return $clinit_1886() , CHARACTERS;
}
;
_.castableTypeMap$ = {149:1, 150:1, 416:1};
_.string = null;
function OperationComponents$DeleteCharacters_0(string){
  this.string = string;
}

function OperationComponents$DeleteCharacters(){
}

_ = OperationComponents$DeleteCharacters_0.prototype = OperationComponents$DeleteCharacters.prototype = new OperationComponents$DocOpComponent;
_.apply_8 = function apply_121(c){
  c.deleteCharacters(this.string);
}
;
_.getClass$ = function getClass_1331(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DeleteCharacters_2_classLit;
}
;
_.getType_2 = function getType_26(){
  return $clinit_1886() , DELETE_CHARACTERS;
}
;
_.castableTypeMap$ = {150:1, 417:1};
_.string = null;
function $clinit_2051(){
  $clinit_2051 = nullMethod;
  INSTANCE_15 = new OperationComponents$DeleteElementEnd_0;
}

function OperationComponents$DeleteElementEnd_0(){
}

function OperationComponents$DeleteElementEnd(){
}

_ = OperationComponents$DeleteElementEnd_0.prototype = OperationComponents$DeleteElementEnd.prototype = new OperationComponents$DocOpComponent;
_.apply_8 = function apply_122(c){
  c.deleteElementEnd();
}
;
_.getClass$ = function getClass_1332(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DeleteElementEnd_2_classLit;
}
;
_.getType_2 = function getType_27(){
  return $clinit_1886() , DELETE_ELEMENT_END;
}
;
_.castableTypeMap$ = {150:1};
var INSTANCE_15;
function OperationComponents$DeleteElementStart_0(type, attrs){
  this.type_0 = type;
  this.attrs = attrs;
}

function OperationComponents$DeleteElementStart(){
}

_ = OperationComponents$DeleteElementStart_0.prototype = OperationComponents$DeleteElementStart.prototype = new OperationComponents$DocOpComponent;
_.apply_8 = function apply_123(c){
  c.deleteElementStart(this.type_0, this.attrs);
}
;
_.getClass$ = function getClass_1333(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DeleteElementStart_2_classLit;
}
;
_.getType_2 = function getType_28(){
  return $clinit_1886() , DELETE_ELEMENT_START;
}
;
_.castableTypeMap$ = {150:1, 421:1};
_.attrs = null;
_.type_0 = null;
function $clinit_2053(){
  $clinit_2053 = nullMethod;
  INSTANCE_16 = new OperationComponents$ElementEnd_0;
}

function OperationComponents$ElementEnd_0(){
}

function OperationComponents$ElementEnd(){
}

_ = OperationComponents$ElementEnd_0.prototype = OperationComponents$ElementEnd.prototype = new OperationComponents$DocInitializationComponent;
_.apply_14 = function apply_124(c){
  c.elementEnd();
}
;
_.getClass$ = function getClass_1334(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$ElementEnd_2_classLit;
}
;
_.getType_3 = function getType_29(){
  return $clinit_1886() , ELEMENT_END_0;
}
;
_.castableTypeMap$ = {149:1, 150:1};
var INSTANCE_16;
function OperationComponents$ElementStart_0(type, attrs){
  this.type_0 = type;
  this.attrs = attrs;
}

function OperationComponents$ElementStart(){
}

_ = OperationComponents$ElementStart_0.prototype = OperationComponents$ElementStart.prototype = new OperationComponents$DocInitializationComponent;
_.apply_14 = function apply_125(c){
  c.elementStart(this.type_0, this.attrs);
}
;
_.getClass$ = function getClass_1335(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$ElementStart_2_classLit;
}
;
_.getType_3 = function getType_30(){
  return $clinit_1886() , ELEMENT_START_0;
}
;
_.castableTypeMap$ = {149:1, 150:1, 422:1};
_.attrs = null;
_.type_0 = null;
function OperationComponents$ReplaceAttributes_0(oldAttrs, newAttrs){
  this.oldAttrs = oldAttrs;
  this.newAttrs = newAttrs;
}

function OperationComponents$ReplaceAttributes(){
}

_ = OperationComponents$ReplaceAttributes_0.prototype = OperationComponents$ReplaceAttributes.prototype = new OperationComponents$DocOpComponent;
_.apply_8 = function apply_126(c){
  c.replaceAttributes(this.oldAttrs, this.newAttrs);
}
;
_.getClass$ = function getClass_1336(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$ReplaceAttributes_2_classLit;
}
;
_.getType_2 = function getType_31(){
  return $clinit_1886() , REPLACE_ATTRIBUTES;
}
;
_.castableTypeMap$ = {150:1, 418:1};
_.newAttrs = null;
_.oldAttrs = null;
function OperationComponents$Retain_0(itemCount){
  this.itemCount = itemCount;
}

function OperationComponents$Retain(){
}

_ = OperationComponents$Retain_0.prototype = OperationComponents$Retain.prototype = new OperationComponents$DocOpComponent;
_.apply_8 = function apply_127(c){
  c.retain(this.itemCount);
}
;
_.getClass$ = function getClass_1337(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$Retain_2_classLit;
}
;
_.getType_2 = function getType_32(){
  return $clinit_1886() , RETAIN;
}
;
_.castableTypeMap$ = {150:1, 419:1};
_.itemCount = 0;
function OperationComponents$UpdateAttributes_0(update){
  this.update = update;
}

function OperationComponents$UpdateAttributes(){
}

_ = OperationComponents$UpdateAttributes_0.prototype = OperationComponents$UpdateAttributes.prototype = new OperationComponents$DocOpComponent;
_.apply_8 = function apply_128(c){
  c.updateAttributes(this.update);
}
;
_.getClass$ = function getClass_1338(){
  return Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$UpdateAttributes_2_classLit;
}
;
_.getType_2 = function getType_33(){
  return $clinit_1886() , UPDATE_ATTRIBUTES;
}
;
_.castableTypeMap$ = {150:1, 423:1};
_.update = null;
function ImmutableStateMap$1_0(this$0){
  this.this$0 = this$0;
}

function ImmutableStateMap$1(){
}

_ = ImmutableStateMap$1_0.prototype = ImmutableStateMap$1.prototype = new AbstractSet;
_.getClass$ = function getClass_1339(){
  return Lorg_waveprotocol_wave_model_document_operation_util_ImmutableStateMap$1_2_classLit;
}
;
_.iterator_0 = function iterator_27(){
  return new ImmutableStateMap$1$1_0(this);
}
;
_.size_1 = function size_40(){
  return this.this$0.attributes.size_1();
}
;
_.castableTypeMap$ = {168:1, 363:1};
_.this$0 = null;
function ImmutableStateMap$1$1_0(this$1){
  this.this$1 = this$1;
  this.iterator = this.this$1.this$0.attributes.iterator_0();
}

function ImmutableStateMap$1$1(){
}

_ = ImmutableStateMap$1$1_0.prototype = ImmutableStateMap$1$1.prototype = new Object_0;
_.getClass$ = function getClass_1340(){
  return Lorg_waveprotocol_wave_model_document_operation_util_ImmutableStateMap$1$1_2_classLit;
}
;
_.hasNext = function hasNext_19(){
  return this.iterator.hasNext();
}
;
_.next_0 = function next_27(){
  return dynamicCast(this.iterator.next_0(), 394);
}
;
_.remove_1 = function remove_56(){
  throw new UnsupportedOperationException_1('Attempt to modify an immutable set.');
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
function ImmutableStateMap$2_0(){
}

function ImmutableStateMap$2(){
}

_ = ImmutableStateMap$2_0.prototype = ImmutableStateMap$2.prototype = new Object_0;
_.compare = function compare_7(a_0, b){
  return compareTo_5(dynamicCast(a_0, 394).name_0, dynamicCast(b, 394).name_0);
}
;
_.getClass$ = function getClass_1341(){
  return Lorg_waveprotocol_wave_model_document_operation_util_ImmutableStateMap$2_2_classLit;
}
;
_.castableTypeMap$ = {};
function $setValue_5(){
  throw new UnsupportedOperationException_1('Attempt to modify an immutable map entry.');
}

function ImmutableStateMap$Attribute_0(entry){
  ImmutableStateMap$Attribute_1.call(this, dynamicCast(entry.getKey(), 1), dynamicCast(entry.getValue(), 1));
}

function ImmutableStateMap$Attribute_1(name_0, value){
  checkNotNull_1(name_0, 'Null attribute name');
  checkNotNull_1(value, 'Null attribute value');
  this.name_0 = name_0;
  this.value_0 = value;
}

function ImmutableStateMap$Attribute(){
}

_ = ImmutableStateMap$Attribute_1.prototype = ImmutableStateMap$Attribute_0.prototype = ImmutableStateMap$Attribute.prototype = new Object_0;
_.equals$ = function equals_54(o){
  var entry;
  if (!(o != null && o.castableTypeMap$ && !!o.castableTypeMap$[11])) {
    return false;
  }
  entry = dynamicCast(o, 11);
  return (this.name_0 == null?entry.getKey() == null:$equals_3(this.name_0, entry.getKey())) && (this.value_0 == null?entry.getValue() == null:$equals_3(this.value_0, entry.getValue()));
}
;
_.getClass$ = function getClass_1342(){
  return Lorg_waveprotocol_wave_model_document_operation_util_ImmutableStateMap$Attribute_2_classLit;
}
;
_.getKey = function getKey_5(){
  return this.name_0;
}
;
_.getValue = function getValue_5(){
  return this.value_0;
}
;
_.hashCode$ = function hashCode_53(){
  return (this.name_0 == null?0:getHashCode_0(this.name_0)) ^ (this.value_0 == null?0:getHashCode_0(this.value_0));
}
;
_.setValue = function setValue_5(value){
  return $setValue_5(dynamicCast(value, 1));
}
;
_.toString$ = function toString_110(){
  return 'Attribute(' + this.name_0 + '=' + this.value_0 + ')';
}
;
_.castableTypeMap$ = {11:1, 394:1};
_.name_0 = null;
_.value_0 = null;
function $compare_9(a_0, b){
  return compareTo_5(dynamicCast(a_0, 384).name_0, dynamicCast(b, 384).name_0);
}

function ImmutableUpdateMap$1_0(){
}

function ImmutableUpdateMap$1(){
}

_ = ImmutableUpdateMap$1_0.prototype = ImmutableUpdateMap$1.prototype = new Object_0;
_.compare = function compare_8(a_0, b){
  return compareTo_5(dynamicCast(a_0, 384).name_0, dynamicCast(b, 384).name_0);
}
;
_.getClass$ = function getClass_1343(){
  return Lorg_waveprotocol_wave_model_document_operation_util_ImmutableUpdateMap$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function ImmutableUpdateMap$AttributeUpdate_0(name_0, oldValue, newValue){
  checkNotNull_1(name_0, 'Null name in AttributeUpdate');
  this.name_0 = name_0;
  this.oldValue = oldValue;
  this.newValue = newValue;
}

function ImmutableUpdateMap$AttributeUpdate(){
}

_ = ImmutableUpdateMap$AttributeUpdate_0.prototype = ImmutableUpdateMap$AttributeUpdate.prototype = new Object_0;
_.getClass$ = function getClass_1344(){
  return Lorg_waveprotocol_wave_model_document_operation_util_ImmutableUpdateMap$AttributeUpdate_2_classLit;
}
;
_.toString$ = function toString_111(){
  return '[' + this.name_0 + ': ' + this.oldValue + ' -> ' + this.newValue + ']';
}
;
_.castableTypeMap$ = {384:1};
_.name_0 = null;
_.newValue = null;
_.oldValue = null;
function $ensure(condition, messages){
  var concatenated, i, toStr;
  if (!condition) {
    toStr = initDim(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, messages.length, 0);
    for (i = 0; i < messages.length; ++i) {
      toStr[i] = '' + messages[i];
    }
    concatenated = join_1(toStr);
    throw new XmlParseException_2(concatenated);
  }
}

function $parse_2(this$static){
  var annotations, name_0, value;
  annotations = new ArrayList_0;
  while (this$static.offset < this$static.input.length) {
    name_0 = this$static.input.charCodeAt(this$static.offset) == 34?$quotedValue(this$static, 34):$quotedValue(this$static, 39);
    $ensure(name_0.indexOf('?') == -1, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Invalid char ?: ', this$static.input]));
    $ensure(name_0.indexOf('@') == -1, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Invalid char @: ', this$static.input]));
    if (this$static.offset < this$static.input.length && this$static.input.charCodeAt(this$static.offset) == 61) {
      ++this$static.offset;
      value = this$static.input.charCodeAt(this$static.offset) == 34?$quotedValue(this$static, 34):$quotedValue(this$static, 39);
      $add_9(annotations, new Pair_0(name_0, value));
    }
     else {
      $add_9(annotations, new Pair_0(name_0, null));
    }
    while (this$static.offset < this$static.input.length && this$static.input.charCodeAt(this$static.offset) == 32) {
      ++this$static.offset;
    }
  }
  return annotations;
}

function $quotedValue(this$static, quoteChar){
  var nextQuote, start, value;
  $ensure(this$static.input.charCodeAt(this$static.offset) == quoteChar, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['expected ', valueOf_12(quoteChar), ' at position ', valueOf_13(this$static.offset), ' in ', this$static.input]));
  ++this$static.offset;
  start = this$static.offset;
  while (true) {
    nextQuote = $indexOf_0(this$static.input, quoteChar, this$static.offset);
    $ensure(nextQuote != -1, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['closing ', valueOf_12(quoteChar), ' not found']));
    this$static.offset = nextQuote;
    if (this$static.input.charCodeAt(nextQuote - 1) != 92) {
      break;
    }
    ++this$static.offset;
  }
  value = $substring_0(this$static.input, start, this$static.offset);
  ++this$static.offset;
  return $replace_1($replace_1($replace_1($replaceAll($replaceAll($replaceAll(value, '&gt;', '>'), '&lt;', '<'), '&amp;', '&'), '\\q', '?'), '\\"', '"'), '\\\\', '\\');
}

function AnnotationParser_0(input){
  this.input = input;
  $ensure(($clinit_2376() , traverseUtf16String(input, VALID_UTF16).value_0), initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Input is not valid UTF-16: ', input]));
}

function AnnotationParser(){
}

_ = AnnotationParser_0.prototype = AnnotationParser.prototype = new Object_0;
_.getClass$ = function getClass_1345(){
  return Lorg_waveprotocol_wave_model_document_parser_AnnotationParser_2_classLit;
}
;
_.castableTypeMap$ = {};
_.input = null;
_.offset = 0;
function $getAttributes_4(this$static){
  checkState_2(this$static.type_0 == ($clinit_2068() , START_ELEMENT), 'Cursor not at element start');
  if (!this$static.attrs) {
    return $clinit_2309() , $clinit_2309() , EMPTY_MAP_2;
  }
  return this$static.attrs;
}

function $getProcessingInstructionName(this$static){
  checkState_2(this$static.type_0 == ($clinit_2068() , PROCESSING_INSTRUCTION), 'Cursor not at processing instruction');
  return this$static.name_0;
}

function $getProcessingInstructionValue(this$static){
  checkState_2(this$static.type_0 == ($clinit_2068() , PROCESSING_INSTRUCTION), 'Cursor not at processing instruction');
  return this$static.data_0;
}

function $getTagName_5(this$static){
  checkState_2(this$static.type_0 == ($clinit_2068() , START_ELEMENT) || this$static.type_0 == END_ELEMENT, 'Cursor not at element');
  return this$static.name_0;
}

function $getText(this$static){
  checkState_2(this$static.type_0 == ($clinit_2068() , TEXT_0), 'Cursor not at text');
  return this$static.data_0;
}

function $startElementToEndElement(this$static){
  checkState_2(this$static.type_0 == ($clinit_2068() , START_ELEMENT), 'Can only convert start elements to end elements');
  return new Item_0(END_ELEMENT, this$static.name_0, null, null);
}

function Item_0(type, name_0, attrs, data){
  var copy;
  this.type_0 = type;
  this.name_0 = name_0;
  this.attrs = !attrs || attrs.isEmpty()?null:($clinit_2309() , copy = defaultCollectionFactory.createStringMap() , copy.putAll_0(attrs) , copy);
  this.data_0 = data;
}

function Item(){
}

_ = Item_0.prototype = Item.prototype = new Object_0;
_.getClass$ = function getClass_1346(){
  return Lorg_waveprotocol_wave_model_document_parser_Item_2_classLit;
}
;
_.castableTypeMap$ = {};
_.attrs = null;
_.data_0 = null;
_.name_0 = null;
_.type_0 = null;
function $clinit_2068(){
  $clinit_2068 = nullMethod;
  START_ELEMENT = new ItemType_0('START_ELEMENT', 0);
  END_ELEMENT = new ItemType_0('END_ELEMENT', 1);
  TEXT_0 = new ItemType_0('TEXT', 2);
  PROCESSING_INSTRUCTION = new ItemType_0('PROCESSING_INSTRUCTION', 3);
  $VALUES_69 = initValues(_3Lorg_waveprotocol_wave_model_document_parser_ItemType_2_classLit, {9:1, 68:1, 170:1}, 151, [START_ELEMENT, END_ELEMENT, TEXT_0, PROCESSING_INSTRUCTION]);
}

function ItemType_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_76(name_0){
  $clinit_2068();
  return valueOf_0(($clinit_2069() , $MAP_69), name_0);
}

function values_70(){
  $clinit_2068();
  return $VALUES_69;
}

function ItemType(){
}

_ = ItemType_0.prototype = ItemType.prototype = new Enum;
_.getClass$ = function getClass_1347(){
  return Lorg_waveprotocol_wave_model_document_parser_ItemType_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 151:1};
var $VALUES_69, END_ELEMENT, PROCESSING_INSTRUCTION, START_ELEMENT, TEXT_0;
function $clinit_2069(){
  $clinit_2069 = nullMethod;
  $MAP_69 = createValueOfMap(($clinit_2068() , $VALUES_69));
}

var $MAP_69;
function $clinit_2070(){
  $clinit_2070 = nullMethod;
  var tmp;
  tmp = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  tmp.put_3('lt', '<');
  tmp.put_3('gt', '>');
  tmp.put_3('apos', "'");
  tmp.put_3('quot', '"');
  tmp.put_3('amp', '&');
  entities = tmp;
  BASE_16_DIGITS = newStringSet(initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f', 'A', 'B', 'C', 'D', 'E', 'F']));
  BASE_10_DIGITS = newStringSet(initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9']));
}

function $attr(this$static){
  var attrName, attrValue;
  attrName = $name(this$static);
  if (attrName == null) {
    return null;
  }
  $ensure_0(this$static, $match_0(this$static, 61), initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Matching =']));
  attrValue = $attrValue(this$static);
  $ensure_0(this$static, attrValue != null, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Matching attr value']));
  return new Pair_0(attrName, attrValue);
}

function $attrList(this$static){
  var attr, ret;
  ret = null;
  $whitespace(this$static);
  while ($hasMore(this$static.buffer)) {
    attr = $attr(this$static);
    if (!attr) {
      break;
    }
     else {
      ret = ret?ret:($clinit_2309() , defaultCollectionFactory.createStringMap());
      ret.put_3(dynamicCast(attr.first, 1), dynamicCast(attr.second, 1));
    }
    $whitespace(this$static);
  }
  return ret;
}

function $attrValue(this$static){
  if ($match_0(this$static, 34)) {
    return $attrValueInner(this$static, 34);
  }
   else if ($match_0(this$static, 39)) {
    return $attrValueInner(this$static, 39);
  }
   else {
    throw new XmlParseException_2('Cannot match opening quote ' + this$static.buffer.position_0);
  }
}

function $attrValueInner(this$static, quote){
  var end, except, reference, ret, start, val;
  except = initValues(_3C_classLit, {9:1}, -1, [60, 38, quote]);
  ret = new StringBuilder_0;
  while (true) {
    start = this$static.buffer.position_0;
    while (!$contains_9(except, $peek_2(this$static.buffer))) {
      $advanceCodePoint(this$static.buffer);
    }
    end = this$static.buffer.position_0;
    if (start != end) {
      $append_11(ret, $substring_0(this$static.buffer.str, start, end));
      continue;
    }
    reference = $reference(this$static);
    if (reference != null) {
      ret.impl.string += reference;
      continue;
    }
    $ensure_0(this$static, $match_0(this$static, quote), initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['matching closing quote']));
    val = ret.impl.string;
    $ensure_0(this$static, ($clinit_2376() , traverseUtf16String(val, VALID_UTF16).value_0), initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Not valid UTF-16: ' + val]));
    return val;
  }
}

function $charData(this$static){
  var end, except, start;
  except = initValues(_3C_classLit, {9:1}, -1, [60, 38]);
  start = this$static.buffer.position_0;
  while ($hasMore(this$static.buffer)) {
    if ($contains_9(except, $peek_2(this$static.buffer))) {
      break;
    }
     else {
      $advanceCodePoint(this$static.buffer);
    }
  }
  end = this$static.buffer.position_0;
  return start == end?null:$substring_0(this$static.buffer.str, start, end);
}

function $charReference(this$static){
  var $e0, base, codePoint, e, end, number, ret, start, validDigits;
  if ($match(this$static, '&#')) {
    if ($match_0(this$static, 120)) {
      base = 16;
      validDigits = BASE_16_DIGITS;
    }
     else {
      base = 10;
      validDigits = BASE_10_DIGITS;
    }
    start = this$static.buffer.position_0;
    while (validDigits.contains_0('' + String.fromCharCode($peek_2(this$static.buffer) & 65535))) {
      this$static.buffer.position_0 += 1;
    }
    end = this$static.buffer.position_0;
    $ensure_0(this$static, start != end, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['empty char reference']));
    number = $substring_0(this$static.buffer.str, start, end);
    try {
      codePoint = __parseAndValidateInt(number, base);
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 188)) {
        e = $e0;
        throw new XmlParseException_1('Could not parse number: ' + number, e);
      }
       else 
        throw $e0;
    }
    $ensure_0(this$static, ($clinit_2376() , 0 <= codePoint && codePoint <= 1114111), initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Not a codepoint: ' + (base == 16?'0x':'') + number]));
    ret = String.fromCharCode.apply(null, toChars(codePoint));
    $ensure_0(this$static, $match_0(this$static, 59), initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Must match ; at end of charReference']));
    return ret;
  }
  return null;
}

function $contains_9(except, c){
  var i, i$index, i$max;
  for (i$index = 0 , i$max = except.length; i$index < i$max; ++i$index) {
    i = except[i$index];
    if (i == c) {
      return true;
    }
  }
  return false;
}

function $ensure_0(this$static, condition, messages){
  var builder, m_0, m$index, m$max;
  if (!condition) {
    builder = new StringBuilder_0;
    builder.impl.string += 'message: ';
    for (m$index = 0 , m$max = messages.length; m$index < m$max; ++m$index) {
      m_0 = messages[m$index];
      $append_11(builder, dynamicCast(m_0, 1));
    }
    builder.impl.string += ', at position: ';
    $append_9(builder, this$static.buffer.position_0);
    throw new XmlParseException_2(builder.impl.string);
  }
}

function $entityReference(this$static){
  var entityAsString, entityName;
  if ($match_0(this$static, 38)) {
    entityName = $name(this$static);
    $ensure_0(this$static, entityName != null, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['parsing entity name']));
    $ensure_0(this$static, $match_0(this$static, 59), initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['matching ; on entity']));
    entityAsString = dynamicCast(entities.get_4(entityName), 1);
    if (entityAsString != null) {
      return entityAsString;
    }
     else {
      throw new XmlParseException_2('entity name not recognised: ' + entityName);
    }
  }
   else {
    return null;
  }
}

function $getTextChunk(this$static){
  var b, c, r, val;
  b = new StringBuffer_0;
  while (true) {
    c = $charData(this$static);
    if (c != null) {
      b.impl.string += c;
      continue;
    }
    r = $reference(this$static);
    if (r != null) {
      b.impl.string += r;
      continue;
    }
    if (b.impl.string.length > 0) {
      val = b.impl.string;
      $ensure_0(this$static, ($clinit_2376() , traverseUtf16String(val, VALID_UTF16).value_0), initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Not valid UTF-16: ' + val]));
      return new Item_0(($clinit_2068() , TEXT_0), null, null, val);
    }
     else {
      return null;
    }
  }
}

function $isWhiteSpaceChar(c){
  return 32 == c || 9 == c || 10 == c || 13 == c;
}

function $isXmlNameChar(codePoint){
  var $e0, e;
  try {
    return isXmlNameChar_0(codePoint);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 21)) {
      e = $e0;
      throw new XmlParseException_0(e);
    }
     else 
      throw $e0;
  }
}

function $isXmlNameStartChar(codePoint){
  var $e0, e;
  try {
    return $clinit_2376() , codePoint == 58 || 65 <= codePoint && codePoint <= 90 || codePoint == 95 | (97 <= codePoint && codePoint <= 122) || 192 <= codePoint && codePoint <= 214 || 216 <= codePoint && codePoint <= 246 || 248 <= codePoint && codePoint <= 767 || 880 <= codePoint && codePoint <= 893 || 895 <= codePoint && codePoint <= 8191 || 8204 <= codePoint && codePoint <= 8205 || 8304 <= codePoint && codePoint <= 8591 || 11264 <= codePoint && codePoint <= 12271 || 12289 <= codePoint && codePoint <= 55295 || 63744 <= codePoint && codePoint <= 64975 || 65008 <= codePoint && codePoint <= 65533 || 65536 <= codePoint && codePoint <= 983039 && isCodePointValid(codePoint);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 21)) {
      e = $e0;
      throw new XmlParseException_0(e);
    }
     else 
      throw $e0;
  }
}

function $match(this$static, t){
  if ($startsWith(this$static.buffer, t)) {
    this$static.buffer.position_0 += t.length;
    return true;
  }
   else {
    return false;
  }
}

function $match_0(this$static, t){
  var $e0, e;
  if (!$hasMore(this$static.buffer)) {
    return false;
  }
  try {
    if ($peek_2(this$static.buffer) == t) {
      this$static.buffer.position_0 += 1;
      return true;
    }
     else {
      return false;
    }
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 380)) {
      e = $e0;
      throw new RuntimeException_2('Impossible, as buffer has more: ', e);
    }
     else 
      throw $e0;
  }
}

function $name(this$static){
  var end, start;
  start = this$static.buffer.position_0;
  if (!$isXmlNameStartChar($peek_2(this$static.buffer))) {
    return null;
  }
  this$static.buffer.position_0 += 1;
  while ($isXmlNameChar($peek_2(this$static.buffer))) {
    this$static.buffer.position_0 += 1;
  }
  end = this$static.buffer.position_0;
  return $substring_0(this$static.buffer.str, start, end);
}

function $next_19(this$static){
  var closingName, matchingStart;
  if (!($hasMore(this$static.buffer) || this$static.atSelfClosingStart)) {
    throw new NoSuchElementException_0;
  }
  if (this$static.atSelfClosingStart) {
    this$static.atSelfClosingStart = false;
    this$static.current = $startElementToEndElement(this$static.current);
  }
   else {
    $hasMore(this$static.buffer)?(this$static.current = $startsWith(this$static.buffer, '<?')?$processingInstruction(this$static):$startsWith(this$static.buffer, '<\/')?($ensure_0(this$static, $match(this$static, '<\/'), initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Matching <\/'])) , closingName = $name(this$static) , $ensure_0(this$static, closingName != null, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Matching name'])) , $whitespace(this$static) , $ensure_0(this$static, $match_0(this$static, 62), initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Matching >'])) , $ensure_0(this$static, this$static.elementTagStack.arrayList.size_0 != 0, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['no matching start tag'])) , matchingStart = dynamicCast($pop(this$static.elementTagStack), 1) , $ensure_0(this$static, $equals_3(matchingStart, closingName), initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['start and end tag mismatch, start: ' + matchingStart + ' end: ' + closingName])) , new Item_0(($clinit_2068() , END_ELEMENT), closingName, null, null)):$peek_2(this$static.buffer) == 60?$startTag(this$static):$getTextChunk(this$static)):(this$static.current = null);
  }
  $hasMore(this$static.buffer) || this$static.atSelfClosingStart || $ensure_0(this$static, this$static.elementTagStack.arrayList.size_0 == 0, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Start tags not closed, ' + this$static.elementTagStack.arrayList.size_0]));
  return !this$static.current?null:this$static.current.type_0;
}

function $processingInstruction(this$static){
  var end, name_0, start;
  $ensure_0(this$static, $match(this$static, '<?'), initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Matching <?']));
  name_0 = $name(this$static);
  $ensure_0(this$static, name_0 != null, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Processing instruction target must start with a valid xml nameStartChar, but instead encountered: ' + String.fromCharCode($peek_2(this$static.buffer) & 65535)]));
  $whitespace(this$static);
  start = this$static.buffer.position_0;
  while ($hasMore(this$static.buffer) && !$startsWith(this$static.buffer, '?>')) {
    this$static.buffer.position_0 += 1;
  }
  end = this$static.buffer.position_0;
  $ensure_0(this$static, $match(this$static, '?>'), initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Matching ?>']));
  return new Item_0(($clinit_2068() , PROCESSING_INSTRUCTION), name_0, null, $substring_0(this$static.buffer.str, start, end));
}

function $reference(this$static){
  var charReference, entityReference;
  charReference = $charReference(this$static);
  if (charReference != null) {
    return charReference;
  }
  entityReference = $entityReference(this$static);
  if (entityReference != null) {
    return entityReference;
  }
  return null;
}

function $startTag(this$static){
  var attrList, tagName;
  $ensure_0(this$static, $match_0(this$static, 60), initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Matching <']));
  tagName = $name(this$static);
  $ensure_0(this$static, tagName != null, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, ['Matching name']));
  attrList = $attrList(this$static);
  $whitespace(this$static);
  if ($match(this$static, '/>')) {
    this$static.atSelfClosingStart = true;
    return new Item_0(($clinit_2068() , START_ELEMENT), tagName, attrList, null);
  }
   else if ($match_0(this$static, 62)) {
    $add_9(this$static.elementTagStack.arrayList, tagName);
    return new Item_0(($clinit_2068() , START_ELEMENT), tagName, attrList, null);
  }
   else {
    throw new XmlParseException_2('Matching > or />');
  }
}

function $whitespace(this$static){
  var end, start;
  start = this$static.buffer.position_0;
  if (!$isWhiteSpaceChar($peek_2(this$static.buffer))) {
    return null;
  }
  while ($hasMore(this$static.buffer) && $isWhiteSpaceChar($peek_2(this$static.buffer))) {
    this$static.buffer.position_0 += 1;
  }
  end = this$static.buffer.position_0;
  return $substring_0(this$static.buffer.str, start, end);
}

function StreamingXmlParser_0(xml){
  $clinit_2070();
  this.elementTagStack = new Stack_0;
  $clinit_2376();
  if (traverseUtf16String(xml, VALID_UTF16).value_0) {
    this.buffer = new StreamingXmlParser$Buffer_0(xml);
  }
   else {
    throw new XmlParseException_2('Input is not valid UTF-16: ' + xml);
  }
}

function StreamingXmlParser(){
}

_ = StreamingXmlParser_0.prototype = StreamingXmlParser.prototype = new Object_0;
_.getClass$ = function getClass_1348(){
  return Lorg_waveprotocol_wave_model_document_parser_StreamingXmlParser_2_classLit;
}
;
_.castableTypeMap$ = {};
_.atSelfClosingStart = false;
_.buffer = null;
_.current = null;
var BASE_10_DIGITS, BASE_16_DIGITS, entities = null;
function $advanceCodePoint(this$static){
  isHighSurrogate(this$static.str.charCodeAt(this$static.position_0))?(this$static.position_0 += 2):++this$static.position_0;
}

function $hasMore(this$static){
  var hasMore;
  hasMore = this$static.position_0 != this$static.str.length;
  return hasMore;
}

function $peek_2(this$static){
  if (this$static.position_0 >= this$static.str.length) {
    throw new XmlParseException_2('Reading past end of input.');
  }
  return $codePointAt(this$static.str, this$static.position_0);
}

function $startsWith(this$static, s){
  var i;
  if (this$static.str.length < this$static.position_0 + s.length) {
    return false;
  }
  for (i = 0; i < s.length; ++i) {
    if (s.charCodeAt(i) != this$static.str.charCodeAt(i + this$static.position_0)) {
      return false;
    }
  }
  return true;
}

function StreamingXmlParser$Buffer_0(str){
  this.str = str;
}

function StreamingXmlParser$Buffer(){
}

_ = StreamingXmlParser$Buffer_0.prototype = StreamingXmlParser$Buffer.prototype = new Object_0;
_.getClass$ = function getClass_1349(){
  return Lorg_waveprotocol_wave_model_document_parser_StreamingXmlParser$Buffer_2_classLit;
}
;
_.castableTypeMap$ = {};
_.position_0 = 0;
_.str = null;
function XmlParseException_0(t){
  Exception_3.call(this, t);
}

function XmlParseException_1(message, t){
  this.fillInStackTrace();
  this.cause = t;
  this.detailMessage = message;
}

function XmlParseException_2(message){
  this.fillInStackTrace();
  this.detailMessage = message;
}

function XmlParseException(){
}

_ = XmlParseException_2.prototype = XmlParseException_1.prototype = XmlParseException_0.prototype = XmlParseException.prototype = new Exception;
_.getClass$ = function getClass_1350(){
  return Lorg_waveprotocol_wave_model_document_parser_XmlParseException_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 39:1, 183:1, 380:1};
function Node_1(){
}

_ = Node_1.prototype = new Object_0;
_.getClass$ = function getClass_1351(){
  return Lorg_waveprotocol_wave_model_document_raw_impl_Node_2_classLit;
}
;
_.castableTypeMap$ = {376:1, 428:1};
_.firstChild_0 = null;
_.indexingContainer = null;
_.lastChild_0 = null;
_.nextSibling_0 = null;
_.parent_0 = null;
_.previousSibling_0 = null;
function $constructMaps(this$static){
  this$static.backingAttributeMap = new TreeMap_0;
  this$static.publicAttributeMap = ($clinit_480() , new Collections$UnmodifiableMap_0(this$static.backingAttributeMap));
}

function $insertBefore_8(this$static, newChild, refChild){
  var childBefore;
  !!newChild.parent_0 && $removeChild_7(newChild.parent_0, newChild);
  if (refChild) {
    childBefore = refChild.previousSibling_0;
    refChild.previousSibling_0 = newChild;
  }
   else {
    childBefore = this$static.lastChild_0;
    this$static.lastChild_0 = newChild;
  }
  childBefore?(childBefore.nextSibling_0 = newChild):(this$static.firstChild_0 = newChild);
  newChild.parent_0 = this$static;
  newChild.previousSibling_0 = childBefore;
  newChild.nextSibling_0 = refChild;
  return newChild;
}

function $removeChild_7(this$static, oldChild){
  var siblingAfter, siblingBefore;
  if (oldChild.parent_0 != this$static) {
    throw new IllegalArgumentException_1('removeChild: oldChild is not child of parent');
  }
  siblingBefore = oldChild.previousSibling_0;
  siblingAfter = oldChild.nextSibling_0;
  siblingBefore?(siblingBefore.nextSibling_0 = siblingAfter):(this$static.firstChild_0 = siblingAfter);
  siblingAfter?(siblingAfter.previousSibling_0 = siblingBefore):(this$static.lastChild_0 = siblingBefore);
  oldChild.previousSibling_0 = null;
  oldChild.nextSibling_0 = null;
  oldChild.parent_0 = null;
  return oldChild;
}

function $setAttribute_4(this$static, name_0, value){
  !this$static.backingAttributeMap && (this$static.backingAttributeMap = new TreeMap_0 , this$static.publicAttributeMap = ($clinit_480() , new Collections$UnmodifiableMap_0(this$static.backingAttributeMap)));
  $put_3(this$static.backingAttributeMap, name_0, value);
}

function Element_2(tagName){
  this.tagName_0 = tagName;
}

function Element_1(){
}

_ = Element_2.prototype = Element_1.prototype = new Node_1;
_.asElement_1 = function asElement_8(){
  return this;
}
;
_.asText_1 = function asText_8(){
  return null;
}
;
_.getClass$ = function getClass_1352(){
  return Lorg_waveprotocol_wave_model_document_raw_impl_Element_2_classLit;
}
;
_.getNodeType = function getNodeType_7(){
  return 1;
}
;
_.toString$ = function toString_112(){
  return $appendNode_0(new XmlStringBuilderDoc_0(new RawDocumentImpl_0('x', ($clinit_1880() , EMPTY_MAP_0)), ($clinit_2011() , ANY)), this).builder.impl.string;
}
;
_.castableTypeMap$ = {260:1, 376:1, 427:1, 428:1};
_.backingAttributeMap = null;
_.publicAttributeMap = null;
_.tagName_0 = null;
function $asElement_6(node){
  return node?node.asElement_1():null;
}

function $asText_5(node){
  return node?node.asText_1():null;
}

function $createElement_9(tagName, attributes, parentElement, nodeAfter){
  var el;
  el = $createElement_10(tagName, attributes);
  $insertBefore_8(parentElement, el, nodeAfter);
  return el;
}

function $createElement_10(tagName, attributes){
  var attribute, attribute$iterator, element;
  element = new Element_2(tagName);
  for (attribute$iterator = new ImmutableStateMap$1$1_0(attributes.entrySet); attribute$iterator.iterator.hasNext();) {
    attribute = dynamicCast(attribute$iterator.iterator.next_0(), 394);
    $setAttribute_4(element, attribute.name_0, attribute.value_0);
  }
  return element;
}

function $createTextNode_6(data, parentElement, nodeAfter){
  var node;
  node = new Text_2(data);
  $insertBefore_8(parentElement, node, nodeAfter);
  return node;
}

function $deleteData_3(textNode, offset, count){
  textNode.data_0 = textNode.data_0.substr(0, offset - 0) + $substring(textNode.data_0, offset + count);
}

function $getAttribute_6(element, name_0){
  var entry;
  return !element.backingAttributeMap?null:dynamicCast((!element.backingAttributeMap && $constructMaps(element) , entry = $getEntry(element.backingAttributeMap, name_0) , entry?entry.value_0:null), 1);
}

function $getAttributes_5(element){
  return !element.publicAttributeMap && (element.backingAttributeMap = new TreeMap_0 , element.publicAttributeMap = ($clinit_480() , new Collections$UnmodifiableMap_0(element.backingAttributeMap))) , element.publicAttributeMap;
}

function $insertData_4(textNode, offset, arg){
  textNode.data_0 = textNode.data_0.substr(0, offset - 0) + arg + $substring(textNode.data_0, offset);
}

function $removeAttribute_3(element, name_0){
  !element.backingAttributeMap && $constructMaps(element);
  $remove_23(element.backingAttributeMap, name_0);
}

function $setAttribute_5(element, name_0, value){
  checkNotNull_1(value, 'Null attribute value in setAttribute');
  !element.backingAttributeMap && $constructMaps(element);
  $put_3(element.backingAttributeMap, name_0, value);
}

function RawDocumentImpl_0(tagName, attributes){
  this.documentElement_0 = $createElement_10(tagName, attributes);
}

function RawDocumentImpl(){
}

_ = RawDocumentImpl_0.prototype = RawDocumentImpl.prototype = new Object_0;
_.appendData = function appendData_1(textNode, arg){
  dynamicCast(textNode, 426).data_0 += arg;
}
;
_.asElement_0 = function asElement_9(node){
  return $asElement_6(dynamicCast(node, 428));
}
;
_.asText_0 = function asText_9(node){
  return $asText_5(dynamicCast(node, 428));
}
;
_.createElement_1 = function createElement_7(tagName, attributes, parentElement, nodeAfter){
  return $createElement_9(tagName, attributes, dynamicCast(parentElement, 427), dynamicCast(nodeAfter, 428));
}
;
_.createTextNode_0 = function createTextNode_3(data, parentElement, nodeAfter){
  return $createTextNode_6(data, dynamicCast(parentElement, 427), dynamicCast(nodeAfter, 428));
}
;
_.deleteData_0 = function deleteData_1(textNode, offset, count){
  $deleteData_3(dynamicCast(textNode, 426), offset, count);
}
;
_.getAttribute_0 = function getAttribute_5(element, name_0){
  return $getAttribute_6(dynamicCast(element, 427), name_0);
}
;
_.getAttributes = function getAttributes_5(element){
  return $getAttributes_5(dynamicCast(element, 427));
}
;
_.getClass$ = function getClass_1353(){
  return Lorg_waveprotocol_wave_model_document_raw_impl_RawDocumentImpl_2_classLit;
}
;
_.getData = function getData_5(textNode){
  return dynamicCast(textNode, 426).data_0;
}
;
_.getDocumentElement = function getDocumentElement_7(){
  return this.documentElement_0;
}
;
_.getFirstChild_0 = function getFirstChild_10(node){
  return dynamicCast(node, 428).firstChild_0;
}
;
_.getIndexingContainer = function getIndexingContainer_1(domNode){
  return dynamicCast(domNode, 428).indexingContainer;
}
;
_.getLastChild_0 = function getLastChild_10(node){
  return dynamicCast(node, 428).lastChild_0;
}
;
_.getLength = function getLength_5(textNode){
  return dynamicCast(textNode, 426).data_0.length;
}
;
_.getNextSibling = function getNextSibling_8(node){
  return dynamicCast(node, 428).nextSibling_0;
}
;
_.getNodeType_0 = function getNodeType_8(node){
  return dynamicCast(node, 428).getNodeType();
}
;
_.getParentElement = function getParentElement_6(node){
  return dynamicCast(node, 428).parent_0;
}
;
_.getPreviousSibling = function getPreviousSibling_8(node){
  return dynamicCast(node, 428).previousSibling_0;
}
;
_.getTagName = function getTagName_5(element){
  return dynamicCast(element, 427).tagName_0;
}
;
_.insertData_0 = function insertData_2(textNode, offset, arg){
  $insertData_4(dynamicCast(textNode, 426), offset, arg);
}
;
_.isSameNode = function isSameNode_5(node, other){
  return dynamicCast(node, 428) == dynamicCast(other, 428);
}
;
_.removeAttribute_0 = function removeAttribute_1(element, name_0){
  $removeAttribute_3(dynamicCast(element, 427), name_0);
}
;
_.removeChild_0 = function removeChild_2(parent_0, oldChild){
  $removeChild_7(dynamicCast(parent_0, 427), dynamicCast(oldChild, 428));
}
;
_.setAttribute_0 = function setAttribute_1(element, name_0, value){
  $setAttribute_5(dynamicCast(element, 427), name_0, value);
}
;
_.setIndexingContainer = function setIndexingContainer_1(domNode, indexingContainer){
  dynamicCast(domNode, 428).indexingContainer = indexingContainer;
}
;
_.splitText_0 = function splitText_3(textNode, offset){
  return $splitText_6(dynamicCast(textNode, 426), offset);
}
;
_.toString$ = function toString_113(){
  return createNode(this, this.documentElement_0).builder.impl.string;
}
;
_.castableTypeMap$ = {19:1};
_.documentElement_0 = null;
function $splitText_6(this$static, offset){
  var newNode, splitOffText;
  if (offset == 0) {
    return this$static;
  }
   else if (offset >= this$static.data_0.length) {
    return null;
  }
  splitOffText = $substring(this$static.data_0, offset);
  this$static.data_0 = this$static.data_0.substr(0, offset - 0);
  newNode = new Text_2(splitOffText);
  $insertBefore_8(this$static.parent_0, newNode, this$static.nextSibling_0);
  return newNode;
}

function Text_2(data){
  this.data_0 = data;
}

function Text_1(){
}

_ = Text_2.prototype = Text_1.prototype = new Node_1;
_.asElement_1 = function asElement_10(){
  return null;
}
;
_.asText_1 = function asText_10(){
  return this;
}
;
_.getClass$ = function getClass_1354(){
  return Lorg_waveprotocol_wave_model_document_raw_impl_Text_2_classLit;
}
;
_.getNodeType = function getNodeType_9(){
  return 3;
}
;
_.toString$ = function toString_114(){
  return this.data_0;
}
;
_.castableTypeMap$ = {376:1, 426:1, 428:1};
_.data_0 = null;
function $mapToString_0(map){
  var buf, first;
  buf = new StringBuilder_2('{');
  first = initValues(_3Z_classLit, {9:1}, -1, [true]);
  map.each_2(new AnnotationIntervalImpl$1_0(first, buf));
  buf.impl.string += '}';
  return buf.impl.string;
}

function $set_9(this$static, start, end, annotations, diffFromPrevious){
  checkPositionIndexesInRange(start, end, 2147483647);
  checkNotNull_1(annotations, 'annotations must not be null');
  checkNotNull_1(diffFromPrevious, 'diffFromPrevious must not be null');
  if (start >= end) {
    throw new IllegalArgumentException_1('Attempt to set AnnotationInterval to zero length');
  }
  this$static.start = start;
  this$static.end = end;
  this$static.annotations = annotations;
  this$static.diffFromLeft = diffFromPrevious;
}

function AnnotationIntervalImpl_0(start, end, annotations, diffFromLeft){
  $set_9(this, start, end, annotations, diffFromLeft);
}

function AnnotationIntervalImpl(){
}

_ = AnnotationIntervalImpl_0.prototype = AnnotationIntervalImpl.prototype = new Object_0;
_.getClass$ = function getClass_1355(){
  return Lorg_waveprotocol_wave_model_document_util_AnnotationIntervalImpl_2_classLit;
}
;
_.toString$ = function toString_115(){
  return 'AnnotationIntervalImpl(' + this.start + ', ' + this.end + ', ' + $mapToString_0(this.annotations) + ', ' + $mapToString_0(this.diffFromLeft) + ')';
}
;
_.castableTypeMap$ = {393:1};
_.annotations = null;
_.diffFromLeft = null;
_.end = 0;
_.start = 0;
function AnnotationIntervalImpl$1_0(val$first, val$buf){
  this.val$first = val$first;
  this.val$buf = val$buf;
}

function AnnotationIntervalImpl$1(){
}

_ = AnnotationIntervalImpl$1_0.prototype = AnnotationIntervalImpl$1.prototype = new Object_0;
_.apply_1 = function apply_129(key, value){
  this.val$first[0]?(this.val$first[0] = false):$append_11(this.val$buf, ', ');
  $append_11(this.val$buf, key + '=' + value);
}
;
_.getClass$ = function getClass_1356(){
  return Lorg_waveprotocol_wave_model_document_util_AnnotationIntervalImpl$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$buf = null;
_.val$first = null;
function validatePrefix(prefix){
  if (prefix == null) {
    throw new IllegalArgumentException_1('Prefix cannot be null');
  }
  if ($equals_3('', prefix)) {
    throw new IllegalArgumentException_1('Cannot register handler on root prefix');
  }
  if (prefix.indexOf('/') == 0 || prefix.indexOf('?') == 0) {
    throw new IllegalArgumentException_1('Illegal initial character: ' + String.fromCharCode(prefix.charCodeAt(0)));
  }
  if (prefix.lastIndexOf('/') != -1 && prefix.lastIndexOf('/') == prefix.length - '/'.length) {
    throw new IllegalArgumentException_1('Illegal final character: ' + String.fromCharCode(prefix.charCodeAt(0)));
  }
}

function $clinit_2084(){
  $clinit_2084 = nullMethod;
  handlerDataDomain_0 = new AnnotationRegistryImpl$1_0;
  ROOT_1 = new AnnotationRegistryImpl_0;
}

function $getBehaviours(this$static, prefix){
  var behaviours, parts;
  parts = prefix + '/';
  behaviours = dynamicCast($inspect(this$static.data_0), 195).behaviours;
  return new AnnotationRegistryImpl$3_0(parts, behaviours);
}

function $getHandlers(this$static, prefix){
  var handlers, parts;
  parts = prefix + '/';
  handlers = dynamicCast($inspect(this$static.data_0), 195).handlers;
  return new AnnotationRegistryImpl$2_0(parts, handlers);
}

function $registerBehaviour(this$static, prefix, behaviour){
  validatePrefix(prefix);
  dynamicCast($modify_0(this$static.data_0), 195).behaviours.put_3(prefix, behaviour);
}

function $registerHandler(this$static, prefix, handler){
  validatePrefix(prefix);
  dynamicCast($modify_0(this$static.data_0), 195).handlers.put_3(prefix, handler);
}

function AnnotationRegistryImpl_0(){
  this.data_0 = new ChainedData_0(handlerDataDomain_0);
}

function AnnotationRegistryImpl_1(parent_0){
  this.data_0 = new ChainedData_1(parent_0.data_0);
}

function AnnotationRegistryImpl(){
}

_ = AnnotationRegistryImpl_1.prototype = AnnotationRegistryImpl_0.prototype = AnnotationRegistryImpl.prototype = new Object_0;
_.getClass$ = function getClass_1357(){
  return Lorg_waveprotocol_wave_model_document_util_AnnotationRegistryImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.data_0 = null;
var ROOT_1, handlerDataDomain_0;
function $compose_2(target, changes, base){
  target.handlers.clear();
  target.handlers.putAll_0(base.handlers);
  target.behaviours.putAll_0(base.behaviours);
  target.handlers.putAll_0(changes.handlers);
  target.behaviours.putAll_0(changes.behaviours);
}

function AnnotationRegistryImpl$1_0(){
}

function AnnotationRegistryImpl$1(){
}

_ = AnnotationRegistryImpl$1_0.prototype = AnnotationRegistryImpl$1.prototype = new Object_0;
_.compose = function compose_4(target, changes, base){
  $compose_2(dynamicCast(target, 195), dynamicCast(changes, 195), dynamicCast(base, 195));
}
;
_.empty = function empty_1(){
  return new AnnotationRegistryImpl$HandlerData_0;
}
;
_.getClass$ = function getClass_1358(){
  return Lorg_waveprotocol_wave_model_document_util_AnnotationRegistryImpl$1_2_classLit;
}
;
_.readOnlyView = function readOnlyView_1(modifiable){
  return dynamicCast(modifiable, 195);
}
;
_.castableTypeMap$ = {};
function $getNext_4(this$static){
  var handler;
  while ((this$static.fromIndex = $indexOf_0(this$static.val$parts, 47, this$static.fromIndex + 1)) != -1) {
    handler = dynamicCast(this$static.val$handlers.get_4(this$static.val$parts.substr(0, this$static.fromIndex - 0)), 429);
    if (handler) {
      this$static.next = handler;
      return;
    }
  }
  this$static.next = null;
}

function AnnotationRegistryImpl$2_0(val$parts, val$handlers){
  this.val$parts = val$parts;
  this.val$handlers = val$handlers;
  $getNext_4(this);
}

function AnnotationRegistryImpl$2(){
}

_ = AnnotationRegistryImpl$2_0.prototype = AnnotationRegistryImpl$2.prototype = new Object_0;
_.getClass$ = function getClass_1359(){
  return Lorg_waveprotocol_wave_model_document_util_AnnotationRegistryImpl$2_2_classLit;
}
;
_.hasNext = function hasNext_20(){
  return !!this.next;
}
;
_.next_0 = function next_28(){
  var ret;
  return ret = this.next , $getNext_4(this) , ret;
}
;
_.remove_1 = function remove_57(){
  throw new UnsupportedOperationException_1('getHandlers iterator: remove');
}
;
_.castableTypeMap$ = {};
_.fromIndex = -1;
_.next = null;
_.val$handlers = null;
_.val$parts = null;
function $getNext_5(this$static){
  var behaviour;
  while ((this$static.fromIndex = $indexOf_0(this$static.val$parts, 47, this$static.fromIndex + 1)) != -1) {
    behaviour = dynamicCast(this$static.val$behaviours.get_4(this$static.val$parts.substr(0, this$static.fromIndex - 0)), 430);
    if (behaviour) {
      this$static.next = behaviour;
      return;
    }
  }
  this$static.next = null;
}

function AnnotationRegistryImpl$3_0(val$parts, val$behaviours){
  this.val$parts = val$parts;
  this.val$behaviours = val$behaviours;
  $getNext_5(this);
}

function AnnotationRegistryImpl$3(){
}

_ = AnnotationRegistryImpl$3_0.prototype = AnnotationRegistryImpl$3.prototype = new Object_0;
_.getClass$ = function getClass_1360(){
  return Lorg_waveprotocol_wave_model_document_util_AnnotationRegistryImpl$3_2_classLit;
}
;
_.hasNext = function hasNext_21(){
  return !!this.next;
}
;
_.next_0 = function next_29(){
  var ret;
  return ret = this.next , $getNext_5(this) , ret;
}
;
_.remove_1 = function remove_58(){
  throw new UnsupportedOperationException_1('getBehaviours iterator: remove');
}
;
_.castableTypeMap$ = {};
_.fromIndex = -1;
_.next = null;
_.val$behaviours = null;
_.val$parts = null;
function AnnotationRegistryImpl$HandlerData_0(){
  this.handlers = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  this.behaviours = defaultCollectionFactory.createStringMap();
}

function AnnotationRegistryImpl$HandlerData(){
}

_ = AnnotationRegistryImpl$HandlerData_0.prototype = AnnotationRegistryImpl$HandlerData.prototype = new Object_0;
_.getClass$ = function getClass_1361(){
  return Lorg_waveprotocol_wave_model_document_util_AnnotationRegistryImpl$HandlerData_2_classLit;
}
;
_.castableTypeMap$ = {195:1};
function checkPersistentKey(key){
  checkNotNull_1(key, 'Annotation key may not be null');
  key.charCodeAt(0) == 64 && illegalArgument("Attempt to use local annotation key '" + key + "' as a persistent key");
  (key.indexOf(fromCodePoint(64)) != -1 || key.indexOf(fromCodePoint(63)) != -1) && illegalArgument("Persistent annotation key '" + key + "' contains invalid characters");
}

function getAlignedAnnotation(annotations, location_0, key, leftAlign){
  if (leftAlign) {
    if (location_0 == 0) {
      return null;
    }
    --location_0;
  }
   else {
    if (location_0 == $size_15(annotations.doc)) {
      return null;
    }
  }
  return $getAnnotation_2(annotations.doc, location_0, key);
}

function guardedResetAnnotation(annotations, start, end, key, value){
  var isSet, size;
  size = annotations.size_1();
  isSet = annotations.firstAnnotationChange(0, start, key, null) == -1 && annotations.firstAnnotationChange(start, end, key, value) == -1 && annotations.firstAnnotationChange(end, size, key, null) == -1;
  isSet || annotations.resetAnnotation(start, end, key, value);
  return !isSet;
}

var prefixIncrementor = 0;
function $addChildListener(this$static, parent_0, listener){
  var list;
  !this$static.elementListenerMap && (this$static.elementListenerMap = ($clinit_2309() , new HashMap_0));
  list = $ensureListenerList(parent_0, this$static.elementListenerMap);
  $add_31(list, listener);
  ++this$static.listenerCount;
  this$static.listenerCount == 1 && this$static.doc.addListener(this$static);
  return new DefaultDocumentEventRouter$Registration_0;
}

function $ensureListenerList(target, map){
  var list;
  list = dynamicCast(map.get(target), 432);
  if (!list) {
    list = ($clinit_2326() , new CopyOnWriteSet_0(LIST_SET));
    map.put(target, list);
  }
  return list;
}

function $removeDeadListeners(this$static, bundle){
  var deleted, deleted$iterator;
  for (deleted$iterator = bundle.deleted.iterator_0(); deleted$iterator.hasNext();) {
    deleted = deleted$iterator.next_0();
    !!this$static.attributeListenerMap && $removeListeners(this$static, this$static.attributeListenerMap, deleted);
    !!this$static.elementListenerMap && $removeListeners(this$static, this$static.elementListenerMap, deleted);
    !!this$static.deletionListenerMap && $removeListeners(this$static, this$static.deletionListenerMap, deleted);
  }
}

function $removeListeners(this$static, map, elm){
  var removed;
  removed = dynamicCast(map.remove_3(elm), 432);
  if (removed) {
    this$static.listenerCount -= removed.contents.size_1();
    this$static.listenerCount == 0 && this$static.doc.removeListener(this$static);
  }
  return removed;
}

function DefaultDocumentEventRouter_0(doc){
  this.doc = doc;
}

function DefaultDocumentEventRouter(){
}

_ = DefaultDocumentEventRouter_0.prototype = DefaultDocumentEventRouter.prototype = new Object_0;
_.addAttributeListener = function addAttributeListener(target, listener){
  var list;
  !this.attributeListenerMap && (this.attributeListenerMap = ($clinit_2309() , new HashMap_0));
  list = $ensureListenerList(target, this.attributeListenerMap);
  $add_31(list, listener);
  ++this.listenerCount;
  this.listenerCount == 1 && this.doc.addListener(this);
  return new DefaultDocumentEventRouter$Registration_0;
}
;
_.addChildListener = function addChildListener(parent_0, listener){
  return $addChildListener(this, parent_0, listener);
}
;
_.addDeletionListener = function addDeletionListener(target, listener){
  var list;
  !this.deletionListenerMap && (this.deletionListenerMap = ($clinit_2309() , new HashMap_0));
  list = $ensureListenerList(target, this.deletionListenerMap);
  $add_31(list, listener);
  ++this.listenerCount;
  this.listenerCount == 1 && this.doc.addListener(this);
  return new DefaultDocumentEventRouter$Registration_0;
}
;
_.getClass$ = function getClass_1362(){
  return Lorg_waveprotocol_wave_model_document_util_DefaultDocumentEventRouter_2_classLit;
}
;
_.getDocument_0 = function getDocument_1(){
  return this.doc;
}
;
_.onDocumentEvents = function onDocumentEvents(bundle){
  var am, deleted, deleted$iterator, deletedEvent, deletedLocation, event_0, event$iterator, inserted, listener, listener$iterator, listeners, parent_0, target;
  if (this.attributeListenerMap) {
    for (event$iterator = new AbstractList$IteratorImpl_0(bundle.components); event$iterator.i < event$iterator.this$0_0.size_1();) {
      event_0 = dynamicCast($next_4(event$iterator), 431);
      if (event_0.type_0 == ($clinit_1832() , ATTRIBUTES)) {
        am = dynamicCast(event_0, 385);
        target = am.element;
        listeners = dynamicCast(this.attributeListenerMap.get(target), 432);
        if (listeners) {
          for (listener$iterator = (listeners.stale = true , listeners.contents.iterator_0()); listener$iterator.hasNext();) {
            listener = dynamicCast(listener$iterator.next_0(), 433);
            listener.onAttributesChanged(target, am.oldValues, am.newValues);
          }
        }
      }
    }
  }
  if (this.elementListenerMap) {
    for (event$iterator = new AbstractList$IteratorImpl_0(bundle.components); event$iterator.i < event$iterator.this$0_0.size_1();) {
      event_0 = dynamicCast($next_4(event$iterator), 431);
      if (event_0.type_0 == ($clinit_1832() , CONTENT_DELETED)) {
        deletedEvent = dynamicCast(event_0, 386);
        deleted = deletedEvent.root;
        deletedLocation = this.doc.locate(deletedEvent.location_0);
        parent_0 = enclosingElement(this.doc, deletedLocation.container);
        listeners = dynamicCast(this.elementListenerMap.get(parent_0), 432);
        if (listeners) {
          for (listener$iterator = (listeners.stale = true , listeners.contents.iterator_0()); listener$iterator.hasNext();) {
            listener = dynamicCast(listener$iterator.next_0(), 434);
            listener.onElementRemoved(deleted);
          }
        }
      }
    }
  }
  for (deleted$iterator = bundle.deleted.iterator_0(); deleted$iterator.hasNext();) {
    deleted = deleted$iterator.next_0();
    if (this.deletionListenerMap) {
      listeners = dynamicCast(this.deletionListenerMap.get(deleted), 432);
      if (listeners) {
        for (listener$iterator = (listeners.stale = true , listeners.contents.iterator_0()); listener$iterator.hasNext();) {
          listener = dynamicCast(listener$iterator.next_0(), 435);
          listener.onDeleted();
        }
      }
    }
  }
  if (this.elementListenerMap) {
    for (event$iterator = new AbstractList$IteratorImpl_0(bundle.components); event$iterator.i < event$iterator.this$0_0.size_1();) {
      event_0 = dynamicCast($next_4(event$iterator), 431);
      if (event_0.type_0 == ($clinit_1832() , CONTENT_INSERTED)) {
        inserted = dynamicCast(event_0, 388).element;
        parent_0 = this.doc.getParentElement(inserted);
        listeners = dynamicCast(this.elementListenerMap.get(parent_0), 432);
        if (listeners) {
          for (listener$iterator = (listeners.stale = true , listeners.contents.iterator_0()); listener$iterator.hasNext();) {
            listener = dynamicCast(listener$iterator.next_0(), 434);
            listener.onElementAdded(inserted);
          }
        }
      }
    }
  }
  $removeDeadListeners(this, bundle);
}
;
_.castableTypeMap$ = {475:1};
_.attributeListenerMap = null;
_.deletionListenerMap = null;
_.doc = null;
_.elementListenerMap = null;
_.listenerCount = 0;
function DefaultDocEventRouter_0(doc){
  this.doc = doc;
}

function DefaultDocEventRouter(){
}

_ = DefaultDocEventRouter_0.prototype = DefaultDocEventRouter.prototype = new DefaultDocumentEventRouter;
_.getClass$ = function getClass_1363(){
  return Lorg_waveprotocol_wave_model_document_util_DefaultDocEventRouter_2_classLit;
}
;
_.getDocument_0 = function getDocument_2(){
  return this.doc;
}
;
_.castableTypeMap$ = {475:1};
function DefaultDocumentEventRouter$Registration_0(){
}

function DefaultDocumentEventRouter$Registration(){
}

_ = DefaultDocumentEventRouter$Registration_0.prototype = DefaultDocumentEventRouter$Registration.prototype = new Object_0;
_.getClass$ = function getClass_1364(){
  return Lorg_waveprotocol_wave_model_document_util_DefaultDocumentEventRouter$Registration_2_classLit;
}
;
_.castableTypeMap$ = {};
function ensureNodeBoundaryReturnNextNode(point, doc, textNodeOrganiser){
  var maybeSecond, textNode, textStartPoint;
  textStartPoint = point.asTextPoint();
  if (textStartPoint) {
    textNode = doc.inner_0.asText_0(textStartPoint.container);
    maybeSecond = $splitText_2(textNodeOrganiser, textNode, $getTextOffset(textStartPoint));
    return maybeSecond?maybeSecond:getNextOrPrevNodeDepthFirst_1(doc, textNode, null, false, true);
  }
   else 
    return $getNodeAfter(point) != null?$getNodeAfter(point):getNextOrPrevNodeDepthFirst_1(doc, point.container, null, false, true);
}

function getElementWithTagName_0(doc, tagName, subtreeRoot){
  var element, node;
  node = getNextOrPrevNodeDepthFirst_1(doc, subtreeRoot, subtreeRoot, true, true);
  while (node != null) {
    element = doc.asElement_0(node);
    if (element != null) {
      if ($equals_3(doc.getTagName(element), tagName)) {
        return element;
      }
    }
    node = getNextOrPrevNodeDepthFirst_1(doc, node, subtreeRoot, true, true);
  }
  return null;
}

function getFilteredPoint(filteredView, point){
  var next, visible;
  filteredView.onBeforeFilter(point);
  if (point.offset >= 0) {
    visible = $getVisibleNode(filteredView, point.container);
    if ((visible == null?null:visible) === maskUndefined(point.container)) {
      return point;
    }
     else {
      next = getNextOrPrevNodeDepthFirst_1(filteredView, point.container, visible, false, true);
      return next == null?new Point$El_0(visible, null):new Point$El_0($getParentElement_3(filteredView, next), next);
    }
  }
   else 
    return $getNodeAfter(point) == null?getLocationOfNodeEnd(filteredView, point.container):getLocationOfBeforeNode(filteredView, $getNodeAfter(point));
}

function getFirstChildElement(doc, element){
  return getNextElementInclusive(doc, doc.getFirstChild_0(element), true);
}

function getItemSize(doc, node){
  var locationAfter, next, parent_0, textNode;
  textNode = doc.substrate.asText_0(node);
  if (textNode != null) {
    return doc.substrate.getLength(textNode);
  }
  parent_0 = doc.substrate.getParentElement(node);
  if (parent_0 == null) {
    return $checkSizeConsistency(doc, 'size') , doc.offsetList.root.offset;
  }
  next = doc.substrate.getNextSibling(node);
  locationAfter = next != null?doc.getLocation(next):doc.getLocation_0(new Point$El_0(parent_0, null));
  return locationAfter - doc.getLocation(node);
}

function getLocationOfBeforeNode(doc, node){
  var next, parent_0;
  parent_0 = $getVisibleNode(doc, node);
  if ((parent_0 == null?null:parent_0) === (node == null?null:node)) {
    return new Point$El_0($getParentElement_3(doc, node), node);
  }
  next = getNextOrPrevNodeDepthFirst_1(doc, node, parent_0, true, true);
  return next == null?new Point$El_0(parent_0, null):new Point$El_0($getParentElement_3(doc, next), next);
}

function getLocationOfNodeEnd(doc, node){
  var next, parent_0;
  parent_0 = $getVisibleNode(doc, node);
  if ((parent_0 == null?null:parent_0) === (node == null?null:node)) {
    return new Point$El_0(node, null);
  }
  next = getNextOrPrevNodeDepthFirst_1(doc, node, parent_0, false, true);
  return next == null?new Point$El_0(parent_0, null):new Point$El_0($getParentElement_3(doc, next), next);
}

function getNextElementInclusive(doc, node, forward_0){
  var asElement;
  asElement = doc.asElement_0(node);
  while (node != null && asElement == null) {
    node = forward_0?doc.getNextSibling(node):doc.getPreviousSibling(node);
    asElement = doc.asElement_0(node);
  }
  return asElement;
}

function getNextOrPrevNodeDepthFirst_1(doc, start, stopAt, enter, rightwards){
  var element, next;
  stopAt == null && (stopAt = doc.getDocumentElement());
  if (enter) {
    element = doc.asElement_0(start);
    if (element != null) {
      next = rightwards?doc.getFirstChild_0(element):doc.getLastChild_0(element);
      if (next != null) {
        return next;
      }
    }
  }
  while (start != null && !doc.isSameNode(start, stopAt)) {
    next = rightwards?doc.getNextSibling(start):doc.getPreviousSibling(start);
    if (doc.isSameNode(next, stopAt)) {
      return null;
    }
    if (next != null) {
      return next;
    }
    start = doc.getParentElement(start);
  }
  return null;
}

function getNextSiblingElement(doc, element){
  return getNextElementInclusive(doc, doc.getNextSibling(element), true);
}

function getNodeAfterOutwards(doc, point, output){
  var node, parent_0, startOffset;
  if (point.offset >= 0) {
    node = point.container;
    startOffset = $getTextOffset(point);
  }
   else {
    node = $getNodeAfter(point);
    if (node == null) {
      parent_0 = point.container;
      while (parent_0 != null) {
        node = doc.getNextSibling(parent_0);
        if (node != null) {
          break;
        }
        parent_0 = doc.getParentElement(parent_0);
      }
    }
    startOffset = 0;
  }
  output.node = node;
  output.offset = startOffset;
}

function getPreviousSiblingElement_0(doc, element){
  checkNotNull_1(element, 'Previous element for null element is undefined');
  checkNotNull_1(doc, 'Previous element for null document is undefined');
  return getNextElementInclusive(doc, doc.getPreviousSibling(element), false);
}

function getText(doc, start, end){
  var endPoint, startPoint;
  return checkPositionIndexesInRange(start, end, doc.size_1()) , startPoint = doc.locate(start) , endPoint = doc.locate(end) , getText_1(doc, startPoint, endPoint);
}

function getText_1(doc, startPoint, endPoint){
  var endNode, endOffset, node, output, startNode, startOffset, str, text;
  output = new DocHelper$NodeOffset_0;
  getNodeAfterOutwards(doc, startPoint, output);
  startNode = output.node;
  startOffset = output.offset;
  getNodeAfterOutwards(doc, endPoint, output);
  endNode = output.node;
  endOffset = output.offset;
  if (startNode == null) {
    return '';
  }
  text = doc.asText_0(startNode);
  if (doc.isSameNode(startNode, endNode)) {
    return text == null?'':$substring_0(doc.getData(text), startOffset, endOffset);
  }
  str = new StringBuilder_0;
  text != null && $append_11(str, $substring(doc.getData(text), startOffset));
  node = getNextOrPrevNodeDepthFirst_1(doc, startNode, null, true, true);
  while ((node == null?null:node) !== (endNode == null?null:endNode)) {
    text = doc.asText_0(node);
    text != null && $append_11(str, doc.getData(text));
    node = getNextOrPrevNodeDepthFirst_1(doc, node, null, true, true);
  }
  text = doc.asText_0(node);
  text != null && $append_11(str, doc.getData(text).substr(0, endOffset - 0));
  return str.impl.string;
}

function DocHelper$NodeOffset_0(){
}

function DocHelper$NodeOffset(){
}

_ = DocHelper$NodeOffset_0.prototype = DocHelper$NodeOffset.prototype = new Object_0;
_.getClass$ = function getClass_1366(){
  return Lorg_waveprotocol_wave_model_document_util_DocHelper$NodeOffset_2_classLit;
}
;
_.castableTypeMap$ = {};
_.node = null;
_.offset = 0;
function $clinit_2098(){
  $clinit_2098 = nullMethod;
  FORWARD_DEPTH_FIRST_ITERATOR = new DocIterate$DeepIteratorFilter_0(true);
  new DocIterate$DeepIteratorFilter_0(false);
  FORWARD_DEPTH_FIRST_ELEMENT_ITERATOR = new DocIterate$ElementFilter_0(true);
  REVERSE_DEPTH_FIRST_ELEMENT_ITERATOR = new DocIterate$ElementFilter_0(false);
}

function iterate(doc, startNode, stopAt, iterateFunction){
  $clinit_2098();
  return new DocIterate$1_0(startNode, iterateFunction, doc, stopAt);
}

var FORWARD_DEPTH_FIRST_ELEMENT_ITERATOR, FORWARD_DEPTH_FIRST_ITERATOR, REVERSE_DEPTH_FIRST_ELEMENT_ITERATOR;
function $iterator_17(this$static){
  return new DocIterate$1$1_0(this$static.val$startNode, this$static.val$iterateFunction, this$static.val$doc, this$static.val$stopAt);
}

function DocIterate$1_0(val$startNode, val$iterateFunction, val$doc, val$stopAt){
  this.val$startNode = val$startNode;
  this.val$iterateFunction = val$iterateFunction;
  this.val$doc = val$doc;
  this.val$stopAt = val$stopAt;
}

function DocIterate$1(){
}

_ = DocIterate$1_0.prototype = DocIterate$1.prototype = new Object_0;
_.getClass$ = function getClass_1367(){
  return Lorg_waveprotocol_wave_model_document_util_DocIterate$1_2_classLit;
}
;
_.iterator_0 = function iterator_28(){
  return new DocIterate$1$1_0(this.val$startNode, this.val$iterateFunction, this.val$doc, this.val$stopAt);
}
;
_.castableTypeMap$ = {};
_.val$doc = null;
_.val$iterateFunction = null;
_.val$startNode = null;
_.val$stopAt = null;
function $next_24(this$static){
  var currentNode;
  currentNode = this$static.next;
  this$static.next = this$static.val$iterateFunction.next_1(this$static.val$doc, currentNode, this$static.val$stopAt);
  return this$static.val$iterateFunction.value_1(this$static.val$doc, currentNode);
}

function DocIterate$1$1_0(val$startNode, val$iterateFunction, val$doc, val$stopAt){
  this.val$startNode = val$startNode;
  this.val$iterateFunction = val$iterateFunction;
  this.val$doc = val$doc;
  this.val$stopAt = val$stopAt;
  this.next = this.val$startNode;
}

function DocIterate$1$1(){
}

_ = DocIterate$1$1_0.prototype = DocIterate$1$1.prototype = new Object_0;
_.getClass$ = function getClass_1368(){
  return Lorg_waveprotocol_wave_model_document_util_DocIterate$1$1_2_classLit;
}
;
_.hasNext = function hasNext_22(){
  return this.next != null;
}
;
_.next_0 = function next_30(){
  return $next_24(this);
}
;
_.remove_1 = function remove_59(){
  throw new UnsupportedOperationException_1('remove');
}
;
_.castableTypeMap$ = {};
_.val$doc = null;
_.val$iterateFunction = null;
_.val$startNode = null;
_.val$stopAt = null;
function DocIterate$DeepIteratorFilter_0(rightwards){
  this.rightwards = rightwards;
}

function DocIterate$DeepIteratorFilter(){
}

_ = DocIterate$DeepIteratorFilter_0.prototype = DocIterate$DeepIteratorFilter.prototype = new Object_0;
_.getClass$ = function getClass_1369(){
  return Lorg_waveprotocol_wave_model_document_util_DocIterate$DeepIteratorFilter_2_classLit;
}
;
_.next_1 = function next_31(doc, current, stopAt){
  return getNextOrPrevNodeDepthFirst_1(doc, current, stopAt, true, this.rightwards);
}
;
_.value_1 = function value_57(doc, node){
  return node;
}
;
_.castableTypeMap$ = {};
_.rightwards = false;
function DocIterate$ElementFilter_0(rightwards){
  this.rightwards = rightwards;
}

function DocIterate$ElementFilter(){
}

_ = DocIterate$ElementFilter_0.prototype = DocIterate$ElementFilter.prototype = new DocIterate$DeepIteratorFilter;
_.getClass$ = function getClass_1370(){
  return Lorg_waveprotocol_wave_model_document_util_DocIterate$ElementFilter_2_classLit;
}
;
_.next_1 = function next_32(doc, current, stopAt){
  var next;
  next = getNextOrPrevNodeDepthFirst_1(doc, current, stopAt, true, this.rightwards);
  while (next != null && doc.asElement_0(next) == null) {
    next = getNextOrPrevNodeDepthFirst_1(doc, next, stopAt, true, this.rightwards);
  }
  return next;
}
;
_.value_1 = function value_58(doc, node){
  var ret;
  ret = doc.asElement_0(node);
  return ret;
}
;
_.castableTypeMap$ = {};
function $clinit_2104(){
  $clinit_2104 = nullMethod;
  attrNameScrubber = new DocOpScrub$1_0;
  annotationKeyScrubber = new DocOpScrub$2_0;
}

function scrub_0(op){
  var annotationNames, attrNames, op_0;
  $clinit_2104();
  var $e0, b, e;
  try {
    b = new DocOpBuffer_0;
    op.apply_8((attrNames = new DocOpScrub$ScrubCache_0(attrNameScrubber) , annotationNames = new DocOpScrub$ScrubCache_0(annotationKeyScrubber) , new DocOpScrub$3_0(b, attrNames, annotationNames)));
    return new BufferedDocOpImpl_0(dynamicCast($toArray_1(b.accu, ($clinit_2033() , EMPTY_ARRAY_1)), 228));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 21)) {
      e = $e0;
      return op_0 = new BufferedDocOpImpl_0(dynamicCast($toArray_1($characters_3(new DocOpBuilder_0, 'Scrub exploded: ' + e).accu, ($clinit_2035() , EMPTY_ARRAY_2)), 228)) , checkWellformedness(op_0) , op_0;
    }
     else 
      throw $e0;
  }
}

function scrubAnnotationBoundary(unscrubbed, nameScrubber){
  $clinit_2104();
  var changeTriplets, ends, i;
  ends = initDim(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, unscrubbed.endSize(), 0);
  changeTriplets = initDim(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, unscrubbed.changeSize() * 3, 0);
  for (i = 0; i < unscrubbed.endSize(); ++i) {
    ends[i] = $scrubUniquely(nameScrubber, unscrubbed.getEndKey_0(i));
  }
  for (i = 0; i < unscrubbed.changeSize(); ++i) {
    changeTriplets[i * 3] = $scrubUniquely(nameScrubber, unscrubbed.getChangeKey_0(i));
    changeTriplets[i * 3 + 1] = scrubMostString(unscrubbed.getOldValue(i));
    changeTriplets[i * 3 + 2] = scrubMostString(unscrubbed.getNewValue(i));
  }
  return new DocOpScrub$UncheckedAnnotationBoundary_0(changeTriplets, ends);
}

function scrubAttributes(unscrubbed, nameScrubber){
  var sorted;
  $clinit_2104();
  var entry, entry$iterator, list;
  list = new ArrayList_0;
  for (entry$iterator = new ImmutableStateMap$1$1_0(unscrubbed.entrySet); entry$iterator.iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.iterator.next_0(), 394);
    $add_9(list, new ImmutableStateMap$Attribute_1($scrubUniquely(nameScrubber, entry.name_0), scrubMostString(entry.value_0)));
  }
  return $clinit_2023() , sorted = new ArrayList_1(list) , sort_2(sorted, comparator) , new AttributesImpl_2(sorted);
}

function scrubAttributesUpdate(unscrubbed, nameScrubber){
  var sorted;
  $clinit_2104();
  var i, list;
  list = new ArrayList_0;
  for (i = 0; i < unscrubbed.updates.size_1(); ++i) {
    $add_9(list, new ImmutableUpdateMap$AttributeUpdate_0($scrubUniquely(nameScrubber, dynamicCast(unscrubbed.updates.get_0(i), 384).name_0), scrubMostString(dynamicCast(unscrubbed.updates.get_0(i), 384).oldValue), scrubMostString(dynamicCast(unscrubbed.updates.get_0(i), 384).newValue)));
  }
  return $clinit_2030() , sorted = new ArrayList_1(list) , sort_2(sorted, comparator_0) , new AttributesUpdateImpl_2(sorted);
}

function scrubChar(c, scrubValid){
  $clinit_2376();
  if (55296 <= c && c <= 57343) {
    return 55296 <= c && c <= 56319?60:62;
  }
  switch (isCodePointGoodForBlip(c).ordinal) {
    case 0:
      return scrubValid?c <= 127?97:c <= 255?98:c <= 383?99:c <= 591?100:11360 <= c && c <= 11391?101:42784 <= c && c <= 43007?102:c <= 687?73:c <= 767?83:c <= 879?58:c <= 1023?968:c <= 1327?1071:c <= 1423?1364:c <= 1535?72:c <= 1791?65:2304 <= c && c <= 2431?68:3584 <= c && c <= 3711?84:4352 <= c && c <= 4607?75:8352 <= c && c <= 11263?37:11904 <= c && c <= 12031 || 12288 <= c && c <= 12351 || 12800 <= c && c <= 40959?25105:12352 <= c && c <= 12543?74:63:c;
    case 3:
      return 124;
    case 1:
      return 94;
    case 5:
      return 33;
    default:return 35;
  }
}

function scrubMostAnnotationKey(unscrubbed){
  $clinit_2104();
  var i, parts;
  parts = $split(unscrubbed, '/', -1);
  new StringBuilder_0;
  for (i = 0; i < parts.length; ++i) {
    parts[i] = scrubMostString(parts[i]);
  }
  return join_0(parts);
}

function scrubMostString(unscrubbed){
  $clinit_2104();
  var index, parts;
  if (unscrubbed == null) {
    return null;
  }
  index = unscrubbed.indexOf(fromCodePoint(64));
  if (index != -1 && unscrubbed.lastIndexOf(fromCodePoint(64)) == index) {
    parts = $split(unscrubbed, '@', 2);
    return scrubString(parts[0], true) + '@' + scrubString(parts[1], true);
  }
   else 
    return unscrubbed.length >= 3?scrubString(unscrubbed.substr(0, 3 - 0), false) + scrubString(unscrubbed.substr(3, unscrubbed.length - 3), true):unscrubbed;
}

function scrubString(unscrubbed, scrubValidChars){
  $clinit_2104();
  var chars, i;
  chars = initDim(_3C_classLit, {9:1}, -1, unscrubbed.length, 1);
  for (i = 0; i < unscrubbed.length; ++i) {
    chars[i] = scrubChar(unscrubbed.charCodeAt(i), scrubValidChars);
  }
  return String.fromCharCode.apply(null, chars);
}

var annotationKeyScrubber, attrNameScrubber;
function DocOpScrub$1_0(){
}

function DocOpScrub$1(){
}

_ = DocOpScrub$1_0.prototype = DocOpScrub$1.prototype = new Object_0;
_.getClass$ = function getClass_1371(){
  return Lorg_waveprotocol_wave_model_document_util_DocOpScrub$1_2_classLit;
}
;
_.scrub = function scrub_1(input){
  return scrubMostString(input);
}
;
_.castableTypeMap$ = {};
function DocOpScrub$2_0(){
}

function DocOpScrub$2(){
}

_ = DocOpScrub$2_0.prototype = DocOpScrub$2.prototype = new Object_0;
_.getClass$ = function getClass_1372(){
  return Lorg_waveprotocol_wave_model_document_util_DocOpScrub$2_2_classLit;
}
;
_.scrub = function scrub_2(input){
  return scrubMostAnnotationKey(input);
}
;
_.castableTypeMap$ = {};
function DocOpScrub$3_0(val$target, val$attrNames, val$annotationNames){
  this.val$target = val$target;
  this.val$attrNames = val$attrNames;
  this.val$annotationNames = val$annotationNames;
}

function DocOpScrub$3(){
}

_ = DocOpScrub$3_0.prototype = DocOpScrub$3.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_20(map){
  $add_9(this.val$target.accu, new OperationComponents$AnnotationBoundary_0(scrubAnnotationBoundary(map, this.val$annotationNames)));
}
;
_.characters_0 = function characters_29(chars){
  $add_9(this.val$target.accu, new OperationComponents$Characters_0(($clinit_2104() , scrubString(chars, true))));
}
;
_.deleteCharacters = function deleteCharacters_31(chars){
  $add_9(this.val$target.accu, new OperationComponents$DeleteCharacters_0(($clinit_2104() , scrubString(chars, true))));
}
;
_.deleteElementEnd = function deleteElementEnd_29(){
  $add_9(this.val$target.accu, ($clinit_2051() , INSTANCE_15));
}
;
_.deleteElementStart = function deleteElementStart_29(type, attrs){
  $add_9(this.val$target.accu, new OperationComponents$DeleteElementStart_0(type, scrubAttributes(attrs, this.val$attrNames)));
}
;
_.elementEnd = function elementEnd_26(){
  $add_9(this.val$target.accu, ($clinit_2053() , INSTANCE_16));
}
;
_.elementStart = function elementStart_26(type, attrs){
  $add_9(this.val$target.accu, new OperationComponents$ElementStart_0(type, scrubAttributes(attrs, this.val$attrNames)));
}
;
_.getClass$ = function getClass_1373(){
  return Lorg_waveprotocol_wave_model_document_util_DocOpScrub$3_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_31(oldAttrs, newAttrs){
  $add_9(this.val$target.accu, new OperationComponents$ReplaceAttributes_0(scrubAttributes(oldAttrs, this.val$attrNames), scrubAttributes(newAttrs, this.val$attrNames)));
}
;
_.retain = function retain_27(itemCount){
  $add_9(this.val$target.accu, new OperationComponents$Retain_0(itemCount));
}
;
_.updateAttributes = function updateAttributes_31(attrUpdate){
  $add_9(this.val$target.accu, new OperationComponents$UpdateAttributes_0(scrubAttributesUpdate(attrUpdate, this.val$attrNames)));
}
;
_.castableTypeMap$ = {};
_.val$annotationNames = null;
_.val$attrNames = null;
_.val$target = null;
function $scrubUniquely(this$static, input){
  var bareScrubbed, scrubbed;
  if (this$static.alreadyScrubbed.containsKey_1(input)) {
    return dynamicCast(this$static.alreadyScrubbed.get_4(input), 1);
  }
  bareScrubbed = this$static.format.scrub(input);
  scrubbed = bareScrubbed;
  while (this$static.scrubbings.contains_0(scrubbed)) {
    scrubbed = bareScrubbed + '_' + ++this$static.uniqueSuffix;
  }
  this$static.alreadyScrubbed.put_3(input, scrubbed);
  this$static.scrubbings.add_3(scrubbed);
  return scrubbed;
}

function DocOpScrub$ScrubCache_0(format){
  this.alreadyScrubbed = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  this.scrubbings = defaultCollectionFactory.createStringSet();
  this.format = format;
}

function DocOpScrub$ScrubCache(){
}

_ = DocOpScrub$ScrubCache_0.prototype = DocOpScrub$ScrubCache.prototype = new Object_0;
_.getClass$ = function getClass_1374(){
  return Lorg_waveprotocol_wave_model_document_util_DocOpScrub$ScrubCache_2_classLit;
}
;
_.castableTypeMap$ = {};
_.format = null;
_.uniqueSuffix = 0;
function $copy_0(input){
  var i, ret;
  ret = initDim(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, input.length, 0);
  for (i = 0; i < input.length; ++i) {
    ret[i] = input[i];
  }
  return ret;
}

function DocOpScrub$UncheckedAnnotationBoundary_0(triplets, ends){
  var i;
  checkArgument_2(triplets.length % 3 == 0, 'triplets.length not a multiple of 3');
  this.ends = $copy_0(ends);
  sort(this.ends);
  this.changes = initDim(_3Lorg_waveprotocol_wave_model_document_util_DocOpScrub$UncheckedAnnotationBoundary$Triplet_2_classLit, {9:1, 68:1}, 153, ~~(triplets.length / 3), 0);
  for (i = 0; i < triplets.length; i += 3) {
    this.changes[~~(i / 3)] = new DocOpScrub$UncheckedAnnotationBoundary$Triplet_0(triplets[i], triplets[i + 1], triplets[i + 2]);
  }
  sort(this.changes);
}

function DocOpScrub$UncheckedAnnotationBoundary(){
}

_ = DocOpScrub$UncheckedAnnotationBoundary_0.prototype = DocOpScrub$UncheckedAnnotationBoundary.prototype = new Object_0;
_.changeSize = function changeSize_4(){
  return this.changes.length;
}
;
_.endSize = function endSize_4(){
  return this.ends.length;
}
;
_.getChangeKey_0 = function getChangeKey_5(i){
  return this.changes[i].key;
}
;
_.getClass$ = function getClass_1375(){
  return Lorg_waveprotocol_wave_model_document_util_DocOpScrub$UncheckedAnnotationBoundary_2_classLit;
}
;
_.getEndKey_0 = function getEndKey_5(i){
  return this.ends[i];
}
;
_.getNewValue = function getNewValue_3(i){
  return this.changes[i].newVal;
}
;
_.getOldValue = function getOldValue_3(i){
  return this.changes[i].oldVal;
}
;
_.castableTypeMap$ = {409:1};
_.changes = null;
_.ends = null;
function DocOpScrub$UncheckedAnnotationBoundary$Triplet_0(key, oldVal, newVal){
  checkNotNull_1(key, 'triplet key');
  this.key = key;
  this.oldVal = oldVal;
  this.newVal = newVal;
}

function DocOpScrub$UncheckedAnnotationBoundary$Triplet(){
}

_ = DocOpScrub$UncheckedAnnotationBoundary$Triplet_0.prototype = DocOpScrub$UncheckedAnnotationBoundary$Triplet.prototype = new Object_0;
_.compareTo$ = function compareTo_12(o){
  return compareTo_5(this.key, dynamicCast(o, 153).key);
}
;
_.getClass$ = function getClass_1376(){
  return Lorg_waveprotocol_wave_model_document_util_DocOpScrub$UncheckedAnnotationBoundary$Triplet_2_classLit;
}
;
_.castableTypeMap$ = {10:1, 153:1};
_.key = null;
_.newVal = null;
_.oldVal = null;
function $clinit_2112(){
  $clinit_2112 = nullMethod;
  $clinit_1838();
}

function DocumentImpl_0(sequencer, document_0){
  this.sequencer = sequencer;
  this.doc = document_0;
  checkArgument_2(instanceOf(document_0.substrate.getDocumentElement(), 260), 'Document and sequencer must be for nodes of the Doc.* variety');
}

function DocumentImpl(){
}

_ = DocumentImpl_0.prototype = DocumentImpl.prototype = new MutableDocumentImpl;
_.getClass$ = function getClass_1377(){
  return Lorg_waveprotocol_wave_model_document_util_DocumentImpl_2_classLit;
}
;
_.castableTypeMap$ = {19:1};
function buildDomInitializationFromElement(doc, element, cursor){
  var child;
  cursor.elementStart(doc.getTagName(element), new AttributesImpl_1(doc.getAttributes(element)));
  for (child = doc.getFirstChild_0(element); child != null; child = doc.getNextSibling(child)) {
    buildDomInitializationFromSubtree(doc, child, cursor);
  }
  cursor.elementEnd();
}

function buildDomInitializationFromSubtree(doc, node, cursor){
  var text;
  text = doc.asText_0(node);
  text == null?buildDomInitializationFromElement(doc, doc.asElement_0(node), cursor):cursor.characters_0(doc.getData(text));
}

function $clinit_2119(){
  var op, op_0;
  $clinit_2119 = nullMethod;
  EMPTY_DOCUMENT_0 = asInitialization((op = new BufferedDocOpImpl_0(dynamicCast($toArray_1((new DocInitializationBuilder_0).accu, ($clinit_2032() , EMPTY_ARRAY_0)), 228)) , checkWellformedness(op) , op));
  op_0 = new BufferedDocOpImpl_0(dynamicCast($toArray_1((new DocOpBuilder_0).accu, ($clinit_2035() , EMPTY_ARRAY_2)), 228));
  checkWellformedness(op_0);
}

var EMPTY_DOCUMENT_0;
function FilterProduct_0(filters){
  FilteredView_0.call(this, argumentCheck(filters));
  this.filters = filters;
}

function argumentCheck(filters){
  var i;
  for (i = 1; i < filters.length; ++i) {
  }
  return filters[0].inner_0;
}

function FilterProduct(){
}

_ = FilterProduct_0.prototype = FilterProduct.prototype = new FilteredView;
_.getClass$ = function getClass_1378(){
  return Lorg_waveprotocol_wave_model_document_util_FilterProduct_2_classLit;
}
;
_.getSkipLevel = function getSkipLevel_3(node){
  var i, levels;
  levels = initDim(_3Lorg_waveprotocol_wave_model_document_util_FilteredView$Skip_2_classLit, {9:1, 68:1, 170:1}, 154, this.filters.length, 0);
  for (i = 0; i < this.filters.length; ++i) {
    levels[i] = this.filters[i].getSkipLevel(node);
  }
  return $resolveSkip(dynamicCast(node, 197), levels);
}
;
_.castableTypeMap$ = {19:1, 20:1, 155:1, 156:1};
_.filters = null;
function $clinit_2121(){
  $clinit_2121 = nullMethod;
  NONE_5 = new FilteredView$Skip_0('NONE', 0);
  SHALLOW = new FilteredView$Skip_0('SHALLOW', 1);
  DEEP = new FilteredView$Skip_0('DEEP', 2);
  INVALID = new FilteredView$Skip_0('INVALID', 3);
  $VALUES_71 = initValues(_3Lorg_waveprotocol_wave_model_document_util_FilteredView$Skip_2_classLit, {9:1, 68:1, 170:1}, 154, [NONE_5, SHALLOW, DEEP, INVALID]);
}

function FilteredView$Skip_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_78(name_0){
  $clinit_2121();
  return valueOf_0(($clinit_2122() , $MAP_71), name_0);
}

function values_72(){
  $clinit_2121();
  return $VALUES_71;
}

function FilteredView$Skip(){
}

_ = FilteredView$Skip_0.prototype = FilteredView$Skip.prototype = new Enum;
_.getClass$ = function getClass_1379(){
  return Lorg_waveprotocol_wave_model_document_util_FilteredView$Skip_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 154:1};
var $VALUES_71, DEEP, INVALID, NONE_5, SHALLOW;
function $clinit_2122(){
  $clinit_2122 = nullMethod;
  $MAP_71 = createValueOfMap(($clinit_2121() , $VALUES_71));
}

var $MAP_71;
function $isOrdered_0(this$static){
  return this$static.anchor <= this$static.focus_0;
}

function FocusedRange_0(anchor, focus_0){
  (anchor < 0 || focus_0 < 0) && illegalArgument('Bad focused range: (' + anchor + ', ' + focus_0 + ')');
  this.anchor = anchor;
  this.focus_0 = focus_0;
}

function FocusedRange(){
}

_ = FocusedRange_0.prototype = FocusedRange.prototype = new Object_0;
_.equals$ = function equals_55(obj){
  var other;
  if (this === obj)
    return true;
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[209]))
    return false;
  other = dynamicCast(obj, 209);
  if (this.focus_0 != other.focus_0)
    return false;
  if (this.anchor != other.anchor)
    return false;
  return true;
}
;
_.getClass$ = function getClass_1380(){
  return Lorg_waveprotocol_wave_model_document_util_FocusedRange_2_classLit;
}
;
_.hashCode$ = function hashCode_54(){
  return this.anchor + 37 * this.focus_0;
}
;
_.toString$ = function toString_116(){
  return 'FocusedRange(' + this.anchor + (this.anchor == this.focus_0?'':'->' + this.focus_0) + ')';
}
;
_.castableTypeMap$ = {209:1};
_.anchor = 0;
_.focus_0 = 0;
_.range = null;
function $advance_1(this$static, keyLocation){
  var val;
  val = $getAnnotation(this$static.annotations.fullAnnotationSet, keyLocation.location_0, keyLocation.key);
  keyLocation.location_0 = $firstAnnotationChange(this$static.annotations.fullAnnotationSet, keyLocation.location_0, this$static.end, keyLocation.key, val);
  keyLocation.location_0 != -1 && $add_8(this$static.locations, keyLocation);
}

function $nextLocation(this$static){
  var currentKeys, keyLocation;
  if (this$static.locations.heap.size_0 == 0) {
    throw new NoSuchElementException_0;
  }
  currentKeys = ($clinit_2309() , defaultCollectionFactory.createStringSet());
  this$static.currentLocation = dynamicCast($peek_0(this$static.locations), 438).location_0;
  do {
    keyLocation = dynamicCast($remove_11(this$static.locations), 438);
    currentKeys.add_3(keyLocation.key);
    $advance_1(this$static, keyLocation);
  }
   while (this$static.locations.heap.size_0 != 0 && dynamicCast($peek_0(this$static.locations), 438).location_0 == this$static.currentLocation);
  return currentKeys;
}

function GenericAnnotationCursor_0(annotations, start, end, keys){
  this.locations = new PriorityQueue_0;
  checkPositionIndexesInRange(start, end, annotations.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1);
  checkNotNull_1(keys, 'GenericAnnotationCursor: Key set must not be null');
  this.annotations = annotations;
  this.end = end;
  keys.each_3(new GenericAnnotationCursor$1_0(this, start));
  this.currentLocation = this.locations.heap.size_0 == 0?-1:start;
}

function GenericAnnotationCursor(){
}

_ = GenericAnnotationCursor_0.prototype = GenericAnnotationCursor.prototype = new Object_0;
_.getClass$ = function getClass_1381(){
  return Lorg_waveprotocol_wave_model_document_util_GenericAnnotationCursor_2_classLit;
}
;
_.castableTypeMap$ = {};
_.annotations = null;
_.currentLocation = 0;
_.end = 0;
function GenericAnnotationCursor$1_0(this$0, val$start){
  this.this$0 = this$0;
  this.val$start = val$start;
}

function GenericAnnotationCursor$1(){
}

_ = GenericAnnotationCursor$1_0.prototype = GenericAnnotationCursor$1.prototype = new Object_0;
_.apply_4 = function apply_130(key){
  $advance_1(this.this$0, new GenericAnnotationCursor$KeyLocation_0(key, this.val$start));
}
;
_.getClass$ = function getClass_1382(){
  return Lorg_waveprotocol_wave_model_document_util_GenericAnnotationCursor$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
_.val$start = 0;
function GenericAnnotationCursor$KeyLocation_0(key, initialLocation){
  this.key = key;
  this.location_0 = initialLocation;
}

function GenericAnnotationCursor$KeyLocation(){
}

_ = GenericAnnotationCursor$KeyLocation_0.prototype = GenericAnnotationCursor$KeyLocation.prototype = new Object_0;
_.compareTo$ = function compareTo_13(other){
  return this.location_0 - dynamicCast(other, 438).location_0;
}
;
_.getClass$ = function getClass_1383(){
  return Lorg_waveprotocol_wave_model_document_util_GenericAnnotationCursor$KeyLocation_2_classLit;
}
;
_.castableTypeMap$ = {10:1, 438:1};
_.key = null;
_.location_0 = 0;
function $iterator_18(this$static){
  return new GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator_0(this$static.a_0, this$static.start, this$static.end, this$static.keys);
}

function GenericAnnotationIntervalIterable_0(a_0, start, end, keys){
  this.a_0 = a_0;
  this.start = start;
  this.end = end;
  this.keys = keys;
}

function GenericAnnotationIntervalIterable(){
}

_ = GenericAnnotationIntervalIterable_0.prototype = GenericAnnotationIntervalIterable.prototype = new Object_0;
_.getClass$ = function getClass_1384(){
  return Lorg_waveprotocol_wave_model_document_util_GenericAnnotationIntervalIterable_2_classLit;
}
;
_.iterator_0 = function iterator_29(){
  return new GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator_0(this.a_0, this.start, this.end, this.keys);
}
;
_.castableTypeMap$ = {};
_.a_0 = null;
_.end = 0;
_.keys = null;
_.start = 0;
function $next_26(this$static){
  var entry, key, nextIntervalStart, thisIntervalStart, value;
  if (!(this$static.first || this$static.entries.heap.size_0 != 0)) {
    throw new NoSuchElementException_1('No more intervals');
  }
  thisIntervalStart = this$static.intervalStart;
  if (this$static.first) {
    this$static.entries.heap.size_0 == 0?(nextIntervalStart = this$static.end):(nextIntervalStart = dynamicCast($peek_0(this$static.entries), 439).nextChange);
    this$static.first = false;
  }
   else {
    this$static.diffFromLeft.clear();
    do {
      entry = dynamicCast($remove_11(this$static.entries), 439);
      key = entry.key;
      value = this$static.set.getAnnotation(thisIntervalStart, key);
      this$static.diffFromLeft.put_3(key, value);
      this$static.annotationsHere.put_3(key, value);
      entry.nextChange = this$static.set.firstAnnotationChange(thisIntervalStart + 1, this$static.end, key, value);
      entry.nextChange != -1 && $add_8(this$static.entries, entry);
    }
     while (this$static.entries.heap.size_0 != 0 && dynamicCast($peek_0(this$static.entries), 439).nextChange == thisIntervalStart);
    this$static.entries.heap.size_0 == 0?(nextIntervalStart = this$static.end):(nextIntervalStart = dynamicCast($peek_0(this$static.entries), 439).nextChange);
  }
  !this$static.interval?(this$static.interval = new AnnotationIntervalImpl_0(thisIntervalStart, nextIntervalStart, this$static.annotationsHere, this$static.diffFromLeft)):$set_9(this$static.interval, thisIntervalStart, nextIntervalStart, this$static.annotationsHere, this$static.diffFromLeft);
  this$static.intervalStart = nextIntervalStart;
  return this$static.interval;
}

function GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator_0(set, start, end, keys){
  this.entries = new PriorityQueue_0;
  checkPositionIndexesInRange(start, end, set.size_1());
  checkNotNull_1(keys, 'GenericAnnotationIntervalIterator: Key set must not be null');
  this.set = set;
  this.end = end;
  this.annotationsHere = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  this.diffFromLeft = defaultCollectionFactory.createStringMap();
  this.intervalStart = start;
  if (start >= end) {
    this.first = false;
    return;
  }
  keys.each_3(new GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$1_0(this, set, start, end));
}

function GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator(){
}

_ = GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator_0.prototype = GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator.prototype = new Object_0;
_.getClass$ = function getClass_1385(){
  return Lorg_waveprotocol_wave_model_document_util_GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator_2_classLit;
}
;
_.hasNext = function hasNext_23(){
  return this.first || this.entries.heap.size_0 != 0;
}
;
_.next_0 = function next_33(){
  return $next_26(this);
}
;
_.remove_1 = function remove_60(){
  throw new UnsupportedOperationException_1('Removing an annotation interval is not supported');
}
;
_.castableTypeMap$ = {};
_.annotationsHere = null;
_.diffFromLeft = null;
_.end = 0;
_.first = true;
_.interval = null;
_.intervalStart = 0;
_.set = null;
function GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$1_0(this$1, val$set, val$start, val$end){
  this.this$1 = this$1;
  this.val$set = val$set;
  this.val$start = val$start;
  this.val$end = val$end;
}

function GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$1(){
}

_ = GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$1_0.prototype = GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$1.prototype = new Object_0;
_.apply_4 = function apply_131(key){
  var nextChange, startValue, valueLeft;
  startValue = this.val$set.getAnnotation(this.val$start, key);
  this.val$start == 0?(valueLeft = null):(valueLeft = this.val$set.getAnnotation(this.val$start - 1, key));
  if (valueLeft == null?startValue == null:equals__devirtual$(valueLeft, startValue))
  ;
  else {
    this.this$1.diffFromLeft.put_3(key, startValue);
  }
  this.this$1.annotationsHere.put_3(key, startValue);
  nextChange = this.val$set.firstAnnotationChange(this.val$start, this.val$end, key, startValue);
  if (nextChange == -1)
  ;
  else {
    $add_8(this.this$1.entries, new GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$KeyEntry_0(key, nextChange));
  }
}
;
_.getClass$ = function getClass_1386(){
  return Lorg_waveprotocol_wave_model_document_util_GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$1 = null;
_.val$end = 0;
_.val$set = null;
_.val$start = 0;
function GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$KeyEntry_0(key, nextChange){
  this.key = key;
  this.nextChange = nextChange;
}

function GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$KeyEntry(){
}

_ = GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$KeyEntry_0.prototype = GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$KeyEntry.prototype = new Object_0;
_.compareTo$ = function compareTo_14(other){
  return this.nextChange - dynamicCast(other, 439).nextChange;
}
;
_.getClass$ = function getClass_1387(){
  return Lorg_waveprotocol_wave_model_document_util_GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$KeyEntry_2_classLit;
}
;
_.castableTypeMap$ = {10:1, 439:1};
_.key = null;
_.nextChange = 0;
function $clinit_2135(){
  $clinit_2135 = nullMethod;
  lineContainerTagnames = new HashSet_0;
}

function appendLine(doc, content_0, attributes){
  $clinit_2135();
  var el, el$iterator, lc, line;
  checkArgument_2(!isUnsupportedParagraphDocument(doc), 'Paragraph docs no longer supported');
  lc = null;
  for (el$iterator = ($clinit_2098() , $iterator_17(iterate(doc, doc.doc.substrate.getDocumentElement(), null, REVERSE_DEPTH_FIRST_ELEMENT_ITERATOR))); el$iterator.next != null;) {
    el = $next_24(el$iterator);
    if (isLineContainer(doc, el)) {
      lc = el;
      break;
    }
  }
  if (lc == null) {
    lc = $appendXml(doc, $wrap_2($wrap_2(new XmlStringBuilderDoc_0(null, ($clinit_2011() , ANY)), 'line'), (checkState_2(topLevelContainerTagname != null, 'Top level line container tag name not set!') , topLevelContainerTagname)));
    !!content_0 && content_0.length_0 > 0 && $insertXml(doc, new Point$El_0(lc, null), content_0);
    line = $asElement_0(doc, doc.doc.substrate.getFirstChild_0(lc));
    !!attributes && $setElementAttributes(doc, line, attributes);
    return line;
  }
   else {
    return appendLine_0(doc, lc, content_0, attributes);
  }
}

function appendLine_0(doc, lineContainer, content_0, attributes){
  $clinit_2135();
  var line;
  line = $createElement_1(doc, new Point$El_0(lineContainer, null), 'line', attributes);
  !!content_0 && content_0.length_0 > 0 && $insertXml(doc, new Point$El_0(lineContainer, null), content_0);
  return line;
}

function isLineContainer(doc, node){
  $clinit_2135();
  var el;
  el = doc.asElement_0(node);
  return el != null && lineContainerTagnames.map.containsKey(doc.getTagName(el));
}

function isUnsupportedParagraphDocument(doc){
  var el;
  $clinit_2135();
  var child, root;
  if ($getFirstChild_1(doc, doc.doc.substrate.getDocumentElement()) == null) {
    return false;
  }
  root = doc.doc.substrate.getDocumentElement();
  for (child = doc.doc.substrate.getFirstChild_0(root); child != null; child = doc.doc.substrate.getNextSibling(child)) {
    if (el = doc.doc.substrate.asElement_0(child) , el != null && $equals_3(doc.doc.substrate.getTagName(el), 'p')) {
      return true;
    }
  }
  return false;
}

var lineContainerTagnames, topLevelContainerTagname = null;
function MutableDocumentProxy$DocumentProxy(){
}

_ = MutableDocumentProxy$DocumentProxy.prototype = new MutableDocumentProxy;
_.getClass$ = function getClass_1394(){
  return Lorg_waveprotocol_wave_model_document_util_MutableDocumentProxy$DocumentProxy_2_classLit;
}
;
_.castableTypeMap$ = {19:1};
function PersistentContent$HardContent_0(this$0){
  this.this$0 = this$0;
  FilteredView_0.call(this, this$0.fullDoc);
}

function PersistentContent$HardContent(){
}

_ = PersistentContent$HardContent_0.prototype = PersistentContent$HardContent.prototype = new FilteredView;
_.getClass$ = function getClass_1395(){
  return Lorg_waveprotocol_wave_model_document_util_PersistentContent$HardContent_2_classLit;
}
;
_.getSkipLevel = function getSkipLevel_4(node){
  var element;
  element = this.inner_0.asElement_0(node);
  return element == null || $isHard(this.this$0, element)?($clinit_2121() , NONE_5):$getSkipLevel_0(this.this$0, node);
}
;
_.castableTypeMap$ = {19:1, 20:1, 155:1, 156:1};
_.this$0 = null;
function $equals_11(this$static, obj){
  var other;
  if (this$static === obj) {
    return true;
  }
  if (obj == null) {
    return false;
  }
  if (this$static.getClass$() != getClass__devirtual$(obj)) {
    return false;
  }
  other = dynamicCast(obj, 436);
  if (this$static.container == null) {
    if (other.container != null) {
      return false;
    }
  }
   else if (!equals__devirtual$(this$static.container, other.container)) {
    return false;
  }
  if (this$static.nodeAfter == null) {
    if (other.nodeAfter != null) {
      return false;
    }
  }
   else if (!equals__devirtual$(this$static.nodeAfter, other.nodeAfter)) {
    return false;
  }
  if (this$static.offset != other.offset) {
    return false;
  }
  return true;
}

function $getNodeAfter(this$static){
  if (this$static.offset >= 0) {
    throw new IllegalStateException_1('getNodeAfter() can only be called on points within elements');
  }
  return this$static.nodeAfter;
}

function $getTextOffset(this$static){
  if (this$static.offset < 0) {
    throw new IllegalStateException_1('getOffset() can only be called on points within text nodes');
  }
  return this$static.offset;
}

function $hashCode_9(this$static){
  var result;
  result = 31 + (this$static.container == null?0:hashCode__devirtual$(this$static.container));
  result = 31 * result + (this$static.nodeAfter == null?0:hashCode__devirtual$(this$static.nodeAfter));
  result = 31 * result + this$static.offset;
  return result;
}

function after_1(doc, node){
  return new Point$El_0(doc.getParentElement(node), doc.getNextSibling(node));
}

function before_0(doc, node){
  return new Point$El_0(doc.getParentElement(node), node);
}

function checkOffset(doc, textNode, offset, msgPrefix){
  checkNotNull_1(textNode, 'Container must not be null');
  if (offset < 0 || offset > doc.getLength(textNode)) {
    throw new IllegalArgumentException_1(msgPrefix + ": offset '" + offset + "' is not inside text node, length " + doc.getLength(textNode) + ", text: '" + doc.getData(textNode) + "'");
  }
}

function checkRelationship(doc, parent_0, nodeAfter, msgPrefix){
  checkNotNull_1(parent_0, 'Container must not be null');
  if (nodeAfter != null && maskUndefined(doc.getParentElement(nodeAfter)) !== (parent_0 == null?null:parent_0)) {
    throw new IllegalArgumentException_1(msgPrefix + ': nodeAfter must be null or a child of parent');
  }
}

function elementAfter(doc, point){
  return point.offset >= 0?$getTextOffset(point) < doc.getLength(point.container)?null:doc.asElement_0(doc.getNextSibling(point.container)):doc.asElement_0($getNodeAfter(point));
}

function elementEndingAt_1(doc, point){
  return point.offset >= 0?$getTextOffset(point) < doc.substrate.getLength(point.container)?null:doc.substrate.getNextSibling(point.container) == null?doc.substrate.getParentElement(point.container):null:$getNodeAfter(point) == null?point.container:null;
}

function enclosingElement(doc, node){
  var el;
  el = doc.asElement_0(node);
  return el == null?doc.getParentElement(node):el;
}

function nodeBefore_0(doc, point){
  var node;
  node = $getNodeAfter(point);
  return node == null?doc.getLastChild_0(point.container):doc.getPreviousSibling(node);
}

function start_5(doc, element){
  return new Point$El_0(element, doc.getFirstChild_0(element));
}

function Point(){
}

_ = Point.prototype = new Object_0;
_.equals$ = function equals_56(obj){
  return $equals_11(this, obj);
}
;
_.getClass$ = function getClass_1396(){
  return Lorg_waveprotocol_wave_model_document_util_Point_2_classLit;
}
;
_.hashCode$ = function hashCode_55(){
  return $hashCode_9(this);
}
;
_.toString$ = function toString_117(){
  return '{' + this.container + '~' + (this.offset >= 0?$getTextOffset(this) + '':$getNodeAfter(this) + '') + '}';
}
;
_.castableTypeMap$ = {436:1};
_.container = null;
_.nodeAfter = null;
_.offset = 0;
function Point$El_0(container, nodeAfter){
  checkNotNull_1(container, 'Container must not be null');
  this.container = container;
  this.nodeAfter = nodeAfter;
  this.offset = -1;
}

function Point$El(){
}

_ = Point$El_0.prototype = Point$El.prototype = new Point;
_.asElementPoint = function asElementPoint_1(){
  return this;
}
;
_.asTextPoint = function asTextPoint(){
  return null;
}
;
_.getClass$ = function getClass_1397(){
  return Lorg_waveprotocol_wave_model_document_util_Point$El_2_classLit;
}
;
_.castableTypeMap$ = {436:1};
function Point$Tx_0(container, offset){
  checkNotNull_1(container, 'Container must not be null');
  this.container = container;
  this.nodeAfter = null;
  this.offset = offset;
}

function Point$Tx(){
}

_ = Point$Tx_0.prototype = Point$Tx.prototype = new Point;
_.asElementPoint = function asElementPoint_2(){
  return null;
}
;
_.asTextPoint = function asTextPoint_0(){
  return this;
}
;
_.getClass$ = function getClass_1398(){
  return Lorg_waveprotocol_wave_model_document_util_Point$Tx_2_classLit;
}
;
_.castableTypeMap$ = {436:1};
function $appendAttributes(this$static, doc, element){
  var $e0, attribute, attribute$iterator, attributes, name_0, name$array, name$index, name$max, value;
  try {
    attributes = doc.getAttributes(element);
    for (attribute$iterator = attributes.entrySet_0().iterator_0(); attribute$iterator.hasNext();) {
      attribute = dynamicCast(attribute$iterator.next_0(), 11);
      $append_8(this$static.builder, ' ' + dynamicCast(attribute.getKey(), 1) + "='" + dynamicCast(attribute.getValue(), 1) + "'");
    }
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 183)) {
      for (name$array = initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['class', 'src', 'id', 'type', 'name', 'for', 'href', 'target']) , name$index = 0 , name$max = name$array.length; name$index < name$max; ++name$index) {
        name_0 = name$array[name$index];
        value = doc.getAttribute_0(element, name_0);
        value != null && value.length > 0 && $append_8(this$static.builder, ' ' + name_0 + "='" + value + "'");
      }
    }
     else 
      throw $e0;
  }
}

function $appendElement(this$static, doc, element){
  var child, first, firstChild, next, printEndMarker, printStartMarker, startMarker;
  printStartMarker = !!this$static.selStartEl && doc.isSameNode(this$static.selStartEl.container, element);
  printEndMarker = !!this$static.selEndEl && !this$static.collapsed && doc.isSameNode(this$static.selEndEl.container, element);
  startMarker = this$static.collapsed?'|':'[';
  firstChild = doc.getFirstChild_0(element);
  if (firstChild == null) {
    if (printStartMarker && $getNodeAfter(this$static.selStartEl) == null) {
      $appendStartTag(this$static, doc, element, false);
      $append_8(this$static.builder, startMarker);
      $append_8(this$static.builder, '<\/');
      $append_8(this$static.builder, doc.getTagName(element).toLowerCase());
      $append_8(this$static.builder, '>');
    }
     else if (printEndMarker && $getNodeAfter(this$static.selEndEl) == null) {
      $appendStartTag(this$static, doc, element, false);
      $append_8(this$static.builder, ']');
      $append_8(this$static.builder, '<\/');
      $append_8(this$static.builder, doc.getTagName(element).toLowerCase());
      $append_8(this$static.builder, '>');
    }
     else {
      $appendStartTag(this$static, doc, element, true);
    }
  }
   else {
    $appendStartTag(this$static, doc, element, false);
    child = firstChild;
    first = true;
    ++this$static.indent;
    while (child != null) {
      next = doc.getNextSibling(child);
      (first && !$isInline_0(doc, element) || !$isInline_0(doc, child)) && $appendNewLine(this$static);
      printStartMarker && doc.isSameNode($getNodeAfter(this$static.selStartEl), child) && $append_8(this$static.builder, startMarker);
      $appendNode(this$static, doc, child);
      printEndMarker && doc.isSameNode($getNodeAfter(this$static.selEndEl), next) && $append_8(this$static.builder, ']');
      first = false;
      child = next;
    }
    --this$static.indent;
    (!$isInline_0(doc, element) || !$isInline_0(doc, firstChild)) && $appendNewLine(this$static);
    $append_8(this$static.builder, '<\/');
    $append_8(this$static.builder, doc.getTagName(element).toLowerCase());
    $append_8(this$static.builder, '>');
  }
}

function $appendNewLine(this$static){
  var i;
  $append_8(this$static.builder, '\n');
  for (i = 0; i < this$static.indent; ++i) {
    $append_8(this$static.builder, '  ');
  }
}

function $appendNode(this$static, doc, node){
  var element, text, endMarker, endOffset, printEndMarker, printStartMarker, startMarker, startOffset, value;
  element = doc.asElement_0(node);
  if (element != null) {
    $appendElement(this$static, doc, element);
    return;
  }
  text = doc.asText_0(node);
  if (text != null) {
    value = $replaceAll($replaceAll(doc.getData(text), '\xA0', '\u25AA'), ' ', '\u25AB');
    printStartMarker = !!this$static.selStartTx && doc.isSameNode(this$static.selStartTx.container, text);
    printEndMarker = !!this$static.selEndTx && !this$static.collapsed && doc.isSameNode(this$static.selEndTx.container, text);
    startMarker = printStartMarker?this$static.collapsed?'|':'[':'';
    endMarker = printEndMarker?']':'';
    startOffset = printStartMarker?min_1($getTextOffset(this$static.selStartTx), value.length):0;
    endOffset = printEndMarker?min_1($getTextOffset(this$static.selEndTx), value.length):value.length;
    $append_6(this$static.builder, 39);
    $append_8(this$static.builder, value.substr(0, startOffset - 0));
    $append_8(this$static.builder, startMarker);
    $append_8(this$static.builder, value.substr(startOffset, endOffset - startOffset));
    $append_8(this$static.builder, endMarker);
    $append_8(this$static.builder, $substring_0(value, endOffset, value.length));
    $append_6(this$static.builder, 39);
    return;
  }
}

function $appendStartTag(this$static, doc, element, selfClosing){
  $append_8(this$static.builder, '<');
  $append_8(this$static.builder, doc.getTagName(element).toLowerCase());
  $appendAttributes(this$static, doc, element);
  $append_8(this$static.builder, selfClosing?'/>':'>');
}

function $isInline_0(doc, node){
  var element, text;
  element = doc.asElement_0(node);
  text = doc.asText_0(node);
  return text != null || '|b|u|i|'.indexOf('|' + doc.getTagName(element).toLowerCase() + '|') != -1;
}

function $print_0(this$static, doc, node){
  this$static.indent = 0;
  this$static.builder.impl.string.length > 0 && (this$static.builder = new StringBuilder_0);
  $appendNode(this$static, doc, node);
  return this$static.builder.impl.string;
}

function Pretty_0(){
  this.builder = new StringBuilder_0;
}

function Pretty(){
}

_ = Pretty_0.prototype = Pretty.prototype = new Object_0;
_.getClass$ = function getClass_1399(){
  return Lorg_waveprotocol_wave_model_document_util_Pretty_2_classLit;
}
;
_.castableTypeMap$ = {};
_.collapsed = false;
_.indent = 0;
_.selEndEl = null;
_.selEndTx = null;
_.selStartEl = null;
_.selStartTx = null;
function Property(){
}

_ = Property.prototype = new Object_0;
_.getClass$ = function getClass_1400(){
  return Lorg_waveprotocol_wave_model_document_util_Property_2_classLit;
}
;
_.castableTypeMap$ = {};
_.id_0 = 0;
_.name_0 = null;
var uniqueId = 0;
function Property$ImmutableProperty_0(debugName){
  this.id_0 = ++uniqueId;
  this.name_0 = debugName;
}

function Property$ImmutableProperty(){
}

_ = Property$ImmutableProperty_0.prototype = Property$ImmutableProperty.prototype = new Property;
_.getClass$ = function getClass_1401(){
  return Lorg_waveprotocol_wave_model_document_util_Property$ImmutableProperty_2_classLit;
}
;
_.toString$ = function toString_118(){
  return 'ImmutableProperty[' + this.name_0 + ']';
}
;
_.castableTypeMap$ = {};
function Property$MutableProperty_0(debugName){
  this.id_0 = ++uniqueId;
  this.name_0 = debugName;
}

function Property$MutableProperty(){
}

_ = Property$MutableProperty_0.prototype = Property$MutableProperty.prototype = new Property;
_.getClass$ = function getClass_1402(){
  return Lorg_waveprotocol_wave_model_document_util_Property$MutableProperty_2_classLit;
}
;
_.toString$ = function toString_119(){
  return 'MutableProperty[' + this.name_0 + ']';
}
;
_.castableTypeMap$ = {};
function Range_2(start, end){
  (start < 0 || start > end) && illegalArgument('Bad range: (' + start + ', ' + end + ')');
  this.start = start;
  this.end = end;
}

function Range_1(){
}

_ = Range_2.prototype = Range_1.prototype = new Object_0;
_.equals$ = function equals_57(obj){
  var other;
  if (this === obj)
    return true;
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[442]))
    return false;
  other = dynamicCast(obj, 442);
  if (this.end != other.end)
    return false;
  if (this.start != other.start)
    return false;
  return true;
}
;
_.getClass$ = function getClass_1403(){
  return Lorg_waveprotocol_wave_model_document_util_Range_2_classLit;
}
;
_.hashCode$ = function hashCode_56(){
  return this.start + 37 * this.end;
}
;
_.toString$ = function toString_120(){
  return 'Range(' + this.start + (this.start == this.end?'':'-' + this.end) + ')';
}
;
_.castableTypeMap$ = {442:1};
_.end = 0;
_.start = 0;
function $clinit_2152(){
  $clinit_2152 = nullMethod;
  trackValue = new Object_1;
}

function $trackRange(this$static, range){
  var size;
  this$static.isTracking = true;
  size = this$static.annotations.fullAnnotationSet.tree.sentinel.left_0.subtreeLength - 1;
  $resetAnnotation_1(this$static.annotations, range.anchor, size, this$static.startKey, trackValue);
  $resetAnnotation_1(this$static.annotations, range.focus_0, size, this$static.endKey, trackValue);
}

function RangeTracker_0(localAnnotationSet){
  $clinit_2152();
  this.annotations = localAnnotationSet;
  this.startKey = '@' + prefixIncrementor++ + '/savedsel';
  this.endKey = '@' + prefixIncrementor++ + '/savedsel';
}

function RangeTracker(){
}

_ = RangeTracker_0.prototype = RangeTracker.prototype = new Object_0;
_.getClass$ = function getClass_1404(){
  return Lorg_waveprotocol_wave_model_document_util_RangeTracker_2_classLit;
}
;
_.castableTypeMap$ = {};
_.annotations = null;
_.endKey = null;
_.isTracking = false;
_.startKey = null;
var trackValue;
function $checkComplete(this$static){
  checkState_2(this$static.nodeWalker.next == null, 'Tree Walker: Did not end walk at the correct node');
  return this$static.nodeWalker.next == null;
}

function $checkElement(this$static, tagName, attributes){
  var element;
  checkState_2(this$static.nodeWalker.next != null, 'Tree Walker: no more nodes to walk, element expected');
  this$static.currentNode = $next_24(this$static.nodeWalker);
  element = this$static.document_0.inner_0.asElement_0(this$static.currentNode);
  checkState_2(element != null, 'Tree Walker: At text node, element expected');
  checkState_2($equals_3(this$static.document_0.inner_0.getTagName(element), tagName), 'Tree Walker: Incorrect tag name');
  checkState_2(equal_0(this$static.document_0.inner_0.getAttributes(element), attributes), 'Tree Walker: Incorrect attributes');
  return element;
}

function $checkTextNode(this$static, data){
  var textNode;
  checkState_2(this$static.nodeWalker.next != null, 'Tree Walker: no more nodes to walk, text node expected');
  this$static.currentNode = $next_24(this$static.nodeWalker);
  textNode = this$static.document_0.inner_0.asText_0(this$static.currentNode);
  checkState_2(textNode != null, 'Tree Walker: At element, text node expected');
  checkState_2($equals_3(this$static.document_0.inner_0.getData(textNode), data), 'Tree Walker: Incorrect text node data');
  return textNode;
}

function ReadableTreeWalker_0(document_0, rootNode){
  ReadableTreeWalker_1.call(this, document_0, iterate(document_0, rootNode, getNextOrPrevNodeDepthFirst_1(document_0, rootNode, null, false, true), ($clinit_2098() , $clinit_2098() , FORWARD_DEPTH_FIRST_ITERATOR)));
}

function ReadableTreeWalker_1(document_0, nodeIterable){
  this.document_0 = document_0;
  this.nodeWalker = new DocIterate$1$1_0(nodeIterable.val$startNode, nodeIterable.val$iterateFunction, nodeIterable.val$doc, nodeIterable.val$stopAt);
}

function ReadableTreeWalker(){
}

_ = ReadableTreeWalker_0.prototype = ReadableTreeWalker.prototype = new Object_0;
_.getClass$ = function getClass_1406(){
  return Lorg_waveprotocol_wave_model_document_util_ReadableTreeWalker_2_classLit;
}
;
_.castableTypeMap$ = {};
_.currentNode = null;
_.document_0 = null;
_.nodeWalker = null;
function createChildren(view, element){
  return $appendChildXmlFragment(new XmlStringBuilderDoc_0(view, ($clinit_2011() , ANY)), element);
}

function createNode(view, node){
  return $appendNode_0(new XmlStringBuilderDoc_0(view, ($clinit_2011() , ANY)), node);
}

function innerXml(doc){
  return createChildren(doc, doc.substrate.getDocumentElement());
}

function innerXml1(doc){
  return createChildren(doc, doc.getDocumentElement());
}

function XmlStringBuilder(){
}

_ = XmlStringBuilder.prototype = new Object_0;
_.getClass$ = function getClass_1412(){
  return Lorg_waveprotocol_wave_model_document_util_XmlStringBuilder_2_classLit;
}
;
_.castableTypeMap$ = {};
function $addChildXmlFragment(this$static, element){
  var n, size;
  size = 0;
  for (n = this$static.view.getFirstChild_0(element); n != null; n = this$static.view.getNextSibling(n)) {
    size += $addNode(this$static, n);
  }
  return size;
}

function $addNode(this$static, node){
  var data, element, len, selfClosing;
  element = this$static.view.asElement_0(node);
  if (element != null) {
    selfClosing = $equals_3(this$static.view.getTagName(element), 'br') && this$static.view.getFirstChild_0(element) == null;
    $append_11(this$static.builder, '<' + this$static.view.getTagName(element) + $getAttributesString(this$static, element) + (selfClosing?'/>':'>'));
    len = 2;
    if (!selfClosing) {
      len += $addChildXmlFragment(this$static, element);
      $append_11(this$static.builder, '<\/' + this$static.view.getTagName(element) + '>');
    }
    return len;
  }
   else {
    data = this$static.view.getData(this$static.view.asText_0(node));
    return $addText_0(this$static, this$static.permittedChars.coerceString(data));
  }
}

function $addText_0(this$static, text){
  $append_11(this$static.builder, $replaceAll($replaceAll($replaceAll(text, '&', '&amp;'), '<', '&lt;'), '>', '&gt;'));
  return text.length;
}

function $append_19(this$static, xml){
  var seq;
  if (xml) {
    seq = xml.builder;
    $append_8(this$static.builder, seq);
  }
   else {
    $append_11(this$static.builder, null.nullField);
  }
  this$static.length_0 += xml.length_0;
  return this$static;
}

function $appendChildXmlFragment(this$static, element){
  this$static.length_0 += $addChildXmlFragment(this$static, element);
  return this$static;
}

function $appendNode_0(this$static, node){
  this$static.length_0 += $addNode(this$static, node);
  return this$static;
}

function $appendText_0(this$static, text){
  var result;
  this$static.length_0 += $addText_0(this$static, (result = new StringBuilder_0 , traverseUtf16String(text, new DocumentSchema$PermittedCharacters$2$1_0(result)) , result.impl.string));
  return this$static;
}

function $getAttributesString(this$static, element){
  var attributes, key, key$iterator, soFar;
  attributes = this$static.view.getAttributes(element);
  soFar = '';
  for (key$iterator = attributes.keySet_0().iterator_0(); key$iterator.hasNext();) {
    key = dynamicCast(key$iterator.next_0(), 1);
    soFar += ' ' + key + '="' + $replaceAll($replaceAll($replaceAll($replaceAll($replaceAll(dynamicCast(attributes.get(key), 1), '&', '&amp;'), '<', '&lt;'), '>', '&gt;'), '"', '&quot;'), "'", '&apos;') + '"';
  }
  return soFar;
}

function $wrap_2(this$static, tagName){
  isXmlName_0(tagName) || illegalArgument("Invalid tag name: '" + tagName + "'");
  $insert_3(this$static.builder, 0, '<' + tagName + '>');
  $append_11(this$static.builder, '<\/' + tagName + '>');
  this$static.length_0 += 2;
  return this$static;
}

function $wrap_3(this$static, tagName, attribs){
  var attrName, i, startTag;
  isXmlName_0(tagName) || illegalArgument("Invalid tag name: '" + tagName + "'");
  checkArgument_2(attribs.length % 2 == 0, 'Attribs must come in string pairs');
  startTag = '<' + tagName;
  for (i = 0; i < attribs.length; i += 2) {
    if (attribs[i + 1] != null) {
      attrName = attribs[i];
      isXmlName_0(attrName) || illegalArgument("Invalid attribute name: '" + attrName + "'");
      startTag += ' ' + attrName + '="' + $replaceAll($replaceAll($replaceAll($replaceAll($replaceAll(attribs[i + 1], '&', '&amp;'), '<', '&lt;'), '>', '&gt;'), '"', '&quot;'), "'", '&apos;') + '"';
    }
  }
  startTag += '>';
  $insert_3(this$static.builder, 0, startTag);
  $append_11(this$static.builder, '<\/' + tagName + '>');
  this$static.length_0 += 2;
  return this$static;
}

function XmlStringBuilderDoc_0(view, permittedChars){
  this.builder = new StringBuilder_0;
  this.view = view;
  this.permittedChars = permittedChars;
}

function XmlStringBuilderDoc(){
}

_ = XmlStringBuilderDoc_0.prototype = XmlStringBuilderDoc.prototype = new XmlStringBuilder;
_.equals$ = function equals_58(o){
  if (o === this) {
    return true;
  }
  if (o != null && o.castableTypeMap$ && !!o.castableTypeMap$[443]) {
    return $equals_3(this.builder.impl.string, dynamicCast(o, 443).builder.impl.string) && this.length_0 == dynamicCast(o, 443).length_0;
  }
  return false;
}
;
_.getClass$ = function getClass_1414(){
  return Lorg_waveprotocol_wave_model_document_util_XmlStringBuilderDoc_2_classLit;
}
;
_.hashCode$ = function hashCode_57(){
  return getHashCode_0(this.builder.impl.string);
}
;
_.toString$ = function toString_122(){
  return this.builder.impl.string;
}
;
_.castableTypeMap$ = {443:1};
_.length_0 = 0;
_.permittedChars = null;
_.view = null;
function $deserialiseWaveId(serialisedForm){
  var $e0;
  try {
    return $deserialiseWaveId_1(serialisedForm);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 194)) {
      return $deserialiseWaveId_0(serialisedForm);
    }
     else 
      throw $e0;
  }
}

function $clinit_2172(){
  $clinit_2172 = nullMethod;
  WEB64_ALPHABET = $toCharArray('ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_');
}

function $newId(this$static, namespace){
  var newId, unique;
  newId = ($clinit_2172() , $join_1(($clinit_2178() , DEFAULT_ESCAPER), initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, [namespace, (unique = this$static.counter++ , this$static.idSeed.get_1() + base64Encode(unique))])));
  $equals_3(namespace, 'b') || $equals_3(namespace, 'g')?newId.indexOf('b+') == 0 || newId.indexOf('g+') == 0 || newId.indexOf('*') != -1 && newId.indexOf('m/') != 0 && newId.indexOf('attach+') != 0 && newId.indexOf('spell+') != 0 || illegalState("generated blip id '" + newId + "' is not a blip id"):(newId.indexOf('b+') == 0 || newId.indexOf('g+') == 0 || newId.indexOf('*') != -1 && newId.indexOf('m/') != 0 && newId.indexOf('attach+') != 0 && newId.indexOf('spell+') != 0) && illegalState("generated data document id '" + newId + "' is a blip id");
  return newId;
}

function $newUniqueToken(this$static){
  var unique;
  unique = this$static.counter++;
  return this$static.idSeed.get_1() + base64Encode(unique);
}

function $newUserDataWaveletId(address){
  var userDomain, parts;
  userDomain = (parts = $split(ofUnsafe(address).address, '@', 0) , parts[parts.length - 1]);
  return of_9(userDomain, $join_1(($clinit_2178() , DEFAULT_ESCAPER), initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['user', address])));
}

function $peekUniqueToken(this$static){
  var unique;
  unique = this$static.counter;
  return this$static.idSeed.get_1() + base64Encode(unique);
}

function IdGeneratorImpl_0(domain, idSeed){
  $clinit_2172();
  this.defaultDomain = domain;
  this.idSeed = idSeed;
}

function base64Encode(intValue){
  var encoded, numEncodedBytes;
  intValue == 0?(numEncodedBytes = 1):(numEncodedBytes = round_int(Math.ceil((32 - numberOfLeadingZeros_0(intValue)) / 6)));
  encoded = new StringBuilder_1;
  switch (numEncodedBytes) {
    case 6:
      $append_6(encoded, WEB64_ALPHABET[~~intValue >> 30 & 63]);
    case 5:
      $append_6(encoded, WEB64_ALPHABET[~~intValue >> 24 & 63]);
    case 4:
      $append_6(encoded, WEB64_ALPHABET[~~intValue >> 18 & 63]);
    case 3:
      $append_6(encoded, WEB64_ALPHABET[~~intValue >> 12 & 63]);
    case 2:
      $append_6(encoded, WEB64_ALPHABET[~~intValue >> 6 & 63]);
    default:$append_6(encoded, WEB64_ALPHABET[intValue & 63]);
  }
  return encoded.impl.string;
}

function IdGeneratorImpl(){
}

_ = IdGeneratorImpl_0.prototype = IdGeneratorImpl.prototype = new Object_0;
_.getClass$ = function getClass_1415(){
  return Lorg_waveprotocol_wave_model_id_IdGeneratorImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.counter = 0;
_.defaultDomain = null;
_.idSeed = null;
var WEB64_ALPHABET;
function isConversationalId(waveletId){
  var tokens, tokens_0;
  return $equals_3((tokens = $split_0(($clinit_2178() , DEFAULT_ESCAPER), waveletId.id_0) , tokens.length > 1?tokens[0]:''), 'conv') || $isEmpty_1((tokens_0 = $split_0(DEFAULT_ESCAPER, waveletId.id_0) , tokens_0.length > 1?tokens_0[0]:''));
}

function InvalidIdException_0(id, message){
  this.fillInStackTrace();
  this.detailMessage = message;
  this.id_0 = id;
}

function InvalidIdException(){
}

_ = InvalidIdException_0.prototype = InvalidIdException.prototype = new Exception;
_.getClass$ = function getClass_1416(){
  return Lorg_waveprotocol_wave_model_id_InvalidIdException_2_classLit;
}
;
_.getMessage = function getMessage_1(){
  return "Invalid id '" + this.id_0 + "': " + this.detailMessage;
}
;
_.castableTypeMap$ = {9:1, 39:1, 183:1, 194:1};
_.id_0 = null;
function $deserialiseWaveId_0(serialisedForm){
  var $e0, ex, parts;
  parts = $splitWithoutUnescaping(($clinit_2178() , DEFAULT_ESCAPER), 33, serialisedForm);
  if (parts.length != 2 || !parts[0].length || !parts[1].length) {
    throw new InvalidIdException_0(serialisedForm, 'Wave id must be of the form <domain>!<id>');
  }
  try {
    return checkNotNull_1(parts[0], 'Null domain') , checkNotNull_1(parts[1], 'Null id') , checkArgument_2(!!parts[0].length, 'Empty domain') , checkArgument_2(!!parts[1].length, 'Empty id') , $hasEscapeCharacters(DEFAULT_ESCAPER, parts[0]) && illegalArgument('Domain cannot contain characters that requires escaping: ' + parts[0]) , $isEscapedProperly(DEFAULT_ESCAPER, parts[1]) || illegalArgument('Id is not properly escaped: ' + parts[1]) , new WaveId_0(parts[0], parts[1]);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 444)) {
      ex = $e0;
      throw new InvalidIdException_0(serialisedForm, ex.detailMessage);
    }
     else 
      throw $e0;
  }
}

function $deserialiseWaveId_1(serialisedForm){
  var tokens;
  tokens = $split(serialisedForm, '/', 0);
  if (tokens.length != 2) {
    throw new InvalidIdException_0(serialisedForm, "Required 2 '/'-separated tokens in serialised wave id: " + serialisedForm);
  }
  return ofChecked(tokens[0], tokens[1]);
}

function $deserialiseWaveletId_1(serialisedForm){
  var tokens;
  tokens = $split(serialisedForm, '/', 0);
  if (tokens.length != 2) {
    throw new InvalidIdException_0(serialisedForm, "Required 2 '/'-separated tokens in serialised wavelet id: " + serialisedForm);
  }
  return ofChecked_0(tokens[0], tokens[1]);
}

function $serialiseWaveId(id){
  checkArgument_3(isValidDomain(id.domain), 'Invalid domain %s', initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [id.domain]));
  checkArgument_3(isValidIdentifier(id.id_0), 'Invalid id %s', initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [id.id_0]));
  return $append_11($append_11(new StringBuilder_2(id.domain), '/'), id.id_0).impl.string;
}

function $serialiseWaveletId(id){
  checkArgument_3(isValidDomain(id.domain), 'Invalid domain %s', initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [id.domain]));
  checkArgument_3(isValidIdentifier(id.id_0), 'Invalid id %s', initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [id.id_0]));
  return $append_11($append_11(new StringBuilder_2(id.domain), '/'), id.id_0).impl.string;
}

function $serialiseWaveletName(name_0){
  var b;
  b = $append_11(new StringBuilder_2($serialiseWaveId(name_0.waveId)), '/');
  $equals_3(name_0.waveletId.domain, name_0.waveId.domain)?(b.impl.string += '~' , b):$append_11(b, name_0.waveletId.domain);
  $append_11((b.impl.string += '/' , b), name_0.waveletId.id_0);
  return b.impl.string;
}

function $clinit_2178(){
  $clinit_2178 = nullMethod;
  DEFAULT_ESCAPER = new SimplePrefixEscaper_0(initValues(_3C_classLit, {9:1}, -1, [43, 33]));
  EMPTY_STRING_ARRAY = initDim(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, 0, 0);
}

function $escape(this$static, toEscape){
  var cache, i;
  cache = new StringBuilder_1(toEscape.length);
  for (i = 0; i < toEscape.length; ++i) {
    this$static.needsEscaping.map.containsKey(valueOf_12(toEscape.charCodeAt(i))) && $append_6(cache, this$static.prefix);
    $append_6(cache, toEscape.charCodeAt(i));
  }
  return cache.impl.string;
}

function $hasEscapeCharacters(this$static, unescaped){
  var i;
  for (i = 0; i < unescaped.length; ++i) {
    if (this$static.needsEscaping.map.containsKey(valueOf_12(unescaped.charCodeAt(i)))) {
      return true;
    }
  }
  return false;
}

function $isEscapedProperly(this$static, escapedValue){
  var c, i;
  for (i = 0; i < escapedValue.length; ++i) {
    c = escapedValue.charCodeAt(i);
    if (c == this$static.prefix) {
      if (i >= escapedValue.length - 1 || !this$static.needsEscaping.map.containsKey(valueOf_12(escapedValue.charCodeAt(i + 1)))) {
        return false;
      }
       else {
        ++i;
      }
    }
     else if (c != 43 && this$static.needsEscaping.map.containsKey(valueOf_12(c))) {
      return false;
    }
  }
  return true;
}

function $join_1(this$static, tokens){
  var i, ret;
  if (43 == this$static.prefix) {
    throw new IllegalArgumentException_1("It's unsafe to join strings together using the prefixchar.");
  }
  if (tokens.length == 0) {
    throw new IllegalArgumentException_1('Must have at least 1 token to use join.');
  }
  if (!this$static.needsEscaping.map.containsKey(valueOf_12(43))) {
    throw new IllegalArgumentException_1("It's unsafe to join strings together using a [separator:+] that is not in the characters that are escaped.");
  }
  ret = new StringBuilder_0;
  for (i = 0; i < tokens.length; ++i) {
    i > 0 && (ret.impl.string += '+' , ret);
    $append_11(ret, $escape(this$static, tokens[i]));
  }
  return ret.impl.string;
}

function $split_0(this$static, toSplit){
  var i, ret;
  ret = $splitWithoutUnescaping(this$static, 43, toSplit);
  for (i = 0; i < ret.length; ++i) {
    ret[i] = $unescape(this$static, ret[i]);
  }
  return ret;
}

function $splitWithoutUnescaping(this$static, separator, toSplit){
  var end, ret, start;
  if (separator == this$static.prefix) {
    throw new IllegalArgumentException_1("It's unsafe to split strings together the prefix char.");
  }
  ret = new ArrayList_0;
  start = 0;
  while (start <= toSplit.length) {
    end = start;
    while (end < toSplit.length && toSplit.charCodeAt(end) != separator) {
      end += toSplit.charCodeAt(end) == this$static.prefix?2:1;
    }
    end >= toSplit.length && (end = toSplit.length);
    $add_9(ret, toSplit.substr(start, end - start));
    start = end + 1;
  }
  return dynamicCast($toArray_1(ret, EMPTY_STRING_ARRAY), 408);
}

function $unescape(this$static, toUnescape){
  var cache, i;
  cache = new StringBuilder_1(~~(toUnescape.length / 2));
  for (i = 0; i < toUnescape.length; ++i) {
    if (toUnescape.charCodeAt(i) == this$static.prefix) {
      if (i + 1 >= toUnescape.length) {
        throw new IllegalArgumentException_1('The value to unescape cannot be terminated with the prefix: ' + String.fromCharCode(this$static.prefix));
      }
      if (!this$static.needsEscaping.map.containsKey(valueOf_12(toUnescape.charCodeAt(i + 1)))) {
        throw new IllegalArgumentException_1('The value to unescape is not a properly escaped value. The prefix charater is not followed by a character at needs prefixing: ' + toUnescape);
      }
      ++i;
    }
     else if (this$static.needsEscaping.map.containsKey(valueOf_12(toUnescape.charCodeAt(i)))) {
      throw new IllegalArgumentException_1('The value to unescape is not a properly escaped value. Some chars are found unescaped: ' + toUnescape);
    }
    $append_6(cache, toUnescape.charCodeAt(i));
  }
  return cache.impl.string;
}

function SimplePrefixEscaper_0(needsEscaping){
  var s, s$index, s$max;
  this.needsEscaping = new HashSet_0;
  this.prefix = 126;
  $add_13(this.needsEscaping, valueOf_12(126));
  for (s$index = 0 , s$max = needsEscaping.length; s$index < s$max; ++s$index) {
    s = needsEscaping[s$index];
    $add_13(this.needsEscaping, valueOf_12(s));
  }
}

function SimplePrefixEscaper(){
}

_ = SimplePrefixEscaper_0.prototype = SimplePrefixEscaper.prototype = new Object_0;
_.getClass$ = function getClass_1417(){
  return Lorg_waveprotocol_wave_model_id_SimplePrefixEscaper_2_classLit;
}
;
_.castableTypeMap$ = {};
_.prefix = 0;
var DEFAULT_ESCAPER, EMPTY_STRING_ARRAY;
function $compareTo_15(this$static, other){
  var domainCompare;
  domainCompare = compareTo_5(this$static.domain, other.domain);
  return domainCompare == 0?compareTo_5(this$static.id_0, other.id_0):domainCompare;
}

function $equals_12(this$static, obj){
  var other;
  if (this$static === obj)
    return true;
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[445]))
    return false;
  other = dynamicCast(obj, 445);
  return $equals_3(this$static.domain, other.domain) && $equals_3(this$static.id_0, other.id_0);
}

function $hashCode_10(this$static){
  var result;
  result = 31 + getHashCode_0(this$static.domain);
  result = 31 * result + getHashCode_0(this$static.id_0);
  return result;
}

function WaveId_0(domain, id){
  this.domain = String(domain);
  this.id_0 = id;
}

function of_8(domain, id){
  checkNotNull_1(domain, 'Null domain');
  checkNotNull_1(id, 'Null id');
  checkArgument_3(isValidDomain(domain), 'Invalid domain %s', initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [domain]));
  checkArgument_3(($clinit_2180() , !!id.length && traverseUtf16String(id, GOOD_UTF16_FOR_ID).value_0), 'Invalid id %s', initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [id]));
  return new WaveId_0(domain, id);
}

function ofChecked(domain, id){
  checkNotNull_1(domain, 'Null domain');
  checkNotNull_1(id, 'Null id');
  if (!isValidDomain(domain)) {
    throw new InvalidIdException_0(domain, 'Invalid domain');
  }
  $clinit_2180();
  if (!(!!id.length && traverseUtf16String(id, GOOD_UTF16_FOR_ID).value_0)) {
    throw new InvalidIdException_0(id, 'Invalid id');
  }
  return new WaveId_0(domain, id);
}

function WaveId(){
}

_ = WaveId_0.prototype = WaveId.prototype = new Object_0;
_.compareTo$ = function compareTo_16(other){
  return $compareTo_15(this, dynamicCast(other, 445));
}
;
_.equals$ = function equals_59(obj){
  return $equals_12(this, obj);
}
;
_.getClass$ = function getClass_1418(){
  return Lorg_waveprotocol_wave_model_id_WaveId_2_classLit;
}
;
_.hashCode$ = function hashCode_58(){
  return $hashCode_10(this);
}
;
_.toString$ = function toString_123(){
  return '[WaveId ' + $serialiseWaveId(this) + ']';
}
;
_.castableTypeMap$ = {9:1, 10:1, 445:1};
_.domain = null;
_.id_0 = null;
function $clinit_2180(){
  $clinit_2180 = nullMethod;
  var c, c$iterator;
  SAFE_ASCII_CHARS = initDim(_3Z_classLit, {9:1}, -1, 127, 2);
  for (c = 65; c <= 90; ++c) {
    SAFE_ASCII_CHARS[c] = true;
  }
  for (c = 97; c <= 122; ++c) {
    SAFE_ASCII_CHARS[c] = true;
  }
  for (c = 48; c <= 57; ++c) {
    SAFE_ASCII_CHARS[c] = true;
  }
  for (c$iterator = new AbstractList$IteratorImpl_0(new Arrays$ArrayList_0(initValues(_3Ljava_lang_Character_2_classLit, {9:1, 68:1}, 63, [valueOf_12(45), valueOf_12(46), valueOf_12(95), valueOf_12(126), valueOf_12(43), valueOf_12(42), valueOf_12(64)]))); c$iterator.i < c$iterator.this$0_0.size_1();) {
    c = dynamicCast($next_4(c$iterator), 63).value_0;
    SAFE_ASCII_CHARS[c] = true;
  }
  GOOD_UTF16_FOR_ID = new WaveIdentifiers$1_0;
}

function isValidDomain(x){
  $clinit_2180();
  var c, d, index, length_0;
  index = 0;
  length_0 = x.length;
  if (length_0 > 253 || length_0 < 1) {
    return false;
  }
  while (index < x.length) {
    c = x.charCodeAt(index);
    if ((97 > c || c > 122) && (48 > c || c > 57)) {
      return false;
    }
    d = c;
    while (++index < x.length) {
      c = x.charCodeAt(index);
      if ((97 > c || c > 122) && (48 > c || c > 57) && c != 45) {
        break;
      }
      d = c;
    }
    if (index >= x.length) {
      return d != 45;
    }
    if (46 != c || d == 45) {
      return false;
    }
    ++index;
  }
  return false;
}

function isValidIdentifier(id){
  $clinit_2180();
  return !!id.length && traverseUtf16String(id, GOOD_UTF16_FOR_ID).value_0;
}

var GOOD_UTF16_FOR_ID, SAFE_ASCII_CHARS = null;
function $codePoint(cp){
  if (!isCodePointValid(cp)) {
    return $clinit_428() , $clinit_428() , FALSE_0;
  }
  if (cp < ($clinit_2180() , SAFE_ASCII_CHARS).length && !SAFE_ASCII_CHARS[cp]) {
    return $clinit_428() , $clinit_428() , FALSE_0;
  }
  if (cp >= SAFE_ASCII_CHARS.length && !(cp >= 160 && cp <= 55295 || cp >= 63744 && cp <= 64975 || cp >= 65008 && cp <= 65519 || cp >= 65536 && cp <= 131069 || cp >= 131072 && cp <= 196605 || cp >= 196608 && cp <= 262141 || cp >= 262144 && cp <= 327677 || cp >= 327680 && cp <= 393213 || cp >= 393216 && cp <= 458749 || cp >= 458752 && cp <= 524285 || cp >= 524288 && cp <= 589821 || cp >= 589824 && cp <= 655357 || cp >= 655360 && cp <= 720893 || cp >= 720896 && cp <= 786429 || cp >= 786432 && cp <= 851965 || cp >= 851968 && cp <= 917501 || cp >= 921600 && cp <= 983037)) {
    return $clinit_428() , $clinit_428() , FALSE_0;
  }
  return null;
}

function WaveIdentifiers$1_0(){
}

function WaveIdentifiers$1(){
}

_ = WaveIdentifiers$1_0.prototype = WaveIdentifiers$1.prototype = new Object_0;
_.codePoint = function codePoint_2(cp){
  return $codePoint(cp);
}
;
_.endOfString = function endOfString_1(){
  return $clinit_428() , $clinit_428() , TRUE_0;
}
;
_.getClass$ = function getClass_1419(){
  return Lorg_waveprotocol_wave_model_id_WaveIdentifiers$1_2_classLit;
}
;
_.unpairedSurrogate = function unpairedSurrogate_1(c){
  return $clinit_428() , $clinit_428() , FALSE_0;
}
;
_.castableTypeMap$ = {};
function $compareTo_16(this$static, other){
  var domainCompare;
  domainCompare = compareTo_5(this$static.domain, other.domain);
  return domainCompare == 0?compareTo_5(this$static.id_0, other.id_0):domainCompare;
}

function $equals_13(this$static, obj){
  var other;
  if (this$static === obj) {
    return true;
  }
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[446])) {
    return false;
  }
  other = dynamicCast(obj, 446);
  return $equals_3(this$static.domain, other.domain) && $equals_3(this$static.id_0, other.id_0);
}

function $hashCode_11(this$static){
  var result;
  result = 31 + getHashCode_0(this$static.domain);
  result = 31 * result + getHashCode_0(this$static.id_0);
  return result;
}

function WaveletId_0(domain, id){
  this.domain = String(domain);
  this.id_0 = id;
}

function of_9(domain, id){
  checkNotNull_1(domain, 'Null domain');
  checkNotNull_1(id, 'Null id');
  checkArgument_3(isValidDomain(domain), 'Invalid domain %s', initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [domain]));
  checkArgument_3(($clinit_2180() , !!id.length && traverseUtf16String(id, GOOD_UTF16_FOR_ID).value_0), 'Invalid id %s', initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [id]));
  return new WaveletId_0(domain, id);
}

function ofChecked_0(domain, id){
  checkNotNull_1(domain, 'Null domain');
  checkNotNull_1(id, 'Null id');
  if (!isValidDomain(domain)) {
    throw new InvalidIdException_0(domain, 'Invalid domain');
  }
  $clinit_2180();
  if (!(!!id.length && traverseUtf16String(id, GOOD_UTF16_FOR_ID).value_0)) {
    throw new InvalidIdException_0(id, 'Invalid id');
  }
  return new WaveletId_0(domain, id);
}

function WaveletId(){
}

_ = WaveletId_0.prototype = WaveletId.prototype = new Object_0;
_.compareTo$ = function compareTo_17(other){
  return $compareTo_16(this, dynamicCast(other, 446));
}
;
_.equals$ = function equals_60(obj){
  return $equals_13(this, obj);
}
;
_.getClass$ = function getClass_1420(){
  return Lorg_waveprotocol_wave_model_id_WaveletId_2_classLit;
}
;
_.hashCode$ = function hashCode_59(){
  return $hashCode_11(this);
}
;
_.toString$ = function toString_124(){
  return '[WaveletId ' + $serialiseWaveletId(this) + ']';
}
;
_.castableTypeMap$ = {9:1, 10:1, 446:1};
_.domain = null;
_.id_0 = null;
function $clinit_2183(){
  $clinit_2183 = nullMethod;
  INSTANCE_17 = new WaveletIdSerializer$1_0;
}

var INSTANCE_17;
function $deserialize(s){
  var $e0, e;
  try {
    return $deserialiseWaveletId_1(s);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 194)) {
      e = $e0;
      throw new IllegalArgumentException_3(e);
    }
     else 
      throw $e0;
  }
}

function $fromString(s){
  return s != null?$deserialize(s):null;
}

function $toString_28(x){
  return x?$serialiseWaveletId(x):null;
}

function WaveletIdSerializer$1_0(){
}

function WaveletIdSerializer$1(){
}

_ = WaveletIdSerializer$1_0.prototype = WaveletIdSerializer$1.prototype = new Object_0;
_.fromString = function fromString(s){
  return s != null?$deserialize(s):null;
}
;
_.getClass$ = function getClass_1421(){
  return Lorg_waveprotocol_wave_model_id_WaveletIdSerializer$1_2_classLit;
}
;
_.toString_0 = function toString_125(x){
  return $toString_28(dynamicCast(x, 446));
}
;
_.castableTypeMap$ = {};
function $compareTo_17(this$static, o){
  return $equals_12(this$static.waveId, o.waveId)?$compareTo_16(this$static.waveletId, o.waveletId):$compareTo_15(this$static.waveId, o.waveId);
}

function WaveletName_0(waveId, waveletId){
  (!waveId || !waveletId) && nullPointer('Cannot create WaveletName with null value in [waveId:' + waveId + '] [waveletId:' + waveletId + ']');
  this.waveId = waveId;
  this.waveletId = waveletId;
}

function WaveletName(){
}

_ = WaveletName_0.prototype = WaveletName.prototype = new Object_0;
_.compareTo$ = function compareTo_18(o){
  return $compareTo_17(this, dynamicCast(o, 447));
}
;
_.equals$ = function equals_61(other){
  var o;
  if (other != null && other.castableTypeMap$ && !!other.castableTypeMap$[447]) {
    o = dynamicCast(other, 447);
    return $equals_12(this.waveId, o.waveId) && $equals_13(this.waveletId, o.waveletId);
  }
  return false;
}
;
_.getClass$ = function getClass_1422(){
  return Lorg_waveprotocol_wave_model_id_WaveletName_2_classLit;
}
;
_.hashCode$ = function hashCode_60(){
  return $hashCode_10(this.waveId) * 37 + $hashCode_11(this.waveletId);
}
;
_.toString$ = function toString_126(){
  return '[WaveletName ' + $serialiseWaveId(this.waveId) + '/' + $serialiseWaveletId(this.waveletId) + ']';
}
;
_.castableTypeMap$ = {9:1, 10:1, 447:1};
_.waveId = null;
_.waveletId = null;
function $equal_0(a_0, b){
  checkNotNull_1(a_0, 'First argument is null');
  checkNotNull_1(b, 'Second argument is null');
  return $equalNullable(a_0, b);
}

function $equal_1(a_0, b){
  var changeSize, endSize, i;
  changeSize = a_0.changeSize();
  if (changeSize != b.changeSize()) {
    return false;
  }
  for (i = 0; i < changeSize; ++i) {
    if (!$equals_3(a_0.getChangeKey_0(i), checkNotNull_1(b.getChangeKey_0(i), 'b'))) {
      return false;
    }
    if (!$equalNullable_0(a_0.getOldValue(i), b.getOldValue(i))) {
      return false;
    }
    if (!$equalNullable_0(a_0.getNewValue(i), b.getNewValue(i))) {
      return false;
    }
  }
  endSize = a_0.endSize();
  if (endSize != b.endSize()) {
    return false;
  }
  for (i = 0; i < endSize; ++i) {
    if (!$equals_3(a_0.getEndKey_0(i), checkNotNull_1(b.getEndKey_0(i), 'b'))) {
      return false;
    }
  }
  return true;
}

function $equal_2(a_0, b){
  var changeSize, i;
  changeSize = a_0.updates.size_1();
  if (changeSize != b.updates.size_1()) {
    return false;
  }
  for (i = 0; i < changeSize; ++i) {
    if (!$equals_3(dynamicCast(a_0.updates.get_0(i), 384).name_0, checkNotNull_1(dynamicCast(b.updates.get_0(i), 384).name_0, 'b'))) {
      return false;
    }
    if (!$equalNullable_0(dynamicCast(a_0.updates.get_0(i), 384).oldValue, dynamicCast(b.updates.get_0(i), 384).oldValue)) {
      return false;
    }
    if (!$equalNullable_0(dynamicCast(a_0.updates.get_0(i), 384).newValue, dynamicCast(b.updates.get_0(i), 384).newValue)) {
      return false;
    }
  }
  return true;
}

function $equalComponent(a_0, b, i){
  var type;
  type = a_0.getType_0(i);
  if (type != b.getType_0(i)) {
    return false;
  }
  if (type == ($clinit_1886() , ANNOTATION_BOUNDARY)) {
    return $equal_1(a_0.getAnnotationBoundary(i), b.getAnnotationBoundary(i));
  }
   else if (type == CHARACTERS) {
    return $equals_3(a_0.getCharactersString(i), checkNotNull_1(b.getCharactersString(i), 'b'));
  }
   else if (type == ELEMENT_START_0) {
    return $equals_3(a_0.getElementStartTag(i), checkNotNull_1(b.getElementStartTag(i), 'b')) && $equals_4(a_0.getElementStartAttributes(i), checkNotNull_1(b.getElementStartAttributes(i), 'b'));
  }
   else if (type == ELEMENT_END_0) {
    return true;
  }
   else if (type == RETAIN) {
    return a_0.getRetainItemCount(i) == b.getRetainItemCount(i);
  }
   else if (type == DELETE_CHARACTERS) {
    return $equals_3(a_0.getDeleteCharactersString(i), checkNotNull_1(b.getDeleteCharactersString(i), 'b'));
  }
   else if (type == DELETE_ELEMENT_START) {
    return $equals_3(a_0.getDeleteElementStartTag(i), checkNotNull_1(b.getDeleteElementStartTag(i), 'b')) && $equals_4(a_0.getDeleteElementStartAttributes(i), checkNotNull_1(b.getDeleteElementStartAttributes(i), 'b'));
  }
   else if (type == DELETE_ELEMENT_END) {
    return true;
  }
   else if (type == REPLACE_ATTRIBUTES) {
    return $equals_4(a_0.getReplaceAttributesOldAttributes(i), checkNotNull_1(b.getReplaceAttributesOldAttributes(i), 'b')) && $equals_4(a_0.getReplaceAttributesNewAttributes(i), checkNotNull_1(b.getReplaceAttributesNewAttributes(i), 'b'));
  }
   else if (type == UPDATE_ATTRIBUTES) {
    return $equal_2(a_0.getUpdateAttributesUpdate(i), b.getUpdateAttributesUpdate(i));
  }
   else {
    throw new IllegalArgumentException_1('unsupported DocOpComponentType: ' + type);
  }
}

function $equalNullable(a_0, b){
  var i;
  if (!a_0) {
    return !b;
  }
  if (!b) {
    return false;
  }
  if (a_0.size_1() != b.size_1()) {
    return false;
  }
  for (i = 0; i < a_0.size_1(); ++i) {
    if (!$equalComponent(a_0, b, i)) {
      return false;
    }
  }
  return true;
}

function $equalNullable_0(a_0, b){
  if (a_0 == null) {
    return b == null;
  }
  if (b == null) {
    return false;
  }
  return $equals_3(a_0, checkNotNull_1(b, 'b'));
}

function OpCursorException_0(message){
  this.fillInStackTrace();
  this.detailMessage = message;
}

function OpCursorException(){
}

_ = OpCursorException_0.prototype = OpCursorException.prototype = new RuntimeException;
_.getClass$ = function getClass_1423(){
  return Lorg_waveprotocol_wave_model_operation_OpCursorException_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 21:1, 39:1, 183:1, 391:1};
function OperationException_0(message){
  this.fillInStackTrace();
  this.detailMessage = message;
}

function OperationException_1(message, cause){
  this.fillInStackTrace();
  this.cause = cause;
  this.detailMessage = message;
}

function OperationException_2(violations){
  this.fillInStackTrace();
  this.detailMessage = 'Validation failure: ' + violations;
  this.violations = violations;
}

function OperationException(){
}

_ = OperationException_2.prototype = OperationException_1.prototype = OperationException_0.prototype = OperationException.prototype = new Exception;
_.getClass$ = function getClass_1424(){
  return Lorg_waveprotocol_wave_model_operation_OperationException_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 39:1, 183:1, 189:1};
_.violations = null;
function OperationRuntimeException_0(message, opException){
  this.fillInStackTrace();
  this.cause = opException;
  this.detailMessage = message;
  this.message_0 = message;
  this.opException = opException;
}

function OperationRuntimeException(){
}

_ = OperationRuntimeException_0.prototype = OperationRuntimeException.prototype = new RuntimeException;
_.getClass$ = function getClass_1426(){
  return Lorg_waveprotocol_wave_model_operation_OperationRuntimeException_2_classLit;
}
;
_.toString$ = function toString_127(){
  return 'BoxedOpException: ' + this.message_0 + ': ' + this.opException;
}
;
_.castableTypeMap$ = {9:1, 21:1, 39:1, 183:1, 201:1};
_.message_0 = null;
_.opException = null;
function $clinit_2195(){
  $clinit_2195 = nullMethod;
  VOID = new SilentOperationSink$1_0;
}

var VOID;
function SilentOperationSink$1_0(){
}

function SilentOperationSink$1(){
}

_ = SilentOperationSink$1_0.prototype = SilentOperationSink$1.prototype = new Object_0;
_.consume = function consume_10(op){
}
;
_.getClass$ = function getClass_1427(){
  return Lorg_waveprotocol_wave_model_operation_SilentOperationSink$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function $createContext(this$static){
  return $createContext_0(this$static, this$static.getParticipantId());
}

function $createContext_0(this$static, creator){
  return new WaveletOperationContext_0(creator, this$static.currentTimeMillis());
}

function AbstractWaveletOperationContextFactory(){
}

_ = AbstractWaveletOperationContextFactory.prototype = new Object_0;
_.getClass$ = function getClass_1430(){
  return Lorg_waveprotocol_wave_model_operation_wave_AbstractWaveletOperationContextFactory_2_classLit;
}
;
_.castableTypeMap$ = {};
function $update_0(this$static, wavelet){
  neq(this$static.context.timestamp, N1_longLit) && $setLastModifiedTime_0(wavelet, this$static.context.timestamp);
  neq(this$static.context.versionIncrement, P0_longLit) && $setVersion(wavelet, add_1(wavelet.version, this$static.context.versionIncrement));
  !!this$static.context.hashedVersion && $setHashedVersion(wavelet, this$static.context.hashedVersion);
}

function WaveletOperation(){
}

_ = WaveletOperation.prototype = new Object_0;
_.apply_7 = function apply_138(wavelet){
  this.doApply(wavelet);
  $update_0(this, wavelet);
}
;
_.getClass$ = function getClass_1431(){
  return Lorg_waveprotocol_wave_model_operation_wave_WaveletOperation_2_classLit;
}
;
_.castableTypeMap$ = {466:1};
_.context = null;
function $equals_14(this$static, obj){
  var other;
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[448])) {
    return false;
  }
  other = dynamicCast(obj, 448);
  return $equals_18(this$static.participant, other.participant) && this$static.position_0 == other.position_0;
}

function AddParticipant_0(context, participant){
  this.context = context;
  checkNotNull_1(participant, 'Null participant ID');
  this.participant = participant;
  this.position_0 = -1;
}

function AddParticipant(){
}

_ = AddParticipant_0.prototype = AddParticipant.prototype = new WaveletOperation;
_.doApply = function doApply(target){
  if (!(this.position_0 == -1?$addParticipant_0(target, this.participant):$addParticipant_1(target, this.participant, this.position_0))) {
    throw new OperationException_0('Attempt to add a duplicate participant ' + this.participant);
  }
}
;
_.equals$ = function equals_62(obj){
  return $equals_14(this, obj);
}
;
_.getClass$ = function getClass_1432(){
  return Lorg_waveprotocol_wave_model_operation_wave_AddParticipant_2_classLit;
}
;
_.hashCode$ = function hashCode_61(){
  return getHashCode_0(this.participant.address) + 31 * this.position_0;
}
;
_.toString$ = function toString_128(){
  return 'add participant ' + this.participant + (this.position_0 != -1?' at position ' + this.position_0:'') + ' by ' + this.context.creator + ' at ' + new Date_2(this.context.timestamp) + ' version ' + this.context.hashedVersion;
}
;
_.castableTypeMap$ = {448:1, 466:1};
_.participant = null;
_.position_0 = 0;
function BasicWaveletOperationContextFactory_0(participantId){
  this.participantId = participantId;
}

function BasicWaveletOperationContextFactory(){
}

_ = BasicWaveletOperationContextFactory_0.prototype = BasicWaveletOperationContextFactory.prototype = new AbstractWaveletOperationContextFactory;
_.currentTimeMillis = function currentTimeMillis_4(){
  return fromDouble((new Date).getTime());
}
;
_.getClass$ = function getClass_1433(){
  return Lorg_waveprotocol_wave_model_operation_wave_BasicWaveletOperationContextFactory_2_classLit;
}
;
_.getParticipantId = function getParticipantId(){
  return this.participantId;
}
;
_.castableTypeMap$ = {};
_.participantId = null;
function $apply_46(this$static, target){
  target.content_0.consume(this$static.contentOp);
  $isWorthyOfAttribution(this$static, target.id_0) && $onRemoteBlipDataContentModified(target.wavelet.listenerManager, target.wavelet, target);
  $update_1(this$static, target, this$static.method_0);
}

function $isWorthyOfAttribution(this$static, blipId){
  return this$static.isWorthyOfAttribution && ($clinit_2213() , !(blipId.indexOf('attach') == 0 || $equals_3(blipId, 'mini') || blipId.indexOf('tr+') == 0));
}

function $update_1(this$static, target, method){
  var reverse;
  if (!$updatesBlipMetadata(this$static, target.id_0)) {
    return $clinit_2206() , NONE_7;
  }
  switch (method.ordinal) {
    case 0:
      if (target.contributors.map.containsKey(this$static.context.creator)) {
        reverse = ($clinit_2206() , NONE_7);
      }
       else {
        $addContributor(target, this$static.context.creator);
        reverse = ($clinit_2206() , REMOVE_0);
      }

      break;
    case 1:
      if (target.contributors.map.containsKey(this$static.context.creator)) {
        $removeContributor(target, this$static.context.creator);
        reverse = ($clinit_2206() , ADD_0);
      }
       else {
        reverse = ($clinit_2206() , NONE_7);
      }

      break;
    case 2:
    default:reverse = ($clinit_2206() , NONE_7);
  }
  $setLastModifiedVersion(target, add_1(target.wavelet.version, this$static.context.versionIncrement));
  neq(this$static.context.timestamp, N1_longLit) && $setLastModifiedTime(target, this$static.context.timestamp);
  return reverse;
}

function BlipOperation(){
}

_ = BlipOperation.prototype = new Object_0;
_.apply_7 = function apply_139(target){
  $apply_46(this, throwClassCastExceptionUnlessNull(target));
}
;
_.getClass$ = function getClass_1434(){
  return Lorg_waveprotocol_wave_model_operation_wave_BlipOperation_2_classLit;
}
;
_.castableTypeMap$ = {};
_.context = null;
_.isWorthyOfAttribution = false;
function $equals_15(this$static, obj){
  var other;
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[449])) {
    return false;
  }
  other = dynamicCast(obj, 449);
  return $equal_0(this$static.contentOp, other.contentOp);
}

function $update_2(this$static, target){
  $update_1(this$static, target, this$static.method_0);
}

function $updatesBlipMetadata(this$static, blipId){
  return this$static.isWorthyOfAttribution && ($clinit_2213() , !(blipId.indexOf('attach') == 0 || $equals_3(blipId, 'mini') || blipId.indexOf('tr+') == 0));
}

function BlipContentOperation_0(context, contentOp){
  BlipContentOperation_1.call(this, context, contentOp, ($clinit_2206() , ADD_0));
}

function BlipContentOperation_1(context, contentOp, update){
  this.context = context;
  this.isWorthyOfAttribution = ($clinit_2213() , $clinit_2213() , $isWorthy(contentOp));
  checkNotNull_1(contentOp, 'Null document mutation');
  this.contentOp = contentOp;
  this.method_0 = update;
}

function BlipContentOperation(){
}

_ = BlipContentOperation_0.prototype = BlipContentOperation.prototype = new BlipOperation;
_.equals$ = function equals_63(obj){
  return $equals_15(this, obj);
}
;
_.getClass$ = function getClass_1435(){
  return Lorg_waveprotocol_wave_model_operation_wave_BlipContentOperation_2_classLit;
}
;
_.hashCode$ = function hashCode_62(){
  return 0;
}
;
_.toString$ = function toString_129(){
  return 'document op: ' + this.contentOp;
}
;
_.castableTypeMap$ = {449:1};
_.contentOp = null;
_.method_0 = null;
function $clinit_2206(){
  $clinit_2206 = nullMethod;
  ADD_0 = new BlipOperation$UpdateContributorMethod_0('ADD', 0);
  REMOVE_0 = new BlipOperation$UpdateContributorMethod_0('REMOVE', 1);
  NONE_7 = new BlipOperation$UpdateContributorMethod_0('NONE', 2);
  $VALUES_74 = initValues(_3Lorg_waveprotocol_wave_model_operation_wave_BlipOperation$UpdateContributorMethod_2_classLit, {9:1, 68:1, 170:1}, 159, [ADD_0, REMOVE_0, NONE_7]);
}

function BlipOperation$UpdateContributorMethod_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_81(name_0){
  $clinit_2206();
  return valueOf_0(($clinit_2207() , $MAP_74), name_0);
}

function values_75(){
  $clinit_2206();
  return $VALUES_74;
}

function BlipOperation$UpdateContributorMethod(){
}

_ = BlipOperation$UpdateContributorMethod_0.prototype = BlipOperation$UpdateContributorMethod.prototype = new Enum;
_.getClass$ = function getClass_1436(){
  return Lorg_waveprotocol_wave_model_operation_wave_BlipOperation$UpdateContributorMethod_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 159:1};
var $VALUES_74, ADD_0, NONE_7, REMOVE_0;
function $clinit_2207(){
  $clinit_2207 = nullMethod;
  $MAP_74 = createValueOfMap(($clinit_2206() , $VALUES_74));
}

var $MAP_74;
function WaveletBlipOperation_0(blipId, blipOp){
  this.context = blipOp.context;
  checkNotNull_1(blipId, 'Null blip ID');
  checkNotNull_1(blipOp, 'Null blip operation');
  this.blipId = blipId;
  this.blipOp = blipOp;
}

function WaveletBlipOperation(){
}

_ = WaveletBlipOperation_0.prototype = WaveletBlipOperation.prototype = new WaveletOperation;
_.doApply = function doApply_2(target){
  var blip, blip_0;
  blip = (blip_0 = dynamicCast(target.documents.get(this.blipId), 473) , !blip_0 && (blip_0 = $createDocument(target, this.blipId, this.context.creator, singleton_1(this.context.creator), ($clinit_2119() , EMPTY_DOCUMENT_0), this.context.timestamp, add_1(target.version, this.context.versionIncrement))) , blip_0);
  $apply_46(this.blipOp, blip);
}
;
_.equals$ = function equals_66(obj){
  var other;
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[452])) {
    return false;
  }
  other = dynamicCast(obj, 452);
  return $equals_3(this.blipId, other.blipId) && $equals_15(this.blipOp, other.blipOp);
}
;
_.getClass$ = function getClass_1439(){
  return Lorg_waveprotocol_wave_model_operation_wave_WaveletBlipOperation_2_classLit;
}
;
_.hashCode$ = function hashCode_65(){
  return getHashCode_0(this.blipId) ^ 0;
}
;
_.toString$ = function toString_132(){
  return this.blipOp + ' on blip ' + this.blipId + ' by ' + this.context.creator + ' at ' + new Date_2(this.context.timestamp) + ' version ' + this.context.hashedVersion + ' isWorthy ' + $isWorthyOfAttribution(this.blipOp, this.blipId);
}
;
_.castableTypeMap$ = {452:1, 466:1};
_.blipId = null;
_.blipOp = null;
function WaveletOperationContext_0(creator, timestamp){
  this.creator = creator;
  this.timestamp = timestamp;
  this.versionIncrement = P0_longLit;
  this.hashedVersion = null;
}

function WaveletOperationContext_1(creator, timestamp, versionIncrement, hashedVersion){
  this.creator = creator;
  this.timestamp = timestamp;
  this.versionIncrement = versionIncrement;
  this.hashedVersion = hashedVersion;
}

function WaveletOperationContext(){
}

_ = WaveletOperationContext_1.prototype = WaveletOperationContext_0.prototype = WaveletOperationContext.prototype = new Object_0;
_.getClass$ = function getClass_1440(){
  return Lorg_waveprotocol_wave_model_operation_wave_WaveletOperationContext_2_classLit;
}
;
_.toString$ = function toString_133(){
  return 'WaveletOperationContext(creator: ' + this.creator + ', timestamp: ' + toString_14(this.timestamp) + ', version increment: ' + toString_14(this.versionIncrement) + ',hashedVersion: ' + this.hashedVersion + ')';
}
;
_.castableTypeMap$ = {};
_.creator = null;
_.hashedVersion = null;
_.timestamp = P0_longLit;
_.versionIncrement = P0_longLit;
function $clinit_2213(){
  $clinit_2213 = nullMethod;
  TRUE_1 = new WorthyChangeChecker$True_0;
  CHECKER = new WorthyChangeChecker$2_0;
}

var CHECKER, TRUE_1;
function $isWorthy(op){
  var $e0;
  try {
    op.apply_8(($clinit_2213() , CHECKER));
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 453)) {
      return true;
    }
     else 
      throw $e0;
  }
  return false;
}

function WorthyChangeChecker$2_0(){
}

function WorthyChangeChecker$2(){
}

_ = WorthyChangeChecker$2_0.prototype = WorthyChangeChecker$2.prototype = new Object_0;
_.annotationBoundary = function annotationBoundary_21(map){
  var i, key, newValue, oldValue;
  for (i = 0; i < map.changeSize(); ++i) {
    key = map.getChangeKey_0(i);
    oldValue = map.getOldValue(i);
    newValue = map.getNewValue(i);
    if (!(oldValue == null?newValue == null:$equals_3(oldValue, newValue)) && key.indexOf('user/') != 0 && !$equals_3(key, 'spell') && !$equals_3(key, 'link/auto') && !$equals_3(key, 'tr/1') && !$equals_3(key, 'lang')) {
      throw $clinit_2213() , TRUE_1;
    }
  }
}
;
_.characters_0 = function characters_30(characters){
  throw $clinit_2213() , TRUE_1;
}
;
_.deleteCharacters = function deleteCharacters_32(chars){
  throw $clinit_2213() , TRUE_1;
}
;
_.deleteElementEnd = function deleteElementEnd_30(){
}
;
_.deleteElementStart = function deleteElementStart_30(type, attrs){
  $clinit_2213();
  if (!$equals_3(type, 'reply')) {
    throw TRUE_1;
  }
}
;
_.elementEnd = function elementEnd_27(){
}
;
_.elementStart = function elementStart_27(type, attributes){
  $clinit_2213();
  if (!$equals_3(type, 'reply')) {
    throw TRUE_1;
  }
}
;
_.getClass$ = function getClass_1441(){
  return Lorg_waveprotocol_wave_model_operation_wave_WorthyChangeChecker$2_2_classLit;
}
;
_.replaceAttributes = function replaceAttributes_32(oldAttrs, newAttrs){
  throw $clinit_2213() , TRUE_1;
}
;
_.retain = function retain_28(itemCount){
}
;
_.updateAttributes = function updateAttributes_32(attrUpdate){
  throw $clinit_2213() , TRUE_1;
}
;
_.castableTypeMap$ = {};
function WorthyChangeChecker$True_0(){
  this.fillInStackTrace();
  this.detailMessage = 'Preallocated exception with a meaningless stack trace';
}

function WorthyChangeChecker$True(){
}

_ = WorthyChangeChecker$True_0.prototype = WorthyChangeChecker$True.prototype = new RuntimeException;
_.fillInStackTrace = function fillInStackTrace_2(){
  return this;
}
;
_.getClass$ = function getClass_1442(){
  return Lorg_waveprotocol_wave_model_operation_wave_WorthyChangeChecker$True_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 21:1, 39:1, 183:1, 453:1};
function $addAttrWithValues(this$static, type, attrName, permittedValues){
  var attrs, value, value$index, value$max, values;
  checkArgument_2(!$equals_3('', type), 'Invalid type');
  checkNotNull_1(type, 'Null type');
  attrs = dynamicCast(this$static.permittedAttrs.get_4(type), 265);
  !attrs && this$static.permittedAttrs.put_3(type, attrs = ($clinit_2309() , defaultCollectionFactory.createStringMap()));
  if (permittedValues.length == 0) {
    attrs.put_3(attrName, null);
  }
   else {
    values = dynamicCast(attrs.get_4(attrName), 457);
    !values && attrs.put_3(attrName, values = ($clinit_2309() , defaultCollectionFactory.createStringSet()));
    for (value$index = 0 , value$max = permittedValues.length; value$index < value$max; ++value$index) {
      value = permittedValues[value$index];
      values.add_3(value);
    }
  }
}

function $addAttrs(this$static, type, attrNames){
  var name_0, name$index, name$max;
  checkArgument_2(!$equals_3('', type), 'Invalid type');
  checkNotNull_1(type, 'Null type');
  for (name$index = 0 , name$max = attrNames.length; name$index < name$max; ++name$index) {
    name_0 = attrNames[name$index];
    $addAttrWithValues(this$static, type, name_0, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, []));
  }
}

function $addChildren(this$static, parentType, childTypes){
  var childType, childType$index, childType$max, permitted;
  parentType = (checkArgument_2(!$equals_3('', parentType), 'Invalid type') , parentType == null?'':parentType);
  permitted = dynamicCast(this$static.permittedChildren.get_4(parentType), 457);
  !permitted && this$static.permittedChildren.put_3(parentType, permitted = ($clinit_2309() , defaultCollectionFactory.createStringSet()));
  for (childType$index = 0 , childType$max = childTypes.length; childType$index < childType$max; ++childType$index) {
    childType = childTypes[childType$index];
    checkArgument_2(!$equals_3('', childType), 'Invalid type');
    checkNotNull_1(childType, 'Null type');
    permitted.add_3(childType);
  }
}

function $containsBlipText(this$static, types){
  var type, type$index, type$max;
  for (type$index = 0 , type$max = types.length; type$index < type$max; ++type$index) {
    type = types[type$index];
    type = (checkArgument_2(!$equals_3('', type), 'Invalid type') , type == null?'':type);
    this$static.textPermitted.put_3(type, ($clinit_2011() , BLIP_TEXT));
  }
}

function $permitsAttribute(this$static, type, attr, value){
  var attrs;
  checkArgument_2(!$equals_3('', type), 'Invalid type');
  checkNotNull_1(type, 'Null type');
  attrs = dynamicCast(this$static.permittedAttrs.get_4(type), 265);
  return !!attrs && attrs.containsKey_1(attr) && (attrs.get_4(attr) == null || dynamicCast(attrs.get_4(attr), 457).contains_0(value));
}

function AbstractXmlSchemaConstraints_0(){
  this.permittedChildren = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  this.permittedAttrs = defaultCollectionFactory.createStringMap();
  this.textPermitted = defaultCollectionFactory.createStringMap();
  this.requiredInitial = defaultCollectionFactory.createStringMap();
}

function AbstractXmlSchemaConstraints(){
}

_ = AbstractXmlSchemaConstraints.prototype = new Object_0;
_.getClass$ = function getClass_1449(){
  return Lorg_waveprotocol_wave_model_schema_AbstractXmlSchemaConstraints_2_classLit;
}
;
_.getRequiredInitialChildren = function getRequiredInitialChildren_0(type){
  type = (checkArgument_2(!$equals_3('', type), 'Invalid type') , type == null?'':type);
  return this.requiredInitial.containsKey_1(type)?dynamicCast(this.requiredInitial.get_4(type), 41):($clinit_480() , $clinit_480() , EMPTY_LIST);
}
;
_.permitsAttribute = function permitsAttribute_1(type, attr){
  var attrs;
  checkArgument_2(!$equals_3('', type), 'Invalid type');
  checkNotNull_1(type, 'Null type');
  attrs = dynamicCast(this.permittedAttrs.get_4(type), 265);
  return !!attrs && attrs.containsKey_1(attr);
}
;
_.permitsAttribute_0 = function permitsAttribute_2(type, attr, value){
  return $permitsAttribute(this, type, attr, value);
}
;
_.permitsChild = function permitsChild_0(parentType, childType){
  var permitted;
  parentType = (checkArgument_2(!$equals_3('', parentType), 'Invalid type') , parentType == null?'':parentType);
  checkArgument_2(!$equals_3('', childType), 'Invalid type');
  checkNotNull_1(childType, 'Null type');
  permitted = dynamicCast(this.permittedChildren.get_4(parentType), 457);
  return !!permitted && permitted.contains_0(childType);
}
;
_.permittedCharacters = function permittedCharacters_0(typeOrNull){
  var permitted;
  typeOrNull = (checkArgument_2(!$equals_3('', typeOrNull), 'Invalid type') , typeOrNull == null?'':typeOrNull);
  permitted = dynamicCast(this.textPermitted.get_4(typeOrNull), 148);
  return permitted?permitted:($clinit_2011() , NONE_3);
}
;
_.castableTypeMap$ = {459:1};
function $clinit_2229(){
  $clinit_2229 = nullMethod;
  BOOLEAN_VALUES = initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['true', 'false']);
}

function isValidInteger(value, min){
  $clinit_2229();
  var $e0, x;
  try {
    x = __parseAndValidateInt(value, 10);
    return x >= min;
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 188)) {
      return false;
    }
     else 
      throw $e0;
  }
}

var BOOLEAN_VALUES;
function $clinit_2230(){
  $clinit_2230 = nullMethod;
  BLIP_SCHEMA_CONSTRAINTS = new ConversationSchemas$DefaultDocumentSchema_0;
  MANIFEST_SCHEMA_CONSTRAINTS = new ConversationSchemas$1_0;
}

function ConversationSchemas_0(){
  $clinit_2230();
  this.schemas = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  this.schemas.put_3('conversation', MANIFEST_SCHEMA_CONSTRAINTS);
}

function ConversationSchemas(){
}

_ = ConversationSchemas_0.prototype = ConversationSchemas.prototype = new Object_0;
_.getClass$ = function getClass_1451(){
  return Lorg_waveprotocol_wave_model_schema_conversation_ConversationSchemas_2_classLit;
}
;
_.getSchemaForId = function getSchemaForId_0(waveletId, documentId){
  var tokens, tokens_0;
  if ($equals_3((tokens = $split_0(($clinit_2178() , DEFAULT_ESCAPER), waveletId.id_0) , tokens.length > 1?tokens[0]:''), 'conv') || $isEmpty_1((tokens_0 = $split_0(DEFAULT_ESCAPER, waveletId.id_0) , tokens_0.length > 1?tokens_0[0]:''))) {
    if (documentId.indexOf('b+') == 0 || documentId.indexOf('g+') == 0 || documentId.indexOf('*') != -1 && documentId.indexOf('m/') != 0 && documentId.indexOf('attach+') != 0 && documentId.indexOf('spell+') != 0) {
      return BLIP_SCHEMA_CONSTRAINTS;
    }
     else if (this.schemas.containsKey_1(documentId)) {
      return dynamicCast(this.schemas.get_4(documentId), 459);
    }
  }
  return $clinit_2009() , NO_SCHEMA_CONSTRAINTS;
}
;
_.castableTypeMap$ = {458:1};
_.schemas = null;
var BLIP_SCHEMA_CONSTRAINTS, MANIFEST_SCHEMA_CONSTRAINTS;
function ConversationSchemas$1_0(){
  AbstractXmlSchemaConstraints_0.call(this);
  $addChildren(this, null, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['conversation']));
  $addAttrs(this, 'conversation', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['anchorWavelet', 'anchorManifestOffset', 'anchorVersion', 'anchorBlip', 'anchorOffset', 'sort']));
  $addChildren(this, 'conversation', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['blip']));
  $addAttrs(this, 'blip', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['id']));
  $addAttrWithValues(this, 'blip', 'deleted', ($clinit_2229() , BOOLEAN_VALUES));
  $addChildren(this, 'blip', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['thread']));
  $addChildren(this, 'blip', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['peer']));
  $addAttrs(this, 'thread', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['id']));
  $addAttrWithValues(this, 'thread', 'inline', BOOLEAN_VALUES);
  $addChildren(this, 'thread', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['blip']));
  $addAttrs(this, 'peer', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['id']));
}

function ConversationSchemas$1(){
}

_ = ConversationSchemas$1_0.prototype = ConversationSchemas$1.prototype = new AbstractXmlSchemaConstraints;
_.getClass$ = function getClass_1452(){
  return Lorg_waveprotocol_wave_model_schema_conversation_ConversationSchemas$1_2_classLit;
}
;
_.permitsAttribute_0 = function permitsAttribute_3(tag, attr, value){
  if ($equals_3('conversation', tag)) {
    if ($equals_3('anchorWavelet', attr)) {
      return isConversationalId($fromString(($clinit_2183() , value)));
    }
     else if ($indexOf_3(new Arrays$ArrayList_0(initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['anchorManifestOffset', 'anchorVersion', 'anchorOffset'])), attr) != -1) {
      return $clinit_2229() , isValidInteger(value, 0);
    }
     else if ($equals_3('anchorBlip', attr)) {
      return value.indexOf('b+') == 0 || value.indexOf('g+') == 0 || value.indexOf('*') != -1 && value.indexOf('m/') != 0 && value.indexOf('attach+') != 0 && value.indexOf('spell+') != 0;
    }
  }
  if ($equals_3('blip', tag) && $equals_3('id', attr)) {
    return value.indexOf('b+') == 0 || value.indexOf('g+') == 0 || value.indexOf('*') != -1 && value.indexOf('m/') != 0 && value.indexOf('attach+') != 0 && value.indexOf('spell+') != 0;
  }
  return $permitsAttribute(this, tag, attr, value);
}
;
_.castableTypeMap$ = {459:1};
function $$init_242(this$static){
  var gadgetEl, gadgetEl$array, gadgetEl$index, gadgetEl$max;
  $addChildren(this$static, null, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['head']));
  $addChildren(this$static, 'head', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['timestamp']));
  $addChildren(this$static, 'timestamp', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['lmt']));
  $addAttrs(this$static, 'lmt', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['t']));
  $addChildren(this$static, null, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['body']));
  $lineContainer(this$static, 'body');
  $addAttrWithValues(this$static, 'line', 't', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['h1', 'h2', 'h3', 'h4', 'li']));
  $addAttrWithValues(this$static, 'line', 'listyle', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['decimal']));
  $addAttrWithValues(this$static, 'line', 'a', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['l', 'r', 'c', 'j']));
  $addAttrWithValues(this$static, 'line', 'd', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['l', 'r']));
  $addAttrWithValues(this$static, 'line', 'i', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, []));
  $addChildren(this$static, 'image', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['caption']));
  $addAttrWithValues(this$static, 'image', 'attachment', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, []));
  $addAttrWithValues(this$static, 'image', 'style', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['full']));
  $addChildren(this$static, 'image', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['gadget']));
  $containsBlipText(this$static, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['caption']));
  $addChildren(this$static, 'caption', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['reply']));
  $containsBlipText(this$static, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['label']));
  $containsBlipText(this$static, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['input']));
  $addAttrs(this$static, 'reply', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['id']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['button', 'check', 'input', 'label', 'password', 'radiogroup', 'radio', 'textarea']));
  $lineContainer(this$static, 'textarea');
  $addAttrs(this$static, 'button', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['name']));
  $addChildren(this$static, 'button', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['caption', 'events']));
  $addChildren(this$static, 'events', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['click']));
  $addAttrs(this$static, 'click', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['time', 'clicker']));
  $addAttrs(this$static, 'check', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['name', 'submit', 'value']));
  $addAttrs(this$static, 'radiogroup', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['name', 'submit', 'value']));
  $addAttrs(this$static, 'password', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['name', 'submit', 'value']));
  $addAttrs(this$static, 'textarea', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['name', 'submit', 'value']));
  $addAttrs(this$static, 'input', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['name', 'submit']));
  $addAttrs(this$static, 'radio', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['name', 'group']));
  $addAttrs(this$static, 'click', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['time', 'clicker']));
  $addAttrs(this$static, 'label', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['for']));
  $addChildren(this$static, 'gadget', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['title', 'thumbnail', 'category', 'state', 'pref']));
  $addAttrs(this$static, 'gadget', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['url', 'title', 'prefs', 'state', 'author', 'height', 'width', 'id', 'extension', 'ifr', 'snippet']));
  for (gadgetEl$array = initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['category', 'state', 'pref']) , gadgetEl$index = 0 , gadgetEl$max = gadgetEl$array.length; gadgetEl$index < gadgetEl$max; ++gadgetEl$index) {
    gadgetEl = gadgetEl$array[gadgetEl$index];
    $addAttrs(this$static, gadgetEl, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['name']));
  }
  for (gadgetEl$array = initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['title', 'thumbnail', 'state', 'pref']) , gadgetEl$index = 0 , gadgetEl$max = gadgetEl$array.length; gadgetEl$index < gadgetEl$max; ++gadgetEl$index) {
    gadgetEl = gadgetEl$array[gadgetEl$index];
    $addAttrs(this$static, gadgetEl, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['value']));
  }
  $addChildren(this$static, 'profile', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['profile-field', 'gadget']));
  $addAttrs(this$static, 'profile-field', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['name', 'user-set']));
  $addAttrs(this$static, 'profile', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['avatar-url']));
  $containsBlipText(this$static, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['profile-field']));
  $addChildren(this$static, 'mediasearch', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['result', 'customsearch']));
  $addAttrs(this$static, 'mediasearch', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['page', 'corpora', 'query', 'selected', 'pending', 'lang']));
  $addAttrs(this$static, 'result', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['thumbnail', 'thumbwidth', 'thumbheight', 'content', 'url', 'dispurl', 'title', 'snippet', 'num', 'type', 'disphtml']));
  $addAttrs(this$static, 'customsearch', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['name', 'icon', 'shortname', 'resultrows', 'resultcols', 'addmethod']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['trustreq']));
  $containsBlipText(this$static, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['trustreq']));
  $addChildren(this$static, 'trustreq', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['trwave']));
  $addAttrs(this$static, 'trustreq', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['from', 'numberOfWaves', 'userAction']));
  $addAttrs(this$static, 'trwave', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['messageCount', 'lastModified']));
  $containsBlipText(this$static, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['trwave']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['blacklist']));
  $addAttrs(this$static, 'blacklist', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['address', 'contacts']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['invitation']));
  $addAttrs(this$static, 'invitation', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['remaining', 'title', 'invitedString']));
  $addChildren(this$static, 'invitation', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['invited']));
  $addAttrs(this$static, 'invited', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['address']));
  $addAttrWithValues(this$static, 'eqn', 'format', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['tex']));
  $containsBlipText(this$static, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['eqn']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['settings']));
  $addAttrs(this$static, 'settings', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['name']));
  $addChildren(this$static, 'settings', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['bool-setting', 'radio-setting', 'text-setting', 'listbox-setting']));
  $addAttrs(this$static, 'bool-setting', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['id', 'live-value', 'saved-value']));
  $addAttrs(this$static, 'radio-setting', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['id', 'live-value', 'saved-value']));
  $addAttrs(this$static, 'listbox-setting', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['id', 'live-value', 'saved-value']));
  $addAttrs(this$static, 'text-setting', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['id', 'saved-value']));
  $containsBlipText(this$static, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['text-setting']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['html']));
  $addChildren(this$static, 'html', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['data']));
  $containsBlipText(this$static, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['data']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['experimental']));
  $addAttrs(this$static, 'experimental', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['url']));
  $addChildren(this$static, 'experimental', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['namevaluepair', 'part']));
  $addAttrs(this$static, 'part', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['id']));
  $lineContainer(this$static, 'part');
  $addChildren(this$static, 'part', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['button', 'check', 'input', 'label', 'password', 'radiogroup', 'radio', 'textarea']));
  $addAttrs(this$static, 'namevaluepair', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['name']));
  $addAttrs(this$static, 'namevaluepair', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['value']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['translation']));
  $addChildren(this$static, 'translation', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['stanza']));
  $lineContainer(this$static, 'stanza');
  $addAttrs(this$static, 'stanza', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['lang', 'users']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['extension_installer']));
  $addAttrs(this$static, 'extension_installer', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['manifest', 'img', 'installed']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['ext-settings']));
  $addAttrs(this$static, 'ext-settings', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['manifest', 'enabled']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['gadget-settings']));
  $addAttrs(this$static, 'gadget-settings', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['url', 'prefs']));
  $addAttrs(this$static, 'img', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['alt', 'height', 'width', 'src']));
  $addChildren(this$static, 'body', initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['quote']));
  $lineContainer(this$static, 'quote');
}

function $lineContainer(this$static, element){
  $addChildren(this$static, element, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['line', 'image', 'gadget', 'eqn', 'experimental', 'mediasearch', 'img', 'reply', 'profile']));
  $containsBlipText(this$static, initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, [element]));
  this$static.requiredInitial.put_3(element, ($clinit_480() , new Collections$SingletonList_0));
}

function ConversationSchemas$DefaultDocumentSchema_0(){
  AbstractXmlSchemaConstraints_0.call(this);
  $$init_242(this);
}

function ConversationSchemas$DefaultDocumentSchema(){
}

_ = ConversationSchemas$DefaultDocumentSchema_0.prototype = ConversationSchemas$DefaultDocumentSchema.prototype = new AbstractXmlSchemaConstraints;
_.getClass$ = function getClass_1453(){
  return Lorg_waveprotocol_wave_model_schema_conversation_ConversationSchemas$DefaultDocumentSchema_2_classLit;
}
;
_.permitsAttribute_0 = function permitsAttribute_4(tag, attr, value){
  if ($equals_3('line', tag) && $equals_3('i', attr)) {
    return $clinit_2229() , isValidInteger(value, 1);
  }
  if ($equals_3('img', tag) && ($equals_3('width', attr) || $equals_3('height', attr))) {
    return isValidInteger(value, 0);
  }
  if ($equals_3('lmt', tag) && $equals_3('t', attr)) {
    return $clinit_2229() , isValidInteger(value, 0);
  }
  if ($equals_3('invitation', tag) && $equals_3('remaining', attr)) {
    return $clinit_2229() , isValidInteger(value, 0);
  }
  return $permitsAttribute(this, tag, attr, value);
}
;
_.castableTypeMap$ = {459:1};
function $triggerEvaluationAdded(this$static, newEvaluation){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 460);
    $triggerOnWantedEvaluationAdded(l_0.this$0, newEvaluation);
  }
}

function DocumentBasedAbuseStore_0(list){
  this.listeners = ($clinit_2326() , $clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
  this.list = list;
  $add_31(this.list.listeners, new DocumentBasedAbuseStore$1_0(this));
}

function create_60(router){
  var list, list_0;
  list = (list_0 = new DocumentBasedElementList_0(router, router.getDocument_0().getDocumentElement(), 'wanted', new DocumentBasedAbuseStore$ElementFactory_0) , list_0.router.addChildListener(list_0.parent_0, list_0) , $load_2(list_0) , list_0);
  return new DocumentBasedAbuseStore_0(list);
}

function DocumentBasedAbuseStore(){
}

_ = DocumentBasedAbuseStore_0.prototype = DocumentBasedAbuseStore.prototype = new Object_0;
_.addListener = function addListener_16(listener){
  $add_31(this.listeners, dynamicCast(listener, 460));
}
;
_.getClass$ = function getClass_1454(){
  return Lorg_waveprotocol_wave_model_supplement_DocumentBasedAbuseStore_2_classLit;
}
;
_.removeListener = function removeListener_16(listener){
  $remove_42(this.listeners, dynamicCast(listener, 460));
}
;
_.castableTypeMap$ = {};
_.list = null;
function DocumentBasedAbuseStore$1_0(this$0){
  this.this$0 = this$0;
}

function DocumentBasedAbuseStore$1(){
}

_ = DocumentBasedAbuseStore$1_0.prototype = DocumentBasedAbuseStore$1.prototype = new Object_0;
_.getClass$ = function getClass_1455(){
  return Lorg_waveprotocol_wave_model_supplement_DocumentBasedAbuseStore$1_2_classLit;
}
;
_.onValueAdded = function onValueAdded_1(entry){
  $triggerEvaluationAdded(this.this$0, dynamicCast(entry, 461));
}
;
_.onValueRemoved = function onValueRemoved_1(entry){
  dynamicCast(entry, 461);
}
;
_.castableTypeMap$ = {356:1};
_.this$0 = null;
function DocumentBasedAbuseStore$ElementFactory_0(){
}

function DocumentBasedAbuseStore$ElementFactory(){
}

_ = DocumentBasedAbuseStore$ElementFactory_0.prototype = DocumentBasedAbuseStore$ElementFactory.prototype = new Object_0;
_.adapt = function adapt_2(router, element){
  var adderAddress, agentIdentity, certainty, comment, document_0, ignored, timestamp, wanted, waveletId, attribute, attribute_0, attribute_1;
  return document_0 = router.getDocument_0() , waveletId = $fromString(($clinit_2183() , document_0.getAttribute_0(element, 'wavelet_id'))) , wanted = $fromString_3(($clinit_2363() , document_0.getAttribute_0(element, 'wanted')), ($clinit_428() , $clinit_428() , FALSE_0)).value_0 , certainty = $fromString_4(document_0.getAttribute_0(element, 'certainty'), new Double_0(0)).value_0 , timestamp = $fromString_1(document_0.getAttribute_0(element, 'timestamp'), valueOf_14(P0_longLit)).value_0 , ignored = $fromString_3(document_0.getAttribute_0(element, 'ignored'), FALSE_0).value_0 , agentIdentity = (attribute = document_0.getAttribute_0(element, 'agent') , attribute == null?'':attribute) , comment = (attribute_0 = document_0.getAttribute_0(element, 'comment') , attribute_0 == null?'':attribute_0) , adderAddress = (attribute_1 = document_0.getAttribute_0(element, 'adder') , attribute_1 == null?'':attribute_1) , new SimpleWantedEvaluation_0(waveletId, adderAddress, wanted, certainty, timestamp, agentIdentity, ignored, comment);
}
;
_.createInitializer = function createInitializer_2(wantedEvaluation){
  return new DocumentBasedAbuseStore$ElementFactory$1_0(dynamicCast(wantedEvaluation, 461));
}
;
_.getClass$ = function getClass_1456(){
  return Lorg_waveprotocol_wave_model_supplement_DocumentBasedAbuseStore$ElementFactory_2_classLit;
}
;
_.castableTypeMap$ = {};
function DocumentBasedAbuseStore$ElementFactory$1_0(val$wantedEvaluation){
  this.val$wantedEvaluation = val$wantedEvaluation;
}

function DocumentBasedAbuseStore$ElementFactory$1(){
}

_ = DocumentBasedAbuseStore$ElementFactory$1_0.prototype = DocumentBasedAbuseStore$ElementFactory$1.prototype = new Object_0;
_.getClass$ = function getClass_1457(){
  return Lorg_waveprotocol_wave_model_supplement_DocumentBasedAbuseStore$ElementFactory$1_2_classLit;
}
;
_.initialize = function initialize_2(target){
  target.put('wavelet_id', $toString_28(dynamicCast(($clinit_2183() , this.val$wantedEvaluation.waveletId), 446)));
  target.put('wanted', $toString_33(dynamicCast(($clinit_2363() , $clinit_428() , this.val$wantedEvaluation.wanted?TRUE_0:FALSE_0), 62)));
  target.put('certainty', $toString_35(dynamicCast(new Double_0(this.val$wantedEvaluation.certainty), 64)));
  target.put('timestamp', $toString_30(dynamicCast(valueOf_14(this.val$wantedEvaluation.timestamp), 67)));
  target.put('adder', this.val$wantedEvaluation.adderAddress);
  target.put('agent', this.val$wantedEvaluation.agentIdentity);
  target.put('comment', this.val$wantedEvaluation.comment);
  target.put('ignored', $toString_33(dynamicCast(this.val$wantedEvaluation.ignored?TRUE_0:FALSE_0, 62)));
}
;
_.castableTypeMap$ = {18:1};
_.val$wantedEvaluation = null;
function $getStateMap(this$static){
  var key, key$iterator, stateMap;
  if (($clinit_480() , new Collections$UnmodifiableSet_0($keySet_0(this$static.state.entries))).coll.isEmpty()) {
    return $clinit_2309() , $clinit_2309() , EMPTY_MAP_2;
  }
  stateMap = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  for (key$iterator = (new Collections$UnmodifiableSet_0($keySet_0(this$static.state.entries))).iterator_0(); key$iterator.hasNext();) {
    key = dynamicCast(key$iterator.next_0(), 1);
    stateMap.put_3(key, dynamicCast($get_21(this$static.state, key), 1));
  }
  return stateMap;
}

function $setState_4(this$static, key, value){
  checkNotNull_1(key, 'Private gadget state key is null.');
  value != null?$put_8(this$static.state, key, value):$remove_38(this$static.state, key);
}

function DocumentBasedGadgetState_0(router, container){
  var map;
  this.state = (map = new DocumentBasedBasicMap_0(router, container, ($clinit_2363() , STRING), STRING, 'state', 'name', 'value') , $addChildListener(map.router, map.container, map) , $load_0(map) , map);
}

function create_61(router, container, id, listener){
  var state;
  state = new DocumentBasedGadgetState_0(router, container);
  $add_31(state.state.listeners, new DocumentBasedGadgetState$1_0(listener, id));
  return state;
}

function DocumentBasedGadgetState(){
}

_ = DocumentBasedGadgetState_0.prototype = DocumentBasedGadgetState.prototype = new Object_0;
_.getClass$ = function getClass_1458(){
  return Lorg_waveprotocol_wave_model_supplement_DocumentBasedGadgetState_2_classLit;
}
;
_.castableTypeMap$ = {462:1};
_.state = null;
function DocumentBasedGadgetState$1_0(val$listener, val$gadgetId){
  this.val$listener = val$listener;
  this.val$gadgetId = val$gadgetId;
}

function DocumentBasedGadgetState$1(){
}

_ = DocumentBasedGadgetState$1_0.prototype = DocumentBasedGadgetState$1.prototype = new Object_0;
_.getClass$ = function getClass_1459(){
  return Lorg_waveprotocol_wave_model_supplement_DocumentBasedGadgetState$1_2_classLit;
}
;
_.onEntrySet = function onEntrySet(key, oldValue, newValue){
  $triggerOnGadgetStateChanged(this.val$listener.this$0, this.val$gadgetId, dynamicCast(key, 1), dynamicCast(oldValue, 1), dynamicCast(newValue, 1));
}
;
_.castableTypeMap$ = {354:1};
_.val$gadgetId = null;
_.val$listener = null;
function DocumentBasedWaveletReadState_0(router, container){
  var map;
  this.blips = (map = new DocumentBasedMonotonicMap_0(router, container, ($clinit_2363() , STRING), INTEGER, 'blip', 'v') , $addChildListener(map.router, map.container, map) , $load_0(map) , map);
  this.participants = create_52(router, container, INTEGER, 'participants');
  this.tags = create_52(router, container, INTEGER, 'tags');
  this.wavelet = create_52(router, container, INTEGER, 'all');
}

function create_62(router, container, id, listener){
  var x;
  x = new DocumentBasedWaveletReadState_0(router, container);
  $add_31(x.blips.listeners, new DocumentBasedWaveletReadState$1_0(listener, id));
  $add_31(x.participants.listeners, new DocumentBasedWaveletReadState$2_0(listener, id));
  $add_31(x.tags.listeners, new DocumentBasedWaveletReadState$3_0(listener, id));
  $add_31(x.wavelet.listeners, new DocumentBasedWaveletReadState$4_0(listener, id));
  return x;
}

function valueOf_84(version){
  return version?version.value_0:-1;
}

function DocumentBasedWaveletReadState(){
}

_ = DocumentBasedWaveletReadState_0.prototype = DocumentBasedWaveletReadState.prototype = new Object_0;
_.getClass$ = function getClass_1460(){
  return Lorg_waveprotocol_wave_model_supplement_DocumentBasedWaveletReadState_2_classLit;
}
;
_.castableTypeMap$ = {464:1};
_.blips = null;
_.participants = null;
_.tags = null;
_.wavelet = null;
function $onEntrySet_0(this$static, key, oldValue, newValue){
  $triggerOnLastReadBlipVersionChanged(this$static.val$listener.this$0, this$static.val$wid, key, oldValue?oldValue.value_0:-1, newValue?newValue.value_0:-1);
}

function DocumentBasedWaveletReadState$1_0(val$listener, val$wid){
  this.val$listener = val$listener;
  this.val$wid = val$wid;
}

function DocumentBasedWaveletReadState$1(){
}

_ = DocumentBasedWaveletReadState$1_0.prototype = DocumentBasedWaveletReadState$1.prototype = new Object_0;
_.getClass$ = function getClass_1461(){
  return Lorg_waveprotocol_wave_model_supplement_DocumentBasedWaveletReadState$1_2_classLit;
}
;
_.onEntrySet = function onEntrySet_0(key, oldValue, newValue){
  $onEntrySet_0(this, dynamicCast(key, 1), dynamicCast(oldValue, 66), dynamicCast(newValue, 66));
}
;
_.castableTypeMap$ = {354:1};
_.val$listener = null;
_.val$wid = null;
function DocumentBasedWaveletReadState$2_0(val$listener, val$wid){
  this.val$listener = val$listener;
  this.val$wid = val$wid;
}

function DocumentBasedWaveletReadState$2(){
}

_ = DocumentBasedWaveletReadState$2_0.prototype = DocumentBasedWaveletReadState$2.prototype = new Object_0;
_.getClass$ = function getClass_1462(){
  return Lorg_waveprotocol_wave_model_supplement_DocumentBasedWaveletReadState$2_2_classLit;
}
;
_.onSet = function onSet(oldValue, newValue){
  $triggerOnLastReadParticipantsVersionChanged(this.val$listener.this$0, this.val$wid, oldValue?oldValue.value_0:-1, newValue?newValue.value_0:-1);
}
;
_.castableTypeMap$ = {357:1};
_.val$listener = null;
_.val$wid = null;
function DocumentBasedWaveletReadState$3_0(val$listener, val$wid){
  this.val$listener = val$listener;
  this.val$wid = val$wid;
}

function DocumentBasedWaveletReadState$3(){
}

_ = DocumentBasedWaveletReadState$3_0.prototype = DocumentBasedWaveletReadState$3.prototype = new Object_0;
_.getClass$ = function getClass_1463(){
  return Lorg_waveprotocol_wave_model_supplement_DocumentBasedWaveletReadState$3_2_classLit;
}
;
_.onSet = function onSet_0(oldValue, newValue){
  $triggerOnLastReadTagsVersionChanged(this.val$listener.this$0, this.val$wid, oldValue?oldValue.value_0:-1, newValue?newValue.value_0:-1);
}
;
_.castableTypeMap$ = {357:1};
_.val$listener = null;
_.val$wid = null;
function DocumentBasedWaveletReadState$4_0(val$listener, val$wid){
  this.val$listener = val$listener;
  this.val$wid = val$wid;
}

function DocumentBasedWaveletReadState$4(){
}

_ = DocumentBasedWaveletReadState$4_0.prototype = DocumentBasedWaveletReadState$4.prototype = new Object_0;
_.getClass$ = function getClass_1464(){
  return Lorg_waveprotocol_wave_model_supplement_DocumentBasedWaveletReadState$4_2_classLit;
}
;
_.onSet = function onSet_1(oldValue, newValue){
  $triggerOnLastReadWaveletVersionChanged(this.val$listener.this$0, this.val$wid, oldValue?oldValue.value_0:-1, newValue?newValue.value_0:-1);
}
;
_.castableTypeMap$ = {357:1};
_.val$listener = null;
_.val$wid = null;
function DocumentBasedWaveletThreadState_0(router, container){
  var map;
  this.threadStateSerializer = new Serializer$EnumSerializer_0(Lorg_waveprotocol_wave_model_supplement_ThreadState_2_classLit);
  this.threadStates = (map = new DocumentBasedBasicMap_0(router, container, ($clinit_2363() , STRING), this.threadStateSerializer, 'thread', 'i', 'state') , $addChildListener(map.router, map.container, map) , $load_0(map) , map);
}

function create_63(router, container, id, listener){
  var x;
  x = new DocumentBasedWaveletThreadState_0(router, container);
  $add_31(x.threadStates.listeners, new DocumentBasedWaveletThreadState$1_0(listener, id));
  return x;
}

function DocumentBasedWaveletThreadState(){
}

_ = DocumentBasedWaveletThreadState_0.prototype = DocumentBasedWaveletThreadState.prototype = new Object_0;
_.getClass$ = function getClass_1465(){
  return Lorg_waveprotocol_wave_model_supplement_DocumentBasedWaveletThreadState_2_classLit;
}
;
_.castableTypeMap$ = {465:1};
_.threadStates = null;
function DocumentBasedWaveletThreadState$1_0(val$listener, val$wid){
  this.val$listener = val$listener;
  this.val$wid = val$wid;
}

function DocumentBasedWaveletThreadState$1(){
}

_ = DocumentBasedWaveletThreadState$1_0.prototype = DocumentBasedWaveletThreadState$1.prototype = new Object_0;
_.getClass$ = function getClass_1466(){
  return Lorg_waveprotocol_wave_model_supplement_DocumentBasedWaveletThreadState$1_2_classLit;
}
;
_.onEntrySet = function onEntrySet_1(key, oldValue, newValue){
  $triggerOnThreadStateChanged_0(this.val$listener.this$0, this.val$wid, dynamicCast(key, 1), dynamicCast(oldValue, 162), dynamicCast(newValue, 162));
}
;
_.castableTypeMap$ = {354:1};
_.val$listener = null;
_.val$wid = null;
function $getSupplement_0(this$static, gadgetId){
  var state;
  checkNotNull_1(gadgetId, 'Gadget ID must not be null');
  state = dynamicCast(this$static.gadgetSupplements.get_4(gadgetId), 462);
  if (!state) {
    this$static.router.getDocument_0().createChildElement(this$static.router.getDocument_0().getDocumentElement(), 'gadget', new AttributesImpl_3(initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['i', gadgetId])));
    state = dynamicCast(this$static.gadgetSupplements.get_4(gadgetId), 462);
  }
  return state;
}

function $load_4(this$static){
  var child, doc;
  doc = this$static.router.getDocument_0();
  child = getFirstChildElement(doc, doc.getDocumentElement());
  while (child != null) {
    $onElementAdded_4(this$static, child);
    child = getNextElementInclusive(doc, doc.getNextSibling(child), true);
  }
}

function $onElementAdded_4(this$static, element){
  var doc, existing, gadgetId, state;
  doc = this$static.router.getDocument_0();
  if (!$equals_3('gadget', doc.getTagName(element))) {
    return;
  }
  gadgetId = this$static.router.getDocument_0().getAttribute_0(element, 'i');
  if (gadgetId != null) {
    existing = dynamicCast(this$static.gadgetSupplements.get_4(gadgetId), 462);
    if (!existing) {
      state = create_61(this$static.router, element, gadgetId, this$static.listener);
      this$static.gadgetSupplements.put_3(gadgetId, state);
      $triggerOnGadgetStateChanged(this$static.listener.this$0, gadgetId, null, null, null);
    }
  }
}

function $setGadgetState_0(this$static, gadgetId, key, value){
  $setState_4($getSupplement_0(this$static, gadgetId), key, value);
}

function GadgetStateCollection_0(router, listener){
  this.gadgetSupplements = ($clinit_2309() , defaultCollectionFactory.createStringMap());
  this.router = router;
  this.listener = listener;
}

function create_64(router, container, listener){
  var col;
  col = new GadgetStateCollection_0(router, listener);
  $addChildListener(router, container, col);
  $load_4(col);
  return col;
}

function GadgetStateCollection(){
}

_ = GadgetStateCollection_0.prototype = GadgetStateCollection.prototype = new Object_0;
_.getClass$ = function getClass_1467(){
  return Lorg_waveprotocol_wave_model_supplement_GadgetStateCollection_2_classLit;
}
;
_.onElementAdded = function onElementAdded_5(element){
  $onElementAdded_4(this, element);
}
;
_.onElementRemoved = function onElementRemoved_5(element){
  var gadgetId;
  if ($equals_3('gadget', this.router.getDocument_0().getTagName(element))) {
    gadgetId = this.router.getDocument_0().getAttribute_0(element, 'i');
    gadgetId != null && this.gadgetSupplements.remove_8(gadgetId);
  }
}
;
_.castableTypeMap$ = {434:1};
_.listener = null;
_.router = null;
function $triggerOnFolderAdded(this$static, newFolder){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 264);
    listener.onFolderAdded(newFolder);
  }
}

function $triggerOnMaybeBlipReadChanged(this$static, blip){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 264);
    listener.onMaybeBlipReadChanged(blip);
  }
}

function $triggerOnMaybeBlipReadChanged_0(this$static, wid, bid){
  var blip, c, conversationId;
  blip = (conversationId = $toString_28(dynamicCast(($clinit_2183() , wid), 446)) , c = $getConversation(this$static.conversationView, conversationId != null?$deserialize(conversationId):null) , c?dynamicCast(c.blips.get_4(bid), 373):null);
  !!blip && $triggerOnMaybeBlipReadChanged(this$static, blip);
}

function $triggerOnMaybeFollowStateChanged(this$static){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 264);
    listener.onMaybeFollowStateChanged();
  }
}

function $triggerOnMaybeGadgetStateChanged(this$static, gadgetId){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 264);
    listener.onMaybeGadgetStateChanged(gadgetId);
  }
}

function $triggerOnMaybeInboxStateChanged(this$static){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 264);
    listener.onMaybeInboxStateChanged();
  }
}

function $triggerOnMaybeParticipantsReadChanged(this$static, wavelet){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 264);
    listener.onMaybeParticipantsReadChanged(wavelet);
  }
}

function $triggerOnMaybeTagsReadChanged(this$static, wavelet){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 264);
    listener.onMaybeTagsReadChanged(wavelet);
  }
}

function $triggerOnMaybeWaveletReadChanged(this$static){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 264);
    listener.onMaybeWaveletReadChanged();
  }
}

function $triggerOnThreadStateChanged(this$static, thread){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 264);
    listener.onThreadStateChanged(thread);
  }
}

function $triggerOnWantedEvaluationsChanged(this$static, waveletId){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 264);
    listener.onWantedEvaluationsChanged(waveletId);
  }
}

function LiveSupplementedWaveImpl_0(supplement, wave, view){
  var conversation, conversation$iterator, viewListener;
  this.delegate = new SupplementedWaveImpl_0(supplement);
  this.listeners = ($clinit_2326() , $clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
  this.primitiveListener = new LiveSupplementedWaveImpl$1_0(this);
  this.waveletListener = new LiveSupplementedWaveImpl$2_0(this);
  this.wave = wave;
  this.conversationView = view;
  $add_31(supplement.listeners, this.primitiveListener);
  viewListener = new LiveSupplementedWaveImpl$3_0(this);
  $add_31(this.conversationView.listeners, viewListener);
  for (conversation$iterator = ($clinit_480() , new Collections$UnmodifiableCollection_0($values(this.conversationView.conversations))).iterator_0(); conversation$iterator.hasNext();) {
    conversation = dynamicCast(conversation$iterator.next_0(), 255);
    $add_31($getWavelet(viewListener.this$0.wave, widFor($toString_28(dynamicCast(($clinit_2183() , conversation.wavelet.wavelet.id_0), 446)))).listeners, viewListener.this$0.waveletListener);
  }
}

function LiveSupplementedWaveImpl(){
}

_ = LiveSupplementedWaveImpl_0.prototype = LiveSupplementedWaveImpl.prototype = new SupplementedWaveWrapper;
_.addListener = function addListener_17(listener){
  $add_31(this.listeners, dynamicCast(listener, 264));
}
;
_.getClass$ = function getClass_1468(){
  return Lorg_waveprotocol_wave_model_supplement_LiveSupplementedWaveImpl_2_classLit;
}
;
_.removeListener = function removeListener_17(listener){
  $remove_42(this.listeners, dynamicCast(listener, 264));
}
;
_.castableTypeMap$ = {263:1};
_.conversationView = null;
_.wave = null;
function LiveSupplementedWaveImpl$1_0(this$0){
  this.this$0 = this$0;
}

function LiveSupplementedWaveImpl$1(){
}

_ = LiveSupplementedWaveImpl$1_0.prototype = LiveSupplementedWaveImpl$1.prototype = new Object_0;
_.getClass$ = function getClass_1469(){
  return Lorg_waveprotocol_wave_model_supplement_LiveSupplementedWaveImpl$1_2_classLit;
}
;
_.onArchiveClearChanged = function onArchiveClearChanged(oldValue, newValue){
  $triggerOnMaybeInboxStateChanged(this.this$0);
}
;
_.onArchiveVersionChanged = function onArchiveVersionChanged(wid, oldVersion, newVersion){
  $triggerOnMaybeInboxStateChanged(this.this$0);
}
;
_.onFolderAdded = function onFolderAdded_0(newFolder){
  $triggerOnFolderAdded(this.this$0, newFolder);
}
;
_.onFollowCleared = function onFollowCleared(){
  $triggerOnMaybeFollowStateChanged(this.this$0);
}
;
_.onFollowed = function onFollowed(){
  $triggerOnMaybeFollowStateChanged(this.this$0);
}
;
_.onGadgetStateChanged = function onGadgetStateChanged(gadgetId, key, oldValue, newValue){
  $triggerOnMaybeGadgetStateChanged(this.this$0, gadgetId);
}
;
_.onLastReadBlipVersionChanged = function onLastReadBlipVersionChanged(wid, bid, oldVersion, newVersion){
  $triggerOnMaybeBlipReadChanged_0(this.this$0, wid, bid);
}
;
_.onLastReadParticipantsVersionChanged = function onLastReadParticipantsVersionChanged(wid, oldVersion, newVersion){
  var wavelet;
  wavelet = dynamicCast(this.this$0.wave.wavelets.get(wid), 262);
  !!wavelet && $triggerOnMaybeParticipantsReadChanged(this.this$0, wavelet);
}
;
_.onLastReadTagsVersionChanged = function onLastReadTagsVersionChanged(wid, oldVersion, newVersion){
  var wavelet;
  wavelet = dynamicCast(this.this$0.wave.wavelets.get(wid), 262);
  !!wavelet && $triggerOnMaybeTagsReadChanged(this.this$0, wavelet);
}
;
_.onLastReadWaveletVersionChanged = function onLastReadWaveletVersionChanged(wid, oldVersion, newVersion){
  var wavelet;
  wavelet = dynamicCast(this.this$0.wave.wavelets.get(wid), 262);
  !!wavelet && $triggerOnMaybeWaveletReadChanged(this.this$0);
}
;
_.onThreadStateChanged_0 = function onThreadStateChanged_0(waveletId, threadId, oldState, newState){
  var conversation, thread;
  conversation = $getConversation(this.this$0.conversationView, $fromString(($clinit_2183() , $serialiseWaveletId(waveletId))));
  if (conversation) {
    thread = dynamicCast(conversation.threads.get_4(threadId), 367);
    !!thread && $triggerOnThreadStateChanged(this.this$0, thread);
  }
}
;
_.onUnfollowed = function onUnfollowed(){
  $triggerOnMaybeFollowStateChanged(this.this$0);
}
;
_.onWantedEvaluationsChanged = function onWantedEvaluationsChanged_0(wid){
  $triggerOnWantedEvaluationsChanged(this.this$0, wid);
}
;
_.castableTypeMap$ = {463:1};
_.this$0 = null;
function LiveSupplementedWaveImpl$2_0(this$0){
  this.this$0 = this$0;
}

function LiveSupplementedWaveImpl$2(){
}

_ = LiveSupplementedWaveImpl$2_0.prototype = LiveSupplementedWaveImpl$2.prototype = new WaveletListenerImpl;
_.getClass$ = function getClass_1470(){
  return Lorg_waveprotocol_wave_model_supplement_LiveSupplementedWaveImpl$2_2_classLit;
}
;
_.onBlipVersionModified = function onBlipVersionModified_0(wavelet, blip, oldVersion, newVersion){
  $triggerOnMaybeBlipReadChanged_0(this.this$0, wavelet.wavelet.id_0, blip.blip.id_0);
}
;
_.onVersionChanged = function onVersionChanged_0(wavelet, oldVersion, newVersion){
  $triggerOnMaybeInboxStateChanged(this.this$0);
  $triggerOnMaybeTagsReadChanged(this.this$0, wavelet);
  $triggerOnMaybeParticipantsReadChanged(this.this$0, wavelet);
}
;
_.castableTypeMap$ = {480:1};
_.this$0 = null;
function LiveSupplementedWaveImpl$3_0(this$0){
  this.this$0 = this$0;
}

function LiveSupplementedWaveImpl$3(){
}

_ = LiveSupplementedWaveImpl$3_0.prototype = LiveSupplementedWaveImpl$3.prototype = new Object_0;
_.getClass$ = function getClass_1471(){
  return Lorg_waveprotocol_wave_model_supplement_LiveSupplementedWaveImpl$3_2_classLit;
}
;
_.onConversationAdded = function onConversationAdded_2(conversation){
  $add_31($getWavelet(this.this$0.wave, widFor($toString_28(dynamicCast(($clinit_2183() , conversation.wavelet.wavelet.id_0), 446)))).listeners, this.this$0.waveletListener);
}
;
_.onConversationRemoved = function onConversationRemoved_2(conversation){
  $remove_42(conversation.wavelet.listeners, this.this$0.waveletListener);
}
;
_.castableTypeMap$ = {372:1};
_.this$0 = null;
function SimpleWantedEvaluation_0(waveletId, adderAddress, wanted, certainty, timestamp, agentIdentity, ignored, comment){
  this.waveletId = waveletId;
  this.adderAddress = adderAddress;
  this.wanted = wanted;
  this.certainty = certainty;
  this.timestamp = timestamp;
  this.agentIdentity = agentIdentity;
  this.ignored = ignored;
  this.comment = comment;
}

function SimpleWantedEvaluation(){
}

_ = SimpleWantedEvaluation_0.prototype = SimpleWantedEvaluation.prototype = new Object_0;
_.compareTo$ = function compareTo_19(other){
  return $compare_11(($clinit_2269() , this), dynamicCast(other, 461));
}
;
_.equals$ = function equals_67(other){
  return other != null && other.castableTypeMap$ && !!other.castableTypeMap$[461] && calculateEqual(this, dynamicCast(other, 461));
}
;
_.getClass$ = function getClass_1472(){
  return Lorg_waveprotocol_wave_model_supplement_SimpleWantedEvaluation_2_classLit;
}
;
_.hashCode$ = function hashCode_66(){
  return calculateHashCode(this);
}
;
_.toString$ = function toString_136(){
  return 'SimpleWantedEvaluation(' + this.waveletId + ', ' + this.adderAddress + ', ' + this.wanted + ', ' + this.certainty + ', ' + toString_14(this.timestamp) + ', ' + this.agentIdentity + ', ' + this.ignored + ', ' + this.comment + ')';
}
;
_.castableTypeMap$ = {10:1, 461:1};
_.adderAddress = null;
_.agentIdentity = null;
_.certainty = 0;
_.comment = null;
_.ignored = false;
_.timestamp = P0_longLit;
_.wanted = false;
_.waveletId = null;
function $isBlipUnread(this$static, waveletId, blipId, version){
  var wavelet;
  return $isUnread_0($getLastReadBlipVersion_0(this$static.primitive.read, waveletId, blipId), version) && $isUnread_0((wavelet = dynamicCast(this$static.primitive.read.waveletSupplements.get(waveletId), 464) , wavelet?valueOf_84($get_23(wavelet.wavelet)):-1), version);
}

function $isUnread_0(read, modified){
  return read == -1 || read < modified;
}

function $markBlipAsRead(this$static, waveletId, blipId, version){
  var wavelet;
  $isUnread_0($getLastReadBlipVersion_0(this$static.primitive.read, waveletId, blipId), version) && $isUnread_0((wavelet = dynamicCast(this$static.primitive.read.waveletSupplements.get(waveletId), 464) , wavelet?valueOf_84($get_23(wavelet.wavelet)):-1), version) && ($setLastReadBlipVersion_0(this$static.primitive.read, waveletId, blipId, version) , undefined);
}

function SupplementImpl_0(primitive){
  this.primitive = primitive;
}

function SupplementImpl(){
}

_ = SupplementImpl_0.prototype = SupplementImpl.prototype = new Object_0;
_.getClass$ = function getClass_1473(){
  return Lorg_waveprotocol_wave_model_supplement_SupplementImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.primitive = null;
function $isUnread_1(this$static, blip){
  var raw;
  raw = blip.blip;
  return $isBlipUnread(this$static.supplement, raw.wavelet.wavelet.id_0, raw.blip.id_0, toInt(valueOf_14(raw.blip.lastModifiedVersion).value_0));
}

function SupplementedWaveImpl_0(supplement){
  this.supplement = new SupplementImpl_0(supplement);
}

function SupplementedWaveImpl(){
}

_ = SupplementedWaveImpl_0.prototype = SupplementedWaveImpl.prototype = new Object_0;
_.getClass$ = function getClass_1474(){
  return Lorg_waveprotocol_wave_model_supplement_SupplementedWaveImpl_2_classLit;
}
;
_.getGadgetState = function getGadgetState_0(gadgetId){
  var state;
  return state = dynamicCast(this.supplement.primitive.gadgetStates.gadgetSupplements.get_4(gadgetId), 462) , state?$getStateMap(state):($clinit_2309() , $clinit_2309() , EMPTY_MAP_2);
}
;
_.isUnread = function isUnread_1(blip){
  return $isUnread_1(this, blip);
}
;
_.markAsRead = function markAsRead_1(b){
  var raw, wavelet;
  if ($isUnread_1(this, b)) {
    raw = b.blip;
    wavelet = raw.wavelet;
    $markBlipAsRead(this.supplement, wavelet.wavelet.id_0, raw.blip.id_0, toInt(max_2(valueOf_14(raw.blip.lastModifiedVersion).value_0, wavelet.wavelet.version)));
  }
}
;
_.setGadgetState = function setGadgetState_0(gadgetId, key, value){
  $setGadgetState_0(this.supplement.primitive.gadgetStates, gadgetId, key, value);
}
;
_.castableTypeMap$ = {};
_.supplement = null;
function $clinit_2267(){
  $clinit_2267 = nullMethod;
  COLLAPSED = new ThreadState_0('COLLAPSED', 0);
  EXPANDED = new ThreadState_0('EXPANDED', 1);
  $VALUES_77 = initValues(_3Lorg_waveprotocol_wave_model_supplement_ThreadState_2_classLit, {9:1, 68:1, 170:1}, 162, [COLLAPSED, EXPANDED]);
}

function ThreadState_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_85(name_0){
  $clinit_2267();
  return valueOf_0(($clinit_2268() , $MAP_77), name_0);
}

function values_78(){
  $clinit_2267();
  return $VALUES_77;
}

function ThreadState(){
}

_ = ThreadState_0.prototype = ThreadState.prototype = new Enum;
_.getClass$ = function getClass_1475(){
  return Lorg_waveprotocol_wave_model_supplement_ThreadState_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 162:1};
var $VALUES_77, COLLAPSED, EXPANDED;
function $clinit_2268(){
  $clinit_2268 = nullMethod;
  $MAP_77 = createValueOfMap(($clinit_2267() , $VALUES_77));
}

var $MAP_77;
function $clinit_2269(){
  $clinit_2269 = nullMethod;
  COMPARATOR = new WantedEvaluation$1_0;
}

var COMPARATOR;
function $compare_10(wanted1, wanted2){
  var result;
  result = signum_0(fromDouble(Math.round(signum_1(wanted1.certainty - wanted2.certainty))));
  result == 0 && (result = signum_0(sub(wanted1.timestamp, wanted2.timestamp)));
  result == 0 && (result = calculateHashCode(wanted1) - calculateHashCode(wanted2));
  return result;
}

function $compare_11(wanted1, wanted2){
  return $compare_10(dynamicCast(wanted1, 461), dynamicCast(wanted2, 461));
}

function WantedEvaluation$1_0(){
}

function WantedEvaluation$1(){
}

_ = WantedEvaluation$1_0.prototype = WantedEvaluation$1.prototype = new Object_0;
_.compare = function compare_9(wanted1, wanted2){
  return $compare_10(dynamicCast(wanted1, 461), dynamicCast(wanted2, 461));
}
;
_.getClass$ = function getClass_1476(){
  return Lorg_waveprotocol_wave_model_supplement_WantedEvaluation$1_2_classLit;
}
;
_.castableTypeMap$ = {};
function calculateEqual(one, other){
  return equal_0(one.waveletId, other.waveletId) && $equals_3(one.adderAddress, other.adderAddress) && one.wanted == other.wanted && one.certainty == other.certainty && $equals_3(one.comment, other.comment) && eq(one.timestamp, other.timestamp) && one.ignored == other.ignored && $equals_3(one.agentIdentity, other.agentIdentity);
}

function calculateHashCode(eval_0){
  var result;
  result = 17;
  result *= 37 + (!eval_0.waveletId?1:$hashCode_11(eval_0.waveletId));
  result *= 37 + getHashCode_0(eval_0.adderAddress);
  result *= 37 + (eval_0.wanted?1:0);
  result *= 37 + ~~Math.max(Math.min((new Double_0(eval_0.certainty)).value_0, 2147483647), -2147483648);
  result *= 37 + getHashCode_0(eval_0.comment);
  result *= toInt(add_1(P25_longLit, eval_0.timestamp));
  result *= 37 + (eval_0.ignored?1:0);
  result *= 37 + getHashCode_0(eval_0.agentIdentity);
  return result;
}

function $triggerOnArchiveClearChanged(this$static, oldValue, newValue){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 463);
    listener.onArchiveClearChanged(oldValue, newValue);
  }
}

function $triggerOnArchiveVersionChanged(this$static, waveletId, oldVersion, newVersion){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 463);
    listener.onArchiveVersionChanged(waveletId, oldVersion, newVersion);
  }
}

function $triggerOnFolderAdded_0(this$static, newFolder){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 463);
    listener.onFolderAdded(newFolder);
  }
}

function $triggerOnFolderRemoved(this$static, oldFolder){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 463);
    listener.onFolderAdded(oldFolder);
  }
}

function $triggerOnFollowCleared(this$static){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 463);
    listener.onFollowCleared();
  }
}

function $triggerOnFollowed(this$static){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 463);
    listener.onFollowed();
  }
}

function $triggerOnGadgetStateChanged(this$static, gadgetId, key, oldValue, newValue){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 463);
    listener.onGadgetStateChanged(gadgetId, key, oldValue, newValue);
  }
}

function $triggerOnLastReadBlipVersionChanged(this$static, waveletId, blipId, oldVersion, newVersion){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 463);
    listener.onLastReadBlipVersionChanged(waveletId, blipId, oldVersion, newVersion);
  }
}

function $triggerOnLastReadParticipantsVersionChanged(this$static, waveletId, oldVersion, newVersion){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 463);
    listener.onLastReadParticipantsVersionChanged(waveletId, oldVersion, newVersion);
  }
}

function $triggerOnLastReadTagsVersionChanged(this$static, waveletId, oldVersion, newVersion){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 463);
    listener.onLastReadTagsVersionChanged(waveletId, oldVersion, newVersion);
  }
}

function $triggerOnLastReadWaveletVersionChanged(this$static, waveletId, oldVersion, newVersion){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 463);
    listener.onLastReadWaveletVersionChanged(waveletId, oldVersion, newVersion);
  }
}

function $triggerOnThreadStateChanged_0(this$static, waveletId, threadId, oldState, newState){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 463);
    listener.onThreadStateChanged_0(waveletId, threadId, oldState, newState);
  }
}

function $triggerOnUnfollowed(this$static){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 463);
    listener.onUnfollowed();
  }
}

function $triggerOnWantedEvaluationAdded(this$static, newEvaluation){
  var listener, listener$iterator, waveletId;
  waveletId = newEvaluation.waveletId;
  if (!waveletId) {
    return;
  }
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 463);
    listener.onWantedEvaluationsChanged(waveletId);
  }
}

function WaveletBasedSupplement_0(userData){
  var readState;
  this.listeners = ($clinit_2326() , $clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
  this.forwardingListener = new WaveletBasedSupplement$1_0(this);
  this.folders = createFolders(new DefaultDocumentEventRouter_0($getDocument_5(userData, 'm/folder')));
  this.muted = createMuted(new DefaultDocumentEventRouter_0($getDocument_5(userData, 'm/muted')));
  this.waveletArchiveVersions = createWaveletArchiveState(new DefaultDocumentEventRouter_0($getDocument_5(userData, 'm/archiving')));
  this.archiveCleared = createCleared(new DefaultDocumentEventRouter_0($getDocument_5(userData, 'm/cleared')));
  readState = $getDocument_5(userData, 'm/read');
  this.read = fungeCreateReadState(readState, this.forwardingListener);
  fungeCreateCollapsedState($getDocument_5(userData, 'm/presentation'), this.forwardingListener);
  this.abuseStore = create_60(new DefaultDocumentEventRouter_0($getDocument_5(userData, 'm/abuse')));
  createWaveletSeenVersion(new DefaultDocumentEventRouter_0($getDocument_5(userData, 'm/seen')));
  createWaveletNotifiedVersion(new DefaultDocumentEventRouter_0($getDocument_5(userData, 'm/seen')));
  createPendingNotification(new DefaultDocumentEventRouter_0($getDocument_5(userData, 'm/seen')));
  this.gadgetStates = fungeCreateGadgetStates($getDocument_5(userData, 'm/gadgets'), this.forwardingListener);
  $remove_39(this.folders, valueOf_13(1));
  $remove_39(this.folders, valueOf_13(3));
  $add_31(this.muted.listeners, new WaveletBasedSupplement$2_0(this));
  $add_31(this.folders.listeners, new WaveletBasedSupplement$3_0(this));
  $add_31(this.archiveCleared.listeners, new WaveletBasedSupplement$4_0(this));
  $add_31(this.waveletArchiveVersions.listeners, new WaveletBasedSupplement$5_0(this));
  $add_31(this.abuseStore.listeners, new WaveletBasedSupplement$6_0(this));
}

function createCleared(router){
  return create_49(router, router.getDocument_0().getDocumentElement(), 'cleared', 'cleared');
}

function createFolders(router){
  return $init_18(new DocumentBasedBasicSet_0(router, router.getDocument_0().getDocumentElement(), ($clinit_2363() , INTEGER)));
}

function createGadgetStatesDoc(router, listener){
  return create_64(router, router.getDocument_0().getDocumentElement(), listener);
}

function createMuted(router){
  return create_49(router, router.getDocument_0().getDocumentElement(), 'muted', 'muted');
}

function createPendingNotification(router){
  return create_49(router, router.getDocument_0().getDocumentElement(), 'notification', 'pending');
}

function createWaveletArchiveState(router){
  var map;
  return map = new DocumentBasedMonotonicMap_0(router, router.getDocument_0().getDocumentElement(), ($clinit_2183() , INSTANCE_17), ($clinit_2363() , INTEGER), 'archive', 'v') , $addChildListener(map.router, map.container, map) , $load_0(map) , map;
}

function createWaveletCollapsedState(router, listener){
  return create_66(router, router.getDocument_0().getDocumentElement(), listener);
}

function createWaveletNotifiedVersion(router){
  var map;
  return map = new DocumentBasedMonotonicMap_0(router, router.getDocument_0().getDocumentElement(), ($clinit_2183() , INSTANCE_17), ($clinit_2363() , INTEGER), 'notified', 'v') , $addChildListener(map.router, map.container, map) , $load_0(map) , map;
}

function createWaveletReadState(router, listener){
  var container, col;
  container = router.getDocument_0().getDocumentElement();
  return col = new WaveletReadStateCollection_0(router, listener) , $addChildListener(router, container, col) , $load_5(col) , col;
}

function createWaveletSeenVersion(router){
  var map;
  return map = new DocumentBasedMonotonicMap_0(router, router.getDocument_0().getDocumentElement(), ($clinit_2183() , INSTANCE_17), ($clinit_2385() , INSTANCE_18), 'seen', 'signature') , $addChildListener(map.router, map.container, map) , $load_0(map) , map;
}

function fungeCreateCollapsedState(doc, listener){
  return createWaveletCollapsedState(new DefaultDocumentEventRouter_0(doc), listener);
}

function fungeCreateGadgetStates(doc, listener){
  return createGadgetStatesDoc(new DefaultDocumentEventRouter_0(doc), listener);
}

function fungeCreateReadState(doc, listener){
  return createWaveletReadState(new DefaultDocumentEventRouter_0(doc), listener);
}

function WaveletBasedSupplement(){
}

_ = WaveletBasedSupplement_0.prototype = WaveletBasedSupplement.prototype = new Object_0;
_.addListener = function addListener_18(listener){
  $add_31(this.listeners, dynamicCast(listener, 463));
}
;
_.getClass$ = function getClass_1477(){
  return Lorg_waveprotocol_wave_model_supplement_WaveletBasedSupplement_2_classLit;
}
;
_.removeListener = function removeListener_18(listener){
  $remove_42(this.listeners, dynamicCast(listener, 463));
}
;
_.castableTypeMap$ = {};
_.abuseStore = null;
_.archiveCleared = null;
_.folders = null;
_.gadgetStates = null;
_.muted = null;
_.read = null;
_.waveletArchiveVersions = null;
function WaveletBasedSupplement$1_0(this$0){
  this.this$0 = this$0;
}

function WaveletBasedSupplement$1(){
}

_ = WaveletBasedSupplement$1_0.prototype = WaveletBasedSupplement$1.prototype = new Object_0;
_.getClass$ = function getClass_1478(){
  return Lorg_waveprotocol_wave_model_supplement_WaveletBasedSupplement$1_2_classLit;
}
;
_.onArchiveClearChanged = function onArchiveClearChanged_0(oldValue, newValue){
}
;
_.onArchiveVersionChanged = function onArchiveVersionChanged_0(wid, oldVersion, newVersion){
}
;
_.onFolderAdded = function onFolderAdded_1(newFolder){
}
;
_.onFollowCleared = function onFollowCleared_0(){
}
;
_.onFollowed = function onFollowed_0(){
}
;
_.onGadgetStateChanged = function onGadgetStateChanged_0(gadgetId, key, oldValue, newValue){
  $triggerOnGadgetStateChanged(this.this$0, gadgetId, key, oldValue, newValue);
}
;
_.onLastReadBlipVersionChanged = function onLastReadBlipVersionChanged_0(wid, bid, oldVersion, newVersion){
  $triggerOnLastReadBlipVersionChanged(this.this$0, wid, bid, oldVersion, newVersion);
}
;
_.onLastReadParticipantsVersionChanged = function onLastReadParticipantsVersionChanged_0(wid, oldVersion, newVersion){
  $triggerOnLastReadParticipantsVersionChanged(this.this$0, wid, oldVersion, newVersion);
}
;
_.onLastReadTagsVersionChanged = function onLastReadTagsVersionChanged_0(wid, oldVersion, newVersion){
  $triggerOnLastReadTagsVersionChanged(this.this$0, wid, oldVersion, newVersion);
}
;
_.onLastReadWaveletVersionChanged = function onLastReadWaveletVersionChanged_0(wid, oldVersion, newVersion){
  $triggerOnLastReadWaveletVersionChanged(this.this$0, wid, oldVersion, newVersion);
}
;
_.onThreadStateChanged_0 = function onThreadStateChanged_1(waveletId, threadId, oldState, newState){
  $triggerOnThreadStateChanged_0(this.this$0, waveletId, threadId, oldState, newState);
}
;
_.onUnfollowed = function onUnfollowed_0(){
}
;
_.onWantedEvaluationsChanged = function onWantedEvaluationsChanged_1(waveletId){
}
;
_.castableTypeMap$ = {463:1};
_.this$0 = null;
function $onValueChanged_0(this$static, oldValue, newValue){
  (!oldValue?!newValue:!!newValue && newValue.value_0 == oldValue.value_0) || (!newValue?$triggerOnFollowCleared(this$static.this$0):newValue.value_0?$triggerOnUnfollowed(this$static.this$0):$triggerOnFollowed(this$static.this$0));
}

function WaveletBasedSupplement$2_0(this$0){
  this.this$0 = this$0;
}

function WaveletBasedSupplement$2(){
}

_ = WaveletBasedSupplement$2_0.prototype = WaveletBasedSupplement$2.prototype = new Object_0;
_.getClass$ = function getClass_1479(){
  return Lorg_waveprotocol_wave_model_supplement_WaveletBasedSupplement$2_2_classLit;
}
;
_.onValueChanged = function onValueChanged(oldValue, newValue){
  $onValueChanged_0(this, dynamicCast(oldValue, 62), dynamicCast(newValue, 62));
}
;
_.castableTypeMap$ = {355:1};
_.this$0 = null;
function WaveletBasedSupplement$3_0(this$0){
  this.this$0 = this$0;
}

function WaveletBasedSupplement$3(){
}

_ = WaveletBasedSupplement$3_0.prototype = WaveletBasedSupplement$3.prototype = new Object_0;
_.getClass$ = function getClass_1480(){
  return Lorg_waveprotocol_wave_model_supplement_WaveletBasedSupplement$3_2_classLit;
}
;
_.castableTypeMap$ = {353:1};
_.this$0 = null;
function $onValueChanged_1(this$static, oldValue, newValue){
  (!oldValue?!newValue:!!newValue && newValue.value_0 == oldValue.value_0) || $triggerOnArchiveClearChanged(this$static.this$0, !!oldValue && oldValue.value_0, !!newValue && newValue.value_0);
}

function WaveletBasedSupplement$4_0(this$0){
  this.this$0 = this$0;
}

function WaveletBasedSupplement$4(){
}

_ = WaveletBasedSupplement$4_0.prototype = WaveletBasedSupplement$4.prototype = new Object_0;
_.getClass$ = function getClass_1481(){
  return Lorg_waveprotocol_wave_model_supplement_WaveletBasedSupplement$4_2_classLit;
}
;
_.onValueChanged = function onValueChanged_0(oldValue, newValue){
  $onValueChanged_1(this, dynamicCast(oldValue, 62), dynamicCast(newValue, 62));
}
;
_.castableTypeMap$ = {355:1};
_.this$0 = null;
function $onEntrySet_2(this$static, waveletId, oldValue, newValue){
  $triggerOnArchiveVersionChanged(this$static.this$0, waveletId, oldValue?oldValue.value_0:-1, newValue?newValue.value_0:-1);
}

function WaveletBasedSupplement$5_0(this$0){
  this.this$0 = this$0;
}

function WaveletBasedSupplement$5(){
}

_ = WaveletBasedSupplement$5_0.prototype = WaveletBasedSupplement$5.prototype = new Object_0;
_.getClass$ = function getClass_1482(){
  return Lorg_waveprotocol_wave_model_supplement_WaveletBasedSupplement$5_2_classLit;
}
;
_.onEntrySet = function onEntrySet_2(waveletId, oldValue, newValue){
  $onEntrySet_2(this, dynamicCast(waveletId, 446), dynamicCast(oldValue, 66), dynamicCast(newValue, 66));
}
;
_.castableTypeMap$ = {354:1};
_.this$0 = null;
function WaveletBasedSupplement$6_0(this$0){
  this.this$0 = this$0;
}

function WaveletBasedSupplement$6(){
}

_ = WaveletBasedSupplement$6_0.prototype = WaveletBasedSupplement$6.prototype = new Object_0;
_.getClass$ = function getClass_1483(){
  return Lorg_waveprotocol_wave_model_supplement_WaveletBasedSupplement$6_2_classLit;
}
;
_.castableTypeMap$ = {460:1};
_.this$0 = null;
function $getLastReadBlipVersion_0(this$static, waveletId, blipId){
  var wavelet;
  wavelet = dynamicCast(this$static.waveletSupplements.get(waveletId), 464);
  return wavelet?valueOf_84(dynamicCast($get_21(wavelet.blips, blipId), 66)):-1;
}

function $getSupplement_1(this$static, waveletId){
  var wavelet, waveletIdStr;
  checkNotNull_1(waveletId, 'wavelet id must not be null');
  wavelet = dynamicCast(this$static.waveletSupplements.get(waveletId), 464);
  if (!wavelet) {
    waveletIdStr = $toString_28(dynamicCast(($clinit_2183() , waveletId), 446));
    this$static.router.getDocument_0().createChildElement(this$static.router.getDocument_0().getDocumentElement(), 'wavelet', new AttributesImpl_3(initValues(_3Ljava_lang_String_2_classLit, {9:1, 68:1, 408:1}, 1, ['i', waveletIdStr])));
    wavelet = dynamicCast(this$static.waveletSupplements.get(waveletId), 464);
  }
  return wavelet;
}

function $load_5(this$static){
  var child;
  child = getFirstChildElement(this$static.router.getDocument_0(), this$static.router.getDocument_0().getDocumentElement());
  while (child != null) {
    $onElementAdded_5(this$static, child);
    child = getNextSiblingElement(this$static.router.getDocument_0(), child);
  }
}

function $onElementAdded_5(this$static, element){
  var blipId, blipId$iterator, blipVersion, existing, participantsVersion, read, tagsVersion, waveletId, waveletVersion, waveletIdStr;
  if (!$equals_3('wavelet', this$static.router.getDocument_0().getTagName(element))) {
    return;
  }
  waveletId = (waveletIdStr = this$static.router.getDocument_0().getAttribute_0(element, 'i') , $fromString(($clinit_2183() , waveletIdStr)));
  if (waveletId) {
    existing = dynamicCast(this$static.waveletSupplements.get(waveletId), 464);
    if (!existing) {
      read = create_62(this$static.router, element, waveletId, this$static.listener);
      this$static.waveletSupplements.put(waveletId, read);
      waveletVersion = valueOf_84($get_23(read.wavelet));
      waveletVersion != -1 && ($triggerOnLastReadWaveletVersionChanged(this$static.listener.this$0, waveletId, -1, waveletVersion) , undefined);
      participantsVersion = valueOf_84($get_23(read.participants));
      participantsVersion != -1 && ($triggerOnLastReadParticipantsVersionChanged(this$static.listener.this$0, waveletId, -1, participantsVersion) , undefined);
      tagsVersion = valueOf_84($get_23(read.tags));
      tagsVersion != -1 && ($triggerOnLastReadTagsVersionChanged(this$static.listener.this$0, waveletId, -1, tagsVersion) , undefined);
      for (blipId$iterator = ($clinit_480() , new Collections$UnmodifiableSet_0($keySet_0(read.blips.entries))).iterator_0(); blipId$iterator.hasNext();) {
        blipId = dynamicCast(blipId$iterator.next_0(), 1);
        blipVersion = valueOf_84(dynamicCast($get_21(read.blips, blipId), 66));
        blipVersion != -1 && ($triggerOnLastReadBlipVersionChanged(this$static.listener.this$0, waveletId, blipId, -1, blipVersion) , undefined);
      }
    }
  }
}

function $setLastReadBlipVersion_0(this$static, waveletId, blipId, version){
  $put_8($getSupplement_1(this$static, waveletId).blips, blipId, valueOf_13(version));
}

function WaveletReadStateCollection_0(router, listener){
  this.waveletSupplements = new HashMap_0;
  this.router = router;
  this.listener = listener;
}

function WaveletReadStateCollection(){
}

_ = WaveletReadStateCollection_0.prototype = WaveletReadStateCollection.prototype = new Object_0;
_.getClass$ = function getClass_1484(){
  return Lorg_waveprotocol_wave_model_supplement_WaveletReadStateCollection_2_classLit;
}
;
_.onElementAdded = function onElementAdded_6(element){
  $onElementAdded_5(this, element);
}
;
_.onElementRemoved = function onElementRemoved_6(element){
  var blipId, blipId$iterator, blipVersion, participantsVersion, state, tagsVersion, waveletId, waveletVersion, waveletIdStr;
  if ($equals_3('wavelet', this.router.getDocument_0().getTagName(element))) {
    waveletId = (waveletIdStr = this.router.getDocument_0().getAttribute_0(element, 'i') , $fromString(($clinit_2183() , waveletIdStr)));
    if (waveletId) {
      state = dynamicCast(this.waveletSupplements.remove_3(waveletId), 464);
      if (!state) {
        return;
      }
      for (blipId$iterator = ($clinit_480() , new Collections$UnmodifiableSet_0($keySet_0(state.blips.entries))).iterator_0(); blipId$iterator.hasNext();) {
        blipId = dynamicCast(blipId$iterator.next_0(), 1);
        blipVersion = valueOf_84(dynamicCast($get_21(state.blips, blipId), 66));
        blipVersion != -1 && ($triggerOnLastReadBlipVersionChanged(this.listener.this$0, waveletId, blipId, blipVersion, -1) , undefined);
      }
      tagsVersion = valueOf_84($get_23(state.tags));
      tagsVersion != -1 && ($triggerOnLastReadTagsVersionChanged(this.listener.this$0, waveletId, tagsVersion, -1) , undefined);
      participantsVersion = valueOf_84($get_23(state.participants));
      participantsVersion != -1 && ($triggerOnLastReadParticipantsVersionChanged(this.listener.this$0, waveletId, participantsVersion, -1) , undefined);
      waveletVersion = valueOf_84($get_23(state.wavelet));
      waveletVersion != -1 && ($triggerOnLastReadWaveletVersionChanged(this.listener.this$0, waveletId, -1, waveletVersion) , undefined);
    }
  }
}
;
_.castableTypeMap$ = {434:1};
_.listener = null;
_.router = null;
function $load_6(this$static){
  var child, doc;
  doc = this$static.router.getDocument_0();
  child = getFirstChildElement(doc, doc.getDocumentElement());
  while (child != null) {
    $onElementAdded_6(this$static, child);
    child = getNextElementInclusive(doc, doc.getNextSibling(child), true);
  }
}

function $onElementAdded_6(this$static, element){
  var doc, existing, read, waveletId, waveletIdStr;
  doc = this$static.router.getDocument_0();
  if (!$equals_3('conversation', doc.getTagName(element))) {
    return;
  }
  waveletId = (waveletIdStr = this$static.router.getDocument_0().getAttribute_0(element, 'i') , $fromString(($clinit_2183() , waveletIdStr)));
  if (waveletId) {
    existing = dynamicCast(this$static.waveletSupplements.get(waveletId), 465);
    if (!existing) {
      read = create_63(this$static.router, element, waveletId, this$static.listener);
      this$static.waveletSupplements.put(waveletId, read);
    }
  }
}

function WaveletThreadStateCollection_0(router, listener){
  this.waveletSupplements = new HashMap_0;
  this.router = router;
  this.listener = listener;
}

function create_66(router, e, listener){
  var col;
  col = new WaveletThreadStateCollection_0(router, listener);
  $addChildListener(router, e, col);
  $load_6(col);
  return col;
}

function WaveletThreadStateCollection(){
}

_ = WaveletThreadStateCollection_0.prototype = WaveletThreadStateCollection.prototype = new Object_0;
_.getClass$ = function getClass_1485(){
  return Lorg_waveprotocol_wave_model_supplement_WaveletThreadStateCollection_2_classLit;
}
;
_.onElementAdded = function onElementAdded_7(element){
  $onElementAdded_6(this, element);
}
;
_.onElementRemoved = function onElementRemoved_7(element){
  var waveletId, waveletIdStr;
  if ($equals_3('conversation', this.router.getDocument_0().getTagName(element))) {
    waveletId = (waveletIdStr = this.router.getDocument_0().getAttribute_0(element, 'i') , $fromString(($clinit_2183() , waveletIdStr)));
    !!waveletId && dynamicCast(this.waveletSupplements.remove_3(waveletId), 465);
  }
}
;
_.castableTypeMap$ = {434:1};
_.listener = null;
_.router = null;
function $getDelegate_0(this$static){
  var delegate, delegateSink;
  if (!this$static.delegate) {
    this$static.outputSink?(delegateSink = this$static.outputSink):(delegateSink = new PluggableMutableDocument$2_0(this$static));
    delegate = new DocumentImpl_0(new PluggableMutableDocument$BasicSequencer_0($getDocument_3(this$static), delegateSink), $getDocument_3(this$static));
    this$static.delegate = delegate;
  }
  return $getDelegate(this$static);
}

function $getDocument_3(this$static){
  var $e0, e;
  if (!this$static.substrateDocument) {
    try {
      this$static.createSubstrateDocument();
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 189)) {
        e = $e0;
        throw new OperationRuntimeException_0('Document initialization failed when applying operation: ' + this$static.documentCreationContext.content_0, e);
      }
       else 
        throw $e0;
    }
  }
  return this$static.substrateDocument;
}

function PluggableMutableDocument(){
}

_ = PluggableMutableDocument.prototype = new MutableDocumentProxy$DocumentProxy;
_.consume_1 = function consume_12(op){
  $consume_10($getDocument_3(this), op, performValidation);
}
;
_.consume = function consume_13(op){
  this.consume_1(op);
}
;
_.createSubstrateDocument = function createSubstrateDocument(){
  this.substrateDocument = $createDocument_0(this.documentCreationContext);
  this.documentCreationContext = null;
}
;
_.getClass$ = function getClass_1486(){
  return Lorg_waveprotocol_wave_model_wave_data_impl_PluggableMutableDocument_2_classLit;
}
;
_.getDelegate = function getDelegate_0(){
  return $getDelegate_0(this);
}
;
_.getMutableDocument = function getMutableDocument_0(){
  return this;
}
;
_.init = function init_2(outputSink){
  checkState_2(!this.outputSink, 'Output sink may only be set once');
  checkArgument_2(!!outputSink, 'Output sink may not be null');
  this.outputSink = outputSink;
}
;
_.castableTypeMap$ = {19:1, 266:1};
_.documentCreationContext = null;
_.outputSink = null;
_.substrateDocument = null;
function ObservablePluggableMutableDocument_0(schema, content_0){
  ObservablePluggableMutableDocument_1.call(this, schema, content_0, new ObservablePluggableMutableDocument$DocumentHandlerManager_0);
}

function ObservablePluggableMutableDocument_1(schema, content_0, handlerManager){
  this.delegate = null;
  this.noDelegateErrorMessage = 'Impossible';
  this.documentCreationContext = new PluggableMutableDocument$DocumentCreationContext_0(content_0, schema, handlerManager);
  this.handlerManager = handlerManager;
}

function ObservablePluggableMutableDocument(){
}

_ = ObservablePluggableMutableDocument_0.prototype = ObservablePluggableMutableDocument.prototype = new PluggableMutableDocument;
_.addListener = function addListener_19(listener){
  $add_31(this.handlerManager.handlers, dynamicCast(listener, 475));
}
;
_.createSubstrateDocument = function createSubstrateDocument_0(){
  this.handlerManager.isPaused = true;
  this.substrateDocument = $createDocument_0(this.documentCreationContext);
  this.documentCreationContext = null;
  this.handlerManager.isPaused = false;
}
;
_.getClass$ = function getClass_1487(){
  return Lorg_waveprotocol_wave_model_wave_data_impl_ObservablePluggableMutableDocument_2_classLit;
}
;
_.removeListener = function removeListener_19(listener){
  $remove_42(this.handlerManager.handlers, dynamicCast(listener, 475));
}
;
_.castableTypeMap$ = {19:1, 266:1, 478:1};
_.handlerManager = null;
function $nonUndoableOp(this$static, op){
  $nonUndoableOperation(this$static.undoStack, op);
  $nonUndoableOperation(this$static.redoStack, op);
}

function UndoManagerImpl_0(){
  this.checkpointer = new UndoManagerImpl$Checkpointer_0;
  this.undoStack = new UndoStack_0;
  this.redoStack = new UndoStack_0;
}

function UndoManagerImpl(){
}

_ = UndoManagerImpl_0.prototype = UndoManagerImpl.prototype = new Object_0;
_.getClass$ = function getClass_1496(){
  return Lorg_waveprotocol_wave_model_undo_UndoManagerImpl_2_classLit;
}
;
_.castableTypeMap$ = {};
_.redoStack = null;
_.undoStack = null;
function UndoManagerImpl$Checkpointer_0(){
  this.partitions = new Stack_0;
}

function UndoManagerImpl$Checkpointer(){
}

_ = UndoManagerImpl$Checkpointer_0.prototype = UndoManagerImpl$Checkpointer.prototype = new Object_0;
_.getClass$ = function getClass_1497(){
  return Lorg_waveprotocol_wave_model_undo_UndoManagerImpl$Checkpointer_2_classLit;
}
;
_.castableTypeMap$ = {};
_.lastPartition = 0;
function $nonUndoableOperation(this$static, op){
  this$static.stack_0.arrayList.size_0 == 0 || $add_9(dynamicCast($peek_1(this$static.stack_0), 467).nonUndoables, op);
}

function UndoStack_0(){
  this.stack_0 = new Stack_0;
}

function UndoStack(){
}

_ = UndoStack_0.prototype = UndoStack.prototype = new Object_0;
_.getClass$ = function getClass_1498(){
  return Lorg_waveprotocol_wave_model_undo_UndoStack_2_classLit;
}
;
_.castableTypeMap$ = {};
function Base64DecoderException_0(s){
  this.fillInStackTrace();
  this.detailMessage = s;
}

function Base64DecoderException(){
}

_ = Base64DecoderException_0.prototype = Base64DecoderException.prototype = new Exception;
_.getClass$ = function getClass_1500(){
  return Lorg_waveprotocol_wave_model_util_Base64DecoderException_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 39:1, 183:1, 472:1};
function $inspect(this$static){
  $maybeUpdateCache(this$static);
  return this$static.roCache;
}

function $maybeUpdateCache(this$static){
  if (this$static.parent_0) {
    $maybeUpdateCache(this$static.parent_0);
    if (this$static.parent_0.version != this$static.knownParentVersion) {
      this$static.domain.compose(this$static.cache, this$static.overlay, this$static.parent_0.roCache);
      this$static.knownParentVersion = this$static.parent_0.version;
      ++this$static.version;
    }
  }
}

function $modify_0(this$static){
  ++this$static.version;
  this$static.knownParentVersion = -1;
  return this$static.overlay;
}

function ChainedData_0(domain){
  this.domain = domain;
  this.parent_0 = null;
  this.overlay = domain.empty();
  this.cache = this.overlay;
  this.roCache = domain.readOnlyView(this.cache);
}

function ChainedData_1(parent_0){
  this.domain = parent_0.domain;
  this.parent_0 = parent_0;
  this.overlay = this.domain.empty();
  this.cache = this.domain.empty();
  this.roCache = this.domain.readOnlyView(this.cache);
}

function ChainedData(){
}

_ = ChainedData_1.prototype = ChainedData_0.prototype = ChainedData.prototype = new Object_0;
_.getClass$ = function getClass_1502(){
  return Lorg_waveprotocol_wave_model_util_ChainedData_2_classLit;
}
;
_.castableTypeMap$ = {};
_.cache = null;
_.domain = null;
_.knownParentVersion = 0;
_.overlay = null;
_.parent_0 = null;
_.roCache = null;
_.version = 0;
function $clinit_2307(){
  $clinit_2307 = nullMethod;
  ALPHABET = $toCharArray('ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/');
  $toCharArray('ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_');
  DECODABET = initValues(_3B_classLit, {9:1}, -1, [-9, -9, -9, -9, -9, -9, -9, -9, -9, -5, -5, -9, -9, -5, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, -5, -9, -9, -9, -9, -9, -9, -9, -9, -9, -9, 62, -9, -9, -9, 63, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -9, -9, -9, -1, -9, -9, -9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -9, -9, -9, -9, -9, -9, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, -9, -9, -9, -9, -9]);
}

function decode_0(source, len, decodabet){
  var c4, c4Posn, i, lastChar, len34, out, outBuff, outBuffPosn, paddingCharSeen, sbiCrop, sbiDecode, sbiRaw;
  len34 = ~~(len * 3 / 4);
  outBuff = initDim(_3B_classLit, {9:1}, -1, 2 + len34, 1);
  outBuffPosn = 0;
  c4 = initDim(_3C_classLit, {9:1}, -1, 4, 1);
  c4Posn = 0;
  paddingCharSeen = false;
  for (i = 0; i < len; ++i) {
    sbiRaw = source[i];
    sbiCrop = sbiRaw & 127 & 65535;
    sbiDecode = decodabet[sbiCrop];
    if (sbiCrop == sbiRaw && sbiDecode < -5) {
      throw new Base64DecoderException_0('Bad Base64 input character at ' + i + ': ' + source[i] + '(decimal)');
    }
    if (sbiDecode >= -1) {
      if (sbiCrop == 61) {
        if (paddingCharSeen) {
          continue;
        }
        if (i < 2) {
          throw new Base64DecoderException_0('Invalid padding char found in position ' + i);
        }
        paddingCharSeen = true;
        lastChar = source[len - 1] & 127 & 65535;
        if (lastChar != 61 && lastChar != 10) {
          throw new Base64DecoderException_0('encoded value has invalid trailing char');
        }
      }
       else if (paddingCharSeen) {
        throw new Base64DecoderException_0('Data found after trailing padding char at index ' + i);
      }
       else {
        c4[c4Posn++] = sbiCrop;
        if (c4Posn == 4) {
          outBuffPosn += decode4to3(c4, outBuff, outBuffPosn, decodabet);
          c4Posn = 0;
        }
      }
    }
  }
  if (c4Posn != 0) {
    if (c4Posn == 1) {
      throw new Base64DecoderException_0('single trailing character at offset ' + (len - 1));
    }
    c4[c4Posn] = 61;
    outBuffPosn += decode4to3(c4, outBuff, outBuffPosn, decodabet);
  }
  out = initDim(_3B_classLit, {9:1}, -1, outBuffPosn, 1);
  arraycopy(outBuff, 0, out, 0, outBuffPosn);
  return out;
}

function decode4to3(source, destination, destOffset, decodabet){
  var outBuff;
  if (source[2] == 61) {
    outBuff = ~~(decodabet[source[0]] << 24) >>> 6 | ~~(decodabet[source[1]] << 24) >>> 12;
    destination[destOffset] = ~~(~~outBuff >>> 16 << 24) >> 24;
    return 1;
  }
   else if (source[3] == 61) {
    outBuff = ~~(decodabet[source[0]] << 24) >>> 6 | ~~(decodabet[source[1]] << 24) >>> 12 | ~~(decodabet[source[2]] << 24) >>> 18;
    destination[destOffset] = ~~(~~outBuff >>> 16 << 24) >> 24;
    destination[destOffset + 1] = ~~(~~outBuff >>> 8 << 24) >> 24;
    return 2;
  }
   else {
    outBuff = ~~(decodabet[source[0]] << 24) >>> 6 | ~~(decodabet[source[1]] << 24) >>> 12 | ~~(decodabet[source[2]] << 24) >>> 18 | ~~(decodabet[source[3]] << 24) >>> 24;
    destination[destOffset] = ~~(~~outBuff >> 16 << 24) >> 24;
    destination[destOffset + 1] = ~~(~~outBuff >> 8 << 24) >> 24;
    destination[destOffset + 2] = ~~(outBuff << 24) >> 24;
    return 3;
  }
}

function encode_0(source){
  $clinit_2307();
  return encode_1(source, source.length, ALPHABET, true);
}

function encode_1(source, len, alphabet, doPadding){
  var outBuff, outLen;
  outBuff = encode_2(source, len, alphabet);
  outLen = outBuff.length;
  while (!doPadding && outLen > 0) {
    if (outBuff[outLen - 1] != 61) {
      break;
    }
    outLen -= 1;
  }
  return __checkBounds(outBuff.length, outLen) , __valueOf(outBuff, 0, outLen);
}

function encode_2(source, len, alphabet){
  var d, e, inBuff, len2, len43, lenDiv3, lineLength, outBuff;
  lenDiv3 = ~~((len + 2) / 3);
  len43 = lenDiv3 * 4;
  outBuff = initDim(_3C_classLit, {9:1}, -1, len43 + ~~(len43 / 2147483647), 1);
  d = 0;
  e = 0;
  len2 = len - 2;
  lineLength = 0;
  for (; d < len2; d += 3 , e += 4) {
    inBuff = ~~(source[d] << 24) >>> 8 | ~~(source[d + 1] << 24) >>> 16 | ~~(source[d + 2] << 24) >>> 24;
    outBuff[e] = alphabet[~~inBuff >>> 18];
    outBuff[e + 1] = alphabet[~~inBuff >>> 12 & 63];
    outBuff[e + 2] = alphabet[~~inBuff >>> 6 & 63];
    outBuff[e + 3] = alphabet[inBuff & 63];
    lineLength += 4;
    if (lineLength == 2147483647) {
      outBuff[e + 4] = 10;
      ++e;
      lineLength = 0;
    }
  }
  if (d < len) {
    encode3to4(source, d, len - d, outBuff, e, alphabet);
    lineLength += 4;
    if (lineLength == 2147483647) {
      outBuff[e + 4] = 10;
      ++e;
    }
    e += 4;
  }
  return outBuff;
}

function encode3to4(source, srcOffset, numSigBytes, destination, destOffset, alphabet){
  var inBuff;
  inBuff = (numSigBytes > 0?~~(source[srcOffset] << 24) >>> 8:0) | (numSigBytes > 1?~~(source[srcOffset + 1] << 24) >>> 16:0) | (numSigBytes > 2?~~(source[srcOffset + 2] << 24) >>> 24:0);
  switch (numSigBytes) {
    case 3:
      destination[destOffset] = alphabet[~~inBuff >>> 18];
      destination[destOffset + 1] = alphabet[~~inBuff >>> 12 & 63];
      destination[destOffset + 2] = alphabet[~~inBuff >>> 6 & 63];
      destination[destOffset + 3] = alphabet[inBuff & 63];
      return destination;
    case 2:
      destination[destOffset] = alphabet[~~inBuff >>> 18];
      destination[destOffset + 1] = alphabet[~~inBuff >>> 12 & 63];
      destination[destOffset + 2] = alphabet[~~inBuff >>> 6 & 63];
      destination[destOffset + 3] = 61;
      return destination;
    case 1:
      destination[destOffset] = alphabet[~~inBuff >>> 18];
      destination[destOffset + 1] = alphabet[~~inBuff >>> 12 & 63];
      destination[destOffset + 2] = 61;
      destination[destOffset + 3] = 61;
      return destination;
    default:return destination;
  }
}

var ALPHABET, DECODABET;
function copyToJavaMap(source, target){
  $clinit_2309();
  source.each_2(new CollectionUtils$6_0(target));
  return target;
}

function copyValuesToJavaCollection(source, target){
  $clinit_2309();
  source.each_2(new CollectionUtils$9_0(target));
  return target;
}

function join_0(parts){
  $clinit_2309();
  var i, ret;
  ret = new StringBuilder_0;
  parts.length > 0 && (ret.impl.string += parts[0] , ret);
  for (i = 1; i < parts.length; ++i) {
    ret.impl.string += '/';
    ret.impl.string += parts[i];
  }
  return ret.impl.string;
}

function join_1(parts){
  $clinit_2309();
  var i, ret;
  ret = new StringBuilder_0;
  parts.length > 0 && (ret.impl.string += parts[0] , ret);
  for (i = 1; i < parts.length; ++i) {
    ret.impl.string += parts[i];
  }
  return ret.impl.string;
}

function newStringSet(values){
  $clinit_2309();
  var s, value, value$index, value$max;
  s = defaultCollectionFactory.createStringSet();
  for (value$index = 0 , value$max = values.length; value$index < value$max; ++value$index) {
    value = values[value$index];
    s.add_3(value);
  }
  return s;
}

function valueList(map){
  $clinit_2309();
  var result;
  result = new ArrayList_0;
  map.each_2(new CollectionUtils$10_0(result));
  return result;
}

function $compose_3(target, changes, base){
  target.clear();
  target.addAll_0(base);
  target.addAll_0(changes);
}

function $compose_4(target, changes, base){
  $compose_3(dynamicCast(target, 457), dynamicCast(changes, 455), dynamicCast(base, 455));
}

_ = CollectionUtils$1.prototype;
_.compose = function compose_5(target, changes, base){
  $compose_3(dynamicCast(target, 457), dynamicCast(changes, 455), dynamicCast(base, 455));
}
;
_.empty = function empty_3(){
  return $clinit_2309() , defaultCollectionFactory.createStringSet();
}
;
_.readOnlyView = function readOnlyView_2(modifiable){
  return dynamicCast(modifiable, 457);
}
;
function CollectionUtils$10_0(val$result){
  this.val$result = val$result;
}

function CollectionUtils$10(){
}

_ = CollectionUtils$10_0.prototype = CollectionUtils$10.prototype = new Object_0;
_.apply_1 = function apply_140(key, value){
  $add_9(this.val$result, value);
}
;
_.getClass$ = function getClass_1504(){
  return Lorg_waveprotocol_wave_model_util_CollectionUtils$10_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$result = null;
function $compose_5(target, changes, base){
  target.clear();
  target.addAll(changes);
  target.addAll(base);
}

function $compose_6(target, changes, base){
  $compose_5(dynamicCast(target, 168), dynamicCast(changes, 168), dynamicCast(base, 168));
}

_ = CollectionUtils$3.prototype;
_.compose = function compose_6(target, changes, base){
  $compose_5(dynamicCast(target, 168), dynamicCast(changes, 168), dynamicCast(base, 168));
}
;
_.empty = function empty_4(){
  return new HashSet_0;
}
;
_.readOnlyView = function readOnlyView_3(modifiable){
  return $clinit_480() , new Collections$UnmodifiableSet_0(dynamicCast(modifiable, 168));
}
;
_ = CollectionUtils$4.prototype;
_.clear = function clear_26(){
}
;
_.remove_6 = function remove_62(key){
  throw new UnsupportedOperationException_0;
}
;
function CollectionUtils$6_0(val$target){
  this.val$target = val$target;
}

function CollectionUtils$6(){
}

_ = CollectionUtils$6_0.prototype = CollectionUtils$6.prototype = new Object_0;
_.apply_1 = function apply_141(key, value){
  this.val$target.put(key, value);
}
;
_.getClass$ = function getClass_1507(){
  return Lorg_waveprotocol_wave_model_util_CollectionUtils$6_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$target = null;
function CollectionUtils$9_0(val$target){
  this.val$target = val$target;
}

function CollectionUtils$9(){
}

_ = CollectionUtils$9_0.prototype = CollectionUtils$9.prototype = new Object_0;
_.apply_1 = function apply_142(key, value){
  this.val$target.add_0(value);
}
;
_.getClass$ = function getClass_1508(){
  return Lorg_waveprotocol_wave_model_util_CollectionUtils$9_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$target = null;
_ = CollectionUtils$EmptyStringMap.prototype;
_.clear = function clear_27(){
}
;
_.countEntries = function countEntries_1(){
  return 0;
}
;
_.filter_0 = function filter_2(filter){
}
;
_.get_3 = function get_27(key, defaultValue){
  return null;
}
;
_.getExisting = function getExisting_0(key){
  throw new UnsupportedOperationException_0;
}
;
_.isEmpty = function isEmpty_13(){
  return true;
}
;
_.keySet_1 = function keySet_4(){
  return $clinit_2309() , defaultCollectionFactory.createStringSet();
}
;
_.putAll_0 = function putAll_2(pairsToAdd){
  throw new UnsupportedOperationException_0;
}
;
_ = CollectionUtils$HashCollectionFactory.prototype;
_.createIdentitySet = function createIdentitySet_0(){
  return new CollectionUtils$IdentitySetAdapter_0;
}
;
_ = CollectionUtils$IdentityHashMapAdapter.prototype;
_.clear = function clear_28(){
  $clearImpl(this.backend);
}
;
_.remove_6 = function remove_64(key){
  $remove_7(this.backend, key);
}
;
function CollectionUtils$IdentitySetAdapter_0(){
  this.backend = new IdentityHashMap_0;
}

function CollectionUtils$IdentitySetAdapter(){
}

_ = CollectionUtils$IdentitySetAdapter_0.prototype = CollectionUtils$IdentitySetAdapter.prototype = new Object_0;
_.add_2 = function add_17(x){
  checkNotNull_1(x, 'IdentitySet cannot contain null values');
  if (x != null && x.castableTypeMap$ && !!x.castableTypeMap$[1] || x != null && x.castableTypeMap$ && !!x.castableTypeMap$[66] || x != null && x.castableTypeMap$ && !!x.castableTypeMap$[64] || x != null && x.castableTypeMap$ && !!x.castableTypeMap$[67] || x != null && x.castableTypeMap$ && !!x.castableTypeMap$[62]) {
    throw new UnsupportedOperationException_1('Should NOT use boxed primitives with IdentitySet');
  }
  $put_0(this.backend, x, x);
}
;
_.clear = function clear_29(){
  $clearImpl(this.backend);
}
;
_.contains = function contains_21(s){
  checkNotNull_1(s, 'IdentitySet cannot contain null values');
  return $containsKey_1(this.backend, s);
}
;
_.each_0 = function each_7(procedure){
  var s, s$iterator, outerIter, entry;
  for (s$iterator = (outerIter = $keySet_0(this.backend).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter)); s$iterator.val$outerIter.hasNext();) {
    s = (entry = dynamicCast(s$iterator.val$outerIter.next_0(), 11) , entry.getKey());
    procedure.apply_7(s);
  }
}
;
_.getClass$ = function getClass_1512(){
  return Lorg_waveprotocol_wave_model_util_CollectionUtils$IdentitySetAdapter_2_classLit;
}
;
_.isEmpty = function isEmpty_15(){
  return this.backend.size_0 == 0;
}
;
_.remove_6 = function remove_65(s){
  checkNotNull_1(s, 'IdentitySet cannot contain null values');
  $remove_7(this.backend, s);
}
;
_.someElement = function someElement_1(){
  var e, e$iterator, outerIter, entry;
  for (e$iterator = (outerIter = $keySet_0(this.backend).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter)); e$iterator.val$outerIter.hasNext();) {
    e = (entry = dynamicCast(e$iterator.val$outerIter.next_0(), 11) , entry.getKey());
    return e;
  }
  return null;
}
;
_.toString$ = function toString_139(){
  return $toString_15(this.backend);
}
;
_.castableTypeMap$ = {324:1};
_ = CollectionUtils$IntMapAdapter.prototype;
_.each_1 = function each_8(callback){
  var entry, entry$iterator;
  for (entry$iterator = this.backend.entrySet_0().iterator_0(); entry$iterator.hasNext();) {
    entry = dynamicCast(entry$iterator.next_0(), 11);
    $apply_2(callback, dynamicCast(entry.getKey(), 66).value_0, entry.getValue());
  }
}
;
_ = CollectionUtils$StringMapAdapter.prototype;
_.clear = function clear_30(){
  this.backend.clear();
}
;
_.countEntries = function countEntries_2(){
  return this.backend.size_1();
}
;
_.filter_0 = function filter_3(filter){
  var entry, iterator;
  for (iterator = this.backend.entrySet_0().iterator_0(); iterator.hasNext();) {
    entry = dynamicCast(iterator.next_0(), 11);
    if ($apply_30(filter, dynamicCast(entry.getKey(), 1), entry.getValue()))
    ;
    else {
      iterator.remove_1();
    }
  }
}
;
_.get_3 = function get_33(key, defaultValue){
  checkNotNull_1(key, 'StringMap cannot contain null keys');
  return this.backend.containsKey(key)?this.backend.get(key):defaultValue;
}
;
_.getExisting = function getExisting_1(key){
  checkNotNull_1(key, 'StringMap cannot contain null keys');
  if (!this.backend.containsKey(key)) {
    throw new IllegalStateException_1("getExisting: Key '" + key + "' is not in map");
  }
  return this.backend.get(key);
}
;
_.isEmpty = function isEmpty_16(){
  return this.backend.isEmpty();
}
;
_.keySet_1 = function keySet_5(){
  return new CollectionUtils$StringSetAdapter_0(this.backend.keySet_0());
}
;
_.putAll_0 = function putAll_3(pairsToAdd){
  this.backend.putAll(dynamicCast(pairsToAdd, 469).backend);
}
;
_ = CollectionUtils$StringSetAdapter.prototype;
_.addAll_0 = function addAll_7(set){
  this.backend.addAll(dynamicCast(set, 470).backend);
}
;
_.clear = function clear_31(){
  this.backend.clear();
}
;
_.countEntries = function countEntries_3(){
  return this.backend.size_1();
}
;
_.each_3 = function each_10(callback){
  var s, s$iterator;
  for (s$iterator = this.backend.iterator_0(); s$iterator.hasNext();) {
    s = dynamicCast(s$iterator.next_0(), 1);
    callback.apply_4(s);
  }
}
;
_.filter_1 = function filter_4(filter){
  var iterator, x;
  for (iterator = this.backend.iterator_0(); iterator.hasNext();) {
    x = dynamicCast(iterator.next_0(), 1);
    if ($apply_31(filter, x))
    ;
    else {
      iterator.remove_1();
    }
  }
}
;
_.isEmpty = function isEmpty_17(){
  return this.backend.isEmpty();
}
;
_.isSubsetOf = function isSubsetOf_0(other){
  var s, s$iterator;
  for (s$iterator = this.backend.iterator_0(); s$iterator.hasNext();) {
    s = dynamicCast(s$iterator.next_0(), 1);
    if (!other.contains_0(s)) {
      return false;
    }
  }
  return true;
}
;
_.remove_8 = function remove_68(s){
  checkNotNull_1(s, 'StringSet cannot contain null values');
  this.backend.remove_0(s);
}
;
_.removeAll_0 = function removeAll_2(set){
  this.backend.removeAll(dynamicCast(set, 470).backend);
}
;
_.someElement_0 = function someElement_2(){
  return this.backend.isEmpty()?null:dynamicCast(this.backend.iterator_0().next_0(), 1);
}
;
function ConcurrentSet_0(){
  this.set = new HashSet_0;
  new HashSet_0;
  new HashSet_0;
}

function ConcurrentSet(){
}

_ = ConcurrentSet_0.prototype = ConcurrentSet.prototype = new Object_0;
_.getClass$ = function getClass_1518(){
  return Lorg_waveprotocol_wave_model_util_ConcurrentSet_2_classLit;
}
;
_.iterator_0 = function iterator_31(){
  var outerIter;
  return outerIter = $keySet_0(this.set.map).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter);
}
;
_.castableTypeMap$ = {};
function $clear_20(this$static){
  this$static.contents = ($clinit_480() , $clinit_480() , EMPTY_SET);
  this$static.stale = true;
}

function $remove_42(this$static, o){
  if (this$static.stale) {
    if (this$static.contents.contains(o)) {
      this$static.contents = this$static.factory.copy(this$static.contents);
      this$static.stale = false;
      return this$static.contents.remove_0(o);
    }
     else {
      return false;
    }
  }
   else {
    return this$static.contents.remove_0(o);
  }
}

function $performActionAt(this$static, offset, locationAction){
  var node;
  node = this$static.root;
  while (node) {
    if (offset < node.offset) {
      node = node.leftChild;
    }
     else {
      offset -= node.offset;
      if (offset < node.size_0) {
        return locationAction.performAction(node, offset);
      }
      offset -= node.size_0;
      node = node.rightChild;
    }
  }
  throw new IndexOutOfBoundsException_1('Invalid offest: ' + offset + ', size: ' + this$static.root.offset);
}

function EvaluableOffsetList_0(){
  this.root = new EvaluableOffsetList$Node_0(null, 1);
  this.root.previousContainer = this.root;
  this.root.nextContainer = this.root;
}

function getHeight(node){
  return !node?-1:node.height_0;
}

function EvaluableOffsetList(){
}

_ = EvaluableOffsetList_0.prototype = EvaluableOffsetList.prototype = new Object_0;
_.getClass$ = function getClass_1522(){
  return Lorg_waveprotocol_wave_model_util_EvaluableOffsetList_2_classLit;
}
;
_.iterator_0 = function iterator_33(){
  return new EvaluableOffsetList$1_0(this);
}
;
_.castableTypeMap$ = {};
_.root = null;
function EvaluableOffsetList$1_0(this$0){
  this.this$0 = this$0;
  this.nextContainer = this.this$0.root.nextContainer;
}

function EvaluableOffsetList$1(){
}

_ = EvaluableOffsetList$1_0.prototype = EvaluableOffsetList$1.prototype = new Object_0;
_.getClass$ = function getClass_1523(){
  return Lorg_waveprotocol_wave_model_util_EvaluableOffsetList$1_2_classLit;
}
;
_.hasNext = function hasNext_25(){
  return this.nextContainer != this.this$0.root;
}
;
_.next_0 = function next_35(){
  var returnValue_0;
  return returnValue_0 = this.nextContainer.value_0 , this.nextContainer = this.nextContainer.nextContainer , returnValue_0;
}
;
_.remove_1 = function remove_69(){
  throw new UnsupportedOperationException_0;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $correctOffsets(this$static, sizeDelta){
  var node, parentNode;
  for (node = this$static , parentNode = this$static.parent_0; parentNode; node = parentNode , parentNode = parentNode.parent_0) {
    parentNode.leftChild == node && (parentNode.offset += sizeDelta);
  }
}

function $getFirstInSubtree(this$static){
  var child, node;
  node = this$static;
  for (child = this$static.leftChild; child; node = child , child = child.leftChild) {
  }
  return node;
}

function $getLastInSubtree(this$static){
  var child, node;
  node = this$static;
  for (child = this$static.rightChild; child; node = child , child = child.rightChild) {
  }
  return node;
}

function $increaseSize(this$static, sizeDelta){
  this$static.size_0 += sizeDelta;
  $correctOffsets(this$static, sizeDelta);
}

function $insertBefore_9(this$static, newValue, valueSize){
  var newContainer;
  newContainer = new EvaluableOffsetList$Node_0(newValue, valueSize);
  newContainer.previousContainer = this$static.previousContainer;
  newContainer.nextContainer = this$static;
  this$static.previousContainer.nextContainer = newContainer;
  this$static.previousContainer = newContainer;
  !this$static.leftChild?(this$static.leftChild = newContainer , newContainer.parent_0 = this$static):$setRightChild($getLastInSubtree(this$static.leftChild), newContainer);
  this$static.offset += newContainer.size_0;
  $correctOffsets(this$static, newContainer.size_0);
  $rebalance(newContainer.parent_0);
  return newContainer;
}

function $offset(this$static){
  var currentNode, currentParent, totalOffset;
  totalOffset = this$static.offset;
  for (currentNode = this$static , currentParent = this$static.parent_0; currentParent; currentParent = currentParent.parent_0) {
    currentParent.rightChild == currentNode && (totalOffset += currentParent.offset + currentParent.size_0);
    currentNode = currentParent;
  }
  return totalOffset;
}

function $rebalance(this$static){
  var leftHeight, node, oldHeight, rightHeight;
  for (node = this$static; node.parent_0; node = node.parent_0) {
    oldHeight = node.height_0;
    leftHeight = getHeight(node.leftChild);
    rightHeight = getHeight(node.rightChild);
    if (rightHeight == leftHeight + 2) {
      getHeight(node.rightChild.rightChild) != rightHeight - 1 && $rotateRight(node.rightChild);
      node = $rotateLeft(node);
    }
     else if (leftHeight == rightHeight + 2) {
      getHeight(node.leftChild.leftChild) != leftHeight - 1 && $rotateLeft(node.leftChild);
      node = $rotateRight(node);
    }
     else {
      node.height_0 = (leftHeight > rightHeight?leftHeight:rightHeight) + 1;
    }
    if (node.height_0 == oldHeight) {
      break;
    }
  }
}

function $remove_43(this$static){
  var node, parentOfReplacement, removalSize, replacementNode;
  this$static.nextContainer.previousContainer = this$static.previousContainer;
  this$static.previousContainer.nextContainer = this$static.nextContainer;
  $correctOffsets(this$static, -this$static.size_0);
  if (!this$static.rightChild) {
    $replaceWith(this$static, this$static.leftChild);
    $rebalance(this$static.parent_0);
  }
   else {
    replacementNode = $getFirstInSubtree(this$static.rightChild);
    parentOfReplacement = replacementNode.parent_0;
    removalSize = replacementNode.size_0;
    for (node = parentOfReplacement; node != this$static; node = node.parent_0) {
      node.offset -= removalSize;
    }
    $replaceWith(replacementNode, replacementNode.rightChild);
    !!replacementNode && (replacementNode.parent_0 = this$static.parent_0);
    this$static.parent_0.leftChild == this$static?(this$static.parent_0.leftChild = replacementNode):(this$static.parent_0.rightChild = replacementNode);
    $setLeftChildSafely(replacementNode, this$static.leftChild);
    $setRightChildSafely(replacementNode, this$static.rightChild);
    replacementNode.offset = this$static.offset;
    replacementNode.height_0 = this$static.height_0;
    $rebalance(parentOfReplacement != this$static?parentOfReplacement:replacementNode);
  }
  this$static.nextContainer = null;
  this$static.previousContainer = null;
  this$static.parent_0 = null;
  this$static.leftChild = null;
  this$static.rightChild = null;
}

function $replaceWith(this$static, replacement){
  !!replacement && (replacement.parent_0 = this$static.parent_0);
  this$static.parent_0.leftChild == this$static?(this$static.parent_0.leftChild = replacement):(this$static.parent_0.rightChild = replacement);
}

function $rotateLeft(this$static){
  var newRoot, subtree1, subtree2;
  newRoot = this$static.rightChild;
  subtree1 = newRoot.leftChild;
  subtree2 = this$static.leftChild;
  !!newRoot && (newRoot.parent_0 = this$static.parent_0);
  this$static.parent_0.leftChild == this$static?(this$static.parent_0.leftChild = newRoot):(this$static.parent_0.rightChild = newRoot);
  this$static.rightChild = subtree1;
  !!subtree1 && (subtree1.parent_0 = this$static);
  newRoot.leftChild = this$static;
  this$static.parent_0 = newRoot;
  this$static.height_0 = max_1(!subtree1?-1:subtree1.height_0, !subtree2?-1:subtree2.height_0) + 1;
  this$static.height_0 + 1 > newRoot.height_0 && (newRoot.height_0 = this$static.height_0 + 1);
  newRoot.offset += this$static.offset + this$static.size_0;
  return newRoot;
}

function $rotateRight(this$static){
  var newRoot, subtree1, subtree2;
  newRoot = this$static.leftChild;
  subtree1 = newRoot.rightChild;
  subtree2 = this$static.rightChild;
  !!newRoot && (newRoot.parent_0 = this$static.parent_0);
  this$static.parent_0.leftChild == this$static?(this$static.parent_0.leftChild = newRoot):(this$static.parent_0.rightChild = newRoot);
  this$static.leftChild = subtree1;
  !!subtree1 && (subtree1.parent_0 = this$static);
  newRoot.rightChild = this$static;
  this$static.parent_0 = newRoot;
  this$static.height_0 = max_1(!subtree1?-1:subtree1.height_0, !subtree2?-1:subtree2.height_0) + 1;
  this$static.height_0 + 1 > newRoot.height_0 && (newRoot.height_0 = this$static.height_0 + 1);
  this$static.offset -= newRoot.offset + newRoot.size_0;
  return newRoot;
}

function $setLeftChildSafely(this$static, leftChild){
  this$static.leftChild = leftChild;
  !!leftChild && (leftChild.parent_0 = this$static);
}

function $setRightChild(this$static, rightChild){
  this$static.rightChild = rightChild;
  rightChild.parent_0 = this$static;
}

function $setRightChildSafely(this$static, rightChild){
  this$static.rightChild = rightChild;
  !!rightChild && (rightChild.parent_0 = this$static);
}

function $split_1(this$static, offset, newValue){
  var newContainer, node, secondSize;
  secondSize = this$static.size_0 - offset;
  newContainer = new EvaluableOffsetList$Node_0(newValue, secondSize);
  newContainer.nextContainer = this$static.nextContainer;
  newContainer.previousContainer = this$static;
  this$static.nextContainer.previousContainer = newContainer;
  this$static.nextContainer = newContainer;
  this$static.size_0 = offset;
  if (!this$static.rightChild) {
    this$static.rightChild = newContainer;
    newContainer.parent_0 = this$static;
  }
   else {
    node = this$static.rightChild;
    while (node.leftChild) {
      node.offset += secondSize;
      node = node.leftChild;
    }
    node.offset += secondSize;
    node.leftChild = newContainer;
    newContainer.parent_0 = node;
  }
  $rebalance(newContainer.parent_0);
  return newContainer;
}

function EvaluableOffsetList$Node_0(value, size){
  this.value_0 = value;
  this.size_0 = size;
}

function EvaluableOffsetList$Node(){
}

_ = EvaluableOffsetList$Node_0.prototype = EvaluableOffsetList$Node.prototype = new Object_0;
_.getClass$ = function getClass_1524(){
  return Lorg_waveprotocol_wave_model_util_EvaluableOffsetList$Node_2_classLit;
}
;
_.toString$ = function toString_145(){
  return $offset(this) + ',' + this.size_0 + ':' + this.value_0;
}
;
_.castableTypeMap$ = {};
_.height_0 = 0;
_.leftChild = null;
_.nextContainer = null;
_.offset = 0;
_.parent_0 = null;
_.previousContainer = null;
_.rightChild = null;
_.size_0 = 0;
_.value_0 = null;
function $equals_16(this$static, o){
  var p;
  if (o == null)
    return false;
  if (o === this$static)
    return true;
  if (o != null && o.castableTypeMap$ && !!o.castableTypeMap$[398]) {
    p = dynamicCast(o, 398);
    return (maskUndefined(p.first) === maskUndefined(this$static.first) || this$static.first != null && equals__devirtual$(this$static.first, p.first)) && (maskUndefined(p.second) === maskUndefined(this$static.second) || this$static.second != null && equals__devirtual$(this$static.second, p.second));
  }
  return false;
}

function $hashCode_14(this$static){
  return (this$static.first == null?0:hashCode__devirtual$(this$static.first)) + 37 * (this$static.second == null?0:hashCode__devirtual$(this$static.second));
}

function Pair_0(first, second){
  this.first = first;
  this.second = second;
}

function Pair(){
}

_ = Pair_0.prototype = Pair.prototype = new Object_0;
_.equals$ = function equals_68(o){
  return $equals_16(this, o);
}
;
_.getClass$ = function getClass_1527(){
  return Lorg_waveprotocol_wave_model_util_Pair_2_classLit;
}
;
_.hashCode$ = function hashCode_67(){
  return (this.first == null?0:hashCode__devirtual$(this.first)) + 37 * (this.second == null?0:hashCode__devirtual$(this.second));
}
;
_.toString$ = function toString_146(){
  return '(' + this.first + ',' + this.second + ')';
}
;
_.castableTypeMap$ = {398:1};
_.first = null;
_.second = null;
function checkArgument_3(condition, errorMessageTemplate, errorMessageArgs){
  if (!condition) {
    throw new IllegalArgumentException_1(format_1(errorMessageTemplate, errorMessageArgs));
  }
}

function checkElementIndex(index, size){
  if (index < 0) {
    throw new IndexOutOfBoundsException_1('index (' + index + ') must not be negative');
  }
  if (index >= size) {
    throw new IndexOutOfBoundsException_1('index (' + index + ') must be less than size (' + size + ')');
  }
}

function checkPositionIndex(index, size){
  if (index < 0) {
    throw new IndexOutOfBoundsException_1('index (' + index + ') must not be negative');
  }
  if (index > size) {
    throw new IndexOutOfBoundsException_1('index (' + index + ') must not be greater than size (' + size + ')');
  }
}

function checkPositionIndexesInRange(start, end, rangeEnd){
  if (start < 0) {
    throw new IndexOutOfBoundsException_1('start index (' + start + ') must not be less than start of range (0)');
  }
  if (end < start) {
    throw new IndexOutOfBoundsException_1('end index (' + end + ') must not be less than start index (' + start + ')');
  }
  if (end > rangeEnd) {
    throw new IndexOutOfBoundsException_1('end index (' + end + ') must not be greater than end of range (' + rangeEnd + ')');
  }
}

function checkState_2(condition, errorMessage){
  if (!condition) {
    throw new IllegalStateException_1('' + errorMessage);
  }
}

function checkState_3(condition, errorMessageArgs){
  if (!condition) {
    throw new IllegalStateException_1(format_1('size %s != position %s', errorMessageArgs));
  }
}

function format_1(template, args){
  var builder, i, placeholderStart, templateStart;
  template = '' + template;
  builder = new StringBuilder_1(template.length + 16 * args.length);
  templateStart = 0;
  i = 0;
  while (i < args.length) {
    placeholderStart = template.indexOf('%s', templateStart);
    if (placeholderStart == -1) {
      break;
    }
    $append_11(builder, template.substr(templateStart, placeholderStart - templateStart));
    $append_10(builder, args[i++]);
    templateStart = placeholderStart + 2;
  }
  $append_11(builder, template.substr(templateStart, template.length - templateStart));
  if (i < args.length) {
    builder.impl.string += ' [';
    $append_10(builder, args[i++]);
    while (i < args.length) {
      builder.impl.string += ', ';
      $append_10(builder, args[i++]);
    }
    builder.impl.string += ']';
  }
  return builder.impl.string;
}

function illegalArgument(errorMessage){
  throw new IllegalArgumentException_1('' + errorMessage);
}

function illegalState(errorMessage){
  throw new IllegalStateException_1('' + errorMessage);
}

function nullPointer(errorMessage){
  throw new NullPointerException_1('' + errorMessage);
}

function $clinit_2363(){
  $clinit_2363 = nullMethod;
  STRING = new Serializer$1_0;
  LONG = new Serializer$2_0;
  INTEGER = new Serializer$3_0;
  BOOLEAN = new Serializer$4_0;
  DOUBLE = new Serializer$5_0;
}

var BOOLEAN, DOUBLE, INTEGER, LONG, STRING;
function Serializer$1_0(){
}

function Serializer$1(){
}

_ = Serializer$1_0.prototype = Serializer$1.prototype = new Object_0;
_.fromString = function fromString_0(s){
  return s != null?s:null;
}
;
_.getClass$ = function getClass_1528(){
  return Lorg_waveprotocol_wave_model_util_Serializer$1_2_classLit;
}
;
_.toString_0 = function toString_147(x){
  return dynamicCast(x, 1);
}
;
_.castableTypeMap$ = {};
function $fromString_1(s, defaultValue){
  return s != null?valueOf_14(__parseAndValidateLong(s)):defaultValue;
}

function $toString_30(x){
  return x?'' + toString_14(x.value_0):null;
}

function Serializer$2_0(){
}

function Serializer$2(){
}

_ = Serializer$2_0.prototype = Serializer$2.prototype = new Object_0;
_.fromString = function fromString_1(s){
  return s != null?valueOf_14(__parseAndValidateLong(s)):null;
}
;
_.getClass$ = function getClass_1529(){
  return Lorg_waveprotocol_wave_model_util_Serializer$2_2_classLit;
}
;
_.toString_0 = function toString_148(x){
  return $toString_30(dynamicCast(x, 67));
}
;
_.castableTypeMap$ = {};
function $fromString_2(s){
  return s != null?valueOf_13(__parseAndValidateInt(s, 10)):null;
}

function $toString_32(x){
  return x?'' + x.value_0:null;
}

function Serializer$3_0(){
}

function Serializer$3(){
}

_ = Serializer$3_0.prototype = Serializer$3.prototype = new Object_0;
_.fromString = function fromString_2(s){
  return s != null?valueOf_13(__parseAndValidateInt(s, 10)):null;
}
;
_.getClass$ = function getClass_1530(){
  return Lorg_waveprotocol_wave_model_util_Serializer$3_2_classLit;
}
;
_.toString_0 = function toString_149(x){
  return $toString_32(dynamicCast(x, 66));
}
;
_.castableTypeMap$ = {};
function $fromString_3(s, defaultValue){
  return s != null?($clinit_428() , $clinit_428() , $equalsIgnoreCase('true', s)?TRUE_0:FALSE_0):defaultValue;
}

function $toString_33(x){
  return x?x.value_0?'true':'false':null;
}

function Serializer$4_0(){
}

function Serializer$4(){
}

_ = Serializer$4_0.prototype = Serializer$4.prototype = new Object_0;
_.fromString = function fromString_3(s){
  return s != null?($clinit_428() , $clinit_428() , $equalsIgnoreCase('true', s)?TRUE_0:FALSE_0):null;
}
;
_.getClass$ = function getClass_1531(){
  return Lorg_waveprotocol_wave_model_util_Serializer$4_2_classLit;
}
;
_.toString_0 = function toString_150(x){
  return $toString_33(dynamicCast(x, 62));
}
;
_.castableTypeMap$ = {};
function $fromString_4(s, defaultValue){
  return s != null?new Double_0(__parseAndValidateDouble(s)):defaultValue;
}

function $toString_35(x){
  return x?'' + x.value_0:null;
}

function Serializer$5_0(){
}

function Serializer$5(){
}

_ = Serializer$5_0.prototype = Serializer$5.prototype = new Object_0;
_.fromString = function fromString_4(s){
  return s != null?new Double_0(__parseAndValidateDouble(s)):null;
}
;
_.getClass$ = function getClass_1532(){
  return Lorg_waveprotocol_wave_model_util_Serializer$5_2_classLit;
}
;
_.toString_0 = function toString_151(x){
  return $toString_35(dynamicCast(x, 64));
}
;
_.castableTypeMap$ = {};
function $toString_37(x){
  return x?x.name_1:null;
}

function Serializer$EnumSerializer_0(enumClass){
  this.enumClass = enumClass;
}

function Serializer$EnumSerializer(){
}

_ = Serializer$EnumSerializer_0.prototype = Serializer$EnumSerializer.prototype = new Object_0;
_.fromString = function fromString_5(s){
  return s != null?valueOf(this.enumClass, s):null;
}
;
_.getClass$ = function getClass_1533(){
  return Lorg_waveprotocol_wave_model_util_Serializer$EnumSerializer_2_classLit;
}
;
_.toString_0 = function toString_152(x){
  return $toString_37(dynamicCast(x, 65));
}
;
_.castableTypeMap$ = {};
_.enumClass = null;
function $clinit_2376(){
  $clinit_2376 = nullMethod;
  VALID_UTF16 = new Utf16Util$2_0;
  GOOD_UTF16_FOR_BLIP = new Utf16Util$3_0;
}

function firstSurrogate(s){
  $clinit_2376();
  var i;
  for (i = 0; i < s.length; ++i) {
    if (isSurrogate(s.charCodeAt(i))) {
      return i;
    }
  }
  return -1;
}

function isCodePointGoodForBlip(c){
  $clinit_2376();
  0 <= c && c <= 1114111 || illegalArgument('Not a code point: 0x' + toPowerOfTwoString(c));
  (0 <= c && c <= 1114111 || illegalArgument('Not a code point: 0x' + toPowerOfTwoString(c)) , 55296 <= c && c <= 57343) && illegalArgument('Code point is a surrogate: 0x' + toPowerOfTwoString(c));
  if (!isCodePointValid(c)) {
    return $clinit_2380() , NONCHARACTER;
  }
  if (0 <= c && c <= 31 || 127 <= c && c <= 159) {
    return $clinit_2380() , CONTROL;
  }
  if (8298 <= c && c <= 8303) {
    return $clinit_2380() , DEPRECATED;
  }
  if (c == 8206 || c == 8207) {
    return $clinit_2380() , BIDI;
  }
  if (8234 <= c && c <= 8238) {
    return $clinit_2380() , BIDI;
  }
  if (917504 <= c && c <= 917631) {
    return $clinit_2380() , TAG;
  }
  return $clinit_2380() , OK;
}

function isCodePointValid(c){
  $clinit_2376();
  var d;
  0 <= c && c <= 1114111 || illegalArgument('Not a code point: 0x' + toPowerOfTwoString(c));
  (0 <= c && c <= 1114111 || illegalArgument('Not a code point: 0x' + toPowerOfTwoString(c)) , 55296 <= c && c <= 57343) && illegalArgument('Code point is a surrogate: 0x' + toPowerOfTwoString(c));
  d = c & 65535;
  if (d == 65534 || d == 65535) {
    return false;
  }
  if (64976 <= c && c <= 65007) {
    return false;
  }
  return true;
}

function isHighSurrogate(c){
  $clinit_2376();
  return 55296 <= c && c <= 56319;
}

function isSurrogate(c){
  return 55296 <= c && c <= 57343;
}

function isXmlName_0(s){
  $clinit_2376();
  checkNotNull_1(s, 'Null XML name string');
  if (!s.length) {
    return false;
  }
  return traverseUtf16String(s, new Utf16Util$5_0).value_0;
}

function isXmlNameChar_0(c){
  $clinit_2376();
  if (!isCodePointValid(c)) {
    return false;
  }
  return c == 58 || 65 <= c && c <= 90 || c == 95 | (97 <= c && c <= 122) || 192 <= c && c <= 214 || 216 <= c && c <= 246 || 248 <= c && c <= 767 || 880 <= c && c <= 893 || 895 <= c && c <= 8191 || 8204 <= c && c <= 8205 || 8304 <= c && c <= 8591 || 11264 <= c && c <= 12271 || 12289 <= c && c <= 55295 || 63744 <= c && c <= 64975 || 65008 <= c && c <= 65533 || 65536 <= c && c <= 983039 && isCodePointValid(c) || c == 45 || c == 46 || 48 <= c && c <= 57 || c == 183 || 768 <= c && c <= 879 || 8255 <= c && c <= 8256;
}

function traverseUtf16String(s, handler){
  $clinit_2376();
  var c, c2, cp, i, v;
  checkNotNull_1(s, 'Null string');
  nextCodeUnit: for (i = 0; i < s.length; ++i) {
    c = s.charCodeAt(i);
    if (55296 <= c && c <= 57343) {
      if (56320 <= c && c <= 57343) {
        v = handler.unpairedSurrogate(c);
        if (v) {
          return v;
        }
        continue nextCodeUnit;
      }
      ++i;
      if (i >= s.length) {
        v = handler.unpairedSurrogate(c);
        if (v) {
          return v;
        }
        break nextCodeUnit;
      }
      c2 = s.charCodeAt(i);
      if (56320 <= c2 && c2 <= 57343) {
        cp = 65536 + ((c & 1023) << 10) + (c2 & 1023);
      }
       else {
        v = handler.unpairedSurrogate(c);
        if (v) {
          return v;
        }
        --i;
        continue nextCodeUnit;
      }
    }
     else {
      cp = c;
    }
    v = handler.codePoint(cp);
    if (v) {
      return v;
    }
  }
  return handler.endOfString();
}

var GOOD_UTF16_FOR_BLIP, VALID_UTF16;
function $codePoint_0(cp){
  if (!isCodePointValid(cp)) {
    return $clinit_428() , $clinit_428() , FALSE_0;
  }
  return null;
}

function Utf16Util$2_0(){
}

function Utf16Util$2(){
}

_ = Utf16Util$2_0.prototype = Utf16Util$2.prototype = new Object_0;
_.codePoint = function codePoint_3(cp){
  return $codePoint_0(cp);
}
;
_.endOfString = function endOfString_2(){
  return $clinit_428() , $clinit_428() , TRUE_0;
}
;
_.getClass$ = function getClass_1534(){
  return Lorg_waveprotocol_wave_model_util_Utf16Util$2_2_classLit;
}
;
_.unpairedSurrogate = function unpairedSurrogate_2(c){
  return $clinit_428() , $clinit_428() , FALSE_0;
}
;
_.castableTypeMap$ = {};
function $codePoint_1(cp){
  if (isCodePointGoodForBlip(cp) != ($clinit_2380() , OK)) {
    return $clinit_428() , $clinit_428() , FALSE_0;
  }
  return null;
}

function Utf16Util$3_0(){
}

function Utf16Util$3(){
}

_ = Utf16Util$3_0.prototype = Utf16Util$3.prototype = new Object_0;
_.codePoint = function codePoint_4(cp){
  return $codePoint_1(cp);
}
;
_.endOfString = function endOfString_3(){
  return $clinit_428() , $clinit_428() , TRUE_0;
}
;
_.getClass$ = function getClass_1535(){
  return Lorg_waveprotocol_wave_model_util_Utf16Util$3_2_classLit;
}
;
_.unpairedSurrogate = function unpairedSurrogate_3(c){
  return $clinit_428() , $clinit_428() , FALSE_0;
}
;
_.castableTypeMap$ = {};
function $codePoint_2(this$static, cp){
  if (this$static.first) {
    $clinit_2376();
    if (!(cp == 58 || 65 <= cp && cp <= 90 || cp == 95 | (97 <= cp && cp <= 122) || 192 <= cp && cp <= 214 || 216 <= cp && cp <= 246 || 248 <= cp && cp <= 767 || 880 <= cp && cp <= 893 || 895 <= cp && cp <= 8191 || 8204 <= cp && cp <= 8205 || 8304 <= cp && cp <= 8591 || 11264 <= cp && cp <= 12271 || 12289 <= cp && cp <= 55295 || 63744 <= cp && cp <= 64975 || 65008 <= cp && cp <= 65533 || 65536 <= cp && cp <= 983039 && isCodePointValid(cp))) {
      return $clinit_428() , $clinit_428() , FALSE_0;
    }
    this$static.first = false;
  }
   else {
    if (!isXmlNameChar_0(cp)) {
      return $clinit_428() , $clinit_428() , FALSE_0;
    }
  }
  return null;
}

function Utf16Util$5_0(){
}

function Utf16Util$5(){
}

_ = Utf16Util$5_0.prototype = Utf16Util$5.prototype = new Object_0;
_.codePoint = function codePoint_5(cp){
  return $codePoint_2(this, cp);
}
;
_.endOfString = function endOfString_4(){
  return $clinit_428() , $clinit_428() , TRUE_0;
}
;
_.getClass$ = function getClass_1536(){
  return Lorg_waveprotocol_wave_model_util_Utf16Util$5_2_classLit;
}
;
_.unpairedSurrogate = function unpairedSurrogate_4(c){
  return $clinit_428() , $clinit_428() , FALSE_0;
}
;
_.castableTypeMap$ = {};
_.first = true;
function $clinit_2380(){
  $clinit_2380 = nullMethod;
  OK = new Utf16Util$BlipCodePointResult_0('OK', 0);
  CONTROL = new Utf16Util$BlipCodePointResult_0('CONTROL', 1);
  DEPRECATED = new Utf16Util$BlipCodePointResult_0('DEPRECATED', 2);
  BIDI = new Utf16Util$BlipCodePointResult_0('BIDI', 3);
  TAG = new Utf16Util$BlipCodePointResult_0('TAG', 4);
  NONCHARACTER = new Utf16Util$BlipCodePointResult_0('NONCHARACTER', 5);
  $VALUES_78 = initValues(_3Lorg_waveprotocol_wave_model_util_Utf16Util$BlipCodePointResult_2_classLit, {9:1, 68:1, 170:1}, 163, [OK, CONTROL, DEPRECATED, BIDI, TAG, NONCHARACTER]);
}

function Utf16Util$BlipCodePointResult_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_86(name_0){
  $clinit_2380();
  return valueOf_0(($clinit_2381() , $MAP_78), name_0);
}

function values_79(){
  $clinit_2380();
  return $VALUES_78;
}

function Utf16Util$BlipCodePointResult(){
}

_ = Utf16Util$BlipCodePointResult_0.prototype = Utf16Util$BlipCodePointResult.prototype = new Enum;
_.getClass$ = function getClass_1537(){
  return Lorg_waveprotocol_wave_model_util_Utf16Util$BlipCodePointResult_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 163:1};
var $VALUES_78, BIDI, CONTROL, DEPRECATED, NONCHARACTER, OK, TAG;
function $clinit_2381(){
  $clinit_2381 = nullMethod;
  $MAP_78 = createValueOfMap(($clinit_2380() , $VALUES_78));
}

var $MAP_78;
function valueOrDefault(value, def){
  return value != null?value:def;
}

function $compareTo_19(this$static, other){
  return neq(this$static.version, other.version)?signum_0(sub(this$static.version, other.version)):compare_10(this$static.historyHash, other.historyHash);
}

function $equals_17(this$static, obj){
  var that;
  if (obj === this$static) {
    return true;
  }
   else if (obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[471]) {
    that = dynamicCast(obj, 471);
    return eq(this$static.version, that.version) && equals_16(this$static.historyHash, that.historyHash);
  }
   else {
    return false;
  }
}

function HashedVersion_0(version, historyHash){
  checkArgument_2(gte_0(version, P0_longLit), 'negative version');
  checkNotNull_1(historyHash, 'null history hash');
  this.version = version;
  this.historyHash = historyHash;
}

function compare_10(first, second){
  var i;
  if ((first == null?null:first) === (second == null?null:second)) {
    return 0;
  }
  for (i = 0; i < first.length && i < second.length; ++i) {
    if (first[i] != second[i]) {
      return first[i] - second[i] == 0?0:first[i] - second[i] < 0?-1:1;
    }
  }
  return signum(first.length - second.length);
}

function HashedVersion(){
}

_ = HashedVersion_0.prototype = HashedVersion.prototype = new Object_0;
_.compareTo$ = function compareTo_20(other){
  return $compareTo_19(this, dynamicCast(other, 471));
}
;
_.equals$ = function equals_69(obj){
  return $equals_17(this, obj);
}
;
_.getClass$ = function getClass_1538(){
  return Lorg_waveprotocol_wave_model_version_HashedVersion_2_classLit;
}
;
_.hashCode$ = function hashCode_68(){
  return result = 527 + toInt(valueOf_14(this.version).value_0) , 31 * result + hashCode_18(this.historyHash);
}
;
_.toString$ = function toString_153(){
  return '' + toString_14(this.version) + ':' + encode_0(this.historyHash);
}
;
_.castableTypeMap$ = {10:1, 471:1};
_.historyHash = null;
_.version = P0_longLit;
function $clinit_2385(){
  $clinit_2385 = nullMethod;
  EMPTY_2 = initDim(_3B_classLit, {9:1}, -1, 0, 1);
  INSTANCE_18 = new HashedVersionSerializer$1_0;
}

var EMPTY_2, INSTANCE_18;
function $fromString_5(s){
  var $e0, h_0, pair, v, chars;
  if (null == s) {
    return null;
  }
  pair = $split(s, ':', 2);
  v = __parseAndValidateLong(pair[0]);
  h_0 = ($clinit_2385() , EMPTY_2);
  if (pair.length == 2) {
    try {
      h_0 = ($clinit_2307() , chars = $toCharArray(pair[1]) , decode_0(chars, chars.length, DECODABET));
    }
     catch ($e0) {
      $e0 = caught_0($e0);
      if (instanceOf($e0, 472)) {
        throw new IllegalArgumentException_1("Invalid base64 hash: '" + pair[1] + "'");
      }
       else 
        throw $e0;
    }
  }
  return new HashedVersion_0(v, h_0);
}

function $toString_38(x){
  return x?toString_14(x.version) + ':' + encode_0(x.historyHash):null;
}

function HashedVersionSerializer$1_0(){
}

function HashedVersionSerializer$1(){
}

_ = HashedVersionSerializer$1_0.prototype = HashedVersionSerializer$1.prototype = new Object_0;
_.fromString = function fromString_6(s){
  return $fromString_5(s);
}
;
_.getClass$ = function getClass_1539(){
  return Lorg_waveprotocol_wave_model_version_HashedVersionSerializer$1_2_classLit;
}
;
_.toString_0 = function toString_154(x){
  return $toString_38(dynamicCast(x, 471));
}
;
_.castableTypeMap$ = {};
function InvalidParticipantAddress_0(address, message){
  this.fillInStackTrace();
  this.detailMessage = message;
  this.address = address;
}

function InvalidParticipantAddress(){
}

_ = InvalidParticipantAddress_0.prototype = InvalidParticipantAddress.prototype = new Exception;
_.getClass$ = function getClass_1540(){
  return Lorg_waveprotocol_wave_model_wave_InvalidParticipantAddress_2_classLit;
}
;
_.getMessage = function getMessage_2(){
  return "Invalid address '" + this.address + "': " + this.detailMessage;
}
;
_.castableTypeMap$ = {9:1, 39:1, 183:1, 199:1};
_.address = null;
function $compareTo_20(this$static, other){
  var diff, i, minLen, otherParts, parts;
  parts = $split(this$static.address, '@', 0);
  otherParts = $split(other.address, '@', 0);
  minLen = min_1(parts.length, otherParts.length);
  for (i = 0; i < minLen; ++i) {
    diff = compareTo_5(parts[i], otherParts[i]);
    if (diff != 0) {
      return diff;
    }
  }
  return parts.length - otherParts.length;
}

function $equals_18(this$static, o){
  var p;
  if (o === this$static) {
    return true;
  }
   else if (o != null && o.castableTypeMap$ && !!o.castableTypeMap$[164]) {
    p = dynamicCast(o, 164);
    return $equals_3(this$static.address, p.address);
  }
  return false;
}

function ParticipantId_0(address){
  checkNotNull_1(address, 'Non-null address expected');
  address = address.toLowerCase();
  this.address = address;
}

function of_10(address){
  validate_2(address);
  return new ParticipantId_0(address);
}

function ofUnsafe(address){
  var $e0, e;
  try {
    return validate_2(address) , new ParticipantId_0(address);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 199)) {
      e = $e0;
      throw new IllegalArgumentException_3(e);
    }
     else 
      throw $e0;
  }
}

function validate_2(address){
  var sepIndex;
  checkNotNull_1(address, 'Expected non-null address');
  sepIndex = address.indexOf('@');
  if (sepIndex < 0) {
    throw new InvalidParticipantAddress_0(address, 'Missing domain prefix: @');
  }
   else if (sepIndex >= address.length - 1) {
    throw new InvalidParticipantAddress_0(address, 'Missing domain');
  }
   else if (sepIndex != address.lastIndexOf('@')) {
    throw new InvalidParticipantAddress_0(address, 'Multiple domain prefixes: @');
  }
}

function ParticipantId(){
}

_ = ParticipantId_0.prototype = ParticipantId.prototype = new Object_0;
_.compareTo$ = function compareTo_21(other){
  return $compareTo_20(this, dynamicCast(other, 164));
}
;
_.equals$ = function equals_70(o){
  return $equals_18(this, o);
}
;
_.getClass$ = function getClass_1541(){
  return Lorg_waveprotocol_wave_model_wave_ParticipantId_2_classLit;
}
;
_.hashCode$ = function hashCode_69(){
  return getHashCode_0(this.address);
}
;
_.toString$ = function toString_155(){
  return this.address;
}
;
_.castableTypeMap$ = {9:1, 10:1, 164:1};
_.address = null;
function $clinit_2392(){
  $clinit_2392 = nullMethod;
  AUTO_0 = new ParticipationHelper$3_0;
  DEFAULT_2 = AUTO_0;
}

var AUTO_0, DEFAULT_2;
function ParticipationHelper$3_0(){
}

function ParticipationHelper$3(){
}

_ = ParticipationHelper$3_0.prototype = ParticipationHelper$3.prototype = new Object_0;
_.getAuthoriser = function getAuthoriser_0(editor, candidates){
  return editor;
}
;
_.getClass$ = function getClass_1542(){
  return Lorg_waveprotocol_wave_model_wave_ParticipationHelper$3_2_classLit;
}
;
_.castableTypeMap$ = {};
function $setLastModifiedTime(this$static, newTime){
  var oldLastModifiedTime;
  if (eq(newTime, this$static.lastModifiedTime)) {
    return newTime;
  }
  oldLastModifiedTime = valueOf_14(this$static.lastModifiedTime);
  this$static.lastModifiedTime = newTime;
  $onBlipDataTimestampModified(this$static.wavelet.listenerManager, this$static.wavelet, this$static, oldLastModifiedTime.value_0, newTime);
  return oldLastModifiedTime.value_0;
}

function $setLastModifiedVersion(this$static, newVersion){
  var oldVersion;
  if (eq(newVersion, this$static.lastModifiedVersion)) {
    return newVersion;
  }
  oldVersion = valueOf_14(this$static.lastModifiedVersion);
  this$static.lastModifiedVersion = newVersion;
  $onBlipDataVersionModified(this$static.wavelet.listenerManager, this$static.wavelet, this$static, oldVersion.value_0, newVersion);
  return oldVersion.value_0;
}

function AbstractBlipData(){
}

_ = AbstractBlipData.prototype = new Object_0;
_.getClass$ = function getClass_1543(){
  return Lorg_waveprotocol_wave_model_wave_data_impl_AbstractBlipData_2_classLit;
}
;
_.toString$ = function toString_156(){
  return 'Blip state = [id:' + this.id_0 + '] [author: ' + this.author + '] [contributors: ' + this.contributors + '] [lastModifiedVersion:' + toString_14(this.lastModifiedVersion) + '] [lastModifiedTime:' + toString_14(this.lastModifiedTime) + ']';
}
;
_.castableTypeMap$ = {};
_.author = null;
_.content_0 = null;
_.id_0 = null;
_.lastModifiedTime = P0_longLit;
_.lastModifiedVersion = P0_longLit;
_.wavelet = null;
function $addParticipant_0(this$static, p){
  var participants, old;
  participants = this$static.participants;
  if (participants.map.containsKey(p)) {
    return false;
  }
  old = participants.map.put(p, participants);
  $onParticipantAdded_0(this$static.listenerManager, this$static, p);
  return true;
}

function $addParticipant_1(this$static, p, position){
  var participants;
  participants = this$static.participants;
  if (participants.map.containsKey(p)) {
    return false;
  }
  insert_1(participants, position, p);
  $onParticipantAdded_0(this$static.listenerManager, this$static, p);
  return true;
}

function $createDocument(this$static, docId, author, contributors, content_0, lastModifiedTime, lastModifiedVersion){
  var doc;
  doc = $internalCreateDocument(this$static, docId, author, contributors, this$static.contentFactory.create_1(this$static.id_0, docId, content_0), lastModifiedTime, lastModifiedVersion);
  $onBlipDataAdded(this$static.listenerManager, this$static, doc);
  return doc;
}

function $setHashedVersion(this$static, newHashedVersion){
  var oldHashedVersion;
  if ($equals_17(this$static.hashedVersion, newHashedVersion)) {
    return this$static.hashedVersion;
  }
   else {
    oldHashedVersion = this$static.hashedVersion;
    this$static.hashedVersion = newHashedVersion;
    $onHashedVersionChanged(this$static.listenerManager, this$static, oldHashedVersion, newHashedVersion);
    return oldHashedVersion;
  }
}

function $setLastModifiedTime_0(this$static, newTime){
  var oldTime;
  if (eq(newTime, this$static.lastModifiedTime)) {
    return newTime;
  }
  oldTime = this$static.lastModifiedTime;
  this$static.lastModifiedTime = newTime;
  $onLastModifiedTimeChanged(this$static.listenerManager, this$static, oldTime, newTime);
  return oldTime;
}

function $setVersion(this$static, newVersion){
  var oldVersion;
  if (neq(this$static.version, newVersion)) {
    oldVersion = this$static.version;
    this$static.version = newVersion;
    $onVersionChanged(this$static.listenerManager, this$static, oldVersion, newVersion);
    return oldVersion;
  }
   else {
    return this$static.version;
  }
}

function insert_1(collection, position, element){
  var i, iterator, remainder, old, outerIter, entry, entry_0, old_0;
  checkPositionIndex(position, collection.map.size_1());
  if (position == collection.map.size_1()) {
    old = collection.map.put(element, collection);
    return;
  }
  iterator = (outerIter = $keySet_0(collection.map).val$entrySet.iterator_0() , new AbstractMap$1$1_0(outerIter));
  for (i = 0; i < position; ++i) {
    entry = dynamicCast(iterator.val$outerIter.next_0(), 11);
    entry.getKey();
  }
  remainder = new ArrayList_2(collection.map.size_1() - position);
  while (iterator.val$outerIter.hasNext()) {
    $add_9(remainder, (entry_0 = dynamicCast(iterator.val$outerIter.next_0(), 11) , entry_0.getKey()));
    iterator.val$outerIter.remove_1();
  }
  checkState_3(collection.map.size_1() == position, initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [valueOf_13(collection.map.size_1()), valueOf_13(position)]));
  old_0 = collection.map.put(element, collection);
  $addAll(collection, remainder);
}

function AbstractWaveletData(){
}

_ = AbstractWaveletData.prototype = new Object_0;
_.addListener = function addListener_20(listener){
  $add_31(this.listenerManager.listeners, dynamicCast(listener, 474));
}
;
_.getClass$ = function getClass_1544(){
  return Lorg_waveprotocol_wave_model_wave_data_impl_AbstractWaveletData_2_classLit;
}
;
_.removeListener = function removeListener_20(listener){
  $remove_42(this.listenerManager.listeners, dynamicCast(listener, 474));
}
;
_.toString$ = function toString_157(){
  var b, docId, docId$iterator;
  b = new StringBuilder_2('WaveletDataImpl: ' + this.waveId + '/' + this.id_0 + ' \n[version:' + toString_14(this.version) + '] \n[creator: ' + this.creator + '] \n[participants: ' + ($clinit_480() , new Collections$UnmodifiableSet_0(this.participants)) + '] \n[creation time: ' + toString_14(this.creationTime) + '] \n[lastModifiedTime:' + toString_14(this.lastModifiedTime) + ']');
  b.impl.string += '\n[documents:';
  for (docId$iterator = this.getDocumentIds().iterator_0(); docId$iterator.hasNext();) {
    docId = dynamicCast(docId$iterator.next_0(), 1);
    $append_11(b, ' \n  [' + docId + ': ' + dynamicCast(this.documents.get(docId), 473) + ']');
  }
  b.impl.string += ' \n]';
  return b.impl.string;
}
;
_.castableTypeMap$ = {172:1};
_.contentFactory = null;
_.creationTime = P0_longLit;
_.creator = null;
_.hashedVersion = null;
_.id_0 = null;
_.lastModifiedTime = P0_longLit;
_.version = P0_longLit;
_.waveId = null;
function $addContributor(this$static, participant){
  $add_13(this$static.contributors, participant) && $onBlipDataContributorAdded(this$static.wavelet.listenerManager, this$static.wavelet, this$static, participant);
}

function $removeContributor(this$static, participant){
  var removed;
  removed = $removeAll(this$static.contributors, new Arrays$ArrayList_0(initValues(_3Lorg_waveprotocol_wave_model_wave_ParticipantId_2_classLit, {9:1, 68:1}, 164, [participant])));
  removed && $onBlipDataContributorRemoved(this$static.wavelet.listenerManager, this$static.wavelet, this$static, participant);
}

function BlipDataImpl_0(id, wavelet, author, contributors, content_0, lastModifiedTime, lastModifiedVersion){
  this.content_0 = content_0;
  this.id_0 = id;
  this.wavelet = wavelet;
  this.author = author;
  this.lastModifiedTime = lastModifiedTime;
  this.lastModifiedVersion = lastModifiedVersion;
  this.contributors = new LinkedHashSet_1(contributors);
}

function BlipDataImpl(){
}

_ = BlipDataImpl_0.prototype = BlipDataImpl.prototype = new AbstractBlipData;
_.getClass$ = function getClass_1545(){
  return Lorg_waveprotocol_wave_model_wave_data_impl_BlipDataImpl_2_classLit;
}
;
_.castableTypeMap$ = {473:1};
_.contributors = null;
function $create_4(this$static, waveletId, docId, content_0){
  return new ObservablePluggableMutableDocument_0(this$static.val$schemas.getSchemaForId(waveletId, docId), content_0);
}

function ObservablePluggableMutableDocument$1_0(val$schemas){
  this.val$schemas = val$schemas;
}

function ObservablePluggableMutableDocument$1(){
}

_ = ObservablePluggableMutableDocument$1_0.prototype = ObservablePluggableMutableDocument$1.prototype = new Object_0;
_.create_1 = function create_69(waveletId, docId, content_0){
  return new ObservablePluggableMutableDocument_0(this.val$schemas.getSchemaForId(waveletId, docId), content_0);
}
;
_.getClass$ = function getClass_1547(){
  return Lorg_waveprotocol_wave_model_wave_data_impl_ObservablePluggableMutableDocument$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.val$schemas = null;
function $onDocumentEvents(this$static, event_0){
  var handler, handler$iterator;
  if (this$static.isPaused) {
    return;
  }
  for (handler$iterator = $iterator_20(this$static.handlers); handler$iterator.hasNext();) {
    handler = dynamicCast(handler$iterator.next_0(), 475);
    handler.onDocumentEvents(event_0);
  }
}

function ObservablePluggableMutableDocument$DocumentHandlerManager_0(){
  this.handlers = ($clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
}

function ObservablePluggableMutableDocument$DocumentHandlerManager(){
}

_ = ObservablePluggableMutableDocument$DocumentHandlerManager_0.prototype = ObservablePluggableMutableDocument$DocumentHandlerManager.prototype = new Object_0;
_.getClass$ = function getClass_1548(){
  return Lorg_waveprotocol_wave_model_wave_data_impl_ObservablePluggableMutableDocument$DocumentHandlerManager_2_classLit;
}
;
_.onDocumentEvents = function onDocumentEvents_0(event_0){
  $onDocumentEvents(this, event_0);
}
;
_.castableTypeMap$ = {475:1};
_.isPaused = false;
function $consume_22(this$static, op){
  checkState_2(!!this$static.this$0.outputSink, 'Output sink not yet initialized');
  $consume_24(this$static.this$0.outputSink.this$0, op);
}

function PluggableMutableDocument$2_0(this$0){
  this.this$0 = this$0;
}

function PluggableMutableDocument$2(){
}

_ = PluggableMutableDocument$2_0.prototype = PluggableMutableDocument$2.prototype = new Object_0;
_.consume = function consume_16(op){
  $consume_22(this, dynamicCast(op, 207));
}
;
_.getClass$ = function getClass_1549(){
  return Lorg_waveprotocol_wave_model_wave_data_impl_PluggableMutableDocument$2_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $consume_23(this$static, op){
  var $e0, docOp, e;
  try {
    docOp = $consumeAndReturnInvertible(this$static.sink, op, performValidation);
    !!this$static.outputSink && this$static.outputSink.consume(docOp);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 189)) {
      e = $e0;
      throw new OperationRuntimeException_0('DocumentOperationSink constructed by DocumentOperationSinkFactory generated an OperationException when attempting to apply ' + op, e);
    }
     else 
      throw $e0;
  }
}

function PluggableMutableDocument$BasicSequencer_0(sink, outputSink){
  this.sink = sink;
  this.outputSink = outputSink;
}

function PluggableMutableDocument$BasicSequencer(){
}

_ = PluggableMutableDocument$BasicSequencer_0.prototype = PluggableMutableDocument$BasicSequencer.prototype = new Object_0;
_.begin = function begin_10(){
}
;
_.consume_0 = function consume_17(op){
  $consume_23(this, op);
}
;
_.end_0 = function end_8(){
}
;
_.getClass$ = function getClass_1550(){
  return Lorg_waveprotocol_wave_model_wave_data_impl_PluggableMutableDocument$BasicSequencer_2_classLit;
}
;
_.castableTypeMap$ = {};
_.outputSink = null;
_.sink = null;
function $createDocument_0(this$static){
  return $build_3(($clinit_2112() , this$static.content_0), this$static.schema, this$static.handlerManager);
}

function PluggableMutableDocument$DocumentCreationContext_0(content_0, schema, handlerManager){
  this.content_0 = content_0;
  this.schema = schema;
  this.handlerManager = handlerManager;
}

function PluggableMutableDocument$DocumentCreationContext(){
}

_ = PluggableMutableDocument$DocumentCreationContext_0.prototype = PluggableMutableDocument$DocumentCreationContext.prototype = new Object_0;
_.getClass$ = function getClass_1551(){
  return Lorg_waveprotocol_wave_model_wave_data_impl_PluggableMutableDocument$DocumentCreationContext_2_classLit;
}
;
_.castableTypeMap$ = {};
_.content_0 = null;
_.handlerManager = null;
_.schema = null;
function $$init_266(this$static){
  this$static.participants = new LinkedHashSet_0;
  this$static.documents = ($clinit_2309() , new HashMap_0);
}

function $internalCreateDocument(this$static, docId, author, contributors, contentSink, lastModifiedTime, lastModifiedVersion){
  var blip;
  checkArgument_3(!this$static.documents.containsKey(docId), 'Duplicate doc id: %s', initValues(_3Ljava_lang_Object_2_classLit, {9:1, 68:1}, 0, [docId]));
  blip = new BlipDataImpl_0(docId, this$static, author, contributors, contentSink, lastModifiedTime, lastModifiedVersion);
  this$static.documents.put(docId, blip);
  return blip;
}

function WaveletDataImpl_0(id, creator, creationTime, distinctVersion, lastModifiedTime, waveId, contentFactory){
  this.listenerManager = new WaveletDataListenerManager_0;
  checkNotNull_1(id, 'id cannot be null');
  checkNotNull_1(waveId, 'wave id cannot be null');
  this.id_0 = id;
  this.creator = creator;
  this.creationTime = creationTime;
  this.version = P0_longLit;
  this.hashedVersion = distinctVersion;
  this.lastModifiedTime = lastModifiedTime;
  this.waveId = waveId;
  this.contentFactory = contentFactory;
  $$init_266(this);
}

function WaveletDataImpl(){
}

_ = WaveletDataImpl_0.prototype = WaveletDataImpl.prototype = new AbstractWaveletData;
_.getClass$ = function getClass_1553(){
  return Lorg_waveprotocol_wave_model_wave_data_impl_WaveletDataImpl_2_classLit;
}
;
_.getDocumentIds = function getDocumentIds_0(){
  return $clinit_480() , new Collections$UnmodifiableSet_0($keySet_0(this.documents));
}
;
_.castableTypeMap$ = {172:1};
function $onBlipDataAdded(this$static, waveletData, blip){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 474);
    l_0.onBlipDataAdded(waveletData, blip);
  }
}

function $onBlipDataContributorAdded(this$static, waveletData, blip, contributor){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 474);
    l_0.onBlipDataContributorAdded(waveletData, blip, contributor);
  }
}

function $onBlipDataContributorRemoved(this$static, waveletData, blip, contributor){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 474);
    l_0.onBlipDataContributorRemoved(waveletData, blip, contributor);
  }
}

function $onBlipDataTimestampModified(this$static, waveletData, blip, oldTime, newTime){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 474);
    l_0.onBlipDataTimestampModified(waveletData, blip, oldTime, newTime);
  }
}

function $onBlipDataVersionModified(this$static, waveletData, blip, oldVersion, newVersion){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 474);
    l_0.onBlipDataVersionModified(waveletData, blip, oldVersion, newVersion);
  }
}

function $onHashedVersionChanged(this$static, waveletData, oldHashedVersion, newHashedVersion){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 474);
    l_0.onHashedVersionChanged_0(waveletData, oldHashedVersion, newHashedVersion);
  }
}

function $onLastModifiedTimeChanged(this$static, waveletData, oldTime, newTime){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 474);
    l_0.onLastModifiedTimeChanged_0(waveletData, oldTime, newTime);
  }
}

function $onParticipantAdded_0(this$static, waveletData, participant){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 474);
    l_0.onParticipantAdded_1(waveletData, participant);
  }
}

function $onRemoteBlipDataContentModified(this$static, waveletData, blip){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 474);
    l_0.onRemoteBlipDataContentModified(waveletData, blip);
  }
}

function $onVersionChanged(this$static, waveletData, oldVersion, newVersion){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this$static.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 474);
    l_0.onVersionChanged_0(waveletData, oldVersion, newVersion);
  }
}

function WaveletDataListenerManager_0(){
  this.listeners = ($clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
}

function WaveletDataListenerManager(){
}

_ = WaveletDataListenerManager_0.prototype = WaveletDataListenerManager.prototype = new Object_0;
_.getClass$ = function getClass_1555(){
  return Lorg_waveprotocol_wave_model_wave_data_impl_WaveletDataListenerManager_2_classLit;
}
;
_.onBlipDataAdded = function onBlipDataAdded(waveletData, blip){
  $onBlipDataAdded(this, waveletData, blip);
}
;
_.onBlipDataContributorAdded = function onBlipDataContributorAdded(waveletData, blip, contributor){
  $onBlipDataContributorAdded(this, waveletData, blip, contributor);
}
;
_.onBlipDataContributorRemoved = function onBlipDataContributorRemoved(waveletData, blip, contributor){
  $onBlipDataContributorRemoved(this, waveletData, blip, contributor);
}
;
_.onBlipDataTimestampModified = function onBlipDataTimestampModified(waveletData, blip, oldTime, newTime){
  $onBlipDataTimestampModified(this, waveletData, blip, oldTime, newTime);
}
;
_.onBlipDataVersionModified = function onBlipDataVersionModified(waveletData, blip, oldVersion, newVersion){
  $onBlipDataVersionModified(this, waveletData, blip, oldVersion, newVersion);
}
;
_.onHashedVersionChanged_0 = function onHashedVersionChanged_0(waveletData, oldHashedVersion, newHashedVersion){
  $onHashedVersionChanged(this, waveletData, oldHashedVersion, newHashedVersion);
}
;
_.onLastModifiedTimeChanged_0 = function onLastModifiedTimeChanged_0(waveletData, oldTime, newTime){
  $onLastModifiedTimeChanged(this, waveletData, oldTime, newTime);
}
;
_.onParticipantAdded_1 = function onParticipantAdded_5(waveletData, participant){
  $onParticipantAdded_0(this, waveletData, participant);
}
;
_.onRemoteBlipDataContentModified = function onRemoteBlipDataContentModified(waveletData, blip){
  $onRemoteBlipDataContentModified(this, waveletData, blip);
}
;
_.onVersionChanged_0 = function onVersionChanged_1(waveletData, oldVersion, newVersion){
  $onVersionChanged(this, waveletData, oldVersion, newVersion);
}
;
_.castableTypeMap$ = {474:1};
function $consume_24(this$static, op){
  var blipOp;
  blipOp = new BlipContentOperation_0($createContext(this$static.wavelet.contextFactory), op);
  $update_2(blipOp, this$static.blip);
  $consume_27(this$static.outputSink, new WaveletBlipOperation_0(this$static.blip.id_0, blipOp));
}

function OpBasedBlip_0(blip, wavelet, outputSink){
  this.blip = blip;
  this.wavelet = wavelet;
  this.outputSink = outputSink;
  blip.content_0.init(new OpBasedBlip$1_0(this));
}

function OpBasedBlip(){
}

_ = OpBasedBlip_0.prototype = OpBasedBlip.prototype = new Object_0;
_.equals$ = function equals_71(obj){
  return this === obj || obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[476] && $equals_3(this.blip.id_0, dynamicCast(dynamicCast(obj, 476), 477).blip.id_0);
}
;
_.getClass$ = function getClass_1556(){
  return Lorg_waveprotocol_wave_model_wave_opbased_OpBasedBlip_2_classLit;
}
;
_.hashCode$ = function hashCode_70(){
  return 37 + getHashCode_0(this.blip.id_0);
}
;
_.toString$ = function toString_158(){
  return 'OpBasedBlip { ' + this.blip + ' }';
}
;
_.castableTypeMap$ = {476:1, 477:1};
_.blip = null;
_.outputSink = null;
_.wavelet = null;
function OpBasedBlip$1_0(this$0){
  this.this$0 = this$0;
}

function OpBasedBlip$1(){
}

_ = OpBasedBlip$1_0.prototype = OpBasedBlip$1.prototype = new Object_0;
_.consume = function consume_18(op){
  $consume_24(this.this$0, dynamicCast(op, 207));
}
;
_.getClass$ = function getClass_1557(){
  return Lorg_waveprotocol_wave_model_wave_opbased_OpBasedBlip$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function $adapt_2(this$static, blip){
  var oblip;
  if (!blip) {
    return null;
  }
  oblip = dynamicCast(this$static.blips.get(blip.id_0), 477);
  if (!oblip) {
    oblip = new OpBasedBlip_0(blip, this$static, this$static.fromBlip);
    this$static.blips.put(blip.id_0, oblip);
  }
  return oblip;
}

function $addParticipant_2(this$static, participant){
  var addOp, injectedOp;
  if (!($clinit_480() , new Collections$UnmodifiableSet_0(this$static.wavelet.participants)).contains(participant)) {
    addOp = new AddParticipant_0($createContext(this$static.contextFactory), participant);
    injectedOp = $authorise(this$static, addOp);
    $equals_14(addOp, injectedOp) || (this$static.executor.consume(addOp) , this$static.output.consume(addOp));
  }
}

function $authorise(this$static, op){
  var author, authorisation, authoriser, participantIds;
  author = op.context.creator;
  participantIds = ($clinit_480() , new Collections$UnmodifiableSet_0(new Collections$UnmodifiableSet_0(this$static.wavelet.participants)));
  if (participantIds.contains(author))
  ;
  else if (participantIds.coll.isEmpty())
  ;
  else {
    authoriser = this$static.participationHelper.getAuthoriser(author, participantIds);
    if (authoriser) {
      authorisation = new AddParticipant_0($createContext_0(this$static.contextFactory, authoriser), author);
      this$static.executor.consume(authorisation);
      this$static.output.consume(authorisation);
      return authorisation;
    }
  }
  return null;
}

function $createBlip_0(this$static, id){
  var context, newBlip;
  context = $createContext(this$static.contextFactory);
  newBlip = $createDocument(this$static.wavelet, id, context.creator, singleton_1(context.creator), ($clinit_2119() , EMPTY_DOCUMENT_0), N1_longLit, N1_longLit);
  return $adapt_2(this$static, newBlip);
}

function $getBlip_4(this$static, blipId){
  var blipData;
  blipData = dynamicCast(this$static.wavelet.documents.get(blipId), 473);
  return blipData?$adapt_2(this$static, blipData):null;
}

function $getDocument_5(this$static, docId){
  var blip, doc, blipData_0;
  blip = (blipData_0 = dynamicCast(this$static.wavelet.documents.get(docId), 473) , blipData_0?$adapt_2(this$static, blipData_0):null);
  !blip && (blip = $createBlip_0(this$static, docId));
  doc = blip.blip.content_0.getMutableDocument();
  doc != null && doc.castableTypeMap$ && !!doc.castableTypeMap$[478] || illegalArgument('Document "' + docId + '" is not observable');
  return dynamicCast(doc, 478);
}

function OpBasedWavelet_0(waveId, wavelet, contextFactory, participationHelper, executor, output){
  this.blips = new HashMap_0;
  this.fromBlip = new OpBasedWavelet$1_0(this);
  this.listeners = ($clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
  this.eventForwarder = new OpBasedWavelet$2_0(this);
  this.waveId = waveId;
  this.wavelet = wavelet;
  this.contextFactory = contextFactory;
  this.participationHelper = participationHelper;
  this.executor = executor;
  this.output = output;
  $add_31(wavelet.listenerManager.listeners, this.eventForwarder);
}

function OpBasedWavelet(){
}

_ = OpBasedWavelet_0.prototype = OpBasedWavelet.prototype = new Object_0;
_.addListener = function addListener_21(listener){
  $add_31(this.listeners, dynamicCast(listener, 480));
}
;
_.equals$ = function equals_72(obj){
  return this === obj || obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[479] && $equals_13(this.wavelet.id_0, dynamicCast(obj, 479).wavelet.id_0);
}
;
_.getClass$ = function getClass_1558(){
  return Lorg_waveprotocol_wave_model_wave_opbased_OpBasedWavelet_2_classLit;
}
;
_.hashCode$ = function hashCode_71(){
  return 37 + $hashCode_11(this.wavelet.id_0);
}
;
_.removeListener = function removeListener_21(listener){
  $remove_42(this.listeners, dynamicCast(listener, 480));
}
;
_.toString$ = function toString_159(){
  return 'OpBasedWavelet { ' + this.wavelet + ' }';
}
;
_.castableTypeMap$ = {262:1, 479:1};
_.contextFactory = null;
_.executor = null;
_.output = null;
_.participationHelper = null;
_.waveId = null;
_.wavelet = null;
function $consume_27(this$static, op){
  $authorise(this$static.this$0, op);
  $update_0(op, this$static.this$0.wavelet);
  this$static.this$0.output.consume(op);
}

function OpBasedWavelet$1_0(this$0){
  this.this$0 = this$0;
}

function OpBasedWavelet$1(){
}

_ = OpBasedWavelet$1_0.prototype = OpBasedWavelet$1.prototype = new Object_0;
_.consume = function consume_19(op){
  $consume_27(this, dynamicCast(op, 452));
}
;
_.getClass$ = function getClass_1559(){
  return Lorg_waveprotocol_wave_model_wave_opbased_OpBasedWavelet$1_2_classLit;
}
;
_.castableTypeMap$ = {};
_.this$0 = null;
function OpBasedWavelet$2_0(this$0){
  this.this$0 = this$0;
}

function OpBasedWavelet$2(){
}

_ = OpBasedWavelet$2_0.prototype = OpBasedWavelet$2.prototype = new Object_0;
_.getClass$ = function getClass_1560(){
  return Lorg_waveprotocol_wave_model_wave_opbased_OpBasedWavelet$2_2_classLit;
}
;
_.onBlipDataAdded = function onBlipDataAdded_0(waveletData, blip){
  var l_0, l$iterator, oblip;
  oblip = $adapt_2(this.this$0, blip);
  for (l$iterator = $iterator_20(this.this$0.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 480);
    l_0.onBlipAdded_0(this.this$0, oblip);
  }
}
;
_.onBlipDataContributorAdded = function onBlipDataContributorAdded_0(waveletData, blip, contributorId){
  var l_0, l$iterator, oblip;
  oblip = $adapt_2(this.this$0, blip);
  for (l$iterator = $iterator_20(this.this$0.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 480);
    l_0.onBlipContributorAdded_0(this.this$0, oblip, contributorId);
  }
}
;
_.onBlipDataContributorRemoved = function onBlipDataContributorRemoved_0(waveletData, blip, contributorId){
  var l_0, l$iterator, oblip;
  oblip = $adapt_2(this.this$0, blip);
  for (l$iterator = $iterator_20(this.this$0.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 480);
    l_0.onBlipContributorRemoved_0(this.this$0, oblip, contributorId);
  }
}
;
_.onBlipDataTimestampModified = function onBlipDataTimestampModified_0(waveletData, b, oldTime, newTime){
  var l_0, l$iterator, oblip;
  oblip = $adapt_2(this.this$0, b);
  for (l$iterator = $iterator_20(this.this$0.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 480);
    l_0.onBlipTimestampModified(this.this$0, oblip, oldTime, newTime);
  }
}
;
_.onBlipDataVersionModified = function onBlipDataVersionModified_0(waveletData, b, oldVersion, newVersion){
  var l_0, l$iterator, oblip;
  oblip = $adapt_2(this.this$0, b);
  for (l$iterator = $iterator_20(this.this$0.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 480);
    l_0.onBlipVersionModified(this.this$0, oblip, valueOf_14(oldVersion), valueOf_14(newVersion));
  }
}
;
_.onHashedVersionChanged_0 = function onHashedVersionChanged_1(waveletData, oldHashedVersion, newHashedVersion){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this.this$0.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 480);
    l_0.onHashedVersionChanged(this.this$0, oldHashedVersion, newHashedVersion);
  }
}
;
_.onLastModifiedTimeChanged_0 = function onLastModifiedTimeChanged_1(waveletData, oldTime, newTime){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this.this$0.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 480);
    l_0.onLastModifiedTimeChanged(this.this$0, oldTime, newTime);
  }
}
;
_.onParticipantAdded_1 = function onParticipantAdded_6(wavelet, participantId){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this.this$0.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 480);
    l_0.onParticipantAdded_0(this.this$0, participantId);
  }
}
;
_.onRemoteBlipDataContentModified = function onRemoteBlipDataContentModified_0(waveletData, blip){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this.this$0.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 480);
    l_0.onRemoteBlipContentModified(this.this$0, $adapt_2(this.this$0, blip));
  }
}
;
_.onVersionChanged_0 = function onVersionChanged_2(wavelet, oldVersion, newVersion){
  var l_0, l$iterator;
  for (l$iterator = $iterator_20(this.this$0.listeners); l$iterator.hasNext();) {
    l_0 = dynamicCast(l$iterator.next_0(), 480);
    l_0.onVersionChanged(this.this$0, oldVersion, newVersion);
  }
}
;
_.castableTypeMap$ = {474:1};
_.this$0 = null;
function $addWavelet_0(this$static, wavelet){
  checkArgument_2(!this$static.wavelets.containsKey(wavelet.wavelet.id_0), 'Added multiple wavelets with same id: ' + wavelet);
  this$static.wavelets.put(wavelet.wavelet.id_0, wavelet);
  $triggerOnWaveletAdded(this$static, wavelet);
}

function $createUserData(this$static){
  return $createWavelet(this$static, this$static.userDataId);
}

function $createWavelet(this$static, id){
  var wavelet;
  wavelet = this$static.factory.create_0(this$static.waveId, id, this$static.viewer);
  $addParticipant_2(wavelet, wavelet.wavelet.creator);
  $addWavelet_0(this$static, wavelet);
  return wavelet;
}

function $getRoot_0(this$static){
  return dynamicCast(this$static.wavelets.get(this$static.rootId), 262);
}

function $getUserData(this$static){
  return dynamicCast(this$static.wavelets.get(this$static.userDataId), 262);
}

function $getWavelet(this$static, waveletId){
  return dynamicCast(this$static.wavelets.get(waveletId), 262);
}

function $triggerOnWaveletAdded(this$static, wavelet){
  var listener, listener$iterator;
  for (listener$iterator = $iterator_20(this$static.listeners); listener$iterator.hasNext();) {
    listener = dynamicCast(listener$iterator.next_0(), 481);
    listener.onWaveletAdded(wavelet);
  }
}

function WaveViewImpl_0(factory, waveId, idGenerator, viewer){
  this.wavelets = new HashMap_0;
  this.listeners = ($clinit_2326() , new CopyOnWriteSet_0(HASH_SET));
  this.waveId = waveId;
  this.factory = factory;
  this.viewer = viewer;
  this.rootId = of_9(idGenerator.defaultDomain, 'conv+root');
  this.userDataId = $newUserDataWaveletId(viewer.address);
}

function WaveViewImpl(){
}

_ = WaveViewImpl_0.prototype = WaveViewImpl.prototype = new Object_0;
_.addListener = function addListener_22(listener){
  $add_31(this.listeners, dynamicCast(listener, 481));
}
;
_.getClass$ = function getClass_1561(){
  return Lorg_waveprotocol_wave_model_wave_opbased_WaveViewImpl_2_classLit;
}
;
_.removeListener = function removeListener_22(listener){
  $remove_42(this.listeners, dynamicCast(listener, 481));
}
;
_.castableTypeMap$ = {};
_.factory = null;
_.rootId = null;
_.userDataId = null;
_.viewer = null;
_.waveId = null;
function $clinit_2432(){
  $clinit_2432 = nullMethod;
  ADD_CREATOR = new WaveViewImpl$WaveletConfigurator$1_0;
  NONE_8 = new WaveViewImpl$WaveletConfigurator$2_0;
  ERROR_0 = new WaveViewImpl$WaveletConfigurator$3_0;
  $VALUES_79 = initValues(_3Lorg_waveprotocol_wave_model_wave_opbased_WaveViewImpl$WaveletConfigurator_2_classLit, {9:1, 68:1, 170:1}, 165, [ADD_CREATOR, NONE_8, ERROR_0]);
}

function valueOf_87(name_0){
  $clinit_2432();
  return valueOf_0(($clinit_2436() , $MAP_79), name_0);
}

function values_80(){
  $clinit_2432();
  return $VALUES_79;
}

function WaveViewImpl$WaveletConfigurator(){
}

_ = WaveViewImpl$WaveletConfigurator.prototype = new Enum;
_.getClass$ = function getClass_1562(){
  return Lorg_waveprotocol_wave_model_wave_opbased_WaveViewImpl$WaveletConfigurator_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 165:1};
var $VALUES_79, ADD_CREATOR, ERROR_0, NONE_8;
function WaveViewImpl$WaveletConfigurator$1_0(){
  this.name_1 = 'ADD_CREATOR';
  this.ordinal = 0;
}

function WaveViewImpl$WaveletConfigurator$1(){
}

_ = WaveViewImpl$WaveletConfigurator$1_0.prototype = WaveViewImpl$WaveletConfigurator$1.prototype = new WaveViewImpl$WaveletConfigurator;
_.getClass$ = function getClass_1563(){
  return Lorg_waveprotocol_wave_model_wave_opbased_WaveViewImpl$WaveletConfigurator$1_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 165:1};
function WaveViewImpl$WaveletConfigurator$2_0(){
  this.name_1 = 'NONE';
  this.ordinal = 1;
}

function WaveViewImpl$WaveletConfigurator$2(){
}

_ = WaveViewImpl$WaveletConfigurator$2_0.prototype = WaveViewImpl$WaveletConfigurator$2.prototype = new WaveViewImpl$WaveletConfigurator;
_.getClass$ = function getClass_1564(){
  return Lorg_waveprotocol_wave_model_wave_opbased_WaveViewImpl$WaveletConfigurator$2_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 165:1};
function WaveViewImpl$WaveletConfigurator$3_0(){
  this.name_1 = 'ERROR';
  this.ordinal = 2;
}

function WaveViewImpl$WaveletConfigurator$3(){
}

_ = WaveViewImpl$WaveletConfigurator$3_0.prototype = WaveViewImpl$WaveletConfigurator$3.prototype = new WaveViewImpl$WaveletConfigurator;
_.getClass$ = function getClass_1565(){
  return Lorg_waveprotocol_wave_model_wave_opbased_WaveViewImpl$WaveletConfigurator$3_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 165:1};
function $clinit_2436(){
  $clinit_2436 = nullMethod;
  $MAP_79 = createValueOfMap(($clinit_2432() , $VALUES_79));
}

var $MAP_79;
function InvalidWaveRefException_0(ref, message){
  this.fillInStackTrace();
  this.detailMessage = message;
  this.ref = ref;
}

function InvalidWaveRefException_1(ref, message, cause){
  this.fillInStackTrace();
  this.cause = cause;
  this.detailMessage = message;
  this.ref = ref;
}

function InvalidWaveRefException(){
}

_ = InvalidWaveRefException_1.prototype = InvalidWaveRefException_0.prototype = InvalidWaveRefException.prototype = new Exception;
_.getClass$ = function getClass_1566(){
  return Lorg_waveprotocol_wave_model_waveref_InvalidWaveRefException_2_classLit;
}
;
_.getMessage = function getMessage_3(){
  return "Invalid waveRef '" + this.ref + "': " + this.detailMessage;
}
;
_.castableTypeMap$ = {9:1, 39:1, 183:1, 193:1};
_.ref = null;
function WaveRef_0(waveId, wavelet, documentId){
  checkNotNull_1(waveId, 'Waveref must have non-null wave-id');
  this.waveId = waveId;
  this.waveletId = wavelet;
  wavelet?(this.documentId = documentId):(this.documentId = null);
}

function of_11(waveId){
  checkNotNull_1(waveId, 'Null wave Id');
  return new WaveRef_0(waveId, null, null);
}

function of_13(waveId, waveletId, documentId){
  checkNotNull_1(waveId, 'Null wave Id');
  checkNotNull_1(waveletId, 'Null wavelet Id');
  checkNotNull_1(documentId, 'Null blip Id');
  return new WaveRef_0(waveId, waveletId, documentId);
}

function WaveRef(){
}

_ = WaveRef_0.prototype = WaveRef.prototype = new Object_0;
_.equals$ = function equals_73(obj){
  var other;
  if (this === obj) {
    return true;
  }
  if (!(obj != null && obj.castableTypeMap$ && !!obj.castableTypeMap$[482])) {
    return false;
  }
  other = dynamicCast(obj, 482);
  return equal_0(this.waveId, other.waveId) && equal_0(this.waveletId, other.waveletId) && equal_0(this.documentId, other.documentId);
}
;
_.getClass$ = function getClass_1567(){
  return Lorg_waveprotocol_wave_model_waveref_WaveRef_2_classLit;
}
;
_.hashCode$ = function hashCode_72(){
  var result;
  result = 31 + $hashCode_10(this.waveId);
  !!this.waveletId && (result = 31 * result + $hashCode_11(this.waveletId));
  this.documentId != null && (result = 31 * result + getHashCode_0(this.documentId));
  return result;
}
;
_.toString$ = function toString_160(){
  var result;
  result = new StringBuilder_2('[WaveRef:');
  !!this.waveId && $append_11(result, '[WaveId ' + $serialiseWaveId(this.waveId) + ']');
  !!this.waveletId && $append_11(result, '[WaveletId ' + $serialiseWaveletId(this.waveletId) + ']');
  if (this.documentId != null) {
    result.impl.string += '[documentId:';
    $append_11(result, this.documentId);
    result.impl.string += ']';
  }
  return (result.impl.string += ']' , result).impl.string;
}
;
_.castableTypeMap$ = {482:1};
_.documentId = null;
_.waveId = null;
_.waveletId = null;
function $decode_0(string){
  var $e0, e;
  try {
    return throwIfNull('encodedURL', string) , decodeURI(string);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 444)) {
      e = $e0;
      throw new InvalidWaveRefException_1(string, 'Failed to decode', e);
    }
     else 
      throw $e0;
  }
}

function $decodeWaveRefFromPath(path){
  var $e0, documentId, e, tokens, waveDomain, waveId, waveIdStr, waveletDomain, waveletId, waveletIdStr;
  tokens = $split(path, '/', 0);
  if (tokens.length < 2 || tokens.length == 3) {
    throw new InvalidWaveRefException_0(path, 'Invalid number of tokens in path given to decodeWaveRefFromPath');
  }
  if (tokens[0].length == 0 || tokens[1].length == 0) {
    throw new InvalidWaveRefException_0(path, 'The wave domain and thewave Id must not be empty.');
  }
  waveDomain = $decode_0(tokens[0].toLowerCase());
  waveIdStr = $decode_0(tokens[1]);
  try {
    waveId = of_8(waveDomain, waveIdStr);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 444)) {
      e = $e0;
      throw new InvalidWaveRefException_0(path, 'Invalid WaveID:' + e.detailMessage);
    }
     else 
      throw $e0;
  }
  if (tokens.length == 2) {
    return checkNotNull_1(waveId, 'Null wave Id') , new WaveRef_0(waveId, null, null);
  }
  if (tokens[2].length == 0 || tokens[3].length == 0) {
    throw new InvalidWaveRefException_0(path, 'The wavelet domain and thewavelet Id must not be empty.');
  }
  waveletDomain = $decode_0(tokens[2]);
  $equals_3(waveletDomain, '~') && (waveletDomain = waveDomain);
  waveletIdStr = $decode_0(tokens[3]);
  try {
    waveletId = of_9(waveletDomain, waveletIdStr);
  }
   catch ($e0) {
    $e0 = caught_0($e0);
    if (instanceOf($e0, 444)) {
      e = $e0;
      throw new InvalidWaveRefException_1(path, 'Invalid WaveletID', e);
    }
     else 
      throw $e0;
  }
  if (tokens.length == 4) {
    return checkNotNull_1(waveId, 'Null wave Id') , checkNotNull_1(waveletId, 'Null wavelet Id') , new WaveRef_0(waveId, waveletId, null);
  }
   else {
    documentId = tokens[4];
    return checkNotNull_1(waveId, 'Null wave Id') , checkNotNull_1(waveletId, 'Null wavelet Id') , checkNotNull_1(documentId, 'Null blip Id') , new WaveRef_0(waveId, waveletId, documentId);
  }
}

function $encode_0(ref, escaperType){
  var result;
  result = new StringBuilder_2($encode_1(ref.waveId.domain, escaperType));
  $append_11((result.impl.string += '/' , result), $encode_1(ref.waveId.id_0, escaperType));
  if (ref.waveletId) {
    $equals_3(ref.waveletId.domain, ref.waveId.domain)?(result.impl.string += '/~' , result):$append_11((result.impl.string += '/' , result), $encode_1(ref.waveletId.domain, escaperType));
    $append_11((result.impl.string += '/' , result), $encode_1(ref.waveletId.id_0, escaperType));
  }
  ref.documentId != null && $append_11((result.impl.string += '/' , result), $encode_1(ref.documentId, escaperType));
  return result.impl.string;
}

function $encode_1(str, escaperType){
  return escaperType == ($clinit_2441() , PATH)?$escape_0(($clinit_2443() , pathEscaper), str):$escape_0(($clinit_2443() , queryEscaper), str);
}

function $clinit_2441(){
  $clinit_2441 = nullMethod;
  PATH = new WaverefEncoder$EscaperType_0('PATH', 0);
  QUERY = new WaverefEncoder$EscaperType_0('QUERY', 1);
  $VALUES_80 = initValues(_3Lorg_waveprotocol_wave_model_waveref_WaverefEncoder$EscaperType_2_classLit, {9:1, 68:1, 170:1}, 166, [PATH, QUERY]);
}

function WaverefEncoder$EscaperType_0(enum$name, enum$ordinal){
  this.name_1 = enum$name;
  this.ordinal = enum$ordinal;
}

function valueOf_88(name_0){
  $clinit_2441();
  return valueOf_0(($clinit_2442() , $MAP_80), name_0);
}

function values_81(){
  $clinit_2441();
  return $VALUES_80;
}

function WaverefEncoder$EscaperType(){
}

_ = WaverefEncoder$EscaperType_0.prototype = WaverefEncoder$EscaperType.prototype = new Enum;
_.getClass$ = function getClass_1568(){
  return Lorg_waveprotocol_wave_model_waveref_WaverefEncoder$EscaperType_2_classLit;
}
;
_.castableTypeMap$ = {9:1, 10:1, 65:1, 166:1};
var $VALUES_80, PATH, QUERY;
function $clinit_2442(){
  $clinit_2442 = nullMethod;
  $MAP_80 = createValueOfMap(($clinit_2441() , $VALUES_80));
}

var $MAP_80;
function $clinit_2443(){
  $clinit_2443 = nullMethod;
  pathEscaper = new PercentEscaper_0("-_.!~*'()@:$&,;=+");
  queryEscaper = new PercentEscaper_0("-_.!~*'()@:$,;/?:+");
}

var pathEscaper, queryEscaper;
function $escapeSlow(this$static, s, index){
  var charsSkipped, cp, dest, destIndex, destLength, end, endIndex, escaped, nextIndex, sizeNeeded, unescapedChunkStart, copy, copy_0;
  end = s.length;
  dest = initDim(_3C_classLit, {9:1}, -1, 1024, 1);
  destIndex = 0;
  unescapedChunkStart = 0;
  while (index < end) {
    cp = codePointAt_0(s, index, end);
    if (cp < 0) {
      throw new IllegalArgumentException_1('Trailing high surrogate at end of input');
    }
    escaped = $escape_1(this$static, cp);
    nextIndex = index + (cp >= 65536 && cp <= 1114111?2:1);
    if (escaped != null) {
      charsSkipped = index - unescapedChunkStart;
      sizeNeeded = destIndex + charsSkipped + escaped.length;
      if (dest.length < sizeNeeded) {
        destLength = sizeNeeded + (end - index) + 32;
        dest = (copy = initDim(_3C_classLit, {9:1}, -1, destLength, 1) , destIndex > 0 && arraycopy(dest, 0, copy, 0, destIndex) , copy);
      }
      if (charsSkipped > 0) {
        $getChars(s, unescapedChunkStart, index, dest, destIndex);
        destIndex += charsSkipped;
      }
      if (escaped.length > 0) {
        arraycopy(escaped, 0, dest, destIndex, escaped.length);
        destIndex += escaped.length;
      }
      unescapedChunkStart = nextIndex;
    }
    index = $nextEscapeIndex(this$static, s, nextIndex, end);
  }
  charsSkipped = end - unescapedChunkStart;
  if (charsSkipped > 0) {
    endIndex = destIndex + charsSkipped;
    dest.length < endIndex && (dest = (copy_0 = initDim(_3C_classLit, {9:1}, -1, endIndex, 1) , destIndex > 0 && arraycopy(dest, 0, copy_0, 0, destIndex) , copy_0));
    $getChars(s, unescapedChunkStart, end, dest, destIndex);
    destIndex = endIndex;
  }
  return __checkBounds(dest.length, destIndex) , __valueOf(dest, 0, destIndex);
}

function codePointAt_0(seq, index, end){
  var c1, c2;
  if (index < end) {
    c1 = seq.charCodeAt(index++);
    if (c1 < 55296 || c1 > 57343) {
      return c1;
    }
     else if (c1 <= 56319) {
      if (index == end) {
        return -c1;
      }
      c2 = seq.charCodeAt(index);
      if (c2 >= 56320 && c2 <= 57343) {
        return 65536 + ((c1 & 1023) << 10) + (c2 & 1023);
      }
      throw new IllegalArgumentException_1("Expected low surrogate but got char '" + String.fromCharCode(c2) + "' with value " + c2 + ' at index ' + index);
    }
     else {
      throw new IllegalArgumentException_1("Unexpected low surrogate character '" + String.fromCharCode(c1) + "' with value " + c1 + ' at index ' + (index - 1));
    }
  }
  throw new IndexOutOfBoundsException_1('Index exceeds specified range');
}

function UnicodeEscaper(){
}

_ = UnicodeEscaper.prototype = new Object_0;
_.getClass$ = function getClass_1569(){
  return Lorg_waveprotocol_wave_util_escapers_UnicodeEscaper_2_classLit;
}
;
_.castableTypeMap$ = {};
function $clinit_2445(){
  $clinit_2445 = nullMethod;
  URI_ESCAPED_SPACE = initValues(_3C_classLit, {9:1}, -1, [43]);
  UPPER_HEX_DIGITS = $toCharArray('0123456789ABCDEF');
}

function $escape_0(this$static, s){
  var c, index, slen;
  checkNotNull(s);
  slen = s.length;
  for (index = 0; index < slen; ++index) {
    c = s.charCodeAt(index);
    if (c >= this$static.safeOctets.length || !this$static.safeOctets[c]) {
      return $escapeSlow(this$static, s, index);
    }
  }
  return s;
}

function $escape_1(this$static, cp){
  var dest;
  if (cp < this$static.safeOctets.length && this$static.safeOctets[cp]) {
    return null;
  }
   else if (cp == 32 && this$static.plusForSpace) {
    return URI_ESCAPED_SPACE;
  }
   else if (cp <= 127) {
    dest = initDim(_3C_classLit, {9:1}, -1, 3, 1);
    dest[0] = 37;
    dest[2] = UPPER_HEX_DIGITS[cp & 15];
    dest[1] = UPPER_HEX_DIGITS[~~cp >>> 4];
    return dest;
  }
   else if (cp <= 2047) {
    dest = initDim(_3C_classLit, {9:1}, -1, 6, 1);
    dest[0] = 37;
    dest[3] = 37;
    dest[5] = UPPER_HEX_DIGITS[cp & 15];
    cp >>>= 4;
    dest[4] = UPPER_HEX_DIGITS[8 | cp & 3];
    cp >>>= 2;
    dest[2] = UPPER_HEX_DIGITS[cp & 15];
    cp >>>= 4;
    dest[1] = UPPER_HEX_DIGITS[12 | cp];
    return dest;
  }
   else if (cp <= 65535) {
    dest = initDim(_3C_classLit, {9:1}, -1, 9, 1);
    dest[0] = 37;
    dest[1] = 69;
    dest[3] = 37;
    dest[6] = 37;
    dest[8] = UPPER_HEX_DIGITS[cp & 15];
    cp >>>= 4;
    dest[7] = UPPER_HEX_DIGITS[8 | cp & 3];
    cp >>>= 2;
    dest[5] = UPPER_HEX_DIGITS[cp & 15];
    cp >>>= 4;
    dest[4] = UPPER_HEX_DIGITS[8 | cp & 3];
    cp >>>= 2;
    dest[2] = UPPER_HEX_DIGITS[cp];
    return dest;
  }
   else if (cp <= 1114111) {
    dest = initDim(_3C_classLit, {9:1}, -1, 12, 1);
    dest[0] = 37;
    dest[1] = 70;
    dest[3] = 37;
    dest[6] = 37;
    dest[9] = 37;
    dest[11] = UPPER_HEX_DIGITS[cp & 15];
    cp >>>= 4;
    dest[10] = UPPER_HEX_DIGITS[8 | cp & 3];
    cp >>>= 2;
    dest[8] = UPPER_HEX_DIGITS[cp & 15];
    cp >>>= 4;
    dest[7] = UPPER_HEX_DIGITS[8 | cp & 3];
    cp >>>= 2;
    dest[5] = UPPER_HEX_DIGITS[cp & 15];
    cp >>>= 4;
    dest[4] = UPPER_HEX_DIGITS[8 | cp & 3];
    cp >>>= 2;
    dest[2] = UPPER_HEX_DIGITS[cp & 7];
    return dest;
  }
   else {
    throw new IllegalArgumentException_1('Invalid unicode character value ' + cp);
  }
}

function $nextEscapeIndex(this$static, csq, index, end){
  var c;
  for (; index < end; ++index) {
    c = csq.charCodeAt(index);
    if (c >= this$static.safeOctets.length || !this$static.safeOctets[c]) {
      break;
    }
  }
  return index;
}

function PercentEscaper_0(safeChars){
  var matchObj;
  $clinit_2445();
  checkNotNull(safeChars);
  if (matchObj = (new RegExp('.*[0-9A-Za-z].*')).exec(safeChars) , matchObj == null?false:safeChars == matchObj[0]) {
    throw new IllegalArgumentException_1("Alphanumeric characters are always 'safe' and should not be explicitly specified");
  }
  if (safeChars.indexOf('%') != -1) {
    throw new IllegalArgumentException_1("The '%' character cannot be specified as 'safe'");
  }
  this.plusForSpace = false;
  this.safeOctets = createSafeOctets(safeChars);
}

function createSafeOctets(safeChars){
  var c, c$index, c$max, maxChar, octets, safeCharArray;
  maxChar = 122;
  safeCharArray = $toCharArray(safeChars);
  for (c$index = 0 , c$max = safeCharArray.length; c$index < c$max; ++c$index) {
    c = safeCharArray[c$index];
    maxChar = c > maxChar?c:maxChar;
  }
  octets = initDim(_3Z_classLit, {9:1}, -1, maxChar + 1, 2);
  for (c = 48; c <= 57; ++c) {
    octets[c] = true;
  }
  for (c = 65; c <= 90; ++c) {
    octets[c] = true;
  }
  for (c = 97; c <= 122; ++c) {
    octets[c] = true;
  }
  for (c$index = 0 , c$max = safeCharArray.length; c$index < c$max; ++c$index) {
    c = safeCharArray[c$index];
    octets[c] = true;
  }
  return octets;
}

function PercentEscaper(){
}

_ = PercentEscaper_0.prototype = PercentEscaper.prototype = new UnicodeEscaper;
_.getClass$ = function getClass_1570(){
  return Lorg_waveprotocol_wave_util_escapers_PercentEscaper_2_classLit;
}
;
_.castableTypeMap$ = {};
_.plusForSpace = false;
_.safeOctets = null;
var UPPER_HEX_DIGITS, URI_ESCAPED_SPACE;
var Lcom_google_common_base_Joiner_2_classLit = createForClass('com.google.common.base.', 'Joiner'), Lcom_google_gwt_dom_client_Style$Unit_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Unit', Ljava_lang_Enum_2_classLit, values_4, valueOf_5), _3Lcom_google_gwt_dom_client_Style$Unit_2_classLit = createForArray('[Lcom.google.gwt.dom.client.', 'Style$Unit;', Lcom_google_gwt_dom_client_Style$Unit_2_classLit), Lcom_google_gwt_dom_client_Style$Unit$1_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Unit$1', Lcom_google_gwt_dom_client_Style$Unit_2_classLit, null, null), Lcom_google_gwt_dom_client_Style$Unit$2_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Unit$2', Lcom_google_gwt_dom_client_Style$Unit_2_classLit, null, null), Lcom_google_gwt_dom_client_Style$Unit$3_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Unit$3', Lcom_google_gwt_dom_client_Style$Unit_2_classLit, null, null), Lcom_google_gwt_dom_client_Style$Unit$4_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Unit$4', Lcom_google_gwt_dom_client_Style$Unit_2_classLit, null, null), Lcom_google_gwt_dom_client_Style$Unit$5_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Unit$5', Lcom_google_gwt_dom_client_Style$Unit_2_classLit, null, null), Lcom_google_gwt_dom_client_Style$Unit$6_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Unit$6', Lcom_google_gwt_dom_client_Style$Unit_2_classLit, null, null), Lcom_google_gwt_dom_client_Style$Unit$7_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Unit$7', Lcom_google_gwt_dom_client_Style$Unit_2_classLit, null, null), Lcom_google_gwt_dom_client_Style$Unit$8_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Unit$8', Lcom_google_gwt_dom_client_Style$Unit_2_classLit, null, null), Lcom_google_gwt_dom_client_Style$Unit$9_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Unit$9', Lcom_google_gwt_dom_client_Style$Unit_2_classLit, null, null), Lcom_google_gwt_dom_client_Style$FontWeight_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$FontWeight', Ljava_lang_Enum_2_classLit, values_1, valueOf_2), _3Lcom_google_gwt_dom_client_Style$FontWeight_2_classLit = createForArray('[Lcom.google.gwt.dom.client.', 'Style$FontWeight;', Lcom_google_gwt_dom_client_Style$FontWeight_2_classLit), Lcom_google_gwt_dom_client_Style$FontWeight$1_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$FontWeight$1', Lcom_google_gwt_dom_client_Style$FontWeight_2_classLit, null, null), Lcom_google_gwt_dom_client_Style$FontWeight$2_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$FontWeight$2', Lcom_google_gwt_dom_client_Style$FontWeight_2_classLit, null, null), Lcom_google_gwt_dom_client_Style$FontWeight$3_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$FontWeight$3', Lcom_google_gwt_dom_client_Style$FontWeight_2_classLit, null, null), Lcom_google_gwt_dom_client_Style$FontWeight$4_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$FontWeight$4', Lcom_google_gwt_dom_client_Style$FontWeight_2_classLit, null, null), Lcom_google_gwt_dom_client_Style$Overflow_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Overflow', Ljava_lang_Enum_2_classLit, values_2, valueOf_3), _3Lcom_google_gwt_dom_client_Style$Overflow_2_classLit = createForArray('[Lcom.google.gwt.dom.client.', 'Style$Overflow;', Lcom_google_gwt_dom_client_Style$Overflow_2_classLit), Lcom_google_gwt_dom_client_Style$Overflow$1_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Overflow$1', Lcom_google_gwt_dom_client_Style$Overflow_2_classLit, null, null), Lcom_google_gwt_dom_client_Style$Overflow$2_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Overflow$2', Lcom_google_gwt_dom_client_Style$Overflow_2_classLit, null, null), Lcom_google_gwt_dom_client_Style$Overflow$3_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Overflow$3', Lcom_google_gwt_dom_client_Style$Overflow_2_classLit, null, null), Lcom_google_gwt_dom_client_Style$Overflow$4_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Overflow$4', Lcom_google_gwt_dom_client_Style$Overflow_2_classLit, null, null), Lcom_google_gwt_dom_client_Style$Position_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Position', Ljava_lang_Enum_2_classLit, values_3, valueOf_4), _3Lcom_google_gwt_dom_client_Style$Position_2_classLit = createForArray('[Lcom.google.gwt.dom.client.', 'Style$Position;', Lcom_google_gwt_dom_client_Style$Position_2_classLit), Lcom_google_gwt_dom_client_Style$Position$1_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Position$1', Lcom_google_gwt_dom_client_Style$Position_2_classLit, null, null), Lcom_google_gwt_dom_client_Style$Position$2_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Position$2', Lcom_google_gwt_dom_client_Style$Position_2_classLit, null, null), Lcom_google_gwt_dom_client_Style$Position$3_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Position$3', Lcom_google_gwt_dom_client_Style$Position_2_classLit, null, null), Lcom_google_gwt_dom_client_Style$Position$4_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Position$4', Lcom_google_gwt_dom_client_Style$Position_2_classLit, null, null), Lcom_google_gwt_dom_client_Style$Visibility_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Visibility', Ljava_lang_Enum_2_classLit, values_5, valueOf_6), _3Lcom_google_gwt_dom_client_Style$Visibility_2_classLit = createForArray('[Lcom.google.gwt.dom.client.', 'Style$Visibility;', Lcom_google_gwt_dom_client_Style$Visibility_2_classLit), Lcom_google_gwt_dom_client_Style$Visibility$1_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Visibility$1', Lcom_google_gwt_dom_client_Style$Visibility_2_classLit, null, null), Lcom_google_gwt_dom_client_Style$Visibility$2_2_classLit = createForEnum('com.google.gwt.dom.client.', 'Style$Visibility$2', Lcom_google_gwt_dom_client_Style$Visibility_2_classLit, null, null), Lcom_google_gwt_event_dom_client_BlurEvent_2_classLit = createForClass('com.google.gwt.event.dom.client.', 'BlurEvent'), Lcom_google_gwt_event_dom_client_MouseOutEvent_2_classLit = createForClass('com.google.gwt.event.dom.client.', 'MouseOutEvent'), Lcom_google_gwt_event_dom_client_MouseOverEvent_2_classLit = createForClass('com.google.gwt.event.dom.client.', 'MouseOverEvent'), Lcom_google_gwt_event_dom_client_MouseUpEvent_2_classLit = createForClass('com.google.gwt.event.dom.client.', 'MouseUpEvent'), Lcom_google_gwt_event_logical_shared_ResizeEvent_2_classLit = createForClass('com.google.gwt.event.logical.shared.', 'ResizeEvent'), Lcom_google_gwt_event_logical_shared_ValueChangeEvent_2_classLit = createForClass('com.google.gwt.event.logical.shared.', 'ValueChangeEvent'), Lcom_google_gwt_event_shared_SimpleEventBus$3_2_classLit = createForClass('com.google.gwt.event.shared.', 'SimpleEventBus$3'), Lcom_google_gwt_http_client_Request_2_classLit = createForClass('com.google.gwt.http.client.', 'Request'), Lcom_google_gwt_http_client_Response_2_classLit = createForClass('com.google.gwt.http.client.', 'Response'), Lcom_google_gwt_http_client_Request$1_2_classLit = createForClass('com.google.gwt.http.client.', 'Request$1'), Lcom_google_gwt_http_client_Request$3_2_classLit = createForClass('com.google.gwt.http.client.', 'Request$3'), Lcom_google_gwt_http_client_RequestBuilder_2_classLit = createForClass('com.google.gwt.http.client.', 'RequestBuilder'), Lcom_google_gwt_http_client_RequestBuilder$Method_2_classLit = createForClass('com.google.gwt.http.client.', 'RequestBuilder$Method'), Lcom_google_gwt_http_client_RequestBuilder$1_2_classLit = createForClass('com.google.gwt.http.client.', 'RequestBuilder$1'), Lcom_google_gwt_http_client_RequestException_2_classLit = createForClass('com.google.gwt.http.client.', 'RequestException'), Lcom_google_gwt_http_client_RequestPermissionException_2_classLit = createForClass('com.google.gwt.http.client.', 'RequestPermissionException'), Lcom_google_gwt_http_client_RequestTimeoutException_2_classLit = createForClass('com.google.gwt.http.client.', 'RequestTimeoutException'), Lcom_google_gwt_i18n_client_constants_NumberConstantsImpl_1en_2_classLit = createForClass('com.google.gwt.i18n.client.constants.', 'NumberConstantsImpl_en'), Lcom_google_gwt_i18n_client_DefaultDateTimeFormatInfo_2_classLit = createForClass('com.google.gwt.i18n.client.', 'DefaultDateTimeFormatInfo'), Lcom_google_gwt_i18n_client_impl_cldr_DateTimeFormatInfoImpl_2_classLit = createForClass('com.google.gwt.i18n.client.impl.cldr.', 'DateTimeFormatInfoImpl'), Lcom_google_gwt_i18n_client_impl_cldr_DateTimeFormatInfoImpl_1en_2_classLit = createForClass('com.google.gwt.i18n.client.impl.cldr.', 'DateTimeFormatInfoImpl_en'), Ljava_util_Date_2_classLit = createForClass('java.util.', 'Date'), Lcom_google_gwt_i18n_client_DateTimeFormat_2_classLit = createForClass('com.google.gwt.i18n.client.', 'DateTimeFormat'), Lcom_google_gwt_i18n_client_DateTimeFormat$PredefinedFormat_2_classLit = createForEnum('com.google.gwt.i18n.client.', 'DateTimeFormat$PredefinedFormat', Ljava_lang_Enum_2_classLit, values_6, valueOf_7), _3Lcom_google_gwt_i18n_client_DateTimeFormat$PredefinedFormat_2_classLit = createForArray('[Lcom.google.gwt.i18n.client.', 'DateTimeFormat$PredefinedFormat;', Lcom_google_gwt_i18n_client_DateTimeFormat$PredefinedFormat_2_classLit), Lcom_google_gwt_i18n_client_DateTimeFormat$PatternPart_2_classLit = createForClass('com.google.gwt.i18n.client.', 'DateTimeFormat$PatternPart'), Lcom_google_gwt_i18n_client_HasDirection$Direction_2_classLit = createForEnum('com.google.gwt.i18n.client.', 'HasDirection$Direction', Ljava_lang_Enum_2_classLit, values_7, valueOf_8), _3Lcom_google_gwt_i18n_client_HasDirection$Direction_2_classLit = createForArray('[Lcom.google.gwt.i18n.client.', 'HasDirection$Direction;', Lcom_google_gwt_i18n_client_HasDirection$Direction_2_classLit), Lcom_google_gwt_i18n_client_NumberFormat_2_classLit = createForClass('com.google.gwt.i18n.client.', 'NumberFormat'), Lcom_google_gwt_i18n_client_TimeZone_2_classLit = createForClass('com.google.gwt.i18n.client.', 'TimeZone'), Lcom_google_gwt_json_client_JSONValue_2_classLit = createForClass('com.google.gwt.json.client.', 'JSONValue'), Lcom_google_gwt_json_client_JSONArray_2_classLit = createForClass('com.google.gwt.json.client.', 'JSONArray'), Lcom_google_gwt_json_client_JSONBoolean_2_classLit = createForClass('com.google.gwt.json.client.', 'JSONBoolean'), Lcom_google_gwt_json_client_JSONException_2_classLit = createForClass('com.google.gwt.json.client.', 'JSONException'), Lcom_google_gwt_json_client_JSONNull_2_classLit = createForClass('com.google.gwt.json.client.', 'JSONNull'), Lcom_google_gwt_json_client_JSONNumber_2_classLit = createForClass('com.google.gwt.json.client.', 'JSONNumber'), Lcom_google_gwt_json_client_JSONObject_2_classLit = createForClass('com.google.gwt.json.client.', 'JSONObject'), Lcom_google_gwt_json_client_JSONObject$1_2_classLit = createForClass('com.google.gwt.json.client.', 'JSONObject$1'), Lcom_google_gwt_json_client_JSONString_2_classLit = createForClass('com.google.gwt.json.client.', 'JSONString'), Lcom_google_gwt_lang_LongLibBase$LongEmul_2_classLit = createForClass('com.google.gwt.lang.', 'LongLibBase$LongEmul'), _3Lcom_google_gwt_lang_LongLibBase$LongEmul_2_classLit = createForArray('[Lcom.google.gwt.lang.', 'LongLibBase$LongEmul;', Lcom_google_gwt_lang_LongLibBase$LongEmul_2_classLit), Lcom_google_gwt_user_client_impl_HistoryImpl_2_classLit = createForClass('com.google.gwt.user.client.impl.', 'HistoryImpl'), Lcom_google_gwt_user_client_impl_HistoryImplTimer_2_classLit = createForClass('com.google.gwt.user.client.impl.', 'HistoryImplTimer'), Lcom_google_gwt_user_client_impl_HistoryImplSafari_2_classLit = createForClass('com.google.gwt.user.client.impl.', 'HistoryImplSafari'), Lcom_google_gwt_user_client_ui_AbstractImagePrototype_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'AbstractImagePrototype'), Lcom_google_gwt_user_client_ui_impl_ClippedImagePrototype_2_classLit = createForClass('com.google.gwt.user.client.ui.impl.', 'ClippedImagePrototype'), Lcom_google_gwt_user_client_ui_impl_FocusImpl_2_classLit = createForClass('com.google.gwt.user.client.ui.impl.', 'FocusImpl'), Lcom_google_gwt_user_client_ui_impl_FocusImplStandard_2_classLit = createForClass('com.google.gwt.user.client.ui.impl.', 'FocusImplStandard'), Lcom_google_gwt_user_client_ui_impl_FocusImplSafari_2_classLit = createForClass('com.google.gwt.user.client.ui.impl.', 'FocusImplSafari'), Lcom_google_gwt_user_client_ui_AbsolutePanel_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'AbsolutePanel'), Lcom_google_gwt_user_client_ui_Composite_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'Composite'), Lcom_google_gwt_user_client_ui_DirectionalTextHelper_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'DirectionalTextHelper'), Lcom_google_gwt_user_client_ui_FlowPanel_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'FlowPanel'), Lcom_google_gwt_user_client_ui_Frame_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'Frame'), Lcom_google_gwt_user_client_ui_LabelBase_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'LabelBase'), Lcom_google_gwt_user_client_ui_Label_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'Label'), Lcom_google_gwt_user_client_ui_HTMLPanel_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'HTMLPanel'), Lcom_google_gwt_user_client_ui_HasHorizontalAlignment$AutoHorizontalAlignmentConstant_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'HasHorizontalAlignment$AutoHorizontalAlignmentConstant'), Lcom_google_gwt_user_client_ui_HasHorizontalAlignment$HorizontalAlignmentConstant_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'HasHorizontalAlignment$HorizontalAlignmentConstant'), Lcom_google_gwt_user_client_ui_MenuBar_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'MenuBar'), Lcom_google_gwt_user_client_ui_MenuBar$2_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'MenuBar$2'), Lcom_google_gwt_user_client_ui_NamedFrame_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'NamedFrame'), Lcom_google_gwt_user_client_ui_RootPanel_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'RootPanel'), Lcom_google_gwt_user_client_ui_RootPanel$DefaultRootPanel_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'RootPanel$DefaultRootPanel'), Lcom_google_gwt_user_client_ui_RootPanel$2_2_classLit = createForClass('com.google.gwt.user.client.ui.', 'RootPanel$2'), Lcom_google_gwt_user_client_CommandCanceledException_2_classLit = createForClass('com.google.gwt.user.client.', 'CommandCanceledException'), Lcom_google_gwt_user_client_CommandExecutor_2_classLit = createForClass('com.google.gwt.user.client.', 'CommandExecutor'), Lcom_google_gwt_user_client_CommandExecutor$CircularIterator_2_classLit = createForClass('com.google.gwt.user.client.', 'CommandExecutor$CircularIterator'), Lcom_google_gwt_user_client_CommandExecutor$1_2_classLit = createForClass('com.google.gwt.user.client.', 'CommandExecutor$1'), Lcom_google_gwt_user_client_CommandExecutor$2_2_classLit = createForClass('com.google.gwt.user.client.', 'CommandExecutor$2'), Lcom_google_gwt_user_client_Event$NativePreviewEvent_2_classLit = createForClass('com.google.gwt.user.client.', 'Event$NativePreviewEvent'), Ljava_lang_ArithmeticException_2_classLit = createForClass('java.lang.', 'ArithmeticException'), Ljava_lang_Boolean_2_classLit = createForClass('java.lang.', 'Boolean'), Ljava_lang_Character_2_classLit = createForClass('java.lang.', 'Character'), _3Ljava_lang_Character_2_classLit = createForArray('[Ljava.lang.', 'Character;', Ljava_lang_Character_2_classLit), Ljava_lang_Long_2_classLit = createForClass('java.lang.', 'Long'), _3Ljava_lang_Long_2_classLit = createForArray('[Ljava.lang.', 'Long;', Ljava_lang_Long_2_classLit), J_classLit = createForPrimitive('long'), _3J_classLit = createForArray('', '[J', J_classLit), B_classLit = createForPrimitive('byte'), _3B_classLit = createForArray('', '[B', B_classLit), Ljava_lang_StringIndexOutOfBoundsException_2_classLit = createForClass('java.lang.', 'StringIndexOutOfBoundsException'), Ljava_util_AbstractMap$2_2_classLit = createForClass('java.util.', 'AbstractMap$2'), Ljava_util_AbstractMap$2$1_2_classLit = createForClass('java.util.', 'AbstractMap$2$1'), Ljava_util_Arrays$ArrayList_2_classLit = createForClass('java.util.', 'Arrays$ArrayList'), Ljava_util_Collections$SingletonList_2_classLit = createForClass('java.util.', 'Collections$SingletonList'), Ljava_util_Collections$UnmodifiableMap_2_classLit = createForClass('java.util.', 'Collections$UnmodifiableMap'), Ljava_util_Collections$UnmodifiableSet_2_classLit = createForClass('java.util.', 'Collections$UnmodifiableSet'), Ljava_util_Collections$UnmodifiableMap$UnmodifiableEntrySet_2_classLit = createForClass('java.util.', 'Collections$UnmodifiableMap$UnmodifiableEntrySet'), Ljava_util_Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry_2_classLit = createForClass('java.util.', 'Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry'), Ljava_util_Collections$UnmodifiableMap$UnmodifiableEntrySet$1_2_classLit = createForClass('java.util.', 'Collections$UnmodifiableMap$UnmodifiableEntrySet$1'), Ljava_util_EmptyStackException_2_classLit = createForClass('java.util.', 'EmptyStackException'), Ljava_util_Vector_2_classLit = createForClass('java.util.', 'Vector'), Ljava_util_Stack_2_classLit = createForClass('java.util.', 'Stack'), Ljava_util_TreeMap_2_classLit = createForClass('java.util.', 'TreeMap'), Ljava_util_TreeMap$EntryIterator_2_classLit = createForClass('java.util.', 'TreeMap$EntryIterator'), Ljava_util_TreeMap$EntrySet_2_classLit = createForClass('java.util.', 'TreeMap$EntrySet'), Ljava_util_TreeMap$Node_2_classLit = createForClass('java.util.', 'TreeMap$Node'), _3Ljava_util_TreeMap$Node_2_classLit = createForArray('[Ljava.util.', 'TreeMap$Node;', Ljava_util_TreeMap$Node_2_classLit), Ljava_util_TreeMap$State_2_classLit = createForClass('java.util.', 'TreeMap$State'), Ljava_util_TreeMap$SubMapType_2_classLit = createForEnum('java.util.', 'TreeMap$SubMapType', Ljava_lang_Enum_2_classLit, values_11, valueOf_17), _3Ljava_util_TreeMap$SubMapType_2_classLit = createForArray('[Ljava.util.', 'TreeMap$SubMapType;', Ljava_util_TreeMap$SubMapType_2_classLit), Ljava_util_TreeMap$SubMapType$1_2_classLit = createForEnum('java.util.', 'TreeMap$SubMapType$1', Ljava_util_TreeMap$SubMapType_2_classLit, null, null), Ljava_util_TreeMap$SubMapType$2_2_classLit = createForEnum('java.util.', 'TreeMap$SubMapType$2', Ljava_util_TreeMap$SubMapType_2_classLit, null, null), Ljava_util_TreeMap$SubMapType$3_2_classLit = createForEnum('java.util.', 'TreeMap$SubMapType$3', Ljava_util_TreeMap$SubMapType_2_classLit, null, null), Ljava_util_TreeMap$1_2_classLit = createForClass('java.util.', 'TreeMap$1'), Ljava_util_TreeSet_2_classLit = createForClass('java.util.', 'TreeSet'), Lorg_waveprotocol_wave_client_account_impl_AbstractProfileManager_2_classLit = createForClass('org.waveprotocol.wave.client.account.impl.', 'AbstractProfileManager'), Lorg_waveprotocol_wave_client_account_impl_ProfileImpl_2_classLit = createForClass('org.waveprotocol.wave.client.account.impl.', 'ProfileImpl'), Lorg_waveprotocol_wave_client_account_impl_ProfileManagerImpl_2_classLit = createForClass('org.waveprotocol.wave.client.account.impl.', 'ProfileManagerImpl'), Lorg_waveprotocol_wave_client_autohide_AutoHider_2_classLit = createForClass('org.waveprotocol.wave.client.autohide.', 'AutoHider'), Lorg_waveprotocol_wave_client_autohide_AutoHider$KeyBehavior_2_classLit = createForEnum('org.waveprotocol.wave.client.autohide.', 'AutoHider$KeyBehavior', Ljava_lang_Enum_2_classLit, values_12, valueOf_18), _3Lorg_waveprotocol_wave_client_autohide_AutoHider$KeyBehavior_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.autohide.', 'AutoHider$KeyBehavior;', Lorg_waveprotocol_wave_client_autohide_AutoHider$KeyBehavior_2_classLit), Lorg_waveprotocol_wave_client_autohide_EventPreviewAutoHiderRegistrar_2_classLit = createForClass('org.waveprotocol.wave.client.autohide.', 'EventPreviewAutoHiderRegistrar'), Lorg_waveprotocol_wave_client_clipboard_Clipboard_2_classLit = createForClass('org.waveprotocol.wave.client.clipboard.', 'Clipboard'), Lorg_waveprotocol_wave_client_clipboard_PasteBufferImpl_2_classLit = createForClass('org.waveprotocol.wave.client.clipboard.', 'PasteBufferImpl'), Lorg_waveprotocol_wave_client_clipboard_PasteBufferImplSafari_2_classLit = createForClass('org.waveprotocol.wave.client.clipboard.', 'PasteBufferImplSafari'), Lorg_waveprotocol_wave_client_common_util_JsIdentitySet_2_classLit = createForClass('org.waveprotocol.wave.client.common.util.', 'JsIdentitySet'), Lorg_waveprotocol_wave_client_common_util_JsoIntMap$1_2_classLit = createForClass('org.waveprotocol.wave.client.common.util.', 'JsoIntMap$1'), Lorg_waveprotocol_wave_client_common_util_JsoStringMap$2_2_classLit = createForClass('org.waveprotocol.wave.client.common.util.', 'JsoStringMap$2'), Lorg_waveprotocol_wave_client_common_util_JsoStringSet$2_2_classLit = createForClass('org.waveprotocol.wave.client.common.util.', 'JsoStringSet$2'), Lorg_waveprotocol_wave_client_common_util_JsoStringSet$4_2_classLit = createForClass('org.waveprotocol.wave.client.common.util.', 'JsoStringSet$4'), Lorg_waveprotocol_wave_client_common_util_JsoStringSet$5_2_classLit = createForClass('org.waveprotocol.wave.client.common.util.', 'JsoStringSet$5'), Lorg_waveprotocol_wave_client_common_util_JsoStringSet$6_2_classLit = createForClass('org.waveprotocol.wave.client.common.util.', 'JsoStringSet$6'), Lorg_waveprotocol_wave_client_common_util_LinkedPruningSequenceMap_2_classLit = createForClass('org.waveprotocol.wave.client.common.util.', 'LinkedPruningSequenceMap'), Lorg_waveprotocol_wave_client_common_util_LinkedPruningSequenceMap$Node_2_classLit = createForClass('org.waveprotocol.wave.client.common.util.', 'LinkedPruningSequenceMap$Node'), Lorg_waveprotocol_wave_client_common_util_LinkedPruningSequenceMap$1_2_classLit = createForClass('org.waveprotocol.wave.client.common.util.', 'LinkedPruningSequenceMap$1'), Lorg_waveprotocol_wave_client_concurrencycontrol_LiveTarget_2_classLit = createForClass('org.waveprotocol.wave.client.concurrencycontrol.', 'LiveTarget'), Lorg_waveprotocol_wave_client_concurrencycontrol_LiveTarget$1_2_classLit = createForClass('org.waveprotocol.wave.client.concurrencycontrol.', 'LiveTarget$1'), Lorg_waveprotocol_wave_client_concurrencycontrol_ProxyOperationSink_2_classLit = createForClass('org.waveprotocol.wave.client.concurrencycontrol.', 'ProxyOperationSink'), Lorg_waveprotocol_wave_model_operation_wave_WaveletOperation_2_classLit = createForClass('org.waveprotocol.wave.model.operation.wave.', 'WaveletOperation'), Lorg_waveprotocol_wave_client_concurrencycontrol_WaveletOperationalizer_2_classLit = createForClass('org.waveprotocol.wave.client.concurrencycontrol.', 'WaveletOperationalizer'), Lorg_waveprotocol_wave_common_logging_AbstractLogger_2_classLit = createForClass('org.waveprotocol.wave.common.logging.', 'AbstractLogger'), Lorg_waveprotocol_wave_client_debug_logger_DomLogger_2_classLit = createForClass('org.waveprotocol.wave.client.debug.logger.', 'DomLogger'), Lorg_waveprotocol_wave_client_debug_logger_BufferedLogger_2_classLit = createForClass('org.waveprotocol.wave.client.debug.logger.', 'BufferedLogger'), Lorg_waveprotocol_wave_common_logging_LogSink_2_classLit = createForClass('org.waveprotocol.wave.common.logging.', 'LogSink'), Lorg_waveprotocol_wave_client_debug_logger_BufferedLogger$BufferedLogSink_2_classLit = createForClass('org.waveprotocol.wave.client.debug.logger.', 'BufferedLogger$BufferedLogSink'), Lorg_waveprotocol_wave_client_debug_logger_BufferedLogger$BufferedLogSink$LogMessage_2_classLit = createForClass('org.waveprotocol.wave.client.debug.logger.', 'BufferedLogger$BufferedLogSink$LogMessage'), Lorg_waveprotocol_wave_client_debug_logger_BufferedLogger$BufferedLogSink$1_2_classLit = createForClass('org.waveprotocol.wave.client.debug.logger.', 'BufferedLogger$BufferedLogSink$1'), Lorg_waveprotocol_wave_client_debug_logger_DomLogger$GWTLogSink_2_classLit = createForClass('org.waveprotocol.wave.client.debug.logger.', 'DomLogger$GWTLogSink'), Lorg_waveprotocol_wave_client_doodad_diff_DiffAnnotationHandler_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.diff.', 'DiffAnnotationHandler'), Lorg_waveprotocol_wave_client_doodad_diff_DiffAnnotationHandler$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.diff.', 'DiffAnnotationHandler$1'), Lorg_waveprotocol_wave_client_doodad_diff_DiffAnnotationHandler$2_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.diff.', 'DiffAnnotationHandler$2'), Lorg_waveprotocol_wave_client_doodad_diff_DiffDeleteRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.diff.', 'DiffDeleteRenderer'), Lorg_waveprotocol_wave_client_doodad_link_Link$InvalidLinkException_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.link.', 'Link$InvalidLinkException'), Lorg_waveprotocol_wave_client_doodad_link_LinkAnnotationHandler_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.link.', 'LinkAnnotationHandler'), Lorg_waveprotocol_wave_client_doodad_link_LinkAnnotationHandler$RenderFunc_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.link.', 'LinkAnnotationHandler$RenderFunc'), Lorg_waveprotocol_wave_client_doodad_link_LinkAnnotationHandler$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.link.', 'LinkAnnotationHandler$1'), Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$DefaultAnnotationBehaviour_2_classLit = createForClass('org.waveprotocol.wave.model.document.', 'AnnotationBehaviour$DefaultAnnotationBehaviour'), Lorg_waveprotocol_wave_client_doodad_link_LinkAnnotationHandler$2_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.link.', 'LinkAnnotationHandler$2'), Lorg_waveprotocol_wave_client_doodad_selection_CaretMarkerRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.selection.', 'CaretMarkerRenderer'), Lorg_waveprotocol_wave_client_doodad_selection_CaretWidget_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.selection.', 'CaretWidget'), Lorg_waveprotocol_wave_client_doodad_selection_RgbColor_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.selection.', 'RgbColor'), _3Lorg_waveprotocol_wave_client_doodad_selection_RgbColor_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.doodad.selection.', 'RgbColor;', Lorg_waveprotocol_wave_client_doodad_selection_RgbColor_2_classLit), Lorg_waveprotocol_wave_client_doodad_selection_SelectionAnnotationHandler_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.selection.', 'SelectionAnnotationHandler'), Lorg_waveprotocol_wave_client_doodad_selection_SelectionAnnotationHandler$SessionData_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.selection.', 'SelectionAnnotationHandler$SessionData'), Lorg_waveprotocol_wave_client_doodad_selection_SelectionAnnotationHandler$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.selection.', 'SelectionAnnotationHandler$1'), Lorg_waveprotocol_wave_client_doodad_selection_SelectionAnnotationHandler$2_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.selection.', 'SelectionAnnotationHandler$2'), Lorg_waveprotocol_wave_client_doodad_selection_SelectionAnnotationHandler$3_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.selection.', 'SelectionAnnotationHandler$3'), Lorg_waveprotocol_wave_client_doodad_selection_SelectionAnnotationHandler$4_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.selection.', 'SelectionAnnotationHandler$4'), Lorg_waveprotocol_wave_client_doodad_title_TitleAnnotationHandler_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.title.', 'TitleAnnotationHandler'), Lorg_waveprotocol_wave_client_doodad_title_TitleAnnotationHandler$1_2_classLit = createForClass('org.waveprotocol.wave.client.doodad.title.', 'TitleAnnotationHandler$1'), Lorg_waveprotocol_wave_client_editor_NodeMutationHandlerImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'NodeMutationHandlerImpl'), Lorg_waveprotocol_wave_client_editor_RenderingMutationHandler_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'RenderingMutationHandler'), Lorg_waveprotocol_wave_client_editor_content_img_ImgDoodad$ImgRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.img.', 'ImgDoodad$ImgRenderer'), Lorg_waveprotocol_wave_client_editor_content_misc_AnnotationBoundaryRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'AnnotationBoundaryRenderer'), Lorg_waveprotocol_wave_client_editor_NodeEventHandlerImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'NodeEventHandlerImpl'), Lorg_waveprotocol_wave_client_editor_content_misc_AnnotationBoundaryRenderer$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'AnnotationBoundaryRenderer$1'), Lorg_waveprotocol_wave_client_editor_content_misc_AnnotationSpreadRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'AnnotationSpreadRenderer'), Lorg_waveprotocol_wave_client_editor_content_misc_AnnotationSpreadRenderer$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'AnnotationSpreadRenderer$1'), Lorg_waveprotocol_wave_client_editor_content_misc_AnnotationSpreadRenderer$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'AnnotationSpreadRenderer$2'), Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphEventHandler_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'ParagraphEventHandler'), Lorg_waveprotocol_wave_client_editor_content_misc_LinoTextEventHandler_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'LinoTextEventHandler'), Lorg_waveprotocol_wave_client_editor_content_misc_Caption$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'Caption$1'), Lorg_waveprotocol_wave_client_editor_content_paragraph_DefaultParagraphHtmlRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'DefaultParagraphHtmlRenderer'), Lorg_waveprotocol_wave_client_editor_content_misc_Caption$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'Caption$2'), Lorg_waveprotocol_wave_client_editor_content_misc_CaretAnnotations_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'CaretAnnotations'), Lorg_waveprotocol_wave_client_editor_content_misc_ChunkyElementHandler_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'ChunkyElementHandler'), Lorg_waveprotocol_wave_client_editor_content_misc_StyleAnnotationHandler_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'StyleAnnotationHandler'), Lorg_waveprotocol_wave_client_editor_content_misc_StyleAnnotationHandler$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'StyleAnnotationHandler$1'), Lorg_waveprotocol_wave_client_editor_content_misc_UpdateContentEditable_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.misc.', 'UpdateContentEditable'), Lorg_waveprotocol_wave_client_editor_content_paragraph_Line_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'Line'), Lorg_waveprotocol_wave_client_editor_content_paragraph_LineContainerParagraphiser_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'LineContainerParagraphiser'), Lorg_waveprotocol_wave_client_editor_content_paragraph_LineContainerParagraphiser$LineHandler_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'LineContainerParagraphiser$LineHandler'), Lorg_waveprotocol_wave_client_editor_content_paragraph_LineRendering$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'LineRendering$1'), Lorg_waveprotocol_wave_client_editor_content_paragraph_LocalParagraphEventHandler_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'LocalParagraphEventHandler'), Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'OrderedListRenumberer'), Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer$LevelNumbers_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'OrderedListRenumberer$LevelNumbers'), Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer$ComparableLine_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'OrderedListRenumberer$ComparableLine'), Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer$RelativeImportance_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.paragraph.', 'OrderedListRenumberer$RelativeImportance', Ljava_lang_Enum_2_classLit, values_25, valueOf_31), _3Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer$RelativeImportance_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.content.paragraph.', 'OrderedListRenumberer$RelativeImportance;', Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer$RelativeImportance_2_classLit), Lorg_waveprotocol_wave_client_editor_content_paragraph_OrderedListRenumberer$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'OrderedListRenumberer$1'), Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$Alignment_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.paragraph.', 'Paragraph$Alignment', Ljava_lang_Enum_2_classLit, values_26, valueOf_32), _3Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$Alignment_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.content.paragraph.', 'Paragraph$Alignment;', Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$Alignment_2_classLit), Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$Direction_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.paragraph.', 'Paragraph$Direction', Ljava_lang_Enum_2_classLit, values_27, valueOf_33), _3Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$Direction_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.content.paragraph.', 'Paragraph$Direction;', Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$Direction_2_classLit), Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'Paragraph$1'), Lorg_waveprotocol_wave_client_editor_content_paragraph_Paragraph$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'Paragraph$2'), Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphBehaviour_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.paragraph.', 'ParagraphBehaviour', Ljava_lang_Enum_2_classLit, values_28, valueOf_34), _3Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphBehaviour_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.content.paragraph.', 'ParagraphBehaviour;', Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphBehaviour_2_classLit), Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphNiceHtmlRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'ParagraphNiceHtmlRenderer'), Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'ParagraphRenderer'), Lorg_waveprotocol_wave_client_editor_content_paragraph_ParagraphRenderer$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.paragraph.', 'ParagraphRenderer$1'), Lorg_waveprotocol_wave_client_editor_content_ContentNode_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentNode'), Lorg_waveprotocol_wave_client_editor_content_ContentElement_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentElement'), Lorg_waveprotocol_wave_client_editor_content_AgentAdapter_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'AgentAdapter'), Lorg_waveprotocol_wave_client_editor_content_AgentAdapter$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'AgentAdapter$1'), Lorg_waveprotocol_wave_client_editor_content_AgentAdapter$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'AgentAdapter$2'), Lorg_waveprotocol_wave_client_editor_content_AgentAdapter_1Resources_1en_1InlineClientBundleGenerator$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'AgentAdapter_Resources_en_InlineClientBundleGenerator$1'), Lorg_waveprotocol_wave_client_editor_content_AnnotationPainter_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'AnnotationPainter'), Lorg_waveprotocol_wave_client_editor_content_AnnotationPainter$DocPainter_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'AnnotationPainter$DocPainter'), Lorg_waveprotocol_wave_client_editor_content_AnnotationPainter$DocPainter$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'AnnotationPainter$DocPainter$1'), Lorg_waveprotocol_wave_client_editor_content_AnnotationPainter$DocPainter$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'AnnotationPainter$DocPainter$2'), Lorg_waveprotocol_wave_model_document_MutableDocumentImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.', 'MutableDocumentImpl'), Lorg_waveprotocol_wave_client_editor_content_CMutableDocument_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'CMutableDocument'), Lorg_waveprotocol_wave_client_editor_content_ContentDocElement$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocElement$1'), Lorg_waveprotocol_wave_client_editor_content_ContentDocElement$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocElement$2'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$LocalOperationException_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$LocalOperationException'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$SchemaViolatingLocalOperationException_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$SchemaViolatingLocalOperationException'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$BadOpLocalOperationException_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$BadOpLocalOperationException'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$AnnotationImplFactory', Ljava_lang_Enum_2_classLit, values_22, valueOf_28), _3Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.content.', 'ContentDocument$AnnotationImplFactory;', Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory_2_classLit), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory$1_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$AnnotationImplFactory$1', Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory_2_classLit, null, null), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory$2_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$AnnotationImplFactory$2', Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory_2_classLit, null, null), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory$3_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$AnnotationImplFactory$3', Lorg_waveprotocol_wave_client_editor_content_ContentDocument$AnnotationImplFactory_2_classLit, null, null), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$SourceNindoSink_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$SourceNindoSink'), Lorg_waveprotocol_wave_model_document_util_IdentityView_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'IdentityView'), Lorg_waveprotocol_wave_model_document_util_FilteredView_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'FilteredView'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$RenderedContent_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$RenderedContent'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$FullContent_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$FullContent'), Lorg_waveprotocol_wave_model_document_util_PersistentContent_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'PersistentContent'), Lorg_waveprotocol_wave_model_document_util_RepaintingPersistentContent_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'RepaintingPersistentContent'), Lorg_waveprotocol_wave_client_editor_content_PersistentContentView_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'PersistentContentView'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$PersistentContentDoc_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$PersistentContentDoc'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$FilteredHtml_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$FilteredHtml'), Lorg_waveprotocol_wave_model_document_util_LocalAnnotationSetImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'LocalAnnotationSetImpl'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$LocalAnnotationSet_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$LocalAnnotationSet'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$ContentIndexedDoc_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$ContentIndexedDoc'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$ContentIndexedDoc$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$ContentIndexedDoc$1'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$Level_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$Level', Ljava_lang_Enum_2_classLit, values_23, valueOf_29), _3Lorg_waveprotocol_wave_client_editor_content_ContentDocument$Level_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.content.', 'ContentDocument$Level;', Lorg_waveprotocol_wave_client_editor_content_ContentDocument$Level_2_classLit), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$1'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$2'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$3_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$3'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$4_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$4'), Lorg_waveprotocol_wave_client_scheduler_FinalTaskRunnerImpl_2_classLit = createForClass('org.waveprotocol.wave.client.scheduler.', 'FinalTaskRunnerImpl'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$4$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$4$1'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$5_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$5'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$6_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$6'), Lorg_waveprotocol_wave_client_editor_content_ContentDocument$7_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentDocument$7'), Lorg_waveprotocol_wave_client_editor_content_ContentElement$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentElement$1'), Lorg_waveprotocol_wave_client_editor_content_ContentNode$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentNode$1'), Lorg_waveprotocol_wave_model_document_util_PointRange_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'PointRange'), Lorg_waveprotocol_wave_client_editor_content_FullContentView_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'FullContentView'), Lorg_waveprotocol_wave_client_editor_content_ContentRawDocument_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentRawDocument'), Lorg_waveprotocol_wave_client_editor_content_ContentTextNode_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ContentTextNode'), Lorg_waveprotocol_wave_client_editor_content_DiffHighlightingFilter_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'DiffHighlightingFilter'), Lorg_waveprotocol_wave_client_editor_content_DiffHighlightingFilter$DeleteInfo_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'DiffHighlightingFilter$DeleteInfo'), Lorg_waveprotocol_wave_client_editor_content_DiffOpWrapperBase_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'DiffOpWrapperBase'), Lorg_waveprotocol_wave_client_editor_content_DiffHighlightingFilter$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'DiffHighlightingFilter$1'), Lorg_waveprotocol_wave_client_editor_content_DiffHighlightingFilter$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'DiffHighlightingFilter$2'), Lorg_waveprotocol_wave_client_editor_content_DiffHighlightingFilter$3_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'DiffHighlightingFilter$3'), Lorg_waveprotocol_wave_client_editor_content_ExtendedClientDocumentContext$LowLevelEditingConcerns$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'ExtendedClientDocumentContext$LowLevelEditingConcerns$1'), Lorg_waveprotocol_wave_model_document_util_FocusedPointRange_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'FocusedPointRange'), Lorg_waveprotocol_wave_client_editor_content_FocusedContentRange_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'FocusedContentRange'), Lorg_waveprotocol_wave_client_editor_content_HtmlPoint_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'HtmlPoint'), Lorg_waveprotocol_wave_client_editor_content_LazyPersistenceManager_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'LazyPersistenceManager'), Lorg_waveprotocol_wave_client_editor_content_LazyPersistenceManager$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'LazyPersistenceManager$1'), Lorg_waveprotocol_wave_client_editor_content_PainterRegistryImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'PainterRegistryImpl'), Lorg_waveprotocol_wave_client_editor_content_PainterRegistryImpl$PaintData_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'PainterRegistryImpl$PaintData'), Lorg_waveprotocol_wave_client_editor_content_PainterRegistryImpl$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'PainterRegistryImpl$1'), Lorg_waveprotocol_wave_client_editor_content_RegistriesImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'RegistriesImpl'), Lorg_waveprotocol_wave_client_editor_content_SelectionMaintainer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.content.', 'SelectionMaintainer'), Lorg_waveprotocol_wave_client_editor_content_SelectionMaintainer$TextNodeChangeType_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.content.', 'SelectionMaintainer$TextNodeChangeType', Ljava_lang_Enum_2_classLit, values_24, valueOf_30), _3Lorg_waveprotocol_wave_client_editor_content_SelectionMaintainer$TextNodeChangeType_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.content.', 'SelectionMaintainer$TextNodeChangeType;', Lorg_waveprotocol_wave_client_editor_content_SelectionMaintainer$TextNodeChangeType_2_classLit), Lorg_waveprotocol_wave_client_editor_extract_DomMutationReverter_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'DomMutationReverter'), Lorg_waveprotocol_wave_client_editor_extract_ImeExtractor$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'ImeExtractor$1'), Lorg_waveprotocol_wave_client_editor_extract_InconsistencyException_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'InconsistencyException'), Lorg_waveprotocol_wave_client_editor_extract_InconsistencyException$HtmlMissing_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'InconsistencyException$HtmlMissing'), Lorg_waveprotocol_wave_client_editor_extract_InconsistencyException$HtmlInserted_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'InconsistencyException$HtmlInserted'), Lorg_waveprotocol_wave_client_editor_extract_PasteAnnotationLogic_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'PasteAnnotationLogic'), Lorg_waveprotocol_wave_client_editor_extract_PasteExtractor_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'PasteExtractor'), Lorg_waveprotocol_wave_client_editor_extract_PasteFormatRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'PasteFormatRenderer'), Lorg_waveprotocol_wave_client_editor_extract_PasteFormatRenderers$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'PasteFormatRenderers$1'), Lorg_waveprotocol_wave_client_editor_extract_PasteFormatRenderers$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'PasteFormatRenderers$2'), Lorg_waveprotocol_wave_client_editor_extract_Repairer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'Repairer'), Lorg_waveprotocol_wave_client_scheduler_ScheduleTimer_2_classLit = createForClass('org.waveprotocol.wave.client.scheduler.', 'ScheduleTimer'), Lorg_waveprotocol_wave_client_editor_extract_SubTreeXmlRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'SubTreeXmlRenderer'), Lorg_waveprotocol_wave_client_editor_extract_TypingExtractor_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'TypingExtractor'), Lorg_waveprotocol_wave_client_editor_extract_TypingExtractor$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.extract.', 'TypingExtractor$1'), Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler_2_classLit = createForClass('org.waveprotocol.wave.client.editor.gwt.', 'GwtRenderingMutationHandler'), Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.gwt.', 'GwtRenderingMutationHandler$Flow', Ljava_lang_Enum_2_classLit, values_33, valueOf_39), _3Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.gwt.', 'GwtRenderingMutationHandler$Flow;', Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow_2_classLit), Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow$1_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.gwt.', 'GwtRenderingMutationHandler$Flow$1', Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow_2_classLit, null, null), Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow$2_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.gwt.', 'GwtRenderingMutationHandler$Flow$2', Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow_2_classLit, null, null), Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow$3_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.gwt.', 'GwtRenderingMutationHandler$Flow$3', Lorg_waveprotocol_wave_client_editor_gwt_GwtRenderingMutationHandler$Flow_2_classLit, null, null), Lorg_waveprotocol_wave_client_editor_impl_DiffManager$DiffType_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.impl.', 'DiffManager$DiffType', Ljava_lang_Enum_2_classLit, values_34, valueOf_40), _3Lorg_waveprotocol_wave_client_editor_impl_DiffManager$DiffType_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.impl.', 'DiffManager$DiffType;', Lorg_waveprotocol_wave_client_editor_impl_DiffManager$DiffType_2_classLit), Lorg_waveprotocol_wave_client_editor_impl_HtmlViewImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.impl.', 'HtmlViewImpl'), Lorg_waveprotocol_wave_client_editor_impl_NodeManager_2_classLit = createForClass('org.waveprotocol.wave.client.editor.impl.', 'NodeManager'), Lorg_waveprotocol_wave_client_editor_impl_StrippingHtmlView_2_classLit = createForClass('org.waveprotocol.wave.client.editor.impl.', 'StrippingHtmlView'), Lorg_waveprotocol_wave_client_editor_operation_EditorOperationSequencer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.operation.', 'EditorOperationSequencer'), Lorg_waveprotocol_wave_client_editor_selection_content_PassiveSelectionHelper_2_classLit = createForClass('org.waveprotocol.wave.client.editor.selection.content.', 'PassiveSelectionHelper'), Lorg_waveprotocol_wave_client_editor_selection_content_AggressiveSelectionHelper_2_classLit = createForClass('org.waveprotocol.wave.client.editor.selection.content.', 'AggressiveSelectionHelper'), Lorg_waveprotocol_wave_client_editor_selection_content_CaretMovementHelperWebkitImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.selection.content.', 'CaretMovementHelperWebkitImpl'), Lorg_waveprotocol_wave_client_editor_selection_content_PassiveSelectionHelper$ValidSelectionContainerView_2_classLit = createForClass('org.waveprotocol.wave.client.editor.selection.content.', 'PassiveSelectionHelper$ValidSelectionContainerView'), Lorg_waveprotocol_wave_client_editor_selection_content_SelectionHelper$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.selection.content.', 'SelectionHelper$1'), _3Lorg_waveprotocol_wave_model_document_util_FilteredView_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.util.', 'FilteredView;', Lorg_waveprotocol_wave_model_document_util_FilteredView_2_classLit), Lorg_waveprotocol_wave_client_editor_selection_html_NativeSelectionUtil$NoOpMutationListener_2_classLit = createForClass('org.waveprotocol.wave.client.editor.selection.html.', 'NativeSelectionUtil$NoOpMutationListener'), Lorg_waveprotocol_wave_client_editor_selection_html_SelectionImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.selection.html.', 'SelectionImpl'), Lorg_waveprotocol_wave_client_editor_selection_html_SelectionImplW3C_2_classLit = createForClass('org.waveprotocol.wave.client.editor.selection.html.', 'SelectionImplW3C'), Lorg_waveprotocol_wave_client_editor_sugg_InteractiveSuggestionsManager_2_classLit = createForClass('org.waveprotocol.wave.client.editor.sugg.', 'InteractiveSuggestionsManager'), Lorg_waveprotocol_wave_client_editor_sugg_InteractiveSuggestionsManager$PopupCloser_2_classLit = createForClass('org.waveprotocol.wave.client.editor.sugg.', 'InteractiveSuggestionsManager$PopupCloser'), Lorg_waveprotocol_wave_client_editor_sugg_InteractiveSuggestionsManager$PopupCloser$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.sugg.', 'InteractiveSuggestionsManager$PopupCloser$1'), Lorg_waveprotocol_wave_client_editor_sugg_InteractiveSuggestionsManager$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.sugg.', 'InteractiveSuggestionsManager$1'), Lorg_waveprotocol_wave_client_editor_sugg_SuggestionMenu_2_classLit = createForClass('org.waveprotocol.wave.client.editor.sugg.', 'SuggestionMenu'), Lorg_waveprotocol_wave_client_editor_util_AnnotationBehaviourLogic_2_classLit = createForClass('org.waveprotocol.wave.client.editor.util.', 'AnnotationBehaviourLogic'), Lorg_waveprotocol_wave_client_editor_util_AnnotationBehaviourLogic$2_2_classLit = createForClass('org.waveprotocol.wave.client.editor.util.', 'AnnotationBehaviourLogic$2'), Lorg_waveprotocol_wave_client_editor_util_AnnotationBehaviourLogic$3_2_classLit = createForClass('org.waveprotocol.wave.client.editor.util.', 'AnnotationBehaviourLogic$3'), Lorg_waveprotocol_wave_client_editor_util_AnnotationBehaviourLogic$4_2_classLit = createForClass('org.waveprotocol.wave.client.editor.util.', 'AnnotationBehaviourLogic$4'), Lorg_waveprotocol_wave_client_editor_util_AnnotationBehaviourLogic$5_2_classLit = createForClass('org.waveprotocol.wave.client.editor.util.', 'AnnotationBehaviourLogic$5'), Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'AnnotationTree'), Lorg_waveprotocol_wave_client_editor_EditorAnnotationTree_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorAnnotationTree'), Lorg_waveprotocol_wave_client_editor_EditorImpl$7_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl$7'), Lorg_waveprotocol_wave_client_editor_EditorImpl$11_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl$11'), Lorg_waveprotocol_wave_client_editor_EditorImpl$12_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl$12'), Lorg_waveprotocol_wave_client_editor_EditorImpl$13_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl$13'), Lorg_waveprotocol_wave_client_editor_EditorImpl$14_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl$14'), Lorg_waveprotocol_wave_client_editor_EditorImpl$15_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl$15'), Lorg_waveprotocol_wave_client_editor_EditorImpl$16_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorImpl$16'), Lorg_waveprotocol_wave_client_editor_EditorInstrumentor$Action_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.', 'EditorInstrumentor$Action', Ljava_lang_Enum_2_classLit, values_20, valueOf_26), _3Lorg_waveprotocol_wave_client_editor_EditorInstrumentor$Action_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.', 'EditorInstrumentor$Action;', Lorg_waveprotocol_wave_client_editor_EditorInstrumentor$Action_2_classLit), Lorg_waveprotocol_wave_client_editor_EditorRuntimeException_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorRuntimeException'), Lorg_waveprotocol_wave_client_editor_EditorUndoManager$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorUndoManager$1'), Lorg_waveprotocol_wave_client_editor_EditorUndoManagerImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'EditorUndoManagerImpl'), Lorg_waveprotocol_wave_client_editor_ElementHandlerRegistry_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'ElementHandlerRegistry'), Lorg_waveprotocol_wave_client_editor_ElementHandlerRegistry$HandlerData_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'ElementHandlerRegistry$HandlerData'), Lorg_waveprotocol_wave_client_editor_ElementHandlerRegistry$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'ElementHandlerRegistry$1'), Lorg_waveprotocol_wave_client_editor_HtmlSelectionHelperImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'HtmlSelectionHelperImpl'), Lorg_waveprotocol_wave_client_editor_RenderingMutationHandler$1_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'RenderingMutationHandler$1'), Lorg_waveprotocol_wave_client_editor_ResponsibilityManagerImpl_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'ResponsibilityManagerImpl'), Lorg_waveprotocol_wave_client_editor_ResponsibilityManagerImpl$SequenceType_2_classLit = createForEnum('org.waveprotocol.wave.client.editor.', 'ResponsibilityManagerImpl$SequenceType', Ljava_lang_Enum_2_classLit, values_21, valueOf_27), _3Lorg_waveprotocol_wave_client_editor_ResponsibilityManagerImpl$SequenceType_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.editor.', 'ResponsibilityManagerImpl$SequenceType;', Lorg_waveprotocol_wave_client_editor_ResponsibilityManagerImpl$SequenceType_2_classLit), Lorg_waveprotocol_wave_client_editor_UndoableSequencer_2_classLit = createForClass('org.waveprotocol.wave.client.editor.', 'UndoableSequencer'), Lorg_waveprotocol_wave_client_gadget_renderer_Controller_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'Controller'), Lorg_waveprotocol_wave_client_gadget_renderer_Controller$InvalidArgumentException_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'Controller$InvalidArgumentException'), Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service_2_classLit = createForEnum('org.waveprotocol.wave.client.gadget.renderer.', 'Controller$Service', Ljava_lang_Enum_2_classLit, values_37, valueOf_43), _3Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.gadget.renderer.', 'Controller$Service;', Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service_2_classLit), Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$1_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'Controller$Service$1'), Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$2_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'Controller$Service$2'), Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$3_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'Controller$Service$3'), Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$4_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'Controller$Service$4'), Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$5_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'Controller$Service$5'), Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$6_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'Controller$Service$6'), Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$7_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'Controller$Service$7'), Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$8_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'Controller$Service$8'), Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$9_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'Controller$Service$9'), Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$10_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'Controller$Service$10'), Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$11_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'Controller$Service$11'), Lorg_waveprotocol_wave_client_gadget_renderer_Controller$Service$12_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'Controller$Service$12'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetDataStoreImpl_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetDataStoreImpl'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetDataStoreImpl$CacheElement_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetDataStoreImpl$CacheElement'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetDataStoreImpl$1_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetDataStoreImpl$1'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetElementChild_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetElementChild'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetElementChild$Type_2_classLit = createForEnum('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetElementChild$Type', Ljava_lang_Enum_2_classLit, values_38, valueOf_44), _3Lorg_waveprotocol_wave_client_gadget_renderer_GadgetElementChild$Type_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.gadget.renderer.', 'GadgetElementChild$Type;', Lorg_waveprotocol_wave_client_gadget_renderer_GadgetElementChild$Type_2_classLit), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetMetadata_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetMetadata'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetMetadata$View_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetMetadata$View'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetRenderer'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetUserPrefs$1_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetUserPrefs$1'), Lorg_waveprotocol_wave_model_supplement_ObservableSupplementedWave$ListenerImpl_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'ObservableSupplementedWave$ListenerImpl'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$ElementChangeTask_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$ElementChangeTask'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$ElementChangeTask$1_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$ElementChangeTask$1'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$BlipEditingIndicator_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$BlipEditingIndicator'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$1_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$1'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$2_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$2'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$3_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$3'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$4_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$4'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$5_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$5'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$6_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$6'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$7_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$7'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$8_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$8'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$9_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$9'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$10_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$10'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$11_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$11'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$12_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$12'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$13_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$13'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$14_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$14'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$15_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$15'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$16_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$16'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$17_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$17'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$18_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$18'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$19_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$19'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$19$1_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$19$1'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$20_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$20'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$21_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$21'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$22_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$22'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidget$23_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidget$23'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidgetUi_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidgetUi'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidgetUi$GadgetIFrame_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidgetUi$GadgetIFrame'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidgetUi$ThrobberState_2_classLit = createForEnum('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidgetUi$ThrobberState', Ljava_lang_Enum_2_classLit, values_39, valueOf_45), _3Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidgetUi$ThrobberState_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidgetUi$ThrobberState;', Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidgetUi$ThrobberState_2_classLit), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidgetUi$1_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidgetUi$1'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidgetUi$2_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidgetUi$2'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidgetUi$3_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidgetUi$3'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidgetUi$4_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidgetUi$4'), Lorg_waveprotocol_wave_client_widget_generic_ElementPanel_2_classLit = createForClass('org.waveprotocol.wave.client.widget.generic.', 'ElementPanel'), Lorg_waveprotocol_wave_client_widget_common_ClickableDivPanel_2_classLit = createForClass('org.waveprotocol.wave.client.widget.common.', 'ClickableDivPanel'), Lorg_waveprotocol_wave_client_gadget_renderer_GadgetWidgetUi_1Resources_1safari_1en_1InlineClientBundleGenerator_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'GadgetWidgetUi_Resources_safari_en_InlineClientBundleGenerator'), Lorg_waveprotocol_wave_client_gadget_renderer_SessionLocale_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'SessionLocale'), Lorg_waveprotocol_wave_client_gadget_renderer_Submitter_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'Submitter'), Lorg_waveprotocol_wave_client_gadget_renderer_Submitter$1_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'Submitter$1'), Lorg_waveprotocol_wave_model_conversation_ConversationListenerImpl_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'ConversationListenerImpl'), Lorg_waveprotocol_wave_client_gadget_renderer_WaveletListenerAdapter_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.renderer.', 'WaveletListenerAdapter'), Lorg_waveprotocol_wave_client_gadget_Gadget$1_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.', 'Gadget$1'), Lorg_waveprotocol_wave_client_gadget_StateMap$KeyValueComparator_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.', 'StateMap$KeyValueComparator'), Lorg_waveprotocol_wave_client_gadget_StateMap$1_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.', 'StateMap$1'), Lorg_waveprotocol_wave_client_gadget_StateMap$5_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.', 'StateMap$5'), Lorg_waveprotocol_wave_client_gadget_StateMap$6_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.', 'StateMap$6'), Lorg_waveprotocol_wave_client_gadget_StateMap$7_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.', 'StateMap$7'), Lorg_waveprotocol_wave_client_gadget_StateMap$8_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.', 'StateMap$8'), Lorg_waveprotocol_wave_client_gadget_StateMap$9_2_classLit = createForClass('org.waveprotocol.wave.client.gadget.', 'StateMap$9'), Lorg_waveprotocol_wave_client_scheduler_FinalTaskRunnerImpl$1_2_classLit = createForClass('org.waveprotocol.wave.client.scheduler.', 'FinalTaskRunnerImpl$1'), Lorg_waveprotocol_wave_client_scheduler_QueueProcessor_2_classLit = createForClass('org.waveprotocol.wave.client.scheduler.', 'QueueProcessor'), Lorg_waveprotocol_wave_client_state_ThreadReadStateMonitorImpl_2_classLit = createForClass('org.waveprotocol.wave.client.state.', 'ThreadReadStateMonitorImpl'), Lorg_waveprotocol_wave_client_state_ThreadReadStateMonitorImpl$ReadStateBucket_2_classLit = createForClass('org.waveprotocol.wave.client.state.', 'ThreadReadStateMonitorImpl$ReadStateBucket'), Lorg_waveprotocol_wave_client_state_ThreadReadStateMonitorImpl$ReadStateBucket$1_2_classLit = createForClass('org.waveprotocol.wave.client.state.', 'ThreadReadStateMonitorImpl$ReadStateBucket$1'), Lorg_waveprotocol_wave_client_state_ThreadReadStateMonitorImpl$ReadStateBucket$2_2_classLit = createForClass('org.waveprotocol.wave.client.state.', 'ThreadReadStateMonitorImpl$ReadStateBucket$2'), Lorg_waveprotocol_wave_client_state_ThreadReadStateMonitorImpl$ReadStateBucket$3_2_classLit = createForClass('org.waveprotocol.wave.client.state.', 'ThreadReadStateMonitorImpl$ReadStateBucket$3'), Lorg_waveprotocol_wave_client_state_ThreadReadStateMonitorImpl$ThreadReadState_2_classLit = createForClass('org.waveprotocol.wave.client.state.', 'ThreadReadStateMonitorImpl$ThreadReadState'), Lorg_waveprotocol_wave_client_state_ThreadReadStateMonitorImpl$1_2_classLit = createForClass('org.waveprotocol.wave.client.state.', 'ThreadReadStateMonitorImpl$1'), Lorg_waveprotocol_wave_client_state_ThreadReadStateMonitorImpl$2_2_classLit = createForClass('org.waveprotocol.wave.client.state.', 'ThreadReadStateMonitorImpl$2'), Lorg_waveprotocol_wave_client_uibuilder_BuilderHelper$1_2_classLit = createForClass('org.waveprotocol.wave.client.uibuilder.', 'BuilderHelper$1'), Lorg_waveprotocol_wave_client_uibuilder_HtmlClosure$1_2_classLit = createForClass('org.waveprotocol.wave.client.uibuilder.', 'HtmlClosure$1'), Lorg_waveprotocol_wave_client_uibuilder_HtmlClosureCollection_2_classLit = createForClass('org.waveprotocol.wave.client.uibuilder.', 'HtmlClosureCollection'), Lorg_waveprotocol_wave_client_uibuilder_UiBuilder$Constant$1_2_classLit = createForClass('org.waveprotocol.wave.client.uibuilder.', 'UiBuilder$Constant$1'), Lorg_waveprotocol_wave_client_uibuilder_UiBuilder$1_2_classLit = createForClass('org.waveprotocol.wave.client.uibuilder.', 'UiBuilder$1'), Lorg_waveprotocol_wave_client_wave_DiffContentDocument_2_classLit = createForClass('org.waveprotocol.wave.client.wave.', 'DiffContentDocument'), Lorg_waveprotocol_wave_model_document_util_MutableDocumentProxy_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'MutableDocumentProxy'), Lorg_waveprotocol_wave_client_wave_LazyContentDocument_2_classLit = createForClass('org.waveprotocol.wave.client.wave.', 'LazyContentDocument'), Lorg_waveprotocol_wave_model_supplement_SupplementedWaveWrapper_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'SupplementedWaveWrapper'), Lorg_waveprotocol_wave_client_wave_LocalSupplementedWaveImpl_2_classLit = createForClass('org.waveprotocol.wave.client.wave.', 'LocalSupplementedWaveImpl'), Lorg_waveprotocol_wave_model_wave_opbased_WaveletListenerImpl_2_classLit = createForClass('org.waveprotocol.wave.model.wave.opbased.', 'WaveletListenerImpl'), Lorg_waveprotocol_wave_client_wave_LocalSupplementedWaveImpl$1_2_classLit = createForClass('org.waveprotocol.wave.client.wave.', 'LocalSupplementedWaveImpl$1'), Lorg_waveprotocol_wave_client_wave_LocalSupplementedWaveImpl$2_2_classLit = createForClass('org.waveprotocol.wave.client.wave.', 'LocalSupplementedWaveImpl$2'), Lorg_waveprotocol_wave_client_wave_LocalSupplementedWaveImpl$3_2_classLit = createForClass('org.waveprotocol.wave.client.wave.', 'LocalSupplementedWaveImpl$3'), Lorg_waveprotocol_wave_client_wave_SimpleDiffDoc_2_classLit = createForClass('org.waveprotocol.wave.client.wave.', 'SimpleDiffDoc'), Lorg_waveprotocol_wave_client_wave_WaveDocuments_2_classLit = createForClass('org.waveprotocol.wave.client.wave.', 'WaveDocuments'), Lorg_waveprotocol_wave_client_wavepanel_impl_diff_DiffController_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.impl.diff.', 'DiffController'), Lorg_waveprotocol_wave_client_wavepanel_impl_diff_DiffController$1_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.impl.diff.', 'DiffController$1'), Lorg_waveprotocol_wave_client_wavepanel_impl_diff_DiffController$2_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.impl.diff.', 'DiffController$2'), Lorg_waveprotocol_wave_client_wavepanel_impl_diff_DiffController$3_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.impl.diff.', 'DiffController$3'), Lorg_waveprotocol_wave_model_wave_ParticipantId_2_classLit = createForClass('org.waveprotocol.wave.model.wave.', 'ParticipantId'), _3Lorg_waveprotocol_wave_model_wave_ParticipantId_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.wave.', 'ParticipantId;', Lorg_waveprotocol_wave_model_wave_ParticipantId_2_classLit), Lorg_waveprotocol_wave_client_wavepanel_render_BlipPager_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'BlipPager'), Lorg_waveprotocol_wave_client_wavepanel_render_BlipPager$1_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'BlipPager$1'), Lorg_waveprotocol_wave_client_wavepanel_render_DocumentRegistries_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'DocumentRegistries'), Lorg_waveprotocol_wave_client_wavepanel_render_DocumentRegistries$Builder_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'DocumentRegistries$Builder'), Lorg_waveprotocol_wave_client_wavepanel_render_DocumentRegistries$ConversationRegistries_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'DocumentRegistries$ConversationRegistries'), Lorg_waveprotocol_wave_client_wavepanel_render_FullDomRenderer$2_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'FullDomRenderer$2'), Lorg_waveprotocol_wave_client_wavepanel_render_FullDomRenderer$3_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'FullDomRenderer$3'), Lorg_waveprotocol_wave_client_wavepanel_render_FullDomRenderer$4_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'FullDomRenderer$4'), Lorg_waveprotocol_wave_client_wavepanel_render_FullDomRenderer$4$1_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'FullDomRenderer$4$1'), Lorg_waveprotocol_wave_client_wavepanel_render_FullDomRenderer$4$2_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'FullDomRenderer$4$2'), Lorg_waveprotocol_wave_client_wavepanel_render_InlineAnchorLiveRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'InlineAnchorLiveRenderer'), Lorg_waveprotocol_wave_client_wavepanel_render_InlineAnchorLiveRenderer$ReplyDoodad_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'InlineAnchorLiveRenderer$ReplyDoodad'), Lorg_waveprotocol_wave_client_wavepanel_render_InlineAnchorLiveRenderer$CanonicalAnchorFinder_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'InlineAnchorLiveRenderer$CanonicalAnchorFinder'), Lorg_waveprotocol_wave_client_wavepanel_render_InlineAnchorLiveRenderer$1_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'InlineAnchorLiveRenderer$1'), Lorg_waveprotocol_wave_client_wavepanel_render_InlineAnchorLiveRenderer$2_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'InlineAnchorLiveRenderer$2'), Lorg_waveprotocol_wave_client_wavepanel_render_LiveConversationViewRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'LiveConversationViewRenderer'), Lorg_waveprotocol_wave_client_wavepanel_render_LiveConversationViewRenderer$LiveConversationRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'LiveConversationViewRenderer$LiveConversationRenderer'), Lorg_waveprotocol_wave_client_wavepanel_render_LiveProfileRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'LiveProfileRenderer'), Lorg_waveprotocol_wave_client_wavepanel_render_LiveProfileRenderer$1_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'LiveProfileRenderer$1'), Lorg_waveprotocol_wave_client_wavepanel_render_LiveSupplementRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'LiveSupplementRenderer'), Lorg_waveprotocol_wave_client_wavepanel_render_LiveSupplementRenderer$1_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'LiveSupplementRenderer$1'), Lorg_waveprotocol_wave_client_wavepanel_render_PagingHandlerProxy_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'PagingHandlerProxy'), Lorg_waveprotocol_wave_client_wavepanel_render_ReplyManager_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'ReplyManager'), Lorg_waveprotocol_wave_client_wavepanel_render_UndercurrentShallowBlipRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.render.', 'UndercurrentShallowBlipRenderer'), Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_AnchorViewBuilder_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.view.dom.full.', 'AnchorViewBuilder'), Lorg_waveprotocol_wave_client_wavepanel_view_IntrinsicBlipMetaView$MenuOption_2_classLit = createForEnum('org.waveprotocol.wave.client.wavepanel.view.', 'IntrinsicBlipMetaView$MenuOption', Ljava_lang_Enum_2_classLit, values_44, valueOf_50), _3Lorg_waveprotocol_wave_client_wavepanel_view_IntrinsicBlipMetaView$MenuOption_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.wavepanel.view.', 'IntrinsicBlipMetaView$MenuOption;', Lorg_waveprotocol_wave_client_wavepanel_view_IntrinsicBlipMetaView$MenuOption_2_classLit), Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_BlipMetaViewBuilder_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.view.dom.full.', 'BlipMetaViewBuilder'), Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_BlipMetaViewBuilder$1_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.view.dom.full.', 'BlipMetaViewBuilder$1'), Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_BlipQueueRenderer_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.view.dom.full.', 'BlipQueueRenderer'), Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_BlipViewBuilder_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.view.dom.full.', 'BlipViewBuilder'), Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_CollapsibleBuilder_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.view.dom.full.', 'CollapsibleBuilder'), Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_ContinuationIndicatorViewBuilder_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.view.dom.full.', 'ContinuationIndicatorViewBuilder'), Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_TopConversationViewBuilder_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.view.dom.full.', 'TopConversationViewBuilder'), Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_FixedConversationViewBuilder_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.view.dom.full.', 'FixedConversationViewBuilder'), Lorg_waveprotocol_wave_client_uibuilder_UiBuilder_2_classLit = createForInterface('org.waveprotocol.wave.client.uibuilder.', 'UiBuilder'), _3Lorg_waveprotocol_wave_client_uibuilder_UiBuilder_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.uibuilder.', 'UiBuilder;', Lorg_waveprotocol_wave_client_uibuilder_UiBuilder_2_classLit), Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_InlineConversationViewBuilder_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.view.dom.full.', 'InlineConversationViewBuilder'), Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_InlineThreadViewBuilder_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.view.dom.full.', 'InlineThreadViewBuilder'), Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_InlineThreadViewBuilder$InlineThreadStructure_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.view.dom.full.', 'InlineThreadViewBuilder$InlineThreadStructure'), Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_ParticipantNameViewBuilder_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.view.dom.full.', 'ParticipantNameViewBuilder'), Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_ParticipantsViewBuilder_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.view.dom.full.', 'ParticipantsViewBuilder'), Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_ParticipantsViewBuilder$Components_2_classLit = createForEnum('org.waveprotocol.wave.client.wavepanel.view.dom.full.', 'ParticipantsViewBuilder$Components', Ljava_lang_Enum_2_classLit, values_49, valueOf_55), _3Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_ParticipantsViewBuilder$Components_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.wavepanel.view.dom.full.', 'ParticipantsViewBuilder$Components;', Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_ParticipantsViewBuilder$Components_2_classLit), Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_ReplyBoxViewBuilder_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.view.dom.full.', 'ReplyBoxViewBuilder'), Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_ReplyBoxViewBuilder$Components_2_classLit = createForEnum('org.waveprotocol.wave.client.wavepanel.view.dom.full.', 'ReplyBoxViewBuilder$Components', Ljava_lang_Enum_2_classLit, values_50, valueOf_56), _3Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_ReplyBoxViewBuilder$Components_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.wavepanel.view.dom.full.', 'ReplyBoxViewBuilder$Components;', Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_ReplyBoxViewBuilder$Components_2_classLit), Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_RootThreadViewBuilder_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.view.dom.full.', 'RootThreadViewBuilder'), Lorg_waveprotocol_wave_client_wavepanel_view_dom_ModelAsViewProviderImpl_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.view.dom.', 'ModelAsViewProviderImpl'), Lorg_waveprotocol_wave_client_wavepanel_view_ModelIdMapperImpl_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.view.', 'ModelIdMapperImpl'), Lorg_waveprotocol_wave_client_wavepanel_view_ViewIdMapper_2_classLit = createForClass('org.waveprotocol.wave.client.wavepanel.view.', 'ViewIdMapper'), Lorg_waveprotocol_wave_client_widget_common_Button_2_classLit = createForClass('org.waveprotocol.wave.client.widget.common.', 'Button'), Lorg_waveprotocol_wave_client_widget_common_ButtonSwitch_2_classLit = createForClass('org.waveprotocol.wave.client.widget.common.', 'ButtonSwitch'), Lorg_waveprotocol_wave_client_widget_common_HoverHelper_2_classLit = createForClass('org.waveprotocol.wave.client.widget.common.', 'HoverHelper'), Lorg_waveprotocol_wave_client_widget_common_HoverHelper$1_2_classLit = createForClass('org.waveprotocol.wave.client.widget.common.', 'HoverHelper$1'), Lorg_waveprotocol_wave_client_widget_common_HoverHelper$2_2_classLit = createForClass('org.waveprotocol.wave.client.widget.common.', 'HoverHelper$2'), Lorg_waveprotocol_wave_client_widget_menu_MenuButton_2_classLit = createForClass('org.waveprotocol.wave.client.widget.menu.', 'MenuButton'), Lorg_waveprotocol_wave_client_widget_menu_MenuButton$1_2_classLit = createForClass('org.waveprotocol.wave.client.widget.menu.', 'MenuButton$1'), Lorg_waveprotocol_wave_client_widget_menu_MenuButton$2_2_classLit = createForClass('org.waveprotocol.wave.client.widget.menu.', 'MenuButton$2'), Lorg_waveprotocol_wave_client_widget_menu_PopupMenu_2_classLit = createForClass('org.waveprotocol.wave.client.widget.menu.', 'PopupMenu'), Lorg_waveprotocol_wave_client_widget_menu_PopupMenu$PopupMenuItem_2_classLit = createForClass('org.waveprotocol.wave.client.widget.menu.', 'PopupMenu$PopupMenuItem'), Lorg_waveprotocol_wave_client_widget_menu_PopupMenu$PopupMenuItem$1_2_classLit = createForClass('org.waveprotocol.wave.client.widget.menu.', 'PopupMenu$PopupMenuItem$1'), Lorg_waveprotocol_wave_client_widget_menu_PopupMenu$PopupMenuItem$2_2_classLit = createForClass('org.waveprotocol.wave.client.widget.menu.', 'PopupMenu$PopupMenuItem$2'), Lorg_waveprotocol_wave_client_widget_menu_PopupMenu$1_2_classLit = createForClass('org.waveprotocol.wave.client.widget.menu.', 'PopupMenu$1'), Lorg_waveprotocol_wave_client_widget_popup_desktopchrome_DesktopPopupChrome_2_classLit = createForClass('org.waveprotocol.wave.client.widget.popup.desktopchrome.', 'DesktopPopupChrome'), Lorg_waveprotocol_wave_client_widget_popup_desktopchrome_DesktopPopupChromeProvider_2_classLit = createForClass('org.waveprotocol.wave.client.widget.popup.desktopchrome.', 'DesktopPopupChromeProvider'), Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner_2_classLit = createForClass('org.waveprotocol.wave.client.widget.popup.', 'AlignedPopupPositioner'), Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Insets_2_classLit = createForClass('org.waveprotocol.wave.client.widget.popup.', 'AlignedPopupPositioner$Insets'), Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Horizontal_2_classLit = createForEnum('org.waveprotocol.wave.client.widget.popup.', 'AlignedPopupPositioner$Horizontal', Ljava_lang_Enum_2_classLit, values_53, valueOf_59), _3Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Horizontal_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.widget.popup.', 'AlignedPopupPositioner$Horizontal;', Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Horizontal_2_classLit), Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Horizontal$1_2_classLit = createForEnum('org.waveprotocol.wave.client.widget.popup.', 'AlignedPopupPositioner$Horizontal$1', Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Horizontal_2_classLit, null, null), Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Horizontal$2_2_classLit = createForEnum('org.waveprotocol.wave.client.widget.popup.', 'AlignedPopupPositioner$Horizontal$2', Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Horizontal_2_classLit, null, null), Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Vertical_2_classLit = createForEnum('org.waveprotocol.wave.client.widget.popup.', 'AlignedPopupPositioner$Vertical', Ljava_lang_Enum_2_classLit, values_54, valueOf_60), _3Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Vertical_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.widget.popup.', 'AlignedPopupPositioner$Vertical;', Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Vertical_2_classLit), Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Vertical$1_2_classLit = createForEnum('org.waveprotocol.wave.client.widget.popup.', 'AlignedPopupPositioner$Vertical$1', Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Vertical_2_classLit, null, null), Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Vertical$2_2_classLit = createForEnum('org.waveprotocol.wave.client.widget.popup.', 'AlignedPopupPositioner$Vertical$2', Lorg_waveprotocol_wave_client_widget_popup_AlignedPopupPositioner$Vertical_2_classLit, null, null), Lorg_waveprotocol_wave_client_widget_popup_DesktopPopupProvider_2_classLit = createForClass('org.waveprotocol.wave.client.widget.popup.', 'DesktopPopupProvider'), Lorg_waveprotocol_wave_client_widget_popup_DesktopUniversalPopup_2_classLit = createForClass('org.waveprotocol.wave.client.widget.popup.', 'DesktopUniversalPopup'), Lorg_waveprotocol_wave_client_widget_popup_DesktopUniversalPopup$1_2_classLit = createForClass('org.waveprotocol.wave.client.widget.popup.', 'DesktopUniversalPopup$1'), Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_BlipQueueRenderer$PagingHandler_2_classLit = createForInterface('org.waveprotocol.wave.client.wavepanel.view.dom.full.', 'BlipQueueRenderer$PagingHandler'), _3Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_BlipQueueRenderer$PagingHandler_2_classLit = createForArray('[Lorg.waveprotocol.wave.client.wavepanel.view.dom.full.', 'BlipQueueRenderer$PagingHandler;', Lorg_waveprotocol_wave_client_wavepanel_view_dom_full_BlipQueueRenderer$PagingHandler_2_classLit), Lorg_waveprotocol_wave_client_StageTwo$DefaultProvider$4_2_classLit = createForClass('org.waveprotocol.wave.client.', 'StageTwo$DefaultProvider$4'), Lorg_waveprotocol_wave_client_StageTwo$DefaultProvider$5_2_classLit = createForClass('org.waveprotocol.wave.client.', 'StageTwo$DefaultProvider$5'), Lorg_waveprotocol_wave_client_StageTwo$DefaultProvider$6_2_classLit = createForClass('org.waveprotocol.wave.client.', 'StageTwo$DefaultProvider$6'), Lorg_waveprotocol_wave_client_StageTwo$DefaultProvider$10_2_classLit = createForClass('org.waveprotocol.wave.client.', 'StageTwo$DefaultProvider$10'), Lorg_waveprotocol_wave_common_logging_AbstractLogger$Level_2_classLit = createForEnum('org.waveprotocol.wave.common.logging.', 'AbstractLogger$Level', Ljava_lang_Enum_2_classLit, values_56, valueOf_62), _3Lorg_waveprotocol_wave_common_logging_AbstractLogger$Level_2_classLit = createForArray('[Lorg.waveprotocol.wave.common.logging.', 'AbstractLogger$Level;', Lorg_waveprotocol_wave_common_logging_AbstractLogger$Level_2_classLit), Lorg_waveprotocol_wave_common_logging_AbstractLogger$LevelLogger_2_classLit = createForClass('org.waveprotocol.wave.common.logging.', 'AbstractLogger$LevelLogger'), Lorg_waveprotocol_wave_common_logging_CircularBuffer_2_classLit = createForClass('org.waveprotocol.wave.common.logging.', 'CircularBuffer'), Lorg_waveprotocol_wave_common_logging_InMemoryLogSink_2_classLit = createForClass('org.waveprotocol.wave.common.logging.', 'InMemoryLogSink'), Lorg_waveprotocol_wave_common_logging_LogSink$1_2_classLit = createForClass('org.waveprotocol.wave.common.logging.', 'LogSink$1'), Lorg_waveprotocol_wave_model_adt_docbased_AbstractDocumentBasedMap_2_classLit = createForClass('org.waveprotocol.wave.model.adt.docbased.', 'AbstractDocumentBasedMap'), Lorg_waveprotocol_wave_model_adt_docbased_CompoundInitializer_2_classLit = createForClass('org.waveprotocol.wave.model.adt.docbased.', 'CompoundInitializer'), Lorg_waveprotocol_wave_model_adt_docbased_DocumentBasedBasicMap_2_classLit = createForClass('org.waveprotocol.wave.model.adt.docbased.', 'DocumentBasedBasicMap'), Lorg_waveprotocol_wave_model_adt_AbstractObservableBasicSet_2_classLit = createForClass('org.waveprotocol.wave.model.adt.', 'AbstractObservableBasicSet'), Lorg_waveprotocol_wave_model_adt_docbased_DocumentBasedBasicSet_2_classLit = createForClass('org.waveprotocol.wave.model.adt.docbased.', 'DocumentBasedBasicSet'), Lorg_waveprotocol_wave_model_adt_docbased_DocumentBasedBasicSet$1_2_classLit = createForClass('org.waveprotocol.wave.model.adt.docbased.', 'DocumentBasedBasicSet$1'), Lorg_waveprotocol_wave_model_adt_docbased_DocumentBasedBasicValue_2_classLit = createForClass('org.waveprotocol.wave.model.adt.docbased.', 'DocumentBasedBasicValue'), Lorg_waveprotocol_wave_model_adt_docbased_DocumentBasedBasicValue$1_2_classLit = createForClass('org.waveprotocol.wave.model.adt.docbased.', 'DocumentBasedBasicValue$1'), Lorg_waveprotocol_wave_model_adt_docbased_DocumentBasedBoolean_2_classLit = createForClass('org.waveprotocol.wave.model.adt.docbased.', 'DocumentBasedBoolean'), Lorg_waveprotocol_wave_model_adt_docbased_DocumentBasedElementList_2_classLit = createForClass('org.waveprotocol.wave.model.adt.docbased.', 'DocumentBasedElementList'), Lorg_waveprotocol_wave_model_adt_docbased_DocumentBasedMonotonicMap_2_classLit = createForClass('org.waveprotocol.wave.model.adt.docbased.', 'DocumentBasedMonotonicMap'), Lorg_waveprotocol_wave_model_adt_docbased_DocumentBasedMonotonicValue_2_classLit = createForClass('org.waveprotocol.wave.model.adt.docbased.', 'DocumentBasedMonotonicValue'), Lorg_waveprotocol_wave_model_adt_docbased_DocumentBasedSingleton_2_classLit = createForClass('org.waveprotocol.wave.model.adt.docbased.', 'DocumentBasedSingleton'), Lorg_waveprotocol_wave_model_adt_docbased_DocumentBasedStructuredValue_2_classLit = createForClass('org.waveprotocol.wave.model.adt.docbased.', 'DocumentBasedStructuredValue'), Lorg_waveprotocol_wave_model_conversation_AnchorData_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'AnchorData'), Lorg_waveprotocol_wave_model_conversation_BlipMappers$Exit_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'BlipMappers$Exit'), Lorg_waveprotocol_wave_model_conversation_BlipMappers$DepthFirst_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'BlipMappers$DepthFirst'), Lorg_waveprotocol_wave_model_conversation_Conversation$Anchor_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'Conversation$Anchor'), Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifest$AnchorKey_2_classLit = createForEnum('org.waveprotocol.wave.model.conversation.', 'DocumentBasedManifest$AnchorKey', Ljava_lang_Enum_2_classLit, values_57, valueOf_63), Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifest_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'DocumentBasedManifest'), _3Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifest$AnchorKey_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.conversation.', 'DocumentBasedManifest$AnchorKey;', Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifest$AnchorKey_2_classLit), Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifest$AnchorKey$1_2_classLit = createForEnum('org.waveprotocol.wave.model.conversation.', 'DocumentBasedManifest$AnchorKey$1', Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifest$AnchorKey_2_classLit, null, null), Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifest$AnchorKey$2_2_classLit = createForEnum('org.waveprotocol.wave.model.conversation.', 'DocumentBasedManifest$AnchorKey$2', Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifest$AnchorKey_2_classLit, null, null), Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifest$1_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'DocumentBasedManifest$1'), Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifest$1$1_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'DocumentBasedManifest$1$1'), Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifest$2_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'DocumentBasedManifest$2'), Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifestBlip_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'DocumentBasedManifestBlip'), Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifestBlip$ThreadInitialiser_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'DocumentBasedManifestBlip$ThreadInitialiser'), Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifestBlip$1_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'DocumentBasedManifestBlip$1'), Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifestBlip$2_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'DocumentBasedManifestBlip$2'), Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifestThread_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'DocumentBasedManifestThread'), Lorg_waveprotocol_wave_model_adt_docbased_Initializer_2_classLit = createForInterface('org.waveprotocol.wave.model.adt.docbased.', 'Initializer'), _3Lorg_waveprotocol_wave_model_adt_docbased_Initializer_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.adt.docbased.', 'Initializer;', Lorg_waveprotocol_wave_model_adt_docbased_Initializer_2_classLit), Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifestThread$1_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'DocumentBasedManifestThread$1'), Lorg_waveprotocol_wave_model_conversation_DocumentBasedManifestThread$2_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'DocumentBasedManifestThread$2'), Lorg_waveprotocol_wave_model_conversation_WaveBasedConversationView_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'WaveBasedConversationView'), Lorg_waveprotocol_wave_model_conversation_WaveBasedConversationView$ConversationContainer_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'WaveBasedConversationView$ConversationContainer'), Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversation_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'WaveletBasedConversation'), Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversation$ComponentHelper_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'WaveletBasedConversation$ComponentHelper'), Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversation$ThreadListenerAggregator_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'WaveletBasedConversation$ThreadListenerAggregator'), Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversation$BlipListenerAggregator_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'WaveletBasedConversation$BlipListenerAggregator'), Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversation$1_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'WaveletBasedConversation$1'), Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversation$2_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'WaveletBasedConversation$2'), Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversationBlip_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'WaveletBasedConversationBlip'), Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversationBlip$1_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'WaveletBasedConversationBlip$1'), Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversationBlip$2_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'WaveletBasedConversationBlip$2'), Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversationBlip$4_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'WaveletBasedConversationBlip$4'), Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversationThread_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'WaveletBasedConversationThread'), Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversationThread$1_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'WaveletBasedConversationThread$1'), Lorg_waveprotocol_wave_model_conversation_WaveletBasedConversationThread$2_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'WaveletBasedConversationThread$2'), Lorg_waveprotocol_wave_model_conversation_WrapperIterator_2_classLit = createForClass('org.waveprotocol.wave.model.conversation.', 'WrapperIterator'), Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree$Notification_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'AnnotationTree$Notification'), Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree$OpenAnnotation_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'AnnotationTree$OpenAnnotation'), Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'AnnotationTree$1'), Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'AnnotationTree$2'), Lorg_waveprotocol_wave_model_document_indexed_AnnotationTree$3_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'AnnotationTree$3'), Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'BasicAnnotationTree'), Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$NodeType_2_classLit = createForEnum('org.waveprotocol.wave.model.document.indexed.', 'BasicAnnotationTree$NodeType', Ljava_lang_Enum_2_classLit, values_63, valueOf_69), _3Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$NodeType_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.indexed.', 'BasicAnnotationTree$NodeType;', Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$NodeType_2_classLit), Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$Node_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'BasicAnnotationTree$Node'), Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$Node$3_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'BasicAnnotationTree$Node$3'), Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'BasicAnnotationTree$1'), Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'BasicAnnotationTree$2'), Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$3_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'BasicAnnotationTree$3'), Lorg_waveprotocol_wave_model_document_indexed_BasicAnnotationTree$6_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'BasicAnnotationTree$6'), Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'DocumentEvent'), Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$Type_2_classLit = createForEnum('org.waveprotocol.wave.model.document.indexed.', 'DocumentEvent$Type', Ljava_lang_Enum_2_classLit, values_65, valueOf_71), _3Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$Type_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.indexed.', 'DocumentEvent$Type;', Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$Type_2_classLit), Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$AttributesModified_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'DocumentEvent$AttributesModified'), Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$TextInserted_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'DocumentEvent$TextInserted'), Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$ContentInserted_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'DocumentEvent$ContentInserted'), Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$TextDeleted_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'DocumentEvent$TextDeleted'), Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$ContentDeleted_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'DocumentEvent$ContentDeleted'), Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$ContentDeleted$TokenType_2_classLit = createForEnum('org.waveprotocol.wave.model.document.indexed.', 'DocumentEvent$ContentDeleted$TokenType', Ljava_lang_Enum_2_classLit, values_64, valueOf_70), _3Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$ContentDeleted$TokenType_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.indexed.', 'DocumentEvent$ContentDeleted$TokenType;', Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$ContentDeleted$TokenType_2_classLit), Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$ContentDeleted$Token_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'DocumentEvent$ContentDeleted$Token'), Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$ContentDeleted$Builder_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'DocumentEvent$ContentDeleted$Builder'), Lorg_waveprotocol_wave_model_document_indexed_DocumentEvent$AnnotationChanged_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'DocumentEvent$AnnotationChanged'), Lorg_waveprotocol_wave_model_document_indexed_EventBundleImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'EventBundleImpl'), Lorg_waveprotocol_wave_model_document_indexed_EventBundleImpl$Builder_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'EventBundleImpl$Builder'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$InvertibleCursor_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$InvertibleCursor'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$NonInvertibleCursor'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$NonInvertibleCursor$1'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$NonInvertibleCursor$2'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$3_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$NonInvertibleCursor$3'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$4_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$NonInvertibleCursor$4'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$5_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$NonInvertibleCursor$5'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$6_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$NonInvertibleCursor$6'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$7_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$NonInvertibleCursor$7'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$8_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$NonInvertibleCursor$8'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$NonInvertibleCursor$9_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$NonInvertibleCursor$9'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$1'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$2'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$3_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$3'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$4_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$4'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$5_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$5'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$6_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$6'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$7_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$7'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$8_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$8'), Lorg_waveprotocol_wave_model_document_indexed_IndexedDocumentImpl$8$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'IndexedDocumentImpl$8$1'), Lorg_waveprotocol_wave_model_document_indexed_ObservableIndexedDocument_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'ObservableIndexedDocument'), Lorg_waveprotocol_wave_model_document_indexed_ObservableIndexedDocument$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'ObservableIndexedDocument$1'), Lorg_waveprotocol_wave_model_document_indexed_RawAnnotationSet$AnnotationEvent_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'RawAnnotationSet$AnnotationEvent'), Lorg_waveprotocol_wave_model_document_indexed_RawAnnotationSet$AnnotationStartEvent_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'RawAnnotationSet$AnnotationStartEvent'), Lorg_waveprotocol_wave_model_document_indexed_RawAnnotationSet$AnnotationEndEvent_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'RawAnnotationSet$AnnotationEndEvent'), Lorg_waveprotocol_wave_model_document_indexed_StubModifiableAnnotations_2_classLit = createForClass('org.waveprotocol.wave.model.document.indexed.', 'StubModifiableAnnotations'), Lorg_waveprotocol_wave_model_document_operation_algorithm_AnnotationsNormalizer_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'AnnotationsNormalizer'), Lorg_waveprotocol_wave_model_document_operation_algorithm_AnnotationsNormalizer$AnnotationChange_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'AnnotationsNormalizer$AnnotationChange'), Lorg_waveprotocol_wave_model_document_operation_algorithm_AnnotationsNormalizer$AnnotationChangeValues_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'AnnotationsNormalizer$AnnotationChangeValues'), Lorg_waveprotocol_wave_model_document_operation_algorithm_AnnotationsNormalizer$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'AnnotationsNormalizer$1'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$AnnotationQueue_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$AnnotationQueue'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$ComposeException_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$ComposeException'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$Target_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$Target'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$PreTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$PreTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$PostTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$PostTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$DefaultPreTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$DefaultPreTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$RetainPreTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$RetainPreTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$DeleteCharactersPreTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$DeleteCharactersPreTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$RetainPostTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$RetainPostTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$CharactersPostTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$CharactersPostTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$ElementStartPostTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$ElementStartPostTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$ElementEndPostTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$ElementEndPostTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$ReplaceAttributesPostTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$ReplaceAttributesPostTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$UpdateAttributesPostTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$UpdateAttributesPostTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$FinisherPostTarget_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$FinisherPostTarget'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$1'), Lorg_waveprotocol_wave_model_document_operation_algorithm_Composer$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'Composer$2'), Lorg_waveprotocol_wave_model_document_operation_algorithm_DocOpCollector_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'DocOpCollector'), Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'RangeNormalizer'), Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer$Cache_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'RangeNormalizer$Cache'), Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'RangeNormalizer$1'), Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'RangeNormalizer$2'), Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer$3_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'RangeNormalizer$3'), Lorg_waveprotocol_wave_model_document_operation_algorithm_RangeNormalizer$4_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'RangeNormalizer$4'), Lorg_waveprotocol_wave_model_document_operation_algorithm_ValueUpdate_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.algorithm.', 'ValueUpdate'), Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton'), Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$ValidationResult_2_classLit = createForEnum('org.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton$ValidationResult', Ljava_lang_Enum_2_classLit, values_68, valueOf_74), _3Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$ValidationResult_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton$ValidationResult;', Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$ValidationResult_2_classLit), Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$Violation_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton$Violation'), Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$OperationIllFormed_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton$OperationIllFormed'), Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$OperationInvalid_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton$OperationInvalid'), Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$SchemaViolation_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton$SchemaViolation'), Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$ViolationCollector_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton$ViolationCollector'), Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$DocSymbol_2_classLit = createForEnum('org.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton$DocSymbol', Ljava_lang_Enum_2_classLit, values_67, valueOf_73), _3Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$DocSymbol_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton$DocSymbol;', Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$DocSymbol_2_classLit), Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$InsertStart_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton$InsertStart'), Lorg_waveprotocol_wave_model_document_operation_automaton_DocOpAutomaton$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.automaton.', 'DocOpAutomaton$1'), Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters_2_classLit = createForEnum('org.waveprotocol.wave.model.document.operation.automaton.', 'DocumentSchema$PermittedCharacters', Ljava_lang_Enum_2_classLit, values_69, valueOf_75), _3Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.operation.automaton.', 'DocumentSchema$PermittedCharacters;', Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters_2_classLit), Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters$1_2_classLit = createForEnum('org.waveprotocol.wave.model.document.operation.automaton.', 'DocumentSchema$PermittedCharacters$1', Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters_2_classLit, null, null), Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters$2_2_classLit = createForEnum('org.waveprotocol.wave.model.document.operation.automaton.', 'DocumentSchema$PermittedCharacters$2', Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters_2_classLit, null, null), Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters$2$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.automaton.', 'DocumentSchema$PermittedCharacters$2$1'), Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters$3_2_classLit = createForEnum('org.waveprotocol.wave.model.document.operation.automaton.', 'DocumentSchema$PermittedCharacters$3', Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters_2_classLit, null, null), Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$PermittedCharacters$3$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.automaton.', 'DocumentSchema$PermittedCharacters$3$1'), Lorg_waveprotocol_wave_model_document_operation_automaton_DocumentSchema$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.automaton.', 'DocumentSchema$1'), Lorg_waveprotocol_wave_model_document_operation_impl_AbstractDocInitialization_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'AbstractDocInitialization'), Lorg_waveprotocol_wave_model_document_operation_impl_AbstractBufferedDocInitialization_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'AbstractBufferedDocInitialization'), Lorg_waveprotocol_wave_model_document_operation_impl_AnnotationBoundaryMapImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'AnnotationBoundaryMapImpl'), Lorg_waveprotocol_wave_model_document_operation_impl_AnnotationBoundaryMapImpl$Builder_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'AnnotationBoundaryMapImpl$Builder'), Lorg_waveprotocol_wave_model_document_operation_util_ImmutableStateMap_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.util.', 'ImmutableStateMap'), Lorg_waveprotocol_wave_model_document_operation_impl_AnnotationMapImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'AnnotationMapImpl'), Lorg_waveprotocol_wave_model_document_operation_util_ImmutableUpdateMap_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.util.', 'ImmutableUpdateMap'), Lorg_waveprotocol_wave_model_document_operation_impl_AnnotationsUpdateImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'AnnotationsUpdateImpl'), Lorg_waveprotocol_wave_model_document_operation_impl_AttributesImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'AttributesImpl'), Lorg_waveprotocol_wave_model_document_operation_impl_AttributesImpl$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'AttributesImpl$1'), Lorg_waveprotocol_wave_model_document_operation_impl_AttributesUpdateImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'AttributesUpdateImpl'), Lorg_waveprotocol_wave_model_document_operation_impl_BufferedDocOpImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'BufferedDocOpImpl'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DocOpComponent_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$DocOpComponent'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DocInitializationComponent_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$DocInitializationComponent'), _3Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DocInitializationComponent_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$DocInitializationComponent;', Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DocInitializationComponent_2_classLit), Lorg_waveprotocol_wave_model_document_operation_impl_DocInitializationBuilder_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'DocInitializationBuilder'), Lorg_waveprotocol_wave_model_document_operation_impl_UncheckedDocOpBuffer_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'UncheckedDocOpBuffer'), Lorg_waveprotocol_wave_model_document_operation_impl_DocOpBuffer_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'DocOpBuffer'), _3Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DocOpComponent_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$DocOpComponent;', Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DocOpComponent_2_classLit), Lorg_waveprotocol_wave_model_document_operation_impl_DocOpBuilder_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'DocOpBuilder'), Lorg_waveprotocol_wave_model_document_operation_impl_DocOpUtil$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'DocOpUtil$1'), Lorg_waveprotocol_wave_model_document_operation_impl_DocOpUtil$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'DocOpUtil$2'), Lorg_waveprotocol_wave_model_document_operation_impl_DocOpUtil$3_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'DocOpUtil$3'), Lorg_waveprotocol_wave_model_document_operation_impl_DocOpUtil$4_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'DocOpUtil$4'), Lorg_waveprotocol_wave_model_document_operation_impl_DocOpUtil$5_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'DocOpUtil$5'), Lorg_waveprotocol_wave_model_document_operation_impl_DocOpValidator$IllFormed_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'DocOpValidator$IllFormed'), Lorg_waveprotocol_wave_model_document_operation_impl_DocOpValidator$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'DocOpValidator$1'), Lorg_waveprotocol_wave_model_document_operation_impl_InitializationCursorAdapter_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'InitializationCursorAdapter'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$AnnotationBoundary_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$AnnotationBoundary'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$Characters_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$Characters'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$ElementStart_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$ElementStart'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$ElementEnd_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$ElementEnd'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$Retain_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$Retain'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DeleteCharacters_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$DeleteCharacters'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DeleteElementStart_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$DeleteElementStart'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$DeleteElementEnd_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$DeleteElementEnd'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$ReplaceAttributes_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$ReplaceAttributes'), Lorg_waveprotocol_wave_model_document_operation_impl_OperationComponents$UpdateAttributes_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.impl.', 'OperationComponents$UpdateAttributes'), Lorg_waveprotocol_wave_model_document_operation_util_ImmutableStateMap$Attribute_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.util.', 'ImmutableStateMap$Attribute'), Lorg_waveprotocol_wave_model_document_operation_util_ImmutableStateMap$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.util.', 'ImmutableStateMap$1'), Lorg_waveprotocol_wave_model_document_operation_util_ImmutableStateMap$1$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.util.', 'ImmutableStateMap$1$1'), Lorg_waveprotocol_wave_model_document_operation_util_ImmutableStateMap$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.util.', 'ImmutableStateMap$2'), Lorg_waveprotocol_wave_model_document_operation_util_ImmutableUpdateMap$AttributeUpdate_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.util.', 'ImmutableUpdateMap$AttributeUpdate'), Lorg_waveprotocol_wave_model_document_operation_util_ImmutableUpdateMap$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.util.', 'ImmutableUpdateMap$1'), Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$Triplet_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'AnnotationBoundaryMapBuilder$Triplet'), _3Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$Triplet_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.operation.', 'AnnotationBoundaryMapBuilder$Triplet;', Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$Triplet_2_classLit), Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'AnnotationBoundaryMapBuilder'), Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$AnnotationBoundaryMapImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'AnnotationBoundaryMapBuilder$AnnotationBoundaryMapImpl'), Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'AnnotationBoundaryMapBuilder$1'), Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'AnnotationBoundaryMapBuilder$2'), Lorg_waveprotocol_wave_model_document_operation_AnnotationBoundaryMapBuilder$3_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'AnnotationBoundaryMapBuilder$3'), Lorg_waveprotocol_wave_model_document_operation_Automatons$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Automatons$1'), Lorg_waveprotocol_wave_model_document_operation_Automatons$1$1AnnoMap_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Automatons$1$1AnnoMap'), Lorg_waveprotocol_wave_model_document_operation_Automatons$1$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Automatons$1$1'), Lorg_waveprotocol_wave_model_document_operation_DocOpComponentType_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'DocOpComponentType'), Lorg_waveprotocol_wave_model_document_operation_DocInitializationComponentType_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'DocInitializationComponentType'), Lorg_waveprotocol_wave_model_document_operation_LocationModifier_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'LocationModifier'), Lorg_waveprotocol_wave_model_document_operation_Nindo_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo'), Lorg_waveprotocol_wave_model_document_operation_Nindo$Builder_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$Builder'), Lorg_waveprotocol_wave_model_document_operation_Nindo$MutationComponent_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$MutationComponent'), Lorg_waveprotocol_wave_model_document_operation_Nindo$Skip_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$Skip'), Lorg_waveprotocol_wave_model_document_operation_Nindo$Characters_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$Characters'), Lorg_waveprotocol_wave_model_document_operation_Nindo$ElementStart_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$ElementStart'), Lorg_waveprotocol_wave_model_document_operation_Nindo$ElementEnd_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$ElementEnd'), Lorg_waveprotocol_wave_model_document_operation_Nindo$DeleteCharacters_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$DeleteCharacters'), Lorg_waveprotocol_wave_model_document_operation_Nindo$DeleteElementStart_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$DeleteElementStart'), Lorg_waveprotocol_wave_model_document_operation_Nindo$DeleteElementEnd_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$DeleteElementEnd'), Lorg_waveprotocol_wave_model_document_operation_Nindo$ReplaceAttributes_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$ReplaceAttributes'), Lorg_waveprotocol_wave_model_document_operation_Nindo$UpdateAttributes_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$UpdateAttributes'), Lorg_waveprotocol_wave_model_document_operation_Nindo$StartAnnotation_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$StartAnnotation'), Lorg_waveprotocol_wave_model_document_operation_Nindo$EndAnnotation_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$EndAnnotation'), Lorg_waveprotocol_wave_model_document_operation_Nindo$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$1'), Lorg_waveprotocol_wave_model_document_operation_Nindo$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'Nindo$2'), Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'NindoAutomaton'), Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton$DocSymbol_2_classLit = createForEnum('org.waveprotocol.wave.model.document.operation.', 'NindoAutomaton$DocSymbol', Ljava_lang_Enum_2_classLit, values_66, valueOf_72), _3Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton$DocSymbol_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.operation.', 'NindoAutomaton$DocSymbol;', Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton$DocSymbol_2_classLit), Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton$StackEntry_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'NindoAutomaton$StackEntry'), Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton$InsertElement_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'NindoAutomaton$InsertElement'), Lorg_waveprotocol_wave_model_document_operation_NindoAutomaton$DeleteElement_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'NindoAutomaton$DeleteElement'), Lorg_waveprotocol_wave_model_document_operation_NindoValidator$IllFormed_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'NindoValidator$IllFormed'), Lorg_waveprotocol_wave_model_document_operation_NindoValidator$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.operation.', 'NindoValidator$1'), Lorg_waveprotocol_wave_model_document_parser_AnnotationParser_2_classLit = createForClass('org.waveprotocol.wave.model.document.parser.', 'AnnotationParser'), Lorg_waveprotocol_wave_model_document_parser_Item_2_classLit = createForClass('org.waveprotocol.wave.model.document.parser.', 'Item'), Lorg_waveprotocol_wave_model_document_parser_ItemType_2_classLit = createForEnum('org.waveprotocol.wave.model.document.parser.', 'ItemType', Ljava_lang_Enum_2_classLit, values_70, valueOf_76), _3Lorg_waveprotocol_wave_model_document_parser_ItemType_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.parser.', 'ItemType;', Lorg_waveprotocol_wave_model_document_parser_ItemType_2_classLit), Lorg_waveprotocol_wave_model_document_parser_StreamingXmlParser_2_classLit = createForClass('org.waveprotocol.wave.model.document.parser.', 'StreamingXmlParser'), Lorg_waveprotocol_wave_model_document_parser_StreamingXmlParser$Buffer_2_classLit = createForClass('org.waveprotocol.wave.model.document.parser.', 'StreamingXmlParser$Buffer'), Lorg_waveprotocol_wave_model_document_parser_XmlParseException_2_classLit = createForClass('org.waveprotocol.wave.model.document.parser.', 'XmlParseException'), Lorg_waveprotocol_wave_model_document_raw_impl_Node_2_classLit = createForClass('org.waveprotocol.wave.model.document.raw.impl.', 'Node'), Lorg_waveprotocol_wave_model_document_raw_impl_Element_2_classLit = createForClass('org.waveprotocol.wave.model.document.raw.impl.', 'Element'), Lorg_waveprotocol_wave_model_document_raw_impl_RawDocumentImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.raw.impl.', 'RawDocumentImpl'), Lorg_waveprotocol_wave_model_document_raw_impl_Text_2_classLit = createForClass('org.waveprotocol.wave.model.document.raw.impl.', 'Text'), Lorg_waveprotocol_wave_model_document_util_AnnotationIntervalImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'AnnotationIntervalImpl'), Lorg_waveprotocol_wave_model_document_util_AnnotationIntervalImpl$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'AnnotationIntervalImpl$1'), Lorg_waveprotocol_wave_model_document_util_AnnotationRegistryImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'AnnotationRegistryImpl'), Lorg_waveprotocol_wave_model_document_util_AnnotationRegistryImpl$HandlerData_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'AnnotationRegistryImpl$HandlerData'), Lorg_waveprotocol_wave_model_document_util_AnnotationRegistryImpl$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'AnnotationRegistryImpl$1'), Lorg_waveprotocol_wave_model_document_util_AnnotationRegistryImpl$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'AnnotationRegistryImpl$2'), Lorg_waveprotocol_wave_model_document_util_AnnotationRegistryImpl$3_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'AnnotationRegistryImpl$3'), Lorg_waveprotocol_wave_model_document_util_DefaultDocumentEventRouter_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DefaultDocumentEventRouter'), Lorg_waveprotocol_wave_model_document_util_DefaultDocEventRouter_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DefaultDocEventRouter'), Lorg_waveprotocol_wave_model_document_util_DefaultDocumentEventRouter$Registration_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DefaultDocumentEventRouter$Registration'), Lorg_waveprotocol_wave_model_document_util_DocHelper$NodeOffset_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DocHelper$NodeOffset'), Lorg_waveprotocol_wave_model_document_util_DocIterate$DeepIteratorFilter_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DocIterate$DeepIteratorFilter'), Lorg_waveprotocol_wave_model_document_util_DocIterate$ElementFilter_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DocIterate$ElementFilter'), Lorg_waveprotocol_wave_model_document_util_DocIterate$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DocIterate$1'), Lorg_waveprotocol_wave_model_document_util_DocIterate$1$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DocIterate$1$1'), Lorg_waveprotocol_wave_model_document_util_DocOpScrub$UncheckedAnnotationBoundary$Triplet_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DocOpScrub$UncheckedAnnotationBoundary$Triplet'), _3Lorg_waveprotocol_wave_model_document_util_DocOpScrub$UncheckedAnnotationBoundary$Triplet_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.util.', 'DocOpScrub$UncheckedAnnotationBoundary$Triplet;', Lorg_waveprotocol_wave_model_document_util_DocOpScrub$UncheckedAnnotationBoundary$Triplet_2_classLit), Lorg_waveprotocol_wave_model_document_util_DocOpScrub$UncheckedAnnotationBoundary_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DocOpScrub$UncheckedAnnotationBoundary'), Lorg_waveprotocol_wave_model_document_util_DocOpScrub$ScrubCache_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DocOpScrub$ScrubCache'), Lorg_waveprotocol_wave_model_document_util_DocOpScrub$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DocOpScrub$1'), Lorg_waveprotocol_wave_model_document_util_DocOpScrub$2_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DocOpScrub$2'), Lorg_waveprotocol_wave_model_document_util_DocOpScrub$3_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DocOpScrub$3'), Lorg_waveprotocol_wave_model_document_util_DocumentImpl_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'DocumentImpl'), Lorg_waveprotocol_wave_model_document_util_FilteredView$Skip_2_classLit = createForEnum('org.waveprotocol.wave.model.document.util.', 'FilteredView$Skip', Ljava_lang_Enum_2_classLit, values_72, valueOf_78), _3Lorg_waveprotocol_wave_model_document_util_FilteredView$Skip_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.util.', 'FilteredView$Skip;', Lorg_waveprotocol_wave_model_document_util_FilteredView$Skip_2_classLit), Lorg_waveprotocol_wave_model_document_util_FilterProduct_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'FilterProduct'), Lorg_waveprotocol_wave_model_document_util_FocusedRange_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'FocusedRange'), Lorg_waveprotocol_wave_model_document_util_GenericAnnotationCursor_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'GenericAnnotationCursor'), Lorg_waveprotocol_wave_model_document_util_GenericAnnotationCursor$KeyLocation_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'GenericAnnotationCursor$KeyLocation'), Lorg_waveprotocol_wave_model_document_util_GenericAnnotationCursor$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'GenericAnnotationCursor$1'), Lorg_waveprotocol_wave_model_document_util_GenericAnnotationIntervalIterable_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'GenericAnnotationIntervalIterable'), Lorg_waveprotocol_wave_model_document_util_GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator'), Lorg_waveprotocol_wave_model_document_util_GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$KeyEntry_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$KeyEntry'), Lorg_waveprotocol_wave_model_document_util_GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'GenericAnnotationIntervalIterable$GenericAnnotationIntervalIterator$1'), Lorg_waveprotocol_wave_model_document_util_MutableDocumentProxy$DocumentProxy_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'MutableDocumentProxy$DocumentProxy'), Lorg_waveprotocol_wave_model_document_util_PersistentContent$HardContent_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'PersistentContent$HardContent'), Lorg_waveprotocol_wave_model_document_util_Point_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'Point'), Lorg_waveprotocol_wave_model_document_util_Point$El_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'Point$El'), Lorg_waveprotocol_wave_model_document_util_Point$Tx_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'Point$Tx'), Lorg_waveprotocol_wave_model_document_util_Pretty_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'Pretty'), Lorg_waveprotocol_wave_model_document_util_Property_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'Property'), Lorg_waveprotocol_wave_model_document_util_Property$ImmutableProperty_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'Property$ImmutableProperty'), Lorg_waveprotocol_wave_model_document_util_Property$MutableProperty_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'Property$MutableProperty'), Lorg_waveprotocol_wave_model_document_util_Range_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'Range'), Lorg_waveprotocol_wave_model_document_util_RangeTracker_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'RangeTracker'), Lorg_waveprotocol_wave_model_document_util_ReadableTreeWalker_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'ReadableTreeWalker'), Lorg_waveprotocol_wave_model_document_util_XmlStringBuilder_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'XmlStringBuilder'), Lorg_waveprotocol_wave_model_document_util_XmlStringBuilderDoc_2_classLit = createForClass('org.waveprotocol.wave.model.document.util.', 'XmlStringBuilderDoc'), Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$BiasDirection_2_classLit = createForEnum('org.waveprotocol.wave.model.document.', 'AnnotationBehaviour$BiasDirection', Ljava_lang_Enum_2_classLit, values_59, valueOf_65), _3Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$BiasDirection_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.', 'AnnotationBehaviour$BiasDirection;', Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$BiasDirection_2_classLit), Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$InheritDirection_2_classLit = createForEnum('org.waveprotocol.wave.model.document.', 'AnnotationBehaviour$InheritDirection', Ljava_lang_Enum_2_classLit, values_62, valueOf_68), _3Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$InheritDirection_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.', 'AnnotationBehaviour$InheritDirection;', Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$InheritDirection_2_classLit), Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$ContentType_2_classLit = createForEnum('org.waveprotocol.wave.model.document.', 'AnnotationBehaviour$ContentType', Ljava_lang_Enum_2_classLit, values_60, valueOf_66), _3Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$ContentType_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.', 'AnnotationBehaviour$ContentType;', Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$ContentType_2_classLit), Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$AnnotationFamily_2_classLit = createForEnum('org.waveprotocol.wave.model.document.', 'AnnotationBehaviour$AnnotationFamily', Ljava_lang_Enum_2_classLit, values_58, valueOf_64), _3Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$AnnotationFamily_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.document.', 'AnnotationBehaviour$AnnotationFamily;', Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$AnnotationFamily_2_classLit), Lorg_waveprotocol_wave_model_document_AnnotationBehaviour$1_2_classLit = createForClass('org.waveprotocol.wave.model.document.', 'AnnotationBehaviour$1'), Lorg_waveprotocol_wave_model_id_IdGeneratorImpl_2_classLit = createForClass('org.waveprotocol.wave.model.id.', 'IdGeneratorImpl'), Lorg_waveprotocol_wave_model_id_InvalidIdException_2_classLit = createForClass('org.waveprotocol.wave.model.id.', 'InvalidIdException'), Lorg_waveprotocol_wave_model_id_SimplePrefixEscaper_2_classLit = createForClass('org.waveprotocol.wave.model.id.', 'SimplePrefixEscaper'), Lorg_waveprotocol_wave_model_id_WaveId_2_classLit = createForClass('org.waveprotocol.wave.model.id.', 'WaveId'), Lorg_waveprotocol_wave_model_id_WaveIdentifiers$1_2_classLit = createForClass('org.waveprotocol.wave.model.id.', 'WaveIdentifiers$1'), Lorg_waveprotocol_wave_model_id_WaveletId_2_classLit = createForClass('org.waveprotocol.wave.model.id.', 'WaveletId'), Lorg_waveprotocol_wave_model_id_WaveletIdSerializer$1_2_classLit = createForClass('org.waveprotocol.wave.model.id.', 'WaveletIdSerializer$1'), Lorg_waveprotocol_wave_model_id_WaveletName_2_classLit = createForClass('org.waveprotocol.wave.model.id.', 'WaveletName'), Lorg_waveprotocol_wave_model_operation_wave_AbstractWaveletOperationContextFactory_2_classLit = createForClass('org.waveprotocol.wave.model.operation.wave.', 'AbstractWaveletOperationContextFactory'), Lorg_waveprotocol_wave_model_operation_wave_AddParticipant_2_classLit = createForClass('org.waveprotocol.wave.model.operation.wave.', 'AddParticipant'), Lorg_waveprotocol_wave_model_operation_wave_BasicWaveletOperationContextFactory_2_classLit = createForClass('org.waveprotocol.wave.model.operation.wave.', 'BasicWaveletOperationContextFactory'), Lorg_waveprotocol_wave_model_operation_wave_BlipOperation_2_classLit = createForClass('org.waveprotocol.wave.model.operation.wave.', 'BlipOperation'), Lorg_waveprotocol_wave_model_operation_wave_BlipContentOperation_2_classLit = createForClass('org.waveprotocol.wave.model.operation.wave.', 'BlipContentOperation'), Lorg_waveprotocol_wave_model_operation_wave_BlipOperation$UpdateContributorMethod_2_classLit = createForEnum('org.waveprotocol.wave.model.operation.wave.', 'BlipOperation$UpdateContributorMethod', Ljava_lang_Enum_2_classLit, values_75, valueOf_81), _3Lorg_waveprotocol_wave_model_operation_wave_BlipOperation$UpdateContributorMethod_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.operation.wave.', 'BlipOperation$UpdateContributorMethod;', Lorg_waveprotocol_wave_model_operation_wave_BlipOperation$UpdateContributorMethod_2_classLit), Lorg_waveprotocol_wave_model_operation_wave_WaveletBlipOperation_2_classLit = createForClass('org.waveprotocol.wave.model.operation.wave.', 'WaveletBlipOperation'), Lorg_waveprotocol_wave_model_operation_wave_WaveletOperationContext_2_classLit = createForClass('org.waveprotocol.wave.model.operation.wave.', 'WaveletOperationContext'), Lorg_waveprotocol_wave_model_operation_wave_WorthyChangeChecker$True_2_classLit = createForClass('org.waveprotocol.wave.model.operation.wave.', 'WorthyChangeChecker$True'), Lorg_waveprotocol_wave_model_operation_wave_WorthyChangeChecker$2_2_classLit = createForClass('org.waveprotocol.wave.model.operation.wave.', 'WorthyChangeChecker$2'), Lorg_waveprotocol_wave_model_operation_OpCursorException_2_classLit = createForClass('org.waveprotocol.wave.model.operation.', 'OpCursorException'), Lorg_waveprotocol_wave_model_operation_OperationException_2_classLit = createForClass('org.waveprotocol.wave.model.operation.', 'OperationException'), Lorg_waveprotocol_wave_model_operation_OperationRuntimeException_2_classLit = createForClass('org.waveprotocol.wave.model.operation.', 'OperationRuntimeException'), Lorg_waveprotocol_wave_model_operation_SilentOperationSink$1_2_classLit = createForClass('org.waveprotocol.wave.model.operation.', 'SilentOperationSink$1'), Lorg_waveprotocol_wave_model_schema_conversation_ConversationSchemas_2_classLit = createForClass('org.waveprotocol.wave.model.schema.conversation.', 'ConversationSchemas'), Lorg_waveprotocol_wave_model_schema_AbstractXmlSchemaConstraints_2_classLit = createForClass('org.waveprotocol.wave.model.schema.', 'AbstractXmlSchemaConstraints'), Lorg_waveprotocol_wave_model_schema_conversation_ConversationSchemas$DefaultDocumentSchema_2_classLit = createForClass('org.waveprotocol.wave.model.schema.conversation.', 'ConversationSchemas$DefaultDocumentSchema'), Lorg_waveprotocol_wave_model_schema_conversation_ConversationSchemas$1_2_classLit = createForClass('org.waveprotocol.wave.model.schema.conversation.', 'ConversationSchemas$1'), Lorg_waveprotocol_wave_model_supplement_DocumentBasedAbuseStore_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'DocumentBasedAbuseStore'), Lorg_waveprotocol_wave_model_supplement_DocumentBasedAbuseStore$ElementFactory_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'DocumentBasedAbuseStore$ElementFactory'), Lorg_waveprotocol_wave_model_supplement_DocumentBasedAbuseStore$ElementFactory$1_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'DocumentBasedAbuseStore$ElementFactory$1'), Lorg_waveprotocol_wave_model_supplement_DocumentBasedAbuseStore$1_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'DocumentBasedAbuseStore$1'), Lorg_waveprotocol_wave_model_supplement_DocumentBasedGadgetState_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'DocumentBasedGadgetState'), Lorg_waveprotocol_wave_model_supplement_DocumentBasedGadgetState$1_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'DocumentBasedGadgetState$1'), Lorg_waveprotocol_wave_model_supplement_DocumentBasedWaveletReadState_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'DocumentBasedWaveletReadState'), Lorg_waveprotocol_wave_model_supplement_DocumentBasedWaveletReadState$1_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'DocumentBasedWaveletReadState$1'), Lorg_waveprotocol_wave_model_supplement_DocumentBasedWaveletReadState$2_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'DocumentBasedWaveletReadState$2'), Lorg_waveprotocol_wave_model_supplement_DocumentBasedWaveletReadState$3_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'DocumentBasedWaveletReadState$3'), Lorg_waveprotocol_wave_model_supplement_DocumentBasedWaveletReadState$4_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'DocumentBasedWaveletReadState$4'), Lorg_waveprotocol_wave_model_supplement_ThreadState_2_classLit = createForEnum('org.waveprotocol.wave.model.supplement.', 'ThreadState', Ljava_lang_Enum_2_classLit, values_78, valueOf_85), Lorg_waveprotocol_wave_model_supplement_DocumentBasedWaveletThreadState_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'DocumentBasedWaveletThreadState'), Lorg_waveprotocol_wave_model_supplement_DocumentBasedWaveletThreadState$1_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'DocumentBasedWaveletThreadState$1'), Lorg_waveprotocol_wave_model_supplement_GadgetStateCollection_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'GadgetStateCollection'), Lorg_waveprotocol_wave_model_supplement_LiveSupplementedWaveImpl_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'LiveSupplementedWaveImpl'), Lorg_waveprotocol_wave_model_supplement_LiveSupplementedWaveImpl$1_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'LiveSupplementedWaveImpl$1'), Lorg_waveprotocol_wave_model_supplement_LiveSupplementedWaveImpl$2_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'LiveSupplementedWaveImpl$2'), Lorg_waveprotocol_wave_model_supplement_LiveSupplementedWaveImpl$3_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'LiveSupplementedWaveImpl$3'), Lorg_waveprotocol_wave_model_supplement_SimpleWantedEvaluation_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'SimpleWantedEvaluation'), Lorg_waveprotocol_wave_model_supplement_SupplementImpl_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'SupplementImpl'), Lorg_waveprotocol_wave_model_supplement_SupplementedWaveImpl_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'SupplementedWaveImpl'), _3Lorg_waveprotocol_wave_model_supplement_ThreadState_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.supplement.', 'ThreadState;', Lorg_waveprotocol_wave_model_supplement_ThreadState_2_classLit), Lorg_waveprotocol_wave_model_supplement_WantedEvaluation$1_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'WantedEvaluation$1'), Lorg_waveprotocol_wave_model_supplement_WaveletBasedSupplement_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'WaveletBasedSupplement'), Lorg_waveprotocol_wave_model_supplement_WaveletBasedSupplement$1_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'WaveletBasedSupplement$1'), Lorg_waveprotocol_wave_model_supplement_WaveletBasedSupplement$2_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'WaveletBasedSupplement$2'), Lorg_waveprotocol_wave_model_supplement_WaveletBasedSupplement$3_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'WaveletBasedSupplement$3'), Lorg_waveprotocol_wave_model_supplement_WaveletBasedSupplement$4_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'WaveletBasedSupplement$4'), Lorg_waveprotocol_wave_model_supplement_WaveletBasedSupplement$5_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'WaveletBasedSupplement$5'), Lorg_waveprotocol_wave_model_supplement_WaveletBasedSupplement$6_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'WaveletBasedSupplement$6'), Lorg_waveprotocol_wave_model_supplement_WaveletReadStateCollection_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'WaveletReadStateCollection'), Lorg_waveprotocol_wave_model_supplement_WaveletThreadStateCollection_2_classLit = createForClass('org.waveprotocol.wave.model.supplement.', 'WaveletThreadStateCollection'), Lorg_waveprotocol_wave_model_wave_data_impl_PluggableMutableDocument_2_classLit = createForClass('org.waveprotocol.wave.model.wave.data.impl.', 'PluggableMutableDocument'), Lorg_waveprotocol_wave_model_wave_data_impl_ObservablePluggableMutableDocument_2_classLit = createForClass('org.waveprotocol.wave.model.wave.data.impl.', 'ObservablePluggableMutableDocument'), Lorg_waveprotocol_wave_model_undo_UndoManagerImpl_2_classLit = createForClass('org.waveprotocol.wave.model.undo.', 'UndoManagerImpl'), Lorg_waveprotocol_wave_model_undo_UndoManagerImpl$Checkpointer_2_classLit = createForClass('org.waveprotocol.wave.model.undo.', 'UndoManagerImpl$Checkpointer'), Lorg_waveprotocol_wave_model_undo_UndoStack_2_classLit = createForClass('org.waveprotocol.wave.model.undo.', 'UndoStack'), Lorg_waveprotocol_wave_model_util_Base64DecoderException_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'Base64DecoderException'), Lorg_waveprotocol_wave_model_util_ChainedData_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'ChainedData'), Lorg_waveprotocol_wave_model_util_CollectionUtils$IdentitySetAdapter_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'CollectionUtils$IdentitySetAdapter'), Lorg_waveprotocol_wave_model_util_CollectionUtils$6_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'CollectionUtils$6'), Lorg_waveprotocol_wave_model_util_CollectionUtils$9_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'CollectionUtils$9'), Lorg_waveprotocol_wave_model_util_CollectionUtils$10_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'CollectionUtils$10'), Lorg_waveprotocol_wave_model_util_ConcurrentSet_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'ConcurrentSet'), Lorg_waveprotocol_wave_model_util_EvaluableOffsetList_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'EvaluableOffsetList'), Lorg_waveprotocol_wave_model_util_EvaluableOffsetList$Node_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'EvaluableOffsetList$Node'), Lorg_waveprotocol_wave_model_util_EvaluableOffsetList$1_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'EvaluableOffsetList$1'), Lorg_waveprotocol_wave_model_util_Pair_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'Pair'), Lorg_waveprotocol_wave_model_util_Serializer$EnumSerializer_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'Serializer$EnumSerializer'), Lorg_waveprotocol_wave_model_util_Serializer$1_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'Serializer$1'), Lorg_waveprotocol_wave_model_util_Serializer$2_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'Serializer$2'), Lorg_waveprotocol_wave_model_util_Serializer$3_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'Serializer$3'), Lorg_waveprotocol_wave_model_util_Serializer$4_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'Serializer$4'), Lorg_waveprotocol_wave_model_util_Serializer$5_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'Serializer$5'), Lorg_waveprotocol_wave_model_util_Utf16Util$BlipCodePointResult_2_classLit = createForEnum('org.waveprotocol.wave.model.util.', 'Utf16Util$BlipCodePointResult', Ljava_lang_Enum_2_classLit, values_79, valueOf_86), _3Lorg_waveprotocol_wave_model_util_Utf16Util$BlipCodePointResult_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.util.', 'Utf16Util$BlipCodePointResult;', Lorg_waveprotocol_wave_model_util_Utf16Util$BlipCodePointResult_2_classLit), Lorg_waveprotocol_wave_model_util_Utf16Util$2_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'Utf16Util$2'), Lorg_waveprotocol_wave_model_util_Utf16Util$3_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'Utf16Util$3'), Lorg_waveprotocol_wave_model_util_Utf16Util$5_2_classLit = createForClass('org.waveprotocol.wave.model.util.', 'Utf16Util$5'), Lorg_waveprotocol_wave_model_version_HashedVersion_2_classLit = createForClass('org.waveprotocol.wave.model.version.', 'HashedVersion'), Lorg_waveprotocol_wave_model_version_HashedVersionSerializer$1_2_classLit = createForClass('org.waveprotocol.wave.model.version.', 'HashedVersionSerializer$1'), Lorg_waveprotocol_wave_model_wave_data_impl_AbstractBlipData_2_classLit = createForClass('org.waveprotocol.wave.model.wave.data.impl.', 'AbstractBlipData'), Lorg_waveprotocol_wave_model_wave_data_impl_AbstractWaveletData_2_classLit = createForClass('org.waveprotocol.wave.model.wave.data.impl.', 'AbstractWaveletData'), Lorg_waveprotocol_wave_model_wave_data_impl_BlipDataImpl_2_classLit = createForClass('org.waveprotocol.wave.model.wave.data.impl.', 'BlipDataImpl'), Lorg_waveprotocol_wave_model_wave_data_impl_ObservablePluggableMutableDocument$DocumentHandlerManager_2_classLit = createForClass('org.waveprotocol.wave.model.wave.data.impl.', 'ObservablePluggableMutableDocument$DocumentHandlerManager'), Lorg_waveprotocol_wave_model_wave_data_impl_ObservablePluggableMutableDocument$1_2_classLit = createForClass('org.waveprotocol.wave.model.wave.data.impl.', 'ObservablePluggableMutableDocument$1'), Lorg_waveprotocol_wave_model_wave_data_impl_PluggableMutableDocument$DocumentCreationContext_2_classLit = createForClass('org.waveprotocol.wave.model.wave.data.impl.', 'PluggableMutableDocument$DocumentCreationContext'), Lorg_waveprotocol_wave_model_wave_data_impl_PluggableMutableDocument$BasicSequencer_2_classLit = createForClass('org.waveprotocol.wave.model.wave.data.impl.', 'PluggableMutableDocument$BasicSequencer'), Lorg_waveprotocol_wave_model_wave_data_impl_PluggableMutableDocument$2_2_classLit = createForClass('org.waveprotocol.wave.model.wave.data.impl.', 'PluggableMutableDocument$2'), Lorg_waveprotocol_wave_model_wave_data_impl_WaveletDataImpl_2_classLit = createForClass('org.waveprotocol.wave.model.wave.data.impl.', 'WaveletDataImpl'), Lorg_waveprotocol_wave_model_wave_data_impl_WaveletDataListenerManager_2_classLit = createForClass('org.waveprotocol.wave.model.wave.data.impl.', 'WaveletDataListenerManager'), Lorg_waveprotocol_wave_model_wave_opbased_OpBasedBlip_2_classLit = createForClass('org.waveprotocol.wave.model.wave.opbased.', 'OpBasedBlip'), Lorg_waveprotocol_wave_model_wave_opbased_OpBasedBlip$1_2_classLit = createForClass('org.waveprotocol.wave.model.wave.opbased.', 'OpBasedBlip$1'), Lorg_waveprotocol_wave_model_wave_opbased_OpBasedWavelet_2_classLit = createForClass('org.waveprotocol.wave.model.wave.opbased.', 'OpBasedWavelet'), Lorg_waveprotocol_wave_model_wave_opbased_OpBasedWavelet$1_2_classLit = createForClass('org.waveprotocol.wave.model.wave.opbased.', 'OpBasedWavelet$1'), Lorg_waveprotocol_wave_model_wave_opbased_OpBasedWavelet$2_2_classLit = createForClass('org.waveprotocol.wave.model.wave.opbased.', 'OpBasedWavelet$2'), Lorg_waveprotocol_wave_model_wave_opbased_WaveViewImpl_2_classLit = createForClass('org.waveprotocol.wave.model.wave.opbased.', 'WaveViewImpl'), Lorg_waveprotocol_wave_model_wave_opbased_WaveViewImpl$WaveletConfigurator_2_classLit = createForEnum('org.waveprotocol.wave.model.wave.opbased.', 'WaveViewImpl$WaveletConfigurator', Ljava_lang_Enum_2_classLit, values_80, valueOf_87), _3Lorg_waveprotocol_wave_model_wave_opbased_WaveViewImpl$WaveletConfigurator_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.wave.opbased.', 'WaveViewImpl$WaveletConfigurator;', Lorg_waveprotocol_wave_model_wave_opbased_WaveViewImpl$WaveletConfigurator_2_classLit), Lorg_waveprotocol_wave_model_wave_opbased_WaveViewImpl$WaveletConfigurator$1_2_classLit = createForEnum('org.waveprotocol.wave.model.wave.opbased.', 'WaveViewImpl$WaveletConfigurator$1', Lorg_waveprotocol_wave_model_wave_opbased_WaveViewImpl$WaveletConfigurator_2_classLit, null, null), Lorg_waveprotocol_wave_model_wave_opbased_WaveViewImpl$WaveletConfigurator$2_2_classLit = createForEnum('org.waveprotocol.wave.model.wave.opbased.', 'WaveViewImpl$WaveletConfigurator$2', Lorg_waveprotocol_wave_model_wave_opbased_WaveViewImpl$WaveletConfigurator_2_classLit, null, null), Lorg_waveprotocol_wave_model_wave_opbased_WaveViewImpl$WaveletConfigurator$3_2_classLit = createForEnum('org.waveprotocol.wave.model.wave.opbased.', 'WaveViewImpl$WaveletConfigurator$3', Lorg_waveprotocol_wave_model_wave_opbased_WaveViewImpl$WaveletConfigurator_2_classLit, null, null), Lorg_waveprotocol_wave_model_wave_InvalidParticipantAddress_2_classLit = createForClass('org.waveprotocol.wave.model.wave.', 'InvalidParticipantAddress'), Lorg_waveprotocol_wave_model_wave_ParticipationHelper$3_2_classLit = createForClass('org.waveprotocol.wave.model.wave.', 'ParticipationHelper$3'), Lorg_waveprotocol_wave_model_waveref_InvalidWaveRefException_2_classLit = createForClass('org.waveprotocol.wave.model.waveref.', 'InvalidWaveRefException'), Lorg_waveprotocol_wave_model_waveref_WaveRef_2_classLit = createForClass('org.waveprotocol.wave.model.waveref.', 'WaveRef'), Lorg_waveprotocol_wave_model_waveref_WaverefEncoder$EscaperType_2_classLit = createForEnum('org.waveprotocol.wave.model.waveref.', 'WaverefEncoder$EscaperType', Ljava_lang_Enum_2_classLit, values_81, valueOf_88), _3Lorg_waveprotocol_wave_model_waveref_WaverefEncoder$EscaperType_2_classLit = createForArray('[Lorg.waveprotocol.wave.model.waveref.', 'WaverefEncoder$EscaperType;', Lorg_waveprotocol_wave_model_waveref_WaverefEncoder$EscaperType_2_classLit), Lorg_waveprotocol_wave_util_escapers_UnicodeEscaper_2_classLit = createForClass('org.waveprotocol.wave.util.escapers.', 'UnicodeEscaper'), Lorg_waveprotocol_wave_util_escapers_PercentEscaper_2_classLit = createForClass('org.waveprotocol.wave.util.escapers.', 'PercentEscaper');
$entry(browserLoaderLeftoversFragmentHasLoaded)();
